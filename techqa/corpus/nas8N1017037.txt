Title: IBM Stored Procedure Result Set Returns Corrupted Date and Time Values - United States

Text:
MSGCPF5035 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Stored procedures with date or time values in the result set must be compiled using the same date and time format as the clients calling the procedure will use. 

RESOLVING THE PROBLEM
Stored procedures that return result sets that include date or time data types must be created with the same job format options that are used by the client calling the procedure. If the format option does not match, clients may incorrectly parse the data leading to incorrect output. Clients affected include Access Client Solutions and IBM i Access For Windows ODBC and OLE DB (IBMDA400) and the IBM Toolbox for Java JDBC driver. The actual error that is returned to the client will vary, and there is no way to know what it might be. Often the error is a message to the effect that a numeric value is incorrect or the data is not numeric. The reason for this is that the incorrect parsing of the date data will result in too many or too few bytes being parsed, and all subsequent fields in the result set will be offset accordingly. A character type field will normally be able to have any value in it without generating an error; however, a varchar type that has a variable length will almost certainly have an error based on an incorrect length being read from the data stream. Numeric values have a small subset of allowable hex values so they are much more likely to detect incorrect data and generate an error. 

When creating SQL procedures, the format options can be specified on the create procedure statement using the SET OPTION clause (R510 operating system and later). If the format options are not specified on the SET OPTION clause, they are picked up from the job running the create procedure. 

The following example illustrates the problem:
Create the procedure:
Create procedure DATEYMD (IN SQLStmt CHAR(512)) RESULT SET 1 LANGUAGE SQL SET OPTION DATFMT=*YMD SQLTestSrc: BEGIN DECLARE C1 CURSOR for S1; PREPARE S1 FROM SQLStmt; OPEN C1; SET RESULT SETS CURSOR C1; END 

Create the table and populate it:
create table date2 (f1 date)
insert into date2 values ('1942-01-01')

Connect with ODBC or JDBC using the *ISO format options (the default for ODBC). Call the procedure as "CALL DATEYMD('select * from date2')". The following values are returned:
ODBC: 4500-Ã…0-00
JDBC: "06.01.04 "

If the date value is outside of the range of valid dates for the date format used to compile the procedure, message CPF5035 RC15 will occur.

 


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.2 Operating System IBM i 7.1 Operating System IBM i 6.1 
HISTORICAL NUMBER
 26405253