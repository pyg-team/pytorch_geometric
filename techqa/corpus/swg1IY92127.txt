Title: IBM IY92127: Appendix G of System Admin. Guide, concerning System V IPC resource usage, needs updating: INFORMATION ON SEMAPHORES. - United States

Text:
AIX SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS DOCUMENTATION ERROR.
    
   
   

ERROR DESCRIPTION
 *  Some IPC resources are, by design, not freed up after a
   controlled shutdown of a queue manager. This fact is not
   clearly stated in the documentation.
   
   The documentation in this area, Appendix G of the WMQ System
   Administration Manual, is generally in need of revision and
   clarification.
   
   
    
   
   

LOCAL FIX
 *  Appendix G of MQ System Admin Guide needs to include additional
   information on Semaphores.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   Users expecting the ending of queue managers on a machine to
   correspond with the complete elimination of mqm IPC resources.
   
   Platforms affected:
   All Unix
   
   ****************************************************************
   PROBLEM SUMMARY:
   This is the existing text of the first two parts of Appendix G
   from the WMQ V6 System Administration manual:
   
   Appendix G.
   
   WebSphere MQ and UNIX System V IPC resources
   
   This information applies to WebSphere MQ running on UNIX
   systems only.
   
   WebSphere MQ uses System V interprocess communication (IPC)
   resources (semaphores and shared memory segments) to store and
   pass data between system components. These resource are used by
   queue manager processes and applications that connect to the
   queue manager. WebSphere MQ clients do not use System V IPC
   resources. Use the UNIX command ipcs to view the number and
   size of these resources that the system uses.
   
   Clearing WebSphere MQ shared memory resources
   
   When a WebSphere MQ queue manager stops, it releases the IPC
   resources that it was using back to the system. There are two
   situations in which this might not happen automatically:
   
   o If applications are connected to the queue manager when it
   stops (perhaps because the queue manager was shut down using
   endmqm -i or endmqm -p), the IPC resources used by these
   applications might not be released.
   
   o If the queue manager ends abnormally (for example, if an
   operator issues the system kill command), some IPC resources
   might be left allocated after all queue manager processes have
   terminated.
   
   In these cases, the IPC resources are not release back to the
   system until you manually remove them, or restart (strmqm) or
   delete (dltmqm) the queue manager.
   
   WebSphere MQ provides a utility to release System V IPC
   resources allocated by the queue manager but not freed, for one
   of the above reasons, back to the system.
   
   To check and free any unused System V IPC resources do the
   following
   
   1. Log on as user mqm
   2. End the queue manager
   3. Type the following:
   On Solaris, HP-UX, and Linux:
   /opt/mqm/bin/amqiclen -x -m QMGR
   On AIX:
   /usr/mqm/bin/amqiclen -x -m QMGR
   This command does not report any status. However, if some
   WebSphere MQ-allocated resources could not be freed because
   they were still in use, the return code is nonzero.
   
   
    
   
   

PROBLEM CONCLUSION
 *  This is the recommended replacement for that text, subject to
   editorial revision:
   
   Appendix G.
   
   WebSphere MQ and UNIX System V IPC resources
   
   This information applies to WebSphere MQ running on UNIX
   systems only.
   
   WebSphere MQ uses System V interprocess communication (IPC)
   resources (semaphores and shared memory segments) to store and
   pass data between system components. These resource are used by
   queue manager processes and applications that connect to the
   queue manager. WebSphere MQ clients do not use IPC resources,
   other than for WMQ trace control. Use the UNIX command ipcs -a
   to get full information on the number and size of the IPC
   resources currently in use on the machine.
   
   Clearing WebSphere MQ shared memory resources
   
   When a WebSphere MQ queue manager is ended normally, it removes
   the majority of the IPC resources that it was using. A small
   number of IPC resources will remain, and this is in accordance
   with the design: some of the IPC resources are intended to
   persist between queue manager restarts. The number of IPC
   resources remaining may vary to some extent, depending on the
   operating conditions.
   
   There are some situations when a larger proportion of the IPC
   resources in use by a queue manager may persist after that
   queue manager has ended:
   
   o If applications are connected to the queue manager when it
   stops (perhaps because the queue manager was shut down using
   endmqm -i or endmqm -p), the IPC resources used by these
   applications might not be released.
   
   o If the queue manager ends abnormally (for example, if an
   operator issues the system kill command), some IPC resources
   might be left allocated after all queue manager processes have
   terminated.
   
   In these cases, the IPC resources are not released back to the
   system until you restart (strmqm) or delete (dltmqm) the queue
   manager.
   
   IPC resources allocated by WebSphere MQ are maintained
   automatically by the allocating queue managers, and it is
   strongly recommended not to perform manual actions on, or
   removal of, these IPC resources.
   
   If however it is considered necessary to remove IPC resources
   owned by "mqm", then please follow these instructions:
   
   WebSphere MQ provides a utility to release the residual IPC
   resources allocated by a queue manager. This utility clears
   internal queue manager state at the same time as it removes the
   corresponding IPC resource. It thus ensures that the queue
   manager state and IPC resource allocation are kept in step. To
   free residual IPC resources perform the following:
   
   1. End the queue manager and all connecting applications
   2. Log on as user "mqm"
   3. Type the following:
   On Solaris, HP-UX, and Linux:
   /opt/mqm/bin/amqiclen -x -m QMGR
   On AIX:
   /usr/mqm/bin/amqiclen -x -m QMGR
   This command does not report any status. However, if some
   WebSphere MQ-allocated resources could not be freed, the
   return code is nonzero.
   4. Explicitly remove any remaining IPC resources which were
   created by user "mqm".
   
   Note: If a non-mqm application attempted to connect to
   WebSphere MQ before starting any queue managers, there may yet
   be some WebSphere MQ IPC resources remaining even after the
   above steps. These still-remaining resources would not have
   been created by user "mqm", and there is no straightforward way
   to reliably recognise them. These resources are very small and
   will be reused when WebSphere MQ is next restarted.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IY92127
   
   
 * REPORTED COMPONENT NAME
   WEB MQ FOR AIX
   
   
 * REPORTED COMPONENT ID
   5724B4101
   
   
 * REPORTED RELEASE
   530
   
   
 * STATUS
   CLOSED DOC
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-11-27
   
   
 * CLOSED DATE
   2006-12-12
   
   
 * LAST MODIFIED DATE
   2006-12-12
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS