Title: IBM Possible Abrupt Data Access Loss That Can Be Prevented - United States

Text:
 FLASH (ALERT)

ABSTRACT
 Possible abrupt data access loss that can be prevented 

CONTENT
This problem was recently recognized, and can cause the interface adapters to suddenly halt, and close the links. No data internal to the box is lost. 

Recovery option are in recommended order: 

 1. Upgrade system firmware 
 2. Reboot system 
 3. Reset Interface Adapters.


To Prevent Access Loss, please read further. 

On Flashsystem 720/820: 

Code levels less than 6.3.2_p2 are affected. 

 

All Adapter types are affected. FC, IB 

 

Run System Report from Gui Panel, or CLI (system report) 

Open file, check header page information:
===============================================================================
=== System Report ===
=== Fri Mar 06 07:44:40 CST 2015 ===
===============================================================================
===============================================================================
= System overview =
===============================================================================
System type: RamSan-820
Version: 6.3.1-p10
Uptime: 07:44:46 up 248 days, 17:18, load average: 5.16, 5.26, 5.42
Capacity (GiB): 19199
Chassis serial: 00R1CC3
MTMS: 9834-AE2-00R1CC3
ETH0: 10.10.65.96
SID: ef275
=============================================================================== 

If Uptime is at 248 day, and box has halted…..Reboot 

 

Note: Due to the abrupt halt, and both interface cards halting simultaneously, recovery code can fail Flashcards that are not really not defective. Display using CLI “storage” command, or GUI storage panel. If Flashcards are in failed state, Contact Support for resolution. 

 

If lower than 248: 

1. Reboot box on a scheduled basis. Reboot will reset timer, and Uptime will be accurate. 

2. Use Cli, and reset Fibre Adapter cli command fc reset <controller> fc reset fc-1 or fc-2 wait a few minutes between adapter resets to let the network settle. Using this method is concurrent, but will not update Uptime counter 

For IB adapters: ib reset <controller> ib reset ib-1 or ib reset ib-2 

 

Fix Now Available: 

6.3.2-p2 posted on 04/06/2015 with resolution to 248-day bug
http://www.ibm.com/support/fixcentral/ [http://www.ibm.com/support/fixcentral/] 


On Flashsystem 840, or V840 

Firmware levels less than 1.1.3.7 are affected. 

All Adapter types are affected. FC, IB, FCOE, iSCSi 

Gui access: 

Login screen, or click on System: 

Top Left corner: 

[/support/docview.wss?uid=ssg1S1005126&amp;aid=1] 

Click on Actions: 

[/support/docview.wss?uid=ssg1S1005126&amp;aid=2] 

Click on Properties: 

[/support/docview.wss?uid=ssg1S1005126&aid=3] [/support/docview.wss?uid=ssg1S1005126&aid=3] 


We have found a more accurate way to Calculate Adapter level time remaining until Lockup:
(This may require support Assistance to complete)
On the System Report, search for os_cpu_tick


Total number of ticks for os_cpu_tick is 2147483648 


|===== OS Timers =====| -> sncon_cmd: os.timers
OS_Time == 542143780, 3 Active timers
[10000] ticks: 1 expire: 542143780 pdata:0x0 cb: os_cpu_tick
[10001] ticks: 30 expire: 542143807 pdata:0x0 cb: hw_dma_watchdog
[10002] ticks: 100 expire: 542143806 pdata:0x0 cb: sp_watchdog
Formula:

2147483648 - 542143780 / 100/ 60 / 60 /24 = 185 days remaining until Adapter lock-up

total ticks - current os_cpu_tick/100 /60 /60 /24 = days remaining until Adapter lockup


This must be repeated for ALL 4 Adapters 04, 08, 0C, and 10



Uptime is displayed… 

If at 248, and box has halted……..Reboot. 

stopsystem –reboot Note: This command is non-concurrent 

If below 248, three options: 



1. Upgrade to a new firmware level (if below 1.1.3.6). The action of installing firmware concurrently will reset the adapters one at a time. 


Fix Now Available: 

1.1.3.8-43.46 posted on 04/17/2015 with resolution to 248-day bug
http://www.ibm.com/support/fixcentral/ [http://www.ibm.com/support/fixcentral/] 

 

2. Schedule a reboot during a maintenance window. 

Note: Do not use GUI and do NOT use "satask stopnode to reboot. 

Use CLI procedure: 

1) Determine NON-config node using lsnodecanister
2) Reboot non-config node using stopsystem –reboot –node <node_name or id> (approximately 5 minutes)
3) force failover satask startservice -force THEN log back into cluster
(approximately 1 minute)
4) Reboot remaining node using stopsystem –reboot –node <node_name or id> (approximately 5 minutes)
3. Reset adapters one at a time using CLi commands: 

note: Using this method is concurrent, but will not update Uptime counter. 


svctask maintenance -action reset -canister 1 -adapter 1
svctask maintenance -action reset -canister 1 -adapter 2

(wait a few minutes to allow paths to recover)

svctask maintenance -action reset -canister 2 -adapter 1
svctask maintenance -action reset -canister 2 -adapter 2



 



Cross reference information Segment Product Component Platform Version Edition Flash Storage IBM FlashSystem 720 Platform Independent Version Independent Flash Storage IBM FlashSystem 840 Platform Independent Version Independent Flash Storage IBM FlashSystem V840 Platform Independent Version Independent Flash Storage RamSan-820 Platform Independent Version Independent Flash Storage RamSan-720 Platform Independent Version Independent