Title: IBM Validation step when backing up the TPC Database - United States

Text:
SQL0253; SQL0253N; TPCDB; corrupt backup; unusable backup TECHNOTE (FAQ)

QUESTION
 How can I be sure that my periodic database backups are valid in case they are needed for recovery? 

CAUSE
Various factors can cause a database backup that completes successfully within DB2, to be reported as invalid when trying to restore the TPCDB database from it. For example the following message may unexpectedly be displayed when trying to restore the database: SQL2530N

ANSWER
As referenced in several procedures within the TPC infocenter site, periodic database backups are a critical step to protect the data that TPC has collected in the event of unexpected problems. It has however been observed that database backup files reported by DB2 to have been created successfully, are later found to be invalid or corrupt for one reason or another. This is not always noticed until the backup file is needed for recovery purposes. Backup files can become corrupt if the media they are stored on has problems, or in certain cases the backup will complete but the restore operation will expose problems present in the database that existed prior to taking the backup, resulting in a failed database restore operation. 

A quick validation step within DB2 upon completing a backup database command is to issue the following DB2 command against the newly created backup file: db2ckbkp -h, supplying the name of the backup file created by the backup db command. 

An example of this command and it's output: 

 * C:\bkp>db2ckbkp -h TPCDB.0.DB2.NODE0000.CATN0000.20130418080828.001 
   
   
   ===================== 
   MEDIA HEADER REACHED: 
   ===================== 
   Server Database Name -- TPCDB 
   Server Database Alias -- TPCDB 
   Client Database Alias -- TPCDB 
   Timestamp -- 20130418080828 
   Database Partition Number -- 0 
   Instance -- DB2 
   Sequence Number -- 1 
   Release ID -- D00 
   Database Seed -- 51BFFDF8 
   DB Comment's Codepage (Volume) -- 0 
   DB Comment (Volume) -- 
   DB Comment's Codepage (System) -- 0 
   DB Comment (System) -- 
   Authentication Value -- 255 
   Backup Mode -- 0 
   Includes Logs -- 0 
   Compression -- 0 
   Backup Type -- 0 
   Backup Gran. -- 0 
   Merged Backup Image -- 0 
   Status Flags -- 1 
   System Cats inc -- 1 
   Catalog Partition Number -- 0 
   DB Codeset -- UTF-8 
   DB Territory -- 
   LogID -- 1366297445 
   LogPath -- C:\DB2\NODE0000\SQL00002\SQLOGDIR\ 
   Backup Buffer Size -- 15601664 
   Number of Sessions -- 1 
   Platform -- 5 
   
   The proper image file name would be: 
   TPCDB.0.DB2.NODE0000.CATN0000.20130418080828.001 
   
   
   [1] Buffers processed: ######## 
   
   Image Verification Complete - successful. 

If there are any errors detected, the DB2 support team should be engaged via the PMR process for analysis of why the backup file reports errors, and to perform root cause analysis of why the backup job completed successfully yet created a bad backup file. 

This quick, extra step can save future frustration and add a level of assurance that your TPC server is protected and that you can more reliably recover from unexpected circumstances. 

RELATED INFORMATION
#Creating a backup of SSPC TPC Database [http://pic.dhe.ibm.com/infocenter/tivihelp/v59r1/index.jsp?topic=%2Fcom.ibm.sspc_v15.doc%2Ffqz0_t_sspc_creating_backup_copy_of_tpc_db.html]
Backing up TPC v5.x Database [http://pic.dhe.ibm.com/infocenter/tivihelp/v59r1/index.jsp?topic=%2Fcom.ibm.tpc_V51.doc%2Ffqz0_t_backing_up_tpc_database.html]
Backing up TPC v4.x Database [http://publib.boulder.ibm.com/infocenter/tivihelp/v4r1/index.jsp?topic=%2Fcom.ibm.tpc_V4223.doc%2Ffqz0_t_backing_up_tpc_database.html]
DB2 definition of SQL02530N [http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/index.jsp?topic=%2Fcom.ibm.db2.luw.messages.sql.doc%2Fdoc%2Fmsql02530n.html]


 


Cross reference information Segment Product Component Platform Version Edition Storage Management Tivoli Storage Productivity Center Standard Edition AIX, Linux, Windows 3.3.2, 4.1, 4.1.1, 4.2, 4.2.1, 4.2.2 Storage Virtualization Software TotalStorage Productivity Center Windows Server 2003, Windows Server 2008 Storage Management Tivoli Storage Productivity Center Basic Edition Windows, AIX, Linux 4.1, 4.1.1, 4.2, 4.2.1, 4.2.2