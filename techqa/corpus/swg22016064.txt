Title: IBM V8.1.3 Application Performance Management UI certificates are expiring - United States

Text:
APM; V8.1.3; V8.1.4; keystore; truststore; files; expired; expiring; upgrading; apmui; oidc; directory; certificate; server; installation TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The APM V8.1.3 default certificate that is provided for the OIDC service is set to expire 2 years after the APM V8.1.3 server is installed. APM V8.1.3 was released (GA'd) on the 1st of May, 2016. This 2 year time frame is expiring now or very soon for customers who installed APM V8.1.3 at the time it was released (GA'd) or soon after it released, and have not either configured custom certificates or upgraded to APM V8.1.4.

The APM V8.1.3 APMUI default certificate is hardcoded to expire on the 21st of April, 2019. 

SYMPTOM
How will I know if the OIDC certificate has expired? 

When the OIDC certificate has expired, users will receive a "Secure Connection Failed" message in their browser instead of the APM 8.1.3 Login Page.

How will I know if the APMUI certificate has expired? 

When the APMUI certificate has expired, users will receive a "Your connection is not secure" message that indicates the APM UI certificate has expired when navigating to APM server port 9443.


RESOLVING THE PROBLEM
To maintain valid UI certificates for installations that are still using the default out-of-the-box certificates, the existing keystore files must be replaced with the keystore files that are attached at the end of this technote. 

The following new keystore files that are attached to this technote contain certificates that expire in 2028. 


1. updated.8.1.3.oidc.key.jks (password: ccmR0cKs!)
2. updated.8.1.3.apmui.key.jks (password: apmpass)
3. updated.8.1.3.trust.jks (password: ccmR0cKs!)


How will I know if I need to update my existing keystore files? 


1. Identify the default self-signed oidc certificate by verifying the following: 


 * The password is ccmR0cKs! 
 * There's only a single certificate listed. 
 * Alias is "default". 
 * Valid for a two year period. 
 * Signature Algorithm is SHA256withRSA. 
 * Owner: CN=localhost, O=IBM, OU=oidc, C=US and Issuer: CN=localhost, O=IBM, OU=oidc, C=US


1.1. Navigate to the OIDC keystore directory by issuing the following command: 

# cd /opt/ibm/wlp/usr/servers/oidc/resources/security 

1.2. List the certificates in the key store by issuing the following command: 

# /opt/ibm/java/jre/bin/keytool -v -list -keystore ./key.jks 

Enter the keystore password: ccmR0cKs! 

1.3. Verify the output: 

Keystore type: jks
Keystore provider: IBMJCE
Your keystore contains 1 entry
Alias name: default 
Creation date: Mar 12, 2018
Certificate chain length: 1
Certificate[1]: 
Owner: CN=localhost, O=IBM, OU=oidc, C=US
Issuer: CN=localhost, O=IBM, OU=oidc, C=US 
Serial number: 59c006a2 
Valid from: 3/12/18 7:07 AM until: 3/11/20 7:07 AM 
Certificate fingerprints:
MD5: 3C:A8:D9:B5:6C:4E:32:44:4B:07:6C:21:0E:52:4A:0A
SHA1: BD:C5:2F:F3:78:8C:D7:FC:0C:60:92:A9:33:3D:E4:75:90:C5:33:E6
SHA256: EF:78:14:56:9D:99:86:C1:69:B8:AC:ED:E1:EC:30:AA:07:60:6B:76:D4:B1:5B:8E:E2:7B:17:23:5D:E8:3C:28
Signature algorithm name: SHA256withRSA 
Version: 3
Extensions:
#1: ObjectId: 2.5.29.14 Criticality=false
SubjectKeyIdentifier [
KeyIdentifier [
0000: a2 dc 5d 96 22 55 ae 63 e1 43 0e d0 2c 96 17 63 .....U.c.C.....c
0010: 9c fd 9d e8
]
] 

2. Identify the default shared trust.jks by verifying the following: 
 * The password is ccmR0cKs! 
 * There is only a single certificate listed. 
 * Alias is "default". 
 * Valid for a 2 year period. 
 * Signature Algorithm is SHA256withRSA. 
 * Owner: CN=localhost, O=IBM, OU=oidc, C=US and Issuer: CN=localhost, O=IBM, OU=oidc, C=US 
 * Same serial # as the certificate in the above key.jks file


2.1. Navigate to the shared trust store directory by issuing the following command: 

# cd /opt/ibm/wlp/usr/shared/resources/security 

2.2 List the certificates in the trust store by issuing the following command: 

# /opt/ibm/java/jre/bin/keytool -v -list -keystore ./trust.jks 

Enter the keystore password: ccmR0cKs! 

2.3. Verify the output: 

Keystore type: jks
Keystore provider: IBMJCE
Your keystore contains 1 entry 
Alias name: oidc 
Creation date: Mar 12, 2018
Entry type: trustedCertEntry 
Owner: CN=localhost, O=IBM, OU=oidc, C=US
Issuer: CN=localhost, O=IBM, OU=oidc, C=US
Serial number: 59c006a2
Valid from: 3/12/18 7:07 AM until: 3/11/20 7:07 AM 
Certificate fingerprints:
MD5: 3C:A8:D9:B5:6C:4E:32:44:4B:07:6C:21:0E:52:4A:0A
SHA1: BD:C5:2F:F3:78:8C:D7:FC:0C:60:92:A9:33:3D:E4:75:90:C5:33:E6
SHA256: EF:78:14:56:9D:99:86:C1:69:B8:AC:ED:E1:EC:30:AA:07:60:6B:76:D4:B1:5B:8E:E2:7B:17:23:5D:E8:3C:28
Signature algorithm name: SHA256withRSA
Version: 3
Extensions:
#1: ObjectId: 2.5.29.14 Criticality=false
SubjectKeyIdentifier [
KeyIdentifier [
0000: a2 dc 5d 96 22 55 ae 63 e1 43 0e d0 2c 96 17 63 .....U.c.C.....c
0010: 9c fd 9d e8 ....
]
] 

3. Identify the default APMUI keystore by verifying the following: 
 * The password is apmpass 
 * There's only a single certificate listed 
 * Alias is "default" 
 * Expires 4/21/19 
 * Signature Algorithm is SHA256withRSA 
 * Owner: CN=liberty, O=IBM, C=US and Issuer: CN=liberty, O=IBM, C=US


3.1. Navigate to the shared trust store directory by issuing the following command: 

# cd /opt/ibm/wlp/usr/servers/apmui/resources/security 

3.2. List the certificates in the trust store by issuing the following command: 

# /opt/ibm/java/jre/bin/keytool -v -list -keystore ./key.jks 

Enter keystore password: apmaas 

3.3 Verify the output: 

Keystore type: jks
Keystore provider: IBMJCE
Your keystore contains 1 entry 
Alias name: default 
Creation date: Apr 21, 2016
Entry type: keyEntry
Certificate chain length: 1
Certificate[1]: 
Owner: CN=liberty, O=IBM, C=US
Issuer: CN=liberty, O=IBM, C=US 
Serial number: 191bd82a
Valid from: 4/21/16 1:09 PM until: 4/21/19 1:09 PM 
Certificate fingerprints:
MD5: 06:FB:FA:F0:68:49:65:38:6D:FB:B3:2D:8A:24:5D:2B
SHA1: A2:39:41:40:F8:D5:3A:6D:80:62:D5:D5:6A:27:EB:9B:3A:35:B2:DA
SHA256: 85:B9:FB:97:98:69:B8:DF:2A:B0:38:C6:3B:C7:87:CA:71:21:CA:CE:DE:D0:09:57:FF:AF:B7:EB:E8:77:FD:6D
Signature algorithm name: SHA256withRSA 
Version: 3
Extensions:
#1: ObjectId: 2.5.29.14 Criticality=false
SubjectKeyIdentifier [
KeyIdentifier [
0000: 1b 97 38 19 52 43 34 f6 2a 0e 7f a4 22 db 07 80 ..8.RC4.........
0010: 41 6e 47 a5 AnG.
]
] 

Procedures 

Installation procedure (using /opt/ibm as the install directory) 

1. Download the new keystore files attached at the end of this technote into a temporary directory (/ tmp) on the APM server. 

2. Stop APM by issuing the following command: 

apm stop_all 

3. Back up the existing OIDC keystore by issuing the following command: 

cp /opt/ibm/wlp/usr/servers/oidc/resources/security/key.jks /opt/ibm/wlp/usr/servers/oidc/resources/security/key.jks.BAK 

4. Install the new OIDC keystore (replace the existing file) by issuing the following command: 

cp /tmp/updated.8.1.3.oidc.key.jks /opt/ibm/wlp/usr/servers/oidc/resources/security/key.jks 

5. Back up the existing APMUI keystore by issuing the following command: 

cp /opt/ibm/wlp/usr/servers/apmui/resources/security/key.jks /opt/ibm/wlp/usr/servers/apmui/resources/security/key.jks.BAK 

6. Install the new APMUI keystore (replace the exiting file) by issuing the following command: 

cp /tmp/updated.8.1.3.apmui.key.jks /opt/ibm/wlp/usr/servers/apmui/resources/security/key.jks 

7. Back up the existing UI truststore by issuing the following command: 

cp /opt/ibm/wlp/usr/shared/resources/security/trust.jks /opt/ibm/wlp/usr/shared/resources/security/trust.jks.BAK 

8. Install the new UI truststore (replace the existing file) by issuing the following command: 

cp /tmp/updated.8.1.3.trust.jks /opt/ibm/wlp/usr/shared/resources/security/trust.jks 

9. Restart APM by issuing the following command: 

apm start_all 

Verification procedure - verifying the installation of the new keystore files 

1. After APM is restarted, navigate to the APMUI at https://<APM_server_hostname>:9443 [https://apm_server_hostname:9443/] 

where <APM_server_hostname> is the hostname of your V8.1.3 APM server. 

2. Verify that the APM Log in page appears and log in. 

3. Verify that agent data is shown on the APM dashboard. Note: The passwords for the keystores and truststore are the same as the passwords that were shipped in APM V8.1.3, therefore, you don't need to update theserver.xml and serverVariables.xml files.

Keystore files: 


updated.8.1.3.trust.jks [/support/docview.wss?uid=swg22016064&aid=2]updated.8.1.3.trust.jks [/support/docview.wss?uid=swg22016064&aid=1] updated.8.1.3.oidc.key.jks [/support/docview.wss?uid=swg22016064&aid=4]updated.8.1.3.oidc.key.jks [/support/docview.wss?uid=swg22016064&aid=3] updated.8.1.3.apmui.key.jks [/support/docview.wss?uid=swg22016064&aid=6]updated.8.1.3.apmui.key.jks [/support/docview.wss?uid=swg22016064&aid=5]