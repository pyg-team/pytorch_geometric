Title: IBM Locating the PSW for a program check in a CICS TS system dump - United States

Text:
DUMP 0Cx 0C4 0C1 FFFF FFFFFFFF PROGRAM CHECK FINDING locating PSW REGISTER REGISTERS KERNEL ERROR TABLE DFHAP0001 MSGDFHAP0001; 5655-S97 5655S97 5655S9700 R670 670 R700 700 HCI6700 5655-S97 5655S97 ; 5655Y0400 R680 680 R800 800 HCI6800 R690 690 R900 900 HCI6900 R700 700 R000 000 HCI7000 5655Y0401 5655-Y04 5655Y04 KIXINFO TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You receive a program check that has an offset X'FFFFFFFF' in a CICS Transaction Server for z/OS (CICS TS) region. For example, DFHAP0001 An abend (code 0C4/AKEA) has occurred at offset X'FFFFFFFF' in module DFHAMP. The X'FFFFFFFF' indicates that CICS was unable to establish the location of the program check. So, you would like to locate the PSW and registers in your CICS system dump. 

RESOLVING THE PROBLEM
If you have a system dump from a CICS TS V4.1 region, see locating the PSW for a program check in a CICS TS 4.1 system dump [http://www.ibm.com/support/docview.wss?uid=swg21424768]. 
If you have a system dump from a CICS TS V3.2 or lower region, see locating the PSW for a program check in a CICS TS V3 system dump [http://www.ibm.com/support/docview.wss?uid=swg21176381].

If you have a system dump that contains your CICS TS V4.2, CICS TS V5.1, CICS TS V5.2, or CICS TS V5.3 address space, you can do the following to locate the PSW and the registers for the program check: 

 1.  Enter option 0 from the IPCS primary option menu to display the IPCS default values panel.
 2.  
 3.  
 4.  Enter DSNAME('xxxxx.xxxxx.xxxx') to the right of Source where xxxxx.xxxxx.xxxx is the dump dataset name. Then enter Enter and F3 to return to the IPCS primary option menu.
 5.  
 6.  
 7.  Enter option 6 from the IPCS primary option menu to display the IPCS Subcommand Entry panel.
 8.  
 9.  
 10. Enter IPCS command verbx dfhpdxxx 'ke' where xxx is the version and release for the CICS dump. The value of xxx is 670 for CICS TS V4.2, 680 for CICS TS V5.1, 690 for CICS TS V5.2, and 700 for CICS TS V5.3. This command will format the dump and display to the Kernel Domain KE_TASK Summary.
 11. 
 12. 
 13. Enter f *YES* to get to the running task that had the program check. There may be more than one. In the example below, there is one task with *YES* under ERROR (KE_NUM 0157). Figure 1.1 
     [/support/docview.wss?uid=swg21610631&aid=1] [/support/docview.wss?uid=swg21610631&aid=1]
     
     
 14. 
 15. Make a note of the KE_NUM, TCA_ADDR and the TRANSID of the tasks in error.
 16. 
 17. 
 18. Enter f table to find the KE Domain Error Table Summary. This is a summary containing the last 50 abends in the region since it was started. Figure 1.2
     [/support/docview.wss?uid=swg21610631&aid=2] [/support/docview.wss?uid=swg21610631&aid=2]
     
     
     
 19. 
 20. Enter ip st sys on the command line to determine the local time and date that the dump was taken.
 21. 
 22. 
 23. Make a note of the ERR_NUM associated with the program check that has an ERR_TIME matching the time the dump was taken and a KE_NUM matching the KE_NUM found in the Kernel Domain KE_TASK Summary. If there is more than one program check for the same ERR_TIME and KE_NUM, focus on the first program check. The other program checks are probably a result of the first program check.
 24. 
 25. 
 26. Enter f 'Number: xxxxxxxx' where xxxxxxxx is the ERR_NUM of the program check (from Figure 1.2) you have decided to focus on. This will find the entry in the KE Domain Error table for the error number you specify.
     
     Figure 1.3
     [/support/docview.wss?uid=swg21610631&aid=3] [/support/docview.wss?uid=swg21610631&aid=3]
     
 27. 
 28. 
 29. For CICS TS V4.2 or V5.x compare the addresses at offset X'4C' and offset X'134' in the KERNEL ERROR DATA. The addresses are the fourth word of the CICS PSW and the MVS PSW, respectively. If the addresses are different, use the MVS PSW and registers. Otherwise, use the CICS PSW and registers.
     
     The CICS PSW starts at offset x'40' and is 4 words in length. The CICS registers, 0 through 15, start at offset X'68' and each register is 2 words in length. 
     
     The MVS PSW starts at offset x'128' and is 4 words in length. The MVS registers, 0 through 15, start at offset x'150' and each register is 2 words in length.
 30. 
 31. Use F8 to scroll down to see the formatted CICS PSW and registers as shown in Figure 1.4 below. IPCS CICS VERBX will format the MVS PSW and registers if the MVS PSW is different from the CICS PSW. If the PSWs are the same as in this example, then CICS VERBX does not duplicate the information.
     
     Figure 1.4
     [/support/docview.wss?uid=swg21610631&aid=4] [/support/docview.wss?uid=swg21610631&aid=4]
     
     CICS VERBX will attempt to determine the failing module from the PSW and will display the module name and offset if possible. The offline dump formatter uses more information than the original failure message, and so often, when the original failure message is unhelpful (offset FFFFFFFF in module) the dump formatter will be more informative. 
     
     By scrolling down from the panel in Figure 1.4, you will often get the failing module printed from the start to the interrupt address plus 256 bytes. CICS VERBX will also assume the values in the general registers are addresses and print the storage before and after these addresses, using 64 bit, 31 bit, and 24 bit addresses.



Once you know the PSW, you can do the following to determine the module that the failure is occurring in:  1.  Enter option 1 from the IPCS primary option menu to Browse the dump data set.
 2.  
 3.  
 4.  Enter nnnnnnnn into the Pointer Address field where nnnnnnnn is the fourth word of the PSW. 
 5.  
 6.  
 7.  If the storage displays, enter F7 to scroll up until you see an eye catcher for a load module. Load module names are usually followed by a date and time stamp. Calculate an offset within the module by subtracting the load point from the PSW address. This is the offset where the abend occurred.
 8.  
 9.  
 10. If "storage not available" displays, enter ip where nnnnnnnn. If the module has been loaded by the operating system from the LPA or Nucleus, this will display the module name and the offset within the module.



Now that you know the module name and the offset, search for a known problem on the CICS Support page [http://www.ibm.com/support/entry/portal/Overview/Software/Other_Software/CICS_Transaction_Server] or from your favorite search engine. Use keywords such as the following for a search argument: 'DFHAP0001 DFHAPDM 0C4'.  

PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server