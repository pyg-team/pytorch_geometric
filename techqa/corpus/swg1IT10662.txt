Title: IBM IT10662: MQ CRTMQM COMMAND FAILS WITH ERROR AMQ7064 ("LOG PATH NOT VALID OR INACCESSIBLE") WHEN LOG DIRECTORY IS ON A GPFS FILE SYSTEM - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The MQ crtmqm command can fail with error message AMQ7064
   ("Log path not valid or inaccessible") if the log directory for
   the queue manager is the root directory of a GPFS file system
   containing entries such as ".snapshots" which are part of the
   GPFS file system.
   
     For example, if a GPFS filesystem is mounted on the directory
   /mqlog/QMGR_A, and if the filesystem contains path names like
   /mqlog/QMGR_A/.snapshots (or similar), then an MQ crtmqm command
   will not allow the directory to be used because it expects it
   to be empty:
   
       crtmqm -ld /mqlog QMGR_A
       AMQ7064: Log path not valid or accessible
   
   
   While MQ tolerates a "lost+found" directory in the root of a
   mounted filesystem, it does not allow ".snapshots" or other
   names and will consider the log directory to be in use, and
   therefore invalid for crtmqm to use.
   
   
    
   
   

LOCAL FIX
 *  Use the mmsnapdir command to rename the .snapshots directory to
   lost+found before running crtmqm. The directory name can be
   changed back afterwards. For example, if the MQ log file system
   is known as /dev/fs1:
   .
     mmsnapdir fs1 -s lost+found
     crtmqm -ld /mqlog QMGR_A
     mmsnapdir fs1 -s .snapshots
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects users of MQ v8 on the platforms listed above,
   who wish to use MQ with a version of GPFS which automatically
   creates directories called ".snapshots", and are attempting to
   create a queue manager with a log or data directory which is the
   root of a GPFS filesystem.
   
   Similarly, this issue also affects users of such a GPFS system
   who wish to install MQ into the root directory of a GPFS
   filesystem.
   
   
   Platforms affected:
   HP-UX Itanium, Linux on Power, Linux on S390, Linux on x86,
   Linux on x86-64, Linux on zSeries, Solaris x86-64, Solaris
   SPARC, AIX
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   MQ contains logic to disregard directories named "lost+found",
   which are used for housekeeping by the operating system in the
   root of a filesystem.
   
   Given that GPFS uses .snapshots directories in a similar manner,
   it was deemed necessary for MQ to also disregarded these
   directories.
   
   
    
   
   

PROBLEM CONCLUSION
 *  For the platforms listed above, MQ v8 has been updated to ignore
   directories named ".snapshots" when installing or uninstalling
   MQ, and when checking if a target directory for queue manager
   creation is empty.
   
   If the GPFS snapshots directory has been renamed to an alternate
   name, the new environment variable AMQ_IGNORE_SNAPDIRNAME is
   available to provide the name of the snapshots directory for MQ
   to ignore. If set, the value of AMQ_IGNORE_SNAPDIRNAME will be
   used instead of ".snapshots" when evaluating if a directory can
   be ignored.
   
   Use of AMQ_IGNORE_SNAPDIRNAME is not supported when installing
   with swagent on HP-UX.
   
   When installing, AMQ_IGNORE_SNAPDIRNAME is treated as a text
   pattern and matched against any subset of the directory name.
   For example, the ".snapshots" pattern will match both
   ".snapshots" and ".snapshots.old".
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v8.0       8.0.0.4
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT10662
   
   
 * REPORTED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * REPORTED COMPONENT ID
   5724H7251
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2015-08-12
   
   
 * CLOSED DATE
   2015-08-28
   
   
 * LAST MODIFIED DATE
   2016-04-19
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * FIXED COMPONENT ID
   5724H7251
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY
   UP