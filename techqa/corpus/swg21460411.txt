Title: IBM Receive java.lang.OutOfMemoryError while deploying an IBM WebSphere Commerce application EAR - United States

Text:
OOM; APAR; iFix; i-Fix; fix pack; fixpack; FP TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When an IBM WebSphere Commerce application EAR is very large, you might experience a java.lang.OutOfMemoryError exception while the EAR is being deployed. This can occur during application deployment or while applying interim fixes and fix packs to a WebSphere Commerce instance. 

SYMPTOM
Messages similar to these are logged in the deployEar_WC_instance_name.log file: 

 [wsadmin] JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError". 

 [wsadmin] JVMDUMP006I Processing dump event "systhrow", detail "java/lang/OutOfMemoryError" - please wait. 

 [wsadmin] JVMDUMP032I JVM requested Snap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103336.1032252.0007.trc' in response to an event 

 [wsadmin] Exception in thread "Attach handler" java.lang.OutOfMemoryError 

 [wsadmin] at com.ibm.tools.attach.javaSE.CommonDirectory.waitSemaphore(CommonDirectory.java:242) 

 [wsadmin] at com.ibm.tools.attach.javaSE.AttachHandler.waitForNotification(AttachHandler.java:282) 

 [wsadmin] at com.ibm.tools.attach.javaSE.AttachHandler.run(AttachHandler.java:203) 

 [wsadmin] JVMDUMP010I Snap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103336.1032252.0007.trc 

 [wsadmin] JVMDUMP032I JVM requested Heap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103336.1032252.0008.phd' in response to an event 

 [wsadmin] JVMDUMP010I Heap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103336.1032252.0008.phd 

 [wsadmin] JVMDUMP032I JVM requested Java dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103336.1032252.0009.txt' in response to an event 

 [wsadmin] JVMDUMP010I Java dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103336.1032252.0009.txt 

 [wsadmin] JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError". 

 [wsadmin] JVMDUMP006I Processing dump event "systhrow", detail "java/lang/OutOfMemoryError" - please wait. 

 [wsadmin] JVMDUMP032I JVM requested Snap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103351.1032252.0010.trc' in response to an event 

 [wsadmin] JVMDUMP010I Snap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103351.1032252.0010.trc 

 [wsadmin] JVMDUMP032I JVM requested Heap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103351.1032252.0011.phd' in response to an event 

 [wsadmin] JVMDUMP010I Heap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103351.1032252.0011.phd 

 [wsadmin] JVMDUMP032I JVM requested Java dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103351.1032252.0012.txt' in response to an event 

 [wsadmin] JVMDUMP010I Java dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103351.1032252.0012.txt 

 [wsadmin] JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError". 

 [wsadmin] WASX7017E: Exception received while running file "/usr/WebSphere/CommerceServer70/config/deployment/scripts/deployEar.jacl"; exception information: com.ibm.websphere.management.application.client.AppDeploymentException: com.ibm.websphere.management.application.client.AppDeploymentException: ADMA0092E: An unexpected exception occurred while preparing task EnsureMethodProtectionFor20EJB. Check the server machine First Failure Data Capture tool (FFDC) for more information. [Root exception is java.lang.OutOfMemoryError] 

 [wsadmin] java.lang.OutOfMemoryError: java.lang.OutOfMemoryError


DIAGNOSING THE PROBLEM
The deployEar_WC_instance_name.log is located here: 

WC_installdir/logs/update/actions/install/deployEar_WC_instance_name.log


RESOLVING THE PROBLEM
To resolve this issue, increase the jvmMaxMemory setting in the deployEar.xml file to increase the maximum heap size for the wsadmin JVM, using the following steps: 

1. Open the <WCS_installdir>/config/deployment/xml/deployEar.xml file. 

2. Add the jvmMaxMemory parameter to each instance of "<wsadmin": 

 

<wsadmin jvmMaxMemory="1024M" 

... 

</wsadmin> 

Note: There are multiple instances of "<wsadmin". Please be sure to update each instance.