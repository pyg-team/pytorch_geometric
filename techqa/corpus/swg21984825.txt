Title: IBM After upgrade Impact from 6.1 to Impact 6.1.1.4. Custom MWM stop working. - United States

Text:
Impact; upgrade; 6.1; MWM; derby; HSQL TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Custom MWM stops working after upgrade Impact from 6.1 to Impact 6.1.1.4. 

SYMPTOM
We have a custom maintenance window manager that stores its data in a HSQLDB. When I logged into the TIP of version 6.1.1.4 I noticed that our custom data sources were not there. I attempted to add them back but when I click on the "Test Connection" button I get hit with an error "HSQLDB : Connection could not be made." Having said that if I save the data source (BABG_ReportsHSQLDB) it creates the sub source (BABG_mm_windows). When I look at the Table Description part of the portlet it shows the columns etc. of our database. It also throws this
error to the UI "Error message: Could not get Schemas and Tables for DataSource%3A BABG_ReportsHSQLDB. Reason%3A com.micromuse.common.datasource.SQLDataSourceException%3A JDBC Connection Pool could not
connect to datasource as%3A sa at jdbc%3Ahsqldb%3Ahsql%3A%2F%2Flocalhost%3A5435%2FNCI_impact. "



CAUSE
From Version 6.1.1, Impact Database changed from HSQL to Derby.

ENVIRONMENT
Impact 5.1 and 6.1 upgraded to Impact 6.1.x.

DIAGNOSING THE PROBLEM
When check netcool-error.log, see following message:

02 Jun 2016 10:41:55,868 ERROR [ImpactServerManagedBean] Failed to unregister MBean for policy 'BABG_MWM' with MBeanServer
javax.management.InstanceNotFoundException: ibm.tivoli.impact:thread="pool-6-thread-16",type=Service,server=NCI,policy=BABG_MWM,start=1464828115367
at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1106)
at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.exclusiveUnregisterMBean(DefaultMBeanServerInterceptor.java:427)
at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.unregisterMBean(DefaultMBeanServerInterceptor.java:415)
at com.sun.jmx.mbeanserver.JmxMBeanServer.unregisterMBean(JmxMBeanServer.java:518)
at com.micromuse.response.server.management.ImpactServerManagedBean.unregisterPolicy(ImpactServerManagedBean.java:141)
at com.micromuse.response.server.management.ManagedImpactServerSupport$Consumer.run(ManagedImpactServerSupport.java:977)
at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:452)
at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:314)
at java.util.concurrent.FutureTask.run(FutureTask.java:149)
at com.micromuse.common.util.concurrent.TrackingExecutor$1.run(TrackingExecutor.java:105)
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:897)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:919)
at java.lang.Thread.run(Thread.java:738)
02 Jun 2016 10:41:56,499 ERROR [ImpactDatabaseService] org.hsqldb.HsqlException: Network client is not a HSQLDB JDBC driver

02 Jun 2016 10:41:56,499 ERROR [ImpactDatabaseService] at org.hsqldb.error.Error.error(Unknown Source)

02 Jun 2016 10:41:56,499 ERROR [ImpactDatabaseService] at org.hsqldb.error.Error.error(Unknown Source)

02 Jun 2016 10:41:56,499 ERROR [ImpactDatabaseService] at org.hsqldb.server.ServerConnection.handshake(Unknown Source)

02 Jun 2016 10:41:56,499 ERROR [ImpactDatabaseService] at org.hsqldb.server.ServerConnection.init(Unknown Source)

02 Jun 2016 10:41:56,499 ERROR [ImpactDatabaseService] at org.hsqldb.server.ServerConnection.run(Unknown Source)

02 Jun 2016 10:41:56,500 ERROR [ImpactDatabaseService] at java.lang.Thread.run(Thread.java:738)

RESOLVING THE PROBLEM
Manually migrate MWM :
1) Login to Impact 6.1.1 go to MWM project , then go to Data Model panel. 

2) Check the configuration in ImpactDB data source. Update accordingly. Derby database connection : default username is impact and default password is derbypass. 

3) Go to the Service section and you can start and stop the database using the server ImpactDatabase.