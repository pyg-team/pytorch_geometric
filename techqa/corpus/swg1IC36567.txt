Title: IBM IC36567: CLIENT "QUIET" OPTION, ANS1311E AND ANS1183E. WINDOWS ACTIVE DIRECTORY SERVICE IS LEFT IN LOCKED STATE. - United States

Text:
AIX SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  TSM client Backup fails when client option "Quiet" is specified
   and the TSM server runs out of data storage space.  When this
   happens the Windows Active Directory service is left in locked
   state and eventually hangs the Windows system due to the
   Windows system disk becoming full.
   
   Steps to recreate:
   on TSM server
   .define stgpool smallpool disk descr="10 MB"
   .define volume smallpool N:\TSMData\Server421\disk2.dsm f=9
   .def mgmt standard standard Smallmgmt
   .def copygroup standard standard smallmgmt dest=smallpool
   .activ poli standard standard
   on client
   .add to dsm.opt
    QUIET
    Include.SystemObject ALL smallmgmt
   .issue "dsmc backup activedirectory"
   
   Result:
   ---------------------------------------------------------------
   tsm> backup activedirectory
   ANS1228E Sending of object '\\maibock\e$\WINNT\NTDS\NTDS.DIT'
   failed
   ANS1311E Server out of data storage space
   
   ANS1804E Selective Backup processing of 'Windows NT Directory
   Services' finished with failures.
   
   ---------------------------------------------------------------
   ANS1228E Sending of object '\\maibock\e$\WINNT\NTDS\NTDS.DIT'
   failed
   ANS1311E Server out of data storage space
   ANS1183E An unknown error occurred while processing system
   object 'Windows NT Directory Services': MS API function
   'DsBackupPrepare' failed with error -939523586 (0xc80001fe)
   ANS1005E TCP/IP read error on socket = 964, errno = 10054,
   reason : 'An existing connection was forcibly closed by the
   remote host.'.
   ANS1804E Selective Backup processing of 'Windows NT Directory
   Services' finished with failures.
   ---------------------------------------------------------------
   The Windows error code (0xc80001fe) means "unable to write to
   the log file." From Microsoft Visual Studio "EDBMSG.h":
   #define hrLogWriteFail               ((HRESULT)0xC80001FEL)
   ---------------------------------------------------------------
   The Active Directory service is left in a locked state and the
   'e:\winnt\ntds' directory is filled the transaction logs (each
   10 MB in size). Then the Windows server must be recovered in
   Active Directory Restore Mode.
   
   To recover:
   . start in AD restore mode
   . delete all EDB*.log transaction logs
   . start ntdsutil.exe
   . type 'authoritative restore' and then press ENTER
   . type 'restore database', press ENTER, click OK, and then click
   Yes
   
   
    
   
   

LOCAL FIX
 *  Do not use the TSM client option "QUIET".
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: TSM client versions 5.1 and 5.2 running on   *
   *                 Windows and backing up Active Directory.     *
   ****************************************************************
   * PROBLEM DESCRIPTION: SEE ERROR DESCRIPTION                   *
   ****************************************************************
   * RECOMMENDATION: Apply fixing PTF when available.             *
   ****************************************************************
   The TSM client communicates with the Active Directory service in
   order to back up the Active Directory. TSM backs up the Active
   Directory database (ntds.dit), the checkpoint file (edb.chk) and
   transaction log files (edb*.log). The transaction log files are
   generated by Active Directory during backup.
   
   When TSM has finished backing up the transaction log files or
   when an error occurs, TSM should delete those log files. But
   when "ANS1311E Server out of data storage space" error occurs
   while backing up the Active Directory ntds.dit or edb*.log
   (transaction log) files, TSM goes into a loop and doesn't delete
   the transaction log files. Those files fill up all free space on
   the disk and TSM fails with these errors:
   
   1. ANS1311E Server out of data storage space
   
   2. code 0xc80001fe(in dsmerror.log)-unable to write to the log
      file.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The client code has been changed so that if "ANS1311E Server out
   of data storage space" error occurs backing up the ntds.dit or
   ntds.dit file, the client will delete the transaction log files
   and notify the Active Directory service that the backup has
   ended.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC36567
   
   
 * REPORTED COMPONENT NAME
   TSM CLIENT 5.1
   
   
 * REPORTED COMPONENT ID
   5698ISMCL
   
   
 * REPORTED RELEASE
   52W
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2003-06-23
   
   
 * CLOSED DATE
   2003-09-18
   
   
 * LAST MODIFIED DATE
   2003-09-18
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  DSM      DSMC     DSMCSVC
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TSM CLIENT 5.1
   
   
 * FIXED COMPONENT ID
   5698ISMCL
   
   

APPLICABLE COMPONENT LEVELS
 * R52W PSY
   UP