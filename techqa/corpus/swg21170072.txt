Title: IBM Mapping a CMP EJB against a table without a primary key - United States

Text:
WSAD; v5; Primary Key; PK; no primary key; bottom-up; CMP; EJB; meet-in-the-middle; bottom up; meet in the middle; map; mapping; CHKJ2829E; 1170072 TECHNOTE (FAQ)

QUESTION
 Can a table be mapped to a CMP EJB in WebSphereÂ® Studio Application Developer, if you do a bottom-up mapping against a set of tables, one of which has no primary key (PK)? 

CAUSE
Attempts to perform a bottom-up mapping against a set of tables, one of which has no primary key (PK) can result in the map failing on the table without a PK.


Error:
CHKJ2829E: Key class NopktableKey does not map to any fields in enterprise bean Nopktable. (EJB 2.0: 10.8, 22.5)


ANSWER
It is not possible to completely map a CMP EJB against a Table without a Primary Key (PK). In particular, it is not possible to do a complete bottom-up mapping, as the tooling would not know which EJB attribute is the PK. The EJB tooling allows the user to complete a Bottom-up mapping, but the beans key class will be without a PK and show an error similar to: 


CHKJ2829E: Key class NopktableKey does not map to any fields in enterprise bean Nopktable. (EJB 2.0: 10.8, 22.5)

Manually adding a key field to the EJB attribute and changing the corresponding column to a PK is then required. A meet-in-the-middle mapping does not allow mapping a "key" EJB attribute to a non-PK column. 

A PK EJB attribute is needed to identify a table row associated with a CMP EJB instance. A PK needs to be defined in the tools to signify the key column needed for query generation. Using a meet-in-the middle mapping, you can map your EJB PK attribute against some column in a table that is unique, even if it is not flagged as a PK in the actual database. 

Using the Table editor, right click on table of interest within the EJB Mapping editor and you can make a column into a PK. A relational database table does not need to have an official PK, just a unique column to be useful. In the EJB tooling you are telling the query generation what column or columns to search on for look-ups, so the column should be unique.

Given the work involved in mapping to a table without a PK, consider making the unique column on the database table a PK if permissible on your database. This would guarantee that it is unique.









Cross Reference information Segment Product Component Platform Version Edition Software Development Rational Application Developer for WebSphere Software Windows, Linux 6.0, 6.0.0.1, 6.0.1, 6.0.1.1, 6.0.1.2, 7.0, 7.0.0.1, 7.0.0.2, 7.0.0.3, 7.0.0.4, 7.0.0.5, 7.0.0.6