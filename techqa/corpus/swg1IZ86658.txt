Title: IBM IZ86658: Improved handling of errors in iconv() call: avoid SIGSEGV      (XC130003) in amqrmppa processes. - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0 Fix Pack 7.0.1.5 [http://www-01.ibm.com/support/docview.wss?uid=swg24029055]
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.5 [http://www-01.ibm.com/support/docview.wss?uid=swg24029788]
WebSphere MQ V6.0 Fix Pack 6.0.2.11 [http://www-01.ibm.com/support/docview.wss?uid=swg24029382]
WebSphere MQ V6.0 for iSeries Fix Pack 6.0.2.11 [http://www-01.ibm.com/support/docview.wss?uid=swg24029383]
WebSphere MQ 6.0 for HP OpenVMS Alpha and Itanium - Fix Pack 6.0.2.11 (FP 04) [http://www-01.ibm.com/support/docview.wss?uid=swg24032452]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When an error occurs in iconv() call on AIX, the WebSphere MQ
   amqrmppa channel process can fail with SIGSEGV conditions
   (XC130003) or "private memory errors".
   
   Secondarily this results in failures of other channels
   besides the ones directly affected by the iconv error.
   
   The runmqsc command DISPLAY CHSTATUS(*)  may also hang.
   
   The following is typical information from the XC130003 FDC
   record.
   
   Operating System  :- AIX 5.3
   Probe Id          :- XC130003
   Component         :- xehExceptionHandler
   Program Name      :- amqrmppa
   Probe Type        :- HALT6109
   Probe Description :- AMQ6109: An internal WebSphere MQ error
   has occurred.
   Arith1            :- 11 (0xb)
   Comment1          :- SIGSEGV: address not mapped(110231000)
   
   MQM Function Stack
   zstAsyncConsumeThread
   zstAsyncConsume
   vpiConvertData
   vwaConvert
   vwb_string
   vxtConvertCharsFn
   xcsConvertString
   xcsFFST
   
   The following is typical information from the "private memory
   error" FDCs that were seen:
   
   Probe Id          :- XC006001
   Component         :- xcsFreeMemFn
   Program Name      :- amqrmppa
   Major Errorcode   :- xecS_I_PRIVATE_MEMORY_ERROR
   
   MQM Function Stack
   zstAsyncConsumeThread
   zstAsyncConsume
   vpiConvertData
   xcsFreeMemFn
   xcsFFST
   
   And:
   
   Probe Id          :- ZS402066
   Component         :- zstAsyncConsume
   Program Name      :- amqrmppa
   Major Errorcode   :- xecS_I_PRIVATE_MEMORY_ERROR
   
   MQM Function Stack
   zstAsyncConsumeThread
   zstAsyncConsume
   xcsCheckMem
   xcsFFST
   
   
    
   
   

LOCAL FIX
 *  Apply fix to AIX OS or disable SHARECNV feature of MQ channels.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   Users of WebSphere MQ on AIX.
   
   Platforms affected:
   AIX
   
   ****************************************************************
   PROBLEM SUMMARY:
   The iconv subroutine on AIX can give an incorrect output in its
   OutBytesLeft parameter.  This should be a positive number, but
   occasions have been seen when it contained a negative number.
   
   This is an incorrect output from the iconv subroutine.  The
   problem is fixed in AIX APARs separate from this APAR.
   
   After the incorrect return from iconv(), WebSphere MQ makes data
   length calculations using the incorrect number.  This then leads
   to memory errors of various types - for example: SIGSEGV
   exceptions, and
   "private memory errors".
   
   
    
   
   

PROBLEM CONCLUSION
 *  The primary fix to the iconv subroutine should be obtained from
   AIX.
   
   However, WebSphere MQ code is changed too, to protect better
   against such a condition on a system where iconv has not been
   patched.
   
   In this APAR, after an incorrect return from iconv(), WebSphere
   MQ now makes better checks on the parameters it uses for its
   data length calculations.  Accordingly, similar failures in
   iconv would not now cause such a severe failure in the amqrmppa
   process.  The channel directly affected would still suffer an
   error, but the other channels in the amqrmppa process would not
   suffer errors.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v7.0
   Platform           Fix Pack 7.0.1.5
   --------           --------------------
   AIX                U839183
   
                      v6.0
   Platform           Fix Pack 6.0.2.11
   --------           --------------------
   AIX                tbc_p600_0_2_11
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ86658
   
   
 * REPORTED COMPONENT NAME
   WMQ AIX V7
   
   
 * REPORTED COMPONENT ID
   5724H7221
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-10-14
   
   
 * CLOSED DATE
   2010-11-18
   
   
 * LAST MODIFIED DATE
   2010-11-18
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ AIX V7
   
   
 * FIXED COMPONENT ID
   5724H7221
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP