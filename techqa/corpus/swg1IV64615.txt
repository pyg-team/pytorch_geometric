Title: IBM IV64615: SUA import fail after upgrading by running "Upgrade to Software Use Analysis 9.1." fixlet - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When customers do the upgrade to "Software Use
   Analysis 9.1 application update 9.0.1"
   from the following versions: Software Use Analysis 9.0 and
   Software
   UseAnalysis 9.1", (In this case, during the SUA upgrade
   to"9.1-9.0.1.0-20140804-1738" from "9.1.20140604-1739"),
   it is recommended customers to upgrade using the fixlet "Upgrade
   to
   Software Use Analysis 9.1."
   
   This following error came after the "Upgrade to Software Use
   Analysis 9.1." fixlet has completed its
   run successfully. When the SUA portal is launched, the page
   displayed a button to update
   the schema. After the button was clicked, the page was
   redirected to an error page.
   
   At that point in time, java process for SUA and DB2 are still
   running.
   There is no restart of any component.
   
   The following error message was noticed in the tema.log.
   
   Started GET "/sam" for 10.18.214.196 at 2014-09-04 07:59:36
   +0000
   
   [9/4/14 7:59:36:897 UTC] 0000003b com.ibm.ws.webcontainer.webapp
   I SRVE0292I: Servlet Message - [tema]:.[FATAL]
   ActionController::RoutingError (uninitialized constant
   SAM::OverviewController):
     org/jruby/RubyModule.java:2690:in `const_missing'
   
   gems/gems/activesupport-3.0.20/lib/active_support/inflector/meth
   ods.rb:1
   24:in `constantize'
     org/jruby/RubyArray.java:1613:in `each'
   :: ::
   gems/gems/rack-1.2.8/lib/rack/runtime.rb:17:in `call'
   
   gems/gems/actionpack-3.0.20/lib/action_dispatch/middleware/stati
   c.rb:30:
   in `call'
     gems/gems/railties-3.0.20/lib/rails/application.rb:168:in
   `call'
     classpath:/rack/handler/servlet.rb:22:in `call'
   
   [9/4/14 8:01:56:593 UTC] 00000027 com.ibm.ws.webcontainer.webapp
                          I SRVE0292I: Servlet Message -
   [tema]:.[ERROR]
   Java::ComIbmDb2JccAm::SqlIntegrityConstraintViolationException:
   Assignment of a NULL value to a NOT NULL column
   "CLASS_NAME_TYPE" is not
    allowed.. SQLCODE=-407, SQLSTATE=23502, DRIVER=4.17.28: ALTER
   TABLE
   SAM.CATALOG_AUDIT_DETAILS ALTER COLUMN CLASS_NAME_TYPE SET NOT
   NULL
   
   [9/4/14 8:01:56:713 UTC] 00000027 com.ibm.ws.webcontainer.webapp
   I SRVE0292I: Servlet Message - [tema]:.[FATAL]
   Sequel::NotNullConstraintViolation
   (Java::ComIbmDb2JccAm::SqlIntegrityConstraintViolationException:
   Assignment of a NULL value to a NOT NULL column
   "CLASS_NAME_TYPE" is not
   allowed.. SQLCODE=-407, SQLSTATE=23502, DRIVER=4.17.28):
     com.ibm.db2.jcc.am.fd.a(com/ibm/db2/jcc/am/fd.java:743)
   :: ::
   com.ibm.ws.threading.internal.Worker.executeWork(com/ibm/ws/thre
   ading/in
   ternal/Worker.java:439)
   
   com.ibm.ws.threading.internal.Worker.run(com/ibm/ws/threading/in
   ternal/W
   orker.java:421)
     java.lang.Thread.run(java/lang/Thread.java:795)
   
   [9/4/14 8:02:54:358 UTC] 00000027 com.ibm.ws.webcontainer.webapp
                          I SRVE0292I: Servlet Message -
   [tema]:.[FATAL]
   ActionController::RoutingError (No route matches "/sa,"):
   
   
   gems/gems/actionpack-3.0.20/lib/action_dispatch/middleware/show_
   exceptio
   ns.rb:53:in `call'
     gems/gems/railties-3.0.20/lib/rails/rack/logger.rb:13:in
   `call'
     gems/gems/rack-1.2.8/lib/rack/runtime.rb:17:in `call'
   
   gems/gems/actionpack-3.0.20/lib/action_dispatch/middleware/stati
   c.rb:30:
   in `call'
     gems/gems/railties-3.0.20/lib/rails/application.rb:168:in
   `call'
     classpath:/rack/handler/servlet.rb:22:in `call'
   
   
    
   
   

LOCAL FIX
 *  We managed to workaround and complete the data schema update by
   modifying the below two scripts.
   
   1. schema.rb in
   /opt/IBM/SUA/wlp/usr/servers/servers1/apps/tema.war/WEB-INF/sequ
   el/extensions
   
   line 52 change  sq << "create trigger
   #{quote_schema_table(trigger_name)}" to sq << "create or replace
   trigger #{quote_schema_table(trigger_name)}"
   
   2. 1404282251_merging_catalog_audits_tables.rb in
   /opt/IBM/SUA/wlp/usr/servers/server1/apps/team.war/WEB-INF/domai
   ns/sam/db/migrate
   
   line 7   change  add_column(:class_name_type, :smallint, {:null
   => true } to add_column(:class_name_type, :smallint, {:null =>
   true :default => 0})
   
   Please escalate this to Development Team to fix this as this may
   potentially affect customer who may want to perform the SUA
   upgrade.
   
   After upgrading SUA to the latest version, the SUA import now is
   successful.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * After you upgrade to a newer version of Software Use Analysis
   * by using a fixlet, update of the database schema and import
   * of the scan data fail.
   * EXPECTED RESULTS:
   * Update of the database schema and import of the scan data
   * succeed.
   ****************************************************************
   * RECOMMENDATION: Apply appropriate update when available.
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  The fix for this APAR is contained in the following maintenance
   packages:
    | Update | SUA 9.0.1.1
    | Update | ILMT 9.0.1.1
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV64615
   
   
 * REPORTED COMPONENT NAME
   IEM SW USE ANL
   
   
 * REPORTED COMPONENT ID
   5725F57MT
   
   
 * REPORTED RELEASE
   910
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2014-09-07
   
   
 * CLOSED DATE
   2014-11-04
   
   
 * LAST MODIFIED DATE
   2014-11-04
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IEM SW USE ANL
   
   
 * FIXED COMPONENT ID
   5725F57MT
   
   

APPLICABLE COMPONENT LEVELS
 * R900 PSY
   UP
   
   
 * R910 PSY
   UP