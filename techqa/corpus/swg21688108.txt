Title: IBM Why does my stored procedure fail with SQL0551N on function SYSIBM.SQLCAMESSAGECCSID ? - United States

Text:
SQL0551N; SQLCAMESSAGECCSID; retrieveMessagesFromServerOnGetMessage; SQLException.getMessage TECHNOTE (FAQ)

QUESTION
 Why does my stored procedure fail with SQL0551N on function SYSIBM.SQLCAMESSAGECCSID ? 

ANSWER
SYSIBM.SQLCAMESSAGECCSID is a built-in DB2 function that will return the SQL error code's description back to JDBC. If the JDBC property 'retrieveMessagesFromServerOnGetMessage' is set to true, then JDBC operation SQLException.getMessage will call this stored procedure implicitly, to display the error description along with the error code. 
Stored Procedures may fail with:
Caused by: java.sql.SQLException: <USERNAME>;EXECUTE;SYSIBM.SQLCAMESSAGECCSIDDSRA0010E: SQL State = 42501, Error Code = -551

This error implies that the user <USERNAME> does not have EXECUTE privilege on SYSIBM.SQLCAMESSAGECCSID. 

You can check the permission on SYSIBM.SQLCAMESSAGECCSID by running the following select statement:

db2 "SELECT SUBSTR(AUTHID,1,30) AS AUTHID, AUTHIDTYPE, PRIVILEGE,SUBSTR(OBJECTNAME,1,30) AS OBJECTNAME, SUBSTR(OBJECTSCHEMA,1,30) AS OBJECTSCHEMA FROM SYSIBMADM.PRIVILEGES WHERE OBJECTSCHEMA = 'SYSIBM' and OBJECTNAME ='SQLCAMESSAGECCSID'"

Example:
$ db2 "SELECT SUBSTR(AUTHID,1,30) AS AUTHID, AUTHIDTYPE, PRIVILEGE,SUBSTR(OBJECTNAME,1,30) AS OBJECTNAME, SUBSTR(OBJECTSCHEMA,1,30) AS OBJECTSCHEMA FROM SYSIBMADM.PRIVILEGES WHERE OBJECTSCHEMA = 'SYSIBM' and OBJECTNAME ='SQLCAMESSAGECCSID'"

AUTHID AUTHIDTYPE PRIVILEGE OBJECTNAME OBJECTSCHEMA 
---------- ---------- ----------- --------------------- -------------
PUBLIC G EXECUTE SQLCAMESSAGECCSID SYSIBM

1 record(s) selected.

To resolve this issue, grant EXECUTE privilege to user <USERNAME>. 

Please note that if your database was created with the 'Restrictive' clause, then PUBLIC will not have 'EXECUTE' permissions on this function. 

RELATED INFORMATION
 Securing the system catalog view [http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.db2.luw.admin.sec.doc/doc/t0005824.html?lang=en]
SQL0551N [http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.db2.luw.messages.sql.doc/doc/msql00551n.html]