Title: IBM PK58426: HWSSSL00E UNABLE TO SET TO NON-BLOCKING, RC=-1 : N/A ... AND HWSP1415E TCP/IP SOCKET FUNCTION CALL FAILED: F=CLOSE - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Customer gets the following messages:
   HWSSSL00E UNABLE TO SET TO NON-BLOCKING, RC=-1 : N/A ...
   followed by
   HWSP1415E TCP/IP SOCKET FUNCTION CALL FAILED; F=CLOSE   , R=-1,
   E=113, M=SDDS
   *
   Customer has defined his SSL port as SHAREPORT in TCP/IP.
   In fact this problem only happens if the port is defined as
   SHAREPORT.
   After IMS Connect comes up but before communication with TCP/IP
   has started, Customer issues an OPENPORT for his SSL port.
   Due to timing, this results in the SSL port being started TWICE.
   In fact a review of the traces shows that we actually have 2
   TCBs attached for the port and we have issued 2 Listen requests
   and we have 2 outstanding ACCEPT calls.
   This causes the wrong socket descriptor being passed to TCP/IP.
   After a client connects on an SSL socket and before we do the
   handshake, IMS Connect attempts to set the socket to
   Non-Blocking mode via the IOCTL call.
   This call fails with a rc = -1.
   Since IMS Connect does not put out the errno, OMVS ctrace
   was collected and it showed a rv = x'71' which indicates that
   the File descriptor is incorrect.
   After IMS Connect gets the Unable to set to Non-blocking, it
   then attempts to close the socket and that too fails with X'71'
   or decimal 113.
   Here's the message:
   HWSP1415E TCP/IP SOCKET FUNCTION CALL FAILED; F=CLOSE   , R=-1,
   E=113, M=SDDS
   So the window needs to be fixed where its possible to start the
   same port more than once and also IMS Connect needs to display
   the Errno in the HWSSSL00E UNABLE TO SET TO NON-BLOCKING msg
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All IMS V9 IMS Connect users using           *
   *                 TCP/IP Shareport                             *
   ****************************************************************
   * PROBLEM DESCRIPTION: IMS Connect can open a PORT twice       *
   *                      when TCP/IP Shareport is used and       *
   *                      an OPENPORT command is issued before    *
   *                      initialization is complete.             *
   *                      IMS Connect with SSL can result in:     *
   *                      HWSSSL00E UNABLE TO SET TO NON-BLOCKING *
   *                      An ABEND0C4 in HWSSTRM0 can also occur. *
   ****************************************************************
   * RECOMMENDATION: INSTALL CORRECTIVE SERVICE FOR APAR/PTF      *
   ****************************************************************
   When the PORT is defined to TCP/IP as Shareport and an
   OPENPORT command is issued before PORT initialization
   has completed, then IMS Connect will open the PORT twice
   and attach a TCB for each instance.  With SSL this can
   result in HWSSSL00E UNABLE TO SET TO NON-BLOCKING.
   ABEND0C4 in HWSSTRM0 can also occur.
   
   Additional keywords: MSGHWSC0114W RC04 MSGHWSSSL00E ABENDS0C4
   
   
    
   
   

PROBLEM CONCLUSION
 *  AIDS: RIDS/SYS RIDS/CNTRL SYS CNTRL
     GEN:
   
   *** END IMS KEYWORDS ***
   A new flag SCT_FG_PORTINIT is set at startup to indicate
   PORT initialization is in progress.  Command processing
   will reject PORT modification commands while the flag is set.
   When PORT initialization has completed the flag is turned off.
   Modules Changed:
   HWSXCFG0 - set SCT_FG_PORTINIT at startup
   HWSSXCM0 - test flag for PORT modify commands and
              reject them when on with msgHWSC0114W
       HWSC0114W COMMAND=OPENPORT FAILED; R=4, S=PORTINIT, M=CVBC
   HWSSOCC0 - turn off flag when PORT initialization completes
   
   Documentation Change:
   *--------------------------------------*
    IMS V9 IMS Connect Guide and Reference
   *--------------------------------------*
   update message HWSC0114W:
   Service Code: PORTINIT
   Short Explanation: The command is rejected since PORT
                      initialization is still in progress.
   Return Code: 4
   Meaning: This is a processing error.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK58426
   
   
 * REPORTED COMPONENT NAME
   IMS V9
   
   
 * REPORTED COMPONENT ID
   5655J3800
   
   
 * REPORTED RELEASE
   900
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2007-12-18
   
   
 * CLOSED DATE
   2008-04-03
   
   
 * LAST MODIFIED DATE
   2008-10-23
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PK62726 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK62726] UK35224
   
   

MODULES/MACROS
 *  HWSHSCT  HWSSOCC0 HWSSXCM0 HWSXCFG0
   
   
    
   
   

Publications Referenced SC18928702 FIX INFORMATION
 * FIXED COMPONENT NAME
   IMS V9
   
   
 * FIXED COMPONENT ID
   5655J3800
   
   

APPLICABLE COMPONENT LEVELS
 * R900 PSY UK35224
   UP08/04/11 P F804