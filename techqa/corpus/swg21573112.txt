Title: IBM Migration fails during upgrade-profile task.  Portal is unable to start with a 'initialization of service failed' exception. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
During the migration process, the upgrade-profile task fails at the deploy-apps subtask. 

SYMPTOM
Portal server is unable to start successfully after upgrade-profile task fails.


DIAGNOSING THE PROBLEM
When reviewing the ConfigTrace.log, we see the failure occur on the deploy-apps subtask:


Target started: deploy-apps
action-modify-HTTP-Inbound-Channel-timeout:
Target finished: action-modify-HTTP-Inbound-Channel-timeout
[xmlaccess] EJPXB0006I: Connecting to URL localhost:10039/wps/config/
[xmlaccess] EJPXB0004I: Writing output file C:\IBM\WebSphere\wp_profile\ConfigEngine\config\work\deployedWebAppXmlAccess-PTF\preExistingWebApps.xml
[xmlaccess] EJPXB0002I: Reading input file C:\IBM\WEBSPH~2\PORTAL~1\installer\wp.migration.core\migration\components\wp.migration.core\exportWebApps.xml
[xmlaccess] EJPXB0019E: Server response indicates an error. For status and details of the XmlAccess error look at file C:\IBM\WebSphere\wp_profile\ConfigEngine\config\work\deployedWebAppXmlAccess-PTF\preExistingWebApps.xml.

When reviewing the SystemOut.log we see the WPS fails to start:

[11/19/11 3:22:51:528 CST] 0000000a Servlet E com.ibm.wps.engine.Servlet init EJPFD0016E: Initialization of service failed.
java.lang.NullPointerException
at
com.ibm.wps.services.vpmapping.VirtualPortalIdentificationServiceImpl.loadDefaultVPID(VirtualPortalIdentificationServiceImpl.java:194)
at
com.ibm.wps.services.vpmapping.VirtualPortalIdentificationServiceImpl.getVirtualPortalID(VirtualPortalIdentificationServiceImpl.java:99)

The migration process exports data from the tables, recreates the tables, and imports the data back into it. This exception indicates that the tables in the release domain are empty. This can be confirmed by checking specific tables, like release.VP_DESC, the table existed but was empty.

Looking further into the ConfigTrace.log and specifically at the create-schema subtask, the following exception occurred multiple times:

[java] com.ibm.db2.jcc.c.SqlException: DB2 SQL error: SQLCODE: -443,
SQLSTATE: 38553, SQLERRMC: SYSIBM.SQLTABLES;TABLES;SYSIBM:CLI:-805
[java] at com.ibm.db2.jcc.c.qh.b(qh.java:1378)
[java] at com.ibm.db2.jcc.c.qh.c(qh.java:1365)

This would indicate that the export of the db domain tables failed.

The create-schema subtask will export the tables, then drops and creates the tables. It then tries to import the tables, but because the export failed, the import will have nothing to import, and thus we have empty tables.


RESOLVING THE PROBLEM
The reason the export of the tables failed is due to unbound database domains. The common issue is that DB2 gets upgraded but the existing databases do not get rebinded. 

To resolve the problem, perform the following steps on each database in your DB2 instance: 

===========================
db2 connect to [database name] user [username] using [password]
db2 bind @db2cli.lst blocking all grant public sqlerror continue action
replace
db2 bind @db2ubind.lst blocking all grant public sqlerror continue
action replace
db2 bind db2schema.bnd blocking all grant public sqlerror continue
action replace
db2 connect reset
db2 terminate
=========================

Note: The db2cli.list, db2ubind.lst, and db2schema.bnd files are located in the sqllib/bnd directory. You may need to execute these commands from that directory.