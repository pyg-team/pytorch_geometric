Title: IBM The number of JDBC connections from Information Server keep on increasing - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The number of JDBC connections from Information Server are not getting cleaned up in the XMETA schema. This leads to recycling the database that xmeta is on, in order to keep the number of sessions below the limit established by the RDBMS. 

SYMPTOM
For example, using Oracle as the XMETA repository, it was observed that the number of v$session and v$process would steadily increase over time. 

Current limits:
SQL> sho parameter sessions
NAME TYPE VALUE
--------- ----------- -----
sessions integer 1655

SQL> sho parameter processes
NAME TYPE VALUE
--------- ----------- -----
processes integer 1500

Snapshot of number of v$session and v$process over time:
Time 0:
SQL> select count(*) from v$session;
COUNT(*)
----------
97

SQL> select count(*) from v$process;
COUNT(*)
----------
1454

Time 1:
SQL> select count(*) from v$session;
COUNT(*)
----------
123

SQL> select count(*) from v$process;
COUNT(*)
----------
1480

Time 2:
SQL> select count(*) from v$session;
COUNT(*)
----------
143

SQL> select count(*) from v$process;
COUNT(*)
----------
1500

At Time 2, the limit for processes is reached resulting in connection failures.



CAUSE
There are many causes for this, however, given the following information: 

1) Problem is seen in the XMETA JDBC connections
2) Metadata Repository Tier (RDBMS) is located on a different server to the Services Tier (WebSphere Application Server)
3) There exists a firewall between the Metadata Repository Tier and the Services Tier

Looking at the above, we can concentrate on the networking side of thing. We found the following:
1) The default timeout values for idle connections on the Firewall is 3600 seconds
2) The default settings for Connection Pools in WebSphere Application Server were as follows:
Connection timeout : 180 seconds
Maximum connections: 100 connections
Minimum connections: 1 connections
Keep time: 180 seconds
Unused timeout: 1800 seconds
Aged timeout: 7200 seconds

Note that the Aged timeout is set to 7200 seconds and that the number of minimum connections is 1.

The firewall will break any connection that has been idle for 3600 seconds.



DIAGNOSING THE PROBLEM
Periodically check the number of connections 

 * Determine the software that is involved when connecting from the Services Tier to the MetaData Repository Tier 
 * Check the configuration of all the software involved 
 * If possible establish a connection log or trace using the software's diagnostic gathering capability.

RESOLVING THE PROBLEM
From the diagnostic information gathered, it was determined that the Firewall software was terminating connections that were idle for 3600 seconds. 

To ensure that the firewall does not break an idle connection unnecessarily, the following can be done: 

 * Ensure that the WebSphere Application Server's Connection Pool timeouts match or a lower than that of the firewall's setting. Alternatively, change Firewall's idle connection timeout value matches that of the Aged Timeout in WebSphere Application Server. 
 * Ensure that WebSphere Application Server's Connection Pool has no idle connections. This can be achieved by setting the Minimum Connections to 0.

RELATED INFORMATION
 WebSphere Application Server Connection pool settings [https://www.ibm.com/support/knowledgecenter/ssw_i5_54/rzamy/50/admin/help/udat_conpoolset.html]
Session Monitor facilitates earlier detection of idle c [http://www.ibm.com/support/docview.wss?rs=14&uid=swg21402667]