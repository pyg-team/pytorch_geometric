Title: IBM IT07006: NULLPOINTER EXCEPTION OCCURS WHEN EXECUTING A BATCH CONTAINING AN SQL WITH A 'INSERT FROM SELECT CLAUSE' - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A NullPointerException occurs when the following conditions are
   met :
   1. an SQL that has a 'INSERT FROM SELECT' structure is executed
   in a batch
   2. The 'enableMultiRowInsertSupport' driver property is 'true'
   (this is also the default)
   2. the 'sendDataAsIs' property is 'true'
   3. the target server supports multi-row insert
   
   In this scenario, the IBM Data Server Driver for JDBC and SQLJ
   attempts to submit the batch initially as a multi-row insert
   operation. However, the server reports a failure to process an
   SQL with a INSERT FROM SELECT form as a multi-row insert
   operation. The driver tries to handle the error by resubmitting
   the batch as a non multi-row insert operation. This retry
   suffers a NullPointerException when 'sendDataAsIs' is true due
   to a driver bug.
   
   The following exceptions in the driver traces show the symptom
   associated with this defect just before the NullPointerException
   occurs:
   
   [jcc][Thread:main][SQLException@68a6bcec] java.sql.SQLException
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1] DB2
   SQLCA from server
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlCode        = -20186
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlErrd        = { -130, 0, 0, -1, 0, 0 }
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlErrmc       = null
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlErrmcTokens = {}
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlErrp        = DSNXEDS1
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlState       = 07501
   [jcc][Thread:main][SQLException@68a6bcec][Sqlca@1abd5fa1]
   SqlWarn        =
   [jcc][Thread:main][SQLException@68a6bcec] SQL state  = 07501
   [jcc][Thread:main][SQLException@68a6bcec] Error code = -20186
   [jcc][Thread:main][SQLException@68a6bcec] Tokens     = null
   [jcc][Thread:main][SQLException@68a6bcec] Stack trace follows
   com.ibm.db2.jcc.am.SqlException: DB2 SQL Error: SQLCODE=-20186,
   SQLSTATE=07501, SQLERRMC=null, DRIVER=3.64.82
           at com.ibm.db2.jcc.am.bd.a(bd.java:682)
           at com.ibm.db2.jcc.am.bd.a(bd.java:60)
           at com.ibm.db2.jcc.am.bd.a(bd.java:127)
           at com.ibm.db2.jcc.am.io.c(io.java:2704)
           at com.ibm.db2.jcc.am.io.d(io.java:2692)
           at com.ibm.db2.jcc.am.io.a(io.java:2141)
           at com.ibm.db2.jcc.am.jo.a(jo.java:7323)
           at com.ibm.db2.jcc.t4.ab.h(ab.java:141)
           at com.ibm.db2.jcc.t4.ab.e(ab.java:77)
           at com.ibm.db2.jcc.t4.p.d(p.java:63)
           at com.ibm.db2.jcc.t4.qb.l(qb.java:170)
           at com.ibm.db2.jcc.am.io.hb(io.java:2136)
           at com.ibm.db2.jcc.am.jo.a(jo.java:5502)
           at com.ibm.db2.jcc.am.jo.a(jo.java:4932)
           at com.ibm.db2.jcc.am.jo.c(jo.java:4595)
           at com.ibm.db2.jcc.am.jo.executeBatch(jo.java:2891)
           at FehlerAusloesen.main(FehlerAusloesen.java:31)
   [jcc] END TRACE_DIAGNOSTICS
   [jcc] BEGIN TRACE_DIAGNOSTICS
   [jcc][Thread:main][SQLException@636d9fe1] java.sql.SQLException
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6] DB2
   SQLCA from server
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlCode        = -518
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlErrd        = { -280, 0, 0, -1, 0, 0 }
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlErrmc       = null
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlErrmcTokens = {}
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlErrp        = DSNXERT2
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlState       = 07003
   [jcc][Thread:main][SQLException@636d9fe1][Sqlca@321b9fc6]
   SqlWarn        =
   [jcc][Thread:main][SQLException@636d9fe1] SQL state  = 07003
   [jcc][Thread:main][SQLException@636d9fe1] Error code = -518
   [jcc][Thread:main][SQLException@636d9fe1] Tokens     = null
   [jcc][Thread:main][SQLException@636d9fe1] Stack trace follows
   com.ibm.db2.jcc.am.SqlException: THE EXECUTE STATEMENT DOES NOT
   IDENTIFY A VALID PREPARED STATEMENT
           at com.ibm.db2.jcc.am.bd.a(bd.java:682)
           at com.ibm.db2.jcc.am.bd.a(bd.java:60)
           at com.ibm.db2.jcc.am.bd.a(bd.java:127)
           at com.ibm.db2.jcc.t4.ab.a(ab.java:509)
           at com.ibm.db2.jcc.t4.ab.a(ab.java:70)
           at com.ibm.db2.jcc.t4.p.a(p.java:57)
           at com.ibm.db2.jcc.t4.rb.a(rb.java:225)
           at com.ibm.db2.jcc.am.jo.a(jo.java:3383)
           at com.ibm.db2.jcc.am.jo.a(jo.java:5526)
           at com.ibm.db2.jcc.am.jo.a(jo.java:4932)
           at com.ibm.db2.jcc.am.jo.c(jo.java:4595)
           at com.ibm.db2.jcc.am.jo.executeBatch(jo.java:2891)
           at FehlerAusloesen.main(FehlerAusloesen.java:31)
   [jcc] END TRACE_DIAGNOSTICS
   [jcc] BEGIN TRACE_DIAGNOSTICS
   [jcc][Thread:main][BatchUpdateException@2c761b38]
   java.sql.BatchUpdateException
   [jcc][Thread:main][BatchUpdateException@2c761b38] SQL state  =
   null
   [jcc][Thread:main][BatchUpdateException@2c761b38] Error code =
   -4229
   [jcc][Thread:main][BatchUpdateException@2c761b38] Message    =
   [jcc][t4][102][10040][3.64.82] Batchfehler. Der Batch wurde
   ﾁbergeben, jedoch ist mindestens eine Ausnahmebedingung bei
   einem Einzelelement im Batch aufgetreten.
   Verwenden Sie getNextException(), um die Ausnahmebedingungen fﾁr
   bestimmte Elemente im Batch abzurufen. ERRORCODE=-4229,
   SQLSTATE=null
   [jcc][Thread:main][BatchUpdateException@2c761b38] Update counts
   = { -3 }
   [jcc][Thread:main][BatchUpdateException@2c761b38] Stack trace
   follows
   com.ibm.db2.jcc.am.BatchUpdateException:
   [jcc][t4][102][10040][3.64.82] Batchfehler. Der Batch wurde
   ﾁbergeben, jedoch ist mindestens eine Ausnahmebedingung bei
   einem Einzelelement im Batch aufgetreten.
   Verwenden Sie getNextException(), um die Ausnahmebedingungen fﾁr
   bestimmte Elemente im Batch abzurufen. ERRORCODE=-4229,
   SQLSTATE=null
           at com.ibm.db2.jcc.am.bd.a(bd.java:407)
           at
   com.ibm.db2.jcc.am.Agent.endBatchedReadChain(Agent.java:399)
           at com.ibm.db2.jcc.am.jo.a(jo.java:4997)
           at com.ibm.db2.jcc.am.jo.c(jo.java:4595)
           at com.ibm.db2.jcc.am.jo.executeBatch(jo.java:2891)
           at FehlerAusloesen.main(FehlerAusloesen.java:31)
   [jcc] END TRACE_DIAGNOSTICS
   
   The exceptions with SQLCODEs -20186 and -518 followed by -4229
   are seen.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All users of IBM Data Server Driver for JDBC and SQLJ        *
   * shipped with DB2 10.1 releases earlier than DB2 10.1 Fixpack *
   * 5                                                            *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Refer error description                                      *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Upgrade to DB2 10.1 Fixpack 5                                *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Upgrade to DB2 10.1 Fixpack 5
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT07006
   
   
 * REPORTED COMPONENT NAME
   DB2 DATA SRVR D
   
   
 * REPORTED COMPONENT ID
   DB2DSDRVR
   
   
 * REPORTED RELEASE
   A10
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2015-02-12
   
   
 * CLOSED DATE
   2015-07-28
   
   
 * LAST MODIFIED DATE
   2015-07-28
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    IT07023
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 DATA SRVR D
   
   
 * FIXED COMPONENT ID
   DB2DSDRVR
   
   

APPLICABLE COMPONENT LEVELS
 * RA10 PSY
   UP