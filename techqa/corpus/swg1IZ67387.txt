Title: IBM IZ67387: DATABASE SUMMARY VIEW IS INCONSISTENT WITH WITH DETAIL VIEW - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Environment: Sybase Agent 06.20.01.05,
   OS: ANY
   
   Problem Description:
   
   When there is a database with status bit 64 set
   (master..sysdatabases &
   64
   equal to 64 ) which means database "recovery started for all
   databases
   to be recovered" in Sybase, the "Database Summary" view "Total
   DB in
   Error" column fails to count on it. But, in "Databaes Detail"
   view
   "Error
   Status" column displays it as "Yes", an error status.
   
   Detailed Recreation Procedure:
   You need to use a dummy table to re-create and verify the
   problem.
   
   
   1) Create a database name "userdb"
   
   disk init  name  = 'userdatadevice1',
   physname  = '/opt/sybase/data/userdatadevice1.dat',
   size  = '10M', dsync = true
   go
   
   disk init  name  = 'userlogdevice1',
   physname  = '/opt/sybase/data/userlogdevice1.dat',
   size  = '10M', dsync = true
   go
   
   CREATE DATABASE userdb
        ON userdatadevice1 = '10M' -- 5120 pages
    LOG ON userlogdevice1 = '10M' -- 5120 pages
    WITH OVERRIDE
   go
   
   use userdb
   go
   
   exec sp_changedbowner 'sa', true
   go
   
   exec master.dbo.sp_dboption userdb, 'select into/bulkcopy', true
   go
   
   checkpoint
   go
   
   /*create the dummy table named testSysDB*/
   select *  into userdb..testSysDB from master..sysdatabases
   
   /*Update it with error status*/
   update userdb..testSysDB set status=332 where name='userdb'
   update userdb..testSysDB set status=12 where name='sybsystemdb'
   update userdb..testSysDB set status=64 where
   name='sybsystemprocs'
   update userdb..testSysDB set status=8 where name='model'
   
   commit
   go
   
   2. Update cursor DBD3 to select data from userdb..testSysDB;
          insert_select
           SELECT
           .....
           into #dbd3
           FROM    userdb..testSysDB d3,
                   userdb..testSysDB d4,
                   userdb..testSysDB d5,
                   userdb..testSysDB d6,
                   userdb..testSysDB d7
           WHERE   (d4.dbid = d6.dbid and d4.dbid = d5.dbid and
                    d4.dbid = d7.dbid and d4.dbid = d3.dbid) and
                   ((d3.status &   32 =   32)
               or     (d3.status &  256 =  256)
               or     (d4.status & 1024 = 1024)
               or     (d5.status & 2048 = 2048)
               or     (d6.status & 4096 = 4096)
               or     (d7.status2 &    2 =    2))
   
   3. Update cursor cursor DBD1 to select data from
   userdb..testSysDB
   
          insert_select
                 SELECT DBNAME     = db.name,
    ......
                 FROM   userdb..testSysDB db;
   
   4. Restart the Sybase Agent
   cd $CANDLEHOME/bin
   ./CandleAgent stop oy
   ./CandleAgent start oy
   
   3. Go to ITM TEP, check the Sybase Server->Database, check the
   columns
   :Total DB in Error and Error Status
   
   
   Related Files and Output: N/A
   
   Approver: N/A
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  DATABASE SUMMARY VIEW IS INCONSISTENT WITH DETAIL VIEW
   
   
    
   
   

PROBLEM CONCLUSION
 *  When the database status bit 64 is set
   (master..sysdatabases &64 = 64 ), it means that the database
   status is "recovery started for all databases to be recovered".
   It fails to be counted in the "Total DB in Error" column in
   "Database Summary", but in the "Database Detail" view, the
   "Error Status" column is marked "Yes," which is an error status.
   
   6.2.0-TIV-ITM_SYB-IF0006 fixes this problem.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ67387
   
   
 * REPORTED COMPONENT NAME
   TIV MON SYBASE
   
   
 * REPORTED COMPONENT ID
   5724B96SO
   
   
 * REPORTED RELEASE
   620
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-12-28
   
   
 * CLOSED DATE
   2010-01-18
   
   
 * LAST MODIFIED DATE
   2010-01-18
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TIV MON SYBASE
   
   
 * FIXED COMPONENT ID
   5724B96SO
   
   

APPLICABLE COMPONENT LEVELS
 * R620 PSY
   UP