Title: IBM IZ15993: RGREQ -O MOVECANCEL DID NOT DELETE THE "MOVE IN PROGRESS" FLAG INTERNAL TO RECRM, THUS NO FURTHER MOVE ATTEMPTS WERE POSSIBLE - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Support Engineer: GBH
   Change Team Eng:  EJ
   
   
   Environment:
   SA MP v2.2.0.5   (AIX 5.3 TL7sp1, though should not be relevant)
   
   
   Problem:
   A "rgreq -o move <RG>" request failed for whatever reason. After
   the cause of the move problem was corrected, a subsequent move
   request was issued but prevented because SA MP still believed
   there was a move in progress :
   
   (runact-api) 2621-029 Request to move can not be granted as
   there is already a move request on the resource. rgreq: 2622-009
   An unexpected RMC error occurred.The RMC return code was 1.
   rgreq: 2622-463 request action on resource group failed with
   return code "1".
   
   samdiag -g <RG> showed the message:
    "Resource <RG> is being moved"
   
   An "rgreq -o movecancel <RG> was issued in an attempt to cancel
   the outstanding move request, but the following message
   resulted:
   
   (runact-api) 2621-027 There is no previous request from source
   [Operator]. Cancellation failed.
   rgreq: 2622-009 An unexpected RMC error occurred.The RMC return
   code was 1.
   rgreq: 2622-463 request action on resource group failed with
   return code "1".
   
   The only way to clear this problem was to kill the "master"
   IBM.RecoveryRMd process.
   
   So it appears that internal to IBM.RecoveryRM, a move request is
   still queued in some way. This outstanding move request is not
   shown in the lssam, lsrg, or lsrgreq output.
   
   The focus of this APAR is to add to the capability of the
   "movecancel" option so as to be able to delete the "move in
   progress" flag within IBM.RecoveryRM so that we don't have to
   resort to killing the master IBM.RecoveryRMd process.
   
   
    
   
   

LOCAL FIX
 *  Determine which node has the "master" IBM.RecoveryRM :
      lssrc -ls IBM.RecoveryRM |grep -i master
   
   On that node, determine the pid of the IBM.RecoveryRMd process:
      ps -ef |grep Recovery
   
   Kill the IBM.RecoveryRMd process using its pid:
      kill <pid>
   
   
    
   
   

PROBLEM SUMMARY
 *  A failing move request resulted in a situation,
   where
    a new move request has been rejected because
   of another
    move operation was in progress, while a
   movecancel
    request has been rejected, because of no move
   request
    to be canceled could be found.
    The issue was related to an internal flag,
   which had
    not been cleared after the first move, so the automation
    manager was still thinking that a move is in progress,
    while this was not the case. There was no other solution
    then to restart the automation manager (IBM.RecoveryRM)
    or the automation domain.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The handling of 'movecancel' requests has
   been modified to
    address this issue. Now a 'movecancel'
   request will not only
    cancel an existing move request, but also
   clear the internal
    flag that marks that a move is currently in
   progress.
    THE FIX WILL BE contained IN fixpack 6 of
   SYSTEM
    AUTOMATION for Multiplatforms 2.2.
   
   
    
   
   

TEMPORARY FIX
 *  Determine which node has the "master"
   IBM.RecoveryRM :
    lssrc -ls IBM.RecoveryRM |grep -i master
    On that node, determine the pid of the
   IBM.RecoveryRMd process:
    ps -ef |grep Recovery
    Kill the IBM.RecoveryRMd process using its pid:
    kill -9 <pid>
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ15993
   
   
 * REPORTED COMPONENT NAME
   SA MULTIPLATFOR
   
   
 * REPORTED COMPONENT ID
   5724M0000
   
   
 * REPORTED RELEASE
   220
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2008-02-20
   
   
 * CLOSED DATE
   2008-03-21
   
   
 * LAST MODIFIED DATE
   2008-03-21
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   SA MULTIPLATFOR
   
   
 * FIXED COMPONENT ID
   5724M0000
   
   

APPLICABLE COMPONENT LEVELS
 * R220 PSY
   UP