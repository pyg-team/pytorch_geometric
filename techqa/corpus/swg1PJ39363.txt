Title: IBM PJ39363: RE-USING VWSESSION WITH DIFFERENT JAAS SUBJECTS MAY RESULT IN A DEADLOCK - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  If VWSession is re-used in a pooled scenario, where the only the
   JAAS subject is changed with different user identities, there is
   a scenario where the VWSession call may result in a deadlock.
   
   Stack of the problem as logged by WebSphere, along with a thread
   dump:
   
   [8/11/11 9:17:23:537 CEST] 00000006 TimeoutManage I   WTRN0006W:
   Transaction
   00000131B7B2090B00000001002CEF5B68739A1AEB9983305669FE1ED4F87968
   B485EC2500000131B7B2090B00000001002CEF5B68739A1AEB9983305669FE1E
   D4F87968B485EC2500000001
   has timed out after 120 seconds.
   [8/11/11 9:17:23:538 CEST] 00000006 TimeoutManage I   WTRN0124I:
   When the timeout occurred the thread with which the transaction
   is, or was most recently, associated was Thread[WebContainer :
   12,5,main]. The stack trace of this thread when the timeout
   occurred was:
   1
   java.util.Collections$SynchronizedCollection.size(Collections.ja
   va:478)
   2     java.util.AbstractSet.equals(AbstractSet.java:57)
   3
   java.util.Collections$SynchronizedSet.equals(Collections.java:83
   1)
   4
   filenet.pe.peorb.client.JAASContext.equals(JAASContext.java:236)
   5
   filenet.pe.peorb.client.ORBSession.getJAASContext(ORBSession.jav
   a:620)
   6
   filenet.pe.peorb.client.ORBSession.checkTransientObjects(ORBSess
   ion.java:531)
   8
   filenet.pe.peorb.client.ORBSession.executeRPC(ORBSession.java:11
   11)
   9
   filenet.pe.peorb.client.ORBSession.fetch(ORBSession.java:2019)
   10    filenet.vw.api.VWQuery.fetch(VWQuery.java:568)
   11
   filenet.vw.api.VWRosterQuery.dofetch(VWRosterQuery.java:417)
   12    filenet.vw.api.VWQuery.hasNext(VWQuery.java:683)
   13
   filenet.vw.api.VWRosterQuery.hasNext(VWRosterQuery.java:454)
   14
   de.hglv.basisbpm.services.dao.utils.ProcessEngineHelfer.getWorkO
   bjectByIdFromRoster(ProcessEngineHelfer.java:222)
   15
   de.hglv.basisbpm.services.dao.utils.ProcessEngineHelfer.holeAkti
   vitaetGlobal(ProcessEngineHelfer.java:310)
   16
   de.hglv.basisbpm.services.dao.impl.AktivitaetDAOImpl.ladeLaufend
   eAktivitaetDetail(AktivitaetDAOImpl.java:437)
   17    at java.lang.Object.wait(Native Method)
   18    at java.lang.Object.wait(Object.java:167)
   19    at
   org.apache.commons.pool.impl.GenericObjectPool.borrowObject(Gene
   ricObjectPool.java:1104)
   20    at
   de.hglv.basisbpm.services.dao.utils.VWSessionPool.borrowSession(
   VWSessionPool.java:52)
   21    at
   de.hglv.basisbpm.services.dao.utils.ProcessEngineHelfer.getWorkO
   bjectByIdFromRoster(ProcessEngineHelfer.java:208)
   22    at
   de.hglv.basisbpm.services.dao.utils.ProcessEngineHelfer.holeAkti
   vitaetGlobal(ProcessEngineHelfer.java:310)
   23    at
   de.hglv.basisbpm.services.dao.impl.AktivitaetDAOImpl.ladeLaufend
   eAktivitaetDetail(AktivitaetDAOImpl.java:437)
   24    at sun.reflect.GeneratedMethodAccessor483.invoke(Unknown
   Source)
   25    at
   sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethod
   AccessorImpl.java:37)
   26    at java.lang.reflect.Method.invoke(Method.java:600)
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * Development of customer's project is now stalled             *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * In EJB 3 application, VWSession objects are re-used by       *
   * stateless session beans in order to service a particular     *
   * user request.                                                *
   * The users JAAS Context associated with those stateless       *
   * session beans, is also active when re-using the VWSession    *
   * object to call Process Engine Server. So, in our application *
   * the same VWSession object may be used with different JAAS    *
   * Contexts.                                                    *
   *                                                              *
   * However, both ORBSession and JAASContext class do seem to    *
   * contain code that manages the exchange of an existing        *
   * JAASContext for a new one. As mentioned in my PMR the JAAS   *
   * Context used for the previous call is saved internally in    *
   * the ORBSession object. Then, when another call is made, the  *
   * stored context is compared to the currently active context.  *
   * If both contexts are equal, the stored context is used. If   *
   * both contexts are not equal, the new context is used and     *
   * some data cleanup within ORBSession occurs                   *
   *                                                              *
   * See Error Description                                        *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Apply 4.5.1.3-P8PE-FP003 and newer.                          *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Fixed in 4.5.1.3-P8PE-FP003 and newer.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PJ39363
   
   
 * REPORTED COMPONENT NAME
   PROCESS ENGINE
   
   
 * REPORTED COMPONENT ID
   5724R7607
   
   
 * REPORTED RELEASE
   451
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2011-08-18
   
   
 * CLOSED DATE
   2012-04-17
   
   
 * LAST MODIFIED DATE
   2012-04-17
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PJ39375 [http://www-01.ibm.com/support/docview.wss?uid=swg1PJ39375]
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   PROCESS ENGINE
   
   
 * FIXED COMPONENT ID
   5724R7607
   
   

APPLICABLE COMPONENT LEVELS
 * R451 PSY
   UP