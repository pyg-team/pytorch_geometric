Title: IBM Database Service Pack 3.1.1.21 for SiteProtector 3.1.1 - United States

Text:
SP3.1.1; DB; SP3.1.1.21; XPU; DB_SP_3_1_1_21.xpu FIX README

ABSTRACT
 Database Service Pack 3.1.1.21 addresses several SiteProtector-specific known issues related to the database found after the release of SiteProtector 3.1.1. 

CONTENT
SP Workitem 67975 / APAR IV71999
When performing a SecureSync export from the secondary and import to the primary, it might be possible for necessary referential rows to not be exported. 
This can cause items that are created while the secondary site is active to not be imported as a result.

This update allows SiteProtector to export the necessary referential rows to ensure the configuration can be properly imported.

The affected audience might be anyone using SecureSync that needs to perform a secondary site export and primary site import after recovering from a failover.


SP Workitem 67977 / APAR IV71960

During normal database maintenance, SiteProtector will check the size of its database. This procedure can fail if the database is configured to grow by an extremely large size and the database is configured to grow by percentage. 
The error is an arithmetic overflow error in the iss_CheckSpace stored procedure.

This update allows SiteProtector to perform a cast during the growth calculation, which allows extremely large growth values.


SP Workitem 67129 / APAR IV71968

After performing a SecureSync import, the Fusion Module 3.0 might appear with an incorrect status and IP address.
Generally, Fusion Module 3.0 should be listed as located on the Application Server IP address.

This update allows SiteProtector to import the Fusion Module 3.0 information from the site you exported from, to the Fusion Module on the site you are importing to.

The affected audience might be anyone using SecureSync on a site that has a Fusion Module 3.0 component.


SP Workitem 69047 / APAR IV71965

It is possible for the database to get stuck in an "Error" status if the error occurred on a stored procedure in the past, but the stored procedure currently has no work to do. In these cases, the stored procedure is not run because there is nothing for it to do. This might also mean the status information for that stored procedure does not get updated. 
This might occur, for example, if you had an error while purging during database maintenance, and then disabled purges. It can also happen if you encountered an error during event loading, and afterwards did not have any data that needed to be rolled up.

This update allows SiteProtector to update the status of stored procedures when the decision is made that there is no work for it to do. For purge errors, the Error status will persist for 12 hours (so you will have a chance to acknowledge the error) before being cleared after purges are disabled.

The affected audience might be anyone whose database is stuck in Error status, but is not currently encountering any stored procedure errors.


SP Workitem 70956 / APAR IV73228

When using Central Responses that are configured to trigger only on specific Event Vulnerability Statuses, you might see responses for Vulnerability Statuses that are not in that list if those statuses were previously checked and then unchecked in the rule.
This happens because the policy is not properly processed and Vulnerability statuses that were added but later disabled are not properly ignored.

This update allows SiteProtector to properly handle disabled Vulnerability Status configurations in the rule policy for events.

The affected audience might be anyone who sees Central Responses triggered for Vulnerability statuses that were enabled and then disabled in the policy.


SP Workitem 70574 / APAR IV72979

After starting to use reputation event data on a site with multiple Event Collectors, you might see your Event Collectors fail to send events to the database and go into an Offline status.
In the Event Collector logs, you might see errors similar to the following:
Failed to commit transactions. bcp_batch failed. RealSecureDB..SensorDataRep2

This can be caused by an incorrect constraint definition in the SensorDataRep tables, if your site was upgraded from SiteProtector 2.9 and previously had multiple Event Collectors while on SiteProtector 2.9. However, you might not see the errors until you begin to use reputation event data.

This update allows SiteProtector to redefine the incorrect constraints, and allows the reputation events to be inserted.

The affected audience might be anyone running a site with multiple Event Collectors that was upgraded from SiteProtector 2.9, and that is using reputation event data.


SP Workitem 73246 / APAR IV74804

When performing a SecureSync import for the secondary site, it is possible for the import to fail with an error like:
The DELETE statement conflicted with the REFERENCE constraint "Response_Component_FK". 
The conflict occurred in database "RealSecureDB", table "dbo.Component", column 'LastPushedResponseID'.
This can happen when a response policy has been applied to the secondary site's Event Collector.

Note: In general, the secondary site's components in a SecureSync site are not meant to be used to handle events, and generally only exist to support the secondary site's Update Server.
Therefore, in most cases you should not need to apply policies or responses to the components that are exclusive to the secondary site.

This update allows SiteProtector to properly prepare the secondary site for an import when a response has been applied to the Event Collector exclusive to the secondary site.

The affected audience might be anyone who has applied a response to the secondary site's Event Collector.


SP Workitem 73830 / APAR IV75255

When using an XGS agent with Quarantine rules, the request to get a Quarantine policy from SiteProtector can take a long time. This can cause additional problems such as preventing other agents from heartbeating, causing the agents to appear to go from Active to Offline, as well as some other symptoms such as preventing proper updating of health statuses.

This update allows SiteProtector to more quickly generate responses to Quarantine policy requests for the XGS, especially when there are a large number of Quarantine rules saved in SiteProtector.

The affected audience might be anyone who gets a lot of Quarantine responses from the XGS and sees eventual Agent Manager performance problems.


SP Workitem 74609 / APAR IV75926

It might be possible for SiteProtector to have inefficiently stored event data in the database. 
This can affect general performance especially related to events.
You might especially see this issue if you receive a large number of the same event, or if your agents are set to the wrong date.

Additionally, in some cases, SQL Server might improperly optimize queries involved in loading events and the following additional symptoms can be seen:
- The Average Post Process Rate Database Health Check might show as failed and the Database component might show as Unhealthy
- Events might load slowly and the database might enter a backlogged state, causing the Agent Manager and Event Collectors to go Offline.
- The agents or Agent Manager might report queue full errors if the database is unable to recover from its backlogged state.
- Other database jobs might appear to execute slowly or might be frequently blocked by the event loading job.
You might be more likely to be affected if using Microsoft SQL Server 2014 due to changes in the query optimizer in that version.

This update allows SiteProtector to store event data more efficiently, and includes improvements to help Microsoft SQL Server's query optimizer to more effectively run the queries.

The affected audience might be anyone with a large amount of events, especially if a large number of the events are very similar.

Note: If a large number of your events are the same, then you might also consider performing policy tuning for the agents to filter out events that you are not interested in examining.


SP Workitem 64414

The iss_Health_Update_DB stored procedure can get an arithmetic overflow in certain situations that can cause run durations to appear as a large negative number. These situations are usually very rare and might only happen due to a defect in SQL Server during time changes.

The update allows SiteProtector to exclude large negative run times from job history calculations.






[/support/docview.wss?uid=swg21966658&aid=1] [https://ibm.biz/BdHdjw] [/support/docview.wss?uid=swg21966658&aid=2] [http://ibm.biz/InfraSecForumTechnote] [/support/docview.wss?uid=swg21966658&aid=3] [http://ibm.biz/SecSuptUTube] [/support/docview.wss?uid=swg21966658&aid=4] [http://ibm.biz/InfraSecFixes] [/support/docview.wss?uid=swg21966658&aid=5] [http://ibm.biz/FlexLicLogin] [/support/docview.wss?uid=swg21966658&aid=6] [http://ibm.biz/MyNotification] [/support/docview.wss?uid=swg21966658&aid=7] [http://ibm.biz/ContactSecSupport]