Title: IBM Test Connection successful, but ITPA Agent fails to create KPATASKS table after startup - United States

Text:
itpa init_pa_config_tables.sql TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 In the TEP Client, when attempting to select Edit-->PA Configuration, an error appears indicating it couldn't find the KPATASKS table. During ITPA configuration, the selection to "Initialize Tables" was selected, and a Test Connection to the Database was successful. 

ENVIRONMENT
The database does not have the KPATASKS table. Yet the ITPA Agent is installed, ITPA Domains are installed, and Application Support is installed for TEMS / TEPS / ITPA. Also, the "Test Connection" was successful, which would seemingly indicate that the configuration is correct for the Warehouse database connection.

DIAGNOSING THE PROBLEM
It was confirmed that the KPATASKS table really was missing from the database. Also, the $CANDLEHOME/<architecture>/pa/config/todepoloy directory was examined, and it still has kp*.sql file(s), indicating that they weren't processed. 

The $CANDLEHOME/logs/kpacma.log shows a SQLCODE=-204 error:

2013-01-04 15:15:11: Stack trace : com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-204, SQLSTATE=42704, SQLERRMC=ITMUSER.KPATASKS, DRIVER=4.13.80
at com.ibm.db2.jcc.am.id.a(id.java:677)
at com.ibm.db2.jcc.am.id.a(id.java:60)
...
at com.ibm.db2.jcc.am.fo.execute(fo.java:1037)
at com.tivoli.kpa.kpaxjdbc.execDirect(Unknown Source)
2013-01-04 15:15:11: Query failed:
2013-01-04 15:15:11: SELECT UPDATETIME,ISACTIVE FROM itmuser.KPATASKS
2013-01-04 15:15:11: Failed to execute query to determine if config parser task is required
...
2013-01-04 16:09:34: TImpMainTask: Trying file kp3_tasks.sql
2013-01-04 16:09:34: TImpMainTask: Found sql file /opt/IBM/ITM/lx8266/pa/config/todeploy/kp3_tasks.sql
2013-01-04 16:09:34: TImpMainTask: Command to deploy sql file "/opt/IBM/ITM/JRE/lx8266/bin/java" -cp "/opt/IBM/ITM/classes/kjrall.jar:/opt/IBM/ITM/lx8266/pa/bin/kpaxjdbc.jar:/opt/ibm/db2/V9.7/java/db2jcc4.jar,/opt/ibm/db2/V9.7/java/db2jcc_license_cu.jar:/opt/IBM/ITM/lx8266/pa/bin/paconf.jar" com.ibm.tivoli.pa.config.PAConfigMain -execSQL "/opt/IBM/ITM/lx8266/pa/config/todeploy/kp3_tasks.sql"
2013-01-04 16:09:36: TImpMainTask: Deploy command failed. execResult: 1

When configuring the ITPA Agent, the "Test Connection" was successful, so at first, it was believed that the database parms are ok.

However, later the kpacma.log was re-examined, and it was determined that the classpath was incorrect. The configuration was originally done using the Agent configuration CLI command "itmcmd config -A pa"; when specifying the JAR files, the same format was used as the WPA and S&P Agent CLI configuration, with comma-separated JAR file paths:

/opt/ibm/db2/V9.7/java/db2jcc4.jar,/opt/ibm/db2/V9.7/java/db2jcc_license_cu.jar

But for the ITPA, it needs to be specified like this, with a colon separator:

/opt/ibm/db2/V9.7/java/db2jcc4.jar:/opt/ibm/db2/V9.7/java/db2jcc_license_cu.jar



RESOLVING THE PROBLEM
After reconfiguring the Agent and specifying the classpath with a colon separator between the two JAR files, initializing the tables, and restarting the Agent, it fixed the problem.