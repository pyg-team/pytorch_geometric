Title: IBM WebSphere MQ 7.5 client generates rc 2085 for missing queue SYSTEM.PROTECTION.POLICY.QUEUE on WebSphere MQ 7.0 or 7.1 queue managers that are enabled for local events - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You have WebSphere MQ queue managers at version 7.0 and 7.1, and you have enabled the generation of "local events" on those queue managers:
ALTER QMGR LOCALEV(ENABLED)
You have started to use the MQ 7.5 client and you noticed that new events are generated in the queue:
SYSTEM.ADMIN.QMGR.EVENT 
These events report a return code 2085 (MQRC_UNKNOWN_OBJECT_NAME) for the missing queue:
SYSTEM.PROTECTION.POLICY.QUEUE 

CAUSE

WebSphere MQ 7.5 integrates the Advanced Message Security (AMS) feature into the base product.

WebSphere MQ 7.5 also introduces a new attribute for the WebSphere MQ queue manager to determine if the AMS code is installed or not: SPLCAP
When the WebSphere MQ 7.5 client checks if there should be any AMS calls, it does check the SPLCAP attribute on the Queue Manager but only if the queue manager is at version is 7.5 or later. 

If the Queue Manager runs on WebSphere MQ 7.0 or 7.1, because the queue manager does not have the SPLCAP attribute, then the MQ 7.5 code needs to check for the existence of the queue:
SYSTEM.PROTECTION.POLICY.QUEUE

Because this queue is not defined by default in WebSphere MQ 7.0 or 7.1, then the local event with rc 2085 is generated.

Only if the queue manager has been configured to use AMS, then this queue SYSTEM.PROTECTION.POLICY.QUEUE would be defined.



RESOLVING THE PROBLEM
++ Section 1 


Follow the recommendation in APAR IC94205


IC94205: MQ V7.5 CLIENT REPORTS 2085 ERROR OPENING THE SYSTEM.PROTECTION.POLICY.QUEUE [http://www.ibm.com/support/docview.wss?uid=swg1IC94205]
The fix is targeted for: 7.5.0.4

Problem conclusion

This APAR introduces an environment variable
AMQ_DISABLE_CLIENT_AMS to disable AMS at the client side.

To enable this change, either:
1) Create and set the environment variable
AMQ_DISABLE_CLIENT_AMS to TRUE in the environment where the MQ
7.5 client is running to disable AMS at the client side.

OR

2) Set com.ibm.mq.cfg.AMQ_DISABLE_CLIENT_AMS to TRUE in the
mqclient.ini file


++ Section 2 

 

If you want to avoid the generation of the local event for rc 2085 when the WebSphere MQ 7.5 client tries to browse the AMS related queue SYSTEM.PROTECTION.POLICY.QUEUE, then you can create this queue and enable it for browsing.
As long as there are no policies on this queue, the AMS code in the WebSphere MQ 7.5 client is not triggered. 

a) Use runmqsc to add the queue, for example:

DEFINE QLOCAL('SYSTEM.PROTECTION.POLICY.QUEUE') + 
DEFPSIST(YES) + 
DESCR('WebSphere MQ Message Protection Policy Queue') + 
REPLACE 

b) Use setmqaut to add the +browse permission.

setmqaut -m QUEUE.MANAGER -t queue -n SYSTEM.PROTECTION.POLICY.QUEUE -p SOME.USER +browse 
setmqaut -m QUEUE.MANAGER -t queue -n SYSTEM.PROTECTION.POLICY.QUEUE -g SOME.GROUP +browse 

The only permission that is needed for this queue is: +browse
No other permissions should be granted. Any other permissions, especially "+put" and "+get" could be a possible security breach.

 

PRODUCT ALIAS/SYNONYM
 WMQ MQ