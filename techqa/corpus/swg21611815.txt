Title: IBM Verifying data integrity - United States

Text:
corruption; verification; duplicates; CI's TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 How to verifying data integrity within TADDM version 7.2.1? 

RESOLVING THE PROBLEM
 

One can use the verify-data.sh|bat command to verify configuration items data integrity in TADDM database Data integrity verification tool was developed to report and repair configuration items data integrity problems in TADDM database. The executable script is located under $COLLATION_HOME/bin directory.

Discovery, bulkload or synchronization should not be performed when REPAIR option is used. Because data integrity tool analyzes huge amounts of data, the tool may run for a while, especially when REPAIR option is used. Tool reports and logs to verify-data.log file. Tool can be stopped and run again at any time. The order of running verifications is arbitrary but the most optimal order which is recommended is :

1. Verify relationships
2. Verify inheritance mapping
3. Verify duplicates
4. Verify over merges


Relationships verification

Verification for relationships query and verify foreign keys in all model and intersection tables. With REPAIR option:
· removes child objects if parent object does not exist in database
· clears invalid foreign key values for relationships which are defined as not contained

Usage:
verify-data.sh/bat -v ro [-a repair]

Notes:
There is a possibility that significant number of low level configuration items will be removed, but without a parent object in database these objects should not exist.

Inheritance mapping verification

Verification for inheritance mapping query all tables that map a given configuration item class and verify that all of the items contain entries for each row. With REPAIR option is recreating missing records.

Usage:
verify-data.sh/bat -v io [-a repair]



Duplicates verification

Verification for duplicates search for duplicated configuration items based on naming rules field values in database. With REPAIR option is merging duplicated objects. After merge durable object will stay in database, transient object is deleted.

Usage:
verify-data.sh/bat -v dup [-a repair]

Notes:
Expected errors during merging objects, cause is included in log file. Some causes description:
ERROR_INVALID_DURABLE_GUID: 
cause: e.g. missing aliases in ALIASES table, object is invalid
solution: wait for cleanup agents which delete invalid objects
ERROR_INVALID_TRANSIENT_GUID:
cause: e.g. missing aliases in ALIASES table, object is invalid
solution: wait for cleanup agents which delete invalid objects

Over merges verification

Verification for over merges use data gathered in ALIASES_JN table. The ALIASES_JN table contains history of changes in ALIASES table. Over merge is a situation where a couple of objects change their parents to the same model object. Child objects get clustered around some number of parent objects. Verification query ALIASES_JN table to find large number of master alias changes for a given alias, and reports guids found.
Only new possible over merges can be found. Currently existing over merges before TADDDM 7.2.1 FP3 installation cannot be found because there is no required data in ALIASES_JN table. Verification does not have REPAIR option because may found and report false positive results.

Usage:
verify-data.sh/bat -v om

Recommendation how to solve over merge issue:
· Run over merges verification
· Make sure that reported configuration items should not be merged
· Correct configuration in environment if required (e.g. problems in virtual environment configuration like same signature, serial number or VMID)
· Remove over merged object from TADDM database
· Run discovery against deleted objects and validate results
· Remove all records in ALIASES_JN table after solving over-merge problems
To remove all records from ALIASES_JN table run following statements:
- for DB2:
ALTER TABLE ALIASES_JN ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE;
- for Oracle
TRUNCATE TABLE ALIASES_JN; 



 

PRODUCT ALIAS/SYNONYM
 TADDM