Title: IBM 2035 MQRC_NOT_AUTHORIZED Java or JMS applications fail after upgrading from MQ V5.3 to V6 or V7 - United States

Text:
2035; JMS; java; MQRC_NOT_AUTHORIZED; client application; upgrade TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You upgrade from WebSphere MQ V5.3 to V6 or V7 on the box where your client application is running. Now the client application fails with a reason code of 2035 (MQRC_NOT_AUTHORIZED).

However, you have a client application that uses the WebSphere MQ V5.3 classes for Javaâ„¢ or JMS and it is working as expected. 

SYMPTOM
MQRC 2035 2035 MQRC_NOT_AUTHORIZED


CAUSE
Starting with MQ V6, changes were done to the MQ JMS client code to provide to the MQ server the userid of the process (application) that is connecting to the MQ server using the MQ JMS client. 


In this case, the MQ queue manager has received a username which either: 

 * Does not exist in the host of the MQ queue manager. 
 * Does exist, but it does not have the proper authority to access the MQ queue manager.

DIAGNOSING THE PROBLEM
Trace the failure to find the userid that is being sent by the MQ client to the MQ queue manager, it is necessary to capture the concurrent trace. This section provides more details. 

 
From the JMS Trace (trace.log) you can see the userid that is sent by the MQ Client

For example, the trace.log for the JMS client may have strings such as these:

com.ibm.mq.jms.MQQueueConnectionFactory connecting as user: JohnDoe
com.ibm.mq.jms.MQQueueConnection Setting username = JohnDoe
com.ibm.mq.MQv6InternalCommunications userID = 'JohnDoe '
com.ibm.mq.MQv6InternalCommunications UID :JOHNDOE

From the MQ server trace you can see the userid that is received by the queue manager

It is very likely that one of the MQ trace files (*.FMT) will have the following string indicating that the value (username) is not a user ID in the system (unknown principal). Search for the string: UnknownPrincipal

UnknownPrincipal(johndoe) 

Also, in case that the userid does exist, another possible cause is that the user does not have all the proper authorizations, thus, check for the following phrase in the trace:

The following requested permissions are unauthorized

Obtaining traces:

For information on how to gather the traces:

MQ: WebSphere MQ Queue Manager Trace (Example for Linux)
http://www.ibm.com/support/docview.wss?&uid=swg21174924#UNIXlt [http://www.ibm.com/support/docview.wss?&uid=swg21174924#UNIXlt]

WAS JMS: Enabling JMS trace for releases of WebSphere Application Server V5.1, V6.0, V6.1, and V7.0
http://www.ibm.com/support/docview.wss?&uid=swg21199176 [http://www.ibm.com/support/docview.wss?&uid=swg21199176]


RESOLVING THE PROBLEM
Check which user ID the application is being run under and then check to see if that user ID either is in the "mqm" group (if the user is going to be an MQ Administrator) or in some other group with sufficient authority.


After adding the userid to the group with sufficient authority, issue a runmqsc command:
REFRESH SECURITY(*) 

The user ID associated with the program when it runs must have authority to access certain resources of the queue manager. Grant the following authorities to the user ID: 

 * The authority to connect to the queue manager, and the authority to inquire on the attributes of the queue manager object. 
 * The authority to put and get messages on the desired queue.


For information about how to grant authorities, see the following book from the MQ online information center: 

MQ V7 Information Center [http://publib.boulder.ibm.com/infocenter/wmqv7/v7r0/index.jsp] 

WebSphere MQ System Administration Guide [http://publib.boulder.ibm.com/infocenter/wmqv7/v7r0/index.jsp?topic=/com.ibm.mq.amqzag.doc/fa10120_.htm]  

PRODUCT ALIAS/SYNONYM
 MQ WMQ MQSeries