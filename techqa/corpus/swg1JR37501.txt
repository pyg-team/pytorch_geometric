Title: IBM JR37501: DUE TO LIMITATION OF WAS RSADAPTER UNDER CONCURRENT HEAVY WORKLOAD, JDBC ADAPTER NEEDS TO ACCOMMODATE LIMITATION. - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  WAS rsadapter has a limitation when under concurrent heavy
   workload environment. So JDBC adapter has to
   change code to deal with the limitation.
   .
   There is a limitation from WAS rsadapter on under the concurrent
   heavy workload environment:
   http://www-01.ibm.com/support/docview.wss?uid=swg21284252 [http://www-01.ibm.com/support/docview.wss?uid=swg21284252]
   The following scenario is not allowed:
   The JDBC objects are not closed by the thread that is using the
   object.  A reference to that JDBC object is stored in a
   different user object that is closed by a finalize method
   during garbage collection.
   This scenario might seem to work correctly during times of low
   or moderate workload. However, during heavy workload, it is more
   likely that a collision will occur between activity on a thread
   that is calling the finalize method and activity on a
   functional thread. An exception or other thread-safety problem
   is likely to occur.
   .
   The following trace statements show the behavior explained
   above.
   
   [7/27/10 14:47:01:046 CDT] 00000052 WSJdbcDatabas >  <init>
   Entry com.ibm.db2.jcc.t4.f@6aa06aa
   com.ibm.ws.rsadapter.jdbc.WSJccSQLJConnection@15591559
   
   [7/27/10 14:47:02:203 CDT] 00000052 WSRdbSpiLocal 3
   Correlator: DB2,
   ID: 10.2.28.48.51655.100727195310 Transaction :
   com.ibm.ws.rsadapter.spi.WSRdbSpiLocalTransactionImpl@6d806d8
   COMMIT
   
   [7/27/10 14:47:02:266 CDT] 00000052 PoolManager   3   released
   managed connection
   com.ibm.j2ca.jdbc.JDBCManagedConnection@3b2a3b2a
   
     Though the MC of JDBC Adapter is cleaned and released to the
   FreePool, the associated ManagedConnection of the IBM
   resource adater (RRA) could still be in the cleanup process.
   
   [7/27/10 14:47:02:273 CDT] 00000052 LocalTransact 3
   Information:
   handle not closed at end of UOW. Connection from pool
   jdbc/xmlo/db2
   
   Meanwhile, if next request comes, there is a possibility that
   the above JDBC connection could be granted to it. When that
   happens, there are two threads acting on the same underlying
   connection via the RRA.
   .
   .----------------------------------------------
      Here is an example of the exception that can result from
   this.
   .
      The result of the limitation is an error like this
   [8/5/10 10:58:10:426 CDT] 0000003e LocalTransact E   J2CA0024E:
   Method commit, within transaction branch ID <null> of resource
   pool jdbc/xmlo/db2, caught java.lang.NullPointerException
    at com.ibm.ejs.j2c.LocalTransactionWrapper.commit
   (LocalTransactionWrapper.java:263)
    at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.complete
   (LocalTranCoordImpl.java:933)
    ....
   
   [8/5/10 10:58:11:075 CDT] 0000003e LocalTranCoor E   WLTC0016E:
   Resource jdbc/xmlo/db2 failed to complete. Exception stack trace
   follows: javax.transaction.xa.XAException
    at com.ibm.ejs.j2c.LocalTransactionWrapper.commit
   (LocalTransactionWrapper.java:283)
    at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.complete
   (LocalTranCoordImpl.java:933)
    at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.complete
   (LocalTranCoordImpl.java:821)
    at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.end
   (LocalTranCoordImpl.java:1415)
    ....
   Caused by: java.lang.NullPointerException
    at com.ibm.ejs.j2c.LocalTransactionWrapper.commit
   (LocalTransactionWrapper.java:263)
    ... 207 more
   
   
    
   
   

LOCAL FIX
 *  JDBC adapter will be able to accommodate WAS rsadapter in heavy
   workload environment.
   
   
    
   
   

PROBLEM SUMMARY
 *  When JCA JDBC adapter runs in heavy workload multiple threads
   environment,it return a 'Cannot call cleanup on a
   ManagedConnection while it is still in a transaction' error
   message.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Fixed. Make sure to close WAS datasource connection after JCA
   JDBC adapter cleanup method is invoked.
   
   
    
   
   

TEMPORARY FIX
 *  7.0.0.1_IF01
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   JR37501
   
   
 * REPORTED COMPONENT NAME
   WEBS ADPT JDBC
   
   
 * REPORTED COMPONENT ID
   5724L7700
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-08-16
   
   
 * CLOSED DATE
   2010-09-13
   
   
 * LAST MODIFIED DATE
   2012-02-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBS ADPT JDBC
   
   
 * FIXED COMPONENT ID
   5724L7700
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP
   
   
 * R701 PSN
   UP