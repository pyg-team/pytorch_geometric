Title: IBM Starting WebSphere server hosting FileNet Content Engine 510 results in XAException and xp_sqljdbc_xa_init stored procedure initialization problem - United States

Text:
XAER_RMERR; xp_sqljdbc_xa_init; MSDTC; SQLJDBC_XA; DTC_ERROR TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Upon Starting WebSphere server the following error is logged in the SystemOut.log



WSRdbXaResour E DSRA0302E: XAException occurred. Error code is: XAER_RMERR (-3). Exception is: Failed to initialize the stored procedure xp_sqljdbc_xa_init. The status is: -3. Error: "*** SQLJDBC_XA DTC_ERROR Context: FInitializeTransactionManager, state=1, StatusCode:-3 (0xFFFFFFFD) ***" 

SYMPTOM
Complete error in SystemOut.log

XARminst E WTRN0037W: The transaction service encountered an error on an xa_recover operation. The resource was com.ibm.ws.rsadapter.spi.WSRdbXaResourceImpl@13331333. The error code was XAER_RMERR. The exception stack trace follows: javax.transaction.xa.XAException: Failed to initialize the stored procedure xp_sqljdbc_xa_init. The status is: -3. Error: "*** SQLJDBC_XA DTC_ERROR Context: FInitializeTransactionManager, state=1, StatusCode:-3 (0xFFFFFFFD) ***"
at com.microsoft.sqlserver.jdbc.SQLServerXAResource.DTC_XA_Interface(SQLServerXAResource.java:417)
at com.microsoft.sqlserver.jdbc.SQLServerXAResource.recover(SQLServerXAResource.java:723)
at com.ibm.ws.rsadapter.spi.WSRdbXaResourceImpl.recover(WSRdbXaResourceImpl.java:1088)
at com.ibm.ws.Transaction.JTA.XARminst.recover(XARminst.java:141)
at com.ibm.ws.Transaction.JTA.XARecoveryData.recover(XARecoveryData.java:631)
at com.ibm.tx.jta.PartnerLogTable.recover(PartnerLogTable.java:389)
at com.ibm.tx.jta.RecoveryManager.resync(RecoveryManager.java:1530)
at com.ibm.tx.jta.RecoveryManager.performResync(RecoveryManager.java:2265)
at com.ibm.ws.tx.jta.RecoveryManager.performResync(RecoveryManager.java:114)
at com.ibm.tx.jta.RecoveryManager.run(RecoveryManager.java:2218)
at java.lang.Thread.run(Thread.java:735)


CAUSE
With a 2008 cluster, there were improvements made to DTC to coordinate transactions across multiple nodes enlisted in the transaction, which require additional configuration on the MSDTC side.
In the below blog a complete description of this feature.
Note this is strictly a SQL configuration feature, the DTC specific calls are issued from within the SQL Server or the MS JDBC Driver, not issued or managed through the application or WAS transaction manager which relies strictly on the resource XA driver.

http://blogs.msdn.com/b/distributedservices/archive/2010/03/25/import-of-microsoft-distributed-transaction-coordinator-ms-dtc-transaction-failed-0x8004d00e-xact-e-notransaction.aspx [http://blogs.msdn.com/b/distributedservices/archive/2010/03/25/import-of-microsoft-distributed-transaction-coordinator-ms-dtc-transaction-failed-0x8004d00e-xact-e-notransaction.aspx] 

Note this part:

"SQL Server loads SQLJDBC_XA.DLL which is a legacy application that is 
not aware of any DTC changes on Windows Server 2008 or R2. A legacy 
application uses the cluster default DTC instance if no mapping for it 
exists. SQLJDBC_XA requests an XA transaction in the cluster default 
DTC instance." 



ENVIRONMENT
Clustered MSSQL 2008 R2 on Windows 2008 R2
WebSphere server is 7.0.0.25
Content Engine is 5.1.0

DIAGNOSING THE PROBLEM
Review the SystemOut.log and observe DTC XA errors

RESOLVING THE PROBLEM






 * Ensure DTC transactions are enabled on all SQL servers involved the cluster.
   http://publib.boulder.ibm.com/infocenter/p8docs/v5r1m0/topic/com.ibm.p8.security.doc/p8psu014.htm [http://publib.boulder.ibm.com/infocenter/p8docs/v5r1m0/topic/com.ibm.p8.security.doc/p8psu014.htm]
   
   
 * Second reference description of the new MS2008 MSDTC features and how to implement it.
   http://blogs.msdn.com/b/distributedservices/archive/2010/03/25/import-of-microsoft-distributed-transaction-coordinator-ms-dtc-transaction-failed-0x8004d00e-xact-e-notransaction.aspx [http://blogs.msdn.com/b/distributedservices/archive/2010/03/25/import-of-microsoft-distributed-transaction-coordinator-ms-dtc-transaction-failed-0x8004d00e-xact-e-notransaction.aspx] 
   
   Here is information on mapping:
   http://technet.microsoft.com/en-us/library/cc742483(WS.10).aspx [http://technet.microsoft.com/en-us/library/cc742483(WS.10).aspx] 
   
   Also review the below information as a potential additional item: (applies to WAS 8 as well)
   http://pic.dhe.ibm.com/infocenter/wasinfo/v7r0/index.jsp?topic=/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/rtrb_dsaccess4.html [http://pic.dhe.ibm.com/infocenter/wasinfo/v7r0/index.jsp?topic=/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/rtrb_dsaccess4.html] 
   
   This part: 
 * 
   JAVAX.TRANSACTION.XA.XAEXCEPTION occurs with error: XP_SQLJDBC_XA_INIT
   If using a Microsoft SQLSERVER database on Windows Server 2003, and move a cluster of SQL servers from one node to another node, or shut down the cluster, the Enable XA Transactions setting in Windows Component Services might be reset to disabled. When this happens, a JAVAX.TRANSACTION.XA.XAEXCEPTION with Error: XP_SQLJDBC_XA_INIT might occur because the JDBC driver is no longer enabled for XA transactions.
   



To re-enable XA transactions in Windows Component Services, complete the following actions:  

 1.  From your Microsoft Windows desktop
     
     
 2.  Click Start 
     
     
 3.  Settings
     
     
 4.  Administrative Tools
     
     
 5.  Component Services .
     
     
 6.  Expand the tree view to locate the computer where you want to turn on support for XA transactions; for example, My Computer.
     
     
 7.  Display the context menu for the computer name, and then click Properties.
     
     
 8.  Click Options, and then set Transaction Timeout to a length of time that suits the environment. The recommended minimum setting is 180 seconds.
     
     
 9.  Click MSDTC
     
     
 10. Click Security Configuration .
     
     
 11. Under Security Settings
     
     
 12. Select XA Transactions to enable this support.
     
     
 13. Click OK to save your changes.
     
     
     Avoid trouble: The installation documentation for JDBC XA connectivity refers to two known problems. See the Microsoft support site for more information:
     
     
     KB899756: Windows 2003 only. MSDTC does not detect process termination, and MSDTC cannot set time-out values for XA transactions in Windows Server 2003.
     
     
     KB318818: Performance slows down when you use XA Transactions with SQL Server.