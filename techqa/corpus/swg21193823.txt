Title: IBM JVM storage grows to MAX heap and does not get released - United States

Text:
Java JVM minheap maxheap 5697E9300 R300 300 R630 630 HCI6300 5697-E93 5697E93 5655M1500 R640 640 R400 400 HCI6400 R650 650 R500 500 HCI6500 5655-M15 5655M15 5655S9700 R660 660 R600 600 HCI6600 5655-S97 5655S97 kixinfo retention41 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are using the Javaâ„¢ Virtual Machine (JVM) in your CICS region. The JVM storage grows, but you want to know if it shrinks and releases any unused memory. 

DIAGNOSING THE PROBLEM
If a JVM expands its memory usage from its MIN heap size to its MAX, the difference (MAX-MIN) becomes unavailable to CICS for the duration of the CICS region execution. 
For example:
Say you start a JVM with a MIN heap size of 64MB and a MAX heap size of 128MB. When the JVM starts it does a memory request (malloc) to CICS for the MAX size of the heap (128MB). But these pages are still available to CICS, since the JVM has not used them yet. The JVM then backs the MIN size of the heap (64MB). So now that 64MB is used and unavailable to CICS. The application runs and during the day the heap must expand to 128MB. So now all 128MB is used and unavailable to CICS. Now the load on the application decreases and the JVM can shrink its allocation. Even though it does this, it does not free any memory back to CICS, and it keeps all 128MB of the heap, so CICS cannot reclaim it.

The JVM storage usage grows towards the MAX heap size, but it does not shrink. The MAX heap allocation is created at JVM startup. It will start out being used in the -ms size. If an object request is greater than the -ms size, it will go and expand into another -ms size chunk. This will continue over the life of the JVM, and keep in mind, that garbage collection is running also to keep things balanced. 

This is all documented in the Java Diagnostic Guide available off the main Java website:
http://www.ibm.com/servers/eserver/zseries/software/java/ [http://www.ibm.com/servers/eserver/zseries/software/java/] 

There is detailed information on the heap under the 'Memory Management" chapter.


RESOLVING THE PROBLEM
The JVM storage usage grows towards the MAX heap size, but it does not shrink.

 

PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server