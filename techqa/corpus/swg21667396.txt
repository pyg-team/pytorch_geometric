Title: IBM Generating WebSphere MQ client trace on HP Integrity NonStop Server - United States

Text:
Tracing; Trace; WebSphere MQ; MQ; HP Integrity NonStop Server; HP NonStop Server; HP NonStop; NonStop TECHNOTE (FAQ)

QUESTION
 How do I generate a WebSphere MQ client trace on HP Integrity NonStop Server systems in order to investigate a problem? 

CAUSE
Traces can capture the root cause of many MQ problems. It is important to limit how long tracing is active in order to avoid affecting performance or generating excessively large trace files and filling up your disk. For other MQ traces and for WebSphere MQ V5.3 trace on HP NonStop Server refer to:



 * Generating IBM MQ Traces [http://www.ibm.com/support/docview.wss?uid=swg21174924]

 * WebSphere MQ 5.3 on HP NonStop Server [http://www.ibm.com/support/docview.wss?uid=swg21667375]




Make sure the OSS directory containing var/mqm/trace is on a volume with plenty of available space. If MQ runs out of space while tracing, a partial trace may not contain the information IBM Support needs to solve the problem.


ANSWER



GENERATING TRACES
 1.  
 2.  Start tracing with the strmqtrc command. The parameters passed to strmqtrc control which processes will generate trace files and what kinds of data they will trace. The strmqtrc command only starts trace for processes running on the same CPU as your OSS shell or TACL session, so be sure to use the run command to start trace on a specific CPU number. Because the WebSphere MQ client for HP Integrity NonStop Server uses OpenSSL rather than IBM GSKit for secure communications, be aware that the strmqtrc command does not support the "-t ssl" option. The examples below show both TACL and OSS syntax:
 3.   
     STARTING A DEFAULT DETAIL TRACE OF ALL PROCESSES ON CPU 1
     
     TACL> run /CPU 1/ strmqtrc 
     or 
     osh> run -cpu=1 strmqtrc 
     
     STARTING AN API TRACE OF PROCESSES CALLED AMQSPUT ON CPU 2
     
     TACL> run /CPU 2/ strmqtrc -t api -p amqsput 
     or 
     osh> run -cpu=2 strmqtrc -t api -p amqsput 
     
     STARTING A HIGH DETAIL TRACE OF EVERYTHING ON CPU 3
     
     TACL> run /CPU 3/ strmqtrc -e -t all -t detail 
     or 
     osh> run -cpu=3 strmqtrc -e -t all -t detail 
     
 4.  
 5.  
 6.  Reproduce the problem while tracing is active, making every attempt to keep the trace as short as possible.
 7.  
 8.  
 9.  As soon as the problem has occurred, stop tracing immediately! If you wait to stop the trace, the data IBM Support needs may be lost or overwritten. For example:
 10.  
     STOPPING ALL TRACE ON CPU 1
     
     TACL> run /CPU 1/ endmqtrc -a 
     or 
     osh> run -cpu=1 endmqtrc -a 
     
     STOPPING A TRACE OF PROCESSES NAMED AMQSPUT ON CPU 2
     
     TACL> run /CPU 2/ endmqtrc -p amqsput 
     or 
     osh> run -cpu=2 endmqtrc -p amqsput 
     
     
 11. 
 12. 
 13. The trace files generated by WebSphere MQ are binary and must be formatted before they can be read. They are located in a "trace" directory under the OSS directory which you chose for the WebSphere MQ installation. The binary trace files are named like AMQ.nnnnnnnn.xx.ppp.qq.TRC (or .TRS), where nnnnnnnn is the process name, xx is the CPU number, ppp is the PIN of the process, and qq is a counter starting at zero, incremented to ensure WebSphere MQ creates a new trace file each time.
 14.  
     FORMATTING WEBSPHERE MQ TRACE FILES
     
     osh> cd " /path/to/trace " 
     osh> dspmqtrc AMQ.*.*.TR? 
 15. 
 16. 
 17. Save a copy of the binary trace files as long as you are working with IBM support, but do not send both binary and formatted traces to IBM. Delete the binary trace files before sending your data to IBM.
 18.  
     DELETING WEBSPHERE MQ BINARY TRACE FILES
     
     osh> cd " /path/to/trace " 
     osh> rm -f AMQ.*.*.TR? 
 19. 
 20. 
 21. WebSphere MQ V7.1 for HP Integrity NonStop Server provides the runmqras command [http://www.ibm.com/support/docview.wss?uid=swg21624944] to collect your WebSphere MQ traces and other data by specifying the "trace" section name. If the traces are very large, you may need to use the "-workdirectory" option to package the files in a directory with plenty of free space. For example, to collect traces for your IBM Problem Management Record 12345,67R,890 run:
 22.  
     USE RUNMQRAS TO COLLECT WEBSPHERE MQ TRACES AND OTHER DATA
     
     osh> runmqras -section trace -pmrno 12345,67R,890 -workdirectory /var/bigdata 
     
 23. 
 24. 
 25. After sending the formatted traces, clean up the trace directory to reclaim space and also to make sure you are ready to generate new traces in future, if necessary. For example:
 26.  
     CLEAN UP THE TRACE DIRECTORY
     
     osh> cd " /path/to/trace " 
     osh> rm -f AMQ.*.FMT 
     
 27. 

Back to top



ADDITIONAL INFORMATION
 * Using runmqras to collect data from WebSphere MQ V7.1 [http://www.ibm.com/support/docview.wss?uid=swg21624944]
 * Cleaning up IBM MQ files [http://www.ibm.com/support/docview.wss?uid=swg21670876]


WEBSPHERE MQ V7.1
 * Using trace on HP Integrity NonStop Server [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/q113410_.htm]
 * Using strmqtrc [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/fa16100_.htm]
 * Using endmqtrc [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/fa15810_.htm]
 * Using dspmqtrc [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/fa15740_.htm]
 * Using runmqras [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/fa15580_.htm]


Back to top

 

PRODUCT ALIAS/SYNONYM
 WebSphere MQ WMQ