Title: IBM PK52220: CONNECTIONS ARE NOT PURGED FROM THE CONNECTION POOL AFTER THE UNUSED TIMEOUT HITS IF THE SERVANT IS IDLE. - United States

Text:
z/os  FIXES ARE AVAILABLE
Java SDK 1.5 SR8 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24020073]
Java SDK 1.5 SR8 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24021203]
Java SDK 1.5 SR10 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24024201]
6.1.0.31: Java SDK 1.5 SR11 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24026453]
6.1.0.33: Java SDK 1.5 SR12 FP1 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24027786]
6.1.0.29: Java SDK 1.5 SR11 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24025191]
6.1.0.35: Java SDK 1.5 SR12 FP2 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24028574]
6.1.0.37: Java SDK 1.5 SR12 FP3 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24029525]
6.1.0.39: Java SDK 1.5 SR12 FP4 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24030426]
6.1.0.41: Java SDK 1.5 SR12 FP5 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24031035]
6.1.0.43: Java SDK 1.5 SR13 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24031963]
6.1.0.45: Java SDK 1.5 SR14 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24033270]
6.1.0.47: WebSphere Application Server V6.1 Fix Pack 47 [http://www-01.ibm.com/support/docview.wss?uid=swg24035508]
6.1.0.47: Java SDK 1.5 SR16 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24035649]
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  WebSphere uses alarm managers to calculate the unused timeout
   and start the reaper thread to clean up connections from the
   pool. Since a deferrable alarm is used, in order to save CPU
   when the servant is idle, if there are connections in the pool
   left once the servant becomes idle these are not cleaned up.
   These are cleaned up only when work enters the servant again.
   This apar will provide a property to control this behavior and
   give the option to cleanup threads as the unused timeout hits
   regardless of work entering the servant.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere Application Server    *
   *                 V6.0.1 for z/OS                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: Unused connections are not discarded    *
   *                      even though unused timeout has passed.  *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   Reap time and unused timeout settings do not cause the idle or
   unused connections to be discarded if the servant region is
   idle. This may cause some DB2 connections to be tied up for a
   longer time than necessary.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Users that prefer to discard connections at the time they
   specified by combination of  reaper time and unused timeout
   settings even if it may cause an idle servant region to become
   active again, receive an option to do it by setting a new
   datasource custom property.
   
   To select this behavior, create a custom datasource propery
   'nondeferredreaper' of type java.lang.Boolean, set its value
   to 'true' for a specific datasource, and restart the server.
   For instance, when using the administrative console use the
   following links:
   JDBC providers > DB2 Universal JDBC Driver Provider > Data
   sources > <specific datasource> > Custom properties > New
   Name: nondeferredreaper  Value: true Type: java.lang.Boolean
   
   Users that choose to set this up, need to be aware that
   activating an idle servant region for a sole purpose of
   discarding unused connection, may cause additional and
   sometimes undesirable CPU usage. Also, a following warning
   might be logged and should be ignored:
   DSRA8200W: DataSource Configuration:
   DSRA8020E: Warning: The property 'nondeferredreaper' does not
   exist on the DataSource class
   com.ibm.db2.jcc.DB2ConnectionPoolDataSource.
   
   For users that prefer to stay with the current behavior, this
   APAR is not going to change it, unless 'nondeferredreaper'
   custom property is added and set to 'true'.
   
   APAR PK52220 requires changes to documentation.
   
   NOTE: Periodically, we refresh the documentation on our
   Web site, so the changes might have been made before you
   read this text. To access the latest on-line
   documentation, go to the product library page at:
   
   http://www.ibm.com/software/webservers/appserv/library [http://www.ibm.com/software/webservers/appserv/library]
   
   The following changes to the z/OS version of the WebSphere
   Application Server Version 6.0.x Information Center will be
   made available.
   
   The topic "Tuning connection pools" will be updated
   to include the following descriptions of the new
   nondeferredreaper custom properties:
   
   Discard connections. Reap time and unused timeout settings
   do not cause the idle or unused connections to be discarded
   if the servant region is idle. This situation might
   cause some DB2 connections to be held longer than is
   necessary.
   
   If you prefer to have the connections discarded at the
   time specified by a combination of  reaper time and unused
   timeout settings, even if this preference might cause an
   idle servant region to become active again, you can
   add the new nondeferredreaper custom property to your
   JDBC driver provider data source settings. When you
   add this custom property, connections are discarded at the
   time specified by a combination of reaper time and
   unused timeout settings.
   
   To add this custom property to your JDBC dDriver provider
   data source settings, in the administrative console,
   click Resources > JDBC providers > DB2 Universal JDBC
   Driver Provider > Data sources > datasource_name >
   Custom properties > New. Then specify nondeferredreaper
   in the Name field, true in the Value field, and
   java.lang.Boolean in the Type field. This new setting does
   not go into affect until you restart the server that is
   using this datasource.
   
   Note: Activating an idle servant region for the sole purpose
   of discarding unused connection, might cause additional and
   sometimes undesirable CPU usage. Also, a following warning
   might be logged and should be ignored:
   DSRA8200W: DataSource Configuration:
   DSRA8020E: Warning: The property 'nondeferredreaper' does not
   exist on the DataSource class
   com.ibm.db2.jcc.DB2ConnectionPoolDataSource.
   
   APAR PK52220 currently targeted for inclusion in Service
   Level (Fix Pack) 6.0.2.24 of WebSphere Application Server V6.0.1
   for z/OS.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK52220
   
   
 * REPORTED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * REPORTED COMPONENT ID
   5655I3500
   
   
 * REPORTED RELEASE
   601
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-09-04
   
   
 * CLOSED DATE
   2007-11-06
   
   
 * LAST MODIFIED DATE
   2008-02-13
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PK55370 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK55370]
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * FIXED COMPONENT ID
   5655I3500
   
   

APPLICABLE COMPONENT LEVELS
 * R500 PSN
   UP
   
   
 * R601 PSY UK31684 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK31684]
   UP07/12/04 P F712
   
   
 * R610 PSN
   UP
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.