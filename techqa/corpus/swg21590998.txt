Title: IBM Error "Unable to locate evaluator for 'KFW_WH'" in TEPS log - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 TEP Client users cannot see historical data older than 24 hours. Yet it's confirmed that the Warehouse has the actual historical data. The TEPS logs are examined, and after startup of the History component within the TEPS, multiple errors referencing KFW_WH occur. 

SYMPTOM
Errors similar to the following appear in the TEPS RAS1 / trace log ($CANDLEHOME/logs/<hostname_>_cq_<HexTimestamp>-01.log): 

(4F84F6FB.0002-1:ctserver.cpp,1104,"CTServer::startServerDll") KFW1002I Starting Service: 'History v2.0'
(4F84F6FB.0003-1:ctsqlhelperlocal.cpp,142,"_executeLegacySQLEvaluator") Exception: CTQueryAlt::TypeIdInvalid
(4F84F6FB.0004-1:ctsqlhelperlocal.cpp,143,"_executeLegacySQLEvaluator") Unable to locate evaluator for 'KFW_WH'.
(4F84F6FB.0005-1:ctpropertysequence.cpp,716,"CTPropertySequence::Dump") ---> name = queryType
(4F84F6FB.0006-1:ctpropertysequence.cpp,716,"CTPropertySequence::Dump") -----> -1021 = "KFW_WH"
(4F84F6FB.0007-1:ctpropertysequence.cpp,716,"CTPropertySequence::Dump") -----> QUERY_TYPE = "CTSQL::Query"
(4F84F6FB.0008-1:ctsqlhelper.cpp,208,"CTSQLHelper::issueSqlRequest") EXCEPTION: Unknown exception - executeRequest
(4F84F6FB.0009-1:ctsqlhelper.cpp,283,"CTSQLHelper::issueSqlRequestAndFetch") Error: Nil ptr


DIAGNOSING THE PROBLEM
First, it was confirmed that historical data collection configuration was enabled for the attribute groups and nodes / TEMSs that were being examined. 

Next, the Warehouse DB was examined to confirm that there was actually raw historical data present for that attribute group, managed system, and timestamp. 

When that was confirmed, it meant that the problem was not with the Warehouse, but with the TEPS connection to the Warehouse.


RESOLVING THE PROBLEM
The TEPS was reconfigured to confirm it had the proper Warehouse connection name, username, and password. When that was OK, the DB2 database catalog was examined using the "db2 list db directory". The Warehouse database was on a remote system separate from the TEPS, but the Warehouse TCPIP node was not cataloged in the TEPS DB2 node catalog, and the Warehouse remote database was not in the TEPS DB2 database catalog. So the remote Warehouse node and database had to be cataloged in DB2 on the TEPS to allow it to have connectivity to the Warehouse.


Instructions to do this are documented here:

http://publib.boulder.ibm.com/infocenter/tivihelp/v15r1/topic/com.ibm.itm.doc_6.2.3fp1/itm623FP1_install453.htm?path=3_0_3_0_8_2_4_0#catalog [http://publib.boulder.ibm.com/infocenter/tivihelp/v15r1/topic/com.ibm.itm.doc_6.2.3fp1/itm623FP1_install453.htm?path=3_0_3_0_8_2_4_0#catalog]

For example, to catalog the Warehouse node on host "host123", it was first confirmed what port the DB2 instance was configured for on the Warehouse. On the Warehouse database system, the following command was done to get the instance configuration and identify the service port:

db2 get dbm cfg | grep SVCE

This showed output similar to the following:

TCP/IP Service name (SVCENAME) = db2c_db2inst1

On the Warehouse system, the /etc/services file was examined to find the SVCENAME value "db2c_db2inst1" and determine what port it corresponded to:

DB2_db2inst1 50002/tcp

On the TEPS system, this information was used to catalog the remote Warehouse node information:

db2 catalog tcpip node host123 remote host123 server 50002

Then on the TEPS system, the following was done to catalog the remote Warehouse database information:

db2 catalog database warehous as warehous at node host123

Remember that the "as <Name>" value determines what name you need to use when you configure the TEPS and specify the Warehouse name.