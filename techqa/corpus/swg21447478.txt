Title: IBM Setting up your DB2 High Availability (HA) environment on AIX® 7.1 systems - United States

Text:
 PREVENTIVE SERVICE PLANNING

ABSTRACT
 This technote provides information about DB2 product support on AIX 7.1 systems.


CONTENT
Before you begin
You can use any code level of DB2® V9.5 and DB2 V9.7 on AIX® 7.1 systems if you are not using the DB2 High Availability (HA) feature.

If you are using the DB2 HA feature, the DB2 integrated installer provides updated levels of the IBM® Tivoli® System Automation for Multiplatforms (SA MP) and Reliable Scalable Cluster Technology (RSCT) components to support AIX 7.1 systems starting in DB2 V9.5 Fix Pack 6a, DB2 V9.7 Fix Pack 3, and DB2 V9.8 Fix Pack 3. You can apply these DB2 fix packs to enable your HA solutions to work on AIX 7.1 systems.

If you are already using the DB2 HA feature and peer domains are already defined, the DB2 installer will not upgrade the SA MP Base Component. You might see the following error message in the install log:

The DB2 install could not update the IBM Tivoli System Automation for Multiplatforms Base Component (SA MP Base Component) because there exist one or more IBM Reliable Scalable Cluster Technology (RSCT) peer domains. You must manually update the SA MP Base Component. For information about manually updating the SA MP Base Component, see the SA MP Base Component Installation and Configuration Guide.

If you do not want to remove the peer domains and want to upgrade SA MP to a level supported on AIX 7.1 systems, you can use the following instructions rather than having to refer to the SA MP Installation and Configuration Guide.


Note: Please check with your application vendors for any additional dependencies or prerequisites



Migration from SA MP 2.2.x or 3.1.x stream

The following steps should be run as root unless indicated otherwise.


 1. Set the initial configuration on all nodes. On all nodes, set the following environment variables:
    # export CT_MANAGEMENT_SCOPE=2
    # export JAVA_COMPILER=none
    
 2. As instance owner, stop the DB2 instance by running the following command:
    # db2stop force
    
 3. Stop the existing cluster domain by running the following command:
    # stoprpdomain –f <domain_name>
    
 4. Upgrade to the AIX 7.1 operating system.
    
 5. Apply the appropriate DB2 fix pack level (DB2 V9.5 Fix Pack 6a, DB2 V9.7 Fix Pack 3, or DB2 V9.8 Fix Pack 3) by running the following commands:
    # cd <db2_install_file_dir>
    # ./installFixPack -b <db2_base_install_location>
    
 6. Install the SA MP 3.2.0.1 package by running the following commands:
    # cd <db2_install_file_dir>/db2/aix/tsamp/
    # ./installSAM
    
 7. Start the existing cluster domain by running the following commands:
    # startrpdomain <domain_name>


Post-migration steps:  1. Verify the active and installed version number by running the following commands:
    # lssrc -ls IBM.RecoveryRM
    
    Daemon State:
    My Node Name : hostaix701
    Master Node Name : hostaix701 (node number = 1)
    Our IVN : 3.2.0.1
    Our AVN : 2.2.5.7
    
    # lsrpdomain
    Name OpState RSCTActiveVersion MixedVersions TSPort GSPort
    ha Online 2.5.4.0 No 12347 12348
    
    # lsrpnode
    Name OpState RSCTVersion
    hostaix701 Online 3.1.0.1
    hostaix702 Online 3.1.0.1
    
 2. Update the RSCTActiveVersion. Ensure that all the nodes are online before issuing the following command:
    # runact -c IBM.PeerDomain CompleteMigration Options=0
    Resource Class Action Response for CompleteMigration
    
    # lsrpdomain
    Name OpState RSCTActiveVersion MixedVersions TSPort GSPort
    ha Online 3.1.0.1 No 12347 12348
    
 3. Activate the new features and finish the migration by running the following commands:
    # samctrl -m
    Ready to Migrate! Are you Sure? [Y|N]:.
    Y
    # lssrc -ls IBM.RecoveryRM
    
    Daemon State:
    My Node Name : hostaix701
    Master Node Name : hostaix701 (node number = 1)
    Our IVN : 3.2.0.1
    Our AVN : 3.2.0.1
    
    


Note: after installing SA MP 3.2.x, the lssam output may be appended with the following error messages. 
 * 
 * 
 * 
 * 
 * 
 * 

These messages have no functional impact and can be ignored. This defect will be addressed in SA MP APAR IZ89629. 


License for Tivoli SA MP 3.x 

To obtain a license for Tivoli SA MP 3.1 or 3.2: 
1. Go to the Passport Advantage site: http://www.ibm.com/software/howtobuy/passportadvantage/[/support/docview.wss?uid=swg21447478&aid=1] [http://www.ibm.com/software/howtobuy/passportadvantage/] 
2. Download a refreshed DB2 Enterprise Server Edition image or a High Availability feature image. 
3. Each of these images contain a license key for the Tivoli SA MP product. 
4. Copy the license key into the SA MP installation directory's license folder to proceed with SA MP installation. 


Special note for DB2 V9.1 users: 

If you use DB2 V9.1 and you wish to use it with IBM® Tivoli System Automation for Multiplatforms (SA MP) on AIX 7.1, you must do the following steps before you install SA MP: 

1. Download IBM Tivoli SA MP 3.2.1 Fix Pack 1: 
http://www.ibm.com/support/entry/portal/All_download_links/Software/Tivoli/Tivoli_System_Automation_for_Multiplatforms [http://www.ibm.com/support/entry/portal/All_download_links/Software/Tivoli/Tivoli_System_Automation_for_Multiplatforms] 

2. Obtain the license for Tivoli SA MP 3.2:  * 
 * http://www.ibm.com/software/howtobuy/passportadvantage/
 * 
 * 
 * 
 * 
 * Important
 * 
 *  
 * 
 * 
 * 
 * 
 * IBM DB2 9.7, Workgroup Server Edition - CPU Option for AIX® Multilingual eAssembly (CR8PXML)
 * 
 * 
 * 

 * 
 * IBM DB2 9.7 Workgroup Server Edition CPU Option Quick Start and Activation for Linux, UNIX and Windows Multilingual (CZQN9ML)


3. Copy the license key into the SA MP installation directory's license folder. 
4. Proceed with the SA MP installation. 

RELATED INFORMATION
 V9.5: Upgrading IBM Tivoli SA MP Base Component [http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/index.jsp?topic=/com.ibm.db2.luw.admin.ha.doc/doc/t0051367.html]
V9.7: Upgrading IBM Tivoli SA MP Base Component [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/index.jsp?topic=/com.ibm.db2.luw.qb.server.doc/doc/t0051367.html]
Preparing for the DB2 product installation on AIX 7.1 [http://www.ibm.com/support/docview.wss?rs=0&uid=swg21456970]