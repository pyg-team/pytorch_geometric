Title: IBM LI71750: "ADM1826E DB2 CANNOT CONTINUE BECAUSE THE DISK USED FOR LOGGING IS FULL" WITH RAW DEVICE RESULTS IN NO MORE LOGICAL LOGS CREATED - United States

Text:
  A FIX IS AVAILABLE
DB2 UDB Version 8.1 FixPak 16 (also known as Version 8.2 FixPak 9 ) [http://www-01.ibm.com/support/docview.wss?uid=swg24018266]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When the log archive path is full we might hit the following
   error when trying to create a new log file:
   
   MESSAGE : Error rc: 118489315, when initializing log file: 1521
   
   After this message, db2 will attempt to create the file
   again and it will show the following:
   
   MESSAGE : ADM1825W  DB2 cannot create the next log file because
   of a user exit problem.
   
   These errors can be solved by freeing up space in the log
   archive path, allowing the database to continue.
   
   If however, we hit the following error using raw device for
   active logs:
   
   FUNCTION: DB2 UDB, data protection, sqlpgCallGIFL, probe:1540
   MESSAGE : ADM1826E  DB2 cannot continue because the disk used
   for logging is full.
   
   The database will not be able to create a new log anymore. This
   will result in serious crash recovery issues, as on recovery the
   database will attempt to find the logs that it did not create.
   
   We might hit indoubt transactions as a side effect, if the log
   full condition occurs just before an attempt to write commit
   records to the log:
   
   MESSAGE : In-doubt transaction(s) exists at the end of crash
   recovery.
   
   We will get a hung on the command LIST INDOUBT TRANSACTIONS and
   also the system will not be able to clear up the transactions.
   
   For the above to happen we have to meet all the following
   conditions:
   
   1. The active log path is a raw device. The archive log path
   LOGARCHMETH1 is set up. The db config parameter BLK_LOG_DSK_FUL
   is set to YES.
   
   2. The LOGPRIMARY is set to the maximum number of log files that
   can be hold in a raw device.
   
   3. The archive log path was full, then some space was freed up
   in the archive log path.
   
   
    
   
   

LOCAL FIX
 *  Assuming that a raw device can hold at most N log files in it,
   set LOGPRIMARY to N-1.
   
   Setting  BLK_LOG_DSK_FUL to NO will also avoid the problem.
   
   
    
   
   

PROBLEM SUMMARY
 *  User affected: ALL
   Problem Description: "ADM1826E DB2 CANNOT CONTINUE BECAUSE THE
   DISK USED FOR LOGGING IS FULL" WITH RAW DEVICE RESULTS IN NO
   MORE LOGICAL LOGS CREATED
   
   Problem Summary:
   When the log archive path is full we might hit the following
   error when trying to create a new log file:
   
   MESSAGE : Error rc: 118489315, when initializing log file: 1521
   
   After this message, db2 will attempt to create the file
   again and it will show the following:
   
   MESSAGE : ADM1825W  DB2 cannot create the next log file because
   of a user exit problem.
   
   These errors can be solved by freeing up space in the log
   archive path, allowing the database to continue.
   
   If however, we hit the following error using raw device for
   active logs:
   
   FUNCTION: DB2 UDB, data protection, sqlpgCallGIFL, probe:1540
   MESSAGE : ADM1826E  DB2 cannot continue because the disk used
   for logging is full.
   
   The database will not be able to create a new log anymore. This
   will result in serious crash recovery issues, as on recovery the
   database will attempt to find the logs that it did not create.
   
   We might hit indoubt transactions as a side effect, if the log
   full condition occurs just before an attempt to write commit
   records to the log:
   
   MESSAGE : In-doubt transaction(s) exists at the end of crash
   recovery.
   
   We will get a hung on the command LIST INDOUBT TRANSACTIONS and
   also the system will not be able to clear up the transactions.
   
   For the above to happen we have to meet all the following
   conditions:
   
   1. The active log path is a raw device. The archive log path
   LOGARCHMETH1 is set up. The db config parameter BLK_LOG_DSK_FUL
   is set to YES.
   
   2. The LOGPRIMARY is set to the maximum number of log files that
   can be hold in a raw device.
   
   3. The archive log path was full, then some space was freed up
   in the archive log path.
   
   
    
   
   

PROBLEM CONCLUSION
 *  First fixed in DB2 UDB Version 8.1, FixPak 16
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   LI71750
   
   
 * REPORTED COMPONENT NAME
   DB2 UDE ESE LIN
   
   
 * REPORTED COMPONENT ID
   5765F4104
   
   
 * REPORTED RELEASE
   810
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-11-20
   
   
 * CLOSED DATE
   2008-02-06
   
   
 * LAST MODIFIED DATE
   2008-02-06
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    LI71840
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 UDE ESE LIN
   
   
 * FIXED COMPONENT ID
   5765F4104
   
   

APPLICABLE COMPONENT LEVELS
 * R810 PSY
   UP
   
   
 * R820 PSY
   UP