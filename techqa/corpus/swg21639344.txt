Title: IBM WebSphere does not start with Information Server installed after changing the JVM working directory - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After changing the JVM working directory the WebSphere application server does not start when Information Server is installed. 

SYMPTOM
The SystemOut.log contains a stack trace such as the following: 

[5/1/13 10:26:21:165 MST] 00000000 ContainerHelp E WSVR0501E: Error creating component null [class com.ibm.ws.security.core.SecurityComponentImpl]
java.lang.ExceptionInInitializerError
at java.lang.J9VMInternals.initialize(J9VMInternals.java:250)
at com.ascential.acs.security.directory.ASBDirectory.<init>(ASBDirectory.java:45)
at java.lang.J9VMInternals.newInstanceImpl(Native Method)
at java.lang.Class.newInstance(Class.java:1357)
at com.ibm.is.isf.j2ee.impl.was.security.WASCustomUserRegistry.initialize(WASCustomUserRegistry.java:88)
at com.ibm.ws.security.registry.UserRegistryImpl.initializeCustomImpl(UserRegistryImpl.java:258)
at com.ibm.ws.security.registry.UserRegistryImpl.initialize(UserRegistryImpl.java:192)
...
Caused by: java.lang.NullPointerException
at com.ascential.acs.security.repository.ASBRepositoryFactoryImpl.<clinit>(ASBRepositoryFactoryImpl.java:64)
at java.lang.J9VMInternals.initializeImpl(Native Method)
at java.lang.J9VMInternals.initialize(J9VMInternals.java:228)

or
[9/15/15 5:53:01:961 CDT] 00000001 UserRegistryC E SECJ0281E: Error creating user registry object. The exception is java.lang.RuntimeException: java.lang.ClassNotFoundException: com.ibm.iis.isf.security.directory.ASBDirectoryImpl
at com.ibm.iis.isf.security.repository.ASBRepositoryFactoryImpl.createASBDirectory(ASBRepositoryFactoryImpl.java:164)
at com.ibm.iis.isf.security.directory.ASBDirectory.<init>(ASBDirectory.java:35)
at java.lang.J9VMInternals.newInstanceImpl(Native Method)
at java.lang.Class.newInstance(Class.java:1776)
at com.ibm.iis.isf.j2ee.impl.was.security.WASCustomUserRegistry.initialize(WASCustomUserRegistry.java:82)
...
Caused by: java.lang.ClassNotFoundException: com.ibm.iis.xmeta.datamgmt.ca.AbstractValueValidationDetails
at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:506)
at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:422)
at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:410)
at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:107)
at java.lang.ClassLoader.loadClass(ClassLoader.java:827)
... 48 more 

This can occur for both an application server as well as a node agent.


CAUSE
There are two known causes:

1. The JVM working directory is not configured correctly. Information Server has a dependency on the JVM working directory being set to the profile directory. By default, the JVM working directory is set to the profile directory when the profile is created, but it can later be changed by the end user.

2. The user ID that started the WebSphere server does not have access to the Information Server shared libraries. The user ID that starts the server needs access to the Information Server shared libraries that were installed in the profile directory.


DIAGNOSING THE PROBLEM
If the JVM working directory is changed prior to installing Information Server, WebSphere will start properly. However, the Information Server installation will fail after it has started to install to WebSphere. 

If the JVM working directory is changed after installing Information Server, WebSphere will fail on the next attempt to start it. 

This issue can occur on both a WebSphere standalone profile configuration as well as a WebSphere cluster configuration. In either case, examine the SystemOut.log(s) for the specified stack trace. 

If the user ID that starts the server does not have access to the Information shared libraries, WebSphere will fail to start. 

The shared library directories for Information Server versions 11.3 and later are located in: 

 <WAS profile directory>/lib/iis 

The shared library directory for Information Server versions 9.2.1 and earlier are located in: 

 <WAS profile directory>/informationServer/apps/lib


RESOLVING THE PROBLEM
By default, the JVM working directory is set to the WebSphere variable ${USER_INSTALL_ROOT}, which in turn is set to the profile directory. Therefore, to resolve this issue, ensure that the Websphere variable USER_INSTALL_ROOT points to the profile directory. Then, change the value of the JVM working directory to ${USER_INSTALL_ROOT} for each of the WebSphere application servers. For 9.1 and earlier you also have to update the Deployment manager and node agents. 


Login to the WebSphere Integrated Solutions Console as the WAS administrator and locate the respective Working directory text box for each JVM process using the following navigation guide:

Application server(s):
Servers->Server Types->WebSphere application servers-><serverName>
Java and Process Management->Process definition

On a cluster configuration for 9.1 and earlier, the deployment manager and each node agent must also be changed to the default setting of {$USER_INSTALL_ROOT}:

Deployment Manager:
System administration->Deployment manager
Java and Process Management->Process definition

Node Agent(s):
System administration->Node agents-><nodeagentName>
Java and Process Management->Process definition

where <serverName> is the name of the application server and <nodeAgentName> is the name of the nodeagent. Save all the changes and then restart all the WebSphere JVM processes.

If the issue is caused by the user ID that starts WebSphere not having access to the InformationServer shared libraries, then change the directory permissions so the user can access the contents of the shared library directory.