Title: IBM IV10433: SRM UPGRADE PROBLEM FROM 7.1.0.2 TO 7.1.0.6 AND MBS 7.1.1.4 TO 7.1.1.9 ON DB2 V9.1 FP 05 - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS FIXED IF NEXT.
    
   
   

ERROR DESCRIPTION
 *  While upgrading an existing environment to TSRM 7.1.0.6
   The 7104_07 script it is trying to add securityrestrict table
   data, one column of which... srestrictnum.... already has a
   value of 1024 for an entry from workorder object which appears
   to be hard coded into the script. Looking at the customer
   environment, the srestrictnum table has several hundred entries
   from their use of the application and our built-in deployed
   restrictions. The value 1023 is blank, but 1024 and up are not.
   Believe this should not be hard coded but maybe "nextval for"
   or something more tied to SC? I noted values that look like
   other Maximo teams did that with CTGxxxxxxx as an example.
   
   How many other scripts might also be hard coded?
   FROM THE UPDATEDB log....
   
    Loading from
   D:\IBM\SMP\maximo\tools\maximo\en\pmsc\V7104_07.content\shopping
   \pmscmrspecsecurityrestrict.xml
   Importing or updating objects from
   D:\IBM\SMP\maximo\tools\maximo\en\pmsc\V7104_07.content\shopping
   \pmscmrspecsecurityrestrict.xml
   .
   SQL = [insert into securityrestrict (
   securityrestrictid,objectname,attributename,reevaluate,restricti
   on,conditionnum,type,srestrictnum) values (nextval for
   SECURITYRESTRICTSEQ,?,?,?,?,?,?,?)]
    parameter[1]=PMSCMRSPECV
    parameter[2]=ALN1
    parameter[3]=1
    parameter[4]=READONLY
    parameter[5]=ROALN1
    parameter[6]=ATTR
    parameter[7]=1023
   1 rows affected.
   .
   SQL = [insert into securityrestrict (
   securityrestrictid,objectname,attributename,reevaluate,restricti
   on,conditionnum,type,srestrictnum) values (nextval for
   SECURITYRESTRICTSEQ,?,?,?,?,?,?,?)]
    parameter[1]=PMSCMRSPECV
    parameter[2]=ALN2
    parameter[3]=1
    parameter[4]=READONLY
    parameter[5]=ROALN2
    parameter[6]=ATTR
    parameter[7]=1024
   WARNING: caught One or more values in the INSERT statement,
   UPDATE statement, or foreign key update caused by a DELETE
   statement are not valid because the primary key, unique
   constraint or unique index identified by "6" constrains table
   "MAXIMO.SECURITYRESTRICT" from having duplicate values for the
   index key.. SQLCODE=-803, SQLSTATE=23505, DRIVER=3.59.81
   
   SQL = [insert into securityrestrict (
   securityrestrictid,objectname,attributename,reevaluate,restricti
   on,conditionnum,type,srestrictnum) values (nextval for
   SECURITYRESTRICTSEQ,?,?,?,?,?,?,?)]
    parameter[1]=PMSCMRSPECV
    parameter[2]=ALN2
    parameter[3]=1
    parameter[4]=READONLY
    parameter[5]=ROALN2
    parameter[6]=ATTR
    parameter[7]=1024
   
   com.ibm.db2.jcc.am.SqlIntegrityConstraintViolationException: One
   or more values in the INSERT statement, UPDATE statement, or
   foreign key update caused by a DELETE statement are not valid
   because the primary key, unique constraint or unique index
   identified by "6" constrains table "MAXIMO.SECURITYRESTRICT"
   from having duplicate values for the index key.. SQLCODE=-803,
   SQLSTATE=23505, DRIVER=3.59.81
    at com.ibm.db2.jcc.am.dd.a(dd.java:672)
    at com.ibm.db2.jcc.am.dd.a(dd.java:60)
    at com.ibm.db2.jcc.am.dd.a(dd.java:127)
    at com.ibm.db2.jcc.am.bn.b(bn.java:2231)
    at com.ibm.db2.jcc.am.bn.c(bn.java:2214)
    at com.ibm.db2.jcc.t4.cb.k(cb.java:355)
    at com.ibm.db2.jcc.t4.cb.a(cb.java:61)
    at com.ibm.db2.jcc.t4.q.a(q.java:50)
    at com.ibm.db2.jcc.t4.sb.b(sb.java:218)
    at com.ibm.db2.jcc.am.cn.lc(cn.java:2880)
    at com.ibm.db2.jcc.am.cn.b(cn.java:3821)
    at com.ibm.db2.jcc.am.cn.cc(cn.java:715)
    at com.ibm.db2.jcc.am.cn.executeUpdate(cn.java:698)
    at
   com.ibm.ism.pmcom.content.ImportObject.doDbInsert(ImportObject.j
   ava:584)
    at
   com.ibm.ism.pmcom.content.ImportObject.importObjectData(ImportOb
   ject.java:283)
    at
   com.ibm.ism.pmcom.content.ImportObject.importFile(ImportObject.j
   ava:1753)
    at
   com.ibm.ism.pmcom.content.XmlLoader.loadContent(XmlLoader.java:6
   6)
    at
   com.ibm.ism.pmcom.script.XmlAutoUpgrade.processContent(XmlAutoUp
   grade.java:774)
    at
   com.ibm.ism.pmcom.script.XmlAutoUpgrade.process(XmlAutoUpgrade.j
   ava:172)
    at psdi.pmsc.en.V7104_07.process(V7104_07.java:75)
    at psdi.script.AutoUpgradeTemplate.<init>(Unknown Source)
    at
   com.ibm.ism.pmcom.script.PmpAutoUpgradeTemplate.<init>(PmpAutoUp
   gradeTemplate.java:163)
    at
   com.ibm.ism.pmcom.script.XmlAutoUpgrade.<init>(XmlAutoUpgrade.ja
   va:71)
    at psdi.pmsc.en.V7104_07.<init>(V7104_07.java:46)
    at
   sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native
   Method)
    at
   sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeCons
   tructorAccessorImpl.java:67)
    at
   sun.reflect.DelegatingConstructorAccessorImpl.newInstance(Delega
   tingConstructorAccessorImpl.java:45)
    at
   java.lang.reflect.Constructor.newInstance(Constructor.java:522)
    at psdi.tools.UpdateDB.runScriptClass(Unknown Source)
    at psdi.tools.UpdateDB.runScripts(Unknown Source)
    at psdi.tools.UpdateDB.startProcess(Unknown Source)
    at psdi.tools.UpdateDB.startProcess(Unknown Source)
    at psdi.tools.UpdateDB.loadScriptInfo(Unknown Source)
    at psdi.tools.UpdateDB.main(Unknown Source)
   
   -- BEGINUPDATEDBERROR
   -- Error running file: V7104_07
   -- UPDATEDBFILE:V7104_07.class
   -- Script: Error
   java.lang.Exception: One or more values in the INSERT statement,
   UPDATE statement, or foreign key update caused by a DELETE
   statement are not valid because the primary key, unique
   constraint or unique index identified by "6" constrains table
   "MAXIMO.SECURITYRESTRICT" from having duplicate values for the
   index key.. SQLCODE=-803, SQLSTATE=23505, DRIVER=3.59.81
    at psdi.tools.UpdateDB.runScriptClass(Unknown Source)
    at psdi.tools.UpdateDB.runScripts(Unknown Source)
    at psdi.tools.UpdateDB.startProcess(Unknown Source)
    at psdi.tools.UpdateDB.startProcess(Unknown Source)
    at psdi.tools.UpdateDB.loadScriptInfo(Unknown Source)
    at psdi.tools.UpdateDB.main(Unknown Source)
   
   java.lang.Exception: DATABASE Script UPDATE COMPLETED WITH
   ERROR. CHECK ERRORS IN UPDATE LOG FILE
   -Updatedb20111103115913.log
   One or more values in the INSERT statement, UPDATE statement, or
   foreign key update caused by a DELETE statement are not valid
   because the primary key, unique constraint or unique index
   identified by "6" constrains table "MAXIMO.SECURITYRESTRICT"
   from having duplicate values for the index key.. SQLCODE=-803,
   SQLSTATE=23505, DRIVER=3.59.81
    at psdi.tools.UpdateDB.startProcess(Unknown Source)
    at psdi.tools.UpdateDB.startProcess(Unknown Source)
    at psdi.tools.UpdateDB.loadScriptInfo(Unknown Source)
    at psdi.tools.UpdateDB.main(Unknown Source)
   
   
    
   
   

LOCAL FIX
 *  Looks like there is a problem with script file
   pmscmrspecsecurityrestrict.xml. This script inserts about
   60 records into the SECURITYRESTRICT table.  The SRESTRICTNUM
   value specified in the xml file is not unique.  The workaround
   is to update each entry in this file making the SRESTRICTNUM
   value unique.  The values should be prefixed with 'CTGRC' and
   not confict with any other SECURITYRESTRICT data loaded by
   other Service Catalog scripts.
   
   Here are the steps to fix the problem:
   
   1) Edit pmscmrspecsecurityrestrict.xml in the
   ServCatPMPDeploy.zip file
   
   2) Set the value of SRESTRICTNUM using the following range
   of values:
   
   CTGRC9000...CTGRC9060
   
   3) Rerun the install
   
   This problem should bet fixed in the next 7.1 fixpack.
   
   
    
   
   

PROBLEM SUMMARY
 *  SRM UPGRADE PROBLEM FROM 7.1.0.2 TO 7.1.0.6 AND  MBS 7.1.1.4 TO
   7.1.1.9 ON DB2 V9.1 FP 05
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV10433
   
   
 * REPORTED COMPONENT NAME
   PRODUCT INSTALL
   
   
 * REPORTED COMPONENT ID
   5724R46IT
   
   
 * REPORTED RELEASE
   721
   
   
 * STATUS
   CLOSED FIN
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2011-11-09
   
   
 * CLOSED DATE
   2012-01-06
   
   
 * LAST MODIFIED DATE
   2012-01-06
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TIV SERVICE CAT
   
   
 * FIXED COMPONENT ID
   5724S85C0
   
   

APPLICABLE COMPONENT LEVELS
 * R710 PSY
   UP