Title: IBM HPR Automatic Path Switch messages may become obtrusive - United States

Text:
PSWEIGHT; PSRETRY TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Path switch messages may become obtrusive when frequent HPR automatic path switches occur and multiple equal-weight path switches are available. 

SYMPTOM
Consider the following scenario: 

 1. A failure occurs on the preferred path 
 2. The HPR pipe switches to a backup path automatically 
 3. The preferred path recovers 
 4. Will the HPR pipe return to the preferred path? 


With the original VTAM HPR implementation in VTAM V4R3, there was no automatic trigger to move the pipe(s) back to the preferred path. VTAM V4R4 (CS for OS/390 V1R3) introduced the PSRETRY start option to provide a mechanism to force the RTP function to periodically look for a new route, thereby providing a means to switch the pipe(s) back to the preferred path.  * PSRETRY is a start option which determines how often the VTAM RTP endpoint will look for an alternate route. 
 * PSRETRY has four values, each one a time interval to be applied to all pipes of that transmission-priority. 
 * Example: PSRETRY=(1M,2M,5M,10M). This tells VTAM that RTP pipes using network priority should look for an alternate route once per minute, RTP pipes using high priority should look once every two minutes, etc. 
 * Default is (0,0,0,0) which disables the function for all four transmission priorities. 


While PSRETRY is a valuable function that has been very popular with VTAM users, the configuration below illustrates a common concern: What if multiple "equal-weight" paths are available? 

The default behavior if PSRETRY is enabled is to switch between the equal-weight paths randomly. Why does this happen? Each time the RTP asks the routing component for a route, if multiple equal-weight paths are available, the routing component will return one randomly. If the route returned is not the same as the one currently in use, a path switch will be initiated. 

A number of VTAM users expressed concern with the above behavior. While the performance ramifications of the extra path switches should not be too much of a concern, many customers find the frequent path switch messages to be obtrusive.


RESOLVING THE PROBLEM
Of course, these messages may be suppressed using VTAM's message flooding table. However, another alternative is provided: the PSWEIGHT start option. 

 

 * PSWEIGHT allows for the specification of a preference to switch only to a better (lower-weight) route. This reduces (but does not eliminate) switching between equal-weight routes. In many cases, each RTP will still undergo one path switch during which the RTP "learns" the weight of the path. 
 * The PSWEIGHT choices are:

 *  LESSTHAN: Only switch if the new route has a weight less than the weight of the existing route. This is the default once the PSWEIGHT PTF is applied. EQUAL: Switch as long as the new route is different than the old route, regardless of whether the new weight is equal to or less than the old weight. (This was the behavior prior to introduction of the PSWEIGHT option.) 
 *  SAMEROUT: Switch to the new route even if it appears to be the same APPN path as the old route. Why would you choose this option? If there are VR-TG's on the path, or CNN's with multiple paths within them, the sending of the route setup flow (which accompanies a path switch) will redrive VR selection, allowing for a better VR to be chosen if available. So, while the "APPN" path does not change, the actual physical path might change.