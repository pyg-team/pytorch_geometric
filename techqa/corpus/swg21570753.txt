Title: IBM EJPDB0101E, EJPDB0118I, and StaleConnectionException - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
Portal server is configured to use Oracle database. During high load the connection between the Oracle drivers and server is dropped. The WebSphere Portal SystemOut.log file shows following errors. 

com.ibm.wps.datastore.domains.DomainUnavailableException: EJPDB0101E: Database domain [Domain: jcr] is currently unavailable. 

com.ibm.wps.datastore.domains.DomainUnavailableException: EJPDB0101E: Database domain [Domain: rel] is currently unavailable. 

com.ibm.wps.datastore.domains.DomainUnavailableException: EJPDB0101E: Database domain [Domain: comm] is currently unavailable. 

After some time, the connection is reestablished with the following messages in the SystemOut.log file

[9/27/11 15:43:13:036 EDT] 00000171 DatabaseDomai I com.ibm.wps.datastore.domains.impl.DatabaseDomainFactoryInternalresetDatabaseDomainStatus EJPDB0118I: Database domain [Domain: rel] is available again. 

[9/27/11 15:43:13:088 EDT] 0000016e DatabaseDomai I com.ibm.wps.datastore.domains.impl.DatabaseDomainFactoryInternalresetDatabaseDomainStatus EJPDB0118I: Database domain [Domain: comm] is available again. 

[9/27/11 15:43:20:443 EDT] 0000016f DatabaseDomai I com.ibm.wps.datastore.domains.impl.DatabaseDomainFactoryInternalresetDatabaseDomainStatus EJPDB0118I: Database domain [Domain: jcr] is available again. 


StaleConnectionException is also seen in the SystemOut.log file. 


CAUSE
The exception of interest is the following: 

 com.ibm.websphere.ce.cm.StaleConnectionException: Io exception: The Network Adapter could not establish the connectionDSRA0010E: SQL State = null, Error Code = 17,002 
The error code 17,002 is WebSphere Application Server parsing...that's really a ORA-17002 error code defined by the Oracle. The error above indicates that connection went bad between Oracle driver and database server.


RESOLVING THE PROBLEM
The following Oracle parameters are recommended by Oracle support to be set to zero in sqlnet.ora file 


SQLNET.EXPIRE_TIME 
SQLNET.INBOUND_CONNECT_TIMEOUT 
INBOUND_CONNECT_TIMEOUT_listener_name 

For detailed information and queries about these parameters see the link below and contact Oracle support

http://download.oracle.com/docs/cd/B19306_01/network.102/b14213/sqlnet.htm [http://download.oracle.com/docs/cd/B19306_01/network.102/b14213/sqlnet.htm]