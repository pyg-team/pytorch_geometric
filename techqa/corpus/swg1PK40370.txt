Title: IBM PK40370: THE DEAD LETTER PROCESSING IN JMS CLASS MQQUEUEAGENTTHREAD NEEDS IMPROVEMENT - United States

Text:
z/os SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS DUPLICATE OF ANOTHER APAR.
    
   
   

ERROR DESCRIPTION
 *  When MQQueueAgentThread puts a message to the Dead Letter Queue
   (DLQ), the information in the Dead Letter Header (DLH) is not
   always enough to easily determine the cause of the message going
   to the DLQ.  Such messages have
     PutApplName = 'MQ JMS ConnectionConsumer   '.
   MQQueueAgentThread monitors a queue for an MDB listener.
   .
   For example:
   Intermittently, a message put by a JMS program goes to the DLQ
   with Reason Code 2030 MQRC_MSG_TOO_BIG_FOR_Q.  The MAXMSGL for
   the queue shown in the message is large enough for the message.
   The Dead Letter Handler (CSQUDLQH) is able to put the message to
   that queue.
   .
   RC2030 is related to the putting of a message.  The
   circumstances where MQQueueAgentThread would put a message to
   the dead letter queue following a failed put is as follows:
   1) The message is successfully PUT to a queue by an application.
   2) The message is retrieved by an MDB listener, but fails to be
   processed and is backed out 1 or more times.
   3) When the backout count reaches the backout threshold
   (BOTHRESH) for the queue, the MQQueueAgentThread attempts to
   requeue the message to the queue identified in the backout
   requeue name (BOQNAME) of the original queue.
   4) If the backout queue has a max message length smaller than
   the size of the message, this PUT will fail with a 2030 reason
   code.
   5) Dead letter processing is driven, and the message is put to
   the dead letter queue with a reason of 2030.
   .
   This situation is not obvious because the dead letter processing
   in MQQueueAgentThread always sets the destination queue in the
   DLH to the queue that the MQQueueAgent is monitoring, even if
   the error occurred on another queue.
   .
   Additional keywords:
   WebSphere Application Server WAS X'07EE' 07EE 000007EE
   
   
    
   
   

LOCAL FIX
 *  For the RC2030 scenario described above, set the MAXMSGL of the
   backout queue to be at least as large as that of the original
   queue.
   
   
    
   
   

PROBLEM SUMMARY

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS
 *  Problem summary:
   When a candidate message for an MDB has exceeded the backout
   threshold for the queue, the MDB listener will attempt to move
   it to the backout queue.
   If the put to the backout queue fails, then the message is put
   on the dead letter queue. The reason code given in the dead
   letter header is the reason for the failure of the put to the
   backout queue, but the queue name specified is that of the
   queue which the message originally came from.
   Problem resolution:
   The dead letter processing in MQQueueAgentThread has been
   changed to complete the dead letter header using the queue name
   corresponding to the failure reported by the reason code.
   This fix changes the Java component of MQ, and will be
   included in FixPack 6.0.2.3 (PK47040 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK47040]).
   
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   PK40370
   
   
 * REPORTED COMPONENT NAME
   WMQ Z/OS V6
   
   
 * REPORTED COMPONENT ID
   5655L8200
   
   
 * REPORTED RELEASE
   008
   
   
 * STATUS
   CLOSED DUB
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-03-02
   
   
 * CLOSED DATE
   2007-10-12
   
   
 * LAST MODIFIED DATE
   2008-02-20
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PK32885 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK32885]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS