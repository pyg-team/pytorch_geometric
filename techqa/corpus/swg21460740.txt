Title: IBM Database connection errors when starting a new instance with remote database using a non-default port - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You see database connection errors when you start a new instance that was created with the 
Remote Database, Existing Database options and that uses a non-default port.

[jcc][t4][2043][11550][4.7.118] Exception java.net.ConnectException: Error opening socket to server taranis21.torolab.ibm.com/9.26.31.189 on port 50,000 with message: Connection refused: connect. ERRORCODE=-4499. 

DIAGNOSING THE PROBLEM
The server fails to start and you notice database connection errors when you attempt to start a new instance that was created with the remote database, existing database options and that uses a non-default port. The error looks similar to the following:


[1/24/11 13:11:35:763 EST] 0000000f JDBCPersister W CNTR0031W: Error starting CMP bean WC_pmrtest#Enablement-RelationshipManagementData.jar#AlternativeLanguage: 
com.ibm.ejs.persistence.EJSPersistenceException: ; nested exception is: 
com.ibm.websphere.ce.cm.StaleConnectionException: [jcc][t4][2043][11550][4.7.118] Exception java.net.ConnectException: Error opening socket to server taranis21.torolab.ibm.com/9.26.31.189 on port 50,000 with message: Connection refused: connect. ERRORCODE=-4499, SQLSTATE=08001DSRA0010E: SQL State = 08001, Error Code = -4,499
at com.ibm.ejs.persistence.EJSJDBCPersister.initialize(EJSJDBCPersister.java:390)
at ...
Caused by: com.ibm.websphere.ce.cm.StaleConnectionException: [jcc][t4][2043][11550][4.7.118] Exception java.net.ConnectException: Error opening socket to server taranis21.torolab.ibm.com/9.26.31.189 on port 50,000 with message: Connection refused: connect. ERRORCODE=-4499, SQLSTATE=08001DSRA0010E: SQL State = 08001, Error Code = -4,499
at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:56)
at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:39)
at ...
... 90 more
---- Begin backtrace for Nested Throwables
java.sql.SQLNonTransientException: [jcc][t4][2043][11550][4.7.118] Exception java.net.ConnectException: Error opening socket to server taranis21.torolab.ibm.com/9.26.31.189 on port 50,000 with message: Connection refused: connect. ERRORCODE=-4499, SQLSTATE=08001DSRA0010E: SQL State = 08001, Error Code = -4,499
at com.ibm.db2.jcc.am.dd.a(dd.java:319)
at com.ibm.db2.jcc.am.dd.a(dd.java:337)
at ...
Caused by: java.net.ConnectException: Connection refused: connect
at java.net.PlainSocketImpl.socketConnect(Native Method)
at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:363)
at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:225)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:212)
at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:377)
at java.net.Socket.connect(Socket.java:539)
at com.ibm.db2.jcc.t4.y.run(y.java:34)
at java.security.AccessController.doPrivileged(AccessController.java:251)
at com.ibm.db2.jcc.t4.xb.a(xb.java:372)
... 113 more


RESOLVING THE PROBLEM
There is an error in the code that causes the port that was entered in the Configuration Manager during instance creation to not be used. The default port is used instead. 

To resolve the problem: 

 1. Edit the createInstance.properties file under the CommerceServer70\instances\<instancename>\properties directory and update the port number
    
    # Remote database server port
    #-----------------------------
    dbServerPort=50001
    
 2. Using the WebSphere Administrator Console, edit the WebSphere Commerce Data Source [http://publib.boulder.ibm.com/infocenter/wasinfo/v7r0/index.jsp?topic=/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/tdat_ccrtpds.html] and
    correct the port number.
    
    [/support/docview.wss?uid=swg21460740&amp;aid=1] 
 3. Correct the DBServerPort setting instance configuration file [http://publib.boulder.ibm.com/infocenter/wchelp/v7r0m0/index.jsp?topic=/com.ibm.commerce.admin.doc/concepts/ccmxml.htm] and restart the server
    
    <DB CreateDB="false"
    DBAName=""
    DBAPwd=""
    DBHost="taranis21.torolab.ibm.com"
    DBMSName="DB2"
    DBNode=""
    DBServerPort="50001" 
 4. For consistency, propagate the change to the WebSphere Commerce configuration [http://publib.boulder.ibm.com/infocenter/wchelp/v7r0m0/index.jsp?topic=/com.ibm.commerce.admin.doc/tasks/tcmxml.htm] file
    in the EAR.





Cross Reference information Segment Product Component Platform Version Edition Commerce WebSphere Commerce - Express Configuration Linux, Windows 7.0 Express Commerce WebSphere Commerce Professional Edition Maintenance AIX, Linux, Solaris, Windows 7.0 Professional Edition