Title: IBM Timeout or Deadlock with a Mediation Flow component - United States

Text:
v612rnotes; esb612rnotes; timeout; deadlock; v62rnotes; esb62rnotes TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Timeout or Deadlock can occur when invoking a service using a Mediation Flow component. 

SYMPTOM
A service invocation by a Mediation Flow component fails to complete. If you have set a timeout for a Service Invoke primitive, then the timeout terminal will fire. If you use a Callout node with a timeout, then the fail terminal of the Callout response node will fire. If you have not set a timeout, then the invocation by the Service Invoke primitive or the Callout node will remain in a deadlock state.


CAUSE
The deadlock or timeout occurs when the mediation flow is operating under a transaction, and the 'Asynchronous invocation' qualifier for the reference used by the Service Invoke or Callout has a value 'Commit'. When this value is set, the request to the service is not sent until the transaction completes, normally when the Mediation Flow completes. However, if a request-response operation is attempted, under some conditions the Mediation Flow awaits the response from the service before continuing. When this occurs, the deadlock or timeout results.

DIAGNOSING THE PROBLEM
If a deadlock or unexpected timeout occurs when a Mediation Flow component performs a service invocation, then review the transactional setting for the Mediation Flow component, and the setting of the 'Asynchronous invocation' qualifier for the reference used by the Service Invoke or Callout. Also, review the invocation style that might be used by inspecting the tables provided in the following product documentation pages: 

The 'Invocation style options' for the Service Invoke primitive [https://www.ibm.com/support/knowledgecenter/SS7J6S_7.0.0/com.ibm.wbit.help.mediation.doc/topics/tinvokesi.html]are listed in Table 1 of the product documentation.


The 'Invocation style options' for the Callout node [http://www.ibm.com/support/knowledgecenter/SSQH9M_7.0.0/com.ibm.wbit.help.mediation.doc/topics/rcallout.html] can be found in Table 2 of the information link.


The deadlock or timeout will occur when Mediation Flow operates under a transaction, the 'Asynchronous invocation' qualifier for the reference has a value 'Commit', a request-response operation is invoked, and the invocation style (from the tables referenced in the product documentation pages) has a value 'Async'. 


RESOLVING THE PROBLEM
The problem can be avoided by either changing the 'Asynchronous invocation' qualifier for the reference to a value 'Call', or by changing the resulting invocation style from 'Async' to either 'Sync' or 'AsyncWithCallback'. 

 Note that, for a reference qualifier value 'Call', if a failure causes the Mediation Flow component to roll back and then retry, a duplicate service invocation will be sent by the Mediation Flow component. 

 


Cross reference information Segment Product Component Platform Version Edition Business Integration WebSphere Enterprise Service Bus AIX, HP-UX, i5/OS, Linux, Solaris, Windows, z/OS 6.1.2 Business Integration WebSphere Process Server Mediation AIX, HP-UX, Linux, Solaris, Windows, z/OS, i5/OS 6.1.2 Business Integration WebSphere Integration Developer Mediation Flow Editor Linux, Windows 6.1.2 
PRODUCT ALIAS/SYNONYM
 WESB WPS WID