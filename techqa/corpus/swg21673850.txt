Title: IBM.Test resource creation / deletion trace messages - United States

Text:
tsa; tsamp; IBM.TestRM; Reintegrate; UserInitiatedMove; VirtualOffline TECHNOTE (FAQ)

QUESTION
 The DB2 engine and the DB2 automation scripts often create and remove IBM.Test resources as temporary flags for actions like "user initiated move" or "re-integration". Since the IBM.Test resources are managed by TSAMP's IBM.TestRM daemon, where can we find trace entries that show the creation or deletion of a IBM.Test resource ? 

ANSWER
For a given domain, for example, "mydomain", the relevant trace file for the IBM.TestRM daemon can be found in :
/var/ct/mydomain/log/mc/IBM.TestRM/

The trace file would need to be formatted to be human readable. Preferably it should be formatted on the client's system since it needs to be formatted with trace templates from the same TSAMP/RSCT versions and also to ensure date/time stamps are specific to the client's timezone. The TSAMP data collector, "getsadata" knows where to find and format this trace file and it is included in the collection when running 'getsadata -all'. If formatting the trace file independent of getsadata, then run the following :

rpttr -odtic /var/ct/mydomain/log/mc/IBM.TestRM/trace > TestRM_trace.out


Within the IBM.TestRM "trace" file, the creation of a new IBM.Test resource starts with the following message :
_RMFRMRccp::DefineResource Entered,

There is likely to be a couple hundred lines of messages before you then see the following trace message that ends the creation process for a new IBM.Test resource :
_RMFRMRccp::DefineResource Leaving

Between the "Entered" and "Leaving" messages, usually a few lines down from the "Entered" message, there will be a message that contains the name of the IBM.Test resource, so you can search on the name of the resource to get your bearings... here's an example:
_RMF [4] attrid=1 CT_CHAR_PTR value="db2_MYHADRDB_node01_Reintegrate_db2inst1_db2inst1" 




For the deletion of an IBM.Test resource, you would see a whole bunch of trace messages, starting with :

RMRccp::UndefineResources Entered

... and ending with :
_RMFRMRccp::UndefineResources Leaving

Unfortunately you will not be able to search for the IBM.Test resource by "Name" when it comes to the deletion operation ... its Resource Handle (RH) is used instead. However the RH can be found from the trace messages present in the "DefineResource" operation.


Below shows an example of an IBM.Test resource being created and later being deleted. Notice the Resource Handle matches between the creation and deletion operation ... this is the only way to associate a deletion operation with a particular IBM.Test resource that you know by name, either because of the output from the 'lsrsrc -Ab IBM.Test' command, or from db2diag.log messages that might show the name of the IBM.Test resource that DB2 is using as a flag :

Here is a snippet for the creation of an IBM.Test resource called "db2_MYHADRDB_node01_Reintegrate_db2inst1_db2inst1" :

05/18/14 15:23:14.782699 T(2314) _RMFRMRccp::DefineResource Entered, p_response=0x200d630c, 
p_options=0x0 number_of_values = 1
05/18/14 15:23:14.782705 T(2314) _RMF [0] attrid=1 CT_CHAR_PTR value="db2_MYHADRDB_node01_Reintegrate_db2inst1_db2inst1"
[...]
05/18/14 15:23:14.783299 T(2314) _RMFRMVerUpd::addResource Entered RH=0x6033 0xffff 0x06422623 0x6d5fca79 0x136f5091 0x74113bfb

Notice the unique Resource Handle (RH) is "0x6033 0xffff 0x06422623 0x6d5fca79 0x136f5091 0x74113bfb"


Here are the most relevant trace message for the deletion of the above IBM.Test resource :

05/18/14 15:23:37.088933 T(2314) _RMFRMRccp::UndefineResources Entered, p_response=0x200d630c, 
p_options=0x2003665c, number_of_handles=1
[...]
05/18/14 15:23:37.089005 T(2314) _RMFRMVerUpd::delResource Entered RH=0x6033 0xffff 0x06422623 0x6d5fca79 0x136f5091 0x74113bfb

Notice that the Resource Handle is the same as shown in the creation (addResource) trace messages.