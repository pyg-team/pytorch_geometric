Title: IBM The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption - United States

Text:
TSL SSL connection TECHNOTE (FAQ)

QUESTION
 how to estabilish a SSL/TLS connection to SQL Server 

CAUSE
 

The Remote Control Server component is not able to connect to the Microsoft SQL Server database when the security is not property configured on both the server and database machines. The trc.log file reports the following error message:

Threw SQLException whilst getting a connection from a datasource :The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption. Error: "SQL Server did not return a response. The connection has been closed. ClientConnectionId:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx". DSRA0010E: SQL State = 08S01, Error Code = 0


The error can be showed during a fresh installation also. 
In this case the installer shows a pop-up with the following error:

----------------
Error

Failed to verify userid, password, server, database and driver file combination supplied. Please verify details and try again.[
The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption. Error: "SQL Server did not return a response. The connection has been closed. ClientConnectionId:xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".]

---------------- 
Cause of the problem: 

The Microsoft JDBC driver is not able to work correctly with the protocol TLS1.1 if one of the following applies: 

1- The hash algorithm SHA (SHA1) is disabled 
2- The protocol TLS1.0 is disabled 
3- The protocol TLS1.2 is the only enabled 

ANSWER
 

Existent installation

TLS1.1:
 * NOTE: The JDBC driver requires TLS1.0 and SHA1 enabled to work correctly with TLS1.1 
   
   1) Enable TLS1.0 protocol (for both client and server). 
   
   Run the following commands 
   
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Server" /V DisabledByDefault /T REG_DWORD /D 0x00000000 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.0\Client" /V DisabledByDefault /T REG_DWORD /D 0x00000000 /F 
   
   2) Enable SHA hash algoritm 
   
   Run the following command 
   
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Hashes\SHA" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   
   3) Enable TLS1.1 (for both client and server) 
   
   Run the following commands 
   
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Server" /V DisabledByDefault /T REG_DWORD /D 0x00000000 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.1\Client" /V DisabledByDefault /T REG_DWORD /D 0x00000000 /F 
   
   4) Restart the machine to re-establish the secure channel with the new settings 
   

TLS1.2
 * 1) Install Microsoft JDBC driver >= 6.4 
   
   2) Open the file [install_dir]/wlp/usr/servers/trcserver/database.xml and add the property sslProtocol=TLSv1.2 to the url attribute: 
   
   For example: 
   
   url="jdbc:sqlserver://<dbhost>:1433;databaseName=TRCDB;sslProtocol=TLSv1.2;" 
   
   3) Enable TLS1.2 (for both client and server) 
   
   Run the following commands 
   
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Server" /V DisabledByDefault /T REG_DWORD /D 0x00000000 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client" /V Enabled /T REG_DWORD /D 0x00000001 /F 
   REG.EXE ADD "HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\SCHANNEL\Protocols\TLS 1.2\Client" /V DisabledByDefault /T REG_DWORD /D 0x00000000 /F 
   
   4) Restart the machine to re-establish the secure channel with the new settings 
   

Fresh installation
 * TLS1.1
 * 

 * 1) Follow the instructions for the "Existent Installation" to enable TLS1.1 
   
   2) Install the server as usual 
   
 * TLS1.2
 * 

 * 1) Follow the instructions for the "Existent Installation" to temporary enable TLS1.1 
   
   2) Install the server as usual 
   
   3) Disable TLS1.1 if required by the security policies 
   
   4) Follow the instructions for the "Existent Installation" to enable TLS1.2 



NOTE: If the SQL Server and the Remote Control server are installed on two different machine the steps above must be performed on both machines.