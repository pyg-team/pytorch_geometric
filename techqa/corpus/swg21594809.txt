Title: IBM Summarization & Pruning agent error message regarding MIN_TSIHP - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 When sy agent runs, can see following error in the sy log:
MIN_TSIHP is not valid in the context where it is used SQLCODE=-206,
SQLSTATE=42703, DRIVER=3.53.70. 

CAUSE
Summarization hourly table kpx_cpu_summary_h for the px agent incorrectly has column names
MIN_Time_Spent_in_Hypervisor_Pct
MAX_Time_Spent_in_Hypervisor_Pct
SUM_Time_Spent_in_Hypervisor_Pct
AVG_Time_Spent_in_Hypervisor_Pct

instead of 

MIN_TSIHP
MAX_TSIHP
SUM_TSIHP
AVG_TSIHP

so it fails when it tries to build 
kpx_cpu_summary_hv
which is based kpx_cpu_summary_h and refers to MIN_TSIHP


ANSWER
Drop the table then run warehouse schema script 

tdwschema.sh -rspfile tdwnewschema.rsp
with 
tdwnewschema.rsp containing 
KSY_PRODUCT_SELECT = installed

this then created file 
tdw_schema_table.sql
which had the correct SQL statements needed to recreate
kpx_cpu_summary_h
correctly 
eg. 

-- TABLE NAME : KPX_CPU_SUMMARY_H
-- TABLE CODE : KPX08CPUSU_H
CREATE TABLE "ITMUSER"."KPX_CPU_SUMMARY_H" (
"SAMPLES" INTEGER NOT NULL ,
....
"AVG_Hypervisor_Calls" DECIMAL (31, 2) ,
"MIN_TSIHP" DECIMAL (31, 2) ,
"MAX_TSIHP" DECIMAL (31, 2) ,
"SUM_TSIHP" DECIMAL (31, 2) ,
"AVG_TSIHP" DECIMAL (31, 2) ,
"MIN_Donating_LPARs" INTEGER ,
....

This CREATE TABLE section was put into a text file (eg. 
KpxCpuSummaryH.sql

and the following DB2 statements were used to recreate table 
kpx_cpu_summary_h

db2 connect to warehous user itmuser
db2 -f KpxCpuSummaryH.sql -o -t -z KpxCpuSummaryH.sql.log

After doing this, confirmed with 
db2 describe table kpx_cpu_summary_h

that the short name version of TSIHP were listed now instead of the long ones.

Waited 24 hours for sy agent to run again, and confirmed no more errors were logged. 

Note: if you continue to get similar errors for other table names (eg. daily, monthly, yearly, etc), just 
repeat the above process for those tables as well. 

 

HISTORICAL NUMBER
 68127
077
649 

PRODUCT ALIAS/SYNONYM
 MIN_TSIHP valid context "SQLCODE=-206" SQLSTATE 42703 S&P summarization pruning