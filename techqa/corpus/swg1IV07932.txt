Title: IBM IV07932: WSAS V7 FAILED TO REMOVE A POISON MESSAGE TO BACKOUT QUEUE, JMSWMQ2002, JMSCMQ0001, MQ REASON 2150, MQRC_DBCS_ERROR - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0 Fix Pack 7.0.1.7 [http://www-01.ibm.com/support/docview.wss?uid=swg24030911]
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.7 [http://www-01.ibm.com/support/docview.wss?uid=swg24030912]
WebSphere MQ v7.0.1.7 Hypervisor for AIX [http://www-01.ibm.com/support/docview.wss?uid=swg24031715]
Fix Pack 7.1.0.2 for WebSphere MQ V7.1 [http://www-01.ibm.com/support/docview.wss?uid=swg24033287]
WebSphere MQ V7.5 Fix Pack 7.5.0.1 [http://www-01.ibm.com/support/docview.wss?uid=swg24034616]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  WebSphere Application Server (WSAS) V7 using WebSphere MQ (WMQ)
   V7 as JMS messaging provider: a poison message is not moved to
   the specified Backout Queue when the Delivery Count of the
   message exceeds the Backout Threshold for the queue where the
   message is located.
   
   WSAS error log reported warning message:
   
   JMSWMQ2002: Get message failed
   
   An example is shown below:
   
   ConnectionEve W J2CA0206W: A connection error occurred. To help
   determine the problem, enable the Diagnose Connection Usage
   option on the Connection Factory or Data source
   
   ConnectionEve A J2CA0056I: The Connection Manager received a
   fatal connection error from the Resource Adapter for resource
   JMS$QM1$JMSManagedConnection@3. The exception is:
   
   com.ibm.msg.client.jms.DetailedMessageFormatException:
   JMSWMQ2002: Get message failed from target 'x'
   at com.ibm.msg.client.wmq.common.internal.Reason.
   reasonToException (Reason.java:570)
   at com.ibm.msg.client.wmq.common.internal.Reason.
   createException(Reason.java:236)
   
   Caused by:com.ibm.mq.MQException:JMSCMQ0001:
   WebSphere MQ Call failed with completion code '1'
   (MQCC_WARNING' Reason '2150' ('MQRC_DBCS_ERROR')
   at com.ibm.msg.client.wmq.common.internal.Reason.
   createException(Reason.java:223)
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects two categories of users:
   
   1. Users of:
   
   - The WebSphere MQ V7.0.1.4 (or earlier) classes for JMS.
   - The WebSphere MQ V7.0.1.4 (or earlier) Resource Adapter.
   - The WebSphere Application Server V7.0.0.17 (or earlier)
   WebSphere MQ messaging provider.
   - The WebSphere Application Server V8.0.0.0 WebSphere MQ
   messaging provider.
   - WebSphere Application Server V6 who have configured the
   application server to use the WebSphere MQ V7.0.1.4 (or
   earlier) classes for JMS (by setting the MQ_INSTALL_ROOT
   variable to point to the directory where WebSphere MQ V7
   has been installed)
   
   who have transactional message-driven beans that process
   either JMS text messages or WebSphere MQ messages which have
   a format of MQSTR, where the message data is in a double-byte
   character set (DBCS).
   
   2. Users of:
   
   - The WebSphere MQ V7.0.1.5 (or later) classes for JMS.
   - The WebSphere MQ V7.0.1.5 (or later) Resource Adapter.
   - The WebSphere Application Server V7.0.0.19 (or later)
   WebSphere MQ messaging provider.
   - WebSphere Application Server V6 who have configured the
   application server to use the WebSphere MQ V7.0.1.5 (or
   later) classes for JMS (by setting the MQ_INSTALL_ROOT
   variable to point to the directory where WebSphere MQ V7
   has been installed)
   
   who have transactional message-driven beans that process
   either JMS text messages or WebSphere MQ messages which have
   a format of MQSTR, where the message data is in a double-byte
   character set (DBCS) and the JMS Destination that the
   message-driven bean is getting messages from has the property:
   
   RECEIVECONVERSION
   
   set to the value:
   
   QMGR
   
   Platforms affected:
   All Distributed (iSeries, all Unix and Windows) +Java +Java zOS
   ****************************************************************
   PROBLEM SUMMARY:
   When the WebSphere MQ V7 classes for JMS and the WebSphere MQ
   V7 Resource Adapter (used internally by the WebSphere
   Application Server V7 and V8 WebSphere MQ messaging provider)
   detect a message that is suitable for delivery to a message-
   driven bean, they issue a WebSphere MQ MQGET API call to get
   that message from WebSphere MQ.
   
   If the MQGET call is issued with the GetMessageOption
   MQGMO_CONVERT specified for either a JMS text message or a
   WebSphere MQ message that has the format MQSTR, and that
   message contains invalid double-byte character set (DBCS) data,
   then the MQGET call will the message with a Completion Code of
   1 (MQRC_WARNING) and a Reason Code of 2150 (MQRC_DBCS_ERROR).
   This indicates that the message contained DBCS data that could
   not be converted correctly.
   
   The WebSphere MQ V7 classes for JMS and the WebSphere MQ V7
   Resource Adapter treated this as a failure to get the message,
   and so did not invoke any poison message handling logic. The
   messge was simply returned to the queue that it was on before,
   and the Backout Count property of the message was incremented.
   
   NOTE: The WebSphere MQ V7.0.1.4 (or earlier) classes for JMS
   and the WebSphere MQ V7.0.1.4 (or earlier) Resource
   Adapter always issued MQGET API calls with the
   GetMessageOption MQGMO_CONVERT specified.
   
   As a result of APAR IC72897 [http://www-01.ibm.com/support/docview.wss?uid=swg1IC72897], the WebSphere MQ V7.0.1.5
   (and later) classes for JMS and the WebSphere MQ V7.0.1.5
   (and later) Resource Adapter do not specify MQGMO_CONVERT
   when making MQGET calls. To enable this option, the JMS
   Destination property:
   
   RECEIVECONVERSION
   
   needs to be set to the value:
   
   QMGR
   
   for the Destination that the WebSphere MQ V7 classes for
   JMS and the WebSphere MQ V7 Resource Adapter are getting
   messages from.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The WebSphere MQ V7 classes for JMS and the WebSphere MQ V7
   Resource Adapter have been updated to invoke the poison message
   handling logic if an attempt to get a message from a WebSphere
   MQ queue returns Completion Code 1 (MQRC_WARNING) and Reason
   Code 2150 (MQRC_DBCS_ERROR).
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v7.0
   Platform           Fix Pack 7.0.1.7
   --------           --------------------
   Windows            U200333
   AIX                U843721
   HP-UX (PA-RISC)    U844089
   HP-UX (Itanium)    U844094
   Solaris (SPARC)    U844090
   Solaris (x86-64)   U844096
   iSeries            7.0.1.7
   Linux (x86)        U844091
   Linux (x86-64)     U844095
   Linux (zSeries)    U844092
   Linux (Power)      U844093
   zOS                7.0.1.7
   
                      v7.1
   Platform           Fix Pack 7.1.0.2
   --------           --------------------
   Windows            U200351
   AIX                U853019
   HP-UX (Itanium)    U853052
   Solaris (SPARC)    U853048
   Solaris (x86-64)   U853054
   iSeries            7.1.0.2
   Linux (x86)        U853049
   Linux (x86-64)     U853053
   Linux (zSeries)    U853050
   Linux (Power)      U853051
   zOS                7.1.0.2
   
   Platform           v7.5
   --------           --------------------
   Multiplatforms     7.5.0.1
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV07932
   
   
 * REPORTED COMPONENT NAME
   WMQ AIX V7
   
   
 * REPORTED COMPONENT ID
   5724H7221
   
   
 * REPORTED RELEASE
   701
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2011-09-19
   
   
 * CLOSED DATE
   2011-10-17
   
   
 * LAST MODIFIED DATE
   2013-03-21
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ AIX V7
   
   
 * FIXED COMPONENT ID
   5724H7221
   
   

APPLICABLE COMPONENT LEVELS
 * R701 PSY
   UP