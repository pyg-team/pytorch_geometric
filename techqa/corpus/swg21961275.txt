Title: IBM How can I trace CleanupAgent runs in server.log file? - United States

Text:
TRICONFIG; CleanupAgent; PlatformMaintenanceScheduler; log; trace; Statistics; TRIPERFORMANCE TECHNOTE (FAQ)

QUESTION
 How can I trace CleanupAgent runs in server.log file? 

CAUSE
Need to trace CleanupAgent (before 3.4) or PlatformMaintenanceScheduler (from 3.4 on) runs on IBM TRIRIGA server.log file.

ANSWER
NOTE: Platform releases prior to 3.4used "CleanupAgent" and for release 3.4 and later they use "PlatformMaintenanceScheduler" but they essentially perform the same action of cleaning up temporary records in TRIRIGA. 

First you need to activate the Cleanup Agent log category on IBM TRIRIGA Admin Console -> Platform Logging for the process server running this agent. 

 

[/support/docview.wss?uid=swg21961275&aid=1] [/support/docview.wss?uid=swg21961275&aid=1]



Click on the Apply button after checking mark “Cleanup Agent” log category along with its child selections. See that this is on-the-fly set up, immediately effective after you activate that. See as well that if you restart the server (JVM) this set up will be lost (log categories will be refreshed) and you will need to redo that. 

The server.log will have the following lines printed with tracing information of the Cleanup agent process (in the order they show in the logs):

L01) Starting Cleanup process with the following message:


 INFO [com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Starting Cleanup: AllCleanUp

L02) Reading Cleanup parameters (reading from TRIRIGAweb.properties file)

INFO [com.tririga.architecture.agent.CleanupAgent](innerCleanUpThread) Platform Maintenance Scheduler - Setting Workflow history retension to 10 days

INFO [com.tririga.architecture.agent.CleanupAgent](innerCleanUpThread) Platform Maintenance Scheduler - Setting DataConnect history retension to 5 days

L03) Starting WF Instance saved records treatment

INFO [com.tririga.platform.workflow.util.WFCleanup](innerCleanUpThread) WF Instance History clean up started at <date & time>

L04) Finishing WF Instance saved records treatment

INFO [com.tririga.platform.workflow.util.WFCleanup](innerCleanUpThread) WF Instance History clean up completed at <date & time> 

L05) Starting Data clean up process

INFO [com.tririga.platform.cleanupagent.RecordDataCleanup](innerCleanUpThread) Record Data clean up started at <date & time> 

L06) Finishing Data clean up process

INFO [com.tririga.platform.cleanupagent.RecordDataCleanup](innerCleanUpThread) Record Data clean up <date & time>

L07) Cleaning up DataConnect Tables, Document Manager Tables, All Hierarchy Caches and purging OSLC transactions

INFO [com.tririga.platform.dataconnect.JobControlManager](innerCleanUpThread) DataConnect Tables Clean up completed at <date & time> deleted N.
INFO [com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Document Manager Tables Clean up started at <date & time>
INFO [com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Document Manager Tables Clean up completed at <date & time> deleted N.
INFO [com.tririga.platform.heartbeat.event.util.HeartbeatEventUtils](innerCleanUpThread) Clear All Hierarchy Caches starting at <date & time>
INFO [com.tririga.platform.heartbeat.event.util.HeartbeatEventUtils](innerCleanUpThread) Clear All Hierarchy Caches completed at <date & time> lasting N ms.
INFO [com.tririga.architecture.scheduler.SchedulerUtils](innerCleanUpThread) Scheduler Clean up started at <date & time>
INFO [com.tririga.architecture.scheduler.SchedulerUtils](innerCleanUpThread) Clear All Hierarchy Caches completed at <date & time> lasting N ms.
INFO [com.tririga.platform.integration.oslc.util.OslcCleanupUtil](innerCleanUpThread) Purging OSLC transactions that are over N days old...

L08) Starting database analysis (maintenance, statistics)

INFO [com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Analyze starting at <date & time) 

L09) Finishing database analysis (maintenance, statistics)

INFO [com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Analyze completed at < date & time>

L10) Finishing Cleanup process with the following messages:

INFO [com.tririga.architecture.agent.CleanupAgent](innerCleanUpThread) **** SCHEDULED MAINTENANCE COMPLETE AT <date & time>
INFO [com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Completed Cleanup: AllCleanUp

Important notes below:

N1) You may see during the process that tables are visited twice, just like the following sample:

DEBUG [com.tririga.platform.cleanupagent.RecordDataCleanup](CleanupAgent) Record Data clean up - Update WF_STEP_INST, set STATUS to account for removed SPEC_IDs - updated 0 entries. 
DEBUG [com.tririga.platform.cleanupagent.RecordDataCleanup](CleanupAgent) Record Data clean up - Update WF_STEP_INST, set STATUS to account for removed SPEC_IDs - updated 0 entries.

This is working as designed. The first pass is for the record data cleanup for parent records, the second pass is for unlinked reference objects (Dependent objects where parent records were removed). 

N2) The agent must be started from the process server as per IBM TRIRIGA Best Practices.

N3) The time the agent's run takes will depend on how many records it will need to handle during such run. As a rule, the more time you have from the previous run to the next one, likely more records the agent will need to handle, so more time needed. 

N4) As you can see database maintenance including Statistics will run as part of the agent process ([com.tririga.architecture.util.CleanupUtil](innerCleanUpThread) Analyze), but Statistics can be disabled from running in the cleanup agent. This should not be implemented as a long term solution, and the Statistics would need to be run on a daily basis by DBA outside of the Cleanup agent. Therefore, for disabling the gather statistics command, login to the TRIRIGA Admin Console, navigate to the Cleanup Agent Manager (before 3.4) or Platform Maintenance Scheduler (from 3.4 on), at the top, take note of the schedule currently in place, so that it can be returned to normal later, then press the - (minus) button on the left side next to the line in the Cleanup Schedule table. 

 

[/support/docview.wss?uid=swg21961275&aid=2] [/support/docview.wss?uid=swg21961275&aid=2]



RELATED INFORMATION
 Administering IBM TRIRIGA Application Platform [https://www-01.ibm.com/support/knowledgecenter/SSHEB3_3.4.1/com.ibm.tap.doc/common/t_ctr_administer_apps.html]
Best Practices for System Performance [https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/IBM%20TRIRIGA1/page/Best%20Practices%20for%20System%20Performance]