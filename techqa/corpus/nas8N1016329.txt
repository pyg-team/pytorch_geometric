Title: IBM FAQ - QZRCSRVS Prestart Jobs - Usage - United States

Text:
RMTCMD TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document provides an explanation of the QZRCSRVS prestart job and prestart jobs in general. 

RESOLVING THE PROBLEM
The status of Established in netstat indicates that a QZRCSRVS job is servicing a connection from the client whose TCP/IP address is listed in the remote address column. 

What Is a Prestart Job? 

The purpose of prestart jobs is to reduce the response time of the IBM® i™ products when work is requested.

A prestart job is a job that starts before a work request is received. The job sits dormant in a subsystem and waits (PSRW status). When a request comes in, the job services that request then ends or goes dormant to wait for another request. Because the prestart job starts before it is asked to do any real work, the overhead of starting the job (resource allocation, and so on) is completed beforehand and does not affect the response time of the request. This allows the operating system to respond more quickly to the request. For this reason, most client/server applications make use of prestart jobs.

Prestart jobs can start in several ways. They can start at the time the subsystem starts, start with the STRPJ command, and they can also start when other processes that need them start (such as the case with the STRHOSTSVR command). For a prestart job to successfully start in a specific subsystem, there must be a prestart job entry (PJE) in the subsystem description for that prestart job. Prestart job entries can be modified with the CHGPJE command.

When a prestart job starts, it runs under a generic user profile (usually QUSER). When a request comes in, the profile attributes of the generic profile are swapped for the attributes of the profile making the request. When the prestart job is doing work, even though the profile associated with the job is generic, the authorities and other attributes are those of the requesting profile. This is done by the QWPSETP API which will be discussed more later. When a request is being worked, there will be a message in the joblog of the prestart job that identifies the user profile that is being serviced and the status of the prestart job will go from PSRW to something else (RUN, DEQW, CNDW, and so on).

Note: For the following items, please visit IBM i Knowledge Center [https://www.ibm.com/support/knowledgecenter/ssw_ibm_i] Web site (URL: [https://www.ibm.com/support/knowledgecenter/ssw_ibm_i]https://www.ibm.com/support/knowledgecenter/ssw_ibm_i [https://www.ibm.com/support/knowledgecenter/ssw_ibm_i]) and select your IBM i server release, click on the Table of Contents tab (left edge of window) for easy navigation. 

o Information about prestart jobs in general can be found in the IBM i Knowledge Center by expanding: Systems management > Work management > Concepts > Jobs > Job types, and click on Prestart jobs. o Information about the use of prestart jobs in general can be found in the IBM i Knowledge Center by expanding:  * IBM i 7.2 and newer: Connecting to your System > IBM i Access > IBM i Access Client Solutions > Setting up the IBM i platform > Host server administration > Use IBM i host servers > IBM i Subsystems, and click on Use of prestart jobs. 
 * IBM i 7.1: Connecting to your System > IBM i Access > IBM i Access for Windows > Administration > Host server administration > Use IBM i host servers > IBM i Subsystems, and click on Use of prestart jobs.


What Are the QZRCSRVS Prestart Jobs Used For? 

QZRCSRVS jobs are prestart jobs that are part of the remote command and distributed program call server. Information on this server can be found in the IBM i Knowledge Center by expanding:  * IBM i 7.2 and newer: Connecting to your system > IBM i Access > IBM i Access Client Solutions > Setting up the IBM i platform > Host server administration > Identify IBM i host servers and associated programs, and click on Remote command and distributed program call server. 
 * IBM i 7.1: Connecting to your system > IBM i Access > IBM i Access for Windows > Administration > Host server administration > Identify IBM i host servers and associated programs, and click on Remote command and distributed program call server.

Note: On operating system V4R3 and earlier, these jobs run by default in the QSYSWRK subsystem. On operating system V4R4 and above, these jobs run by default in the QUSRWRK subsystem. 

The QZRCSRVS jobs can be seen servicing requests made by IBM applications such as Operations Navigator, Management Central Job Monitors, and IBM® WebSphere® Commerce Suite. OEM application requests can also be serviced by these jobs. In addition, these jobs service requests made by a wide variety of customer created applications that make use of remote command or distributed program call APIs; for example, those included with the IBM® iSeries™ Access for Windows Programmer's Toolkit. 

Information about IBM i Access for Windows or System i Access for Windows or iSeries Access for Windows Remote Command/Distributed Program Call APIs can be found in the IBM i Knowledge Center by expanding:  * IBM i 7.2 and newer: Connecting to your System > IBM i Access > IBM i Access Client Solutions: Application Packages > Windows Application Package > Programming > C/C++ APIs, and select Remote Command/Distributed Program Call APIs. 
 * IBM i 7.1: Connecting to your System > IBM i Access > IBM i Access for Windows > Programming > IBM i Access for Windows C/C++ APIs, and select Remote Command/Distributed Program Call APIs.


Do QZRCSRVS Jobs Ever Run as Batch Jobs Rather Than Prestart Jobs? 

If prestart jobs cannot start in their normal subsystem, they default to starting as BCI (Batch Immediate) jobs in the subsystem where the server daemon for the same function runs. The server daemon for the remote command and distributed program call server (QZRCSRVS) is QZRCSRVSD and it runs in the QSYSWRK subsystem. Therefore, if the QZRCSRVS jobs cannot start in the QUSRWRK subsystem, they start as BCI jobs in the QSYSWRK subsystem. 

Where Can I Find Information about the Status of the QZRCSRVS Jobs on My System? 

The WRKACTJOB and WRKJOB commands can be used to look at the usual things (number of jobs, locks, joblogs, and so on) of prestart jobs. To see the prestart jobs that are in PSRW status through WRKACTJOB, press the F14 key. 

The DSPACTPJ command can be used to view prestart job statistics. 

Use the NETSTAT command to retrieve information about the TCP/IP Connection Status of prestart jobs, including QZRCSRVS. From the operating system command line, type NETSTAT *CNN and press the Enter key, or type NETSTAT and press the Enter key. Then, select Option 3 from the resulting menu. 

Information about using the NETSTAT command can be found in the IBM i Knowledge Center by expanding: Networking > TCP/IP Troubleshooting > Troubleshooting tools and techniques > Tools to verify your network structure > Netstat and click on Using Netstat from a character-based interface. 

Note: When looking at NETSTAT *CNN, the local port for a remote command will show as as-rmtcmd (non-SSL) and as-rmtcmd-s (SSL). The status of Established indicates that a QZRCSRVS job is servicing a connection from the client whose TCP/IP address is listed in the remote address column. For example, when a user expands Management Central, Operations Navigator (V5R1), iSeries Navigator (V5R2-V5R4), or System i Navigator (V6R1) a connection will be created that will be serviced by a QZRCSRVS job. When the user looks at the properties of a system under My Connections, Navigator will create another connection, which is serviced by a second QZRCSRVS job. Once the user has done these two operations, NETSTAT *CNN would show this user's TCP/IP address being serviced by two instances of QZRCSRVS, each with a status of Established. If the user closes Navigator at this point, the NETSTAT *CNN command will no longer show these established connections. 

Where can I find output from programs called by Remote Command or Distributed Program Call? 

Example: I ran the DSPLOG LOG(QHST) OUTPUT(*PRTWRAP) command using CommandCall. I assumed that the spooled file output would be associated with the QZRCSRVS job of the IBM i instance; however, that is not the case. Where did it go? 

Because of the way the user profiles are swapped within prestart jobs (using the QWTSETP API), the output will be associated with the user making the request. It should be displayed if a WRKSPLF SELECT(userprofile) command is run for that profile. 

Additional information on the QWTSETP API can be found in the IBM i Knowledge Center by expanding:  * Programming > Application programming interfaces > API finder > under the "Find by name" section, search on QWTSETP > click on Set Profile Handle (QWTSETP, QsySetToProfileHandle).



Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 6.1 Operating System IBM i 7.1 Operating System IBM i 7.2 Operating System IBM i 7.3 
HISTORICAL NUMBER
 322235958