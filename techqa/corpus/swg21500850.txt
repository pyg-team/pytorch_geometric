Title: IBM Domino data can be deleted during server shutdown if the temp directory points to the Domino data directory - United States

Text:
loss; lost; erased; wiped; stripped; NOTETMP.REG; NOTETP2.REG; temp; tmp; temp dir FLASH (ALERT)

ABSTRACT
 On a Domino 8.5.1 or later server, the contents of the Domino data directory can be deleted during shutdown if the following two conditions are true:

1) The temp directory points to the Domino data directory
2) The ~notetmp.reg file contains a null string

This does not happen frequently or on all Domino servers. However, if this does happen, a backup restore of the data will be necessary.

This is known to happen on UNIX (AIX, Linux, Solaris) and IBM i (i5/OS) platforms. It is suspected this could happen in very rare cases on Windows if the TEMP environment variable on that system has been deleted (on Windows this variable is set by default and would have to have been deleted for this problem to occur). 

CONTENT
This issue is now fixed in Lotus Notes and Domino 8.5.2 FP3 and 8.5.3.
Fix details: SPR# DWON8FVMYS [http://www.lotus.com/ldd/r5fixlist.nsf/SPR/DWON8FVMYS] 

Refer to the Upgrade Central [http://www.ibm.com/software/lotus/support/upgradecentral/index.html] site for details on upgrading Notes/Domino.


Are you impacted?
This issue only occurs if the Domino temp directory points to your Domino data directory. IBM recommends ensuring the temp directory is not the data directory. 

To determine if your Lotus Domino server is impacted, check the following conditions:

A. A TEMP or TMP environment value does not exist

-or-

B. A Notes_TempDir value in the notes.ini does not exist or it points to the Domino data directory

-or-

C. A ~notetp2.reg file exists in your Lotus Domino data directory while the Lotus Domino server is running

The ~notetp2.reg file is always located in the Domino temporary directory. If the file exists in your data directory, this indicates that your Domino data directory is set as your temporary directory. If a data directory path has not been specified in either an environment variable or notes.ini variable, the Domino data directory will be set as the temporary directory by default.


What causes the problem?
The Domino temporary directory is cleaned out at server shutdown. The ~notetmp.reg is a file that is generated by Domino every time Domino needs a temporary file to contain names of temporary files that need to be removed at server shutdown.

The data loss occurs when the server is shut down if
1) the Domino data directory is set as the temporary directory, and 
2) the ~notetmp.reg is located in the Domino data directory, and 
3) the ~notetmp.reg is in a bad state, for example, if it contains a filename with a null string

Note: These files are in binary format and cannot be read in any text editor


Solution if you have not yet upgraded:
Perform these steps BEFORE you shut down your Domino server to avoid unexpected file deletion:

Step 1: Set a temporary directory


 * A) Set a temporary directory in an environment variable
 * 
 * 
 * export TEMP=/tmp/domino
 * 
 * 
 * 
 * 
 * 
 * 
 * Data --Object Authorities-- 
 *  Opt User Authority Exist Mgt Alter Ref *PUBLIC *RWX X X X X QSYS *RWX X X X X QDIRSRV *RWX X X X X QNOTES *RWX X X X X 
 *  
 * 
 * -OR-
 * 
 * 
 * B) Set a temporary directory in a notes.ini variable
 * 
 * 
 * Notes_TempDir=/tmp/domino
 * 
 * /tmp/domino
 * 
 * 


Step 2: Delete the ~notetmp.reg file if it exists in the Domino data directory 
If the ~note tmp .reg file has been created and exists in your Domino data directory, delete this file before shutting down your server. 

Notes:  * Delete the ~notetmp.reg file, NOT the ~notetp2.reg file 
 * You may be left with other temp files that do not get removed from the data directory. These will have to be removed manually.



 * 
 *