Title: IBM InfoSphere Optim Performance Manager shows error: Unexpected Throwable caught: Array index out of range: 1. ERRORCODE=-4228, SQLSTATE=null - United States

Text:
OPM 4228 errorcode error code monitored database TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When trying to configure a new monitored database in OPM, you receive the error:
Unexpected Throwable caught: Array index out of range: 1. ERRORCODE=-4228, SQLSTATE=null


SYMPTOM
When adding a new DB2 V9.8 PureScale as the monitored database and the OPM version is V5.2 or lower, OPM shows an error like this: 

Caused by: com.ibm.db2.jcc.am.SqlException: 
[jcc][t4][10262][11223][3.63.138] Unexpected Throwable caught: Array index out of range: 1. ERRORCODE=-4228, SQLSTATE=null 
at com.ibm.db2.jcc.am.fd.a(fd.java:663) 
at com.ibm.db2.jcc.am.fd.a(fd.java:60) 
at com.ibm.db2.jcc.am.fd.a(fd.java:85) 
at com.ibm.db2.jcc.t4.b.b(b.java:893) 
at com.ibm.db2.jcc.t4.b.b(b.java:758) 
at com.ibm.db2.jcc.t4.b.a(b.java:419) 
at com.ibm.db2.jcc.t4.b.a(b.java:394) 
at com.ibm.db2.jcc.t4.b.<init>(b.java:332) 
at com.ibm.db2.jcc.DB2SimpleDataSource.getConnection(DB2SimpleDataSource.java:231) at com.ibm.db2.jcc.DB2SimpleDataSource.getConnection(DB2SimpleDataSource.java:197) at com.ibm.db2.jcc.DB2Driver.connect(DB2Driver.java:472)
at com.ibm.db2.jcc.DB2Driver.connect(DB2Driver.java:113)
at com.ibm.datatools.common.db.connmgt.impl.DBConnection.createConnectionInternal(DBConnection.java:298)
at com.ibm.datatools.common.db.connmgt.impl.DBConnection.createConnection(DBConnection.java:221) at com.ibm.datatools.common.db.connmgt.impl.DBConnectionManagementService.makeNewConnection(DBConnectionManagementService.java:294)

CAUSE
The JDBC driver 3.63.138 which is packaged with OPM code, has a defect tracked by the DB2 APAR IC92768. 

If you are using DB2 V10.1 FP2 or later , or OPM V5.3 (3.66.46) or later, as the fix for APAR IC92768 is already included in the JDBC driver, this procedure is not necessary.


ENVIRONMENT
OPM V5.2 or earlier 

DB2 V9.8 PureScale


DIAGNOSING THE PROBLEM
This error may occur when adding the monitored database: 


Caused by: com.ibm.db2.jcc.am.SqlException: 
[jcc][t4][10262][11223][3.63.138] Unexpected Throwable caught: Array index out of range: 1. ERRORCODE=-4228, SQLSTATE=null 

Or, if the JDBC trace files are turned on, you may find entries similar to this: 


[jcc][Thread:Default Executor-thread-2164][SQLException@3d1e8317] java.sql.SQLException
[jcc][Thread:Default Executor-thread-2164][SQLException@3d1e8317] SQL state = null
[jcc][Thread:Default Executor-thread-2164][SQLException@3d1e8317] Error code = -4228
[jcc][Thread:Default Executor-thread-2164][SQLException@3d1e8317] Message = [jcc][t4][10262][11223][3.63.138] Unexpected Throwable caught: Array index out of range: 1. ERRORCODE=-4228, SQLSTATE=null
[jcc][Thread:Default Executor-thread-2164][SQLException@3d1e8317] Stack trace follows
com.ibm.db2.jcc.am.SqlException: [jcc][t4][10262][11223][3.63.138] Unexpected Throwable caught: Array index out of range: 1. ERRORCODE=-4228, SQLSTATE=null
com.ibm.db2.jcc.am.fd.a(fd.java:663)
com.ibm.db2.jcc.am.fd.a(fd.java:60)
com.ibm.db2.jcc.am.fd.a(fd.java:85)
com.ibm.db2.jcc.t4.b.b(b.java:893)
com.ibm.db2.jcc.t4.b.b(b.java:758)
com.ibm.db2.jcc.t4.b.a(b.java:419)
com.ibm.db2.jcc.t4.b.a(b.java:394)
com.ibm.db2.jcc.t4.b.<init>(b.java:332)
com.ibm.db2.jcc.DB2SimpleDataSource.getConnection(DB2SimpleDataSource.java:231)
com.ibm.db2.jcc.DB2SimpleDataSource.getConnection(DB2SimpleDataSource.java:197) 


RESOLVING THE PROBLEM
The APAR fix is included in the JDBC driver 3.64 or later. The recommendation is to use the 3.66.46 driver (or later), which is the same driver included in OPM V5.3. 

Download the latest JDBC driver from the DB2 JDBC Driver Versions link below. And follow these steps:


 1. Stop OPM 
 2. Stop OPM instance (db2stop) 
 3. Rename or move the old JDBC drivers from OPM installation director  1. <OPM_install>/RepositoryServer/bin/db2jcc.jar 
     2. <OPM_install>/dscomponents/CommonWeb/com.ibm.datatools.shared.db.drivers_2.2.0.*/db2jcc.jar
    
    
 4. Copy the new JDBC driver to the locations above 
 5. Start DB2 (db2start) 
 6. Start OPM


For additional information about starting/stopping OPM, please refer to the link below. 
RELATED INFORMATION
#DB2 JDBC Driver Versions [http://www-01.ibm.com/support/docview.wss?uid=swg21363866]
Additional information about starting/stopping OPM [http://pic.dhe.ibm.com/infocenter/perfmgmt/v5r2/topic/com.ibm.datatools.perfmgmt.installconfig.doc/pm_start_stop.html]