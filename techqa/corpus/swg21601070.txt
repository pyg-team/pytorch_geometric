Title: IBM Recover table data even if the corresponding index EMP page is corrupted - United States

Text:
Index EMP; Data Object Class; Recover table data TECHNOTE (FAQ)

QUESTION
 How to recover table data if the corresponding index EMP page is corrupted? 

CAUSE

If the index EMP page happens to be corrupted, the table cannot be dropped and recreated and db2dart /MI will not work either.

The following messgaes will be recorded in db2diag.log, the type 65 means this page belongs to index EMP.

MESSAGE : ZRC=0x87020036=-2029912010=SQLB_BADHDR "Bad Page Header"
DIA8547C An error occurred in a database page header.
DATA #1 : String, 64 bytes
Error encountered trying to read a page - information follows : 
DATA #2 : String, 23 bytes
Page verification error
DATA #3 : Page ID, PD_TYPE_SQLB_PAGE_ID, 4 bytes
3081024
DATA #4 : Object descriptor, PD_TYPE_SQLB_OBJECT_DESC, 88 bytes
Obj: {pool:9;obj:1201;type:65} Parent={9;1201}
lifeLSN: 0000004CC83C9AB2
tid: 0 0 0
extentAnchor: 3081024
initEmpPages: 0
poolPage0: 0
poolflags: 122
objectState: 27
lastSMP: 0
pageSize: 32768
extentSize: 64
bufferPoolID: 3
partialHash: 1169227785
bufferPool: 0x0700000037f7ed40
pdef: 0x07000001c73cd4e0




ANSWER
To resolve this problem, the following steps may be considered: 

1. Use "select * from <tablename>" to export all the data of the corrupted table and save it to a del format file. As the "select *" statement will not incur the index scan, the data can be exported without any problems. 

2. Use db2look to extract all the object DDLs which are in the same tablespace of the corrupted table. 

3. Use export utility to export other tables' data. 

4. Drop and recreate the tablespace in which the corrupted table resides. 

5. Recreate the dropped tables in the tablespace and import the data saved in step 1 and step 3. 

 

Here is some background knowledge of how to interpret the object type value in the db2diag.log message. 


The objectType field is 1 byte in size and is divided in 2 nibbles.The higher order nibble is known as Object Class Types. The lower order nibble is known as Data Types.

Data Types:
table data 0x00
index data 0x01
long varchar 0x02 
LOB data 0x03 


Object Class:
Perment object 0x00
EMP object 0x40
Temporary object 0x80

In the example: the type value is 65 which equals to 0x41 in hex.

0x41=0x40+0x01 which means the object is EMP and data type is index, thus it is index EMP object.