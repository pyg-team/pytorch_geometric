Title: IBM DATAPOWER B2B PERSISTENCE STORE REQUIRES REINITALIZE AFTER ROLLBACK TO PREVIOUS FIRMWARE LEVEL - United States

Text:
datapower b2b persistent store rollback TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 B2B appliance does not support firmware "rollback" to a lower firmware level without affecting existing persistent data. 
There is a warning message telling customers the risk of losing persisted data when downgrade firmware to previous version. 

SYMPTOM
You may see the following errors in the log after the rollback:

B2B persistence store down
The persistence store is not running


CAUSE
Persistence Store is not supported for rollback or downgrade due to version incompatibility.

When trying to perform a rollback or downgrade this warning is displayed:

"Warning: You are about to switch firmware versions. Switching to an earlier
firmware version might prevent all B2B gateways from becoming operational and
will require an administrator to initialize the persistence store again."

The best practice procedure would be to archive ALL the persistent data before rollback
to previous firmware level Then in the case that the persistent store has an issue (version incompatible) you will have a copy of exported data. 

ENVIRONMENT
Firmware

DIAGNOSING THE PROBLEM
After running the must gather commands in this tech note the Raid array will appear to be functional and configured properly. However the persistence store will still be non-operational.
B2B persistence store must gather [http://www.ibm.com/support/docview.wss?uid=swg21633786]


RESOLVING THE PROBLEM
Archive all the persistent data prior to any rollback to a lower firmware level.





Transaction archive.
Please see the explanation of the "b2bp-archive-purge-now" command in the info center:


5.0.0 firmware info center link: b2bp-archive-purge-now [http://pic.dhe.ibm.com/infocenter/wsdatap/v5r0m0/topic/com.ibm.dp.xb.doc/commandreference.xb6052.htm?path=5_3_0_3_10#b2bp-archive-purge-now_global]


After a roll back or downgrade that results in the persistent store becoming down you will need to reinitialize the RAID array to restore the persistent store. 

See this technote for steps to reinitialize the Raid array: Raid configuration [http://www.ibm.com/support/docview.wss?uid=swg21358544]



NOTES: 

1) Importing archived data is currently not supported. 
2) The Raid reinitialize will delete all previous data