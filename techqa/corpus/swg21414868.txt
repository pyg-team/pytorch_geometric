Title: IBM Do not use nosetuid option with mount command - United States

Text:
SQL1042C; SQL1032N; db2sampl hang; DIA0505I TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 If you mount your file system with nosetuid, you will face unexpected behavior.

Example:
/home2 on /dev/dsk/c0d1s7 read/write/nosetuid/devices/intr/largefiles/logging/xattr/onerror=panic/dev=1980040 on Oct 27 15:51:54 2009


SYMPTOM
Unexpected behavior due to incorrectly mounted file system. 
Here are some examples of the symptoms that may be encountered: 

When starting DB2 using the db2start command, the following symptom will occur.

A syslogd will record the following messages in the /var/adm/messages(or check your configration where messages located in).

Oct 27 15:52:16 hostname genunix: [ID 809163 kern.info] NOTICE:
db2start, uid 109: setuid execution not allowed, dev=6600000040
Oct 27 15:52:16 hostname genunix: [ID 809163 kern.info] NOTICE:
db2star2, uid 109: setuid execution not allowed, dev=6600000040
Oct 27 15:52:17 hostname genunix: [ID 809163 kern.info] NOTICE:
db2sysc, uid 109: setuid execution not allowed, dev=6600000040
Oct 27 15:52:19 hostname genunix: [ID 809163 kern.info] NOTICE: db2fmp,
uid 109: setuid execution not allowed, dev=6600000040

In DB2 V9.1 case.
db2start will be failed with the following error.

$ db2start
2009-12-10 11:45:49 0 0 SQL1042C An unexpected system error occurred.
SQL1032N No start database manager command was issued. SQLSTATE=57019

In DB2 9.5 case.
db2 list dcs application will hang and instance down.
From db2diag.log

2009-10-29-11.51.13.729727+540 I149027E474 LEVEL: Severe
PID : 2220 TID : 41 PROC : db2sysc 0
INSTANCE: db2inst1 NODE : 000
APPHDL : 0-7 APPID: *LOCAL.db2inst1.091029025113
AUTHID : DB2INST1
EDUID : 41 EDUNAME: db2agent (instance) 0
FUNCTION: DB2 UDB, DRDA Application Server, sqljsSignalHandler, probe:10
MESSAGE : DIA0505I Execution of a component signal handling function has begun. 

In DB2 V9.7 case.
db2sampl will hang.


CAUSE
The cause of the unexpected errors is due to the file system being mounted the the nosetuid flag.
Mount considerations are listed in the installation requirements for DB2 servers. See the links in the Related URL section below.


ENVIRONMENT
This issue is only experienced with DB2 on UNIX Platforms.



DIAGNOSING THE PROBLEM
Check for the "setuid execution not allowed" in message file. 
Review the mount command for your file system: 

mount command showed as below.
# mount
/ on /dev/dsk/c0d0s0 read/write/setuid/devices/intr/largefiles/logging/xattr/onerror=panic/dev=1980000 on Oct 27 15:51:54 2009
/devices on /devices read/write/setuid/devices/dev=4380000 on Oct 27 15:51:40 2009
/system/contract on ctfs read/write/setuid/devices/dev=43c0001 on Oct 27 15:51:40 2009
/proc on proc read/write/setuid/devices/dev=4400000 on Oct 27 15:51:40 2009
/etc/mnttab on mnttab read/write/setuid/devices/dev=4440001 on Thu Oct 27 15:51:40 2009
/etc/svc/volatile on swap read/write/setuid/devices/xattr/dev=4480001 on Oct 27 15:51:40 2009
/system/object on objfs read/write/setuid/devices/dev=44c0001 on Oct 27 15:51:40 2009
/lib/libc.so.1 on /usr/lib/libc/libc_hwcap1.so.1 read/write/setuid/devices/dev=1980000 on Oct 27 15:51:40 2009
/dev/fd on fd read/write/setuid/devices/dev=4680001 on Oct 27 15:52:06 2009
/tmp on swap read/write/setuid/devices/xattr/dev=4480002 on Oct 27 15:51:44 2009
/var/run on swap read/write/setuid/devices/xattr/dev=4480003 on Oct 27 15:51:44 2009
/home2 on /dev/dsk/c0d1s7 read/write/nosetuid/devices/intr/largefiles/logging/xattr/onerror=panic/dev=1980040 on Oct 27 15:51:54 2009
.



RESOLVING THE PROBLEM
mount file system with setuid 

RELATED INFORMATION
 Installation requirements for DB2 servers on AIX [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/index.jsp?topic=/com.ibm.db2.luw.qb.server.doc/doc/r0008857.html]
Installation requirements for DB2 servers on HP-UX [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/index.jsp?topic=/com.ibm.db2.luw.qb.server.doc/doc/r0008860.html]
Installation requirements for DB2 Servers on Solaris [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/index.jsp?topic=/com.ibm.db2.luw.qb.server.doc/doc/r0008869.html]