Title: IBM QMGTOOLS: Continuous JVM Dump Utility (GENJVMDMP_) - United States

Text:
QMGTOLS; GENJVMDMP; Javal; JVM TECHNOTE (FAQ)

QUESTION
 The IBM MustGather tool provides an automated option for collecting JVM Dump information for a JVM job.

When executed, the tool will automatically gather a specified JVM dump type X amount of times with Y seconds between each dump with the option of also gathering a PRTJVMJOB dump as well. 

ANSWER
QMGTOOLS - Continuous JVM Dump Utility (GENJVMDMP_) tool execution and usage instructions
NOTE: The Continuous JVM Dump Utility (GENJVMDMP_) was made available in Build: 03/09/15 of the QMGTOOLS toolkit. If you already have the QMGTOOLS library on your system, you will want to make sure the toolkit has a build date equal to or newer than 03/09/15. Please refer to the following IBM Software Technical document for more information on how to check your current build level and update the QMGTOOLS toolkit. 

 * 
 * QMGTOOLS: How to check and update QMGTOOLS 


To check the build date of your currently installed QMGTOOLS version, execute the following commands. 
 * ADDLIBLE QMGTOOLS
 * 
 * GO MG
 * 
 * Option 12 to Display build date

1. If the QMGTOOLS toolkit has not yet been installed, you should refer to the following document for how to download and install the QMGTOOLS toolkit on your IBM i server.
Document N1011297, MustGather: How To Obtain and Install QMGTOOLS [http://www-01.ibm.com/support/docview.wss?uid=nas8N1011297] 2. Add the QMGTOOLS library to your library list by issuing the following command:

ADDLIBLE QMGTOOLS 3. Go to the QMGTOOLS main menu.

GO MG 4. Enter Option 6 and then Option 8 from the QMTOOLS main menu to get to the Java Menu.

Option 6 (CTA/EWS menu) -> Option 8 (Java menu) 5. Enter Option 7 to execute the Continuous JVM Dump Utility.
NOTE: Alternatively, you can call the utility directly using the QMGTOOLS/GENJVMDMP_ CL command.

Option 7 - Continuous JVM Dump Utility (GENJVMDMP_) 6. GENJVMDMP_ Parameter Definitions:

[/support/docview.wss?uid=nas8N1020536&aid=1] [/support/docview.wss?uid=nas8N1020536&aid=1]

[/support/docview.wss?uid=nas8N1020536&aid=2] [/support/docview.wss?uid=nas8N1020536&aid=2]

FUNCTION (FUNCTION) - allows you to start and stop the GENJVMDMP_ utility.  * 


Trace Identifier (TRACEID) - uniquely identifies the GENJVMDMP_ trace instance. The trace identifier value is also used as the name of the *DTAQ object created in QMGTOOLS.  * 
 * 
 * 
 * 
 * 
 * NOTE:
 * 


JVM Job Name (JOBNAM) - Identifies the JVM Job Name you wish to dump.  * 


JVM Job User Name (JOBUSR) - Identifies the JVM Job User Name you wish to dump.  * NOTE:
 * 
 * 
 * 


JVM Job Number (JOBNUM) - Identifies the JVM Job Number you wish to dump.  * NOTE:
 * 
 * 
 * 


Number of JVM Dumps (NUMCOL) - Number of JVM dumps you wish to gather.  * 
 * 
 * 


Time Between Dumps (DELAY) - Interval as to which the JVM dumps are taken.  * 
 * 
 * 


Print JVM Job (PRTJVM) - Whether you want to print JVM job information when the JVM dump type is gathered.  * 
 * 
 * 

 * NOTE:
 * 


JVM Dump Type (TYPE) - Type of JVM dump to collect.  * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 


Print JVM Job Type (PRTTYPE) - The type of information you wish to print from the JVM job.  * 
 * 
 * 


How to start a new instance of the GENJVMDMP_ utility 

1. Execute/Prompt the QMGTOOLS/GENJVMDMP_ CL command. 2. Specify FUNCTION(*START). Then, press ENTER to display additional parameters.

NOTE: If you would like to start a second instance of this utility, you will need to specify a unique Trace Identifier (TRACEID) name.

[/support/docview.wss?uid=nas8N1020536&aid=3] [/support/docview.wss?uid=nas8N1020536&aid=3]

[/support/docview.wss?uid=nas8N1020536&aid=4] [/support/docview.wss?uid=nas8N1020536&aid=4] 3. Fill in the JVM Job Name, User, and Number for the JOBNAM, JOBUSR, and JOBNUM parameters.
This will be the JVM Job name you wish to execute the dump events against. You can locate this information by executing the WRKJVMJOB command. 4. Specify the number of dumps you wish to collect for the NUMCOL parameter. You can specify a value between 1 and 99. The GENJVMDMP_ utility will run until the total number of dumps specified are gathered OR after the GENJVMDMP_ FUNCTION(*STOP) command is executed. 5. Specify the JVM Dump Type for the TYPE parameter that will be used for each dump iteration. You can specify *JAVA, *HEAP, or *SYSTEM. The dump types were explained previously. 6. Specify the Time Between Dumps for the DELAY parameter. You can specify a value between 0 and 9999 seconds. This is the amount of time the utility will sleep between dumps. 

NOTE: If are required to set the Time Between Dumps to a value of 30 seconds or greater when specifying *HEAP or *SYSTEM as the JVM Dump Type. 7. Specify Yes (Y) or No (N) for the PRTJVM parameter on whether you wish to print JVM job information at the same time the JVM dump type is gathered. If Y is specified, the utility will print the JVM job information specified on the PRTTYPE parameter at the same time the JVM dump type is gathered. 8. Specify the Print JVM Job Type for the PRTTYPE parameter. This will define the type of information printed at each interval.

NOTE: The *ALL parameter value may cause JVM performance issues due to the amount of data dumped. 9. Press ENTER to execute the utility.
A GENJVMDMP job will be submitted to the QSYSNOMAX job queue and will run in the QSYSWRK subsystem. You can execute WRKJOB GENJVMDMP Option 1 to work with the active job. 10. The GENJVMDMP job will end automatically once the total number of JVM dumps specified have been executed. If you would like to end the GENJVMDMP_ utility before the total number of JVM dumps have been executed, please refer to the section "How to stop an instance of the GENJVMDMP_ utility" below. 
How to stop an instance of the GENJVMDMP_ utility 

1. Execute/Prompt the QMGTOOLS/GENJVMDMP_ CL command. 2. Specify FUNCTION(*STOP) and TRACEID(<traceID>).

NOTE: The <traceID> parameter refers to the Trace Identifier (TRACEID) parameter value specified when the GENJVMDMP_ utility was originally started. If you do not remember the trace identifier name specified when the trace utility was started, you can execute the "WRKOBJ OBJ(QMGTOOLS/*ALL) OBJTYPE(*DATQ)" command to display active trace identifiers.

[/support/docview.wss?uid=nas8N1020536&aid=5] [/support/docview.wss?uid=nas8N1020536&aid=5] 3. Press ENTER to submit the GENJVMDMP_ utility to stop. 4. The GENJVMDMP job should end shortly after. You can monitor this by using the "WRKACTJOB JOB(GENJVMDMP)" command. 
How to locate the data produced by the GENJVMDMP_ utility? 

1. Obtain the value of the 'user.dir' property for the JVM job specified.

Execute the WRKJVMJOB CL command, enter option 5 next to the JVM job, and press ENTER.
On the "Work with JVM" screen, select option 7 to display the current Java system properties.
Search the "Name" column for "user.dir". Once this JVM system property is found, put your cursor on the corresponding value row next to the user.dir property and press F22 (Shift + F10) to display the full field value.

IMPORTANT: Make note of the user.dir property value since this will be the output location for the *JAVA, *HEAP, and *SYSTEM dumps. 2. Gather the JVM dumps produced by the GENJVMDMP_ utility.
WRKLNK '<user.dir>/*'
Locate the dumps files that begin with the following naming convention.

*JAVA - javacores.YYYYMMDD.HHMMSS.%PID%.xxxx.txt
*HEAP - heapdump.YYYYMMDD.HHMMSS.%PID%.xxxx.phd
*SYSTEM - core.YYYYMMDD.HHMMSS.%PID%.xxxx.dmp

NOTE: For the *SYSTEM or core.YYYYMMDD.HHMMSS.%PID%.xxxx.dmp file, you will be required to run the jextract utility against the core.dmp file by the same JVM version/bit level that produced the dump file.

JDK 6.0 32/64 bit - /QOpenSys/QIBM/ProdData/JavaVM/jdk60/<32bit, 64bit>/jre/bin/jextract <core.dmp>
JDK 6.2.6 32/64 bit - /QOpenSys/QIBM/ProdData/JavaVM/jdk626/<32bit, 64bit>/jre/bin/jextract <core.dmp>
JDK 7.0 32/64 bit - /QOpenSys/QIBM/ProdData/JavaVM/jdk70/<32bit, 64bit>/jre/bin/jextract <core.dmp>
JDK 7.1 32/64 bit - /QOpenSys/QIBM/ProdData/JavaVM/jdk71/<32bit, 64bit>/jre/bin/jextract <core.dmp>
JDK 8.0 32/64 bit - /QOpenSys/QIBM/ProdData/JavaVM/jdk80/<32bit, 64bit>/jre/bin/jextract <core.dmp>

The jextract utility will create a core.YYYYMMDD.HHMMSS.%PID%.xxxx.dmp.ZIP output file. 3. Upload the javacore.txt, heapdump.phd, and core.zip file(s) to IBM using the "MustGather: Instructions for Sending Data to IBM i Support" listed below. 4. Locate the QPJVAWRKVM spool files produced by the GENJVMDMP_ utility when the PRTJVM='Y' option is set.

NOTE: These spool files will be located in the output queue of the user profile who executed the GENJVMDMP_ utility. 5. Convert the spool files to plain text files using System i Navigator on your PC. 
- Start -> Programs -> IBM i Access for Windows -> System i Navigator
- Expand your system under My connections (Sign in with the same user profile who executed the GENJVMDMP_ utility).
- Expand Basic Operations and click on Printer Output.
- Drag and drop the QPJVAWRKVM spool files to your desktop.
- Upload the QPJVAWRKVM spool files using the "MustGather: Instructions for Sending Data to IBM i Support" listed below. 6. MustGather: Instructions for Sending Data to IBM i Support 
http://www.ibm.com/support/docview.wss?uid=nas8N1019224 [http://www.ibm.com/support/docview.wss?uid=nas8N1019224] 


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.2 Operating System IBM i 7.1 Operating System IBM i 6.1 Operating System IBM i 7.3