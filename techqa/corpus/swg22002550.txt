Title: IBM Connect:Direct File transfers are failing with Secure+ error - United States

Text:
cdsa; BEAST; jsse.enableCBCProtection TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After upgrading Sterling B2B Integrator (SBI) / Sterling File Gateway to version 5.2.6.3 the Connect:Direct Server Adapter (acting as the SNODE) is failing with one particular trading partner using Secure+. 

SYMPTOM
The remote trading partner is using Connect:Direct as the PNODE. 

Since in this scenario SBI is acting as the SNODE, there's no business process triggered. However, the Communication Session screen shows the communication with the problem partner as Success. 

 

Error in the SBI cdinterop log: 

 

[2017-03-15 15:21:29.549] ERROR [Thread-30178/63116] CDServer[ConnectDirect_node1_CDSERVER_ADAPTER_node1].notify() - Caught exception creating Snode session: com.sterlingcommerce.cd.oemglue.SnodeConnectException - SnodeSessionMediator.beTheNode caught CdSnConnException
[2017-03-15 15:21:29.549] ERROR [1489591289549] SnodeSessionMediator.beTheNode caught CdSnConnException
[2017-03-15 15:21:29.549] ERRORDTL [1489591289549]com.sterlingcommerce.cd.oemglue.SnodeConnectException: SnodeSessionMediator.beTheNode caught CdSnConnException
at com.sterlingcommerce.cd.oemglue.SnodeSessionMediator.beTheNode(SnodeSessionMediator.java:204)
at com.sterlingcommerce.cd.oemglue.SnodeSessionMediator.beTheNode(SnodeSessionMediator.java:580)
at com.sterlingcommerce.woodstock.cdinterop.impl.serverImpl.CDServer.notify(CDServer.java:2342)
at com.sterlingcommerce.woodstock.cdinterop.impl.serverImpl.CDServerListener$Notifier.run(CDServerListener.java:234)
at java.lang.Thread.run(Thread.java:798)
Caused by: com.sterlingcommerce.cd.cdjava.CdSnConnException: MSGID=JSNA003I,RC=8,FDBK=1,CLMTHNAME=CdSnApi.beSnode,
CDTXT="An error occurred in one of the Connect:Direct control messages exchanged during the handshake protocol after connecting.
Please retry the operation. If the problem persists contact your Connect:Direct administrator.",

at com.sterlingcommerce.cd.cdjava.CdSnApi.beSnode(CdSnApi.java:186)
at com.sterlingcommerce.cd.cdjava.CdSnApi.beSnode(CdSnApi.java:519)
at com.sterlingcommerce.cd.cdjava.CdSnApi.beSnode(CdSnApi.java:443)
at com.sterlingcommerce.cd.cdjava.CDApi.beSnode(CDApi.java:145)
at com.sterlingcommerce.cd.oemglue.SnodeSessionMediator.beTheNode(SnodeSessionMediator.java:196)
... 4 more
Caused by: com.sterlingcommerce.cd.cdjava.CdFmhException: MSGID=JSNA007I,RC=8,FDBK=1,CLMTHNAME=CdSnApi.beSnode,
CDTXT="An error occurred in one of the Connect:Direct control messages exchanged during the handshake protocol after connecting.
Please retry the operation. If the problem persists contact your Connect:Direct administrator. The FMH ID and command code received were: ", JTXT="114, 1" 


CAUSE
This error is the result of a compatibility problem with some older releases of Connect:Direct. 

SBI version 5263 implements, by default, a remediation of the BEAST vulnerability (CVE-2011-3389). In earlier versions of SBI it had to be explicitly enabled.

The remediation involves breaking up SSL buffers sent to other C:D nodes into multiple records. Some older versions of C:D do not support receipt of multiple SSL buffers in the same TCP buffer.


DIAGNOSING THE PROBLEM
When the SBI CDSA SNODE sets jsse.enableCBCProtection=false in tmp.sh_platform_ifcresources_ext.in and runs setupfiles.sh the communication works with no problem. When they set it back to true, then it fails. Leaving this setting to false could lead to the BEAST vulnerability.



RESOLVING THE PROBLEM
The solution is to upgrade Connect:Direct HP NonStop (at the PNODE). 

It should be upgraded to the latest 3.6.0.1 iFix (030) dated 10-Jun-2016, or any 
later fix pack (3.6.0.2) and iFix.