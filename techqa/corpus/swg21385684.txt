Title: IBM User Console does not work when connectors use WebSphere Application Server - United States

Text:
BEER0608I; BEER0608; BEER0721E; BEER0721; java.lang.NullPointerException TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The User Console does not work if the connectors use the WebSphere Application Server data sources to access the User Console tables (including when the tables are in an Embedded Derby database). When you run the Connectors, the following messages are displayed in the Connectors console: 

SYMPTOM
BEER0608I: The human interaction module is monitoring action: Investigate Account Activity
BEER0883E: An error occurred while you were attempting to connect to the database jdbc/repository: com.ibm.websphere.ce.cm.StaleConnectionException: Failed to start database 'C:\\Program Files\\IBM\\WBE621\\derby\\wbe', see the next exception for details.DSRA0010E: SQL State = XJ040, Error Code = 40,000
BEER0721E: An error occurred while querying the action table: com.ibm.wbe.common.AsException: java.lang.NullPointerException. SQL: select uuid, owner, action, group_name from actions where postedtime != duetime and duetime &lt; '2009-05-12 13:39:28.678'


CAUSE
The User Console cannot connect to the database using the WebSphere Application Server data sources. The User Console tables are, by default, created in the repository database (called 'wbe'). If the repository database is accessed using the WebSphere Application Server data sources (which can improve performance), the User Console cannot access its tables. This is a problem if the repository database is hosted by the Embedded Derby database manager in WebSphere Application Server because an Embedded Derby database can be accessed only by using the WebSphere Application Server data sources.

RESOLVING THE PROBLEM
If the repository database is an Embedded Derby database, you must create a separate database to host the tables for the User Console and then change some property settings so that the User Console connector accesses its tables in the separate database.


If the repository database is hosted by any other supported database manager (including Derby NetworkServer, which is included in your WebSphere Application Server installation), you can just change the property settings so that the User Console connector uses the WebSphere Business Events data sources to connect to the User Console tables (the repository database can still be accessed using the WebSphere Application Server data sources if you prefer for performance reasons). 

For a list of the User Console tables, see http://publib.boulder.ibm.com/infocenter/wbevents/v6r2m1/topic/com.ibm.wbe.reference.doc/doc/repositorytables.html [http://publib.boulder.ibm.com/infocenter/wbevents/v6r2m1/topic/com.ibm.wbe.reference.doc/doc/repositorytables.html] 

 

To change the configuration so that the User Console connector accesses its tables using the WebSphere Business Events data sources (and not the WebSphere Application Server data sources): 

 1. If the repository database is hosted by Embedded Derby, create a new Derby database for the User Console tables. The new database can be hosted by any supported database but the instructions in this step assume that you are using Derby NetworkServer, which is already installed as part of WebSphere Application Server.  1. Start Derby NetworkServer. In wbe_install_dir\WAS\derby\bin\networkServer, run the startNetworkServer.bat (Windows) or startNetworkServer.sh (Linux and UNIX) script.
        
        Derby NetworkServer starts in a command window with the following message:
        Server is ready to accept connections on port 1527.
        Port 1527 is the default port number on which Derby NetworkServer listens for connections. 
     2. In the wbe_install_dir\WAS\derby\bin\networkServer directory, start the ij command environment by running the ij.bat (Windows) or ij.sh (Linux and UNIX) script. 
     3. In the ij command window, create a new database for the User Console tables by running the following command (all on one line):
        
        CONNECT 'jdbc:derby:C:\Program Files\IBM\WBE621\derby\userconsole;create=true'; 
     4. In the ij command window, create the tables in the new database, by running the following script:
        wbe_install_dir\config\db\derbydb.sql
        
        The script creates all the tables that the User Console will need.
    
    
 2. Configure the User Console to use the new database:  1. Start Properties UI: Start > Programs > IBM WebSphere Business Events V6.2.1 > Properties 
     2. Log into Properties UI. If you have not enabled security in WebSphere Application Server, you do not need to enter any user name and password. If you have enabled security, you must enter a valid user name and password. 
     3. In Properties UI, click Full Configurator, then on the Connector page, enter the values shown in the following tables: 
     4. If the User Console tables are in Derby NetworkServer:
        Property Value as.director.connectors.pem.dbclass com.ibm.wbe.db.DerbyDB as.director.connectors.pem.instance C:\\Program Files\\IBM\\WBE621\\derby\\userconsole as.director.connectors.pem.dbport 1527 as.director.connectors.pem.dbhost localhost as.director.connectors.pem.username APP as.director.connectors.pem.password derbyadmin 
        
     5. If the User Console tables are in another supported database:
        Property Value as.director.connectors.pem.dbclass com.ibm.wbe.db.DB2DB (DB2) com.ibm.wbe.db.OracleDB (Oracle) com.ibm.wbe.db.MssDB (SQL Server) as.director.connectors.pem.instance The name of the database. as.director.connectors.pem.dbport The port on which the database is listening. as.director.connectors.pem.dbhost The host name of the database. as.director.connectors.pem.username The user name that WebSphere Business Events uses to access the database. as.director.connectors.pem.password The password associated with the user name. 
        
     6. Select the check box for each of the fields listed in the table in the previous step. You must select the check boxes as well as entering the property values to enable the properties. 
     7. Ensure that you have enabled history before you continue (otherwise, there will be no data for the User Console to display).
    
    
 3. Stop then restart WebSphere Application Server to apply the properties changes. 
 4. Ensure that database is running, then start the Connectors.


Now you are ready to use the User Console.