Title: IBM PI23325: WEBSPHERE MQ, INCONSISTENT RESULT BETWEEN WMQ AND DB2 DURING 2 PHASE COMMIT VIA RRS. - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS UNREPRODUCIBLE IN NEXT RELEASE.
    
   
   

ERROR DESCRIPTION
 *  The problem occurs when the first operation in a unit of work
   is non-persistent and involves a shared queue (in this case
   URID 0015EF4C6000 performed an in-syncpoint MQGET of a
   non-persistent shared queue message, followed by an
   in-syncpoint MQPUT of a persistent shared queue message). When
   the MQGET was issued, the queue-manager expressed persistent
   interest in the RRS UR. However, the queue-manager had not yet
   created a UR, and hence an incorrect value was stored in the
   persistent interest data associated with the queue-managers
   interest in the RRS UR (the interest data should contain the
   URID of the queue-manager UR). Therefore, when the
   queue-manager was restarted after the LPAR outage, the
   queue-manager performed resync processing with RRS (ATRIRNI
   calls), but as the persistent interest data returned was
   incorrect, URID 0015EF4C6000 was backed-out.
   
   
   Additional Symptom(s) Search Keyword(s): MQ, DB2, RRS, UR,
   integrity, inconsistent
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere MQ for z/OS Version 7 *
   *                 Release 0 Modification 1 and Release 1       *
   *                 Modification 0.                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: Performing an in-syncpoint MQGET of a   *
   *                      non-persistent message from a shared    *
   *                      queue followed by a MQPUT of a          *
   *                      persistent message to a shared queue,   *
   *                      without a commit in-between may result  *
   *                      in an in-doubt unit of work being       *
   *                      created if an error occurs before a     *
   *                      commit can take place. This occurs when *
   *                      the application is linked using a RRS   *
   *                      stub.                                   *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   An in-syncpoint MQGET of a non-persistent message from a shared
   queue results in the queue manager registering persistent
   interest in a RRS UR. In this scenario a MQ UR is not started
   during the MQGET, this results in the persistent interest data
   being incorrectly set. During the MQPUT call, the MQ UR is
   started, but the persistent interest is not updated in the RRS
   UR. This can result in an inconsistent state during 2 phase
   commit processing in RRS, resulting in an indoubt UR.
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX
 *  *********
   * HIPER *
   *********
   
   
    
   
   

COMMENTS
 *  The code was changed to ensure the persistent interest data in
   the RRS UR is updated when the related MQ UR is started. This
   ensures the UR data is consistent and does not result in an
   indoubt UR.
   &#158;**** PE14/10/31 FIX IN ERROR. SEE APAR PI28769 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI28769]  FOR DESCRIPTION
   
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   PI23325
   
   
 * REPORTED COMPONENT NAME
   WMQ Z/OS V7
   
   
 * REPORTED COMPONENT ID
   5655R3600
   
   
 * REPORTED RELEASE
   010
   
   
 * STATUS
   CLOSED UR1
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2014-08-05
   
   
 * CLOSED DATE
   2014-09-24
   
   
 * LAST MODIFIED DATE
   2014-11-07
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI21631 UI21632
   
   

MODULES/MACROS
 *  CSQIDLM1 CSQILOGS CSQILOG1 CSQIRRSI CSQI201M
   CSQMCBCK CSQMCCMT CSQ3BCK  CSQ3CMIT CSQ3ONLY CSQ3RRSR
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ Z/OS V7
   
   
 * FIXED COMPONENT ID
   5655R3600
   
   

APPLICABLE COMPONENT LEVELS
 * R010 PSY UI21631 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI21631]
   UP14/10/17 P F410
   
   
 * R100 PSY UI21632 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI21632]
   UP14/10/17 P F410
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.