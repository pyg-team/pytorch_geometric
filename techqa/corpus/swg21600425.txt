Title: IBM WebSphere DataPower SOA Appliance Requires a Single OCSP Response - United States

Text:
OCSP; 0x08060017b ; CRL multiple individual TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Is it possible to configure DataPower to accept multiple individual responses from an OCSP server? 

SYMPTOM
When an OCSP server returns multiple individual responses in an OCSP response to DataPower, the following error is logged:

0x08060017b 
Wrong number of individual responses (%d) in OCSP response 

Explanation: 
An OCSP client can ask for information about multiple certificates in a single request (although this appliance never does so). The server must include exactly one individual response for each of those certificates in its OCSP response. This error means that the server did not do this correctly. 

Administrator response: 
This is a problem with the OCSP server (not the DataPower appliance). Please contact the administrator of the OCSP server. 




CAUSE
The OCSP specification (RFC 2560) says the following about a response: 

A definitive response message is composed of: 

-- version of the response syntax 
-- name of the responder 
-- responses for each of the certificates in a request 
-- optional extensions 
-- signature algorithm OID 
-- signature computed across hash of the response 

The third item above is the relevant one in this case and it doesn't permit the inclusion of responses for certificates that weren't inquired about. 

The conclusion was that the section about pre-producing OCSP responses is intended for two situations: 

1) The OCSP responder knows that some certificate is going to be inquired about repeatedly, so it can pre-generate a response for that certificate. 

2) The OCSP responder caches its responses and re-sends them in response to subsequent requests for the same certificate or set of certificates. 

Both situations require no nonce in the request, hence it's more like a using a certificate revocation list (CRL). However, this can still be useful if you are actually basing your OCSP data on CRLs - i.e. to simply off-load the burden of CRL retrieval and processing. 



RESOLVING THE PROBLEM
The best way to implement pre-production of OCSP responses without possibly violating the protocol is to do them one certificate at a time. 

The design of OCSP is purposeful - to be secure, current revocation data. Dropping nonces and pre-producing the responses compromises all of that (replay attacks are possible and the data is stale). 

DataPower, when acting as an OCSP client, requires a single OCSP server response and this is not configurable.