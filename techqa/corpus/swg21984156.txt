Title: IBM Spectrum Protect for VMware UI is slow to open - United States

Text:
cli tsmcli durby hang ve plugin plug-in TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Starting the IBM Spectrum Protect for VMware User Interface takes several minutes to open. 

CAUSE
It is normal for the user interface to take between 0 and 2 minutes to open. If it is taking longer to open, one reason can be due to the size of the DERBY DB. 
It is not uncommon for the DERBY DB to grow over 500MB+ depending on how many "runnow" tasks are done and how many VM's that task backs up. Long wait times for the VMware UI to open has been seen on DB's that are over 400 MB.



ENVIRONMENT
Windows or Linux 

IBM Spectrum Protect for VMware


DIAGNOSING THE PROBLEM
1 - Verify the size of the DERBY DB by checking the size of the following directory: 

 

Windows: 

C:\Program Files (x86)\Common Files\Tivoli\TDPVMware\VMwarePlugin\derby 

 

Linux: 

 /home/tdpvmware/tdpvmware/VMCLIDB 

If the size of this folder is over 400 MB it is likely this is what is causing the problem. 

 

2 - Run the following command and note how long it takes to complete: 

 

Windows:
C:\Program Files (x86)\Common Files\Tivoli\TDPVMware\VMwarePlugin\scripts

vmcli.cmd -f inquire --type backup -t TSM

Linux: (command must be run as the tdpvmware user)
/opt/tivoli/tsm/tdpvmware/common/scripts

./vmcli -f inquire -type backup -t TSM

If this command takes longer than 20-30 seconds, this would be indicative of a DERBY DB that is too large. 




RESOLVING THE PROBLEM
The DERBY db tracks the events that are run from within the user interface. It keeps information on the tasks, events, and details of the backups. All of this information can cause the DERBY db to grow very large depending on how many manual backups (run now backups) are run from within the UI. 

A few configuration options can be changed to decrease the amount of time that information is retained in the db. 

The following options can be found in the VMCLIPROFILE file. This can be found in the following locations: 

Windows:
C:\Program Files (x86)\Common Files\Tivoli\TDPVMware\VMwarePlugin\scripts

Linux:
/opt/tivoli/tsm/tdpvmware/common/scripts

-VMCLI_GRACE_PERIOD (defaults to 30 days) 
Grace period for keeping the run & run_details for backups.

-VMCLI_TASK_EXPIRATION_TIME (defaults to 10 days)
Grace period for keeping "Recent Tasks" 

Change the VMCLI_GRACE_PERIOD to 864000 (10 days). Then run: 

vmclli -f db_compact 

More information on the available options can be found here: [http://www.ibm.com/support/knowledgecenter/SS8TDQ_7.1.3/ve.inst/t_ve_cfg_vmcli.html]
VMCLIPROFILE [http://www.ibm.com/support/knowledgecenter/SS8TDQ_7.1.3/ve.inst/t_ve_cfg_vmcli.html]



PRODUCT ALIAS/SYNONYM
 TSM