Title: IBM IV37034: AMQ7472: DAMAGED WEBSPHERE MQ OBJECTS WERE INCURRED AFTER A FAILOVER DUE TO A STORAGE AREA NETWORK SWITCH OUTAGE. - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0 Fix Pack 7.0.1.10 [http://www-01.ibm.com/support/docview.wss?uid=swg24034145]
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.10 [http://www-01.ibm.com/support/docview.wss?uid=swg24034909]
WebSphere MQ V7.5 Fix Pack 7.5.0.2 [http://www-01.ibm.com/support/docview.wss?uid=swg24035286]
Fix Pack 7.1.0.3 for WebSphere MQ V7.1 [http://www-01.ibm.com/support/docview.wss?uid=swg24035405]
WebSphere MQ v7.5.0.2 Hypervisor for RHEL [http://www-01.ibm.com/support/docview.wss?uid=swg24036533]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  WebSphere MQ V6 objects became damaged when the connection to
   the Storage Area Network(SAN) was lost and the queue manager
   failed over to a secondary system.
   
   NOTE: Please note this defect can also occur at WebSphere MQ
   v7.x codelevel.
   
   FDCs record:
   .
   ----------------------------------------------
   Probe Id          :- AQ123002
   Component         :- aqqLoadMsgHdr
   Program Name      :- amqzxma0
   Major Errorcode   :- arcE_OBJECT_DAMAGED
   Probe Description :- AMQ6125: An internal WebSphere MQ error
   has occurred.
   
   MQM Function Stack
   ExecCtrlrMain
   kpiStartup
   apiStartup
   atmRecoveryIndoubtPass
   aqmRebuildSoftLog
   aqhRebuildSoftLog
   aqhLoadSyncMsg
   aqhLoadMsg
   aqqLoadMsgHdr
   xcsFFST
   =================================================
   .
   Probe Id          :- AQ123002
   Component         :- aqqLoadMsgHdr
   Program Name      :- amqzlaa0
   Major Errorcode   :- arcE_OBJECT_DAMAGED
   Probe Description :- AMQ6125: An internal WebSphere MQ error
   has occurred.
   
   MQM Function Stack
   zlaMainThread
   zlaProcessMessage
   zlaProcessMQIRequest
   zlaMQOPEN
   zsqMQOPEN
   kpiMQOPEN
   kqiOpenIt
   kqiOpenQueue
   kqiTriggersFromInitQ
   kqiTriggerOnSet
   apiLoadQueue
   aqmLoadQueue
   aqhLoadQueue
   aqhLoadMsgChain
   aqhLoadMsg
   aqqLoadMsgHdr
   xcsFFST
   ----------------------------------------------
   Queue Manager Error logs record:
   .
   02/12/13 17:04:53 - Process(5596.1) User(mqm) Program("MQ
   Process Name")
   AMQ7472: Object "Queue Name", type queue damaged.
   
   EXPLANATION:
   Object "Queue Name", type queue has been marked as damaged.
   This indicates that the queue manager was either unable to
   access the object in the file system, or that some kind of
   inconsistency with the data in the object was detected.
   ACTION:
   If a damaged object is detected, the action performed depends
   on whether the queue manager supports media recovery and when
   the damage was detected.  If the queue manager does not support
   media recovery, you must delete the object as no recovery is
   possible. If the queue manager does support media recovery and
   the damage is detected during the processing performed when the
   queue manager is being started, the queue manager will
   automatically initiate media recovery of the object. If the
   queue manager supports media recovery and the damage is
   detected once the queue manager has started, it may be
   recovered from a media image using the rcrmqobj command or it
   may be deleted.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   You may encounter this issue if you do not always end the queue
   manager gracefully, via endmqm. In addition, to encounter the
   problem you must also be using some queues with a mixture of
   persistent and non-persistent messages.
   
   Platforms affected:
   All Distributed (iSeries, all Unix and Windows)
   ****************************************************************
   PROBLEM SUMMARY:
   This issue is very similar to the issue described in APAR
   IV22043 [http://www-01.ibm.com/support/docview.wss?uid=swg1IV22043]: in complex circumstances relating to a queue containing
   a mix of persistent and non-persistent messages, a checkpoint
   may fail to flush changes to the queue.
   
   If the queue manager is hard-crashed immediately after the
   checkpoint, then on queue manager restart the queue file may
   contain persistent messages that had previously all been got.
   Or, the queue may be reported as damaged on attempting to
   access it.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The queue checkpoint logic was revised to correctly handle the
   problem situation described.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v7.0       7.0.1.10
   v7.1       7.1.0.3
   v7.5       7.5.0.2
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV37034
   
   
 * REPORTED COMPONENT NAME
   WMQ LIN X86 V6
   
   
 * REPORTED COMPONENT ID
   5724H7204
   
   
 * REPORTED RELEASE
   602
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-02-20
   
   
 * CLOSED DATE
   2013-03-21
   
   
 * LAST MODIFIED DATE
   2014-04-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ LIN X86 V6
   
   
 * FIXED COMPONENT ID
   5724H7204
   
   

APPLICABLE COMPONENT LEVELS
 * R602 PSY
   UP