Title: IBM The error "The server failed during a search operation" is thrown when server based sorting is enabled - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Searching a folder with server based sorting enabled in an IBMÂ® Content Manager OnDemand server throws the error, "The server failed during a search operation". 

CAUSE
There is a limitation in OnDemand server V8.4.1 and older where server based sorting will fail if the search cannot be submitted as a single database query by the OnDemand server.

A single search is separated into multiple queries by the OnDemand server if the query will search across more than sixteen tables from the same application group or the query is greater than 2MB in length. This is done to prevent overall server performance from being impacted by long running search queries. If multiple queries are generated by the OnDemand server, the ORDER BY SQL modifier cannot be used to conduct server based sorting and the error, "The server failed during a search operation", will be returned.

To check how many tables exist for an application group, issue the query:

SELECT count(table_name) FROM arsseg WHERE agid = (SELECT agid FROM arsag WHERE name = 'app_group_name_here')

RESOLVING THE PROBLEM
The following three options are available to resolve the issue:


 * Disable server based sorting for this folder. The client side sort will be used instead. This can be changed in the Permission tab of the folder definition. In addition, if using theODWEK Java APIs, the ODFolder.setSortLocation() API must be changed to use ODConstant.OD_SORT_LOCATION_MIDTIER. 
   
   Note: If server based sorting and maximum hits in the folder are enabled, a different set of hits might be presented. With server based sorting enabled, the result set is sorted on the server before the specified maximum number of hits are returned to the client. This guarantees that the returned hits are the first in the sort order. With server based sorting disabled, a result set containing the specified maximum number of hits, in no particular order, is returned to the client. The returned hits are then sorted by the client.
   
   
 * Require the folder field that maps to your application group segment field be specified for a search. This can be configured in the Field Information tab of your folder definition. Each data table in OnDemand is segmented by the segment date field of the application group. OnDemand uses this segment field to limit the number of tables to search. The error will still occur if the date provided spans more then sixteen data tables.
   
   
 * In OnDemand server V8.4.1.2, the parameter ARS_DB_MAX_SQL_TABLES was added to allow configuration of the maximum number of tables in an application group that can be searched. It must be specified in the ars.cfg.
   
   For example, to configure OnDemand to allow twenty database tables in a server based sort, the following would be added to the ars.cfg:
   
   ARS_DB_MAX_SQL_TABLES=20
   
   Important: The ARS_DB_MAX_SQL_TABLES parameter affects all queries system wide, not just those associated with server based sorting. This can have a negative impact on database query performance if your system is not tuned for the larger working space requirements. DB2 configuration parameters such as DBHEAP and STMTHEAP, as well as Oracle configuration parameters such as SGA_TARGET and PGA_AGGREGATE_TARGET at a minimum should tuned.