Title: IBM Map failure, return code 32 - Invalid map instance handle when running a message flow - United States

Text:
Invalid map instance handle; rc 32; return code 32 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When running a IBM Integration Bus (IIB) / WebSphere Message Broker (WMB) message flow with a Transformation Extender WTX Map Node, a error is produced, return code RC 32 invalid map instance handle.


SYMPTOM
Map error identified in the Service trace: 

2014-07-14 10:29:22.698758 105558 Evaluate file:CMqsiNode.cpp [file://CMqsiNode.cpp] line:2178 message:1004.txmsgv841 'WTX exception' , '<Error>
<TimeStamp>date_time</TimeStamp>
<Description>Map Failure</Description>
<ErrNo>32</ErrNo>
<MapName>/wtx_maps/<map_name>.mmc</MapName>
<Instance>190788</Instance>
<ErrText>Invalid map instance handle</ErrText>
</Error>', 


CAUSE
Permissions and owner of /wmqi/dtxwmqi_841_64.sh file were set incorrectly. 

ENVIRONMENT
AIX but applies to all platforms. WTX 8.4.1.x and IIB 9.0.0.x

DIAGNOSING THE PROBLEM
Create a Service trace and search for "invalid map instance handle" error. 

RESOLVING THE PROBLEM
Error 32 is an internal error. Based on the lack of DTXMB messages in the service trace (IIB cannot find WTX message catalog), the probability exists that something is not installed correctly or the environment is not correct.

Check the following: 

1) Was slibclean (AIX only) run after the WTX installation, then the broker restarted?

2) Is the "Cache map" setting set for the maps that fail?

3) How many "additional instances" are set on the flows with WTX maps?

4) Are the WTX maps "Map in project" or "External"?

5) Are maps being overridden with LocalEnvironment? 

6) Are any maps ever modified while broker and wtx are active?

7) Also, do the following to help debug:

In an IIB mqsiprofile shell, get the env output and an ldd output of dtxwmqi.lil:

env > env.txt
cd $DTX_HOME_DIR_64
cd wmqi
ldd dtxwmqi.lil > ldd.txt

Then send env.txt and ldd.txt to Support. 

8) And, a dtxver list of $DTX_HOME_DIR_64/wmqi/dtxwmqi.lil and all of the files in $DTX_HOME_DIR_64/libs

9) Check permissions and ownership of the dtxwmqi_841_64.sh script located in the $MQSI_WORKPATH/common/profiles/ directory.