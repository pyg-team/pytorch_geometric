Title: IBM IZ76343: WEBSPHERE MQ 7: EJB MODULE DOES NOT START IF ANY OF THE MESSAGE ENDPOINTS TO AN ACTIVATION SPECIFICATION FAILS TO ACTIVATE - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.3 [http://www-01.ibm.com/support/docview.wss?uid=swg24026933]
WebSphere MQ V7.0 Fix Pack 7.0.1.3 [http://www-01.ibm.com/support/docview.wss?uid=swg24026932]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  An application contains multiple message-driven beans (MDBs),
   each bound to a different WebSphere MQ V7 Activation
   Specification. If any of the message endpoints fails to
   activate, the Enterprise JavaBean (EJB) module will not start,
   and subsequently, the application will fail to start.
   
   The following error messages are found in the SystemOut.log of
   the WebSphere Application Server V7:
   
   ActivationSpe E   J2CA0138E: The Message Endpoint activation
   failed for ActivationSpec jms/qm1 (com.ibm.mq.connector.inbound.
   ActivationSpecImpl) and MDB application a1 due to the following
   exception: javax.resource.spi.ResourceAdapterInternalException:
   com.ibm.msg.client.jms.DetailedIllegalStateException:
   JMSWMQ0018: Failed to connect to queue manager 'QM1' with
   connection mode 'Client' and host name 'x'. Check the queue
   manager is started and if running in client mode, check there
   is a listener running. Please see the linked exception for
   more information.
   .
   Caused by: com.ibm.mq.MQException: JMSCMQ0001: WebSphere MQ call
   failed with compcode '2' ('MQCC_FAILED')
   reason '2059' ('MQRC_Q_MGR_NOT_AVAILABLE').
   .
   Caused by: com.ibm.mq.jmqi.JmqiException: CC=2;RC=2059;AMQ9204:
   Connection to host 'x' rejected.
   ?1=com.ibm.mq.jmqi.JmqiException?CC=2;RC=2059;AMQ9213:
   A communications error for  occurred.
   .
   RAWrapperImpl E   J2CA0089E: The method activateEndpoint on
   ResourceAdapter JavaBean y failed with the following exception:
   javax.resource.spi.ResourceAdapterInternalException:
   com.ibm.msg.client.jms.DetailedIllegalStateException:
   JMSWMQ0018: Failed to connect to queue manager ...
   .
   EJBContainerI E   WSVR0040E: addEjbModule failed for ejb.jar
   ?class com.ibm.ws.runtime.component.DeployedEJBModuleImpl?
   javax.resource.spi.ResourceAdapterInternalException:
   com.ibm.msg.client.jms.DetailedIllegalStateException:
   JMSWMQ0018: Failed to connect to queue manager ...
   .
   EJBContainerI I   WSVR0041I: Stopping EJB jar: ejb.jar
   EJBContainerI I   WSVR0059I: EJB jar stopped: ejb.jar
   DeployedAppli W   WSVR0206E: Module, ejb.jar,
   of application, z, failed to start
   ApplicationMg W   WSVR0101W: An error occurred starting, z
   ApplicationMg A   WSVR0217I: Stopping application: z
   ApplicationMg A   WSVR0220I: Application stopped: z
   
   The expectation is that the application should be able to start
   successfully even if one of the MDB message endpoint activations
   fails and that the WebSphere MQ Resource Adapter should be able
   to reconnect to the MQ queue manager if it is not initially
   available.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects all users of the WebSphere MQ V7 Resource
   Adapter, and the WebSphere Application Server V7 WebSphere MQ
   messaging provider, that have applications consisting of
   multiple modules, including at least one MDB.
   
   Platforms affected:
   All Distributed (iSeries, all Unix and Windows) +Java
   ****************************************************************
   PROBLEM SUMMARY:
   If an MDB failed to connect to the queue manager when the
   application was starting up, the EJB module containing the MDB
   failed to start, which in turn caused the application startup
   to fail.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Startup reconnection logic has been added to the WebSphere MQ
   V7 Resource Adapter (WMQ RA) which allows an application to
   start successfully even if an MDB cannot connect to the
   specified WebSphere MQ queue manager during application
   initialisation.
   
   
   To enable this new function, the following JVM arguments need
   to be set on the application server that the WebSphere MQ
   Resource Adapter has been deployed into:
   
   com.ibm.mq.jms.tuning.startupReconnectionRetryCount=<value>
   com.ibm.mq.jms.tuning.startupReconnectionRetryInterval=<time
   in milliseconds>
   
   The startupReconnectionRetryCount specifies the number of times
   that the WMQ RA will attempt to connect the endpoint, and the
   startupReconnectionRetryInterval property defines the time
   between reconnection attempts.
   
   The default value for the startupReconnectionRetryCount is 0,
   while startupReconnectionRetryInterval defaults to 30000 (30
   seconds).
   
   When startup reconnection has been enabled, any MDB running
   inside the application server that is
   unable to connect to the specified queue manager during
   application startup will attempt to reconnect at regular
   intervals. The message shown below will be written to the
   application server's log file when startup reconnection is
   being enabled for an endpoint:
   
   ActivationSpec {actSpec} was unable to connect. Startup
   reconnection is being enabled.
   
   The following message indicates how long the WMQ RA will wait
   before trying to reconnect the endpoint:
   
   Waiting for {time} milliseconds before reconnecting
   {actSpec}.
   
   If the endpoint is able to reconnect successfully, the message:
   
   ActivationSpec {actSpec} reconnected successfully
   
   will be written to the application server's log file.
   
   In the situation where the endpoint fails to reconnect, and
   the maximum number of startup reconnection attempts is reached,
   the following messages are generated:
   
   Startup reconnection failed for ActivationSpec {actSpec}.
   Exception details: {Exception}.
   
   Caused by: {Exception}.
   
   These messages will give details of why the endpoint was unable
   to reconnect. If you see these messages, you should check that
   the queue manager and any associated listener are running, and
   then restart the application.
   
   
   If you wish to enable Startup Reconnection for the WebSphere
   Application Server v7 WebSphere MQ messaging provider, use the
   instructions shown below:
   
   - Start the application server.
   - Bring up the WebSphere Administrative Console, and log in.
   - In the left hand pane, expand Servers->Server Types and click
   on WebSphere application servers.
   - In the main pane in the Administrative Console, click on the
   entry for your server.
   - You should now see the Application servers window for your
   server. Expand Java and Process Management, and click on
   Process definition
   - On the Process definition pane, click on the Java Virtual
   Machine link on the left hand side.
   - Enter the following properties into the Generic JVM arguments
   field:
   
   -Dcom.ibm.mq.jms.tuning.startupReconnectionRetryCount=<value>
   -Dcom.ibm.mq.jms.tuning.startupReconnectionRetryInterval=
   <time in milliseconds>
   
   - Save the changes, and restart the application server.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v7.0
   Platform           Fix Pack 7.0.1.3
   --------           --------------------
   Windows            U200320
   AIX                U834987
   HP-UX (PA-RISC)    U834414
   HP-UX (Itanium)    U834413
   Solaris (SPARC)    U834986
   Solaris (x86-64)   U834210
   iSeries            tbc_p700_0_1_3
   Linux (x86)        U834415
   Linux (x86-64)     U834985
   Linux (zSeries)    U834412
   Linux (Power)      U835662
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ76343
   
   
 * REPORTED COMPONENT NAME
   WMQ AIX V7
   
   
 * REPORTED COMPONENT ID
   5724H7221
   
   
 * REPORTED RELEASE
   701
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-05-21
   
   
 * CLOSED DATE
   2010-05-26
   
   
 * LAST MODIFIED DATE
   2010-05-26
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ AIX V7
   
   
 * FIXED COMPONENT ID
   5724H7221
   
   

APPLICABLE COMPONENT LEVELS
 * R701 PSY
   UP