Title: IBM PI56596: [XU] STACKOVERFLOWERROR WHEN XU STOPPED - United States

Text:
z/os  FIXES ARE AVAILABLE
Operational Decision Manager V8.8.1 Mod Pack [http://www-01.ibm.com/support/docview.wss?uid=swg24042247]
Operational Decision Manager V8.8.1 Download Document [http://www-01.ibm.com/support/docview.wss?uid=swg24042245]
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When a customer terminated their RES server they received a
   StackOverflowError:
   java.lang.StackOverflowError
   at java.util.ArrayList$Itr.remove(ArrayList.java:860)
   at com.ibm.rules.res.xu.util.internal.WeakIterator.next(
   AbstractWeakCollection.java:223)
   at com.ibm.rules.res.xu.util.internal.WeakIterator.next(
   AbstractWeakCollection.java:224)
   at com.ibm.rules.res.xu.util.internal.WeakIterator.next(
   AbstractWeakCollection.java:224)
   at com.ibm.rules.res.xu.util.internal.WeakIterator.next(
   AbstractWeakCollection.java:224)
   [...]
   at com.ibm.rules.res.xu.util.internal.WeakIterator.next(
   AbstractWeakCollection.java:224)
   at com.ibm.rules.res.xu.util.internal.WeakIterator.hasNext(
   AbstractWeakCollection.java:208)
   at com.ibm.rules.res.xu.work.internal.WorkManagerImpl.stop(
   WorkManagerImpl.java:61)
   at com.ibm.rules.res.xu.spi.internal.XUResourceAdapter.stop(
   XUResourceAdapter.java:86)
   at com.ibm.rules.res.xu.client.internal.XUClient.stopXU(
   XUClient.java:275)
   at ilog.rules.res.session.IlrJ2SESessionFactory.release(
   IlrJ2SESessionFactory.java:375)
   at ilog.rules.res.session.rawdata.RawDataRuleServiceFactory.
   close(RawDataRuleServiceFactory.java:152)
   at com.ibm.rules.hbr.runtime.RulesExecutionManager.terminate(
   RulesExecutionManager.java:623)
   examining the code we have notice two things:
   1) WorkManagerImpl only ever adds to an ever increasing
   ArrayList (until stopped) so it's not surprising it can
   eventually be huge enough to cause stack overflow when
   recursively walking.
   2) WeakIterator could be recoded to use a while loop rather
   than recursion. E.g.
                  while (next == null) {
                      WeakReference<E> reference =
   underlyingIterator.next();
                      next = reference.get();
                      if (next == null) {
                          underlyingIterator.remove();
                      }
                  }
                  E result = next;
                  next = null;
                  return result;
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of Operational Decision            *
   *                 Management for z/OS Version 8.6.0.3          *
   *                                                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: Incoming work items are added to a      *
   *                      queue but never deleted when the work   *
   *                      item is complete. When an attempt is    *
   *                      made to clear the queue at shutdown,    *
   *                      a stack overflow can occur because      *
   *                      the queue is so large.                  *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   The work items need to be removed from the queue when
   they complete.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Code modified to remove work items on completion thus
   avoiding possible stack overflow at shutdown.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI56596
   
   
 * REPORTED COMPONENT NAME
   WS ODM FOR Z/OS
   
   
 * REPORTED COMPONENT ID
   5655Y1700
   
   
 * REPORTED RELEASE
   805
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-02-04
   
   
 * CLOSED DATE
   2016-05-05
   
   
 * LAST MODIFIED DATE
   2016-06-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI37551
   
   

MODULES/MACROS
 *  HBRZPAX9
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WS ODM FOR Z/OS
   
   
 * FIXED COMPONENT ID
   5655Y1700
   
   

APPLICABLE COMPONENT LEVELS
 * R603 PSY UI37551 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI37551]
   UP16/05/06 P F605
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.