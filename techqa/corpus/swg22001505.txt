Title: IBM How to resolve index corruption in db2 ? - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 How to resolve index corruption in db2 ? 

ANSWER
We may met index corruption in some situation, and in db2diag.log there are similar entries like this:
2017-03-30-12.38.31.971346+480 I135403A5507 LEVEL: Severe
PID : 4456656 TID : 42583 PROC : db2sysc 0
INSTANCE: db2inst1 NODE : 000 DB : SAMPLE
APPHDL : 0-26926 APPID: LOCALHOST.47117.17033002510
AUTHID : DB2INST1 HOSTNAME: HOST1
EDUID : 42583 EDUNAME: db2agent (SAMPLE) 0
FUNCTION: DB2 UDB, buffer pool services, sqlb_verify_page, probe:0
MESSAGE : ZRC=0x86020019=-2046689255=SQLB_CSUM "Bad Page, Checksum Error"
DIA8426C A invalid page checksum was found for page "".
DATA #1 : String, 64 bytes
Error encountered trying to read a page - information follows : 
DATA #2 : String, 23 bytes
Page verification error
DATA #3 : Page ID, PD_TYPE_SQLB_PAGE_ID, 4 bytes
30460385
DATA #4 : Object descriptor, PD_TYPE_SQLB_OBJECT_DESC, 96 bytes
Obj: {pool:2;obj:2;type:1} Parent={2;2} 

 

This error means the object 2 in tablespace 2 is corrupted, and the type of the object is type:1 which means index corruption. 

 

Depending on when index corruption was detected, we had 2 ways to solve the problem 

1. During crash recovery 

1.1 db2stop force 

1.2 db2dart <dbname> /MI /TSI 2 /OI 2 

1.3 db2 update dbm cfg using indexrec access 

1.3 db2start 

1.4 db2 connect to <dbname> 

1.5 db2 "select tabschema, tabname from syscat.tables where tbspaceid=2 and tableid=2" 

1.6 db2 "select count(*) from <tabschema>.<tabname>" ---> this will trigger an index rebuilding 

 

2. When database is accessable 

2.1 get the tabschema and tabname from syscat.table 

 db2 "select tabschema, tabname from syscat.tables where tbspaceid=2 and tableid=2" 

2.2 db2 reorg indexes all for table <tabschema>.<tabname>