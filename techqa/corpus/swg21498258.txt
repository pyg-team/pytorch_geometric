Title: IBM z/OS implicit TLS FTP connection to server times out after the TCP 3-way handshake - United States

Text:
IMPLICIT FTP SECUREIMPLICITZOS TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The z/OS system is acting as an FTP client trying to establish an implicit TLS connection to a server and times out after the TCP 3-way handshake. 

SYMPTOM
The client FTP joblog has the following error messages: 

EZA2589E Connection to server interrupted or timed out. Waiting for reply 
EZA1721W Server not responding, closing connection. 

The packet trace shows the following flow:

TcpHdr IO Seq Ack Data Delta Time TimeStamp
S O 1851158453 0 0 0.000000 12:54:12.000289
A S I 288112570 1851158454 0 0.016834 12:54:12.017123
A O 1851158454 288112571 0 0.000080 12:54:12.017203
AP F O 1851158454 288112571 0 15.002194 12:54:27.019397
A I 288112571 1851158455 0 0.009191 12:54:27.028588
AP F I 288112571 1851158455 0 0.118050 12:54:27.146638
AP O 1851158455 288112572 0 0.000072 12:54:27.146710

As shown above, after the TCP 3-way handshake, the client waits 15 seconds, then sends out a FIN to close the connection. Also, note that we don't see the server's reply 220 (hello message) after the TCP 3-way handshake.



CAUSE
The server is expecting the client to initiate the SSL handshake before it sends out the reply 220 (hello message). The client, however, is expecting to see the reply 220 before it initiates the SSL handshake. In z/OS terms, the server's SECUREIMPLICITZOS is currently set to FALSE and the client's same setting is set to TRUE (default). The SECUREIMPLICITZOS needs to be the same on both the server and the client in order for the implicit SSL connection to work.


DIAGNOSING THE PROBLEM
Collect a packet trace (SYSTCPDA).



RESOLVING THE PROBLEM
Code the following statements in the FTP.DATA file for the client: 

TLSPORT xxxx
SECUREIMPLICITZOS FALSE