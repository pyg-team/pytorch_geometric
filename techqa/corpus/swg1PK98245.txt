Title: IBM PK98245: WMQ V7: COD MESSAGE GOES TO THE DEAD LETTER QUEUE WITH MQRC 2049 - United States

Text:
z/os SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS FIXED IF NEXT.
    
   
   

ERROR DESCRIPTION
 *  COD (Confirm On Delivery) messages appear on the DLQ (Dead
   Letter Queue) with MQ reason code 2049 (x'00000801')
   MQRC_PRIORITY_EXCEEDS_MAXIMUM.  Yet the application receives the
   COD message as well. The report message should not go both
   places.
   .
   This problem happens with WebSphere MQ V7 but not V6.  V7 was
   changed to match this statement in the Application Programming
   Reference
   "If a message is put with a priority greater than the maximum
    supported by the local queue manager (this maximum is given by
    the MaxPriority queue-manager attribute), the message is
    accepted by the queue manager, but placed on the queue at the
    queue manager's maximum priority; the MQPUT or MQPUT1 call
    completes with MQCC_WARNING and reason code
    MQRC_PRIORITY_EXCEEDS_MAXIMUM. However, the Priority field
    retains the value specified by the application that put the
    message."
   At V6, the priority in the MQMD was being changed.
   .
   A trace shows that MQMD.Priority=x'00FFFFFF' was bad on the
   request message.  The RC2049 occurred for the request message,
   but it was processed without going to the DLQ. Then, the report
   message got the RC2049 because the Priority from the original
   message was copied to it.
   
   
    
   
   

LOCAL FIX
 *  Correct the application so that it sets MQMD.Priority within
   the valid range of 0 to 9.  The field is 4 bytes.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere MQ for z/OS Version 7 *
   *                 Release 0 Modification 0 and Modification 1. *
   ****************************************************************
   * PROBLEM DESCRIPTION: Report messages are unexpectedly put to *
   *                      the dead-letter queue with MQDLH.Reason *
   *                      set to MQRC_PRIORITY_EXCEEDS_MAXIMUM.   *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   An MQPUT is issued with MQMD.Priority specifying a priority
   greater than the maximum allowed by the queue-manager, and
   MQMD.Report specifying MQRO_COD. The message is put to the
   queue, and the MQPUT returns MQCC_WARNING,
   MQRC_PRIORITY_EXCEEDS_MAXIMUM.
   
   When an MQGET retrieves the above message, a COD report message
   is put to the reply queue as expected. However, a copy of the
   COD report message is also put to the dead-letter queue with
   a reason code of 2049, MQRC_PRIORITY_EXCEEDS_MAXIMUM.
   
   The same problem may also be seen when using other report
   options, for example MQRO_COA or MQRO_EXPIRTATION.
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS
 *  This APAR is being closed FIN with agreement from the submitting
   customer.
   
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   PK98245
   
   
 * REPORTED COMPONENT NAME
   WMQ Z/OS V7
   
   
 * REPORTED COMPONENT ID
   5655R3600
   
   
 * REPORTED RELEASE
   000
   
   
 * STATUS
   CLOSED FIN
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-10-08
   
   
 * CLOSED DATE
   2009-10-19
   
   
 * LAST MODIFIED DATE
   2009-10-19
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS
 * R000 PSN
   UP