Title: IBM IV91752: THE FIRST UPDATE STATEMENT FOR A COLUMN-ORGANIZED TABLE MAY IN RARE CASES CAUSE FUTURE QUERIES TO MISS SOME MATCHING RESULTS. - United States

Text:
  FIXES ARE AVAILABLE
DB2 Version 11.1 Mod1 Fix Pack1 iFix001 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24043526]
DB2 Version 11.1 Mod 2 Fix Pack 2 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24043789]
Db2 Version 11.1 Mod2 Fix Pack2 iFix001 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24044133]
Db2 Version 11.1 Mod2 Fix Pack2 iFix002 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24044392]
Db2 Version 11.1 Mod 3 Fix Pack 3 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24044630]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  This problem only exists on v11.1 FP1 level.
   
   The very first UPDATE statement issued against a
   column-organized table might in some very rare cases cause
   incorrect
   results, if followed by a rollback. This can only happen if the
   target table has a synopsis table associated with it.
   
   If the transaction associated with this very first UPDATE
   statement to the column-organized table is committed, no further
   issues will be encountered. However, if the transaction
   associated with the very first UPDATE statement against the
   column-
   organized table issues a ROLLBACK, in some cases this could
   cause future queries against this column-organized table to not
   return some results that match the query predicates. This
   situation will normally be resolved (that is, queries will
   return all
   matching results) as soon as the next INSERT or UPDATE statement
   into this table performs a COMMIT, or as soon as the
   database is de-activated and re-activated.
   
   In addition, if the very first UPDATE statement to a
   column-organized table is ALSO the very first insert or update
   against that
   table since database activation, then in some very rare cases
   the next synopsis entry written into the associated synopsis
   table
   may then improperly miss some rows from the table, which could
   cause future queries against this table to not return some
   results that match the query predicates.
   
   In both cases, any missing query results are limited to the 1023
   rows inserted immediately before the very first UPDATE
   statement to the table.
   
   
    
   
   

LOCAL FIX
 *  If the transaction associated with the very first UPDATE
   statement against a column-organized table is rolled back
   instead of
   committed, the database should be de-activated and then
   re-activated to properly re-generate the in-memory synopsis
   metadata for the column-organized table.
   
   If the very first UPDATE statement to a column-organized table
   is ALSO the very first insert or update against the table since
   database activation, the database should be de-activated and
   then re-activated to reduce the risk that an incorrect synopsis
   entry is created.
   
   To determine if existing column-organized tables are likely
   impacted by this issue, check for unexpected small gaps in the
   TSNMIN and TSNMAX columns in your synopsis table records. You
   can find all synopsis tables in your database with a query
   like:
    SELECT TABSCHEMA, TABNAME, TABLEORG FROM SYSCAT.TABLES WHERE
   TABSCHEMA = 'SYSIBM' AND TABLEORG = 'C' AND
   TABNAME LIKE 'SYN%'
   
   From the above list of synopsis tables, check the TSNMIN and
   TSNMAX values with a query like the following, replacing the
   synopsis tablename with one of the synopsis tablenames reported
   in the query above:
    SELECT TSNMIN, TSNMAX FROM SYSIBM.SYN161222101902317114_T1
   ORDER BY TSNMIN
   
   There is typically 1 synopsis record created for every 1024 rows
   in the corresponding CDE table. The first few results from the
   above query may look something like the following:
   TSNMIN               TSNMAX
   ------------ ------------
              0         1023
           1025         2047
           2048         3071
   
   If the TSNMAX value for the first record is 1023, and the
   associated TSNMIN value is not 0, then the associated column
   organized table may be impacted by this issue. In the case
   above, the TSNMIN value for the first record is 0, which
   indicates
   that synopsis record is still valid. For subsequent records, if
   the gap between the previous record's TSNMAX value and the
   current record's TSNMIN value is greater than 1 but less than
   1023, then the associated table may be impacted by this issue.
   In
   the case above, the second record shows that the table may be
   affected by this issue, since the 2nd record's TSNMIN value of
   1025 is 2 greater than the previous record's TSNMAX value of
   1023. The third synopsis record shows that it is unaffected,
   since
   the 3rd record's TSNMIN value is exactly 1 greater than the 2nd
   record's TSNMAX value of 2047. Note that it is normal to see
   gaps larger than 1023 from the above query - this does not
   normally indicate any issue, although you will be unable to
   determine if the very first synopsis record after a large gap
   indicates a problem or not.
   
   If the above queries have shown that one or more of your
   column-organized tables are susceptible to this issue, then you
   should contact your customer service representative to request
   assistance with the synopsis table rebuild procedure
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * ALL                                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * See Error Description                                        *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Upgrade to DB2 11.1 Mod1 Fix Pack 1 iFix001                  *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  First fixed in DB2 11.1 Mod1 Fix Pack 1 iFix001
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV91752
   
   
 * REPORTED COMPONENT NAME
   DB2 COLUMN STOR
   
   
 * REPORTED COMPONENT ID
   DB2CLMSTR
   
   
 * REPORTED RELEASE
   B10
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-01-02
   
   
 * CLOSED DATE
   2017-05-01
   
   
 * LAST MODIFIED DATE
   2017-06-21
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 COLUMN STOR
   
   
 * FIXED COMPONENT ID
   DB2CLMSTR
   
   

APPLICABLE COMPONENT LEVELS
 * RB10 PSN
   UP