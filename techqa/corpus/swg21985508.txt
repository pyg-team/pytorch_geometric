Title: IBM What's a sustained trap? - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 What's a sustained trap? 

ANSWER
In some cases, you may see an EDU traps (e.g. with signal 11), application receives SQL1224N indicates its connection is forced off, and the subsequent application(s) can still make connections to the database.
From db2diag.log, you can find:

1. Trap Sustainability Criteria Checking = true

2016-06-02-11.57.40.871392+480 I5041137A562 LEVEL: Severe
PID : 9633846 TID : 13517 PROC : db2sysc 0
INSTANCE: db2inst1 NODE : 000 DB : PROD
APPHDL : 0-42162 APPID: 172.23.8.72.57806.160602042559
AUTHID : ASAPS 
EDUID : 13517 EDUNAME: db2agent (PROD) 0
FUNCTION: DB2 UDB, RAS/PD component, pdResilienceIsSafeToSustain, probe:800
DATA #1 : String, 37 bytes
Trap Sustainability Criteria Checking
DATA #2 : Hex integer, 8 bytes
0x0000000000001000
DATA #3 : Boolean, 1 bytes
true

2. Message indicates "EDU has been suspended"

2016-06-02-11.57.41.275190+480 E5097042A446 LEVEL: Severe
PID : 9633846 TID : 13517 PROC : db2sysc 0
INSTANCE: db2inst1 NODE : 000 DB : PROD
APPHDL : 0-42162 APPID: 172.23.8.72.57806.160602042559
AUTHID : ASAPS 
EDUID : 13517 EDUNAME: db2agent (PROD) 0 (suspended) 0
FUNCTION: DB2 UDB, RAS/PD component, pdSuspendEDU, probe:10
MESSAGE : EDU has been suspended

All above suggest a sustained trap happened. The sustaining of traps in general depends on many things. After a sustained trap, the connection associated with the trapping agent should be forced off and receive error, the sustained traps do not hold up any other work.

Note that db2stop force will not be able to force the last suspended agent and it will hang in early versions(i.e. DB2 V9.7 FixPack 2 or earlier FixPacks, V9.8 FixPack 3 or earlier FixPacks). If db2stop force is hanging it is working as designed in these versions - though it should timeout and kill db2sysc after start_stop timeout(default 10 minutes). 

The instruction of "Recovering from sustained traps" is in Information center:
Recovering from sustained traps - V9.7 [http://www.ibm.com/support/knowledgecenter/SSEPGG_9.7.0/com.ibm.db2.luw.admin.trb.doc/doc/t0055494.html]
Recovering from sustained traps - V9.8 [http://www.ibm.com/support/knowledgecenter/SSEPGG_9.8.0/com.ibm.db2.luw.admin.trb.doc/doc/t0055494.html]
Recovering from sustained traps - V10.1 [http://www.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.db2.luw.admin.trb.doc/doc/t0055494.html]
Recovering from sustained traps - V10.5 [http://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.admin.trb.doc/doc/t0055494.html]
Recovering from sustained traps - V11.1 [http://www.ibm.com/support/knowledgecenter/SSEPGG_11.1.0/com.ibm.db2.luw.admin.trb.doc/doc/t0055494.html]