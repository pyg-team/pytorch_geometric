Title: IBM Configuring WebSphere Business Monitor for durable event messages from WebSphere Message Broker - United States

Text:
Business Activity Monitoring; BAM; WMB; Business Process Monitoring TECHNOTE (FAQ)

QUESTION
 How should the Business Monitoring sample application supplied with WebSphere Message Broker be configured for durable, asynchronous persistent monitoring events? 

CAUSE
The Business Monitoring sample application supplied with WebSphere Message Broker http://publib.boulder.ibm.com/infocenter/wmbhelp/v7r0m0/topic/com.ibm.etools.mft.samples.WBMonitor.doc/doc/running.htm [http://publib.boulder.ibm.com/infocenter/wmbhelp/v7r0m0/topic/com.ibm.etools.mft.samples.WBMonitor.doc/doc/running.htm] uses a non-durable, managed subscription from WebSphere Application Server, where WebSphere Business Monitor is deployed.
This means that any events emitted by Message Broker while there is no consumer for them (for example, if the Monitor server is down, or if the ListenerPort or the message-driven bean are stopped) are lost.


ANSWER
Replace paragraph „Install and configure the message-driven bean (MDB)“ in the sample documentation http://publib.boulder.ibm.com/infocenter/wmbhelp/v7r0m0/topic/com.ibm.etools.mft.samples.WBMonitor.doc/doc/running.htm [http://publib.boulder.ibm.com/infocenter/wmbhelp/v7r0m0/topic/com.ibm.etools.mft.samples.WBMonitor.doc/doc/running.htm] with these instructions: 

Install and configure the message-driven bean (MDB) 

In this sample, WebSphere MQ is configured as the JMS Provider. You must set the following definitions on the WebSphere Message Broker queue manager before you can configure WebSphere MQ as the JMS Provider: 

1. Create a TCP listener and start it. 

2. Create a Server Connection channel. 

3. Run the WebSphere MQ supplied MQJMS_PSQ.mqsc file to create the required JMS queues on the WebSphere Message Broker queue manager. This .mqsc file is contained in the WebSphere MQ product install directory in the java/bin subdirectory. Run the runmqsc command, for example: 

 * 
 * runmqsc MB7QMGR < MQJMS_PSQ.mqsc
 * 


Option 1: Explicitly defined WebSphere MQ queue and durable subscription: Defining and administering a durable subscription and a named queue in WebSphere MQ gives you explicit control over the WebSphere MQ resources used by the message-driven bean. 

4. Create a local WebSphere MQ queueMONITOR.EVENTS 

 * 
 * echo DEFINE QLOCAL('MONITOR.EVENTS') | runmqsc MB7QMGR


5. Create a WebSphere MQ subscription DURABLE.MONITOR.EVENTS  * 
 * echo DEFINE SUB('DURABLE.MONITOR.EVENTS') TOPICSTR('$SYS/Broker/+/Monitoring/#') DEST('MONITOR.EVENTS') | runmqsc MB7QMGR


When you have completed the previous steps to set the definitions, you can configure WebSphere MQ as the JMS Provider in WAS Integration Console: 

6. Create a JMS queuejms/durableMonitorEvents: 

 * 
 * 
 * Resources > JMS > Queues
 * 
 * New
 * 
 * b. Click WebSphere MQ messaging provider, click OK. 
 * c. Enter the name and JNDI name in the Name and JNDI name fields; for example, durableMonitorEvents andjms/durableMonitorEvents. 
 * d. In the WebSphere MQ Queue Name field, enter MONITOR.EVENTS. 
 * e. Click OK, click Save. 
 * 


7. Create the Activation Specification jms/durableMonitorEventsActivationSpec:  * 
 * 
 *  Resources > JMS > Activation Specifications
 * 
 * New
 * 
 * b. Click WebSphere MQ messaging provider, click OK. 
 * c.Enter the name and JNDI name in the Name and JNDI name fields; for example, durableMonitorEventsActivationSpec and jms/durableMonitorEventsActivationSpec. 
 * d.Specify MDB destination data: Destination JNDI name = jms/durableMonitorEvents and Destination Type = Queue 
 * e.Enter the queue manager name for your WebSphere Message Broker queue manager and click Next. 
 * f. Set Transport to Client. 
 * g. Enter the host name for where your WebSphere Message Broker queue manager is running. 
 * h. In the Port field, enter the port number of the TCP listener that you defined in the WebSphere Message Broker queue manager. 
 * i. In the Channel field, enter the name of the Server Connection channel. 
 * j. Click Next > Next > Finish. 
 * k. Click Save.


Proceed with step 8 below.  * 


Option 2: Durable subscription managed by WebSphere Application Server You may let the Activation Specification in WebSphere Application Server automatically create a durable subscription and a permanent-dynamic queue in WebSphere MQ. Please note that WebSphere Application Server does not clean up durable WebSphere MQ resources when the message-driven bean is uninstalled. This means you will have to manually delete the orphaned durable subscription and permanent-dynamic queue in WebSphere MQ. The steps to do this are described in Removing WebSphere Application Server V7 and V8 durable subscriptions created using WebSphere MQ messaging provider normal mode [http://www-01.ibm.com/support/docview.wss?uid=swg21577415]. 

When you have completed the previous steps to set the definitions, you can configure WebSphere MQ as the JMS Provider in WAS Integration Console: 

4. Create a JMS topic jms/durableMonitorEventsTopic: 

 * 
 * 
 * Resources > JMS > Topics
 * 
 * New
 * 
 * b. Click WebSphere MQ messaging provider, click OK. 
 * c. Enter the name and JNDI name in the Name and JNDI name fields; for example, durableMonitorEventsTopic andjms/durableMonitorEventsTopic. 
 * d. In the WebSphere MQ Topic Name field, enter $SYS/Broker/+/Monitoring/# 
 * e. Click OK, click Save. 
 * 


5. Create the Activation Specification jms/durableMonitorEventsTopicActivationSpec:  * 
 * 
 *  Resources > JMS > Activation Specifications
 * 
 * New
 * 
 * b. Click WebSphere MQ messaging provider, click OK. 
 * c.Enter the name and JNDI name in the Name and JNDI name fields; for example, durableMonitorEventsTopicActivationSpec and jms/durableMonitorEventsTopicActivationSpec. 
 * d.Specify MDB destination data: Destination JNDI name = jms/durableMonitorEventsTopic and Destination Type = Topic 
 * e. Select Durable subscription and type Subscription name = durableMonitorEventsSubscription 
 * f. Enter the queue manager name for your WebSphere Message Broker queue manager and click Next. 
 * g. Set Transport to Client. 
 * h. Enter the host name for where your WebSphere Message Broker queue manager is running. 
 * i. In the Port field, enter the port number of the TCP listener that you defined in the WebSphere Message Broker queue manager. 
 * j. In the Channel field, enter the name of the Server Connection channel. 
 * k. Click Next > Next > Finish. 
 * l. Click Save.


6. Set Client ID for Activation Specification durableMonitorEventsTopicActivationSpec:  * 
 * 
 *  
 * durableMonitorEventsTopicActivationSpec
 * 
 *  Advanced - Client ID
 * 
 * myCell
 * DurableMonitorEventsTopicActivationSpec
 * b. Click Save.


7. Proceed with step 8 below.  * 


8. By default, when a message-driven bean (MDB) experiences a rollback at runtime, the endpoint associated with the MDB is paused and has to be resumed manually (in Application servers > server1 > Installed applications > WMBEventEmitter > Manage message endpoints ). This can be avoided as follows: Click Resources > JMS > Activation Specification > durableMonitorEventsActivationSpec > Advanced properties, and uncheck property "Stop endpoint if message delivery fails". 

 

9. Install the MDB application: 

 * 
 * 
 *  WebSphere Message Broker Toolkit
 * 
 * .zip
 * 
 * WMBEventEmitterEAR
 * 
 * b. Switch to the Monitor Server administrative console by clicking Applications > New Application and select New Enterprise Application. 
 * c. Click Browse and select the WMBEventEmitter.ear file that you extracted from the .zip file, click Next. 
 * d. Select Detailed - Show all installation options and parameters, click Next. 
 * e. Click Continue. 
 * f. Click Next until you get to Step 5 Bind listeners for message driven bean. Select Activation Specification and type Target Resource JNDI Name = jms/durableMonitorEventsActivationSpec for option 1 or jms/durableMonitorEventsTopicActivationSpec for option 2 
 * g. In Step 6 Map security roles to users or groups, select the eventEmitter role check box, select the Administrative user that you want to map to the eventEmitter role. 
 * h. In Step 7 Map RunAs roles to users, assign the user name and password of the Administrative user (from step 6) to the eventEmitter role. 
 * g. Click Next on the remaining screens; on the final summary screen, click Finish. 
 * h. Save the definition.


10. Restart the server. For option 1, all Message Broker event messages will be collected on WebSphere MQ local queue MONITOR.EVENTS. When the monitor server starts, it will automatically connect to that queue, consume its messages and send them to CEI for WebSphere Business Monitor. 

For option 2, Message Broker event messages will be collected on WebSphere MQ permanent dynamic queueSYSTEM.MANAGED.DURABLE.<someID>. You can find out about the full name in DEST property of automatically created WebSphere MQ subscription JMS:MB7QMGR:myCellDurableMonitorEventsTopicActivationSpec:durableMonitorEventsSubscription. 

 


Cross reference information Segment Product Component Platform Version Edition Business Integration WebSphere Message Broker Documentation AIX, HP-UX, Linux, Solaris, Windows, z/OS 7.0, 6.1 All Editions Business Integration WebSphere MQ Documentation AIX, HP-UX, Linux, Solaris, Windows, z/OS 7.1, 7.0 All Editions Application Servers WebSphere Application Server Java Message Service (JMS) Business Integration IBM Business Monitor Documentation AIX, HP-UX, Linux, Linux zSeries, Solaris, Windows, z/OS 7.5.1, 7.5