Title: IBM PI95166: DFHTS0001 0C4 IN DFHTSAM +4C8 LEADS TO DFHTS1310 AND CICS ABEND - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A CICS 5.4 user task fails with message:
   .
   DFHTS0001 An abend (code 0C4/AKEA) has occurred at offset
    X'04C8' in module DFHTSAM.
   .
   Sometime shortly afterward, CICS itself abends with message:
   .
   DFHTS1310 Temporary storage data set does not match bit map
   .
   The 0C4 in DFHTSAM occurs on the MVCL instruction at offset
   x'4C8' (base level), because R14 is zeroes. The problem is
   that the user application passed zeroes as its FROM address on
   a WRITEQ TS request, but CICS temporary storage module DFHEITS
   did not detect the invalid FROM address. The WRITEQ TS request
   would have been something like:
   .
   EXEC CICS WRITEQ TS QUEUE(QQQQQQQQ) FROM(00000000)
   .
   The zero FROM address can be seen in the 0C4 exception trace
   entry as the AUX_DATA address:
   .
   TS 0903 TSAM *EXC* - Recovery_entered FUNCTION(WRITE_AUX_DATA)
                AUX_DATA(00000000 , 000029C6) QUEUE_NAME(QQQQQQQQ)
                TIME_STAMP(D40492EE82A8B0CE) ITEM_NUMBER(4)
                SECTION_NUMBER(1) FMH(NO) RECOVERABLE(NO)
                SUSPEND(YES)
   .
   After DFHEITS failed to detect the invalid FROM address, the
   bad address was passed on to DFHTSAM. DFHTSAM updated the TS
   Byte Map, then tried to move data from address 0 and took the
   0C4. This left the TS Byte Map in the inconsistent state which
   eventually led to the TS1310 abend. The application error would
   have detected as invalid in CICS releases prior to CICS TS 5.4.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All CICS users                               *
   ****************************************************************
   * PROBLEM DESCRIPTION: An application program which issues     *
   *                      EXEC CICS WRITEQ TS with a bad FROM     *
   *                      address causes CICS to abend with       *
   *                      DFHTS1310.                              *
   ****************************************************************
   * RECOMMENDATION: .                                            *
   ****************************************************************
   A CICS application program issues EXEC CICS WRITEQ TS with
   a an invalid FROM address.
   CICS fails to detect the bad address and goes on to update
   its TS Domain control blocks incorrectly.
   This will lead to a TS0001 abend and may lead to a TS1310 abend.
   Additional keywords:  1310 TS0001 0001
   
   
    
   
   

PROBLEM CONCLUSION
 *  DFHEITS has been corrected to validate the combination
   of the FROM address and length value in EXEC CICS WRITEQ TS
   commands.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI95166
   
   
 * REPORTED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * REPORTED COMPONENT ID
   5655Y0400
   
   
 * REPORTED RELEASE
   100
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2018-03-14
   
   
 * CLOSED DATE
   2018-03-22
   
   
 * LAST MODIFIED DATE
   2018-03-23
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI54655
   
   

MODULES/MACROS
 *  DFHEITS
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * FIXED COMPONENT ID
   5655Y0400
   
   

APPLICABLE COMPONENT LEVELS
 * R100 PSY UI54655 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI54655]
   UP18/03/23 I 1000
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.