Title: IBM Why does memory % differ for "show memory" and "show load" when using DataPower? - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The memory % in "show load" can be significantly higher than the memory % in "show memory". Why are they different? What do they mean? 

SYMPTOM
The WebSphere DataPower WebGUI status value "System Usage "(CLI command "show load") has a memory % that can be significantly higher than the status value "Memory Usage" (CLI command "show memory") memory %. What accounts for this discrepancy?


CAUSE
When you display "Memory Usage" from webGUI, notice the various categories of memory values: 

 * Total Memory 
 * Used Memory 
 * Free Memory 
 * Requested Memory 
 * Hold Memory 


The memory value in "Memory Usage" from the webGUI (" show memory" in CLI command) is based on Used Memory / Total Memory. 

The memory value in System Usage from the webGUI (" show load" in CLI command) is derived by Requested Memory / calculated available Memory*. Note that Requested Memory is equal to Used Memory + Hold Memory. 

In other words, System Usage takes into account all the memory that has been allocated from the Operating System (OS), regardless of whether it is being actively used, or simply held in reserve. 
This is a useful number to note if you are looking at memory problems. However, the Memory Usage from webGUI (" show memory" in CLI command) figure would be a more accurate measure to use for capacity planning, since the Hold Memory is available to DataPower for re-use. 

If you are looking for how much memory your traffic is currently using, look at Memory Usage from webGUI (" show memory" in CLI command). 

Requested Memory is generally the highest amount of memory that has been Used and/or Held since the most recent reboot. When DataPower finishes with a block of memory, it returns that block to the Hold Memory list, not to the OS. So Requested Memory (Used Memory + Hold Memory) normally stays level or else grows. The Hold Memory is released back to the DataPower OS in case of an Out of Memory (OOM) condition, or a device reboot. 
RESOLVING THE PROBLEM
If your "show load" memory % is higher than your "show memory" %, that is because the latter does not include Hold Memory, a pool of allocated memory that DataPower has access to but is not currently using. In general, the "show memory" or Memory Usage % is a more accurate measure of the memory currently being used. 

"show memory" = Used Memory / Total Memory 

"show load" memory = Requested Memory / calculated available Memory* 

Requested Memory = Used Memory + Hold Memory 

 

* The calculated available Memory value varies but is approximately equal to 3 GB.