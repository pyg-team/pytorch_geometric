Title: IBM JVMTI_ERROR_MUST_POSSESS_CAPABILITY Errors in ITCAM trace logs - United States

Text:
JVMTI_ERROR_MUST_POSSESS_CAPABILITY JVMTI HotSpot High CPU CAMADALL TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 ITCAM for Websphere's trace-dc-native.log gets filled up with the following ERROR trace on WebSphere 6.1 on Solaris and HP-UX platforms:

ERROR: JVMTI error: NO: 99 Name: JVMTI_ERROR_MUST_POSSESS_CAPABILITY Location ../../../src/gpe/dll/JVMPIWrapper.cc:203 Msg: 

SYMPTOM
1. ITCAM's trace-dc-native.log rolls over very frequently, especially under heavy user loads, with the JVMTI_ERROR_MUST_POSSESS_CAPABILITY error messages. 

2. This usually causes an increase in CPU usage due to the rapid generation of these error messages and the associated high disk activity to write these messages.


CAUSE
This is due to a defect in the HotSpot 1.5.0 JVM where the JVM Tool Interface (JVMTI) capability for tagging heap objects fails when the -XX:-UseConcMarkSweepGC (concurrent low pause garbage collector for the tenured generation) is used. This defect has not been fixed in JVM 1.5.0 and seems to be addressed only in 1.6 JVMs according to the bug database:

http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6278106 [http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6278106]

ITCAM Data Collector enables the capability to tag heap objects for performing memory analysis features. Due to the above JDK defect, the JVMTI capabilities become disabled when this occurs leading to the above JVMTI_ERROR_MUST_POSSESS_CAPABILITY errors.


ENVIRONMENT
WebSphere 6.1 on Solaris and HP-UX platforms that use HotSpot 1.5.0 JVM (all versions). 



RESOLVING THE PROBLEM
There are two workarounds for this issue: 


1. Add the following WebSphere environment variable:

AM_HEAPDUMP=false 

This will cause the Heap analysis feature in ITCAM to be disabled as it will prevent the heap tagging capability in ITCAM.
(This can be done using the WebSphere admin console from the "Application servers > (server name) > Process Definition > Environment Entries" page)

2. If the heap analysis feature is desired, then remove the concurrent collector options (-XX:+UseConcMarkSweepGC along with related options like -XX:+CMSIncrementalMode -XX:+CMSIncrementalPacing). You can try using other garbage collector options like the throughput collector (-XX:+UseParallelGC) instead.

 


Cross reference information Segment Product Component Platform Version Edition Systems and Asset Management Tivoli Composite Application Manager for Application Diagnostics ITCAM for APPLICATION DIAGNOSTICS Agent for WebSphere AIX, HP-UX, Linux, Solaris, Windows 7.1 
PRODUCT ALIAS/SYNONYM
 ITCAMfWAS ITCAMfAD ITCAM4AD ITCAM for App Diagnostics