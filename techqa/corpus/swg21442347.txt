Title: IBM 0C1 in DFHSOS03 due to a branch to low core by BPXNSSIR when using Port Sharing - United States

Text:
PM09663 DFHSOS03 SOS03 S0C1 0C1 ABENDS0C1 ABEND0C1 ABENDAKEX AKEX TCP/IP 5655M1500 R650 650 R500 500 HCI6500 5655-M15 5655M15 5655S9700 R660 660 R600 600 HCI6600 5655-S97 5655S97 5655S9700 R670 670 R700 700 HCI6700 5655-S97 5655S97 5655Y0400 R680 680 R800 800 HCI6800 5655-Y04 5655Y04 kixinfo TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Your CICS Transaction Server for z/OS (CICS TS) receives an abendS0C1 in DFHSOS03 due to a branch to low core. The CSOL transaction is running at the time of the abend0C1. You are using Port Sharing across an IPIC connection between CICS Transaction Gateway (CICS TG) and CICS TS; this is not a supported environment. 

SYMPTOM
Abend 0C1 in DFHSOS03 followed by abend AKEX [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.ts.messages.doc/AKxx_abend_codes/AKEX.html]


CAUSE
In this case, there are two unsupported environments that cause this problem: 

 1. Port Sharing across an IPIC connection between CICS TG and CICS TS is not supported. This is documented in the CICS TS information center, see Using TCP/IP in a CICS region [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.ts.installation.doc/topics/dfha1c0049.html]. The CICS TG information center in section Configuring IPIC [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.tg.zos.doc/ctgzos/ipicconfig.html] also states:
    
    An IPIC connection between CICS Transaction Gateway and CICS Transaction Server must not be load balanced through any TCP/IP port sharing or load balancing software.
    
    [http://publib.boulder.ibm.com/infocenter/cicsts/v4r1/topic/com.ibm.cics.ts.intercommunication.doc/topics/dfht1_isc_tcpip.html] 
 2. An OEM security package modified the IBM USS product's PC table, this causes the security package to receive control before USS.
    Note: The part of the security package that causes the problem is interacting outside of CICS.
    
    

This combination prevented USS from being able to deliver a SIGNAL for the duration of the BPX1CLO call issued by CICS. As part of the BPX1CLO process, CICS cleaned up the pointer to the exit code in the AIOCB. When USS tries to get a pointer to the exit code from the AIOCB, it picks up zeros and tries to branch there. 
DIAGNOSING THE PROBLEM
The 0C1 abend in DFHSOS03 is due to a branch to low core under the CSOL transaction.
The PSW is 078D0400 80000002 IL2 IC01.
This is a branch to zero with Instruction Length 2 and Interrupt Code 1.
Abend AKEX is then issued by CICS.

The running task was working with an IPIC connection between CICS TS and CICS TG.

Register 14 (X'E') from the BEAR [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.ts.doc/dfhs1/topics/dfhs1c0044.html] (Breaking Event Address Register) address pointed to an 0DEF instruction in program BPXNSSIR from HBB7750 in BPXINLPA.

The KE stack for the CSOL task looks like:
DFHSOLS
LISTEN_SOLS
REGISTER
DFHSOIS
INQUIRE
GET_SERVER_IP_ADDRESS
GET_SERVER_BIN_IP_ADDRESS

A review of the trace shows that this task (or a previous one) had just been involved in trying to close the socket:
DFHSOCK
CLOSE_SOCK
TCPIP_CLOSE
DFHSOS03



RESOLVING THE PROBLEM
Remove the unsupported Port Sharing configuration for the IPIC connection and the delay caused by the security package will not lead to the abend.





PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server