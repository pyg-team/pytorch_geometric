Title: IBM Stale Connection exception because of default commit while using Stored Procedures - United States

Text:
Stale Connection Exception; StaleConnectionException; Websphere JCC driver -4499 db2/z zOS; 0x2413; 0x2408 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 
Websphere Application aborts after calling z/OS stored procedure because of stale connection exceptions. 

SYMPTOM
StaleConnectionException may be seen after upgrade JCC driver. 

Websphere log file: 

 SystemOut.log:[10/6/10 17:29:01:089 MST] 0000005e ConnectionEve A 
J2CA0056I: The Connection Manager received a fatal connection error 
from the Resource Adapter for resource jdbc/db2xa/ear/PUX1Q/DB_MIND. 
The exception which was received is com.ibm.websphere.ce.cm. 
StaleConnectionException: [jcc][t4][2028][11149][3.58.136] Actual code 
point, 0x2413 does not match expected code point, 0x2408. ERRORCODE=- 
4499, SQLSTATE=null:com.ibm.db2.jcc.am.qo: [jcc][t4][2028][11149] 
[3.58.136] Actual code point, 0x2413 does not match expected code 
point, 0x2408. ERRORCODE=-4499, SQLSTATE=null 


RESOLVING THE PROBLEM
Fix for this issue incorporated in JCC driver version 3.59.81 that was shipped with DB2 v9.5fp6a or later and DB2 v9.7fp2 or later (defect 134363):
https://www-304.ibm.com/support/docview.wss?uid=swg1IC66739 [https://www-304.ibm.com/support/docview.wss?uid=swg1IC66739]


As a workaround, "COMMIT ON RETURN YES" can be added to the definition of stored procedure on the host. 

You might receive SQL0751N or XAER_NOTA on XA END while using "COMMIT ON RETURN YES" if stored procedure call is a part of XA transaction. 
Please check for restriction on using this clause in the technote 1433093: https://www-304.ibm.com/support/docview.wss?uid=swg21433093 [https://www-304.ibm.com/support/docview.wss?uid=swg21433093] 
or 
make sure that you applied APAR IZ07301: https://www-304.ibm.com/support/docview.wss?uid=swg1IZ07301 [https://www-304.ibm.com/support/docview.wss?uid=swg1IZ07301]


RELATED INFORMATION
 Technote 1433093 [http://www.ibm.com/support/docview.wss?uid=swg21433093]
APAR IZ07301 [https://www.ibm.com/support/docview.wss?uid=swg1IZ07301]
APAR IC66739 (134363) [https://www.ibm.com/support/docview.wss?uid=swg1IC66739]