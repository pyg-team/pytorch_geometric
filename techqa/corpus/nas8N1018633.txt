Title: IBM How to Collect Save/Restore Flight Recorders - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document explains how save/restore flight recorders can be saved at R610 and above. 

RESOLVING THE PROBLEM
Starting at R610, backup and restore operations are logged into save/restore flight recorders located under directory /TMP/QSR or /QSR/QSR if PTF SI37104 is applied (APAR SE39950). When the FR and HL files fill to default size or size defined in QSRFRSIZE data area, they will be renamed to FR.OLD and HL.OLD, and new FR and HL files are created. 

Because FR and HL files are always locked, they cannot be saved. To collect these files, it is necessary to copy them and then save the copy.

It is also possible to copy the save/restore flight recorders to a text file so they can be viewed with Notepad or WordPad. To copy the save/restore flight recorders to a text file, you should issue the following commands:

CPY OBJ('/tmp/QSR/FR') TOOBJ('/tmp/QSR/FR.txt') TOCCSID(*PCASCII) DTAFMT(*TEXT)
and 
CPY OBJ('/tmp/QSR/HL') TOOBJ('/tmp/QSR/HL.txt') TOCCSID(*PCASCII) DTAFMT(*TEXT)

OR

If PTF for SE39950 or higher is installed:

CPY OBJ('/QSR/QSR/FR') TOOBJ('/QSR/QSR/FR.txt') TOCCSID(*PCASCII) DTAFMT(*TEXT)
and 
CPY OBJ('/QSR/QSR/HL') TOOBJ('/QSR/QSR/HL.txt') TOCCSID(*PCASCII) DTAFMT(*TEXT)

Then you should FTP or use Operations Navigator to drag and drop these files to a folder on a PC. The file can then be attached to an e-mail.

Another option to collect the data is to copy all the files to another directory and then save that directory to save file: 

1. CRTDIR DIR('/Pxxxxx') 

Replace xxxxx with your PMR number. 2. CPY OBJ('/tmp/QSR/FR') TODIR('/Pxxxxx') or if PTF for SE39950 is installed, CPY OBJ('/QSR/QSR/FR') TODIR('/Pxxxxx')

Repeat this command for any other objects in QSR directory such as FR.OLD, HL, and HL.OLD. 3. CHGATR OBJ('/Pxxxxx') ATR(*ALWSAV) VALUE(*YES) SUBTREE(*ALL) 4. CRTSAVF FILE(QGPL/Pxxxxx) 5. SAV DEV('/QSYS.LIB/QGPL.LIB/Pxxxxx.FILE') OBJ(('/Pxxxxx')) 
Notes: 1. To ensure that the information for the backup is included in these logs, it is suggested to collect all four files under the /TMP/QSR or /QSR/QSR directory along with the related joblog. 2. After PTF installation associated with APAR SE39950 (SI37104 or higher), the SR flight recorder directory is /QSR/QSR. 3. Save/Restore flight recording was introduced in V6R1. The flight recorders consist of two files (FR and HL). The detailed flight recorder is the 'FR' file. The HL file is the history log which contains just an entry for the start of the save/restore operation and the completion results of that operation. Both files are set to wrap at 2 MB (or 5 MB or 50 MB depending on PTF level) in size at which time the file is copied to a .OLD file in the flight recorder directory. Note that while the archive is set to occur when the file is 2 MB (or 5 MB or 50 MB) in size, the archive only occurs at the start of a new save/restore operation so the flight recorder files could be significantly larger during a large running save/restore.

Two main stream files make up the Flight Recorders along with two .OLD files as follows:

HL - History Log

o Contains a high level summary of Save Restore activity on the system
o Easily understood by users
o Generally contains at least several days worth of data

FR - Flight Recorder

o Much more granular detail, based on PEX exits
o Primarily being analyzed by Support and Development 
o Wrap much faster than the history log files

To save the Save/Restore flight recorders to send in for analysis, you should do the following: 1. Copy the /QSR/QSR folder to a PC using System i Navigator:

a. Expand the system.
b. Expand File Systems.
c. Expand Integrated File System.
d. Expand Root.
e. Find QSR and expand it.
f. Right click and hold down the mouse button on the QSR subfolder inside the QSR parent folder, and drag it to an open area on the PC desktop. Release the mouse button, and select Copy Here. 2. ZIP the folder. It will be large on the PC; however, the compression ratio is very high. 3. The file can then be e-mailed. 
With V7R1 PTF SI50124 and V6R1 PTF SI50123, the default flight recorder size is 50 MB. The size can also be changed using a data area in either QGPL or QTEMP. 

CRTDTAARA DTAARA(QGPL/QSRFRSIZE) TYPE(*CHAR) LEN(4) VALUE('0500') 

The value specified in the above command is the size of the flight recorder in MB (in this example, 500 MB). If the size specified in the data area is '0000', no flight recording will be done. If no data area is found, the default will be used. [/support/docview.wss?uid=nas8N1018633&amp;aid=1] Refer to Technote document N1012959, MustGather: QSRSRV - How to Collect Save/Restore Problem Data [http://www-01.ibm.com/support/docview.wss?uid=nas8N1012959] for a program that can be used to collect SR flight recorder data and other related data for Save/Restore problems. 

This data can also be collected using QMGTOOLS. 

To collect using QMGTOOLS, you should perform the following steps:

 *  - [http://www.ibm.com/i/c.gif] Step 1 
   Obtain and install a copy of QMGTOOLS library from IBM. 
   
   Where to get it and how to install
   
   1. Download as a save file at ftp://public.dhe.ibm.com/services/us/igsc/has/ [ftp://public.dhe.ibm.com/services/us/igsc/has/] 
   2. From the same URL, refer to the file qmgtools_readme.txt for installation instructions. 
   
   How to get to the main menu
   
   1. ADDLIBLE QMGTOOLS
   2. GO MG, and press Enter. 
   For additional detail on how to obtain and install QMGTOOLS: http://www-01.ibm.com/support/docview.wss?uid=nas8N1011297 [http://www-01.ibm.com/support/docview.wss?uid=nas8N1011297] 
   
   
   


 *  - [http://www.ibm.com/i/c.gif] Step 2 
   Once installed, add QMGTOOLS to your library list via ADDLIBLE command. Run command GO MG to bring up the QMGTOOLS main menu. Select option 7 "Save/Restore menu" and then Select option 1 "Save/Restore data collector (QSRSRV)"
   
   Additional Information
   
   The QMGTOOLS library allows users to upload data to IBM. Information can be found in Technote N1019738, QMGTOOLS: Front end interface for IBM Secure Diagnostic Data Upload Utility, at this URL 
   http://www-01.ibm.com/support/docview.wss?uid=nas8N1019738 [http://www-01.ibm.com/support/docview.wss?uid=nas8N1019738] 
   
   
   

 


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.2 Operating System IBM i 7.1 Operating System IBM i 6.1 Operating System IBM i 7.3 
HISTORICAL NUMBER
 515905196