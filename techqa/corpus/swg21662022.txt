Title: IBM NIST SP 800-131A support for Tivoli Federated Identity Manager 6.2.2, SAML 2.0 Single Sign-on - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Tivoli Federated Identity Manager 6.2.2 runtime does not comply with NIST SP 800-131A.

This document describes the procedures to configure Tivoli Federated Identity Manager 6.2.2 so that SAML 2.0 Single Sign-on will run in compliance with the requirements of the National Institute of Standards and Technology (NIST) Special Publications 800-131a. SP800-131a strengthens security by specifying the cryptographic algorithms that can be used and the minimum strengths required for these algorithms.

In this tech note, NIST refers to NIST 800-131a. 

SYMPTOM
The Tivoli Federated Identity Manager 6.2.2 runtime does not comply with the NIST requirement.


RESOLVING THE PROBLEM
Preconditions: 

1. Version of WebSphere Application Server that hosts the Federated Identity Manager runtime and management service component is 8.5.0.0 (and future fixpacks), 8.0.0.3 (and future fixpacks) or 7.0.0.23 (and future fixpacks). For WAS 7.0.0.X, WAS 7.0 fix pack PM98578 from IBM FixCentral needs to be installed to upgrade WAS Java to SDK 6 SR15. 
WAS 7.0 fix pack PM98578 is available at: http://www-01.ibm.com/support/docview.wss?rs=180&q1=PM98578&uid=swg24036504&loc=en_US&cs=utf-8&lang=en [http://www-01.ibm.com/support/docview.wss?rs=180&q1=PM98578&uid=swg24036504&loc=en_US&cs=utf-8&lang=en]

2. TFIM 6.2.2 Fixpack 9 or later is installed.

3. IBM Security Access Manager for Web Gateway Appliance 7.0.0.2 (and future fixpacks) is installed if WebSEAL as Point of Contact is used.

Configuration Steps:

1. Enable WebSphere Application Server to run in NIST strict mode. Follow the steps indicated here
http://pic.dhe.ibm.com/infocenter/wasinfo/v8r5/index.jsp?topic=%2Fcom.ibm.websphere.nd.doc%2Fae%2Ftsec_config_strictsp300.html [http://pic.dhe.ibm.com/infocenter/wasinfo/v8r5/index.jsp?topic=%2Fcom.ibm.websphere.nd.doc%2Fae%2Ftsec_config_strictsp300.html].
The SSL certificate will be converted to comply with NIST.

2. Turn off the NIST strict mode in the WebSphere Application Server so that the SAML 2.0 configurations can be done. 
a) Log on to the Integrated Solutions Console.
b)Click Security > SSL certificate and key management > Manage FIPS.
c)Select radio button marked 'Disable FIPS'.
d)Click OK and save the settings.
e)Restart WebSphere Application Server.

3. Create a SAML 2.0 federation with either WebSEAL or WebSphere as Point of Contact.
a) Create Identity Provider or Service Provider federation from WebSphere ISC for each FIM host, in the step 'Signature Options', choose a key that is NIST compliant.
Note: The default testkey provided as part of FIM installation is using signature algorithm 'MD5withRSA', and with key length '1024', which does not meet NIST requirements. You can use the IBM ikeyman Java application to generate the NIST compliant self signed certificate p12 file (e.g. set the signature algorithm as 'SHA256withRSA' and key length as 2048).
b) Import the SSL server certificate of the partner into FIM truststore.
c) Add partner to the federation at each FIM host by importing the partner metadata file into federation. At step 'SSL Server Authentication for Artifact Resolution', select the SSL key imported at step 5.b) for SSL server authentication; proceed with the rest steps to add partner, in the step 'Partner Settings', choose radio button 'RSA-SHA256' instead of 'RSA-SHA1' for signature algorithm.
d) Proceed with the remaining steps to complete adding federation partner.

Following step 4 are only applicable if WebSEAL Point of Contact is selected in step 3; for WebSphere as Point of Contact, please proceed to step 5.

4. Configure WebSEAL Point of Contact for the SAML 2.0 federation.
Note: Only IBM Security Access Manager for Web Gateway Appliance 7.0.0.2 (and future fixpacks) is supported for WebSEAL Point of Contact for NIST compliance. 
a) If there is an existing WebSEAL Runtime component which has been created before performing the NIST configurations mentioned in this Technote, please unconfigure the existing Runtime component following the steps in:
https://publib.boulder.ibm.com/infocenter/tivihelp/v2r1/index.jsp?topic=%2Fcom.ibm.isam.doc_70%2Fameb_webseal_appl_guide%2Ftask%2Ftsk_lmi_webint_conf_rte.html [https://publib.boulder.ibm.com/infocenter/tivihelp/v2r1/index.jsp?topic=%2Fcom.ibm.isam.doc_70%2Fameb_webseal_appl_guide%2Ftask%2Ftsk_lmi_webint_conf_rte.html]
b) From IBM Security Access Manager for Web Gateway Appliance 7.0.0.2 (and future fixpacks) Local Management Interface (LMI), create Runtime Component following the steps in: https://publib.boulder.ibm.com/infocenter/tivihelp/v2r1/index.jsp?topic=%2Fcom.ibm.isam.doc_70%2Fameb_webseal_appl_guide%2Ftask%2Ftsk_lmi_webint_conf_rte.html [https://publib.boulder.ibm.com/infocenter/tivihelp/v2r1/index.jsp?topic=%2Fcom.ibm.isam.doc_70%2Fameb_webseal_appl_guide%2Ftask%2Ftsk_lmi_webint_conf_rte.html]
On the Policy Server tab, for 'SSL Compliance' select 'sp800-131-strict' from the list.
From LMI, create reverse proxy instance on the Runtime Component, start the reverse proxy instance following the steps in: https://publib.boulder.ibm.com/infocenter/tivihelp/v2r1/index.jsp?topic=%2Fcom.ibm.isam.doc_70%2Fameb_webseal_appl_guide%2Ftask%2Ftsk_lmi_webint_conf_rte.html [https://publib.boulder.ibm.com/infocenter/tivihelp/v2r1/index.jsp?topic=%2Fcom.ibm.isam.doc_70%2Fameb_webseal_appl_guide%2Ftask%2Ftsk_lmi_webint_conf_rte.html]
c) Run the tfimcfg tool to configure the WebSEAL end points and junctions. The junction connection to the application port (secured) of WAS server where the FIM host is deployed is configured to use SSL connection. 
d) Replace the default personal certificate in WebSEAL with a certificate that is NIST compliant.
Note: The default personal certificate provided as part of WebSEAL installation is using signature algorithm 'SHA1withRSA' and with key length '1024', which does not meet NIST requirements. You can use the IBM ikeyman Java application to generate the NIST compliant self signed certificate p12 file (e.g. set the signature algorithm as 'SHA256withRSA' and key length as 2048).
e) Disable SSL protocols other than TLS1.2 by setting the following attributes in the WebSEAL config file ssl and junction stanza:

[ssl]
...
disable-ssl-v2 = yes
disable-ssl-v3 = yes
disable-tls-v1 = yes
disable-tls-v11 = yes
disable-tls-v12 = no
...
[junction]
...
disable-ssl-v2 = yes
disable-ssl-v3 = yes
disable-tls-v1 = yes
disable-tls-v11 = yes
disable-tls-v12 = no

f) Enable the TLS signature algorithm extension by setting the following attributes in the WebSEAL config file ssl stanza. Write the attributes in one line.

[ssl]
...
jct-gsk-attr-name = string:245:GSK_TLS_SIGALG_RSA_WITH_SHA224,GSK_TLS_SIGALG_RSA_WITH_SHA256,
GSK_TLS_SIGALG_RSA_WITH_SHA384,GSK_TLS_SIGALG_RSA_WITH_SHA512,GSK_TLS_SIGALG_ECDSA_WITH_SHA224,
GSK_TLS_SIGALG_ECDSA_WITH_SHA256,GSK_TLS_SIGALG_ECDSA_WITH_SHA384,GSK_TLS_SIGALG_ECDSA_WITH_SHA512

5. Turn on the NIST strict mode in the WebSphere Application Server so that the FIM SAML 2.0 runs in NIST strict mode.
a) Log on to the Integrated Solutions Console.
b) Click Security > SSL certificate and key management > Manage FIPS.
c) Select radio buttons marked 'Enable SP800-131' -> 'Strict'.
d) Click OK and save the settings.
e) Restart WebSphere Application Server.

Step 6 below is needed only if SOAP communication i.e. HTTP Artifact / SOAP Binding is required; if SOAP communication is not used in the SAML 2.0 federation, please skip this step.

6. Configure FIM SOAP clients to use only TLS1.2.
a) Log on to the Integrated Solutions Console.
b) Add the following custom runtime properties to the Runtime Node of each FIM host in the federation: 
com.tivoli.am.fim.soap.client.ssl.protocol=TLSv1.2

Step 7 below is needed only if the LDAP alias service based on TDS is used, if it's not used in the SAML 2.0 federation, please skip this step.

7. Enable FIM LDAP client to use only TLS1.2. 
Only Tivoli Directory Server 6.3 Fixpack 17 (and future fixpacks) is supported for LDAP alias service database.
a) Install and configure Tivoli Directory Server 6.3 Fixpack 17 (and future fixpacks) to run in NIST strict mode with only TLS1.2 enabled.
b) Import the public certificate of the TDS SSL server to the trusted key store of each FIM host.
c) Configure FIM alias service settings for each partner from WebSphere ISC, in the Alias Service Settings page, enable SSL, select the trusted key store, and set to use the secured LDAP port of the TDS server.