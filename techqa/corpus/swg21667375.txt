Title: IBM Generating WebSphere MQ trace on HP NonStop Server - United States

Text:
Tracing; Trace; WebSphere MQ; MQ; HP NonStop Server; HP NonStop; NonStop TECHNOTE (FAQ)

QUESTION
 How do I generate a WebSphere MQ trace on HP NonStop Server systems in order to investigate a problem? 

CAUSE
Traces can capture the root cause of many MQ problems. It is important to limit how long tracing is active in order to avoid affecting performance or generating excessively large trace files and filling up your disk. For other MQ traces and for WebSphere MQ client trace on HP Integrity NonStop Server refer to:



 * Generating IBM MQ Traces [http://www.ibm.com/support/docview.wss?uid=swg21174924]

 * WebSphere MQ Trace on HP Integrity NonStop Server [http://www.ibm.com/support/docview.wss?uid=swg21667396]




Make sure the Queue Manager subvolume (the $MQNSKVARPATH/trace directory on OSS) is on a volume with plenty of available space. Otherwise, you risk an outage if WebSphere MQ trace fills the volume which your queue managers are using. In addition, a partial trace may not contain the information IBM Support needs to solve the problem.


ANSWER



GENERATING TRACES
 1.  
 2.  Start tracing with the strmqtrc command. The parameters passed to strmqtrc control which processes will generate trace files and what kinds of data they will trace. The strmqtrc command only starts trace for processes running on the same CPU as your OSS shell or TACL session, so be sure to use the run command to start trace on a specific CPU number. The examples below show TACL and OSS syntax:
 3.   
     STARTING A DEFAULT DETAIL TRACE OF QUEUE MANAGER QMA RUNNING ON CPU 1
     
     TACL> run /CPU 1/ strmqtrc -m QMA 
     or 
     oss> run -cpu=1 strmqtrc -m QMA 
     
     STARTING AN API TRACE OF QUEUE MANAGER QMB RUNNING ON CPU 2
     
     TACL> run /CPU 2/ strmqtrc -m QMB -t api
     or 
     oss> run -cpu=2 strmqtrc -m QMB -t api 
     
     STARTING A HIGH DETAIL TRACE OF EVERYTHING ON CPU 3
     
     TACL> run /CPU 3/ strmqtrc -e -t all -t detail 
     or 
     oss> run -cpu=3 strmqtrc -e -t all -t detail 
     
 4.  
 5.  
 6.  Reproduce the problem while tracing is active, making every attempt to keep the trace as short as possible.
     
 7.  
 8.  
 9.  As soon as the problem has occurred, stop tracing immediately! If you wait to stop the trace, the data IBM Support needs may be lost or overwritten. For example:
 10.  
     STOPPING ALL TRACE ON CPU 3
     
     TACL> run /CPU 3/ endmqtrc -a 
     or 
     oss> run -cpu=3 endmqtrc -a 
     
     STOPPING A TRACE OF QUEUE MANAGER QMA ON CPU 1
     
     TACL> run /CPU 1/ endmqtrc -m QMA 
     or 
     oss> run -cpu=1 endmqtrc -m QMA 
     
 11. 
 12. 
 13. The trace files generated by WebSphere MQ are binary, and must be formatted before they can be read. The binary trace files are named like AMQ*.TRC. In TACL each file in the WebSphere MQ trace directory must be formatted individually, while OSS supports formatting all the files at once:
 14.  
     FORMATTING WEBSPHERE MQ TRACE FILES
     
     
     TACL> dspmqtrc -o "/path/to/var/mqm/trace/AMQxxxxx.0.FMT" "/path/to/var/mqm/trace/AMQxxxxx.0.TRC" 
     TACL> ... 
     
     or 
     
     oss> cd "$MQNSKVARPATH/trace" 
     oss> dspmqtrc AMQ*.TRC 
     
 15. 
 16. 
 17. Save a copy of the binary trace files as long as you are working with IBM support, but do not send both binary and formatted traces to IBM. Delete the binary trace files before sending your trace files to IBM.
 18.  
     DELETING WEBSPHERE MQ BINARY TRACE FILES
     
     oss> cd "$MQNSKVARPATH/trace" 
     oss> rm -f AMQ*.TRC 
 19. 
 20. 
 21. 
 22. IBM provides the Service Data Collection and Packagaing (sdcp) tool [http://www.ibm.com/support/docview.wss?uid=swg27015549] to simplify the task of collecting files from HP NonStop Server systems to send to IBM. If the traces are very large, you may need to use the "-w" option to choose an OSS directory with plenty of free space in which to package your files. If you do not have sdcp, you can tar and compress the files before sending them to IBM:
 23.  
     USING SDCP TO COLLECT WEBSPHERE MQ TRACES AND OTHER DATA
     
     oss> sdcp -p 12345,67R,890 -m QMA -w /var/bigdata 
     
     PACKAGING TRACE FILES MANUALLY
     
     oss> cd "$MQNSKVARPATH/trace" 
     oss> tar -cvf PMR12356,67R,890-mqtrace.tar AMQ*.FMT 
     oss> compress PMR12356,67R,890-mqtrace.tar 
     
 24. 
 25. 
 26. After sending the formatted traces, clean up the trace directory to reclaim space and also to make sure you are ready to generate new traces in future, if necessary. For example:
 27.  
     CLEANING UP THE TRACE DIRECTORY
     
     oss> cd "$MQNSKVARPATH/trace" 
     oss> rm -f AMQ*.FMT 
     


Back to top




ADDITIONAL INFORMATION

 * WebSphere MQ for HP NonStop Server service data collection and packaging tool (sdcp) [http://www.ibm.com/support/docview.wss?uid=swg27015549]
 * SC34-6625-00: WebSphere MQ V5.3 for HP NonStop Server System Administration Guide (5.35MiB) [http://www.ibm.com/e-business/linkweb/publications/servlet/pbi.wss?CTY=US&FNC=PBL&PBL=SC34-6625-00]


Back to top

 

PRODUCT ALIAS/SYNONYM
 WebSphere MQ WMQ