Title: IBM IT00380: SQL1476N WITH ERROR "-668" RETURNED WHEN SET INTEGRITY FOR AN MQT OF "COMPRESS YES" AND "REFRESH IMMEDIATE" - United States

Text:
z/os  FIXES ARE AVAILABLE
DB2 Version 10.1 Fix Pack 4 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24037466]
DB2 Version 10.1 Fix Pack 6 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24043366]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS FIXED IF NEXT.
    
   
   

ERROR DESCRIPTION
 *  The scenario is like below,
   1) create a base table, then create an MQT with "COMPRESS YES"
   and "REFRESH IMMEDIATE"
   2) load data into the base table, and run SET INTEGRITY for the
   base table
   3) for the MQT, activate NOT LOGGED INITIALLY and run SET
   INTEGRITY ... IMMEDIATE CHECKED in one UOW, it returns SQL1476N
   with error "-668".
   
   -> db2 +c -tvf alterMQT.sql
   ALTER TABLE TEST.MYMQT activate NOT LOGGED INITIALLY
   DB20000I  The SQL command completed successfully.
   
   SET INTEGRITY FOR TEST.MYMQT IMMEDIATE CHECKED
   DB21034E  The command was processed as an SQL statement because
   it was not a
   valid Command Line Processor command.  During SQL processing it
   returned:
   SQL1476N  The current transaction was rolled back because of
   error "-668".
   SQLSTATE=40506
   
   Internally, during SET INTEGRITY for the MQT, Automatic
   Dictionary Creation(ADC) is kicked off to build the compression
   dictionary when there is enough data in the MQT, however ADC
   fails with error "-668" and it lead to the failure of SET
   INTEGRITY.
   
   
    
   
   

LOCAL FIX
 *  Use MQT refresh method REFRESH DEFERRED instead of REFRESH
   IMMEDIATE, then  follow REFRESH statement in separate.
   Or, disable compression when create MQT table, then enable
   compression after SET INTEGRITY.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * all                                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * The scenario is like below,                                  *
   * 1) create a base table, then create an MQT with "COMPRESS    *
   * YES"                                                         *
   * and "REFRESH IMMEDIATE"                                      *
   * 2) load data into the base table, and run SET INTEGRITY for  *
   * the                                                          *
   * base table                                                   *
   * 3) for the MQT, activate NOT LOGGED INITIALLY and run SET    *
   * INTEGRITY ... IMMEDIATE CHECKED in one UOW, it returns       *
   * SQL1476N                                                     *
   * with error "-668".                                           *
   *                                                              *
   * -> db2 +c -tvf alterMQT.sql                                  *
   * ALTER TABLE TEST.MYMQT activate NOT LOGGED INITIALLY         *
   * DB20000I  The SQL command completed successfully.            *
   *                                                              *
   * SET INTEGRITY FOR TEST.MYMQT IMMEDIATE CHECKED               *
   * DB21034E  The command was processed as an SQL statement      *
   * because                                                      *
   * it was not a                                                 *
   * valid Command Line Processor command.  During SQL processing *
   * it                                                           *
   * returned:                                                    *
   * SQL1476N  The current transaction was rolled back because of *
   * error "-668".                                                *
   * SQLSTATE=40506                                               *
   *                                                              *
   * Internally, during SET INTEGRITY for the MQT, Automatic      *
   * Dictionary Creation(ADC) is kicked off to build the          *
   * compression                                                  *
   * dictionary when there is enough data in the MQT, however ADC *
   * fails with error "-668" and it lead to the failure of SET    *
   * INTEGRITY.                                                   *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Use MQT refresh method REFRESH DEFERRED instead of REFRESH   *
   * IMMEDIATE, then  follow REFRESH statement in separate.       *
   * Or, disable compression when create MQT table, then enable   *
   * compression after SET INTEGRITY.                             *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT00380
   
   
 * REPORTED COMPONENT NAME
   DB2 FOR LUW
   
   
 * REPORTED COMPONENT ID
   DB2FORLUW
   
   
 * REPORTED RELEASE
   A10
   
   
 * STATUS
   CLOSED FIN
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2014-03-18
   
   
 * CLOSED DATE
   2014-06-02
   
   
 * LAST MODIFIED DATE
   2014-06-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    IT00795 [http://www-01.ibm.com/support/docview.wss?uid=swg1IT00795]
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 FOR LUW
   
   
 * FIXED COMPONENT ID
   DB2FORLUW
   
   

APPLICABLE COMPONENT LEVELS
 * RA10 PSN
   UP
   
   
 * RA10 PSY
   UP
   
   
 * RA50 PSN
   UP
   
   
 * RA50 PSY
   UP