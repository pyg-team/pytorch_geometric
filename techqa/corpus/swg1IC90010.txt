Title: IBM IC90010: THE OUTPUT IN "DEDUPLICATE DATA NOT STORED" FROM "QUERY STGPOOL F=D" MAY BE NOT CORRECT - United States

Text:
AIX SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS FIXED IF NEXT.
    
   
   

ERROR DESCRIPTION
 *  The reporting of deduplication ratios via the Tivoli Storage
   Manager server command QUERY STGPOOL F=D output and occupancy
   table might be inaccurate. The reason being is that deduplicated
   chunks of data which are used as base data for same data
   matches, might not be included in the calculations. Since these
   data chunks are truly occupying storage space they should cost
   against the deduplication ratio value and in some cases, they
   are not.
   
   The result is that the deduplication ratio might be slightly
   higher than reality.
   
   Customer/L2 Diagnostics :
   The best way to show an example is by using an the output from
   the "tsm_dedup_stats.pl" script. This is attached in the
   tech note 1596944:
   
   Determining the impact of deduplication on a
   Tivoli Storage Manager server database and storage pools
   http://www-01.ibm.com/support/docview.wss?uid=swg21596944 [http://www-01.ibm.com/support/docview.wss?uid=swg21596944]
   
   This can be used to get deduplication information and stats for
   a given environment. Here is an example from the script output
   that shows the stgpool utilization information:
   
   Pool: DEDUP-POOL
     Type: PRIMARY    Est. Cap. (MB): 11372626.3 Pct Util: 64.7
     Reclaim Thresh: 100 Reclaim Procs: 1            Next Pool:
     Identify Procs: 2   Dedup Saved:9273226
   
   
     Logical stored (MB):   5285872.39
     Dedup Not Stored (MB):  9273226.86
     Total Managed (MB):  14559099.25
   
     Volume count:      228
     AVG volume size:    49879
     Number of chunks: 52501740
     Avg chunk size:   342824
   
   The storage utilization of the storage pool does not match with
   the logical value (+ reclaim pct) of the storage pool.
   
   11372626 * 64% = 7.3 TB
   
   The percent reclaim for this environment was 412 GB
   
   The following server select command shows:
   
   select sum(est_capacity_mb*pct_reclaim/100) as
   "Reclaimable (MB)"  from volumes where stgpool_name='DEDUP-POOL'
   
   Reclaimable (MB) = 412GB
   
   
   Logical Stored + Reclaimable = 5.7 TB
   
   At this point, there is 7.3 TB of used space in the storage
   pool but we are only accounting for 5.7 TB. A good portion of
   the rest of that space is deleted base chunks which are no
   longer assigned to client files (they have been expired).
   
   Tivoli Storage Manager Versions Affected:
   Tivoli Storage Manager Server version  6.1, 6.2 and 6.3 on all
   platforms
   
   Initial Impact:
   low
   
   Additional Keywords:
   TSM zz61 zz62 zz63 dedup
   
   
    
   
   

LOCAL FIX
 *  Run the following DB2 command to get the "real" values:
   
   db2 "select cast( sum(bfaa.lsize)/(1024*1024*1024) as
   decimal(10,2) ) as LOGICAL_OCC_GB,
   cast( sum(bfaa.rsize)/(1024*1024*1024) as decimal(10,2) ) as
   MANAGED_OCC_GB from bf_aggregate_attributes bfaa left join
   af_bitfiles afbf on (afbf.srvid=bfaa.srvid and
   afbf.bfid=bfaa.superbfid) where bfaa.srvid=0 and
   afbf.poolid=<poolid>"
   
   The storage pool id <poolid> can be captured via the server
   SHOW command: show sspool
   The number in brackets after the storage pool name is the
   poolid
   
   The above will give the true logical and reporting
   (before dedup). The LOGICAL value here can be added to any
   reclaimable space and it should get us close to the storage
   pool utilization.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All Tivoli Storage Manager server users.     *
   ****************************************************************
   * PROBLEM DESCRIPTION: See error description.                  *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   This problem is projected to be fixed in a future version of
   the
   Tivoli Storage Manager server.  Note that this is subject to
   change at the discretion of IBM.
   
   
   Affected platforms:  AIX, HP-UX, Solaris, Linux, and Windows.
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC90010
   
   
 * REPORTED COMPONENT NAME
   TSM SERVER
   
   
 * REPORTED COMPONENT ID
   5698ISMSV
   
   
 * REPORTED RELEASE
   63L
   
   
 * STATUS
   CLOSED FIN
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-02-05
   
   
 * CLOSED DATE
   2013-02-22
   
   
 * LAST MODIFIED DATE
   2013-02-22
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS
 * R61A PSY
   UP
   
   
 * R61H PSY
   UP
   
   
 * R61L PSY
   UP
   
   
 * R61S PSY
   UP
   
   
 * R61W PSY
   UP
   
   
 * R62A PSY
   UP
   
   
 * R62H PSY
   UP
   
   
 * R62L PSY
   UP
   
   
 * R62S PSY
   UP
   
   
 * R62W PSY
   UP
   
   
 * R63A PSY
   UP
   
   
 * R63H PSY
   UP
   
   
 * R63L PSY
   UP
   
   
 * R63S PSY
   UP
   
   
 * R63W PSY
   UP