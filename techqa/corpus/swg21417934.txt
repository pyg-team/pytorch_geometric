Title: IBM Best Practices for configuring local chained services on IBM DataPower Gateways - United States

Text:
persistent; connection; network; error; reuse; failed; best practice TECHNOTE (TROUBLESHOOTING)

THIS DOCUMENT APPLIES ONLY TO THE FOLLOWING LANGUAGE VERSION(S):
 English 

PROBLEM(ABSTRACT)
 When multiple services communicate within the same device, persistent connections should be disabled over this internal, loopback, connection.


RESOLVING THE PROBLEM
External clients and servers to the device can continue to benefit from persistent HTTP connections, but any local, internal, appliance connections should not have persistence enabled where possible. 

An example would be two Multi-Protocol Gateways (MPGWs) communicating between MPGW A with MPGW B in chained services. One would disable persistent connections in the backend of MPGW A via the Advanced tab and then disable persistent connection in the front side handler of MPGW B. This will ONLY affect the connections between these two chained services and not external connections. 

 

An example of the condition that we want to avoid would be similar to this:
[/support/docview.wss?uid=swg21417934&amp;aid=1] 

Where MPGW A is the client and MPGW B is the server. If MPGW determines that the persistent connection should be closed while MPGW A is sending another request the winner will be the close issued by MPGW B. This would result in MPGW A throwing an failure. 

 

Preventing the inherent race condition of HTTP persistent connection reuse and any network errors that would result is the main goal. If you do not believe this is the source of the error please collect the following data for further investigation:
http://www-01.ibm.com/support/docview.wss?uid=swg21407324 [http://www-01.ibm.com/support/docview.wss?uid=swg21407324] 

 

Further suggestions: 

- It is generally recommended to avoid "chaining" services. When ever possible build in any functionality as part of a single service processing rule. 


- Do not use the Standby Group / AO Virtual IP address (VIP) as a backend service for chained services. 

- Do not use persistent connections between chained services over the loopback or local interface. 

- Consider using the loopback IP address such as 127.0.0.1 to identify known local connections, This will allow quick identification of connections between the "real IP" and "loopback IP". 

This simply allows quick identification of traffic. 

 

If there are any questions or doubt that the network error is due to the rapid reuse of an HTTP persistent connection, contact IBM Support [http://www-01.ibm.com/support/docview.wss?rs=2362&uid=swg21236322] for assistance in capturing the behavior for confirmation.