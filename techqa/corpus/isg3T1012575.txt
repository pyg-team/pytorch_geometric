Title: IBM Example of an Enhanced Concurrent Volume Group - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 how to identify that an ECVG is on-line and working properly 

RESOLVING THE PROBLEM
Here is an example Enhanced Concurrent Mode Volume Group (ECMVG) from our lab: 

cobra /# lsvg abrvg

VOLUME GROUP: abrvg VG IDENTIFIER: 0000530400004c00000001250e119c40 <-VGID
VG STATE: active PP SIZE: 16 megabyte(s) 
VG PERMISSION: read/write TOTAL PPs: 536 (8576 megabytes) <-Permission is read/write
MAX LVs: 512 FREE PPs: 471 (7536 megabytes) so we can mount filesystems
LVs: 2 USED PPs: 65 (1040 megabytes)
OPEN LVs: 2 QUORUM: 2 (Enabled)
TOTAL PVs: 1 VG DESCRIPTORS: 2
STALE PVs: 0 STALE PPs: 0
ACTIVE PVs: 1 AUTO ON: no
Concurrent: Enhanced-Capable Auto-Concurrent: Disabled
VG Mode: Concurrent <-Mode is Concurrent 
Node ID: 1 Active Nodes: 2
MAX PPs per VG: 130048
MAX PPs per PV: 2032 MAX PVs: 64
LTG size: 128 kilobyte(s) AUTO SYNC: no
HOT SPARE: no BB POLICY: relocatable

The other node in the cluster, viper, has the VG varied on in Passive Mode:

viper /# lsvg abrvg
VOLUME GROUP: abrvg VG IDENTIFIER: 0000530400004c00000001250e119c40
VG STATE: active PP SIZE: 16 megabyte(s)
VG PERMISSION: passive-only TOTAL PPs: 536 (8576 megabytes) <-Note the Permission is Passive-only
MAX LVs: 512 FREE PPs: 471 (7536 megabytes) 
LVs: 2 USED PPs: 65 (1040 megabytes)
OPEN LVs: 0 QUORUM: 2 (Enabled)
TOTAL PVs: 1 VG DESCRIPTORS: 2
STALE PVs: 0 STALE PPs: 0
ACTIVE PVs: 1 AUTO ON: no
Concurrent: Enhanced-Capable Auto-Concurrent: Disabled
VG Mode: Concurrent <-Mode is Concurrent
Node ID: 2 Active Nodes: 1
MAX PPs per VG: 130048
MAX PPs per PV: 2032 MAX PVs: 64
LTG size: 128 kilobyte(s) AUTO SYNC: no
HOT SPARE: no BB POLICY: relocatable

Find the gsclvmd that has the matching VGID and note the PID.

cobra /# ps -ef | grep gsclvmd | grep -v grep
root 26778 31168 0 13:07:34 - 0:00 /usr/sbin/gsclvmd -r 30 -i 300 -t 300 -c 0000530400004c00000001250e119c40 -v 0
root 31168 9354 0 13:06:22 - 0:00 /usr/sbin/gsclvmd

cobra /# lssrc -ls gsclvmd
Subsystem Group PID Status
gsclvmd gsclvmd 31168 active

Active VGs # 1
vgid pid
0000530400004c00000001250e119c40 26778

Make sure that PID for gsclvmd is registered with grpsvcs or cthags (when using CAA, PowerHA 7.1 or later:

cobra /# lssrc -ls grpsvcs (or cthags)
Subsystem Group PID Status
grpsvcs grpsvcs 25246 active
3 locally-connected clients. Their PIDs:
30456(haemd) 21210(clstrmgr) 26778(gsclvmd) <-PID matches
HA Group Services domain information:
Domain established by node 2
Number of groups known locally: 5
Number of Number of local
Group name providers providers/subscribers
s00019G80009G0000014K713720 2 1 0
ha_em_peers 2 1 0
CLRESMGRD_1264566255 2 1 0
CLSTRMGR_1264566255 2 1 0
d00019G80009G0000014K713720 2 1 0

On node Viper, the lssrc output is similar but of course the PID is different:

viper /# lssrc -ls gsclvmd
Subsystem Group PID Status
gsclvmd gsclvmd 30278 active

Active VGs # 1
vgid pid
0000530400004c00000001250e119c40 29814


viper /# lssrc -ls grpsvcs
Subsystem Group PID Status
grpsvcs grpsvcs 17656 active
3 locally-connected clients. Their PIDs:
22382(clstrmgr) 25192(haemd) 29814(gsclvmd) <-PID
HA Group Services domain information:
Domain established by node 2
Number of groups known locally: 5
Number of Number of local
Group name providers providers/subscribers
s00019G80009G0000014K713720 2 1 0
ha_em_peers 2 1 0
CLRESMGRD_1264566255 2 1 0
CLSTRMGR_1264566255 2 1 0
d00019G80009G0000014K713720 2 1 0