Title: IBM KNP_POLL_DATA_COLLECTION table is full - United States

Text:
database full; rows; polling; mysql; poll; poll data; data polls; performance TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Data is removed from the KNP_POLL_DATA_COLLECTION table as the Tivoli Enterprise Monitoring Agent (TEMA) sends it to the Data Warehouse. If the table is not being cleared then you have to reduce the volume of data and spread monitoring between agents. 

SYMPTOM
Data is not being removed from the data poll collection table in Tivoli Network Manager Poller's ncpolldata database.


DIAGNOSING THE PROBLEM
The interval at which data is moved by the TEMA to the Data Warehouse is specified by the value of the Refresh interval (in minutes). This interval can be found in the TEMA configuration file. The name of the configuration file is composed of the hostname of the server it is installed on, the string "_np_", the Instance Name of the Poller and the appended with the string ".cfg". For example if ... 

hostname = BWDESK
Poller instance = PRI

... then the file name will be BWDESK_np_PRI.cfg.

The file is kept in ITM_HOME/config where ITM_HOME is the location into which the agent was installed, by default /opt/IBM/ITM.

If there is data in the ncpolldata.knp_poll_data_collection table older than this refresh interval, then data is not being removed from the database by the TEMA.

Another indicator is that the last updated date for the TEMA's History file has not changed within the last refresh interval. The file is where the TEMA caches the data from the ncpolldata, and where the Data Warehouse Proxy Agent retrieves it from. This is a binary file so you cannot check the data within it, but you can check the date on the file to see when it was last updated. 

One cause of this problem is that the TEMA is timing out before it manages to cache all the data from the last refresh interval, and hence does not complete the process. At the next poll time, even more data is waiting to be sent, and the TEMA is then stuck in a negative feedback loop.


RESOLVING THE PROBLEM
To resolve the problem described in the last paragraph, the TEMA needs to process smaller batches of data, potentially via more than one Agent instance. 


To achieve this, take the following steps:

1) Configure the agent to migrate 1000 rows. Please see the Technote in the Related URL section at the end of this article. The agent will retrieve the first 1000 rows and will set the current time as the starting point to collect data.
2) Stop ncp_poller.
3) Start the TEMA.
4) Verify that the history file was created after the period of time defined on data history collection.
5) Start ncp_poller.
6) Verify if history file is being updated every period of time defined on data history collection. 7) The Data Warehouse table should be created after first upload (15 min).

Depending on amount of data, we recommend to distribute the polling on two pollers or more. 
1) First register a new poller. Chapter 10 of the Network Manager Administration Guide has details on how to do this under the section "Administering Distributed Polling", sub-section entitled "Setting up and additional poller".
2) Create a new agent instance against the newly registered poller. Details on this can be found in the Tivoli Monitoring for Tivoli Network Manager IP Edition - User's guide, Chapter 1.
3) Start the agent instance.
4) Define a subset of the policies to use the new poller, again see the Network Manager Administration Guide and the Network Polling Guide for details.

RELATED INFORMATION
 KNP Data flow [http://www.ibm.com/support/docview.wss?uid=swg21429358]


 


Cross reference information Segment Product Component Platform Version Edition Systems and Asset Management Tivoli Network Manager IP Edition Not Applicable AIX, Linux, Solaris, Windows 3.8 
HISTORICAL NUMBER
 84221
000
738 

PRODUCT ALIAS/SYNONYM
 IBM Tivoli Enterprise Monitoring Agent
TEMA
ITNM
Precision
TDW
KNP
knp
itnm
nmip
NMIP
Network Manager