Title: IBM 部署IBM WebSphere Commerce 应用程序 EAR时，收到java.lang.OutOfMemoryError错误 - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

问题（摘要）
 
当部署的IBM WebSphere Commerce 应用程序EAR非常大时，可能会发生java.lang.OutOfMemoryError异常。该异常可能发生在应用程序部署过程中，也可能发生在为WebSphere Commerce实例安装临时补丁包和修订包时。


症状
 

在deployEar_WC_instance_name.log日志文件中记录了类似下面内容的信息：

[wsadmin] JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError".
[wsadmin] JVMDUMP006I Processing dump event "systhrow", detail "java/lang/OutOfMemoryError" - please wait.
[wsadmin] JVMDUMP032I JVM requested Snap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103336.1032252.0007.trc' in response to an event
[wsadmin] Exception in thread "Attach handler" java.lang.OutOfMemoryError
[wsadmin] at com.ibm.tools.attach.javaSE.CommonDirectory.waitSemaphore(CommonDirectory.java:242)
[wsadmin] at com.ibm.tools.attach.javaSE.AttachHandler.waitForNotification(AttachHandler.java:282)
[wsadmin] at com.ibm.tools.attach.javaSE.AttachHandler.run(AttachHandler.java:203)
[wsadmin] JVMDUMP010I Snap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103336.1032252.0007.trc
[wsadmin] JVMDUMP032I JVM requested Heap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103336.1032252.0008.phd' in response to an event
[wsadmin] JVMDUMP010I Heap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103336.1032252.0008.phd
[wsadmin] JVMDUMP032I JVM requested Java dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103336.1032252.0009.txt' in response to an event
[wsadmin] JVMDUMP010I Java dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103336.1032252.0009.txt
[wsadmin] JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError".
[wsadmin] JVMDUMP006I Processing dump event "systhrow", detail "java/lang/OutOfMemoryError" - please wait.
[wsadmin] JVMDUMP032I JVM requested Snap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103351.1032252.0010.trc' in response to an event
[wsadmin] JVMDUMP010I Snap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/Snap.20110119.103351.1032252.0010.trc
[wsadmin] JVMDUMP032I JVM requested Heap dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103351.1032252.0011.phd' in response to an event
[wsadmin] JVMDUMP010I Heap dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/heapdump.20110119.103351.1032252.0011.phd
[wsadmin] JVMDUMP032I JVM requested Java dump using '/usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103351.1032252.0012.txt' in response to an event
[wsadmin] JVMDUMP010I Java dump written to /usr/WebSphere/CommerceServer70/config/deployment/xml/javacore.20110119.103351.1032252.0012.txt
[wsadmin] JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError".
[wsadmin] WASX7017E: Exception received while running file "/usr/WebSphere/CommerceServer70/config/deployment/scripts/deployEar.jacl"; exception information: com.ibm.websphere.management.application.client.AppDeploymentException: com.ibm.websphere.management.application.client.AppDeploymentException: ADMA0092E: An unexpected exception occurred while preparing task EnsureMethodProtectionFor20EJB. Check the server machine First Failure Data Capture tool (FFDC) for more information. [Root exception is java.lang.OutOfMemoryError]
[wsadmin] java.lang.OutOfMemoryError: java.lang.OutOfMemoryError



诊断问题
 

查看deployEar_WC_instance_name.log日志文件分析故障原因，该文件的路径如下：
WC_installdir/logs/update/actions/install/deployEar_WC_instance_name.log



解决问题
 

请在deployEar.xml文件中增加jvmMaxMemory属性来提高wsadmin JVM堆大小的上限，具体步骤如下：

1、打开deployEar.xml 文件<WCS_installdir>/config/deployment/xml/deployEar.xml 
2、对每个“wsadmin”元素增加jvmMaxMemory参数：
<wsadmin jvmMaxMemory="1024M" 
... 
</wsadmin> 
注意：这里有很多“wsadmin”元素。请确认更改了每个“wsadmin”元素。



相关信息
#An US English translation is available [http://www.ibm.com/support/docview.wss?uid=swg21460411]