Title: IBM The Integrated COBOL DB2 Coprocessor's behavior when NOSQLCCSID is in effect - United States

Text:
IGYOS4078-W; Integrated DB2 Coprocessor; NOSQLCCSID; CODEPAGE; CCSID; DB2; SQLCCSID; COBOL TECHNOTE (FAQ)

QUESTION
 COBOL V5.2 Programming Guide Chapter 17. Compiler options page 355 
SQLCCSID - Compiler Option:

If NOSQLCCSID is in effect, the CODEPAGE setting will not influence the processing of SQL statements when you use the integrated DB2 coprocessor; only COBOL statements will be sensitive to the CCSID specified in the CODEPAGE option.

What does this mean?



ANSWER
If NOSQLCCSID is in effect, then the CCSID value nnnn that is passed from the COBOL compiler from the CODEPAGE compiler option is used only for the COBOL application source (which includes converted SQL statements) and string literals. The DB2 (character string) host variables are not affected by the CODEPAGE compiler option when NOSQLCCSID is in effect. Instead, the encoding for the DB2 (character string) host variables always comes from the CCSID value found in the DSNHDECP file. In other words, DB2 (via DSNHDECP) determine the encoding of the DB2 data (host variables).

It is important to understand that with DB2, encoding is used on 2 separate things:
1) The source (which includes the COBOL source and translated SQL statements that become COBOL source)
2) DB2 host variables (also referred to as “data” by DB2)

It is also important to note that in the output from either the precompiler or the coprocessor, when the "SQL options in effect" says CCSID(nnnn), it is talking about the CCSID encoding for the SOURCE. It is NOT telling you what the CCSID encoding is for the DB2 host variables.

The NOSQLCCSID option is recommended for applications that require the highest compatibility with the behavior of the DB2 precompiler

In order to get the same behavior when converting from the stand-alone COBOL DB2 precompiler to the integrated COBOL DB2 coprocessor, it is typically recommended that the CODEPAGE compiler option should match the DSNHDECP CCSID value:

//COBOL EXEC PGM=IGYCRCTL,REGION=0M,
// PARM='SQL,NOSQLCCSID,CODEPAGE(sameasDSNHDECP)' 

_____________________________________________________________________________________ 

Example: 

How the Integrated DB2 Coprocessor behaves when you use the SQL and NOSQLCCSID compiler options:

1) The encoding of the COBOL SOURCE (COBOL statements within the program) is ALWAYS set by the CODEPAGE COBOL Compiler option. If
SQL('CCSID(nnnn)') is used as a compiler option, it is always ignored.

2) For DB2 character string Host variables, when NOSQLCCSID is
specified, the CCSID value found in the DSNHDECP file is always used.
The CODEPAGE compiler option does not affect it.

EXEC SQL
SELECT C_AZD_ADR
,C_TP_OP
,S_PARM
INTO :C-AZD-ADR
,:C-TP-OP
,:S-PARM
FROM BCA001.BPUV0050
WHERE SUBSTR(S_PARM,5,1) = '@' <<-- Used value in CODEPAGE option
for '@'
FETCH FIRST 1 ROWS ONLY
WITH UR
END-EXEC.

When you receive the IGYOS4078-W, the compiler is saying that you have a difference between the CCSID value in the CODEPAGE
option and the CCSID value in DSNHDECP.

The message looks like this:

IGYOS4078-W DSNH4791I DSNHPSRV CCSID 1140 IS USED TO PROCESS SQL, BUT
DSNHDECP HAS EBCDIC CCSID 1144 IN EFFECT


This could be interpreted as follows to make it more clear:

IGYOS4078-W DSNH4791I DSNHPSRV CCSID 1140 (WHICH COMES FROM THE
CODEPAGE COMPILER OPTION) IS USED TO PROCESS THE COBOL SOURCE AND THE
SQL THAT IS CONVERTED TO COBOL SOURCE, BUT DSNHDECP HAS EBCDIC CCSID
1144 IN EFFECT, WHICH IS ALWAYS USED TO PROCESS THE DB2 STRING HOST
VARIABLES WHEN NOSQLCCSID IS IN EFFECT.
________________________________________________________________________

Therefore:
In this specific instance, in order to get the same behavior from the Integrated
DB2 Coprocessor that you are getting from the stand-alone DB2 precompiler, the
CODEPAGE compiler option should be changed to match the DSNHDECP CCSID
value or 1144.

//COBOL EXEC PGM=IGYCRCTL,REGION=0M,
// PARM='SQL,NOSQLCCSID,CODEPAGE(1144)' RELATED INFORMATION
 Specifying CCSIDs for COBOL applications [https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/com.ibm.db2z10.doc.char/src/tpc/db2z_specifyccsidcobol.html]