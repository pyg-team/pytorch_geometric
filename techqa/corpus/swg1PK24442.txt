Title: IBM PK24442: Z/OS HTTP SERVER WEBSPHERE PLUGIN CHANGING THE ACTUAL LISTENING PORT NEEDED IN $WSSP HEADER WHEN USING HTTP/1.0 PROTOCOL - United States

Text:
z/os  FIXES ARE AVAILABLE
6.1.0.2: WebSphere Application Server V6.1.0 Fix Pack 2 for Solaris [http://www-01.ibm.com/support/docview.wss?uid=swg24013151]
6.1.0.2: WebSphere Application Server V6.1.0 Fix Pack 2 for Linux [http://www-01.ibm.com/support/docview.wss?uid=swg24013150]
6.1.0.2: WebSphere Application Server V6.1.0 Fix Pack 2 for Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24013153]
6.1.0.2: WebSphere Application Server V6.1.0 Fix Pack 2 for AIX [http://www-01.ibm.com/support/docview.wss?uid=swg24013142]
6.1.0.2: WebSphere Application Server V6.1.0 Fix Pack 2 for HP-UX [http://www-01.ibm.com/support/docview.wss?uid=swg24013144]
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The purpose of this APAR is to change the behavior of the z/OS
   Http Server plugin for WebSphere.  Currently the plug-in code
   set the $WSSP header to the real listening port,  if we did not
   get a port in the host header.
   ..
   Unfortunately, the code to handle this was not placed in a
   common module, but in the Apache-specific module.
   When the need for this field first surfaced on z/OS, it was
   not there. At the time, it was decided to use the real
   listening port when the host header did not set a port.
   What we failed to anticipate was that there are at least
   3 possibilities:
   ..
   1 - HTTP/1.1, host header with port
   2 - HTTP/1.1, host header with no port
   3 - HTTP/1.0, no host header at all
   ..
   The purpose of this change is to improvement to the code to
   handle all three possibilities and to model our plugin against
   Apache specifications.
   ..
   ..
   The customer experiencing this problem was in scenario number 3
   (HTTP/1.0, no host header at all).  They were experience a HTTP
   500 error, because it was defaulting back to the well known http
   port of 80.
   ..
   In the plug-in trace they were getting "No route found" for port
   80.
   ..
   Example of what was in the plug-in trace:
   ========================================
   ..
   TRACE: ws_common: websphereHandleRequest: Using default plugin
   WLM
   TRACE: ws_common: websphereFindServerGroup: trying to match a
   route for:
          vhost='164.120.107.12'; uri='/MNS/launch.html'
   TRACE: ws_common: webspherePortNumberForMatching: Using logical.
   TRACE: ws_common: websphereVhostMatch: Comparing
   'host176.sch.att.com:8025'
          to '164.120.107.12:80' in VhostGroup: default_host (
   TRACE: ws_common: websphereVhostMatch: Comparing '*:8025' to
          '164.120.107.12:80' in VhostGroup: default_host
   TRACE: ws_common: websphereVhostMatch: Comparing
   'host176.sch.att.com:9425'
          to '164.120.107.12:80' in VhostGroup: default_host (
   TRACE: ws_common: websphereVhostMatch: Comparing
          'host176.sch.att.com:9625' to '164.120.107.12:80' in
          VhostGroup: default_host (
   TRACE: ws_common: websphereVhostMatch: Comparing '*:9425' to
          '164.120.107.12:80' in VhostGroup: default_host
   TRACE: ws_common: websphereVhostMatch: Comparing '*:9625'
           to '164.120.107.12:80' in VhostGroup: default_host
   TRACE: ws_common: websphereVhostMatch: Failed to match:
          164.120.107.12:80
   TRACE: ws_common: websphereFindServerGroup: No route found
   TRACE: ws_common: websphereHandleRequest:
          Failed to find a server group
   TRACE: ws_common: websphereEndRequest: Ending the request
   TRACE: ihs390WAS50HttpPlugin: service_exit:
          websphereHandleRequest (/MNS/launch.html)
          returned with rc = 1; return_code = 987654
   TRACE: ihs390WAS50HttpPlugin: service_exit: return --
          return_code = 0
   ..
   
   
    
   
   

LOCAL FIX
 *  Temporary fix was to update the plugin-cfg.xml file and change
   the AppServerPortPreference to "webserverPort".
   
   
   
   ..
   AppServerPortPreference="webserverPort"
   ..
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere Application Server    *
   *                 V6.0.1 for z/OS                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: HTTP response code 500 occurs because   *
   *                      the port recorded in the $WSSP header   *
   *                      in the z/OS plugin is not correct and   *
   *                      is not consistent with other versions   *
   *                      of the plugin.                          *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   Requests after the first one may be directed to the wrong port
   if the client uses HTTP/1.0, which has no Host header. This can
   cause an HTTP response code 500 or other unexpected results.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Depending on the request headers and on AppServerPortPreference,
   the plugin creates a $WSSP header that can be:
   - the port from the Host header
   - the actual listening port of the server, or
   - the standard non-SSL or SSL port, 80 or 443.
   This APAR brings the z/OS plugin into conformance with the
   Apache version of the plugin.
   z/OS Customers who counted on APAR PK01799 to take the third
   option above when using a firewall and using an HTTP server on
   a port other than 80 should always use HTTP/1.1 clients.
   
   APAR PK24442 is currently targeted for inclusion in Service
   Level (Fix Pack) 6.0.2.13 of WebSphere Application Server V6.0.1
   for z/OS.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK24442
   
   
 * REPORTED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * REPORTED COMPONENT ID
   5655I3500
   
   
 * REPORTED RELEASE
   601
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-05-04
   
   
 * CLOSED DATE
   2006-08-08
   
   
 * LAST MODIFIED DATE
   2006-09-05
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PK24378
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK17048 PK30320
   
   

MODULES/MACROS
 *  BBOACTF  BBOCJFPC BBOCJFPE BBOCJFPP BBOCJFPR
   BBOCJFPS BBOCLCLR BBOCWBAL BBOCWBRT BBOCWCRD BBOCWSMP BBODAS
   
   ***This field was truncated.  To obtain the full apar record, please contact your local support center.***
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * FIXED COMPONENT ID
   5655I3500
   
   

APPLICABLE COMPONENT LEVELS
 * R601 PSY UK17048 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK17048]
   UP06/08/17 P F608
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.