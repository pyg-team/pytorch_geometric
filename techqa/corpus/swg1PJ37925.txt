Title: IBM PJ37925: JAVA API DOES NOT CLOSE UTCRYPTOKEYFILE.PROPERTIES FILES CAUSING APPLICATION ENGINE SERVER TO HANG IF THE ULIMIT IS SET TOO LOW - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The P8 AE server may stop unexpectedly with an 'too many open
   files' error on UNIX if ulimit is set too low.  This is caused
   by the P8 Java API not closing UTCryptoKeyFile.properties files.
    Most instances of this file get closed during Java garbage
   collection, but at high volumes and lots of memory, it is
   possible for many hundreds or even thousands of open files may
   stack up on the server between GCs.
   
   When 'too many open files' occurs, the application server stops
   servicing requests and kicks users out of their sessions.  Using
   lsof to view open files descriptors shows many open
   UTCryptoKeyFile.properties files on the AE server.
   
   
    
   
   

LOCAL FIX
 *  To work around this problem, increase the ulimit for the UNIX
   user until the load is handled within the normal GC period.
   This may require boosting the ulimit to 4096 or higher.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * Users of P8 3.5x Content Java API Compatibility and any      *
   * Application Engine server                                    *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * The Application Engine (AE) server can stop unexpectedly     *
   * producing a "too many open files" error - this can indicate  *
   * that the AE has stopped servicing requests and is kicking    *
   * users out of their sessions.  A check of open file           *
   * descriptors on the server will indicate that a process shows *
   * an excessive number of file descriptors being used for the   *
   * same "UTCryptoKeyFile.properties" file.                      *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Upgrade to the P8CE-4.0.1-013 fix pack to get the fix for    *
   * this problem.                                                *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  The underlying cause of the "too many open files" error for
   
   the UTCryptoKeyFile.properties file is that (in some scenarios)
   the P8 3.5x Content Java API Session object code to open but not
   close that file.  In most cases java garbage collection would
   handle this scenario, but not reliably so and in some cases it
   
   was possible for the open file descriptors to reach a level that
   would impact the AE server and cause the unexpected stop.
   
   All code which allowed the UTCryptoKeyFile.properties file to
   remain open has been identified and fixed in the P8CE-4.0.1-013
   fix pack.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PJ37925
   
   
 * REPORTED COMPONENT NAME
   APPLICATION ENG
   
   
 * REPORTED COMPONENT ID
   5724R7610
   
   
 * REPORTED RELEASE
   401
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-07-08
   
   
 * CLOSED DATE
   2011-03-03
   
   
 * LAST MODIFIED DATE
   2011-03-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PJ37928 [http://www-01.ibm.com/support/docview.wss?uid=swg1PJ37928]
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CONTENT ENGINE
   
   
 * FIXED COMPONENT ID
   5724R8101
   
   

APPLICABLE COMPONENT LEVELS
 * R401 PSY
   UP