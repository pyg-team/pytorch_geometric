Title: IBM IV80139: ESCALATION CRON TASK FAILS TO RECOVER FROM DATABASE CONNECTION ISSUES - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  ERROR DESCRIPTION:
   Escalation Cron Task Fails to Recover From Database Connection
   Issues
   PROBLEM:
   In some situations, Maximo has database connections closed (an
   example is a database server restart but other scenarios can
   cause a
   database connection to be closed).
   Most of Maximo seems to work OK once connections resume but
   Escalation cron tasks in particular seem
   to always retry to use the same closed database connection even
   if it fails multiple times in a row.
   STEPS TO REPRODUCE:
   As an example, we have a daily process to audit inventory data.
   A tempdb issue occurred on one of our SQL Server instances and
   was quickly rectified.
   Somehow, it seems that temporary tempdb issue caused at least
   one database connection to be closed.
   Steps to check it are :
   1. Open Maximo logged as maxadmin
   2. Go to Cron task Setup app
   3. Make sure you have a crontask in Maximo in Cron Task Setup
   application that is configured to run automatically.
   When the cron task executed the next time by Maximo (and every
   time since the issue) it's failed with:
   BMXAA6713E - The MBO fetch operation failed in the mboset with
   the SQL error code 0. The record could not be retrieved from
   the database.
   See the log file for more details about the error.
   com.microsoft.sqlserver.jdbc.SQLServerException: The connection
   is closed.
   Some escalations seem to run fine and Maximo from the front end
   seems to run fine.
   It's just some escalations fail and it's not apparent because
   the cron task for the escalation shows the last run date as the
   proper date/time and nothing gets recorded in the ESCSTATUS
   table to show that it's failing.
   Steps to check it are :
   1. Open Maximo logged as maxadmin
   2. Go to Escalations app
   3. Select any of the active escalations and check the Last Run
   field.
   The strange part is
   it's constant (the same escalations that succeed always succeed
   the ones that fail always fail).
   The escalation that failed wasn't even running during the time
   the tempdb problem occurred.
   This makes it seem like somehow the cron task is retaining the
   unique id of the database connection to use?
   Maximo shouldn't continuously try to use a closed connection.
   Restarting Maximo does address the issue but it isn't always
   clear when a full restart is needed and when it isn't and
   restarting every
   application server is a very time intensive process that can
   take a quick 2 minute outage and turn it into a 30 minute
   outage.
   Steps to check it are:
   1- Go to Application Server console
   2- Stop Maximo server
   3- Start Maximo server
   4- Make sure Maximo server is restarted and back to production
   Temporary database issues require larger application issues as
   a full restart of all the Maximo JVMs has to occur because it's
   impossible to determine what's running properly.
   The escalation and cron task are set to ACTIVE (otherwise
   restarting Maximo wouldn't fix the problem).
   The error will not resolve unless the server is restarted.
   The cron task is definitively ACTIVE (the cron task is running
   at the scheduled times) and the escalation is ACTIVE, though it
   doesn't really matter because the piece that is failing in the
   logs is the cron task trying to get the Escalation MBO record.
   Assuming the escalation was in fact marked INACTIVE and the
   cron task was somehow still set to ACTIVE, the cron task throws
   a completely different
   error to show that the escalation is INACTIVE and can't be run
   against it.
   As per L3 analysis ,
   1) The Java stack trace in this case will show ....
   BMXAA6713E - The MBO fetch operation failed in the mboset with
   the SQL
   error code 0. The record could not be retrieved from the
   database.
   Relevant details in the log file from the Maximo environment
   (only if it has been enabled in the Logging app) will display
   something like this below :
   com.microsoft.sqlserver.jdbc.SQLServerException: The connection
   is
   closed.
            at
   com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverEr
   ror(SQLS
   erverException.java:170)
            at
   com.microsoft.sqlserver.jdbc.SQLServerConnection.checkClosed(SQL
   ServerCo
   nnection.java:304)
            at
   com.microsoft.sqlserver.jdbc.SQLServerConnection.createStatement
   (SQLServ
   erConnection.java:1853)
            at psdi.server.ConRef.createStatement(ConRef.java:270)
            at psdi.mbo.MboSet.getNextRecordData(MboSet.java:3029)
            at psdi.mbo.MboSet.fetchMbosActual(MboSet.java:2705)
            at psdi.mbo.MboSet.fetchMbos(MboSet.java:2662)
            at psdi.mbo.MboSet.getMbo(MboSet.java:1944)
            at
   psdi.app.escalation.engine.EscalationTask.getEscalation(Escalati
   onTask.j
   ava:423)
            at
   psdi.app.escalation.engine.EscalationTask.performTask(Escalation
   Task.jav
   a:125)
            at
   psdi.app.escalation.engine.EscalationCronTask.cronAction(Escalat
   ionCronT
   ask.java:46)
            at
   psdi.server.CronTaskManager.callCronMethod(CronTaskManager.java:
   1590)
            at
   psdi.server.CronTaskManager.access$400(CronTaskManager.java:87)
            at
   psdi.server.CronTaskManager$CronThread.run(CronTaskManager.java:
   2160)
   2) The fix needs to me made inside EscalationCronTask
   3) The fix involves checking if the DB is SQS ... If it is
   Catch the
   above exception from the stack trace and get the UserInfo again
   and set
   it (i.e the same block of code in the constructor when the task
   == null
   CURRENT ERRONEOUS RESULT:
   Escalation Cron Task Fails to Recover From Database Connection
   Issues
   EXPECTED RESULT:
   Escalation Cron Task to Recover From Database Connection Issues
   ENVIRONMENT (SYSTEM INFO):
   Version Tivoli's process automation engine
   7.5.0.6-IFIX20141106-0823
   Build 20140404-0005 DB Build V7506-33 HFDB Build HF7506-14
   IBM TPAE Integration Framework 7.5.1.1 Build 20140411-2000 DB
   Build
   V7511-01
   Maximo Everyplace 7.5.0.0 Build 20110307-0030 DB Build V7100-01
   IBM Maximo Asset Management 7.5.0.6 Build 20140404-0000 DB
   Build V7506-
   00
   
   
    
   
   

LOCAL FIX
 *  n/a
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All Maximo Users                                             *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Escalation cron task fails to recover from database          *
   * connection issues on SQL Server                              *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Upgrade to latest release                                    *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Escalation cron task recovers from database connection closure
   issues on SQL Server
   
   The fix for this APAR is contained in the following maintenance
   package:
   	| release\fix pack | Fix Pack Release 7.6.0.5
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV80139
   
   
 * REPORTED COMPONENT NAME
   ADMIN & SECURIT
   
   
 * REPORTED COMPONENT ID
   TIVOADMIN
   
   
 * REPORTED RELEASE
   750
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-01-08
   
   
 * CLOSED DATE
   2016-05-02
   
   
 * LAST MODIFIED DATE
   2016-05-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  MAXIMO
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   ADMIN & SECURIT
   
   
 * FIXED COMPONENT ID
   TIVOADMIN
   
   

APPLICABLE COMPONENT LEVELS
 * R750 PSY
   UP