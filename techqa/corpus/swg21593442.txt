Title: IBM FAQ: How to configure the JDBC driver for automatic client re-route - United States

Text:
ACR; HADR; client reroute; jdbc; automatic; websphere; reroute; jcc; jndi; sysplex; z/os; workload balancing; purescale; cluster RECOMMENDED RESOURCES

ABSTRACT
 There are multiple methods to configure the JDBC driver (db2jcc.jar/db2jcc4.jar) for automatic client reroute. What are the pros and cons of each method? How does this relate to High Availability Disaster Recovery (HADR)? 

CONTENT

What is Automatic Client Reroute (ACR) ?
Automatic client reroute is an IBMÂ® Data Server feature that redirects client applications from a failed server to an alternate server so the applications can continue their work with minimal interruption. 

How is ACR related to High Availability And Disaster Recovery (HADR) ?
The ACR functionality is entirely separate from HADR. They are two different functionalities which are independent of each other. Some configurations use only the ACR portion without HADR because the application performs SELECT queries without any INSERT/UPDATE/DELETEs.

How is ACR configured with DB2 pureScale or DB2 for z/OS SYSPLEX?

Please refer to the following docs for in-depth details:

DB2 PureScale enablement: Workload balancing, automatic client reroute, and client affinities.
http://public.dhe.ibm.com/software/dw/data/dm-1206purescaleenablement/wlb.pdf [http://public.dhe.ibm.com/software/dw/data/dm-1206purescaleenablement/wlb.pdf]

Increase scalability and failure resilience of applications with IBM Data Server Driver for JDBC and SQLJ - Explore benefits of Sysplex and IBM DB2 pureScale data-sharing technologies 
http://www.ibm.com/developerworks/data/library/techarticle/dm-1407purescalesysplex/index.html [http://www.ibm.com/developerworks/data/library/techarticle/dm-1407purescalesysplex/index.html]


How is ACR configured with Websphere Application Server v8?
Please refer to the link:

Deploy and explore the DB2 10 pureScale Feature on WebSphere Application Server V8
http://www.ibm.com/developerworks/data/library/techarticle/dm-1307purescale/ [http://www.ibm.com/developerworks/data/library/techarticle/dm-1307purescale/]


What are the methods to configure ACR ?
There are three methods to configure ACR, each with their advantage/disadvantage.



For methods (1) and (2) below lets assume that:
The port number is port used by DB2 to listen for connections (DBM CFG SVCENAME parameter).

Primary: test1.ibm.com:50000
Secondary: test2.ibm.com:60000
Database is named SAMPLE on both systems. 

(1) DB2 Alternate Server
Pros: Easy to implement.

If the client was unable to make an initial connection to test1.ibm.com to retrieve the alternate server list, it will check to see what values have been set in the parameters clientRerouteAlternateServerName and clientRerouteAlternatePortNumber. If the connection to test1.ibm.com was successful, then the alternate server information retrieved would override clientRerouteAlternateServerName and clientRerouteAlternatePortNumber.

On Client system:
clientRerouteAlternateServerName=test2.ibm.com 
clientRerouteAlternatePortNumber=60000 

On DB2 Primary system: 

db2 "update alternate server for sample using hostname test2.ibm.com port 60000" 

Check the configuration to confirm the alternate server information has been set. 
db2 "list db directory"

Database 1 entry:

Database alias = SAMPLE
Database name = SAMPLE
Database release level = d.00
Comment =
Directory entry type = Indirect
Catalog database partition number = -1
Alternate server hostname = test2.ibm.com
Alternate server port number = 60000



On DB2 Secondary system: 
db2 "update alternate server for sample using hostname test1.ibm.comport 50000" 

Check the configuration to confirm the alternate server information has been set. 
db2 "list db directory"

Database 1 entry:

Database alias = SAMPLE
Database name = SAMPLE
Database release level = d.00
Comment =
Directory entry type = Indirect
Catalog database partition number = -1
Alternate server hostname = test1.ibm.com
Alternate server port number = 50000 

 


(2) JDBC Driver Properties

Pros: Easy to implement

enableClientAffinitiesList=1 
clientRerouteAlternateServerName=test1.ibm.com,test2.ibm.com 
clientRerouteAlternatePortNumber=50000,60000 

Note if setting from Websphere Admin Console:
enableClientAffinitiesList Integer type 
clientRerouteAlternateServerName String type 
clientRerouteAlternatePortNumber String type

See "JDBC Driver Properties" for other JDBC property data types

This method hard codes the primary and secondary connectivity information in the JDBC client. There are no server side dependencies, but it may be labour intensive to set these values if there are many JDBC clients.

Refer to the link "Enabling client affinities" in the Related URL section at the bottom of this technote.



(3) JNDI via Websphere 


Pros: Alternate server information is persistent

Cons: More complex to implement

Refer to the developerWorks article "Building a high availability database environment using Websphere Part1" from the Related URL section at the bottom of this technote.



Additional ACR Parameters

For more details on the keywords below please refer to JDBC Driver Configuration Keywords in the Related Links section.

enableSeamlessFailover: Determines if application receives SQLException to let it know that ACR has occurred.

maxRetriesForClientReroute: Controls number of tries to primary system

retryIntervalForClientReroute: Amount of time to wait before retries

interruptProcessingMode: See notes in regards to how Statement.cancel() is handled with ACR

TCP/IP keepalive parameters [http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.admin.ha.doc/doc/c0058765.html?lang=en] may also have to be adjusted. These are outside the scope and expertise of DB2 Defect Support. 


Additional Notes: 

If using hostnames for the alternate servers, ensure these hostnames are valid on the client side. 

 

nslookup <host name> 

 

If hostname cannot be found add it to the Domain Name Server or: 

Linux/Unix: /etc/hosts 

Windows: %WINDIR%\System32\drivers\etc\hosts

RELATED INFORMATION
 How Can I test Automatic Client Reroute? [http://www.ibm.com/support/docview.wss?uid=swg21394840]
Operation of ACR [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_c0056197.html]
Configuration of DB2 LUW and ACR for Java clients [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_c0056186.html]
JDBC Driver Configuration Keywords [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_r0052038.html]
DeveloperWorks: Building HA database environment using [http://www.ibm.com/developerworks/websphere/techjournal/0705_lee/0705_lee.html#appendix]
Client affinities [http://www.ibm.com/support/knowledgecenter/SSEPGG_11.1.0/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_c0056256.html]
JDBC Driver Properties [http://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.5.0/com.ibm.db2.luw.apdv.java.doc/src/tpc/imjcc_r0052038.html]
A simplified Chinese translation is available [http://www.ibm.com/support/docview.wss?uid=swg21657585]