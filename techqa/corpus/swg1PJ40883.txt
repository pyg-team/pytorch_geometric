Title: IBM PJ40883: SSL HANDSHAKE FAIL WITH Z/OS - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  See Problem Summary.
   
   
    
   
   

LOCAL FIX
 *  na
   
   
    
   
   

PROBLEM SUMMARY
 *  APAR NUMBER:  PJ40883
   PRODUCT:  z/TPF
   FUNCTIONAL AREA:  MQS SUPPORT
   SHIPPED IN PUT:  10
   
   ABSTRACT:
   With PJ34481 [http://www-01.ibm.com/support/docview.wss?uid=swg1PJ34481], zTPF WebSphere MQ SSL handshake may fail when a
   z/OS sender/client channel connects to z/TPF
   
   PACKAGE CONTENTS:
   Source Segments:
   (C) base/include/tpf/i_ecb3.h
   (C) base/macro/ieqce3.mac
   (C) base/openssl/crypto/x509v3/v3_purp.c
   (C) base/openssl/include/tpf/i_issl.h
   (C) base/openssl/ssl/ssl_lib.c
   (C) base/openssl/tpfssl/csslwb.c
   
   Object Only Binaries:
   (C) base/oco/lib/libCMQO.so
   (C) base/oco/load/CMQO.so
   
   Configuration Independent Binaries:
   (C) base/openssl/lib/libCRYP.so
   (C) base/openssl/lib/libCSSL.so
   (C) base/openssl/load/CRYP.so
   (C) base/openssl/load/CSL2.so
   (C) base/openssl/load/CSSL.so
   (C) base/openssl/obj/csslwb.o
   (C) base/openssl/obj/ssl_lib.o
   (C) base/openssl/obj/v3_purp.o
   
   Support Files:
   base/openssl/lst/csslwb.lst
   base/openssl/lst/CRYP.map
   base/openssl/lst/CSL2.map
   base/openssl/lst/CSSL.map
   base/openssl/lst/ssl_lib.lst
   base/openssl/lst/v3_purp.lst
   
   OTHER BINARIES TO BUILD: YES
   (C) os390/bin/ppcp.pds
   (C) os390/bin/tpfldr.pds
   (C) os390/obj/ccmcdc.o
   (C) os390/obj/genfil.o
   (C) os390/obj/stpp.o
   COMMENTS:
   When a z/OS sender or client channel (SSL client) is started
   using SSL, connecting to a z/TPF receiver/svrconn channel (SSL
   server) may result in the following errors:
   on z/TPF:
   MQSC0362E START CHANNEL channelname FAILED - SSL HANDSHAKE
   ERROR - SSL_connect SSLRC = 5 - SSL_ERROR_SYSCALL, sock_errno 0
   
   on z/OS:
   CSQX620E: csect-name System SSL error, channel channel-name,
   function  gsk_secure_socket_init' RC=410
   When a z/OS sender/client channel using SSL connects to z/TPF
   receiver/svrconn channel, an SSL client-authenticated handshake
   is initiated. z/TPF sends a CertificateRequest to the SSL
   client, however, the list of certificate authorities in this
   request is blank. z/OS expects a list of certificates that
   contain the distinguished names of acceptable certificates that
   the SSL server will accept.
   In addition, an SSL client-authenticated handshake fails if the
   certificate supplied by the z/OS client cannot be used for the
   specified purpose. If the certificate has a type of "SSL
   Server", the z/TPF server rejects the certificate, during
   SSL_accept() processing, with a X509_V_ERR_INVALID_PURPOSE
   return code (26), which indicates that the supplied certificate
   cannot be used for the specified purpose.
   
   
    
   
   

PROBLEM CONCLUSION
 *  SOLUTION:
   z/TPF WebSphere MQ sender channels have been updated to
   generate a list of certificate authorities to send to the
   client based on the CAINFO parameter of the z/TPF WebSphere MQ
   configuration file for SSL.
   Program v3_purp.c in the OpenSSL load module CRYP has been
   modified to bypass the certificate check that causes an SSL
   client-authenticated handshake to fail when MQ is the SSL
   application to issue an SSL_accept() function.
   
   COREQS: NO
   None.
   
   MIGRATION CONSIDERATIONS: NO
   None.
   
   BUILD COMMANDS AND INSTRUCTIONS: YES
   #maketpf commands for linux
   maketpf -f CRYP v3_purp.o
   maketpf -f CSSL ssl_lib.o
   maketpf -f CSL2 csslwb.o
   maketpf CRYP link
   maketpf CSSL link
   maketpf CSL2 link
   #maketpf commands for z/OS
   maketpf -f tpfldr genfil.o
   maketpf -f ppcp ccmcdc.o stpp.o
   maketpf tpfldr link
   maketpf ppcp link
   
   UPDATED INFORMATION UNITS: YES
   z/TPF Security
   
   See your IBM representative if you need additional information.
   
   DOWNLOAD INSTRUCTIONS:
   http://www.ibm.com/software/htp/tpf/maint/maintztpf.html [http://www.ibm.com/software/htp/tpf/maint/maintztpf.html]
   
   APAR URL:
   http://www.ibm.com/software/htp/tpf/ztpfmaint/put10/PJ40883.htm [http://www.ibm.com/software/htp/tpf/ztpfmaint/put10/PJ40883.htm]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PJ40883
   
   
 * REPORTED COMPONENT NAME
   Z/TPF
   
   
 * REPORTED COMPONENT ID
   5748T1501
   
   
 * REPORTED RELEASE
   110
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2013-03-11
   
   
 * CLOSED DATE
   2013-06-28
   
   
 * LAST MODIFIED DATE
   2013-06-28
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

Publications Referenced SK2T8062 FIX INFORMATION
 * FIXED COMPONENT NAME
   Z/TPF
   
   
 * FIXED COMPONENT ID
   5748T1501
   
   

APPLICABLE COMPONENT LEVELS
 * R110 PSY
   UP