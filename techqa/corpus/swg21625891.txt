Title: IBM The deployment of a process application for IBM Business Process Manager (BPM) fails after the initial deployment - United States

Text:
bpm; deployment; process app; fails TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Attempts to deploy additional snapshots after initially deploying a process application fail with an error. 

SYMPTOM
The following error occurs when you attempt to deploy additional snapshots after initially deploying a process application: 

[11/5/12 18:24:25:374 EST] 00000054 wle E CWLLG0395E: An exception
occurred in addTimeSchedule com.lombardisoftware.client.delegate.
BusinessDelegateException: PreparedStatementCallback; SQL [insert into
LSW_TIME_SCHEDULE (SCHEDULE_ID,NAME,EXCLUDE_HOLIDAY) values (?,?,?)]; 
Error for batch element #1: DB2 SQL Error: SQLCODE=-803,
SQLSTATE=23505, SQLERRMC=2;BPMINST.LSW_TIME_SCHEDULE, DRIVER=3.61.65; 

 

This issue occurs when you use the following code:
var tsName = "8AM-8PM M-F";
var ts = new tw.object.TWTimeSchedule();
ts.name = tsName;
ts.excludeHolidays = false;
.........
var added = tw.system.addTimeSchedule(ts);
if (!added) {
var tmpTs = tw.system.findTimeScheduleByName(tsName);
tw.system.removeTimeSchedule(tmpTs.id);
tw.system.addTimeSchedule(ts);
}


CAUSE
This issue occurs because the installation and deployment service run in a single overall transaction. The Javaâ„¢script API that is used to remove and insert the time schedule is done under separate database sessions, and there is no commit between them because of the single overall transaction. Consequently, the insert waits forever for the delete to commit and to release the row lock.


RESOLVING THE PROBLEM
If there is a need to update a time schedule, instead of invoking removeTimeSchedule() followed by addTimeSchedule(), you should invoke updateTimeSchedule(). The same is true of removeHolidaySchedule(). 



Change the previously listed code to this code example:
var tsName = "8AM-8PM M-F";
var tmpTs = tw.system.findTimeScheduleByName(tsName); 
var ts;
if(tmpTs != null)
{
ts = tmpTs;
}
else
{
ts = new tw.object.TWTimeSchedule();
}
ts.name = tsName;
ts.excludeHolidays = false;
.......
if (tmpTs != null) {
tw.system.updateTimeSchedule(ts);
}
else{
tw.system.addTimeSchedule(ts);
}

 

PRODUCT ALIAS/SYNONYM
 BPM