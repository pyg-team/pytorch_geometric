Title: IBM TPM OutOfMemory Troubleshooting - United States

Text:
OOM DeploymentEngine javacore heapdump TECHNOTE (FAQ)

QUESTION
 What TPM server logs need to be enabled to analyze OutOfMemory Issues? 

ANSWER
To Debug the TPM DeploymentEngine OutOfMemory
Three sets of logs need to be enabled and collected:


Maximo Logging: 

https://www-304.ibm.com/support/docview.wss?uid=swg21313341 [https://www-304.ibm.com/support/docview.wss?uid=swg21313341]

Under the Maximo 7 section to see the screenshots and details 
0. Go To - SystemConfiguration - Platform Configuration - Logging 
1. Set the Root Logger in Logging Application to INFO and the appender to Rolling. 
2. Also set the Rolling Appender to a file size of 20 and backup index of 24. 
3. Apply the settings 
4. Set the following properties in the System Properties Application 
a) mxe.db.logSQLTimeLimit=1000 
b) mxe.mbocount=1 
c) mxe.db.fetchResultLogLimit=200 
5. Select those 3 properties and save and Select Action / Live Refresh 


Hint: to verify the Maximo Logging is on:
--->cat tio_start_service.log | egrep -i "sqltimelimit|mbocount|fetchresult" | grep -v BMXAA6702I | grep -v BMXAA6710I

The maximo logging gets enabled when you restart tpm.


the Maximo logging is here: 

/usr/ibm/tivoli/common/COP/logs/tio_start_service.log 






Turn on verbosegc logging for the TPM DeploymentEngine 

add these two lines to this file
/opt/IBM/tivoli/tpm/lwi/conf/overrides/TPM.javaopt
-verbose:gc
-Xverbosegclog:gcverboselog.txt

You must stop and start the TPM server to pick up these changes.

The verbose GC logging will be here: 

/opt/IBM/tivoli/tpm/lwi/runtime/core/gcverboselog.txt 






TPM 7.2 procedure to turn up the DeploymentEngine traces in console.log log4j.prop 

http://pic.dhe.ibm.com/infocenter/tivihelp/v45r1/topic/com.ibm.support.tpm.doc/logs/rtrblog_configuringlog4j.html [http://pic.dhe.ibm.com/infocenter/tivihelp/v45r1/topic/com.ibm.support.tpm.doc/logs/rtrblog_configuringlog4j.html]


 


$TIO_HOME/config/log4j.prop 

make a backup of that log4j.prop file before editing. 

Activate the traces: 

edit log4j.prop and change these existing three lines for debug: 

 log4j.category.com.thinkdynamics=DEBUG, consolefile, errorfile 

 log4j.category.com.ibm.tivoli=DEBUG, consolefile, errorfile 

 log4j.appender.consolefile.threshold=DEBUG 

and to ensure the console.log does not wrap (requires 500 Meg of filesystem) 

 log4j.appender.consolefile.MaxFileSize=100MB 

 log4j.appender.consolefile.MaxBackupIndex=5 

 

The debug traces will be enabled automatically in about 2 minutes. 

No restart of tpm is required. 

 

log location: $TIO_LOGS/console.log 

 


JavaCore and HeapDump files:
When the TPM DE hits an OOM condition
it will drop a JavaCore and HeapDump
these need to be zipped and uploaded to support.
$TIO_HOME/lwi/runtime/core/javacore*
$TIO_HOME/lwi/runtime/core/heapdump*



After the OOM condition occurs, collect these logs:


/usr/ibm/tivoli/common/COP/logs/tio_start_service.log


/opt/IBM/tivoli/tpm/lwi/runtime/core/gcverboselog.txt 

$TIO_LOGS/console.log* ( all of these ) 

$TIO_HOME/lwi/runtime/core/javacore* 


$TIO_HOME/lwi/runtime/core/heapdump*





If the OutOfMemory was on the TPM Deployment Engine: 

How to increase the maximum heap size for the DeploymentEngine (DE/LWI) component of TPM to prevent this type of OOM.



1) Stop TPM engines 
2) Edit $TIO_HOME/lwi/conf/overrides/TPM.javaopt and increase -Xmx 
value to 2400M or a value that is large enough and within limits of 
available system memory 
3) Restart TPM engines