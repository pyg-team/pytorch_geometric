Title: IBM MustGather: Tracing Dynamic Routing feature in web server Plug-in v8.5.5 for Liberty Profile ND - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 What information, logs, and traces, should I gather and send to IBM Support to troubleshoot a problem with the Dynamic Routing feature in the web server Plug-in v8.5.5 for Liberty Profile ND? 

CAUSE
Liberty Profile ND has a feature called Dynamic Routing [http://www.ibm.com/support/knowledgecenter/SSAW57_8.5.5/com.ibm.websphere.wlp.nd.multiplatform.doc/ae/twlp_wve_enabledynrout.html]. If enabled, this features allows the web server Plug-in to do routing in a dynamic fashion based on configuration information from the Liberty Cluster Controller.

If you are having problems with the Dynamic Routing feature in the Liberty Profile ND, please gather this information and send it to IBM support.


RESOLVING THE PROBLEM
1) What is your exact level of IBM Liberty Profile ND? On what platform? 

 

2) What web server type are you using? What version? On what platform? 

 

3) What are the symptoms of the "problem"? What is the URL that the user is trying to access? What error message does the user see in the browser? At what time did the problem happen? 

 

4) Enable access to the /server-status page of the web server. 

The Apache mod_status [http://httpd.apache.org/docs/2.2/mod/mod_status.html] servlet must be enabled and access to the /server-status URL must be enabled in your http configuration file. 

 

5) Set the Plug-in LogLevel to "Trace": 

Edit the plugin-cfg.xml file and set the LogLevel to Trace, like this: 

LogLevel="Trace" 

 

6) Set the Intelligent Management trace specification to "DEBUG": 

Add the following lines to the server.xml of one of your Liberty collective controllers: 

<dynamicRouting> 

 <traceSpecification name="default" specification=":DEBUG" /> 

</dynamicRouting> 

Run the command to generate a new plugin-cfg.xml. 

See:
Dynamic Routing Liberty collective command actions [http://www.ibm.com/support/knowledgecenter/SSAW57_8.5.5/com.ibm.websphere.wlp.nd.doc/ae/rwlp_wve_dynroutcollect.html] 

Alternatively, you can edit the existing plugin-cfg.xml file, and add the following inside the <IntelligentManagement> xml stanza: 

<TraceSpecification name="default" specification=":DEBUG"/> 

 

7) Copy the newly generated plugin-cfg.xml file from the Liberty server directory to the Plugins config directory on the web server. If possible, please stop and restart the web server so the trace will show everything from the beginning. 

 

8) Capture a trace of the Dynamic Routing services on the Liberty collective controller: 

Add the following to the server.xml of the Liberty collective controller servers: 

<logging traceSpecification="*=audit:com.ibm.ws.dynamic.routing.*=debug:com.ibm.ws.collective.routing.*=debug"/> 

 

9) At the time of the problem, capture additional information: 

Examine the output of the /server-status page in the web server to determine the collective controller that the web server is currently communicating with. This is the collective controller that is listed as STARTED under “connectors” on the /server-status page. Save the /server-status page as an html file to send to IBM support. 

 

Capture a "dump" of the Liberty collective controller that the web server is communicating with:
Generating a Liberty server dump from the command line
http://www.ibm.com/support/knowledgecenter/SSEQTP_8.5.5/com.ibm.websphere.wlp.doc/ae/twlp_setup_dump_server.html [http://www.ibm.com/support/knowledgecenter/SSEQTP_8.5.5/com.ibm.websphere.wlp.doc/ae/twlp_setup_dump_server.html] 

 

NOTE: For Liberty Server v16.0.0.4 and later, you do NOT need to run following mbeans. But, For all prior versions of Liberty Server, you DO need to run the following mbeans: 

 

On the "WebSphere:feature=dynamicRouting,type=DynamicRouting,name=DynamicRouting" MBean invoke the “dumpPostResponse” method with the arguments ("/<output_directory>/DynamicRoutingResponse.txt”.””). 

See Interface DynamicRoutingMBean [http://www.ibm.com/support/knowledgecenter/en/SSAW57_8.5.5/com.ibm.websphere.javadoc.liberty.doc/com.ibm.websphere.appserver.api.dynamicRouting_1.1-javadoc/com/ibm/websphere/dynamic/routing/DynamicRoutingMBean.html#dumpPOSTResponse(java.lang.String,%20java.lang.String] 

 

On the "WebSphere:feature=collectiveController,type=RoutingInfoManager,name=RoutingInfoManager" MBean, invoke the “dump” method with the arguments ("/<output_directory>/RoutingInfo.txt”,””). 

 

Here are example curl commands that can be run to invoke these MBeans. If you do not have curl available, you can use the jconsole command on the collective controller host to invoke the MBeans.



curl--user <controller_userName>--data '{"params":[{"value" : "/<output_directory>/DynamicRoutingResponse.txt", "type" : "java.lang.String"},{"value" : "","type" : "java.lang.String" }],"signature":["java.lang.String","java.lang.String"] }' --header "Content-Type:application/json" --request POST --insecure "https://localhost: /IBMJMXConnectorREST/mbeans/WebSphere%3Afeature%3DdynamicRouting%2Cname%3DDynamicRouting%2Ctype%3DDynamicRouting/operations/dumpPOSTResponse " 



curl--user <controller_userName>--data '{"params":[{"value" : "/<output_directory>/RoutingInfo.txt", "type" : "java.lang.String"},{"value" : "","type" : "java.lang.String" }],"signature":["java.lang.String","java.lang.String"] }' --header "Content-Type:application/json" --request POST --insecure "https://localhost: /IBMJMXConnectorREST/mbeans/WebSphere%3Afeature%3DcollectiveController%2Cname%3DRoutingInfoManager%2Ctype%3DRoutingInfoManager/operations/dump " 



Replace <controller_userName> with a user that has administrative access to the collective. The command will prompt for the password. 

Replace <output_directory> with a filesystem location with enough free space to hold the generated information. The full information should only be in the megabytes, so tmp would probably be appropriate. 

Replace <controller_httpsPort> with the httpsPort of the collective controller listed as STARTED in the /server-status page. 

Each curl command will cause a file to be written to the output directory. The two files are 

DynamicRoutingResponse.txt 

RoutingInfo.txt 

 




10) After capturing the traces of the problem, please send the answers to the questions above and these files to IBM Support: 


+ web server configuration and log files:
httpd.conf
error_log
access_log

+ plug-in configuration and log files:
plugin-cfg.xml
http_plugin.log

+ output of the /server-status page (saved as an html file)

+ zip file the "dump [http://www.ibm.com/support/knowledgecenter/SSEQTP_8.5.5/com.ibm.websphere.wlp.doc/ae/twlp_setup_dump_server.html]" of the Liberty collective controller

+ files created by running the curl commands in step 9:
DynamicRoutingResponse.txt
RoutingInfo.txt

+ Liberty collective controller configuration and log files:
server.xml
zip of the entire logs directory and subdirectories 

 

 

11) After the tracing has been completed, change Plug-in Level back to "Error", and remove the DEBUG trace specification from the Intelligent Management section. Also turn off the WAS traces by setting the trace specification back to *=info only. 

 

NOTE: keep an eye on the size of the http_plugin.log file. It does NOT wrap like WAS log files. So, if the plug-in log is growing very large (over 2 GB) you will need to stop the web server, and delete or rename the file, then restart the web server. OR, you may want to consider using RotateLogs [https://developer.ibm.com/answers/questions/199345/automatically-rotate-log-files-for-ihs-and-plug-in.html] to automatically rotate the plug-in log to a new file based on time or size.





RELATED INFORMATION
 Setting up dynamic routing for Liberty collectives [http://www.ibm.com/support/knowledgecenter/SSAW57_8.5.5/com.ibm.websphere.wlp.nd.multiplatform.doc/ae/twlp_wve_enabledynrout.html]