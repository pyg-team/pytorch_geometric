Title: IBM IC81328: ALTER TABLE FAILS WITH SQL0270N DUE TO NON-EXISTENT MQT DEPENDENCY - United States

Text:
z/os  FIXES ARE AVAILABLE
DB2 Version 9.7 Fix Pack 7 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24033685]
DB2 Version 9.7 Fix Pack 8 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24034634]
DB2 Version 9.7 Fix Pack 9 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24036646]
DB2 Version 9.7 Fix Pack 9a for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24037559]
DB2 Version 9.7 Fix Pack 10 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24038641]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  User receives SQL0270N when attempting to ALTER or DROP TABLE:
   
   ALTER TABLE mytbl ALTER COLUMN c1 NOT NULL
   
   DB21034E  The command was processed as an SQL statement because
   it was not a valid Command Line Processor command.  During SQL
   processing it returned:
   SQL0270N  Function not supported (Reason code = "21").
   SQLSTATE=42997
   
   Reason code = "21" is defined as follows:
   
   A column cannot be dropped, or have its length, data type,
   security, or nullability altered on a table which is a base
   table for a materialized query table.
   
   Drop table fails with the following error:
   
   DROP TABLE mytbl
   DB21034E  The command was processed as an SQL statement because
   it was not a valid Command Line Processor command.  During SQL
   processing it returned:
   SQL0901N  The SQL statement failed because of a non-severe
   system error. Subsequent SQL statements can be processed.
   (Reason "Dependent MST's packed Descriptor not found".)
   SQLSTATE=58004
   
   What both errors are suggesting is that the table MYTBL has a
   materialized query table (MQT) defined against it. Still, this
   is not the case. All MQTs referencing the table were previously
   dropped. Indeed, db2look shows no MQTs defined against the said
   table (as expected).
   
   However, packed descriptor (PD) dump for MYTBL is still showing
   an MQT dependency:
   
             Dependent MST DESCRIPTION
             -------------------------
   
    Schema of the dependent Table     : ***
    Table name of the dependent Table : ***.***
    Refresh Option                    : Deferred
    MST type                          : Regular
    Isolation Level                   : 1
    Arithmetic Warning Level          : 78
    ...
   
   [contact DB2 Support for assistance with dumping and formatting
   table PD]
   
   The problem is that the table packed descriptor was not properly
   updated following the drop of MQT.
   
   
    
   
   

LOCAL FIX
 *  Contact DB2 Support for assistance with regenerating the table
   packed descriptor. This process will remove the leftover MQT
   dependency.
   
   Note: Once the table packed descriptor is regenerated by db2cat
   tool, you should be able to access the table again. But this is
   only a temporary fix. You would have to re-create the affected
   table by EXPORT, DROP and CREATE.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All                                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * See Error Description                                        *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Update to v9.7 Fix pack 7                                    *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Fixed in v9.7 Fix pack 7
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC81328
   
   
 * REPORTED COMPONENT NAME
   DB2 FOR LUW
   
   
 * REPORTED COMPONENT ID
   DB2FORLUW
   
   
 * REPORTED RELEASE
   970
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2012-02-09
   
   
 * CLOSED DATE
   2013-04-02
   
   
 * LAST MODIFIED DATE
   2013-06-28
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    IV15375 [http://www-01.ibm.com/support/docview.wss?uid=swg1IV15375]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 FOR LUW
   
   
 * FIXED COMPONENT ID
   DB2FORLUW
   
   

APPLICABLE COMPONENT LEVELS
 * R970 PSN
   UP