Title: IBM OA51271: STORAGE QUIESCE WITH MQ V8 AND MQI MONITORING AND CICS. 16/11/03 PTF PECHANGE - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  ERROR DESCRIPTION:Ø
   Users Affected:
   Customers using MQ Monitoring.  MQI Monitoring installed, MQ
   V8, CICS transactions
   
   Error Description:
   Handle mismatch of monitoring subsystem and agent.
   
   MQ Monitoring agent will eventually terminate due to storage
   quiesce.  The following message will be in agent log:
   
   KLVSQ000 QUIESCE MODE HAS BEEN ENTERED FOR CARVED EXTENDED
     STORAGE
   
   The dump will show an accumulation of KMQYMQAO control blocks.
   The number of in use and total blocks of size(993-1024) will
   increase over time.
   KLVSD004       SIZE(993-1024) USE(38674) TOTAL(38910)
   KLVSD004       SIZE(993-1024) USE(43074) TOTAL(43620)
   KLVSD004       SIZE(993-1024) USE(43316) TOTAL(43620)
   KLVSD004       SIZE(993-1024) USE(47625) TOTAL(47627)
   This problem is due to changes in MQ V8 for CICS transactions,
   CICS fast deallocate performance enhancement.  CICS end thread
   will not always go through deallocate broadcast for end thread
   in V8.  KMQ agent code currently relies on this deallocate call
   to clear the CICS active task block so without this call these
   active task blocks will not be freed.
   .
   Additional symptoms:
   ABN=0C4-00000004,CSQMPRH2,LOC=CSQMLPLM.CSQMPRH2+000458 or 000452
       ABEND0C4 ABENDS0C4 0C4 S0C4 S00C4 CSQMPRH2
    The failing instruction is D2FF A1A0 E000.
    IPCS ST FAILDATA or the Logrec data has
       AR/GR 14  00000002/00000000_nnnnnnnn
     where AR14=00000002 indicates home mode for the data. That
     means look at the R14 address in the Home ASID.
    The 0C4 may have Interrupt Code 10 due to a  mismatch in the
     keys for the PSW and storage or an Interrupt Code 4 due to R14
     not being available in the Home ASID.
   .
   5655W9700 R000
   
   
    
   
   

LOCAL FIX
 *  Issue the MQ command
     RECOVER QMGR(TUNE CICSFastDealloc OFF)
   (prefix it with "/cpf" without the quotes in SDSF, where "cpf"
   is the command prefix for the queue manager).
   
   This setting will not survive a queue manager restart, so
   include the command in a member in the CSQINP2 concatenation.
   
   Setting CICSFastDealloc OFF will disable a performance
   optimization introduced in MQ V8 which comes into play when
   CICS tasks and channels start and end.
   
   Once the command has been issued it will have immediate effect.
   Issuing the following command will revert back to the V8 way of
   doing things:
     RECOVER QMGR(TUNE CICSFastDealloc ON)
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All IBM Tivoli OMEGAMON XE for Messaging:    *
   *                 WebSphere MQ Monitoring 7.3.0 users.         *
   ****************************************************************
   * PROBLEM DESCRIPTION: MQ Monitoring agent will eventually     *
   *                      terminate due to storage quiesce.       *
   *                      The following message will be in        *
   *                      agent log:                              *
   *                      KLVSQ000 QUIESCE MODE HAS BEEN          *
   *                      ENTERED FOR CARVED EXTENDED STORAGE     *
   *                                                              *
   *                      The dump will show an accumulation      *
   *                      of KMQYMQAO control blocks.             *
   *                      The number of in use and total blocks   *
   *                      of size(993-1024) will increase.        *
   *                                                              *
   *                      KLVSD004       SIZE(993-1024)           *
   *                      USE(38674) TOTAL(38910)                 *
   *                      KLVSD004       SIZE(993-1024)           *
   *                      USE(43074) TOTAL(43620)                 *
   *                      KLVSD004       SIZE(993-1024)           *
   *                      USE(43316) TOTAL(43620)                 *
   *                      KLVSD004       SIZE(993-1024)           *
   *                      USE(47625) TOTAL(47627)                 *
   ****************************************************************
   * RECOMMENDATION: Apply this PTF.                              *
   ****************************************************************
   Storage Quiesce when MQIMONITOR installed with MQ V8 and
   CICS Transaction Workload.
   
   
    
   
   

PROBLEM CONCLUSION
 *  This problem is due to changes in MQ V8 for CICS
   transactions, CICS fast deallocate performance enhancement.
   CICS end thread will not always go through deallocate
   broadcast for end thread in V8.  KMQ agent code currently
   relies on this deallocate call to clear the CICS active task
   block so without this call these active task blocks will not
   be freed.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   OA51271
   
   
 * REPORTED COMPONENT NAME
   OMG XE MSG ZOS
   
   
 * REPORTED COMPONENT ID
   5608A1100
   
   
 * REPORTED RELEASE
   730
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   YesPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-09-14
   
   
 * CLOSED DATE
   2016-09-14
   
   
 * LAST MODIFIED DATE
   2017-01-09
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    OA51219 [http://www-01.ibm.com/support/docview.wss?uid=swg1OA51219]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UA82781
   
   

MODULES/MACROS
 *     KMQAMHSD KMQAMHST KMQAMQSB KMQASSIN KMQZDI1A
   KMQZDI1B KMQZDI1C KMQZDI1D KMQZDI1E KMQZDI1F KMQZDI1G KMQZDI1H
   KMQZDI1I KMQZDI1J KMQZDI1K KMQZDI1L KMQZDI1M
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   OMG XE MSG ZOS
   
   
 * FIXED COMPONENT ID
   5608A1100
   
   

APPLICABLE COMPONENT LEVELS
 * R730 PSY UA82781 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UA82781]
   UP16/11/14 P F611 «
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.