Title: IBM The /db2home instance home directory cannot be mounted by GPFS when failing back resources after a network failure - United States

Text:
IBM Smart Analytics System; ISAS; troubleshoot; GPFS; db2home; instance home; failover; failback; HA; high availability; TSA; Tivoli TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After a network failure on an active core warehouse node and during the failback and recovery process, the GPFS-shared /db2home file system cannot be mounted on the repaired node. 

SYMPTOM
After a network failure on an active core warehouse node, the GPFS-shared /db2home file system cannot be mounted on the repaired node when it is reintegrated into the cluster as part of the failback and recovery process. 

During the failback and recovery process, the network is restored and the resources on the failed node are reset. When you attempt to mount the /db2home file system on this node using the "mmmount /db2home" command, you will see an error message that indicates the /db2home file system is not available.


CAUSE
As part of the recovery process on the failed node, the "hareset" command uses the Tivoli Systems Automation for Multiplatforms (SAMP) "resetrsrc" command to clear the 'Stuck Online' state of the /db2home file system resource. The "resetrsrc" command brings the resource to an 'Offline' state and unmounts the /db2home mount point. When you issue a subsequent "mmmount" command to mount the /db2home file system, the GPFS software is unable to mount the /db2home file system.


ENVIRONMENT
IBM Smart Analytics System environments with IBM General Parallel File System (GPFS) 3.4.0.6 installed.



DIAGNOSING THE PROBLEM
The /db2home file system cannot be mounted as part of the recovery process after a network failure causes a node failover. 

During the recovery process if you issue the "mmmount" command, you will see an error message similar to the following:

Fri Nov 04 19:59:16 CDT 2011: 6027-1623 mmmount: Mounting file systems...
databcu001: GPFS: 6027-510 Cannot mount /dev/db2homefs on /db2home: A file, file system or message queue is no longer available.


You might also see the following error when you issue the "ls -l /db2home" command, which indicates that the /db2home file system does not exist: 


ls: 0653-341 The file /db2home does not exist.


RESOLVING THE PROBLEM
To resolve this problem, reboot the node that is unable to mount the /db2home file system. 

To prevent this problem from occurring when recovering the failed node, issue the following commands as root on the recovered node to clear the 'Stuck Online' state and re-mount the /db2home file system. 

1. Issue the following command to unmount the /db2home file system:
/usr/lpp/mmfs/bin/mmumount /db2home -f 

2. Verify that the /db2home file system exists:
ls -ld /db2home 

3. Issue the "hareset -online" command. 

4. Mount the /db2home file system on the active node:
/usr/lpp/mmfs/bin/mmmount /db2home