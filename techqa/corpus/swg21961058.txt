Title: IBM MustGather: Out of Memory & Suspected Memory Leak for MDM version 11 and higher - United States

Text:
MustGatherDocument; mustgather; mustgather; mustgather; Read first; readfirst; must gather; component; troubleshooting; trouble shooting; TopTenDocument; MustGatherReadFirstDocument; performance; slow; debug TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Collect troubleshooting data for memory related issues for InfoSphere Master Data Management (MDM) Standard Edition (SE) or Advanced Edition (AE). Gathering this information before calling IBM support will help familiarize you with the troubleshooting process, save you time and improve time to resolution. 

RESOLVING THE PROBLEM


Purpose of this document: To provide instructions for data collection during a performance test for InfoSphere MDM. Collect data for Out of Memory errors with IBM InfoSphere Master Data Management (MDM) Server Advanced Edition (AE) or Standard Edition (SE). Gathering this MustGather information before calling IBM Support will help familiarize you with the troubleshooting process and save you time. 






The information in this technote is in addition to MustGather: Read first Performance data collection for InfoSphere MDM [http://www.ibm.com/support/docview.wss?uid=swg21700894] Gathering general information section. 


 Section 1: JVM Memory Usage/GC logs 

The GC logs are helpful to understand heap memory usage over a period of time, overhead of GC etc. 

For an application running under WebSphere Application Server, Enable verbose GC using the WebSphere Application Server Administrator console. 
ApplicationServer->YourServer ->Process definition->Java Virtual Machine->Javaverbose GC (enabled)

In this case, the native_stderr.log contains the GC logs. This can be found in the same directory as other JVM logs (e.g. SystemOut.log)

For a standalone java application (e.g. BatchProcessor client for MDM) the GC logs can be generated by adding “–verbose:gc” option for JVM command line. The GC logs by default are written to stderr stream. These can be diverted to a specific log file by supplying JVM options. For example “-Xverbosegclog:/SOME_PATH/batch_gc.log” would save the logs to the specified path.


Section 2: JVM Thread dumps (Javacore)
Javadump produces files that contain diagnostic information related to the JVM and a Java application captured at a point during execution. For example, the information can be about the operating system, the application environment, threads, stacks, locks, and memory. By default, a Javadump occurs when the JVM terminates unexpectedly. A Javadump can also be triggered by sending specific signals to the JVM. Javadumps are human readable.

To generate the javacore (but no heapdump) at user signal, add the JVM option -Xdump:java to java command line (generic JVM arguments on WAS admin console)

To signal the JVM, you can use the following on AIX and Linux

kill -3 <PID of JVM Process>

By default, the javacore files are generated under the <PROFILE_HOME> directory. For example. /usr/IBM/WebSphere/AppServer/profiles/AppSrv01/



Section 3: JVM Heapdumps 


Heapdumps contains a dump of live objects in the java heap at that moment. This dump is stored in a Portable Heap Dump (PHD) file, a compressed binary format. By default, a Heapdump is produced when the Java heap is exhausted. A hepdump can also be triggered by sending specific signals to the JVM. 

To generate the heapdump (and javacore) at user signal, add the JVM option -Xdump:heap to java command line (generic JVM arguments on WAS admin console)

To signal the JVM, you can use the following on AIX and Linux 

kill -3 <PID of JVM Process>

By default, the heapdumps are generated under the <PROFILE_HOME> directory. For example. /usr/IBM/WebSphere/AppServer/profiles/AppSrv01/


Section 4: MDM Service Activity Monitor (SAM) 


SAM is a very lightweight feature, to get high level picture of every transaction in MDM. By default, the output goes to transactiondata*.log. The default location is the same directory as the WebSphere Application Server SystemOut.log file. SAM logs have one line per transaction, with comma separated entries. 

To enable SAM do the following:
1. Change configelement table
update configelement set value='true',LAST_UPDATE_DT=current_timestamp where name in ('/IBM/DWLCommonServices/Report/Listener/enabled','/IBM/DWLCommonServices/Report/Broadcaster/enabled')

2. Change the properties files in properties.jar. You would need to extract the files in a temp folder, edit the files as specified below, and then recreate the jar file.

Locate the properties.jar (example shown below)

USER_INSTALL_ROOT/installedAssets/com.ibm.mdm.server.resources.properties-E001.jar/BASE/com.ibm.mdm.server.resources.properties-E001.jar 

There are two properties inside the jar file that need to be changed for the following purpose:

a. Modify the file called sam.properties for fields to be logged. For example, the "sam.reports" entry in sam.properties should be set as follows for performance troubleshooting (Note: the following is ONE line, no carriage returns): 

sam.reports=transactionName,requestName,requesterName,clientTransactionName,sessionId,transactionId,requestID,responseSize,transactionStatus,startDateTime,endDateTime,executionTime,sam_NumberOfInsert,sam_TotalTimeOfInsert,sam_MostExpensiveInsertTime,sam_NumberOfUpdate,sam_TotalTimeOfUpdate,sam_MostExpensiveUpdateTime,sam_NumberOfDelete,sam_TotalTimeOfDelete,sam_MostExpensiveDeleteTime,sam_NumberOfSelect,sam_TotalTimeOfSelect,sam_MostExpensiveSelectTime,sam_SuspectProcessingFlag,sam_SuspectPoolSize,sam_NumberOfA1,sam_NumberOfA2,sam_NumberOfB,sam_NumberOfC

b. Make changes for location and size of the log files. The out of box settings are generally sufficient for normal use. If you expect too may transactions during your tests, then increase the logging space. 

The log settings for this file are in JDKLog.properties under properties.jar file

com.dwl.base.report.mbean.TransactionDataListener.handlers=com.dwl.base.logging.handlers.TransactionDataListenerFileHandler
com.dwl.base.report.mbean.TransactionDataListener.useParentHandlers=false
com.dwl.base.logging.handlers.TransactionDataListenerFileHandler.formatter=com.dwl.base.logging.formatters.SimpleFormatter
com.dwl.base.logging.handlers.TransactionDataListenerFileHandler.encoding=UTF-8
com.dwl.base.logging.handlers.TransactionDataListenerFileHandler.limit=100000000
com.dwl.base.logging.handlers.TransactionDataListenerFileHandler.count=10
com.dwl.base.logging.handlers.TransactionDataListenerFileHandler.pattern=./logs/ MY_SERVER /transactiondata.n%g.log
com.dwl.base.logging.handlers.TransactionDataListenerFileHandler.append=true

3. Enable the logging in IBM WebSphere Application Server Administrator console. 

Set the log and trace settings under the following menu:
ApplicationServer-> Troubleshooting-> Logs & Trace -> [MY_SERVER]-> Diagnostic Trace -> Change log detail levels 

Change “general properties” to include the following level

com.dwl.base.report.mbean.TransactionDataListener=fine

If this change in made in “configuration” tab, the change is permanent but requires a restart of MDM. 
If it done in the “runtime” tab, then it is effective immediately, but changes are lost after a restart. 

4. An MDM restart is required for steps 1 and 2 above to be effective. While for step 3, it is needed if you changed the “configuration” tab.


Section 5: DB Layer Monitoring (Optional) 

A. Applicable to DB2 on LUW

Collect a snapshot for the test duration, by running the commands as below on a db2 prompt
1. Start the monitoring 
db2 connect to MYDB
db2 -v reset monitor all
db2 -v update monitor switches using bufferpool on sort on lock on statement on table on uow on timestamp on
db2 -v get monitor switches

2. Run you tests

3. After the tests are over, run the following 
db2 -v get snapshot for all on MYDB > MySnapShot.out
db2 -v update monitor switches using bufferpool off sort off lock off statement off table off uow off timestamp off
db2 -v terminate

B. Applicable to DB2/Z
1. Collect SMF reports basic accounting class 1,2,3,7,8 and statistics class 1,3,4,5,6
Note: The accounting and statistics traces do not have real overhead and recommended to be turn on even in production environment.

db2 accounting classes 1,2,3,7,8 long format report
-START TRACE(A) CLASS(1,2,3,7,8) DEST(SMF)
db2 statistics classes 1,3,4,5,6 report
-START TRACE(S) CLASS(1,3,4,5,6) DEST(SMF)

2. RMF reports – I/O details and CPU utilization (RMF summary report)

3. To see the text of the SQL statements and associated statistics for those dynamic SQL statements, please enable dynamic statement caching first on your DB2 for z/OS subsystem by setting zparm CACHEDYN=YES, then start IFCID 316, 317, and 318. 

DNC collection instructions:
a. START TRACE(P) CLASS(30) IFCID(316,317,318) DEST(SMF)
b. run test
c. check and clean Dynamic cache tables 
DELETE FROM DSN_STATEMENT_CACHE_TABLE
d. extract all statements from the global cache and to dump the statistics information to DSN_STATEMENT_CACHE_TABLE
EXPLAIN STMTCACHE ALL 
e. select to the file inserted rows from the DSN_STATEMENT_CACHE_TABLE table
f. Important: Stopping the trace will reset all statistics. It is important to complete the steps 3-5 before turning off the monitor trace.
g. STOP TRACE(P) CLASS(30) IFCID(316, 317, 318)

C. Applicable to Oracle
1. Collect AWR report covering the entire duration for main test (only).


RELATED INFORMATION
 MustGather: Read first Performance data collection for [http://www-01.ibm.com/support/docview.wss?uid=swg21700894]




PRODUCT ALIAS/SYNONYM
 Master Data Management
MDM
InfoSphere IBM Master Data Management
InfoSphere IBM Master Data Management Server
MDM Server