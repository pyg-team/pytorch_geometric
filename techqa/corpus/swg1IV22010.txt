Title: IBM IV22010: LINUX OS AGENT TERMINATES DUE TO SIGHUP SIGNAL - United States

Text:
  FIXES ARE AVAILABLE
IBM Tivoli Monitoring 6.2.3 Fix Pack 5 (6.2.3-TIV-ITM-FP0005) [http://www-01.ibm.com/support/docview.wss?uid=swg24035801]
IBM Tivoli Monitoring 6.2.3 Fix Pack 2 (6.2.3-TIV-ITM-FP0002) [http://www-01.ibm.com/support/docview.wss?uid=swg24032429]
IBM Tivoli Monitoring 6.2.3 Fix Pack 4 (6.2.3-TIV-ITM-FP0004) [http://www-01.ibm.com/support/docview.wss?uid=swg24034252]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Problem Description: the Monitoring Agent for Linux OS
   terminates due to SIGHUP signal if agent is started using the
   following command with -t option:
         ssh -t -p 22 root@XXXX "/etc/init.d/ITMAgents1 stop &&
         /etc/init.d/ITMAgents1 start && /opt/IBM/ITM/bin/cinfo -r"
   
   NOTE:
   This issue is NOT specific to starting the agent through a
   remote session using "ssh".
   This issue is NOT specific to using the -t option on the
   start command.
   
   The LZ agent can also terminate due to a SIGHUP signal
   being received on reboot, which will result in a
   termination of the Linux OS agent with no indication
   in RAS1 logs or other diagnostic logs that a signal has
   been received.
   The LZ agent CAN be started successfully and remain
   running when running either the autostart script after
   the OS initializes (ITMAgents#), or running
   "itmcmd agent start lz".
   
   There will be NO tracepoint from "signalmanager.cpp"
   indicating that the agent received a termination signal.
   
   The LZ agent will only run for a few seconds before
   the LZ agent shuts down.
   
   The .LG0 and RAS1 logs will show what appears to be a
   controlled shutdown / termination:
   In the .LG0:
   KRARMN000 IRA rmt server shutting down.
   
   In RAS1 logging:
   -1:kraafmn.cpp,384,"kramain") Exit: 0x0
   -1:klzmain.cpp,458,"CtMain") kramain returned
   -1:klzmain.cpp,459,"CtMain") Exit: 0x0
   -1:klzmain.cpp,102,"stop_exit") Active RAS1 Classes: EVERYT
   EVERYE EVERYU
   -1:klzmain.cpp,102,"stop_exit") Entry
   -1:kraafmgr.cpp,2291,"IRA_Shutdown") Active RAS1 Classes: EVERYT
   EVERYE EVERYU
   -1:kraafmgr.cpp,2291,"IRA_Shutdown") Entry
   -1:kraafmgr.cpp,2293,"IRA_Shutdown") Shutting down agent remote
   manager.
   
   Reproducing to set KBB_SIG1=-dumpoff will NOT result
   in a core being generated.
   
   Code analysis had to be performed to determine that the
   reason the agent was shutting down was due to the
   rpc__listen() thread exiting.
   
   The issue is NOT readily reproducible in lab testing.
   A diagnostic module had to be built to gather further
   information as well as concurrent "strace" outputs
   to understand what was happening when the
   rpc__listen() threads were exiting on the start
   attempt during reboot.
   
   The strace was necessary to confirm that a SIGHUP was
   being received.
   This APAR is also available in an interim fix based on
   6.22 FP5 level:
   6.2.2.5-TIV-ITM_LINUX-IF0001
   
   
    
   
   

LOCAL FIX
 *  Do not use -t option (only applies when using "ssh")
   
   
    
   
   

PROBLEM SUMMARY
 *  Linux OS Agent terminates due to sighup signal.
   
   
   The Monitoring Agent for Linux OS terminates due to unhandled
   SIGHUP signal if agent is started remotely using ssh -t as
   follows:
   
   ssh -t -p 22 root@XXXX "/etc/init.d/ITMAgents1 stop &&
   /etc/init.d/ITMAgents1 start && /opt/IBM/ITM/bin/cinfo -r"
   
   
    
   
   

PROBLEM CONCLUSION
 *  The code was changed to handle the signal.
   
   The fix for this APAR is going to be included in the following
   maintenance vehicle:
       | fix pack | 6.2.3-TIV-ITM-FP0002
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV22010
   
   
 * REPORTED COMPONENT NAME
   ITM AGENT LINUX
   
   
 * REPORTED COMPONENT ID
   5724C04LN
   
   
 * REPORTED RELEASE
   622
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2012-06-01
   
   
 * CLOSED DATE
   2012-06-25
   
   
 * LAST MODIFIED DATE
   2015-09-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   ITM AGENT LINUX
   
   
 * FIXED COMPONENT ID
   5724C04LN
   
   

APPLICABLE COMPONENT LEVELS
 * R622 PSY
   UP
   
   
 * R623 PSY
   UP