Title: IBM Controller Web gives wrong URL (http://servername/fcm.web/basicspa) when using SSL offloading (via Load Balancer) - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Customer has deployed Controller Web using a Network Load Balancer (network appliance) in front of the Controller application server.

When the user tries to connect to Controller Web (via the NLB) they get redirected to the wrong address (incorrect URL). 

SYMPTOM
Imagine a scenario where: 

 * There are two Controller application servers (called "server1" and "server2").  * These reside on the secure 'LAN' 
    * They are each running Controller Web, which is delivering the website via HTTP (default) using the default TCP port settings 
    * Therefore, internal (LAN) users can successfully connect to Controller Web via the following URLs:  * http://server1:9080/fcm.web/login [http://server1:9080/fcm.web/login] 
       * http://server2:9080/fcm.web/login [http://server2:9080/fcm.web/login]
      
      
   
   
 * Customer then configures a Network Load Balancer (network device) in front of those servers  * For example, it may be inside the DMZ
   
   
 * The NLB is configured to load balance the two Controller Web servers, via a single virtual DNS name  * In other words, it has a virtual DNS name (for example "controllerwebalias.company.com") which it then reroutes traffic to the backend servers (either "server1" or "server2")
   
   
 * The NLB is configured to perform SSL offload  * Specifically, if a user launches this website: https://controllerwebalias.company.com:443/fcm.web/login [https://controllerwebalias.company.com:9080/fcm.web/login]
   
   
   ...then it should automatically route all those requests to here: http://server1:9080/fcm.web/login [http://server1:9080/fcm.web/login] or http://server2:9080/fcm.web/login [http://server2:9080/fcm.web/login]


However, in reality, when the user launches https://controllerwebalias.company.com:443/fcm.web/login [https://controllerwebalias.company.com:9080/fcm.web/login] then the following symptom occurs: 

 * The initial Controller Web splash screen appears successfully (it all appears OK to begin with) 
 * If Controller is secured by Cognos CAM authentication, then this CAM logon screen successfully appears (and users can logon to it) 
 * However, immediately after logging on, the user is redirected to the wrong website, specifically: http://controllerwebalias.company.com/fcm.web/basicspa [http://controllerwebalias.company.com/fcm.web/basicspa]


As you can see, this new website has lost the SSL portion (it is HTTP instead of HTTPS). 

 * In addition, it is attempting to open a non-existent sub-path ("basicspa", which does not exist). Therefore it will generate a 404 error (Page Cannot Be Found).


CAUSE
In some environments, it is necessary to configure Controller Web to perform the SSL offload (not the NLB). 


More Information: 

IBM does not directly support load balancers (NLB / ELB). Specifically: 

 * It is possible to configure load balancers to work with Controller Web  * However, IBM cannot offer direct support on how to configure specific third-party load balancers (to work with Controller).
   
   
 * If any problems occur, then IBM request that customers work with their third-party (non-IBM) suppliers (the makers of the network appliance) to solve any issue that arises 
 * If the customer gets an error/problem when using a network appliance, IBM reserves the right to ask the customer to reproduce the problem without using the network appliance (such as load balancer).


Load Balancing should work (for Controller Web) so long as the session affinity feature of the load balancer is enabled (requests sent during a particular user session will be sent to the same application server). 

 

Also, it is possible to configure HTTPS/HTTP communication (via a third-party network appliance, such as an NLB). The customer can choose to either: 

(a) have the Load Balancer perform the SSL offload 

or (b) configure the Controller Web to perform the SSL offload (directly on the application server itself), and therefore simply forward the HTTPS requests from the NLB to Controller Web). 

 * In some environments, only (b) works successfully.

ENVIRONMENT
Controller Web is being deployed to end users via a network device (such as a Network Load Balancer / NLB). 

 * The problem only occurs when the NLB is configured to perform SSL offloading (in other words, it converts HTTPS requests from external network, into HTTP requests to the internal LAN network).

RESOLVING THE PROBLEM
Reconfigure the NLB/Controller Web environment. 

 

Example: 

In one real-life customer example, the solution was to reconfigure both Controller Web servers (server1 & server2) to use HTTPS (not HTTP). 

 * Specifically, both Controller Web servers were configured to use the same SSL certificate as the NLB appliance.


TIP: For more information on how to configure Controller Web to use SSL (HTTPS), see separate IBM Technote #1998458. RELATED INFORMATION
 1998458 - How to configure Controller Web to use SSL (H [http://www.ibm.com/support/docview.wss?uid=swg21998458]