Title: IBM DataPower 9235 appliance may restart due to Baseboard Management Controller (BMC) communications loss - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 A 9235 appliance may restart or in rare cases the boot up may not complete due to Baseboard Management Controller (BMC) communications loss. 

CAUSE
NOTE: DataPower highly recommends upgrading to a version containing the fix for APAR IC80983 

A DataPower 9235 appliance may be restarted without a back trace by its hardware watchdog due to a Baseboard Management Controller (BMC) communications loss. 

This also rarely causes a failure to restart successfully. 

If a failure to restart occurs, the appliance needs to be manually power cycled by removing and then replacing the power cords.


DIAGNOSING THE PROBLEM
Due to the potential impact of this problem, DataPower highly recommends upgrading to a version containing the fix for APAR IC80983. 


To check if your system may be susceptible to this issue check the output of these commands:


 * 
 * 
 * 


If the BMC version listed is below 0.29 we highly recommend upgrading [http://www-01.ibm.com/support/docview.wss?uid=swg21237631]to install the fix for this issue as outlined below. 

The fix was first included in the 3.8.1.20, 3.8.2.11, 4.0.1.8, and 4.0.2.4 fixpacks. Please install [http://www-01.ibm.com/support/docview.wss?uid=swg21237631]this fixpack level or higher. 

Note: Due to the nature of this issue the upgraded BMC level will remain installed even if downgraded to levels of the 3.8.1, 3.8.2, 4.0.1,and 4.0.2 firmware below the 3.8.1.20, 3.8.2.11, 4.0.1.8, and 4.0.2.4 fixpacks. 


RESOLVING THE PROBLEM
Follow these steps to upgrade the 9235 appliance to a firmware level containing the new BMC firmware level to resolve this issue. 



1. Stop traffic to the appliance and gather the output of the following CLI commands: 


 * 
 * 
 * 


Note the "BMC Firmware Version" 

2. If the BMC level is displayed perform a reboot of the appliance to free resources and proceed to the next step (step 3). 

If the BMC version is not displayed, power off and unplug the power cords for 30 to 60 seconds then connect the power and boot the appliance. When the appliance boots, check the output again to ensure the BMC version is displayed if not repeat the power off and unplug. 

3. Upload the firmware image to the appliance and perform the "Boot Image". For questions on upgrading firmware see our Upgrade Knowledge Collection [http://www.ibm.com/support/docview.wss?uid=swg27015333&loc=en_US&cs=utf-8&lang=en] 

4. When the automatic reboot is complete collect the outputs for the same commands from step one. Note the BMC version should now be 0.29 or higher 

5. To clear the old impi entries from the logs issue the following: 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 


**Note: The commands "clear-ipmi-sel" and "show ipmi" are not present in version 3.8.1.20 firmware. 

If there are any issues contact DataPower Support [http://www.ibm.com/support/docview.wss?uid=swg21236322] and include the following information:  * 
 * 
 * 
 * show clock 
   show ipmi 
   show filesystem 
   config 
   service show component-firmware 



Note: As stated above, due to the nature of this issue the upgraded BMC level will remain installed even if downgraded to levels of the 3.8.1, 3.8.2, 4.0.1,and 4.0.2 firmware below the 3.8.1.20, 3.8.2.11, 4.0.1.8, and 4.0.2.4 fixpacks. 

The document "Supported firmware versions and recommended upgrade levels for IBM WebSphere DataPower SOA Appliances" [http://www-01.ibm.com/support/docview.wss?uid=swg21237631] contains links to the latest firmware releases.  


Cross reference information Segment Product Component Platform Version Edition Business Integration WebSphere DataPower B2B Appliance XB60 4.0.2, 4.0.1, 4.0, 3.8.2, 3.8.1, 3.8 All Editions Business Integration WebSphere DataPower Low Latency Appliance XM70 3.8, 3.8.1, 3.8.2, 4.0, 4.0.1, 4.0.2 All Editions Business Integration WebSphere DataPower XML Security Gateway XS40 4.0.2, 4.0.1, 4.0, 3.8.2, 3.8.1, 3.8 All Editions Business Integration WebSphere DataPower XML Accelerator XA35 4.0.2, 4.0.1, 4.0, 3.8.2, 3.8.1, 3.8