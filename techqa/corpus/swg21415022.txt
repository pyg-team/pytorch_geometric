Title: IBM fnc_shmat failed error causes IBM FileNet IDM Web Services to hang - United States

Text:
fnc_shmat; shmat TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Intermittently, IDM Web Services will stop responding to user input, and will no longer be able to communicate with an IBM Filenet Image Services server. There will be an error in the WAL log stating either fnc_shmat failed or shmat failed. 

SYMPTOM
The error will look something like: 

 * 
 * 
 * 
 * 


Alternatively, the error may show: 
 * 
 * 
 * 


CAUSE
Some Microsoft updates conflict with shared memory addresses used by IDM Web Services, causing it to stop responding.

ENVIRONMENT
IDM Web Services connecting to an Image Services server



RESOLVING THE PROBLEM
To resolve this issue, first try the following: 

 1. Close all IDM Web Services processes and open the Windows Registry Editor by entering regedit in the Run dialog box. 
 2. Locate the HKEY_LOCAL_MACHINE\SOFTWARE\FileNet\WAL\CurrentVersion folder. 
 3. Right click on CurrentVersion and choose New, DWORD Value. 
 4. Change the name of this DWORD value to StartShmAddress and double-click it to enter a value. 
 5. Click Hexadecimal in the base area and change the value to 23000000. 
 6. Click OK and restart the server to apply the changes.


If the error continues to occur: 
 1. In the WAL log, look for the following entry listed a few lines after the error itself, which gives the name and location of a stack trace file.
    2009/11/12 09:56:51.384 202,0,27 <ab123456> c:\winnt\system32\inetsrv\w3wp.exe -a \\.\pipe\iisipm0e6d7ff3-15a7-408f-a2af-93 (912.7744.0 0x390.1e40) ... [INFO]
    fn_stack_trace: stack trace saved in file
    'C:\Apps\FileNet\FNSW\client\logs\stack_abort_912_7744.txt'
    
 2. In the stack_abort file, locate the line with the format like the following. In some cases, this will be the last line. However, if there are multiple lines that look like this, it will be the first line that specifically ends with err=126.
    SymFromAddr failed addr=0x247027a1 err=126
    
 3. Note the address in hex, and select a round number about 2000000 in hex up from that. For the above example, a good value would be 27000000.
    
 4. Change the StartShmAddress value set in the previous procedure to the new value.
    
 5. Restart the server.
    
 6. If the error continues, repeat the above, calculating new values as determined by the new address being posted in the stack_abort file.