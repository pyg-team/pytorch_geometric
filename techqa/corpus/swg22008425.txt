Title: IBM DB2 archive sessions taking a long time to complete - United States

Text:
volhist perf mount vtl TECHNOTE (FAQ)

QUESTION
 The DB2 archive logging sessions are taking 10x longer to complete than previously. What could be causing the delay? 

CAUSE
Large number of entries in volume history leads to performance degradation when processing sequential media

ANSWER
There are a variety of things that can cause poor performance to occur for a session. In this case, the problem was due to the mount processing on the IBM Spectrum Protect Server. The performance outputs (servermon) showed the parent thread for the session with a significant amount of time in 'TM Lock Wait'. Additionally, the IBM Spectrum Protect Server actlog shows the session mounts the volume, but then can wait several minutes until the session opens the volume. For example: 

 * 
 * 
 * 
 * 


Further investigation of the locks shows a significant number of waiters within asvolacq.c, which is the module for the volume processing on the IBM Spectrum Protect server. 

A select against the number of entries in the volhist file: 
select count(*) as Volumes_in_VolHist from volumehistory 
show a very large number, in this case over 1 million entries. 

As noted in APAR IC72761 [http://www-01.ibm.com/support/docview.wss?uid=swg1IC72761], it is necessary to manually prune the volhistory file to keep the number of entries manageable. Poor performance can be seen when there are a large number of entries that need to be searched during the volume processing. It is recommended to only keep a few weeks of entries for the STGNEW, STGDELETE, and STGREUSE. Problems have been seen when the number of entries in the volhist exceeds 400,000, but can potentially be witnessed even with fewer entries. 

PRODUCT ALIAS/SYNONYM
 TSM