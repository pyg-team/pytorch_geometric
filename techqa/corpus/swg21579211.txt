Title: IBM Receiving GSK_ERROR_BAD_CERT error. - United States

Text:
NFS; redirection; redirect; SimpleSRM; r_gsk_secure_soc_init; GSK_ERROR_BAD_CERT; gsk TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Following error is received logging into SimpleSRM UI using NFS redirection:
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: lib_stream: openStream: Failed in r_gsk_secure_soc_init: GSK_ERROR_BAD_CERT(gsk rc = 414) 

SYMPTOM
Following message are received in the plugin.log on the NFS server: 

[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: lib_stream: 
openStream: Failed in r_gsk_secure_soc_init: GSK_ERROR_BAD_CERT(gsk rc = 
414) 
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: ws_common: 
websphereGetStream: Could not open stream 
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: ws_common: 
websphereExecute: Failed to create the stream 
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: ws_common: 
websphereHandleRequest: Failed to execute the transaction to 
'ctgNode01_MXServer'on host 'IBM09978.raleigh.ibm.com'; will try another 
one 
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: ws_common: 
websphereWriteRequestReadResponse: Failed to find an app server to 
handle this request 
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: ESI: getResponse: 
failed to get response: rc = 2 
[Sun Jan 22 23:31:24 2012] 000045d2 ed5a9ba0 - ERROR: ws_common: 
websphereHandleRequest: Failed to handle request 


RESOLVING THE PROBLEM
A possible solution for this problem is: 


1.) On the NFS server, asked customer to back up the plugin-cfg.xml file and update it to change the LogLevel="Error" to LogLevel="Trace". File is located in: 
/opt/IBM/HTTPServer/Plugins/config/cloudburst-http/ 

This will generate log entries that actually give the serial number of the certificate that is missing from the signer section of the keystore and will show what WAS backend server the plugin is routing the request 
to. The serial number will appear in hex format in the plugin log. Entering this value in Windows calc.exe can convert the value to decimal to see the serical number that appears in the WAS Admin Console of the TSAM server.

You will need to Restart IBM HTTP Server: 
/opt/IBM/HTTPServer/bin/apachectl restart 

2.) Run through the problem scenario to get the serial number in the plugin log. The message will look similar to the following: 
[Wed Jan 25 08:42:14 2012] 00000779 f4e94ba0 - TRACE: lib_stream: openStream: PARTNER CERTIFICATE DN=CN=IBM09978.raleigh.ibm.com,O=IBM,C=US,Serial=12:6b:77:6f:d0:28:99:e0 
[Wed Jan 25 08:42:14 2012] 00000779 f4e94ba0 - ERROR: lib_stream: openStream: Failed in r_gsk_secure_soc_init: GSK_ERROR_BAD_CERT(gsk rc = 414) 

NOTE: Serial=12:6b:77:6f:d0:28:99:e0 

If you take 126b776fd02899e0 (in hex) and convert to decimal, you will get 1327285837308140000. 

3.) On the TSAM server, login to WAS as wasadmin 
- Go to Security > SSL certificate and key management.
- Click the Manage endpoint security configurations link.
- Expand Inbound, expand the cell name (ctgCell01) to see the list of nodes. 
- Expand Nodes and Select ctgNode01 
- Click on Key Stores and certificates 
- Select CellDefaultTrustStore 
- Click on Signer Certificates 
- Extract IBM09978_alias (should match the above serial number: 1327285837308140000)
- copy the extracted file to NFS server 

4.) On the NSF server start IBM Key Management program: 
/opt/IBM/HTTPServer/bin/ikeyman 
- open plugin_key.kdb in: 
/opt/IBM/HTTPServer/Plugins/etc/plugin-key.kdb 
(note that the default password is WebAS) 
- Select Signer Certificates and Add the extracted file in step 3. 

5.) Restart IBM HTTP Server 
/opt/IBM/HTTPServer/bin/apachectl restart 




Cross reference information Segment Product Component Platform Version Edition Systems and Asset Management IBM Service Delivery Manager AIX, Linux 7.2.2 Business Integration IBM CloudBurst AIX, Linux 1.2, 2.1