Title: IBM FileNet Content Engine Full Text Searches under high concurrency return a StringIndexOutOfBounds error - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 
CBR based queries (full text search) with the FileNet P8 Content Engine may fail under load with a "StringIndexOutOfBounds" error. This problem appears with DB2 JDBC driver 4.8.87 and WebSphere 7.0.0.15 and 7.0.0.17 with JRE 1.6.0 IBM J9.


SYMPTOM
 

The following exception will appear in the Content Engine log and be thrown to the requesting search client: 


2011-06-25T04:00:22.918Z 73057305 ENG FNRCE0066E - ERROR method name: executeSearch principal name: user_86 Global Transaction: false User Transaction: false Exception Info: An unexpected exception occurred. The unexpected exception is chained to this exception.
com.filenet.api.exception.EngineRuntimeException: FNRCE0066E: E_UNEXPECTED_EXCEPTION: An unexpected exception occurred. The unexpected exception is chained to this exception.
at com.filenet.engine.jca.impl.RequestBrokerImpl.executeSearch(RequestBrokerImpl.java:914)
at com.filenet.engine.jca.impl.RequestBrokerImpl.executeSearch(RequestBrokerImpl.java:817)
at com.filenet.engine.ejb.EngineCoreBean._executeSearch(EngineCoreBean.java:318)
at com.filenet.engine.ejb.EngineCoreBean.executeSearch(EngineCoreBean.java:286)
at com.filenet.engine.ejb.EJSLocalStatelessEngineCore_22877cb1.executeSearch(Unknown Source)
at com.filenet.engine.ejb.EngineBean.executeSearch(EngineBean.java:536)
at com.filenet.apiimpl.transport.ejbstubs.EJSRemoteStatelessEngine_2e64c374.executeSearch(Unknown Source)
at com.filenet.apiimpl.transport.ejbstubs._EJSRemoteStatelessEngine_2e64c374_Tie.executeSearch__com_filenet_apiimpl_transport_SearchRequest__com_filenet_apiimpl_transport_ClientCallContext(_EJSRemoteStatelessEngine_2e64c374_Tie.java:266)
at com.filenet.apiimpl.transport.ejbstubs._EJSRemoteStatelessEngine_2e64c374_Tie._invoke(_EJSRemoteStatelessEngine_2e64c374_Tie.java:118)
at com.ibm.CORBA.iiop.ServerDelegate.dispatchInvokeHandler(ServerDelegate.java:623)
at com.ibm.CORBA.iiop.ServerDelegate.dispatch(ServerDelegate.java:476)
at com.ibm.rmi.iiop.ORB.process(ORB.java:513)
at com.ibm.CORBA.iiop.ORB.process(ORB.java:1574)
at com.ibm.rmi.iiop.Connection.respondTo(Connection.java:2845)
at com.ibm.rmi.iiop.Connection.doWork(Connection.java:2718)
at com.ibm.rmi.iiop.WorkUnitImpl.doWork(WorkUnitImpl.java:63)
at com.ibm.ejs.oa.pool.PooledThread.run(ThreadPool.java:118)
at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1604)
Caused by: java.lang.StringIndexOutOfBoundsException
at java.lang.String.<init>(String.java:306)
at com.ibm.db2.jcc.am.ic.d(ic.java:1967)
at com.ibm.db2.jcc.am.ic.n(ic.java:485)
at com.ibm.db2.jcc.am.ic.W(ic.java:1903)
at com.ibm.db2.jcc.am.km.g(km.java:1399)
at com.ibm.db2.jcc.am.km.getObject(km.java:1378)
at com.ibm.ws.rsadapter.jdbc.WSJdbcResultSet.getObject(WSJdbcResultSet.java:1920)
at com.filenet.engine.dbpersist.DBResult.getRows(DBResult.java:324)
at com.filenet.engine.dbpersist.DBResult.nextRow(DBResult.java:350)
at com.filenet.engine.retrieve.AdHocClassRetriever.loadObject(AdHocClassRetriever.java:5101)
at com.filenet.engine.retrieve.AdHocClassRetriever.doSearchImpl(AdHocClassRetriever.java:1642)
at com.filenet.engine.retrieve.AdHocClassRetriever.doSearch(AdHocClassRetriever.java:1201)
at com.filenet.engine.retrieve.AdHocClassRetriever.executeSearch(AdHocClassRetriever.java:732)
at com.filenet.engine.jca.impl.RequestBrokerImpl.executeSearch(RequestBrokerImpl.java:895)
... 17 more


CAUSE
 

The root cause of this problem is a bug in the optimization performed by the Java just in time compiler (JIT).



ENVIRONMENT
This problem appears with DB2 JDBC driver 4.8.87 and WebSphere 7.0.0.15 and 7.0.0.17 with JRE 1.6.0 IBM J9.



DIAGNOSING THE PROBLEM
 

Look in Content Engine log file for the "StringIndexOutOfBoundsException" where the reporting method is identified as a search: 

"ERROR method name: executeSearch"



RESOLVING THE PROBLEM
 

It is possible to work around this problem by disabling the JIT optimization for the problem area. The following command line argument may be added to the JVM arguments of the application server: 


-Xjit:{com/ibm/db2/jcc/am/ic*}(optLevel=noOpt) 

 

Worth noting is this part of the error: 


Caused by: java.lang.StringIndexOutOfBoundsException
at java.lang.String.<init>(String.java:306)
at com.ibm.db2.jcc.am.ic.d(ic.java:1967)
at com.ibm.db2.jcc.am.ic.n(ic.java:485)
at com.ibm.db2.jcc.am.ic.W(ic.java:1903) 

 

The class path may be obfuscated to different names depending on the DB2 driver version. In this case, the "ic" class listed three times in the stack may have a different name and therefore you may need to consider this in the "-Xjit" option used.