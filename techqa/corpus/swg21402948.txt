Title: IBM LTPA token expirations in a clustered environment can affect EJB calls and lead to Home page search failing to index Lotus Connections content - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
Home page search works as follows in a clustered environment. The cluster is started and a Home page server acquires a lease and indexes the content in Lotus Connections. When the server finishes indexing, the lease may be acquired by a subsequent Home page server. This server may fail to index due to the following exception: 

0000014c AlarmListener E SCHD0063E: A task with ID 51 failed to run on Scheduler LotusConnectionsScheduler 
(scheduler/homepage) because of an exception: 
com.ibm.websphere.scheduler.UserCalendarInvalid: SCHD0013E: The 
following error occurred while accessing the UserCalendar with JNDI 
Name 
com/ibm/websphere/scheduler/calendar/DefaultUserCalendarHome and 
specifier CRON : SCHD0137E: Unable to create EJB instance for 
UserCalendar: java.rmi.AccessException: CORBA NO_PERMISSION 
0x49424306 
No; nested exception is: 
org.omg.CORBA.NO_PERMISSION: JSAS0202E: [{0}] Credential token 
expired. 
{1} vmcid: 0x49424000 minor code: 306 completed: No SCHD0140I: 
EJB 
information: Host: <servername> (1.40.33.112), Port: 9,900, J2EE 
component: SchedulerCalendars#Calendars.jar#DefaultUserCalendar.. 

This exception is preceded by the following warnings:

[6/5/09 11:39:52:699 EDT] 00000090 LTPAServerObj W SECJ0371W: Validation of the LTPA token failed because the token expired with the following info: Token expiration Date: Thu Jun 04 07:46:57 EDT 2009, current Date: Fri Jun 05 01:39:52 EDT 2009


SYMPTOM
The Home page server may fail to index due to the following exception: 


0000014c AlarmListener E SCHD0063E: A task with ID 51 failed to run on Scheduler LotusConnectionsScheduler 
(scheduler/homepage) because of an exception: 
com.ibm.websphere.scheduler.UserCalendarInvalid: SCHD0013E: The 
following error occurred while accessing the UserCalendar with JNDI 
Name 
com/ibm/websphere/scheduler/calendar/DefaultUserCalendarHome and 
specifier CRON : SCHD0137E: Unable to create EJB instance for 
UserCalendar: java.rmi.AccessException: CORBA NO_PERMISSION 
0x49424306 
No; nested exception is: 
org.omg.CORBA.NO_PERMISSION: JSAS0202E: [{0}] Credential token 
expired. 
{1} vmcid: 0x49424000 minor code: 306 completed: No SCHD0140I: 
EJB 
information: Host: <servername> (1.40.33.112), Port: 9,900, J2EE 
component: SchedulerCalendars#Calendars.jar#DefaultUserCalendar.. 

This exception is preceded by the following warnings:

[6/5/09 11:39:52:699 EDT] 00000090 LTPAServerObj W SECJ0371W: Validation of the LTPA token failed because the token expired with the following info: Token expiration Date: Thu Jun 04 07:46:57 EDT 2009, current Date: Fri Jun 05 01:39:52 EDT 2009


RESOLVING THE PROBLEM
The IBM© WebSphere© team has identified a fix pack (PK32564) in WebSphere Application Server 6.1.0.15 that will correct the issue but a custom property needs to be enabled as follows. 

 
The following custom property needs to be specified in the security.xml file: 
com.ibm.ws.security.createTokenSubjectForAsynchLogin=true 

To specify the property, complete the following steps: 
1) In the WebSphere Application Server Integrated Solutions Console, click Security, then click Global Security. 
2) Under Additional Properties, click Custom properties. 
3) Click New. 
4) In the Name field, type com.ibm.ws.security.createTokenSubjectForAsynchLogin. 
5) In the Value field, type true. 
6) Click Apply and Save. 
7) Restart WebSphere Application Server. 

To access the WebSphere Application Server fix, go to: http://www-01.ibm.com/support/docview.wss?rs=180&uid=swg1PK32564 [http://www-01.ibm.com/support/docview.wss?rs=180&uid=swg1PK32564]