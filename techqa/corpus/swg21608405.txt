Title: IBM Configuring DataPower Multi-Protocol Gateway (MPGW) and WebSphere MQ File Transfer Edition for successful message-to-file transfer: - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 Is there a write-up that details how to configure a DataPower MPGW with Websphere MQ FTE for a message to file transfer?

How to configure DataPower Multi-Protocol Gateway (MPGW) and WebSphere MQ File Transfer Edition (WMQFTE) to transfer message from the queue to file system known as message-to-file transfer 

CAUSE
Configuring DataPower MPGW and WMQ FTE

ANSWER
Here is a general write-up of how to do this: 

The essence of this configuration is to use DataPower to transfer a file to a remote directory using WebSphere MQ File Transfer Edition (WMQ FTE). In order for a file to transfer successfully, DataPower, WebSphere MQ, and WebSphere MQ FTE must be configured.


DataPower uses an MQ FTE URL (dpmqfte) to specify the destination queue manager, destination agent, and other parameters such as the destination file. By specifying a DataPower MPGW with a back-end MQ FTE URL, a message will arrive on the destination queue with the specified parameters contained within as metadata. However, it will not transfer the message automatically to the destination file system. A WMQ FTE Monitor needs to be configured to monitor the queue for arriving messages and initiate transfer of the message from the queue to the designated file system. The monitor is a requirement in this configuration. While defining the MQFTE monitor, one will point to the task definition file that contains variables representing DataPower-specific metadata that are passed in the message to the destination queue. 

Once the WMQ FTE monitor determines that a message is on the queue and action is needed, it will use the information contained in the transfer definition file. The transfer definition file is created using the fteCreateTransfer command from the command line with the –gt option specifying the XML file name, such as “transfer.xml”. This option will also ensure that a transfer will not occur now, but all information from the command line is saved to the XML file. You will also want to ensure you use the -sqgi option for getting complete messages. The most important information within the transfer definition file are the parameters which point to the meta data that were passed into the message sent by DataPower.

Here is an example of a DataPower WMQ FTE URL that uses the “dpmqfte” protocol:

dpmqfte://lnx240/?RequestQueue=QUEUE1&DestAgent=QM1.AGENT1&DestQM=FTE_QM1&DestFile=/var/mqm/test2/success.xml&SenderID=dpuser&ReceiverID=mqm

Below is an example using the MQFTE fteCreateTransfer command to create the transfer definition file:



fteCreateTransfer -sa SEND1 -da RECEIVE1 -gt <path>\transfer.xml -sq 
-sqgi 
You will need to update the XML file manually, once it is created using the above command, to ensure the following is correct as highlighted in bold. You can also copy the following text, paste it into a document, and save as an XML file. The file below contains options which may or may not be valid for your configuration. Please ensure that you review the fteCreateTransfer command parameters within the WebSphere MQ FTE InfoCenter for detailed information. 

<?xml version="1.0" encoding="UTF-8"?>
<request version="4.00" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
xsi:noNamespaceSchemaLocation="FileTransfer.xsd"> 
<managedTransfer>
<originator>
<hostName>qmgr host name</hostName>
<userID>${DPMQFTEReceiverId}</userID>
</originator>
<sourceAgent QMgr="FTE_QM1" agent="QM1.AGENT1"/>
<destinationAgent QMgr="${DPMQFTEDestinationQM}" agent="${DPMQFTEDestinationAgent}"/>
<transferSet>
<item checksumMethod="MD5" mode="binary">
<source disposition="delete" recursive="false" type="queue">
<queue groupId="${GROUPID}" useGroups="true">QUEUE1</queue>
</source>
<destination exist="error" type="file">
<file>${DPMQFTEDestinationFile}</file>
</destination>
</item>
</transferSet>
</managedTransfer>
</request> 
After the transfer.xml file is created and updated, you can then create the monitor and specify to use the transfer.xml file. 

fteCreateMonitor -ma QM1.AGENT1 -mm FTE_QM1 -mn "QM1.AGENT MONITOR" -mt <path>\transfer.xml -pu minutes -pi 3 -tr completeGroups 

There is one more item which needs to be configured in the agents properties file for both the sending agent and destination agent. The stanza “enableQueueInputOutput=true” should be added as follows (noted in bold): 

Example for agent properties file: 
#Thu Jul 12 17:14:11 EDT 2012
agentQMgr=FTE_QM1
agentQMgrPort=1414
agentDesc=Agent1 for Lnx 
agentQMgrHost=9.x1.x2.x3
agentQMgrChannel=SYSTEM.DEF.SVRCONN
agentName=QM1.AGENT1
enableQueueInputOutput=true 
Once the agent properties file is is configured, the agent needs to be restarted so that changes are effective and then files can be transferred from the queue to destination file system successfully. 

If the files being sent from DataPower are larger than 100 MB, you should use one of the alternatives below. Ordinarily, DataPower sends the file to the queue as a message; the maximum message on a queue is 100 MB. However, there are other options available which enable you to send a file larger than 100 MB, such as: 

1) Create your own application to segment the file, then send the multiple parts via DataPower as multiple messages with the same group id. 

2) Ensure that the file being stored to a directory is accessible by both DataPower and WMQ FTE. This will allow the FTP URL within DataPower to send the message to a shared directory. Set up a WMQ FTE monitor to monitor the files in the directory. Once the monitor notices a new file/updated file, then it will transfer the file of any size between two WMQ FTE agents. 

Additional References: 

developerWorks 
http://www.ibm.com/developerworks/websphere/library/techarticles/1103_cullen/1103_cullen.html [http://www.ibm.com/developerworks/websphere/library/techarticles/1103_cullen/1103_cullen.html] 

WebSphere WMQ FTE InfoCenter: 
http://publib.boulder.ibm.com/infocenter/wmqfte/v7r0/index.jsp [http://publib.boulder.ibm.com/infocenter/wmqfte/v7r0/index.jsp] 

Managed File Transfer Solutions using DataPower and WebSphere MQ File Transfer Edition 
http://www.mqug.org.uk/downloads/201107/201107%20-%20MQ02%20-%20DataPowerMQFTEManagedFileTransfer.pdf [http://www.mqug.org.uk/downloads/201107/201107%20-%20MQ02%20-%20DataPowerMQFTEManagedFileTransfer.pdf]