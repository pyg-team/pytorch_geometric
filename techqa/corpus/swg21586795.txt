Title: IBM wp-configure-la-complete is failing - United States

Text:
wp-configure-la-complete TECHNOTE (TROUBLESHOOTING)

PROBLEM
Attempts to run wp-configure-la-complete result in ConfigTask failure.

SYMPTOM
After running the wp-prep-vmm and wp-node-prep-vmm commands successfully, the wp-configure-la-complete task fails. 

Error:
[wplc-create-la-tables] Instance attributes (Set 1 of 1): 

[wplc-create-la-tables] ignoreDuplicateIDs= *** NOT_SPECIFIED *** 

[wplc-create-la-tables] schemaLocation="/../websphere/was/../etc/wim/setup" 

[wplc-create-la-tables] attribute=[ 

[wplc-create-la-tables] [ reportSqlError="true" ] 

[wplc-create-la-tables] [ dbAdminId="propextdb" ] 

[wplc-create-la-tables] [ dbDriver="oracle.jdbc.OracleDriver" ] 

[wplc-create-la-tables] [ laPropXML="/../websphere/was/../etc/wim/setup/wimlaproperties.xml" ] 

[wplc-create-la-tables] [ derbySystemHome="/../websphere/wp/../wp_profile/PortalServer/derby" ] 

[wplc-create-la-tables] [ dbAdminPassword="PASSWORD_REMOVED" ], ] 

[wplc-create-la-tables] customproperty=[ *** NONE_SPECIFIED *** ] 

[wplc-create-la-tables] dbURL="<client URL>" 

[wplc-create-la-tables] databaseType="oracle" 

[wplc-create-la-tables] trimSpaces= *** NOT_SPECIFIED *** 

[wplc-create-la-tables] com.ibm.websphere.wim.exception. 

WIMSystemException: CWWIM1999E An exception occurred during 

processing: oracle.jdbc.OracleDriver 

[wplc-create-la-tables] at com.ibm.ws.wim.dao.schema. 

JDBCConnection.getConnection(JDBCConnection.java:132) 

[wplc-create-la-tables] at com.ibm.ws.wim.dao.schema. 

JDBCSqlImport.<init>(JDBCSqlImport.java:81) 

[wplc-create-la-tables] at com.ibm.ws.wim.dbsetup.DBSetup. 

getJDBCSqlImport(DBSetup.java:721) 

[wplc-create-la-tables] at com.ibm.ws.wim.dbsetup.DBSetup. 

readSQLFiles(DBSetup.java:752) 

[wplc-create-la-tables] at com.ibm.ws.wim.dbsetup.DBSetup. 

setupLA(DBSetup.java:642) 

[wplc-create-la-tables] at com.ibm.ws.http.HttpConnection. 

readAndHandleRequest(HttpConnection.java:733) 

[wplc-create-la-tables] at com.ibm.ws.http.HttpConnection.run 

(HttpConnection.java:522) 

[wplc-create-la-tables] at com.ibm.ws.util.ThreadPool$Worker.run 

(ThreadPool.java:1604) 

[wplc-create-la-tables] Caused by: java.lang.ClassNotFoundException: oracle.jdbc.OracleDriver 

[wplc-create-la-tables] at java.lang.Class.forNameImpl(Native 

Method) 

[wplc-create-la-tables] at java.lang.Class.forName(Class.java: 

139) 

[wplc-create-la-tables] at com.ibm.ws.wim.dao.schema. 

JDBCConnection.getConnection(JDBCConnection.java:125) 

[wplc-create-la-tables] ... 40 more 

[wplc-create-la-tables] Create DB repository failed. 

[wplc-create-la-tables] at com.ibm.wplc.deploy.tasks.impl. 

LaTablesCreateImpl.execute(LaTablesCreateImpl.java:33) 

[wplc-create-la-tables] at com.ibm.wplc.deploy.tasks. 

AbstractBaseAdminTask.executeTask(AbstractBaseAdminTask.java:495) 

[wplc-create-la-tables] at com.ibm.wplc.deploy.tasks. 

AbstractBaseWsAdminWrapperTask.executeTask 

(AbstractBaseWsAdminWrapperTask.java:301) 

[wplc-create-la-tables] at com.ibm.wplc.deploy.tasks. 

AbstractBaseAdminTask.execute(AbstractBaseAdminTask.java:156) 

[wplc-create-la-tables] at org.apache.tools.ant.UnknownElement. 

execute(UnknownElement.java:275)


CAUSE
This task requires the use of the VMM_JDBC_CLASSPATH to be set at both the DMGR and Node level. Having an incorrect value at any scope will result in a failure of this task.


RESOLVING THE PROBLEM
It was discovered that the oracle.DbLibrary was not set specifically for both the DMGR and the node. 

This property is used to set up the VMM_JDBC_CLASSPATH variable during the wp-configure-la-complete script. Both the DMGR and WebSphere_Portal server require this classpath to be set to the correct path for this task to complete successfully (DMGR and WebSphere_Portal server internal VMM db connectivity). 

For this particular case, the oracle.DbLibrary was set correctly for the Portal node but it was overriding the value for the DMGR and hence was not resolving to a valid path on the DMGR. 

 

There are 2 solutions for this problem. 

1. Update oracle.DbLibrary in the wp_profile_root/ConfigEngine/properties/wkplc_dbtype.properties file so that the path is the same on both the DMGR and the Node, eg. "/opt/driver/oracle/ojdbc6.jar" 

or 

2. Manually create a variable called VMM_JDBC_CLASSPATH at the node scope of the DMGR and set it to a valid path to the jar on the DMGR. 

Putting the variable at the node scope will override the VMM_JDBC_CLASSPATH that is set up at the CELL scope by the script.