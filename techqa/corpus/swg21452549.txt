Title: IBM Virtual Member Manager exhausts open file limit - United States

Text:
CWWIM4520E; too many open files; ulimit; authenticateWithPassword; socketException; connection pool; unbounded; context pool TECHNOTE (TROUBLESHOOTING)

PROBLEM
Virtual Member Manager can exhaust the operating system's limit on open files if its connections to LDAP are unbounded.

SYMPTOM
SystemOut.log contains messages like:
... exception E com.ibm.ws.wim.adapter.ldap.LdapAdapter authenticateWithPassword CWWIM4520E The 'javax.naming.CommunicationException: ldap.server.com:389 [Root exception is java.net.SocketException: Too many open files]' naming exception occurred during processing. 
... exception E com.ibm.ws.wim.adapter.ldap.LdapAdapter authenticateWithPassword 
com.ibm.websphere.wim.exception.WIMSystemException: CWWIM4520E The 
'javax.naming.CommunicationException:ldap.server.389 [Root exception is java.net.SocketException: Too many open files]' naming exception occurred during processing. 

This exception can occur for Virtual Member Manager (VMM) methods other than authenticateWithPassword. 


CAUSE
VMM having an unbounded number of LDAP connections may cause this exception. Under load, if an LDAP connection is not available in VMM's pool (context or connection), VMM will attempt to open a new connection. Depending on its design, the underlying operating system may consider this an attempt to open a file. If the operating system's limit on open files is already met, this request will result in "java.net.SocketException: Too many open files".


RESOLVING THE PROBLEM
Inspect wimconfig.xml to determine if VMM's LDAP connections are unbounded. Check both the connection pool (used for authentication in a federated repository configuration): 


<config:ldapServers... connectionPool="true" - indicates an unbounded connection pool

and the context pool (used for all other requests, e.g. group membership and attribute values):

<config:contextPool enabled="true" ... maxPoolSize="0" - indicates an unbounded context pool 

 

Limit VMM's connections to the LDAP per Technote 1392092, linked below. 

Also, verify that the operating system is correctly prepared according to the InfoCenter. Refer to ulimit recommendations in the appropriate "Preparing your <AIX/Linux/Solaris/HP-UX> operating system" section of InfoCenter, linked below.

RELATED INFORMATION
 Limiting LDAP connections - Technote 1392092 [http://www.ibm.com/support/docview.wss?uid=swg21392092]
6.1 InfoCenter [http://publib.boulder.ibm.com/infocenter/wpdoc/v6r1/index.jsp?topic=/com.ibm.wp.ent.doc/welcome_main.html]
7.0 InfoCenter [http://www-10.lotus.com/ldd/portalwiki.nsf/xpViewCategories.xsp?lookupName=IBM%20WebSphere%20Portal%207%20Product%20Documentation]