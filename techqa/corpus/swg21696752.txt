Title: IBM MSSQL agents (oq) not collecting data, KOQCOLL.exe exits - United States

Text:
5724B96MOTR TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 SQL agent does not show data in TEP, collector process of the agent stops running. 

SYMPTOM
When MSSQL monitoring agent is started, it shows no data in Tivoli Enterprise Portal (TEP). Windows Task Manager shows that agent process (koqagent.exe) is running, but the collector process (koqcoll.exe) is not running.


CAUSE
Performance counters for the Microsoft SQL Server instance are not enabled.

DIAGNOSING THE PROBLEM
1) Collector log TMAITM6_x64\logs\*oq*.out has the following error:
UEX2492E (2014-12-27 19:37:50) KDDNTREG(5023) (1776)write_title_list(): SQL Server Instance performance data is not enabled!
KOS0001E (2014-12-27 19:37:50) KDDNTREG(610) (1776)Unable to write initialize file (null)
XXX0000W (2014-12-27 19:37:50) KDDNTREG(6030) (1776)Command cintmptlfl returned 4 -- quitting
ERSV106E (2014-12-27 19:37:50) KOQSQLD(4656) (1776)Failure during creation of perflib counter index file; rc = 4

2) <host>_regtitls.txt file is not generated in ITMHOME\TMAITM6_x64\logs (64 bit) or ITMHOME\TMAITM6\logs (32 bit) dirctory.



3) Open performance monitor (perfmon) application, select Performance Monitor tool. Click on Add (+) icon. 

[/support/docview.wss?uid=swg21696752&amp;aid=1] 

 

SQL Server performance counters are shown in the list of available counters. 

The screen print shows counters for a default SQL Server instance.
[/support/docview.wss?uid=swg21696752&aid=2] [/support/docview.wss?uid=swg21696752&aid=2] 


If SQL Server counters are not present, then the performance counters need to be loaded for Microsoft SQL Server instance.


RESOLVING THE PROBLEM
If SQL Server performance counters are not loaded, then the collector process is unable to collect monitoring data, and exits. 

Follow these steps to load SQL Server counters: 

1) Unload counters by running unlodctr command. 

For default instance:
unlodctr MSSQLSERVER 

For named instance:
unlodctr MSSQL$<instance_name> 


[/support/docview.wss?uid=swg21696752&aid=3] [/support/docview.wss?uid=swg21696752&aid=3]

2) Find the ini file corresponding to the SQL Server instance:
To find the ini files for SQL Server instances, open a MS DOS command prompt. Go to directory <MSSQL Home>\MSSQL.n\MSSQL\Binn\ and run command:
dir *.ini 

A list of ini files is displayed. 

Following screenshot shows the ini file for default instance MSSQLSERVER. 

[/support/docview.wss?uid=swg21696752&aid=4] [/support/docview.wss?uid=swg21696752&aid=4]



3) Load performance counters for the monitored instance as shown below: 

cd <MSSQL Home>\MSSQL.n\MSSQL\Binn 

Run command:
lodctr perf-<instance_name>sqlctr.ini 

[/support/docview.wss?uid=swg21696752&aid=5] [/support/docview.wss?uid=swg21696752&aid=5]


Restart the MSSQL Server for the performance counters to take effect. Refer to MS SQL Server documentation for additional details. 

Performance counters for SQL Server show up in the perfmon application. 

Restart the monitoring agent.

RELATED INFORMATION
 SQL agent does not show data for all attribute groups [http://www.ibm.com/support/docview.wss?uid=swg21686422]