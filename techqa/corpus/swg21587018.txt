Title: IBM RSA Padding Restriction for HSM-stored Keys on IBM WebSphere DataPower SOA Appliances - United States

Text:
HSM; *RSA decryption failed* ; padding ; decrypt; OAEP TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 In general the DataPower appliance supports two RSA padding algorithms: PKCS#1v15 and OAEP. However, when the DataPower appliance is decrypting with an RSA private key stored inside of its HSM, as opposed to on the appliance flash, it only supports one RSA padding algorithm: PKCS#1v15.

The use of RSA OAEP with RSA private keys stored inside of the HSM is not supported for decryption because the underlying HSM hardware does not support OAEP. 

SYMPTOM
Any attempt to use an HSM-stored RSA private key to decrypt a message using OAEP will fail.


CAUSE
The underlying HSM hardware does not support OAEP.

DIAGNOSING THE PROBLEM
This problem only exists on appliances with HSM cards, and only when trying to decrypt messages with HSM-stored keys while using RSA OAEP. 

When this problem is encountered during decryption it will produce a log message similar to this one:
[crypto][warn]: Ephemeral key decryption failed: *RSA decryption failed*



RESOLVING THE PROBLEM
This is a permanent restriction since the HSM itself does not support OAEP. Use PKCS#1v15 padding when decrypting with HSM-stored keys. Note that you can use OAEP padding when decrypting with keys stored on the appliance flash.


To mitigate any potential vulnerability on the PKCS#1v15 padding, ensure to configure your environment securely by utilizing the features and fixes listed below:

1. Protecting WebSphere DataPower SOA Appliance services against Potential Security Exposure due to XML Encryption Attack [http://www-01.ibm.com/support/docview.wss?uid=swg21501021]
2. Preventing XML Signature and Encryption Wrapping attacks on WebSphere DataPower appliances [http://www-01.ibm.com/support/docview.wss?uid=swg21596903]

3. Security Bulletin: SSL/TLS side channel timing vulnerability on WebSphere DataPower (CVE-2014-0852) [http://www-01.ibm.com/support/docview.wss?uid=swg21678204]

4. Protection against padding oracle attacks - Rewrite Error Messages, Delay Error Messages [http://www-01.ibm.com/support/knowledgecenter/SS9H2Y_7.1.0/com.ibm.dp.doc/threatprotection_paddingoracle.html?lang=en]

 


Cross reference information Segment Product Component Platform Version Edition Business Integration IBM DataPower Gateways General Firmware 5.0.0, 6.0.0, 6.0.1, 7.0.0, 7.1