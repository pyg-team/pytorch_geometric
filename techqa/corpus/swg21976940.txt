Title: IBM The initial import task failed with "The datasource is not available" error in the import (ETL) log. - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 The initial import task failed with "The datasource is not available" error in the import (ETL) log. 

CAUSE
After installed ILMT v9.2.2.0-20151209-1636 successfully and the datasource is created successfully, the initial import task failed with these errors:
The tema.log with DEBUG enabled: 

[2016-02-12 19:27:27 LMT [DEBUG] (Default Executor-thread-289) ENTER: 
com.ibm.license.mgmt.dao.util.DBDefaultPoolerManager::init jndiName is jdbc/ilmtDatabaseConnection 

[2016-02-12 19:27:27 LMT [DEBUG] (Default Executor-thread-289) 
com.ibm.license.mgmt.dao.util.DatabaseJndiLookup::getService::Looking up data source jdbc/ilmtDatabaseConnection 

[2/12/16 19:27:27:208 UTC] 000001c7 com.ibm.ws.jca.cm.ConnectorService 
I J2CA8050I: An authentication alias should be used instead of defining a user name and password on DataSource[DatabaseConnection]. 

[2/12/16 19:27:27:927 UTC] 000001c7 
com.ibm.ws.logging.internal.impl.IncidentImplIFFDC1015I: An FFDC Incident has been created: "com.microsoft.sqlserver.jdbc.SQLServerException: Cannot open database "temadb" requested by the login. The login failed. 


=========================


The import(ETL)log with DEBUG enabled: 


2016-02-12 19:27:28 (+0:00:00.000) ERROR: (ImportThread) 
com.ibm.license.mgmt.dao.util.DBDefaultPoolerManager::getConnection:The datasource is not available

2016-02-12 19:27:28 (+0:00:00.031) ERROR: (ImportThread) execute failed 
com.ibm.license.mgmt.util.exceptions.TransactionException 


========================= 



From the tema.log, it showed that it was looking up the "data source jdbc/ilmtDatabaseConnection" connection information. 


[DEBUG] (Default Executor-thread-289) 
com.ibm.license.mgmt.dao.util.DatabaseJndiLookup::getService::Looking up data source jdbc/ilmtDatabaseConnection 


Then it failed with this error below showing something to do with the user name and password. 

[2/12/16 19:27:27:208 UTC] 000001c7 com.ibm.ws.jca.cm.ConnectorService 
I J2CA8050I: An authentication alias should be used instead of defining a user name and password on dataSource[DatabaseConnection]. 



Checking the C:\Program Files\ibm\LMT\wlp\usr\servers\server1\server.xml file, it has the following settings. 


<dataSource id="DatabaseConnection" 
jndiName="jdbc/ilmtDatabaseConnection"> 
<jdbcDriver libraryRef="DatabaseLib"/> 
<properties.microsoft.sqlserver databaseName='temadb' 
integratedSecurity='true' password='{xor}BiswOz5qbmwF' 
serverName='localhost' user='sa'/> 
</dataSource> 




Comparing with working environment, it has the following settings: 


<dataSource id='DatabaseConnection' 
jndiName='jdbc/ilmtDatabaseConnection'> 
<jdbcDriver libraryRef='DatabaseLib'/> 
<properties.microsoft.sqlserver databaseName='temadb' 
password='{xor}G2tvbTNvPDQqLw==' serverName='localhost' user='sa'/> 
</dataSource> 



Noticing that integratedSecurity='true' setting is defined in server.xml from the not working ILMT server.


This integratedSecurity='true' is only used when Windows Authentication option is selected during the temadb database creation. 

If SQL Authentication option is selected, this integratedSecurity='true' setting should not be in there. This will cause problem for the ILMT tool to attempt making connection to temadb database using Windows Authentication method but with provided user name and password (ie "sa") which it not required. 

However, the C:\Program Files\ibm\LMT\wlp\usr\servers\server1\config\database.yml file seems to have different settings than in server.xml file. Both database.yml and server.xml files don't match.

---
production:
host: localhost
database: temadb
username: sa
database_type: mssql
windows_authenticated: false
encrypted_password: '{xor}BiswOz5qbmwF'




ANSWER
If the Windows Authentication method should be used for the database connection, perform the following steps: 


1) Drop the existing temadb database again. Consult DBA for assistance if needed.

2) Stop the ILMT server service.

3) Modify the server.xml file to the following setting by removing the password and user settings:: 


<dataSource id="DatabaseConnection" 
jndiName="jdbc/ilmtDatabaseConnection"> 
<jdbcDriver libraryRef="DatabaseLib"/> 
<properties.microsoft.sqlserver databaseName='temadb' 
integratedSecurity='true' serverName='localhost'/> 
</dataSource> 



Note: server.xml file can't be deleted and it is only created during the ILMT component installation. If this server.xml file is damaged or corrupted, the ILMT component has to be reinstalled again. Make a backup of this server.xml file before making changes.

5) Delete the database.yml file.

6) Drop the temadb db again.

7) Restart the ILMT server service. Point the URL back to

[/support/docview.wss?uid=swg21976940&amp;aid=1]

where ILMTHostname is to replace with your ILMT server's hostname. This will take back to the initial temadb database setup page. At the temadb database creation page, select the Windows Authentication option only. 

8) After seeing the Data Source setup page, verify the database.yml and server.xml files to ensure both files have the correct settings. 

Sample of database.yml file as shown below.


---
production:
host: locahost
database: temadb
database_type: mssql
windows_authenticated: true



Sample of server.xml file as shown below:


<dataSource id="DatabaseConnection" 
jndiName="jdbc/ilmtDatabaseConnection"> 
<jdbcDriver libraryRef="DatabaseLib"/> 
<properties.microsoft.sqlserver databaseName='temadb' 
integratedSecurity='true' serverName='localhost'/> 
</dataSource> 


Once the settings are verified to be the same, proceed the rest of the configuration. The initiate import task should not fail with this "The datasource is not available" error.