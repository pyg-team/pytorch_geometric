Title: IBM Sametime 901 Server Upgrade fails at validation stage - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
Sametime 901 Server Upgrade fails at validation stage

SYMPTOM
Error occurred when trying to update the status in System Console Server. Check Sametime System Console Logs in 

 C:\Users\XXXX\AppData\local\Temp\SSCLogs
[/support/docview.wss?uid=swg21983775&aid=1] [/support/docview.wss?uid=swg21983775&aid=1]


CAUSE
Incorrect value in DepStatus field in the deployment table in Sametime System Console. 

The most common reason for this issue is an earlier upgrade that failed to complete successfully.


DIAGNOSING THE PROBLEM
1. Installation Manager logs show the following message: 

 

1086 ERROR [/support/docview.wss?uid=swg21983775&amp;aid=2] 01:14.48 AIAIM0025E: An error occurred when trying to update the status in Sametime System Console Server. 1087 ERROR [/support/docview.wss?uid=swg21983775&amp;aid=2] 01:14.48 AIAIM0007I: Check the Sametime System Console logs in C:\Users\xxxx\AppData\Local\Temp\SSCLogs 1088 ERROR CRIMC1067E 01:14.48 Unexpected exception 
2. SSC Logs show the following: 

2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.util.ConnectionThread run AIDSC1482I: Timer is cancelled since URL hit received response. 
2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.util.RestURL constructData AIDSC0903I: The data passed to server is :ProductType=com.ibm.lotus.sametime.meetingserver&Hostname=xxx.yyy.zzz.com&InstallType=PN&ComponentName= 
2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.util.RestURL getBaseURL aaa.bbb.ccc.ddd 
2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.util.RestURL getBaseURL aaa.bbb.ccc.ddd 
2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.util.RestURL sendData AIDSC0877I: The complete URL is : 
<<xxx.yyy.zzz.com:9443/console/deployment/getInstallDepId>> 
2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.util.ClientUtility getDepId AIDSC0910I: Response from server :<?xml version="1.0" encoding="UTF-8"?><GetDepID><Id></Id></GetDepID> 
2016:5:18 19:51:32 com.ibm.sametime.console.deployment.client.api.Deployment getDepId AIDSC0870I: The Deployment ID is :null 

3. Enable the following debug in STConsoleServer check trace.log: 
com.ibm.sametime.*=all 

Trace log shows the following: 
/19/16 12:49:05:091 BST] 000000cb DeploymentImp > DeploymentImpl getStatus ENTRY 
[5/19/16 12:49:05:093 BST] 000000cb DeploymentImp I DeploymentImpl getStatus AIDSC1486I: Size of object 1 
[5/19/16 12:49:05:093 BST] 000000cb DeploymentImp I DeploymentImpl getStatus AIDSC1488I: Query Result = 8 
[5/19/16 12:49:05:093 BST] 000000cb DeploymentImp < DeploymentImpl getStatus RETURN 

4. At this stage if you see the deployment plan of relative Server that is being upgraded, it will show as "Partial" 

[/support/docview.wss?uid=swg21983775&aid=3] [/support/docview.wss?uid=swg21983775&aid=3] 

5. If you check the DB2 database it shows like below: 

[/support/docview.wss?uid=swg21983775&aid=4] [/support/docview.wss?uid=swg21983775&aid=4] 

RESOLVING THE PROBLEM
Take a backup of the database prior to making any changes. 

 

Changing the DepStatus in DB2 Control Center 

1) When using the Control center, you may simply update the value in the DEPSTATUS column by opening the record, then changing only this value to 1542. 

2) Select COMMIT to commit the change. 


3) Restart the browser session and administer the server via the SSC 

 

Using SQL commands. (examples shown are from a cmd prompt Note the DB2 preface.) 

Follow the below procedure to ensure only the record is change. 
Below is the set of command to run to change the DepStatus. 

Remember if you are using db2cmd then omit the db2 as part of the commands below and only issue Connect, select, and update. 
Open a Command prompt or shell or Db2CMD prompt on the DB2 system. 

1) Use this command to connect to the DB2 STSC database. 
You may pass in the db2admin name and password if required. 

db2 CONNECT TO STSC

or to authenticate during the connection. 
db2 CONNECT TO STSC user DB2ADMINname using DB2AdminPwd.

2) Next locate the record that meets the criteria where the deployment table in the SSC has a value = the current incorrect value. 
Using our example we specify 8.

db2 select DepID from ssc.deployment where DEPSTATUS = '8' 

Make sure there is only 1 record returned. If you have more than one record returned, don't do the following update. 
Example
[$5166B4B3B0192A90.jpg] [/support/docview.wss?uid=swg21983775&aid=5] [/support/docview.wss?uid=swg21983775&aid=5]

3) If one record is returned issue this command to change this value to 1542

db2 UPDATE ssc.deployment SET DEPSTATUS = '1542' WHERE DepID = '<the DepID> returned from the select statement>' 

Using our example the depID is 130c3f4a24d-00000000000a-MediaDep so the command issued will change only the DEPStatus for this DEPID
db2 UPDATE ssc.deployment SET DEPSTATUS = '1542' WHERE DepID = '130c3f4a24d-00000000000a-MediaDep'
[$24C369EC1F01F855.jpg] [/support/docview.wss?uid=swg21983775&aid=6] [/support/docview.wss?uid=swg21983775&aid=6]

If multiple records are returned we need to confirm the correct data is update. 
Consult the DeploymentOut file to confirm the DeploymentIDs and their respective server types and status. 
or open a support issue if you are unable to determine the DepID to change. 

4) Once successful close and restart the browser session for the Sametime System Console to confirm the change resolved the issue.

5) You can start upgrade after that.