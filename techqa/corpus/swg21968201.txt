Title: IBM Deploying a solution from administration client fails after an upgrade if the HTTP and WebSphere server ports are not configured correctly - United States

Text:
KnowledgeCollection TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Deploying a solution from IBM Case Manager administration client will fail after you upgrade to V5.2.1 Fix Pack 2 if the HTTP and WebSphere server ports are not configured correctly. 

SYMPTOM
When you try to deploy a solution by using IBM Case Manager administration client via SSL, the following error is logged in the application server System Out log: 

[9/11/15 10:58:08:115 EDT] 00000165 SystemOut O CIWEB.ICMAdminClientPlugin Error: @ [REQUEST 601] com.ibm.ecm.icm.accm.repository.DeploySolutionMonitored.deploySolutionToTargetOS() 
javax.net.ssl.SSLException: Unrecognized SSL message, plaintext connection? 
at com.ibm.jsse2.b.c(b.java:70) 
at com.ibm.jsse2.b.a(b.java:227) 
at com.ibm.jsse2.SSLSocketImpl.a(SSLSocketImpl.java:536) 
at com.ibm.jsse2.SSLSocketImpl.h(SSLSocketImpl.java:223) 
at com.ibm.jsse2.SSLSocketImpl.a(SSLSocketImpl.java:724) 
at com.ibm.jsse2.SSLSocketImpl.startHandshake(SSLSocketImpl.java:81) 
at com.ibm.net.ssl.www2.protocol.https.c.afterConnect(c.java:8) 
at com.ibm.net.ssl.www2.protocol.https.d.connect(d.java:20) 
at com.ibm.net.ssl.www2.protocol.https.b.connect(b.java:62) 
at com.ibm.ecm.icm.accm.util.CaseManagerRESTInvoker.httpsInvoke(CaseManagerRESTInvoker.java:189) 
at com.ibm.ecm.icm.accm.util.CaseManagerRESTInvoker.invoke(CaseManagerRESTInvoker.java:66) 
at com.ibm.ecm.icm.accm.repository.DeploySolutionMonitored.deploySolutionToTargetOS(DeploySolutionMonitored.java:150) 
at com.ibm.ecm.icm.accm.services.DeploySolutionService.callBackend(DeploySolutionService.java:171) 
at com.ibm.ecm.icm.accm.services.DeploySolutionService.doExecute(DeploySolutionService.java:129) 
at com.ibm.ecm.icm.accm.services.BaseService.execute(BaseService.java:130) 
at com.ibm.ecm.util.PluginUtil.invokeService(PluginUtil.java:1099) 
at com.ibm.ecm.struts.actions.PluginAction.executeBaseAction(PluginAction.java:144) 
at com.ibm.ecm.struts.actions.BaseAction.execute(BaseAction.java:303) 
at com.ibm.ecm.jaxrs.Actions.loadAndExecuteAction(Actions.java:272) 
at com.ibm.ecm.jaxrs.Actions.handleAction(Actions.java:93) 
at com.ibm.ecm.jaxrs.Actions.handleGetActions(Actions.java:108) 
at sun.reflect.GeneratedMethodAccessor68.invoke(Unknown Source) 

 

This error did not occur prior to IBM Case Manager V5.2.1 Fix Pack 2. 




CAUSE
This error occurs if the HTTP server is configured to handle requests from a secure HTTP client request while the WebSphere application server is not configured with secure HTTP ports.

In this scenario, clients are making secure HTTP connections to the HTTP server through the default port of 9443 as the HTTP server is listening on. The WebSphere application server, however, is only configured with the non-secure HTTP port. When configured this way, as there is no other port to route the client requests to, the HTTP server forwards the incoming client requests to the WebSphere server by using a non-secure transmission to the non-secure port of WebSphere.

With this configuration, the following issues arise 

 * The communication stack from the client to the server is not the same as it is not completely secure. 
 * Given that the non-secure port is open on the WebSphere server, clients can make requests directly against WebSphere to gain access to the non-secure communication channels.


The misconfiguration above is exposed by changes that are associated with APAR PJ42973. The APAR does not address this issue specifically, but it does affect how IBM Case Manager administration client determines the host and port of where the request was made from. For deployment, the administration client makes calls to the IBM Case Manager Case REST APIs, which should be local to the administration client host. Prior to the APAR changes, the host and port to the Case REST API were determined from the arriving request (the client request) headers. After the change, the host and port were determined by the host and port that received the request. 

This change is the appropriate behavior as it addresses the following issues:  * If there is a firewall rule that restricts the IBM Case Manager server from making a request to the HTTP server or for the HTTP server to prevent arriving requests from an internal server, the Case REST API call would fail. 
 * If the HTTP server is in a remote geography, this would add performance overhead of the Case REST API call.

DIAGNOSING THE PROBLEM
Collect the following logs: 

 * IBM Content Navigator application logging at debug levels 
 * WebSphere tracing with TCPChannel=all: HTTPChannel=all


In the logs, you should see that when the client accesses the application, it uses one port number, for example: 
[9/15/15 14:14:05:614 EDT] 000000e0 SystemOut O CIWEB Entry: @ [REQUEST 173] com.ibm.ecm.jaxrs.Actions.handleGetActions() https: //<hostname>:9443/navigator/jaxrs/plugin

While the WebSphere server actually handles the request on a separate port:

[9/15/15 14:14:05:609 EDT] 000000e0 TCPBaseReques 1 Read 799(799) bytes, 1 requested on local: <hostname>/<ip_addr>:9083 remote: <hostname>/<ip_addr>:63947



RESOLVING THE PROBLEM
Create the appropriate ports on the WebSphere application server to match the ports that are being handled by the HTTP server. If the HTTP server is handling non-secure HTTP client requests, make sure there is a non-secure HTTP port configured on the WebSphere application server. The same applies for secure HTTP client requests, ensure that the WebSphere application server is configured with secure HTTP ports to handle the requests. 

 

Refer to WebSphere documentation on how to re-create a deleted port. 

At a high level, it involves: 

 1. Creating the transport 
 2. Creating the port 
 3. Mapping the port to a virtual host 
 4. Regenerating the plug-in for the HTTP server