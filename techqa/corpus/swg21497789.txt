Title: IBM Analyzing data for FileNet® Business Process Manager Process Analyzer 4.5.x quarantined event problems - United States

Text:
ProblemDeterminationDocument TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document is designed to assist with FileNet® Business Process Manager Process Analyzer 4.5.x quarantined event problems. You can address common issues with quarantined events before you call IBM Software Support and save time. 

RESOLVING THE PROBLEM
 

Review the collecting data tech note [https://www-304.ibm.com/support/docview.wss?uid=swg21497788] to see what information is needed to investigate quarantined events. 

 

Timing and Amount of Quarantined Events 

The minimum and maximum timestamp queries in the X_QuarantinedEvents table will show you when then first and last quarantined events are generated:


 * select min(eventtimestamp) from X_QuarantinedEvents 
   
   select max(eventtimestamp) from X_QuarantinedEvents 



If the first quarantined event was not generated soon after the Process Analyzer installation date, then try to associate its timestamp with a system event, such as a database recovery, migration, or an outage. 


If the last quarantined event occurred close to the current time or the last most recent time stamp in the F_Events table, then it is likely that quarantined events are still being generated. Keep monitoring the total number of quarantined events: 

 * select count(*) from X_QuarantinedEvents 


 * The query above gives you the total number of quarantined events in the Process Analyzer database. The quarantined event count in the Process Analyzer Process Task manager gives you the count of workflows that have quarantined events. 
 * Workflows typically have several events, so the result of the query above will probably be higher than the count in the Process Task Manager.



If you observe a large number of new quarantined events, then you can run queries to see if all new events in the Process Analyzer database become quarantined after a recent date. Keep monitoring the result of the following queries: 

 * select max(eventtimestamp) from F_Events 
   
   select max(eventtimestamp) from X_QuarantinedEvents 
 * 
 * 
 * If the result of the first query does not change for a long time while Process Engine And Process Analyzer are running, especially while the result of the second query keeps giving more recent time stamps, then all recent Process Engine events are quarantined.


You can monitor the most recent time stamp value associated with each Process Engine event log in the X_PAPEEventState table. Keep monitoring the result of the following query, pay attention to the values in the MostRecentTimeStamp column: 

 * select * from X_PAPEEventState; 
 * 
 * If you know a particular Process Engine event log is receiving new events, but the associated most recent time stamp value in the X_PAPEEventState table is constant, then all the events in that event log are quarantined.


Typical Scenarios 

In this section, typical scenarios are demonstrated in which quarantined events are generated. The sample query results show how to recognize these scenarios. The sample queries have similar WHERE clauses, such as Workflow_key=2219, Workflow_key=93, Workflow_key=170. The specific workflow key values that should be used in these WHERE clauses in any scenario come from the procedure documented in the collecting data tech note [https://www-304.ibm.com/support/docview.wss?uid=swg21497788]. See the Workflow_key column in step 1 under "To generate the event stream in the Process Analyzer database". 

 * Missing Workflow Launch Event 


Event streams have to start with an event type 140 event. Event type 140 indicates the launching of a workflow. For example, the following event stream does not have an initial 140 event, and that is why the first 350 event is quarantined: 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 


The attachment missing_140_event_stream.txt has the detailed event stream. 

missing_140_event_stream.txt [/support/docview.wss?uid=swg21497789&aid=2] [/support/docview.wss?uid=swg21497789&aid=1] 

The two most common causes for this scenario are improper Process Engine event log pruning or restoring a Process Analyzer database backup that was taken prior to the last Process Engine event log pruning. 
 * Events After Workflow Termination


Event streams have to end with an event type 165 event. Event type 165 indicates the termination of a parent workflow. No events should be generated for the same workflow after it is terminated. All subsequent events are quarantined. The following event stream has an additional 352 event after the 365 event. That 352 event should not come after the 365 event, so it is quarantined. 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 


The attachment events_after_165_event_stream.txt has the detailed event stream. 

events_after 165_event_stream.txt [/support/docview.wss?uid=swg21497789&aid=4] [/support/docview.wss?uid=swg21497789&aid=3] 

This scenario may happen after incorrectly pruning the Process Engine event logs. 
 * Quarantined events starting mid-stream 


In some cases, workflow events will be processed and published as expected for a while. Then events will be quarantined starting in the middle of the event stream. The attachment Mid-stream_quarantined_events.txt shows a sample. 

Mid-stream_quarantined_events.txt [/support/docview.wss?uid=swg21497789&aid=6] [/support/docview.wss?uid=swg21497789&aid=5] 

At the same time, if you query the F_Events table for the same workflow_key, you will see that the event stream starts with a 140 event. The attachment F_Events_stream.txt shows a sample. 

F_Events_stream.txt [/support/docview.wss?uid=swg21497789&aid=8] [/support/docview.wss?uid=swg21497789&aid=7] 

This cause for this scenario may be an incorrect database backup or migration, or disabling Process Engine event logging options required by Process Analyzer. The system administrator should look for activity and changes that occurred shortly before the first quarantined event was generated to find possible triggers.