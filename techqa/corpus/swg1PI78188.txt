Title: IBM PI78188: REPORT BUILDER TEMP LOCATION IS NOT BEING CLEARED (414062) - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When using Report Builder and the export to Excel and export to
   RPE functions, there are temp directories on the filesystem that
   are not being cleaned up.  This is causing unnecessary growth of
   these directories on the Report builder server.
   
   For more information, please refer to the following Jazz.net
   workitem:
   https://jazz.net/jazz/resource/itemName/com.ibm.team.workitem.Wo [https://jazz.net/jazz/resource/itemName/com.ibm.team.workitem.Wo]
   rkItem/414062
   
   
    
   
   

LOCAL FIX
 *  Clean up /tmp directory for any Report Builder files or
   directories
   
   Example:
   /tmp\rpe_template1 or /tmpmp\excel_export1
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * Customers using version older than 6.0.4                     *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Temp directories not deleted after export to Excel/RPE       *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Solution:
   In both the Excel and RPE exporters temporary folders are
   created (as defined by the system variable "java.io.tmpdir") and
   template files are unzipped into these temporary folders. The
   XML readers and writers are used to modify the template files
   with the report data. When completed, the XML writer is flushed
   and closed and the temporary folder is deleted. So these
   temporary files and folders should have already been deleted.
   The reason they are not deleted is that a FileOutputStream is
   created to initialize the XML writer but when this writer is
   flushed and closed, it does not close the underlying
   FileOutputstream. Thus the JRE hangs on to the connection to the
   files and the delete fails.
   
   So the initial solution is to ensure all output streams are
   closed before trying to delete the temporary folders.
   
   Another issue was that all of the temporary folders created for
   Report Builder (including the query results cache) were being
   created in the same system "temp" folder as all of the other
   system temp files. This made it hard to figure out which folders
   belonged to RB. So the export utility method createTempFolder()
   now always creates the temporary folders under a parent folder
   called "ReportBuilder".
   
   In order to clean up all of the export data files that may not
   have been deleted (e.g., an exception during export) a separate
   ExportDataCache manager class was created. Every exporter in RB
   that needs a temporary folder now calls this export data cache
   manager to (1) create a folder, and (2) to indicate a folder can
   be deleted. This data cache manager creates its folders in the
   <systemTemp>/ReportBuilder/ExportData folder. On RB startup,
   this data cache manager is called to delete any export data
   files left around from a previous running instance of RB.
   
   When an export indicates a folder can be deleted, the data cache
   manager simply remembers which folders to delete and then a
   background cleanup job (runs every 5 minutes) deletes those
   files.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI78188
   
   
 * REPORTED COMPONENT NAME
   JAZZ REPT SERVI
   
   
 * REPORTED COMPONENT ID
   RATLJRS00
   
   
 * REPORTED RELEASE
   601
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-03-14
   
   
 * CLOSED DATE
   2017-06-14
   
   
 * LAST MODIFIED DATE
   2017-06-14
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   JAZZ REPT SERVI
   
   
 * FIXED COMPONENT ID
   RATLJRS00
   
   

APPLICABLE COMPONENT LEVELS
 * R604 PSY
   UP