Title: IBM Object Server table_store recovered in a corrupt state - United States

Text:
nco_objserv; backup; restore; recover; corruption; recovery TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Object Server fails to start. The error in the log indicates the database was recovered in a corrupt state due to extent statistics mismatch. 

SYMPTOM
In the Object Server log: 

20.11.2009 13:47:08: Error: E-REG-002-025: Region 'table_store', from directory '/opt/netcool/omnibus/db/NCOMS/', has been recovered in a corrupt state: Extent statistics mismatch 


RESOLVING THE PROBLEM
The error indicates the Object Server database has become corrupt and must be restored. 

If you have a recent backup of the Object Server database, you can restore the Object Server using the backup. 

1) Backup the current $OMNIHOME/db/<object servername> directory 

2) Remove all files (*tab, *chk, and *log) from the $OMNIHOME/db/<object servername> directory 

3) Copy the master_store.tab and table_store.tab from the backup directory to $OMNIHOME/db/<object servername>. 

4) Start the Object Server 

If you do not have a recent backup, you can attempt to recover the Object Server using the current database files. In the $OMNIHOME/db/<object servername> directory, there are *tab, *chk, and *log files. *tab files are the Object Server tables written only at graceful Object Server shutdown. *chk checkpoint files are written every 60 seconds. Between checkpoints, *log log files are created. The Object Server writes alternately to _0.chk and _0.log or _1.chk and _1.log files. Files which are 0 bytes in size are corrupt. 

1) Backup the current $OMNIHOME/db/<object servername> directory 

2) Determine if the files containing _0 or _1 are 0 bytes in size. Remove the table_store_#.chk, table_store_#.log, master_store_#.chk and master_store_#.log for those files. 

For example, in the database directory below, the files containing _1 are 0 bytes in size. Therefore, the table_store_1.chk, table_store_1.log, master_store_1.chk and master_store_1.log files should be removed.
-rw-r----- 1 root root 126340 Dec 7 08:47 master_store_0.chk
-rw-r----- 1 root root 126340 Dec 7 08:47 master_store_0.log
-rw-r----- 1 root root 0 Dec 7 08:47 master_store_1.chk
-rw-r----- 1 root root 0 Dec 7 08:47 master_store_1.log
-rw-r----- 1 root root 2822144 Dec 7 08:45 master_store.tab
-rw-r----- 1 root root 7656 Dec 7 08:47 table_store_0.chk
-rw-r----- 1 root root 7656 Dec 7 08:47 table_store_0.log
-rw-r----- 1 root root 0 Dec 7 08:47 table_store_1.chk
-rw-r----- 1 root root 0 Dec 7 08:47 table_store_1.log
-rw-r----- 1 root root 3543040 Dec 7 08:45 table_store.tab 

3) Attempt to start the Object Server 

4) If the Object Server fails to start, recover the directory from the backup created in step 1. Remove the other *chk and *log files which were not removed in step 2. For example, if the files containing _1 were not removed in step 2, remove the files containing _1 and keep the files containing _0. Attempt to start the Object Server. 

5) If the Object Server fails to start, remove all *chk and *log files, leaving on the table_store.tab and master_store.tab files. Attempt to start the Object Server. 

Note, these restoration methods will result in some data loss. Data will be recovered in the state the Object Server was in when the files were created.