Title: IBM Application process hangs while waiting for component process to finish - United States

Text:
blob; database; hang; hung TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Attempts to insert into the BLOB column of a very large IBM UrbanCode Deploy workflow table results in the error "Data being inserted into the database table column is larger than the assigned column length" and the application process hangs. 

SYMPTOM
Component processes complete successfully, however the Application processes does not register the completion and continues to wait for the component process to finish. 

 * You are forced to cancel the deployment, and repeat. 
 * Inventory statuses are correct and resume from the correct point moving forward. 
 * If you wait too long after the hang to Cancel, you are unable to cancel the deployment.



DB2 errors in the log similar to the following: 

ERROR WorkflowRuntime-5 
com.urbancode.air.workflow.WorkflowRuntime - Uncaught 
exception in workflow 
a928028b-a271-4276-8550-54e743e28a23 
org.hibernate.exception.DataException: could not update: 
[com.urbancode.air.workflow.WorkflowRecord 
... 
... 
Caused by: com.ibm.db2.jcc.am.SqlDataException: DB2 SQL 
Error: SQLCODE=-302, SQLSTATE=22001, SQLERRMC=null, 
DRIVER=4.15.113 
SQLCODE=-302, SQLSTATE=22001 usually means: - Data being 
inserted into the database table column is larger than 
the assigned column length 
CAUSE
The BLOB column is too small.


DIAGNOSING THE PROBLEM
To confirm the size of the BLOB column in DB2, run the following query: 


select sum(BIGINT(length(workflow_data))) from wf_workflow;


RESOLVING THE PROBLEM
Increase the size of the BLOB column. 


Example for DB2 9+:

Note: Ensure these changes are committed either automatically or by running "commit".

alter table wf_workflow alter column workflow_data set data type blob(100000000) not null;
call sysproc.admin_cmd('reorg table wf_workflow');


Re-run the following SQL command and verify that the value is 100000000:

select sum(BIGINT(length(workflow_data))) from wf_workflow