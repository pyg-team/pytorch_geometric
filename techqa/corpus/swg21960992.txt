Title: IBM Certificate warnings or errors after firmware upgrade to 7.2 - United States

Text:
720change; certificate error; upgrade; web management; xml management; management interface TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Some users might encounter certificate warnings or errors when they access the web management interface or the XML management interface, or both, after upgrading DataPower firmware to 7.2. 

SYMPTOM
This issue occurs only if you configured a custom SSL proxy profile for the web management interface or the XML management interface, or both, before upgrading to 7.2. If you did not have any custom profiles configured, but see certificate warnings and errors, see technote New certificate used by the IBM DataPower Gateways Web Management Service gives untrusted certificate warnings. [http://www-01.ibm.com/support/docview.wss?uid=swg21960234] 

After the upgrade to firmware version 7.2, users that had the web or XML management interfaces configured with a custom proxy profile and certificate find that accessing either of these interfaces does not present the configured certificate. Instead, the interfaces present the default device certificate. 

Inspecting the configuration of these interfaces reveals that the previously configured custom proxy profile is no longer set. Instead, a new custom SSL server type property is set with a value of server profile. 


The CLI shows the ssl-config-type server command. 


xi52(config)# show web-mgmt

web-mgmt [up]
--------
admin-state enabled
ip-address 0.0.0.0
port 9090
save-config-overwrite on
idle-timeout 600 Seconds
acl web-mgmt [up]
ssl-config-type server

xi52(config)# show xml-mgmt

xml-mgmt [up]
--------
admin-state enabled
ip-address 0.0.0.0
port 5550
acl xml-mgmt [up]
slm-peering 10 Seconds
mode any+soma+v2004+amp+slm+wsrr-subscription
ssl-config-type server


CAUSE
The custom SSL proxy profile is replaced with the SSL server profile that is configured with the default certificate.

As of firmware release 7.2.0, the SSL proxy profile and the crypto profile are deprecated. These profile objects are replaced with the following objects. 

 * SSL server profile for reverse proxy and crypto profiles 
 * SSL SNI server profile 
 * SSL client profile for forward proxy and crypto profiles



To use the deprecated proxy profile, a list property is available in all objects to select the SSL profile type. For compatibility with earlier releases, this property defaults to proxy, except in cases of the web and XML management interfaces, where it defaults to Server profile. 

This default selection of Server profile as the server type leads to the setting of the built-in server profile, which is configured with device certificates to be used. When you access the web or XML management interfaces, the device certificates are presented. 
RESOLVING THE PROBLEM
There are multiple options to resolve this problem. 

 

Option 1: Using web management interface 

 

 1. Temporarily accept the certificate error in the web browser and continue to the web management interface 
 2. Navigate to Network > Management > Web Management Interface 
 3. On the Advanced tab change the Custom SSL server type to Proxy Profile 
 4. Choose your previously defined custom proxy 
 5. Apply the changes

[/support/docview.wss?uid=swg21960992&aid=1] [/support/docview.wss?uid=swg21960992&aid=1] Next, update the XML management interface if it was previously configured with a custom proxy profile. Navigate to Network > Management > XML Management Interface, and follow steps 3-5 as for the web management interface. 

 

Option 2: Using CLI 

 

 1. Connect to the CLI and enter global configuration mode 
 2. Modify the web management interface configuration



xi52(config)# web-mgmt 
Modify Web Management Service configuration 

xi52(config web-mgmt)# ssl-config-type proxy 
xi52(config web-mgmt)# ssl custom_proxy
xi52(config web-mgmt)# exit

Repeat the web management interface steps to update the XML management interface if it was configured with a custom proxy profile. 


xi52(config)# xml-mgmt
Modify XML Management Interface configuration

xi52(config xml-mgmt)# ssl-config-type proxy
xi52(config xml-mgmt)# ssl custom_proxy
xi52(config xml-mgmt)# exit


Although these options help you quickly revert the web and XML management interface configurations to pre-upgrade state, these options use the deprecated SSL Proxy. The best practice is to create new SSL server profiles or SSL SNI server profiles (see technote Server Name Indication (SNI) in IBM DataPower Gateways [http://www-01.ibm.com/support/docview.wss?uid=swg21699392]) with your existing identification credential.