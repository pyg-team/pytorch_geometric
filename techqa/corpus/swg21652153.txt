Title: IBM Why there are TCP/IP connections to LDAP server from db2sysc process even DB2 is not configured to use LDAP - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 In an environment where LDAP is not configured to be used in DB2 but LDAP is enabled on the OS side, there are TCP/IP connections to LDAP server from DB2 processes.


SYMPTOM
 

The following is an example to use a local user to connect to DB2 server. 


$ db2 connect to sample user db2inst1
Enter current password for db2inst1: 
Database Connection Information

Database server = DB2/LINUXX8664 9.1.7
SQL authorization ID = DB2INST1
Local database alias = SAMPLE

After the successful connection to DB2 server using the local user, there is a TCP connection to LDAP server from db2sysc process. 

# lsof -i:ldap
COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME
db2sysc 5284 db2inst1 5u IPv4 22898 0t0 TCP host1:46061->ht1:ldap (ESTABLISHED)


CAUSE
 

This is caused by OS libraries to connect to LDAP server when DB2 calls APIs in these libraries.

When DB2 calls getgrent_r() to enumerate groups, under the cover, the API call will issue TCP/IP connection to LDAP server if LDAP is enabled on the OS side.



RESOLVING THE PROBLEM
 

From DB2 Version 9.5, DB2 supports alternative method to obtain group information.
On Linux:
db2set DB2_ALTERNATE_GROUP_LOOKUP=GETGROUPLIST
On AIX:
db2set DB2_ALTERNATE_GROUP_LOOKUP=GETGRSET

RELATED INFORMATION
 LDAP-based authentication and group lookup support [http://publib.boulder.ibm.com/infocenter/db2luw/v9/topic/com.ibm.db2.udb.admin.doc/doc/c0050519.htm]
Configuring transparent LDAP for authentication and gro [http://pic.dhe.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.sec.doc/doc/t0056291.html]