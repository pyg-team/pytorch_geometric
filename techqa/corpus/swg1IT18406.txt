Title: IBM IT18406: JMS QueueBrowser browsed messages have null properties if RFH2 is not present in message - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  After manually defining a durable subscription for a topic
   string using the MQSC command "DEFINE SUB", copies of messages
   published to the topic are generated and put to the queue named
   in the 'DEST' parameter of the command.
   
   An MQ classes for JMS application that creates a JMS
   "javax.jms.QueueBrowser" object for the queue named in the
   administratively defined subscription, can then receive browsed
   copies of the messages that exist on the queue.  However, any
   named properties associated with the messages that were not
   stored within an MQRFH2 header on the message were not being
   requested by the JMS QueueBrowser code.  This would be the case
   when, for example, a message was published to the topic without
   an MQRFH2 header and the queue manager would associated the
   named property "mqps.Top" with the message which holds the topic
   string to which the message was published.
   
   As a result of this, the JMSDestination property on JMSMessages
   returned in the enumeration of JMSMessage objects provided by
   the JMS QueueBrowser were always set to null:
   
     JMSDestination:   null
   
   If the message is destructively consumed by an MQ classes for
   JMS application that uses a MessageConsumer, this JMS property
   on the message hold the correct value.  For example, if the
   message was published to the topic string "/testTopic", then the
   property will be as follows:
   
     JMSDestination:   topic://testTopic
   
   
    
   
   

LOCAL FIX
 *  Change the "Property Control" (PROPCTL) setting for the
   destination queue to be either "ALL" or "FORCE".
   
   This will ensure that the queue manager will create an RFH2
   header for the message properties, which is then given to the MQ
   classes for JMS QueueBrowser code, parsed and the property
   values mapped onto the JMSMessage objects, as per the following
   Knowledge Center page:
   
   http://www.ibm.com/support/knowledgecenter/en/SSFKSJ_8.0.0/com.i
   bm.mq.dev.doc/q032060_.htm [http://www.ibm.com/support/knowledgecenter/en/SSFKSJ_8.0.0/com.ibm.mq.dev.doc/q032060_.htm]
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects users who have applications using the MQ
   classes for JMS in 'MQ messaging provider normal mode' that
   create QueueBrowser objects to browse messages that do not
   contain message properties in an RFH2 header.
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   If an MQ classes for JMS application created an JMS QueueBrowser
   object to browse for messages on a particular queue, then
   message properties would not be populated in the enumeration of
   JMSMessage objects if the properties were not stored in an
   MQRFH2 header within the message.  Therefore, any message
   properties associated with the message outside of the MQRFH2
   would not be available to the MQ classes for JMS application.
   
   For example, consider an administratively defined durable
   subscription for a particular topic string (e.g., /testTopic),
   that  specifies a named queue for the location where the
   publication messages are to be put to.  If a non MQ classes for
   JMS application published a message to the /testTopic topic
   string which did not include an MQRFH2 header, the queue manager
   would associate the named property "mqps.Top" with the message
   when it was put to the named queue for the administratively
   defined durable subscription.  The "mqps.Top" named property
   value specifies where the message was published to, which in
   this example is "/testTopic".
   
   When using the MQ classes for JMS to browse for messages on the
   queue associated with the administratively defined durable
   subscription, the JMSDestination property on JMSMessages was set
   based on either the jms.Dst property within the MQRFH2 header,
   or the value of the property "mqps.Top".  As the messages on the
   queue did not contain MQRFH2 headers the JMSDestination property
   on each of the messages should have been set using the value
   provided by the mqps.Top property.  However, when using a JMS
   QueueBrowser, the MQ classes for JMS was not requesting that the
   queue manager generates an MQRFH2 for the messages on the queue,
   which is the mechanism by which the MQ classes for JMS access
   message properties.  As a result, only the MQMD and message
   payload was being returned to the MQ classes for JMS
   QueueBrowser code.
   
   The "mqps.Top" property was not available to the JMS
   QueueBrowser code in this case and so there was no mapping for
   the JMSDestination property.  As such, it was set to null.
   
   If the messages were consumed using a JMS MessageConsumer
   object, the MQ classes for JMS requested that an MQRFH2 header
   is generated by the queue manager for the message properties and
   so the JMS MessageConsumer code could parse the "mqps.Top" value
   from the MQRFH2 header and set it as the JMSDestination property
   on JMSMessages returned to the application.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The MQ classes for JMS QueueBrowser code has been updated to
   specify the MQ get message option:
   
       MQGMO_PROPERTIES_FORCE_MQRFH2
   
   when browsing for messages on a queue to generate an enumeration
   of JMSMessage objects.  As a result, message properties are
   returned in an MQRFH2 headers that can be parsed and properties
   mapped onto JMSMessage objects as per the documentation in the
   Knowledge Center:
   
   http://www.ibm.com/support/knowledgecenter/en/SSFKSJ_9.0.0/com.i
   bm.mq.dev.doc/q032060_.htm [http://www.ibm.com/support/knowledgecenter/en/SSFKSJ_9.0.0/com.ibm.mq.dev.doc/q032060_.htm]
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v8.0       8.0.0.7
   v9.0 CD    9.0.2
   v9.0 LTS   9.0.0.1
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT18406
   
   
 * REPORTED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * REPORTED COMPONENT ID
   5724H7251
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-12-14
   
   
 * CLOSED DATE
   2017-01-09
   
   
 * LAST MODIFIED DATE
   2017-06-01
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * FIXED COMPONENT ID
   5724H7251
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY
   UP