Title: IBM JSP Page to test and debug access to a datasource - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The following JSP page will allow you to test if a datasource is setup properly in your appserver. 

RESOLVING THE PROBLEM
I have setup a datasource on my appserver and am getting an error how can I test to make sure the datasource is working properly?

Create a jsp file called ds.jsp in the location listed in the table below. 

Place the file in the location listed here:

JSP location Appserver Location JBoss process-server/applications/teamworks.ear/teamworks.war/html Bea process-server/applications/teamworks.ear/teamworks/html Bea 9.2 process-server/servers/twprocsvr/stage/teamworks/teamworks.ear/teamworks/html WebSphere installedApps/yourCell/teamworks.ear/teamworks.war/html 


Cut and paste the code at the bottom of this article into ds.jsp and save the file. 

Once saved, you will access the page as http://host:port/teamworks/ds.lsw. Enter the name of the datasource and click submit. If there is an error you will get a detailed stacktrace. 

The jsp code: 

----------- cut here ------------ 
<%@page import="java.sql.*, java.io.*, javax.sql.DataSource, javax.naming.*"%> 

<%! 
String dsName = "jdbc/TeamWorksDB"; 
%> 
<% 
String req = request.getParameter ("dsName"); 
if (req != null) { 
dsName = req; 
} 
%> 
<form method="post" action="<%=request.getRequestURI()%>"> 
Enter Datasource Name:<input type="text" value="<%=dsName%>" name="dsName"/><br> 
<input type="submit" value="submit"/> 
</form> 

<% 
try { 
String driver = ""; 
String db = ""; 


if (!dsName.equals("")) { 
InitialContext ctx = new InitialContext(); 
DataSource dataSource = (DataSource) ctx.lookup (dsName); 
Connection con = dataSource.getConnection(); 
DatabaseMetaData dmd = con.getMetaData(); 
db = dmd.getDatabaseProductName() + " " + dmd.getDatabaseProductVersion(); 
driver = dmd.getDriverName() + " " + dmd.getDriverVersion(); 

%> 
Success! We looked up and got a connection to <%=dsName%><br> 
Database: <%=db%> <br> 
Driver version: <%=driver%><br> 
<% 
} 
} 
catch (Exception e) { 
PrintWriter pw = new PrintWriter (out); 
%> 
There was an exeption getting a connection to or looking up the datasource:<%=dsName%><br> 
        <%
        e.printStackTrace (pw);
        %>
    


<% 

} 
%> 

----------- cut here ------------  

HISTORICAL NUMBER
 212