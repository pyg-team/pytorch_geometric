Title: IBM Query amount of data backed up by incremental-forever-full (IFFULL) - United States

Text:
tsm dp tdp ve tdp4ve tdpforve stats statistics TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Backup-Archive GUI or vCenter plug-in restore does not show the size of the incremental-forever-full backup for a virtual machine backed up using the Incremental forever backup strategy (-mode=IFFull). 

SYMPTOM
The vCenter plug-in restore function shows the backup type but not the amount of data backed up. For example : 

[/support/docview.wss?uid=swg21649777&aid=1] [/support/docview.wss?uid=swg21649777&aid=1]

The Backup-Archive GUI shows the backup type and the size but the size listed is the size of the Virtual Machine, not the amount of data backed up. For example :

[/support/docview.wss?uid=swg21649777&amp;aid=2]


DIAGNOSING THE PROBLEM
The amount of data backed up is displayed when the backup is performed via the command line. For example :

C:\Program Files\Tivoli\TSM\baclient>dsmc backup "MY-TEST-VM" -mode=iffull
IBM Tivoli Storage Manager
Command Line Backup-Archive Client Interface
Client Version 6, Release 4, Level 0.10
Client date/time: 09/12/2013 07:58:54
(c) Copyright by IBM Corporation and other(s) 1990, 2013. All Rights Reserved.
...
Backup VM command started. Total number of virtual machines to process: 1
...
Creating snapshot for virtual machine 'MY-TEST-VM'
...
Backing up Full VM configuration information for 'MY-TEST-VM'
18,572 VM Configuration [Sent]
Processing snapshot
disk: [Datastore1] MY-TEST-VM/MY-TEST-VM.vmdk (Hard Disk 1)
Capacity: 10,737,418,240
Data to Send: 9,334,554,624
Transport: (nbd)[sending]
Volume --> 10,737,418,240 [Datastore1] MY-TEST-VM/MY-TEST-VM.vmdk (Hard Disk 1) [Sent]
< 8.69 GB> [- ]
Successful Full VM backup of VMware Virtual Machine 'MY-TEST-VM'
mode: 'Incremental Forever - Full'

In this example, the amount of data backed up by the IFFULL backup is 8.69 GB.
The amount of data backed up by the IFFULL backup can also be obtained once the backup is complete using the query vm clicent command or server administrative commands.


RESOLVING THE PROBLEM
Use the client command line to verify the amount of data backed up. The "query vm" with the detail option provides information on the amount of data backed up by the incremental-forever-full backup. Examine the "Backup is represented by" field to obtain the number of objects. For example : 


C:\Program Files\Tivoli\TSM\baclient>dsmc q vm my-test-vm -detail
IBM Tivoli Storage Manager
Command Line Backup-Archive Client Interface
Client Version 6, Release 4, Level 0.10
Client date/time: 09/12/2013 09:41:51
(c) Copyright by IBM Corporation and other(s) 1990, 2013. All Rights Reserved.
...
# Backup Date Mgmt Class Size Type A/I Virtual Machine
--- ------------------- ---------- ----------- ------ --- ---------------
1 09/12/2013 06:40:28 DISKMG 11.71 GB IFFULL A MY-TEST-VM
The size of this incremental backup: n/a
The number of incremental backups since last full: 0
The amount of extra data: 0
The TSM objects fragmentation: 0
Backup is represented by: 71 TSM objects

When Tivoli Storage Manager backs up a disk (vmdk), the entire disk is treated as one logical entity. When it is stored on the server, it is partitioned into chunks represented as megablocks. These megablocks contain 128 MB of data.
So, a good estimate of what amount of data that was backed up would be to multiply the number of objects by 128 MB ("Backup is represented by" * 128 MB).
In this example, "Backup is represented by" = 71 and the estimate is then :
71 * 128 MB = 9088 MB = 8.875 GB

Note that even when all IFFULL backups are expired from Tivoli Storage Manager and only IFINCR backups are stored, the amount of "active" data used the VM backup will be comparable to the amount of data backed up by an IFFULL backup of the guest machine at the current time. To determine the amount of active data, you can also use the QUERY OCCUPANCY or EXPORT NODE command.

If the data is copied to an activedata pool, use the QUERY OCCUPANCY command. For example :

tsm: MYTSM>q occ MY_VE_NODE \VMFULL-MY-TEST-VM stg=activepool

Node Name Type Filespace FSID Storage Number of Physical Logical
Name Pool Name Files Space Space
Occupied Occupied
(MB) (MB)
---------- ---- ---------- ---- ---------- ----------- ----------- -----------
MY_VE_NOD- Bkup \VMFULL-M- 32 ACTIVEPOO- 144 8,908.31 8,908.31
E Y-TEST-VM L

The QUERY OCCUPANCY command shows that there are 8908.31 MB, or about 8.7 GB of active data.
If the data is not copied to an activedata pool, you can use the EXPORT NODE command
with the filedata=backupactive and preview=yes options. For example :

ANR2017I Administrator ADMIN issued command: EXPORT NODE MY_VE_NODE filespace=\VMFULL-MY-TEST-VM filedata=backupactive preview=yes 
...
ANR0637I EXPORT NODE: Processing file space \VMFULL-MY-TEST-VM for node MY_VE_NODE fsId nn 
....
ANR0630I EXPORT NODE: Copied 9122149 kilobytes of data.

The export preview command shows there are 9122149 KB copied, or about 8.7 GB of active data.

RELATED INFORMATION
 Query amount of data backup up by IFINCR [http://www.ibm.com/support/docview.wss?uid=swg21645078]