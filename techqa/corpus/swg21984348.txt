Title: IBM Automatic Backups fails with SQL2161N when the Recovery History file is damaged. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Automatic backup failing need to find root cause behind same 

SYMPTOM
The reason DB2 Automatic backup fails could be because of the Damanged history file. In this case following message should be seen in your db2diag.log file. 

 
2015-07-23-23.08.59.557000-240 E571803F948 LEVEL: Error 
PID : 5780 TID : 5444 PROC : db2syscs.exe 
INSTANCE: db2inst1 NODE : 000 DB : SAMPLE 
APPHDL : 0-12377 APPID: *LOCAL.DB2.090724083532 
AUTHID : SYSTEM 
EDUID : 5444 EDUNAME: db2agent (SAMPLE) 0 
FUNCTION: DB2 UDB, database utilities, sqluhReadEntry, probe:802 
MESSAGE : SQL2161N A damaged recovery history file could not be fixed. 
The specified action failed. 

2015-07-30-09.04.55.733000-240 I1613218F345 LEVEL: Event 
PID : 6092 TID : 6064 PROC : db2fmp64.exe 
INSTANCE: db2inst1 NODE : 000 
EDUID : 6064 
FUNCTION: DB2 UDB, Health Monitor, db2HmonEvalBackup, probe:270 
STOP : Automatic Backup: evaluation has finished with errors on database
SAMPLE


CAUSE
We can resolve the issue by renaming the db2rhist.asc and db2rhist.bak files located in the database directory.
The utility will regenerate a new file. Any data from the corrupted file are lost. The user may look at the corrupted file to see if any information can be saved. The user should take appropriate precautions to ensure the recovery history file is not damaged again.


RELATED INFORMATION
 SQL2161N [https://www.ibm.com/support/knowledgecenter/SSEPGG_9.8.0/com.ibm.db2.luw.messages.sql.doc/doc/msql02161n.html]