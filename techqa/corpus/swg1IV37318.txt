Title: IBM IV37318: INCORRECT ERROR MESSAGE JAVA.LANG.NULLPOINTEREXCEPTION WHEN SCHEDULED REPORT FAILS - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Incorrect error message displayed when scheduled report fails
   
   Maximo BS 7.1.1.8
   
   One of our we are experiencing an inappropriate error message
   when a scheduled BIRT report fails..
   
   We have confirmed the reason why the email wasn't being sent.
   
   A new PMR is being raised about that as it relates to
   the attachment file size generated by the BIRT emitter.
   
   The error that is displayed in the SystemOut.log file is:
   
   java.lang.NullPointerException
    at psdi.server.MXServer.sendEMail(MXServer.java:4679)
    at psdi.server.MXServer.sendEMail(MXServer.java:4414)
    at com.ibm.tivoli.maximo.report.birt.queue.ReportQueueManager.
   runQueuedReport(ReportQueueManager.java:911)
    at com.ibm.tivoli.maximo.report.birt.queue.ReportQueueManager.
   runQueuedReport(ReportQueueManager.java:822)
    at
   com.ibm.tivoli.maximo.report.birt.queue.ReportQueueManager.doWor
   k
   (ReportQueueManager.java:626)
    at com.ibm.tivoli.maximo.report.birt.queue.
   ReportQueueManager$ReportRunThread.attemptToRunReport
   (ReportQueueManager.java:481)
    at com.ibm.tivoli.maximo.report.birt.queue.
   ReportQueueManager$ReportRunThread.run(ReportQueueManager.java:4
   20)
   
   Our analysis has confirmed that the addresses are valid.
   The Null Pointer Error seems to relate an error handler block
   that assumes the error is due to invalid addresses.
   
   
   Can we have a debug class where the exception handler has been
   changed so that it does not assume that the problem is an
   invalid address?
   
   The report works fine when run in the browser but the send
   appears to be failing.
   
   Other scheduled reports work and emails are sent.
   
   The attached log file shows the log entries when the problem
   occurs:
   
   
   11:45:53
   [22/01/13 11:44:53:952 GMT] 00000044 SystemOut O 22 Jan 2013
   11:44:53:
   952 [INFO] BMXAA7019I - The total memory is 1342177280 and the
   memory   available is 674134920.
   
   
   [22/01/13 11:45:12:843 GMT] 000000d3 SystemOut O 22 Jan 2013
   11:45:12:
   
   843 [ERROR] --------------------------------------------
   
   [22/01/13 11:45:12:843 GMT] 000000d3 SystemOut O 22 Jan 2013
   11:45:12:
   
   843 [ERROR] The following Email addresses are invalid...
   
   [22/01/13 11:45:53:953 GMT] 00000044 SystemOut O 22 Jan 2013
   11:45:53:
   
   953 [INFO] ADMINMONITOR: mbosets (1), mbos (null)
   
   There should be more entries after the "The following Email
   addresses  are invalid..." line
   
   
   There are entries at 11:26 which appear to be the report being
   scheduled for a 11:40 run with PDF output other emails suggest
   the report can take 5 minutes to run so the 11:45 entry above
   could
   be related.
   
   the from address looks ok although local email administrator
   should confirm that the server (see next line) doesn't perform
   any
   additional checks
   
   fromEmail: jdbloggs@uk.companyname.com
   smtpHost: testmail.uk.companyname.com
   
   locale and timezone seems reasonable:
   locale: en_GB
   timezone: Europe/London
   
   smtp authentication may be switched on as it there are entries
   of user/password but not sure if this is maximo related
   
   userID: administrator
   password:
   %EF%BE%A3%EF%BE%AE3%7Ek%25R%EF%BE%BE%EF%BF%BA%EF%BF%8E%EF%BF%
   84%0F%EF%BF%9E%1E%EF%BF%80%EF%BF%B4
   
   
   
   A small number of users are not abled to use the scheduled
   report   functionality
   
   
   After looking at this further it appears that the Maximo code
   does not handle the error situation where there is an error but
   the address lists are not populated.
   
   
   In that situation the mail code will generate a SendFailed
   exception with full exception details but one or more of the
   Address lists could Incorrect error message displayed when
   scheduled report fails
   
   
   In fact if any of the address lists are null then the code will
   generate a null pointer exception.
   
   I think an APAR will be required to make the changes listed
   below:
   
   The MXServer sendMail code needs to be changed so that it checks
   if the various getInvalidAddresses() type method calls have
   returned a null value.
   
   
   If they return a null value then they should not try and print
   out the list.
   
   
   Where an exception is defined the sendMail code also needs to
   log the exception to the SystemOut log file so it can be
   investigated and fixed.
   
   This javadoc entry explains about the exception:
   
   http://javamail.kenai.com/nonav/javadocs/javax/mail/Transport.ht [http://javamail.kenai.com/nonav/javadocs/javax/mail/Transport.ht]
   ml
   
   "In typical usage, a SendFailedException reflects an error
   detected by the server.
   
   The details of the SendFailedException will usually
   contain the error message from the server (such as an SMTP error
   message). An address may be detected as invalid for a variety of
   reasons -
   
   
   the address may not exist, the address may have invalid syntax,
   the address  may have exceeded its quota, etc. "
   
   
   The relevant code from the mail class is here:
   
   The chainedEx exception is built up earlier in the code.
   
   Address[] a = null; Address[] b = null; Address[] c = null;
   
   if (validSent.size() > 0)
   {
   a = new Address[validSent.size()];
   validSent.copyInto(a);
   }
   
   if (validUnsent.size() > 0)
   {
   b = new Address[validUnsent.size()];
   validUnsent.copyInto(b);
   }
   
   if (invalid.size() > 0) {
   c = new Address[invalid.size()];
   invalid.copyInto(c);
   }
   throw new SendFailedException("Sending failed",
   (Exception)chainedEx, a, b, c);
   
   The following RFEs have been raised relating to the
   MXServer sendEmail code:
   
   http://www.ibm.com/developerworks/rfe/execute?use_case=viewRfe&C
   R_ID=31559 [http://www.ibm.com/developerworks/rfe/execute?use_case=viewRfe&CR_ID=31559]
   
   Maximo to copy large emails for failed sent emails so
   administrators can check them
   
   http://www.ibm.com/developerworks/rfe/execute?use_case=viewRfe&C
   R_ID=31560 [http://www.ibm.com/developerworks/rfe/execute?use_case=viewRfe&CR_ID=31560]
   Maximo to automatically zip large attachments when sending
   emails
   
   The null pointer will be fixed by APAR IZ99713.
   
   Issue(s): 11-13619
   APAR #: IZ99713
   Description: IF THERE ARE MULTIPLE RECIPIENTS AND ONE OR MORE
   EMAIL ADDRESSES  ARE INVALID THE VALID ONES STILL GET SENT BY
   DEFAULT.
   
   The latest 7118 hotfix also includes another fix IZ99306 [http://www-01.ibm.com/support/docview.wss?uid=swg1IZ99306] which
   is duplicate of IZ99306 [http://www-01.ibm.com/support/docview.wss?uid=swg1IZ99306].
   
   All these are Email related fix.
   
   
   The Null Pointer Exception will now be avoided.
   
   However the error message in the sf exception is still not being
   logged. It is essential that the detail of the exception is
   written to the logs.
   
   The current situation isn't really acceptable because errors are
   occurring but we have no clue as to the reason why. The current
   error handler is hiding key information.
   
   Instructed by Developer to create a new APAR in order to address
   the  failure to display a descriptive error message by error
   handler when an error is generated by the mail server.
   
   
    
   
   

LOCAL FIX
 *  Dev to provide fix
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * Report Users                                                 *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * INCORRECT ERROR MESSAGE JAVA.LANG.NULLPOINTEREXCEPTION       *
   * WHENSCHEDULED REPORT FAILS                                   *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Fixed in code.                                               *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Part of 7.1.1.12 Fix Pack
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV37318
   
   
 * REPORTED COMPONENT NAME
   REPORTING
   
   
 * REPORTED COMPONENT ID
   5724R46RP
   
   
 * REPORTED RELEASE
   711
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-02-28
   
   
 * CLOSED DATE
   2013-03-14
   
   
 * LAST MODIFIED DATE
   2013-03-14
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  MAXIMO
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   REPORTING
   
   
 * FIXED COMPONENT ID
   5724R46RP
   
   

APPLICABLE COMPONENT LEVELS
 * R711 PSY
   UP