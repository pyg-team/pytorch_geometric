Title: IBM synchModelToDB: Procedure for updating details of an asset instance - United States

Text:
syncModelToDB; asset instance TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 A problem occurs if you try to update the details of an asset, such as the description property, by an SQL update of the synchronized model, rather than updating the source Reference Semantic Model (RSM) and re-synchronizing. In this scenario, you will see exceptions the next time you try to use the synchModelToDB script. 

SYMPTOM
A first indicator of the problem is an exception like the following example:
com.ibm.db2.jcc.am.SqlIntegrityConstraintViolationException: DB2 SQL Error: SQLCODE=-803, SQLSTATE=23505, SQLERRMC=5;WIH.ASSET_INST, DRIVER=4.14.111 

at com.ibm.db2.jcc.am.ed.a(ed.java:673)
at com.ibm.db2.jcc.am.ed.a(ed.java:60)
at com.ibm.db2.jcc.am.ed.a(ed.java:127)
at com.ibm.db2.jcc.am.oo.b(oo.java:2366)
at com.ibm.db2.jcc.am.oo.c(oo.java:2349)
at com.ibm.db2.jcc.t4.ab.l(ab.java:370)
at com.ibm.db2.jcc.t4.ab.a(ab.java:62)
at com.ibm.db2.jcc.t4.p.a(p.java:50)
at com.ibm.db2.jcc.t4.rb.b(rb.java:220)
at com.ibm.db2.jcc.am.po.qc(po.java:3497)
at com.ibm.db2.jcc.am.po.b(po.java:4458)
at com.ibm.db2.jcc.am.po.ic(po.java:799)
at com.ibm.db2.jcc.am.po.executeUpdate(po.java:777)
at com.ibm.water.model.AssetInst.insertOrUpdate
(AssetInst.java:215)
at com.ibm.water.model.AssetInst.syncToDB
(AssetInst.java:85)
at com.ibm.water.model.SyncModelToDB.syncModeToDB
(SyncModelToDB.java:76)
at com.ibm.water.model.SyncModelToDB.main
(SyncModelToDB.java:50)
Failed insert or update asset:
SunshineWaterGroup#Pipe43

DB2 SQL Error: SQLCODE=-803, SQLSTATE=23505, SQLERRMC=5;WIH.ASSET_INST, DRIVER=4.14.111
com.ibm.db2.jcc.am.SqlException: DB2 SQL Error: SQLCODE=-811, SQLSTATE=21000, SQLERRMC=null, DRIVER=4.14.111
at com.ibm.db2.jcc.am.ed.a(ed.java:682)
at com.ibm.db2.jcc.am.ed.a(ed.java:60)
at com.ibm.db2.jcc.am.ed.a(ed.java:127)
at com.ibm.db2.jcc.am.oo.b(oo.java:2366)
at com.ibm.db2.jcc.am.oo.c(oo.java:2349)
at com.ibm.db2.jcc.t4.ab.l(ab.java:370)
at com.ibm.db2.jcc.t4.ab.a(ab.java:62)
at com.ibm.db2.jcc.t4.p.a(p.java:50)
at com.ibm.db2.jcc.t4.rb.b(rb.java:220)
at com.ibm.db2.jcc.am.po.qc(po.java:3497)
at com.ibm.db2.jcc.am.po.b(po.java:4458)
at com.ibm.db2.jcc.am.po.ic(po.java:799)
at com.ibm.db2.jcc.am.po.executeUpdate(po.java:777)
at com.ibm.water.model.AssetInst.deleteAsset
(AssetInst.java:151)
at com.ibm.water.model.AssetInst.syncToDB
(AssetInst.java:90)
at com.ibm.water.model.SyncModelToDB.syncModeToDB
(SyncModelToDB.java:76)
at com.ibm.water.model.SyncModelToDB.main
(SyncModelToDB.java:50)
Failed delete: Pipe43 


RESOLVING THE PROBLEM
To fix the problem, a preferred approach is to update the source RSM and re-synchronize.

Therefore, to change the details of an asset instance, you use the syncModelToDB script to update the source RSM and re-synchronize to WIHDB.

An alternative approach is shown in the example below, which updates the description property for the asset with ID equal to 'Pipe43', valid from 1st April 2014.

db2 "UPDATE WIH.ASSET_INST FOR PORTION OF BUSINESS_TIME FROM '2014-04-01 00:00:00' TO '9999-12-31 23:59:59.9' SET DESCRIPTION = 'New Description' WHERE MODEL_ID=1 AND ASSET_TYPE_ID=6 AND ID = 'Pipe43'"
db2 "UPDATE WIH.ASSET_INST SET ASSET_ID=(SELECT MIN(ASSET_ID) FROM WIH.ASSET_INST WHERE MODEL_ID=1 AND ASSET_TYPE_ID=6 AND ID='PIPE43') WHERE MODEL_ID=1 AND ASSET_TYPE_ID=6 AND ID='Pipe43'"

Note that if the procedure is not followed correctly, it might result in "Failed delete" errors the next time the syncModelToDB script is run.