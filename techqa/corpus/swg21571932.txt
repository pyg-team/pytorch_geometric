Title: IBM DataPower monitoring data displayed in ITCAM SOA with port or operation value UNKNOWN - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The monitoring data sent from DataPower to ITCAM SOA and then displayed in Tivoli Enterprise Portal (TEP) includes the web service port name and namespace and the web service operation name and namespace. The monitoring data is stored by the ITCAM SOA data collector in flat files referred to as metric logs in the ITCAM SOA KD4\logs directory and sub-directories. 

In cases where the port and operation value might be customized by stylesheets in DataPower processing policies, the metric logs from ITCAM SOA, and the TEP may show the string 'UNKNOWN' or 'unknown' for Port Name or Operation Name. 

SYMPTOM
Here is the example of the metric log from ITCAM SOA for this issue. 

When the monitoring data is working properly, port and operation, and their respective namespaces, are included in the metric logs created by the ITCAM SOA data collector and in the TEP. 

For example, the HelloWorld WSDL, available in the DeveloperWorks article listed in the Related URL section, includes: 

 * targetNamespace="http://samples" 
 * <wsdl:portType name="Hello"> 
 *  <wsdl:operation name="sayHello">


A DataPower Web Service Proxy (WSP) based on HelloWorld.wsdl will generate monitoring data that includes the namespace http://samples, the port Hello, and the operation sayHello. When that data is collected by ITCAM SOA, it is included in the metric log, along with an epoch timestamp, e.g. 1330599364001 : 

 

 * 
 * 
 * 


In three cases, the monitoring data may include the string UNKNOWN for port and operation:  

 * 
 * 
 * 


The three cases where this issue may occur are:  * When the default Web Service Proxy monitoring data is customized with stylesheets in the processing policy for the WSP. 
 * When monitoring data is generated for a DataPower Multi-Protocol GateWay (MPGW) using custom stylesheets. 
 * When the service processing policy contains actions that generate additional records for ITCAM SOA data collection.


DIAGNOSING THE PROBLEM
Steps to determine root cause for UNKNOWN Port Name or Operation Name: 

 

 * Find the use case causing the issue:

 * 1. Search the metric logs in the ITCAM SOA KD4\logs\KD4CACHE\archive directory for "unknown" to find examples of the issue. A search tool such as Unix grep would yield results that include both the name of the metric log and the metric record itself; both are needed to help find the DataPower service that created the record. The records found will include an epoch timestamp and may contain a fault code and message that will help with finding root cause: 
   
   1330599364001; ... ;{}(unknown);{UNKNOWN}(unknown); ... ,fault_code;fault_message 
   
   2. Convert the epoch timestamp in the ITCAM SOA metric records to a readable timestamp. For example 1330599364001 is Thursday, March 01, 2012 5:56:04 AM GMT -5 (eastern). An option for converting the timestamp is to search the internet for "epoch" to find an epoch converter web site that can be used to convert the timestamp into a readable format. 
   
   3. Look at the name of the metric log where the "unknown" record was found. The name of the metric log usually indicates the appliance and the domain where the data originated. 
   
   4. Look in the DataPower logs that are being written off of the appliance for the same domain and the same time frame as the epoch timestamp. The DataPower log messages associated with the metric log will be simpler to find if a fault code and fault message from the metric log are also available to narrow the search. The DataPower messages associated with the metric log records will include a service name and transaction ID that will help clarify the use case causing the unknown value to appear in the metric records. 

 * Review the processing policies and the stylesheets in DataPower where monitoring data is being customized for the use case.

 *   1. Correct any stylesheet code where the operation or port is set without a namespace. For example, a good value for operation is {http://www.mycompany.com/abc}OperationName. If the operation element in the WSM record on DataPower appliance is set to just "OperationName" without the namespace {http://www.mycompany.com/abc} then {UNKNOWN} can result in the WSM record sent to ITCAM SOA. 
    2. Look for a processing policy where the use case identified above is not handled properly. For example, particularly if there is a fault code and fault message specified in the metric log record, look for an error condition that is not properly handled in an error rule. Look for, and correct, an error case where the port and operation values are not properly set. 
    3. Confirm the dp:wsm-agent-append() parameters in the stylesheets are correct. For example, a valid statement is: dp:wsm-agent-append($domain, $record/dpwsm:wsa-record) Confirm that XPATH dpwsm:wsa-record is included in the second parameter. For example, this this can create the {UNKNOWN} issue: dp:wsm-agent-append($domain, $record) 
    4. In the sample MPGW stylesheets, the port and operation values are set in a separate stylesheet from the dp:wsm-agent-append() that uses those values. Look for, and correct cases where the port and operation values are not set, and empty or invalid values are used in the dp:wsm-agent-append(). Use cases might include AAA or validation failures where DataPower rejects a message on the request side before the stylesheet that sets port and operation executes. Use the DataPower probe or add debug statements to stylesheet that includes the dp:wsm-agent-append(), add debug statements 
    5. The default value is the best value for the vast majority of monitoring data elements. Look for any stylesheet code that customizes fields that are not string values, such timestamps or numeric duration fields. Setting invalid data, for example alphabetic string data, in a timestamp or numeric field can cause an UNKNOWN value for port and operation. 
    6. The service processing policy may contain actions generate additional records for ITCAM SOA data collection and those records may have value UNKNOWN for the port namespace. Please see WebSphere DataPower processing actions that can affect message counts in ITCAM SOA http://www-01.ibm.com/support/docview.wss?uid=swg21587632 [http://www-01.ibm.com/support/docview.wss?uid=swg21587632]
   
   

RELATED INFORMATION
#DeveloperWorks article with sample HelloWorld.wsdl atta [http://www.ibm.com/developerworks/webservices/library/ws-noide2/]
ITCAM for SOA Version 7.1.1 Configuring DataPower Proc [http://publib.boulder.ibm.com/infocenter/tivihelp/v3r1/index.jsp?topic=/com.ibm.itcamsoa.doc/kd4inmst148.htm]