Title: IBM SPE Deenveloping Service encounters an exception due to Oracle JDBC 12.1.0.2.0 driver version with error: ORA-01461: can bind a LONG value only for insert into a LONG column - United States

Text:
ORA-01461; TXA; ITXA; Oracle; B2Bi; JDBC TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When using IBM Transformation Extender Advanced with Sterling B2B Integrator with an Oracle 12c database, the SPE Deenveloping Service may encounter an exception due to Oracle JDBC 12.1.0.2.0 driver version with error: ORA-01461: can bind a LONG value only for insert into a LONG column 

SYMPTOM
An exception similar to the following may be reported in the speservices.log.* file.

[2017-02-23 15:04:49.695] ERROR SPEDeenveloping caught exception 

[2017-02-23 15:04:49.695] ERROR [1487880289695] The transaction has been rolled back. See the nested exceptions for details on the errors that occurred.
[2017-02-23 15:04:49.699] ERRORDTL [1487880289695]<openjpa-2.4.0-r422266:1674604 fatal store error> org.apache.openjpa.persistence.RollbackException: The transaction has been rolled back. See the nested exceptions for details on the errors that occurred.
at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:593)
at com.ibm.spe.core.persistence.SPEPersistenceProvider.commit(SPEPersistenceProvider.java:393)
at com.ibm.spe.core.systeminterface.SPEThreadState.commit(SPEThreadState.java:220)
at com.ibm.spe.core.systeminterface.SPE.commit(SPE.java:951)
at com.ibm.b2b.services.deenvelope.SPEDeenveloping.processData(SPEDeenveloping.java:305)
at com.sterlingcommerce.woodstock.workflow.activity.engine.ActivityEngineHelper.invokeService(ActivityEngineHelper.java:1826)
at com.sterlingcommerce.woodstock.workflow.activity.engine.ActivityEngineHelper.nextMainLogic(ActivityEngineHelper.java:631)
at com.sterlingcommerce.woodstock.workflow.activity.engine.ActivityEngineHelper.next(ActivityEngineHelper.java:362)
at com.sterlingcommerce.woodstock.workflow.queue.WorkFlowQueueListener.doWork(WorkFlowQueueListener.java:459)
at com.sterlingcommerce.woodstock.workflow.queue.WorkFlowQueueListener.run(WorkFlowQueueListener.java:240)
at com.sterlingcommerce.woodstock.workflow.queue.WorkFlowQueueListener.onMessage(WorkFlowQueueListener.java:197)
at com.sterlingcommerce.woodstock.workflow.queue.WorkFlowQueueListener.onMessage(WorkFlowQueueListener.java:184)
at com.sterlingcommerce.woodstock.workflow.queue.wfTransporter.run(wfTransporter.java:444)
at com.sterlingcommerce.woodstock.workflow.queue.BasicExecutor$Worker.run(BasicExecutor.java:508)
at java.lang.Thread.run(Thread.java:798)
Caused by: <openjpa-2.4.0-r422266:1674604 fatal store error> org.apache.openjpa.persistence.OptimisticLockException: The transaction has been rolled back. See the nested exceptions for details on the errors that occurred.
at org.apache.openjpa.kernel.BrokerImpl.newFlushException(BrokerImpl.java:2368)
at org.apache.openjpa.kernel.BrokerImpl.flush(BrokerImpl.java:2205)
at org.apache.openjpa.kernel.BrokerImpl.flushSafe(BrokerImpl.java:2103)
at org.apache.openjpa.kernel.BrokerImpl.beforeCompletion(BrokerImpl.java:2021)
at org.apache.openjpa.kernel.LocalManagedRuntime.commit(LocalManagedRuntime.java:81)
at org.apache.openjpa.kernel.BrokerImpl.commit(BrokerImpl.java:1526)
at org.apache.openjpa.kernel.DelegatingBroker.commit(DelegatingBroker.java:932)
at org.apache.openjpa.persistence.EntityManagerImpl.commit(EntityManagerImpl.java:569)
... 14 more
Caused by: <openjpa-2.4.0-r422266:1674604 fatal store error> org.apache.openjpa.persistence.OptimisticLockException: Unable to obtain an object lock on "null".
at org.apache.openjpa.jdbc.sql.DBDictionary.narrow(DBDictionary.java:4983)
at org.apache.openjpa.jdbc.sql.DBDictionary.newStoreException(DBDictionary.java:4961)
at org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:133)
at org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:107)
at org.apache.openjpa.jdbc.sql.SQLExceptions.getStore(SQLExceptions.java:59)
at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:120)
at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:77)
at org.apache.openjpa.jdbc.kernel.JDBCStoreManager.flush(JDBCStoreManager.java:731)
at org.apache.openjpa.kernel.DelegatingStoreManager.flush(DelegatingStoreManager.java:131)
... 21 more
Caused by: java.sql.SQLException: ORA-01461: can bind a LONG value only for insert into a LONG column

at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:450)
at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:399)
at oracle.jdbc.driver.T4C8Oall.processError(T4C8Oall.java:1059)
at oracle.jdbc.driver.T4CTTIfun.receive(T4CTTIfun.java:522)
at oracle.jdbc.driver.T4CTTIfun.doRPC(T4CTTIfun.java:257)
at oracle.jdbc.driver.T4C8Oall.doOALL(T4C8Oall.java:587)
at oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:225)
at oracle.jdbc.driver.T4CPreparedStatement.doOall8(T4CPreparedStatement.java:53)
at oracle.jdbc.driver.T4CPreparedStatement.executeForRows(T4CPreparedStatement.java:943)
at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout(OracleStatement.java:1150)
at oracle.jdbc.driver.OraclePreparedStatement.executeInternal(OraclePreparedStatement.java:4798)
at oracle.jdbc.driver.OraclePreparedStatement.executeUpdate(OraclePreparedStatement.java:4875)
at oracle.jdbc.driver.UpdatableResultSet.executeUpdateRow(UpdatableResultSet.java:1432)
at oracle.jdbc.driver.UpdatableResultSet.updateRow(UpdatableResultSet.java:828)
at org.apache.commons.dbcp.DelegatingResultSet.updateRow(DelegatingResultSet.java:261)
at org.apache.openjpa.lib.jdbc.DelegatingResultSet.updateRow(DelegatingResultSet.java:551)
at org.apache.openjpa.jdbc.sql.DBDictionary.updateBlob(DBDictionary.java:5123)
at org.apache.openjpa.jdbc.meta.strats.LobFieldStrategy.customInsert(LobFieldStrategy.java:117)
at org.apache.openjpa.jdbc.meta.FieldMapping.customInsert(FieldMapping.java:818)
at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager$CustomMapping.execute(AbstractUpdateManager.java:434)
at org.apache.openjpa.jdbc.kernel.AbstractUpdateManager.flush(AbstractUpdateManager.java:118)
... 24 more


CAUSE
The following Oracle 12.1.0.2.0 bug 22385253 appears to be the cause of the SPE Deenveloping Service failure when using the Oracle JDBC driver 12.1.0.2.0 version ojdbc7.jar file. 


Bug 22385253 - ORA-01461 - when Using java.sql.ResultSet

When using a java.sql.ResultSet .insertRow() or .updateRow() to insert or update a table that does not have a LONG datatype, the following error is received:

ORA-01461: can bind a LONG value only for insert into a LONG column



ENVIRONMENT
IBM Transformation Extender Advanced integrated with Sterling B2B Integrator.



DIAGNOSING THE PROBLEM
Check the Sterling B2B Integrator dump_info.sh / .cmd script results to confirm that the Oracle JDBC driver version 12.1.0.2.0 is being used. 


<DatabaseMetaData>
Product Name: Oracle
Product Version: Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
Default Trans: 2
Driver Name: Oracle JDBC driver
Driver Version: 12.1.0.2.0
Driver Major Version: 12
Driver Minor Version: 1
</DatabaseMetaData>

The following Technote is for the similar TX Advanced issue.

Transformation Extender Advanced spedbinit script fails with ORA-01461 error when using Oracle JDBC driver 12.1.0.2.0 version

http://www.ibm.com/support/docview.wss?uid=swg21989590 [http://www.ibm.com/support/docview.wss?uid=swg21989590]

The following is the information for the Oracle related bug which appears to have been resolved in an Oracle patch.

Oracle ojdbc7.jar version 12.1.0.2 causes ORA-01461: can bind a LONG value only for insert into a LONG column

https://issues.apache.org/jira/browse/OPENJPA-2661 [https://issues.apache.org/jira/browse/OPENJPA-2661]



RESOLVING THE PROBLEM
Obtain an Oracle JDBC driver fix / patch from Oracle for Oracle Bug 22385253. 


Use the Oracle JDBC driver 12.1.0.1.0 version ojdbc7.jar file to avoid the problem.

In Sterling B2B Integrator ensure that all references in the dynamicclasspath.cfg and dynamicclasspath.cfg.in files to the Oracle driver ojdbc7.jar file are using the Oracle JDBC driver 12.1.0.1.0 version or the patch version.

<si_install>/install/properties/dynamicclasspath.cfg

Example entries in dynamicclasspath.cfg file:

VENDOR_JAR=/opt/ibm/si/install/dbjar/jdbc/Oracle/ojdbc7.jar
DB_JAR=/opt/media/si/ojdbc7.jar
DB_JAR=/opt/ibm/si/install/dbjar/jdbc/Oracle/ojdbc7.jar