Title: IBM Intermittent 'Application Build Mismatch' error upon login after upgrading - United States

Text:
TRIINSTALL; TRIUPGRADE; supiwms; #supiwms; #jalynch TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 I have multiple servers as a part of my TRIRIGA deployment, all upgraded to the latest platform version. Every few times that I try to login I am told that 'The Database and Application Server Build Numbers Do Not Match!' 

SYMPTOM
After upgrading multiple TRIRIGA servers as a part of a single deployment to a newer version of TRIRIGA an error like the following happens intermittently when users try to log in: 



The Database and Application Server Build Numbers Do Not Match! 
(<build_number_for_version_upgraded_to> versus <build_number_for_version_upgraded_from>)



CAUSE
There are multiple TRIRIGA servers as a part of single, recently upgraded deployment. One or more of these servers were not upgraded.

This can happen for two main reasons:


 * When performing the upgrade one or more of the servers were missed. The installer that would have upgraded these servers to the desired version was never run.

 * An attempt was made to upgrade all servers that were part of the deployment, but the existing version of the installer was run on one or more of the servers instead of the installer that would have upgraded these servers to the desired version. This is how this scenario plays out:

 * If you run a newer version of the TRIRIGA installer against an older version of the TRIRIGA database, the end result will be that the newer version of TRIRIGA will be installed locally and your database will be upgraded to that version as well. This is typically what you want to happen. 
   
   If you re-run the installer for the currently installed version of TRIRIGA against a newer version of the TRIRIGA database, though, the database version will be left alone (remain at the newer version), but the version of TRIRIGA installed locally will remain at the current version. 

DIAGNOSING THE PROBLEM
Identify which servers are a part of the deployment in question. Running the following SQL against your database can help with this: 

 

 *  SELECT * FROM AGENT_REGISTRY; 

 * 
 * 
 * Figure out what server is having the problem. This can be one in one of two ways:  1. Look in each server.log after rebooting to see what is listed for '**** Platform:x.y.zStream.' If x.y.z lists the version you upgraded from, you know it was not upgraded. 
    2. Login to each server that is a part of the deployment directly. If you get the 'The Database and Application Server Build Numbers Do Not Match!' error, you know that server was not upgraded.
   
   

 * Figure out what caused the problem. This can be done by looking at the '*ant' logs created by the install on each of the TRIRIGA server machines that was not upgraded.  1. Look at the ant.log. This file will show you when the install was done and whether it was successful. Note the file's timestamp and whether or not it is from around the time you thought you did your upgrade. If it is not, it may be the case that no upgrade attempt was made on this machine. 
    2. Know that each TRIRIGA version you install has a unique build number. For instance, TRIRIGA 3.5.0.0 has a build number of 205941 and TRIRIGA 3.5.1.0 has a build number of 227459. 
    3. Look at the <application_server>-ant.log having a date/time stamp matching that of your ant.log. The <application_server>-ant.log file will show the build number of the ear file that was deployed and if that deploy was successful. If the ear file was deployed successfully, but the version of the ear deployed was for the previous version of the product as opposed to the version you had thought you were upgraded to, it may be the case that the wrong installer was run.
   
   

RESOLVING THE PROBLEM
Once you have identified which server or servers were not upgraded to the new version, get them upgraded by rerunning the correct installer. The 'The Database and Application Server Build Numbers Do Not Match!' error will no longer be occurring.