Title: IBM TDWC runs slow, then not responding - United States

Text:
out; of; memory; heap; dump; java; core; slowly; slowdown; hangs TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You receive javacore dumps, and large *.phd files in the TIPProfile directory. After a few hours of Tivoli Dynamic Workload Console (TDWC) use, you must kill -9 the server1 process and restart the embedded WebSphere Application Server (eWAS) process. 

SYMPTOM
Many "Outofmemory errors are seen in SystemOut.log - javacores produced:

[7/2/13 13:25:09:669 EDT] 000001f9 webapp E com.ibm.ws.webcontain
er.webapp.WebApp logServletError SRVE0293E: [Servlet Error]-[action]:
java.lang.OutOfMemoryError
JVMDUMP010I Java dump written to
/tdwc/opt/IBM/TDWC/eWAS/profiles/TIPProfile/javacore.20121213.171959.19481.0011.txt
JVMDUMP032I JVM requested Snap dump using
'/tdwc/opt/IBM/TDWC/eWAS/profiles/TIPProfile/Snap.20121213.171959.19481.
0012.trc' in response to an event JVMDUMP010I Snap dump written to
/tdwc/opt/IBM/TDWC/eWAS/profiles/TIPProfile/Snap.20121213.171959.19481.0012.trc
JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError".
Exception in thread "Non-Deferred Alarm Manager" Exception in thread
"WebContainer : 0" Exception in thread "Deferrable Alarm : 8"
java/lang/OutOfMemoryError at java/io/BufferedWriter.<init> (BufferedWriter.java:98)


CAUSE
This is due to heap exhaustion:

javacore.20130718.111547.19645.0011.txt
=============================================
Date: 2013/07/18 at 11:16:09
JRE 1.6.0 Linux amd64-64 build jvmxa6460sr10fp1-20120202_101568
(pxa6460sr10fp1-20120321_01(SR10 FP1))

server: TIPCell TIPNode server1

Dump Event "systhrow" (00040000) Detail "java/lang/OutOfMemoryError"
received

-Xms1024m
-Xmx2048m
-Xcompressedrefs

Bytes of Heap Space Free: 12B68 = 0.07mb
Bytes of Heap Space Allocated: 80000000 = 2048.00mb
****************************

Heapdump shows over 1G of the heap is consumed by com/ibm/sec/authz/internal/util/SizeLimitedLinkedHashMap
*********************************
The problem is that Argus cache is not getting cleared out because it is configured that way.


ENVIRONMENT
* TDWC v8.6
* TDWC_TIP_VERSION_KEY=2.2.0.9 (This version means that TDWC v8.6 FP02 has been applied.)
* initialHeapSize="512" maximumHeapSize="2048" in the ...<TWAhome>/eWAS/profiles/TIPProfile/config/cells/TIPCell/nodes/TIPNode
/servers/server1/server.xml file
**************************************

DIAGNOSING THE PROBLEM
Review the eWAS SystemOut.log and the javacore (*.phd) dump files.

RESOLVING THE PROBLEM
Change the configuration in the ".../TIPCell/commonauthz/config.xml" file.

By default, the property "CacheTime" is set to -1, which means cache will never be cleared.

To resolve the issue, set the "CacheTime" value to 120000 (or any other value in milliseconds except -1). 

For example: 
- <Config owner="XACML runtime" enabled="true" name="runtime"
context="com.ibm.sec.authz.xacml">
- <Attributes>
<Attr name="CacheSize" value="5000" description="Cache size" />
<Attr name="CacheTime" value="120000" description="cache never expires
if set to -1, default is 2mins" />
<Attr name="DisableCleanupThread" value="false" description="false,
pro-actively removed from the cache once expired" />
</Attributes>
</Config>

This will trigger Argus to clean up the expired entries from the cache every two minutes.

 

PRODUCT ALIAS/SYNONYM
 TDWC
DWC