Title: IBM InfoSphere DataStage job with Salesforce stage failed with java.security.cert.CertPathValidatorException - United States

Text:
salesforce pki certificate TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Connection to salesforce.com with Information Server Pack for Salesforce.com fails due to certificate chaining error. 

SYMPTOM
main_program: Fatal Error: Information: error code: 8 

 error message: ; nested exception is: 
javax.net.ssl.SSLHandshakeException: com.ibm.jsse2.util.g: PKIX path building failed: java.security.cert.CertPathBuilderException: PKIXCertPathBuilderImpl could not build a valid CertPath.; internal cause is: 
java.security.cert.CertPathValidatorException: The certificate issued by CN=VeriSign Class 3 Public Primary Certification Authority - G5, OU="(c) 2006 VeriSign, Inc. - For authorized use only", OU=VeriSign Trust Network, O="VeriSign, Inc.", C=US is not trusted; internal cause is: 
java.security.cert.CertPathValidatorException: Certificate chaining error
AxisFault
faultCode: {http://schemas.xmlsoap.org/soap/envelope/ [http://schemas.xmlsoap.org/soap/envelope/]}Server.userException
faultSubcode: 
faultString: javax.net.ssl.SSLHandshakeException: com.ibm.jsse2.util.g: PKIX path building failed: java.security.cert.CertPathBuilderException: PKIXCertPathBuilderImpl could not build a valid CertPath.; internal cause is: 
java.security.cert.CertPathValidatorException: The certificate issued by CN=VeriSign Class 3 Public Primary Certification Authority - G5, OU=&quot;(c) 2006 VeriSign, Inc. - For authorized use only&quot;, OU=VeriSign Trust Network, O=&quot;VeriSign, Inc.&quot;, C=US is not trusted; internal cause is: 
java.security.cert.CertPathValidatorException: Certificate chaining error
faultActor: 
faultNode: 
faultDetail: 
{http://xml.apache.org/axis/ [http://xml.apache.org/axis/]}stackTrace:javax.net.ssl.SSLHandshakeException: com.ibm.jsse2.util.g: PKIX path building failed: java.security.cert.CertPathBuilderException: PKIXCertPathBuilderImpl could not build a valid CertPath.; internal cause is: 
java.security.cert.CertPathValidatorException: The certificate issued by CN=VeriSign Class 3 Public Primary Certification Authority - G5, OU=&quot;(c) 2006 VeriSign, Inc. - For authorized use only&quot;, OU=VeriSign Trust Network, O=&quot;VeriSign, Inc.&quot;, C=US is not trusted; internal cause is: 
java.security.cert.CertPathValidatorException: Certificate chaining error
...


CAUSE
Salesforce.com changed SSL certificate policy as documented in "HTTPS Security Certificate Change from SHA-1 to SHA-256 hash algorithms [https://help.salesforce.com/apex/HTViewSolution?urlname=HTTPS-Security-Certificate-Switch-from-SHA-1-to-SHA-256-hash-algorithms&language=en_US]", that is, Salesforce will be utilizing certificates issued only by Symantec.
The above error happens if Symantec's Verisign certificate is not in the Information Server's trust store.


RESOLVING THE PROBLEM
Import Symantec Verisign root certificate into Information Server as follows.

1. Download "VeriSign Class 3 Public Primary Certification Authority - G5" certificate. 

In a web browser, go to the URL http://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem [http://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem]


Save the pem file as plain text file with name containing no special characters like space or backslash and with extention pem, e.g., save it as verisign-g5.pem. 

Copy or upload this file to the Information Server Services tier and Engine tier machines.


2. In Information Server Services tier, add the certificate to WebSphere Application Server trust store. 

Login to the WebSphere Integrated Solutions Console, click Security > SSL certificate and key management > Key stores and certificates, then select CellDefaultTrustStore if it is a custered WebSphere Applicaton Server, or NodeDefaultTrustStore if it is non-clustered. Then click Signer certificates. Click the "Add" button, provide the root certificate path, provide an alias name, and click "Apply" and then "Save in Master".


3. In Information Server Engine tier, add the certificate to ASBNode trust store.
In Unix/Linux 

 * Open a telnet or ssh terminal session to the DataStage machine as root user. 
 * Go to <InformationServer-install-directory>/ASBNode directory. For example, cd /opt/IBM/InformationServer/ASBNode
   
   


 * Import the certificate using keytool command.
   For Information Server 8.5, run next command:
   apps/jre/bin/keytool -alias salesforce_certificate -importcert -keystore eclipse/plugins/com.ibm.isf.client_8.5.0.0/etc/DummyClientTrustFile.jks -file /somewhere/verisign-g5.pem -storepass WebAS
   
   For Information Server 8.7 or 9.1, run next command:
   apps/jre/bin/keytool -alias salesforce_certificate -importcert -keystore eclipse/plugins/com.ibm.isf.client/etc/DummyClientTrustFile.jks -file /somewhere/verisign-g5.pem -storepass WebAS
   
   Answer "yes" when prompted "Trust this certificate? [no]:"
   
   Note: above keytool command should be in a single line.


In Windows


 * Login to the DataStage machine, open a CMD window as a user with administrative privileges. 
 * Go to <InformationServer-install-directory>/ASBNode directory.
   For example, cd C:\IBM\InformationServer\ASBNode

 * Import the certificate using keytool command.
   For Information Server 8.5, run next command:
   apps\jre\bin\keytool -alias salesforce_certificate -importcert -keystore eclipse\plugins\com.ibm.isf.client_8.5.0.0\etc\DummyClientTrustFile.jks -file C:\somewhere\verisign-g5.pem -storepass WebAS
   
   For Information Server 8.7 or 9.1, run next command:
   apps\jre\bin\keytool -alias salesforce_certificate -importcert -keystore eclipse\plugins\com.ibm.isf.client\etc\DummyClientTrustFile.jks -file C:\somewhere\verisign-g5.pem -storepass WebAS
   
   Answer "yes" when prompted "Trust this certificate? [no]:"
   
   Note: above keytool command should be in a single line.

4. Restart ASB Agent. 

 

Note: 

* InfoSphere Information Server Pack for Salesforce.com passed the salesforce "SHA-256 Compatibility Test". 

* For Information Server 8.5 and 8.7, make sure Information Server is configured to use SSL v3.0 or TLS following Information Server Pack for Salesforce.com requires IS changes when SSL 3.0 encryption is disabled by Salesforce [http://www.ibm.com/support/docview.wss?uid=swg21689524] 

* In Information Server 11.3, the "VeriSign Class 3 Public Primary Certification Authority - G5" certificate is installed in Salesforce.com connector truststore by installation default. You can check this by running next commands. 

 * 
 * 
 * 

The keytool will display "Certificate already exists in keystore under alias <verisignclass3g5ca>" message. RELATED INFORMATION
 keytool [https://www.ibm.com/support/knowledgecenter/en/SSYKE2_7.0.0/com.ibm.java.security.component.70.doc/security-component/keytoolDocs/keytool_overview.html]
Importing the Salesforce.com self-signed certificate in [http://www.ibm.com/support/knowledgecenter/SSZJPZ_11.3.0/com.ibm.swg.im.iis.ds.entpak.salesf.doc/topics/SFConfigSSLConnectionToSalesforce.html?lang=en]