Title: IBM IZ19488: IF ADAPTER STOPS FORCIBLY & LOCK FILE IS LEFT THEN RE-START     FAILS SOMETIMES DUE TO LOCK FILE PID USED IN OTHER PROCESS - United States

Text:
AIX  A FIX IS AVAILABLE
3.9.0-TIV-TEC-FP0008 IBM Tivoli Enterprise Console Version 3.9 Fix Pack 8 [http://www-01.ibm.com/support/docview.wss?uid=swg24017355]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Problem Description:
   If adapter stops forcibly & LOCK file is left then re-start
   fails sometimes due to LOCK file PID used in other process
   
   Failing TEC Component(s):  -TEC adapter-
   
   Customer/Recreate Environment:  Noticed on aix
   
   Database:   -n/a-
   
   TME Framework:   4.1.1
   
   Install Method:   Fresh
   
   TEC Server: TEC 3.9.0-FP07
   
   Tec Gateway: TEC 3.9.0-FP07
   
   Tec UI Server: TEC 3.9.0-FP07
   
   Websphere server: -na/-
   
   Tec Console:  -n/a-
   
   Endpoints:  4.1.1+34
   
   Adapter:                3.9.0.7-TIV-TEC-LA0081
   
   TMR/TEC same machine: YES
   
   Affected Locale(s): -n/a-
   
   Collected Information :
   
   Last Known Good Level:   N/A
   
   L3 Acknowledged:   Yes (LB)
   
   Recreate Steps/Correct information: (Defect)
   
   Problem is when tec adapter machine is installed in HA
   environment, during take over from PRIMARY -> SECONDARY
   bin/tecad_logfile program is stopped forcibly and thus
   both LOCK & FIFO files in /tmp/.tivoli are left as-it-is.
   
   Later when the take back from SECONDARY -> PRIMARY is done
   tec adapter does not start with following message sometimes.
   
   --------------------------------------------------------------
   An adapter with identifier "tecad05" is already running
   Either run "init.tecad_logfile stop tecad05" or kill process
   id 82158
   --------------------------------------------------------------
   
   In adapter start/stop script above message appears from the
   logic that checks first for PID using "pidproc bin/$PROD $2"
   and if it fails then it checks for PID using "pidlock=`cat
   $LOCK`".
   
   In customer case the first check for PID fails as
   "bin/tecad_logfile" process is not running, but the second check
   succeeds as there is some other process that has the same or
   part of PID as in LOCK file.
   
   I have not received any proof of logs from customer's HA
   environment. But they have recreated in the test environment
   forcibly by setting the LOCK file PID with PID of some other
   process. I understand this is basically not an acceptable way
   to recreate, but looking into the symptom it looks genuine and
   can happen in the normal env. (NO HA) also. Hence I thought of
   discussing it with you before giving final answer to customer.
   
   Recreation scenario for creating it forcibly:
   ---------------------------------------------
   1. install teca dapter with ADAPTER_ID
   2. start tec adapter with ADAPTER_ID
      #./init.tecad_logfile -s start tecad05
   3. check adapter is running and LOCK file is created correctly.
   4. Now kill the adapter PID for tecad05 adapter (forcibly)
   (This assumes the adapter process is down due to unknown reason)
   5. Now write some other PID (either part or full) into LOCK file
      echo 82158 > .tecad_logfile.lock.pokka.tecad05
   6. start tec adapter & check adapter does not start stating
      "tecad05" is already running".
   
   Analyzing init.tecad_logfile script reveals the following spot
   that checks all PID's and there is no filtering done to check
   only TEC adapter PID's with particular ADAPTER_ID. Hence
   sometimes it is possible to face this symptom where adapter
   start is not possible.
   
   
    
   
   

LOCAL FIX
 *  Confirm adapter process is not running & Delete LOCK file &
   re-start adapter.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of TEC adapters
   ****************************************************************
   * PROBLEM DESCRIPTION: When an adapter is forcibly stopped then
   * started again after a time, it is possible that the pid in the
   * adapter lock file will belong to another process and so
   * prevent the adapter from starting.
   ****************************************************************
   Checking needed to be added to make sure the pid still belongs
   to an adapter process.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The init.tecad_logfile script has been modified to search for
   the pid as well as for an adapter so startup may continue if the
   pid is in use by another application.
   
   The fix for this
   APAR is contained in the following maintenance packages:
   
   | fix pack | 3.9.0-TIV-TEC-FP0008
   
   Note: Search IBM Technical Support web site for maintenance
   package availability.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ19488
   
   
 * REPORTED COMPONENT NAME
   TIVOLI ENT.CONS
   
   
 * REPORTED COMPONENT ID
   5698TEC00
   
   
 * REPORTED RELEASE
   390
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2008-04-07
   
   
 * CLOSED DATE
   2008-04-30
   
   
 * LAST MODIFIED DATE
   2008-04-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TIVOLI ENT.CONS
   
   
 * FIXED COMPONENT ID
   5698TEC00
   
   

APPLICABLE COMPONENT LEVELS
 * R390 PSY
   UP