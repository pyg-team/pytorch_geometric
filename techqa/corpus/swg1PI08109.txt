Title: IBM PI08109: WHEN SERVLETS ARE RUNNING, PREMATURE DEACTIVATION OF DATASOURCESERVICE CAUSES HANGS AND APP RESTART - United States

Text:
  FIXES ARE AVAILABLE
8.5.5.2: WebSphere Application Server V8.5.5 Fix Pack 2 [http://www-01.ibm.com/support/docview.wss?uid=swg24037250]
8.5.5.3: WebSphere Application Server V8.5.5 Fix Pack 3 [http://www-01.ibm.com/support/docview.wss?uid=swg24038133]
8.5.5.4: WebSphere Application Server V8.5.5 Fix Pack 4 [http://www-01.ibm.com/support/docview.wss?uid=swg24038539]
8.5.5.5: WebSphere Application Server V8.5.5 Fix Pack 5 [http://www-01.ibm.com/support/docview.wss?uid=swg24039425]
8.5.5.6: WebSphere Application Server V8.5.5 Fix Pack 6 [http://www-01.ibm.com/support/docview.wss?uid=swg24040035]
8.5.5.7: WebSphere Application Server V8.5.5 Fix Pack 7 [http://www-01.ibm.com/support/docview.wss?uid=swg24040533]
8.5.5.8: WebSphere Application Server V8.5.5 Fix Pack 8 [http://www-01.ibm.com/support/docview.wss?uid=swg24041178]
8.5.5.9: WebSphere Application Server V8.5.5 Fix Pack 9 [http://www-01.ibm.com/support/docview.wss?uid=swg24041819]
8.5.5.10: WebSphere Application Server V8.5.5 Fix Pack 10 [http://www-01.ibm.com/support/docview.wss?uid=swg24042150]
8.5.5.11: WebSphere Application Server V8.5.5 Fix Pack 11 [http://www-01.ibm.com/support/docview.wss?uid=swg24043005]
8.5.5.12: WebSphere Application Server V8.5.5 Fix Pack 12 [http://www-01.ibm.com/support/docview.wss?uid=swg24043844]
8.5.5.13: WebSphere Application Server V8.5.5 Fix Pack 13 [http://www-01.ibm.com/support/docview.wss?uid=swg24044479]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When servlet load is performed upon application startup, a
   servlet JNDI lookup can cause a premature deactivation of the
   DataSourceService reference. This can cause an application
   restart on the same thread that is handling the application
   startup resulting in a thread hang.
   at sun/misc/Unsafe.park(Native Method)
   at
   java/util/concurrent/locks/LockSupport.parkNanos(LockSupport.jav
   a:237)
   at
   java/util/concurrent/locks/AbstractQueuedSynchronizer.doAcquireS
   haredNanos(AbstractQueuedSynchronizer.java:1044(Compiled Code))
   at
   java/util/concurrent/locks/AbstractQueuedSynchronizer.tryAcquire
   SharedNanos(AbstractQueuedSynchronizer.java:1337)
   at
   java/util/concurrent/CountDownLatch.await(CountDownLatch.java:29
   3)
   at
   com/ibm/ws/container/service/app/recycle/internal/ApplicationRec
   ycleCoordinatorImpl.completeStoppedApplicationsFuture(Applicatio
   nRecycleCoordinatorImpl.java:190)
   at
   com/ibm/ws/container/service/app/recycle/internal/ApplicationRec
   ycleCoordinatorImpl.initiateStarts(ApplicationRecycleCoordinator
   Impl.java:497)
   (entered lock:
   com/ibm/ws/container/service/app/recycle/internal/ApplicationRec
   ycleCoordinatorImpl$1@0x0000000003320560, entry count: 1)
   at
   com/ibm/ws/container/service/app/recycle/internal/ApplicationRec
   ycleCoordinatorImpl.startApplications(ApplicationRecycleCoordina
   torImpl.java:305)
   at
   com/ibm/ws/jdbc/DataSourceService.destroyConnectionFactories(Dat
   aSourceService.java:289)
   at
   com/ibm/ws/jdbc/DataSourceService.deactivate(DataSourceService.j
   ava:235)
   at sun/reflect/NativeMethodAccessorImpl.invoke0(Native Method)
   at
   sun/reflect/NativeMethodAccessorImpl.invoke(NativeMethodAccessor
   Impl.java:88)
   at
   sun/reflect/DelegatingMethodAccessorImpl.invoke(DelegatingMethod
   AccessorImpl.java:55(Compiled Code))
   at java/lang/reflect/Method.invoke(Method.java:618(Compiled
   Code))
   at
   org/apache/felix/scr/impl/helper/BaseMethod.invokeMethod(BaseMet
   hod.java:228)
   at
   org/apache/felix/scr/impl/helper/BaseMethod.access$500(BaseMetho
   d.java:37)
   at
   org/apache/felix/scr/impl/helper/BaseMethod$Resolved.invoke(Base
   Method.java:609)
   at
   org/apache/felix/scr/impl/helper/BaseMethod.invoke(BaseMethod.ja
   va:492)
   at
   org/apache/felix/scr/impl/helper/ActivateMethod.invoke(ActivateM
   ethod.java:149)
   at
   org/apache/felix/scr/impl/manager/ImmediateComponentManager.disp
   oseImplementationObject(ImmediateComponentManager.java:312)
   at
   org/apache/felix/scr/impl/manager/ImmediateComponentManager.dele
   teComponent(ImmediateComponentManager.java:159)
   at
   org/apache/felix/scr/impl/manager/AbstractComponentManager$Activ
   e.ungetService(AbstractComponentManager.java:1684)
   at
   org/apache/felix/scr/impl/manager/ImmediateComponentManager.unge
   tService(ImmediateComponentManager.java:773)
   at
   org/eclipse/osgi/internal/serviceregistry/ServiceUse$2.run(Servi
   ceUse.java:238)
   at
   java/security/AccessController.doPrivileged(AccessController.jav
   a:274(Compiled Code))
   at
   org/eclipse/osgi/internal/serviceregistry/ServiceUse.ungetServic
   e(ServiceUse.java:236)
   at
   org/eclipse/osgi/internal/serviceregistry/ServiceRegistrationImp
   l.ungetService(ServiceRegistrationImpl.java:518(Compiled Code))
   (entered lock:
   org/eclipse/osgi/internal/serviceregistry/ServiceUse@0x000000001
   E8DD380,entry count: 1)
   at
   org/eclipse/osgi/internal/serviceregistry/ServiceRegistry.ungetS
   ervice(ServiceRegistry.java:510)
   at
   org/eclipse/osgi/framework/internal/core/BundleContextImpl.unget
   Service(BundleContextImpl.java:636)
   at
   com/ibm/ws/jndi/internal/WSContext.resolveObject(WSContext.java:
   145)
   at
   com/ibm/ws/jndi/internal/WSContext$1.adapt(WSContext.java:258)
   at
   com/ibm/ws/jndi/internal/WSContext$1.adapt(WSContext.java:254)
   at
   com/ibm/ws/jndi/internal/WSNamingEnumeration.next(WSNamingEnumer
   ation.java:55)
   
   
    
   
   

LOCAL FIX
 *  N/A
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  All users of IBM WebSphere Application      *
   *                  Server Liberty Profile V8.5.5.0 and         *
   *                  higher.                                     *
   ****************************************************************
   * PROBLEM DESCRIPTION: If deferServletLoad is not being        *
   *                      used, a JNDI lookup from servlet        *
   *                      startup will cause a thread hang.       *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   A JNDI lookup gets and ungets a reference to the DataSource DS
   component. When this happens upon servlet load while the
   server is starting, an application restart is triggered
   causing the thread to hang.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Code was altered to prevent service reference unget when a
   lookup is performed.
   
   The fix for this APAR is currently targeted for inclusion in
   fix pack 8.5.5.2. Please refer to the Recommended Updates page
   for delivery information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI08109
   
   
 * REPORTED COMPONENT NAME
   LIBERTY PROFILE
   
   
 * REPORTED COMPONENT ID
   5724J0814
   
   
 * REPORTED RELEASE
   850
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-12-13
   
   
 * CLOSED DATE
   2014-01-15
   
   
 * LAST MODIFIED DATE
   2014-01-15
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   LIBERTY PROFILE
   
   
 * FIXED COMPONENT ID
   5724J0814
   
   

APPLICABLE COMPONENT LEVELS
 * R850 PSY
   UP