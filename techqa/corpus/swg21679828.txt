Title: IBM EngMonApp errors out with timeout writing to DSODB database - United States

Text:
EngMonApp DSODB TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 EngMonApp intermittently timeouts when writing to the DSODB database. 

SYMPTOM
Checking the EngMonApp.log, the following error can be seen:
2014-06-13 10:42:45,709 DEBUG com.ibm.datastage.runtime.common.db.DBManager.updateRecord(DBManager.java:750) - UPDATE DSODB.JobRun SET RunMajorStatus = 'FIN',RunMinorStatus = 'SYN',RunEndTimestamp = ? WHERE RUNID = ? AND RunMajorStatus != 'FIN'. Values: [Fri Jun 13 10:42:45 NZST 2014, 5935956248781514963]
2014-06-13 10:42:55,795 ERROR com.ibm.datastage.runtime.common.db.DBManager.updateRecord(DBManager.java:768) - Error executing Update statement: UPDATE DSODB.JobRun SET RunMajorStatus = 'FIN',RunMinorStatus = 'SYN',RunEndTimestamp = ? WHERE RUNID = ? AND RunMajorStatus != 'FIN'. Values: [Fri Jun 13 10:42:45 NZST 2014, 5935956248781514963]
com.ibm.db2.jcc.am.SqlException: DB2 SQL Error: SQLCODE=-723, SQLSTATE=00000, SQLERRMC=DSODB.ALERTFAILE;-443;5UA0G;UTL_TCP.IMP_READ_LINE|UTL_TCP_IMP_READ_LIN, DRIVER=3.58.135
at com.ibm.db2.jcc.am.ed.a(ed.java:679)
at com.ibm.db2.jcc.am.ed.a(ed.java:60)
at com.ibm.db2.jcc.am.ed.a(ed.java:127)
at com.ibm.db2.jcc.am.zm.b(zm.java:2193)
at com.ibm.db2.jcc.am.zm.c(zm.java:2176)
at com.ibm.db2.jcc.t4.fb.k(fb.java:355)
at com.ibm.db2.jcc.t4.fb.a(fb.java:61)
at com.ibm.db2.jcc.t4.t.a(t.java:50)
at com.ibm.db2.jcc.t4.vb.b(vb.java:218)
at com.ibm.db2.jcc.am.an.jc(an.java:2901)
at com.ibm.db2.jcc.am.an.b(an.java:3845)
at com.ibm.db2.jcc.am.an.bc(an.java:715)
at com.ibm.db2.jcc.am.an.executeUpdate(an.java:698)
at com.ibm.datastage.runtime.common.db.DBManager.updateRecord(DBManager.java:756)
at com.ibm.datastage.runtime.engmonapp.FileManager.fixJobRuns(FileManager.java:2564)
at com.ibm.datastage.runtime.engmonapp.FileManager.watchForDirectories(FileManager.java:437)
at com.ibm.datastage.runtime.engmonapp.EngMonApp.run(EngMonApp.java:100)
at com.ibm.datastage.runtime.engmonapp.EngMonApp.main(EngMonApp.java:131)
2014-06-13 10:42:55,798 ERROR com.ibm.datastage.runtime.engmonapp.FileManager.fixJobRuns(FileManager.java:2573) - Unable to update a crashed job status for job run: 5935956248781514963
com.ibm.datastage.runtime.common.exception.RuntimeCommonException: com.ibm.db2.jcc.am.SqlException: DB2 SQL Error: SQLCODE=-723, SQLSTATE=00000, SQLERRMC=DSODB.ALERTFAILE;-443;5UA0G;UTL_TCP.IMP_READ_LINE|UTL_TCP_IMP_READ_LIN, DRIVER=3.58.135
at com.ibm.datastage.runtime.common.db.DBManager.updateRecord(DBManager.java:775)
at com.ibm.datastage.runtime.engmonapp.FileManager.fixJobRuns(FileManager.java:2564)
at com.ibm.datastage.runtime.engmonapp.FileManager.watchForDirectories(FileManager.java:437)
at com.ibm.datastage.runtime.engmonapp.EngMonApp.run(EngMonApp.java:100)
at com.ibm.datastage.runtime.engmonapp.EngMonApp.main(EngMonApp.java:131)
Caused by: 
com.ibm.db2.jcc.am.SqlException: DB2 SQL Error: SQLCODE=-723, SQLSTATE=00000, SQLERRMC=DSODB.ALERTFAILE;-443;5UA0G;UTL_TCP.IMP_READ_LINE|UTL_TCP_IMP_READ_LIN, DRIVER=3.58.135
at com.ibm.db2.jcc.am.ed.a(ed.java:679)
at com.ibm.db2.jcc.am.ed.a(ed.java:60)
at com.ibm.db2.jcc.am.ed.a(ed.java:127)
at com.ibm.db2.jcc.am.zm.b(zm.java:2193)
at com.ibm.db2.jcc.am.zm.c(zm.java:2176)
at com.ibm.db2.jcc.t4.fb.k(fb.java:355)
at com.ibm.db2.jcc.t4.fb.a(fb.java:61)
at com.ibm.db2.jcc.t4.t.a(t.java:50)
at com.ibm.db2.jcc.t4.vb.b(vb.java:218)
at com.ibm.db2.jcc.am.an.jc(an.java:2901)
at com.ibm.db2.jcc.am.an.b(an.java:3845)
at com.ibm.db2.jcc.am.an.bc(an.java:715)
at com.ibm.db2.jcc.am.an.executeUpdate(an.java:698)
at com.ibm.datastage.runtime.common.db.DBManager.updateRecord(DBManager.java:756)
... 4 more


CAUSE
Of interest in the error output is "UTL_TCP.IMP_READ_LINE" function. This function is a trigger that has been set in the DB2 DSODB database by the end user to perform some alert function. When this trigger was running, it was interfering with EngMonApp updating the DSODB database.

DIAGNOSING THE PROBLEM
Check the EngMonApp logs for "UTL.XXX" type errors and check if any triggers has been set in the DSODB database. There is an IBM Developer's Works article that details how to set triggers to do email alerts which provided a template for this issue. 


The link is here: http://www.ibm.com/developerworks/data/library/techarticle/dm-1302alerts/ [http://www.ibm.com/developerworks/data/library/techarticle/dm-1302alerts/]


RESOLVING THE PROBLEM
Remove the triggers from the DSODB database resolves the EngMonApp update errors. 

Other possible workarounds might be to increase the timeout on the DB2 update or to create the trigger to do a 'dirty read' of the table/database without locking it so that EngMonApp can still perform its update without being blocked.