Title: IBM PI79536: DFHKE0002 SEVERE ERROR (CODE X'0504') IN DFHKEDS - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A JVM Server is starting up and fails to start due the
   following message.
   .
   DFHKE0002 REGNNAME A severe error (code X'0504') has occurred
   in module DFHKEDS.
   .
   In the DFHJVMTRC file from Liberty we see.
   .
   2017/03/29 16:20:37.021000 CDT E [Router-Init-Thread]
   [com.ibm.cics.router.Router] Problem detected in Router main
   method com.ibm.cics.router.RouterException: Unable to create
   Liberty profile server
   .
   Caused by: java.lang.Exception: Liberty profile: Unable to
   upgrade existing configuration of CICS TS default application
   in server.xml file
   .
   Caused by: com.ibm.cics.router.RouterException: The Liberty
   profile CICS feature failed to initialize after 300000
   milliseconds. Either a problem exists with the Server, or the
   system is busy.  The JVM server will terminate. This timeout
   can be controlled by the System Property
   'com.ibm.cics.jvmserver.controller.timeout=n' where n is the
   value of milliseconds to wait. Further information may be
   available in the Liberty messages.log file.
   .
   In the CICS Trace we see.
   .
   0202 SJIN  EXIT  - FUNCTION(NOTIFY_DELETE_TCB) RESPONSE(OK)
         TASK-00044
   0009 DSIT  EXIT - FUNCTION(DELETE_TCB) RESPONSE(OK)
         TASK-00044
   .
   .
   0008 DSIT  ENTRY - FUNCTION(DELETE_TCB)
                      TCB_TOKEN(2C345400 , 00000001)
         TASK-00044
   .
   0009 DSIT  EXIT - FUNCTION(DELETE_TCB) RESPONSE(INVALID)
                     REASON(INVALID_TCB_TOKEN)
         TASK-00044
   .
   .
   Notice it's a different TASK below.
   .
   .
   0502 KEDS  ENTRY - FUNCTION(CREATE_TCB)
                      ATTACH_TOKEN(2C345600)
                      MODENAME(T8) PRTY_RELATIVE_TO_QR(FFFB)
                      EXEC_CAPABLE(EXEC_YES)
                      LE_ENVIRONMENT(LE_MVS) TCB_KEY(KEY8)
                      INHERIT_SUBSPACE(INHERIT_NO)
                      ESSENTIAL_TCB(ESSENTIAL_NO) PTHREAD(YES)
                      SZERO(SZERO_NO)
                      PARENT_TCB_TOKEN(2C345400 , 00000001)
         TASK-00042
   .
   0504 KEDS  *EXC*  - CHANGE_MODE_ERROR - FUNCTION(CREATE_TCB)
                       ATTACH_TOKEN(2C345600) MODENAME(T8)
                       PRTY_RELATIVE_TO_QR(FFFB)
                       EXEC_CAPABLE(EXEC_YES)
                       LE_ENVIRONMENT(LE_MVS) TCB_KEY(KEY8)
                       INHERIT_SUBSPACE(INHERIT_NO)
                       ESSENTIAL_TCB(ESSENTIAL_NO) PTHREAD(YES)
                       SZERO(SZERO_NO)
                       PARENT_TCB_TOKEN(2C345400 , 00000001)
                       FUNCTION(CHANGE_MODE)
                       TCB_TOKEN(2C345400 , 00000001)
         TASK-00042
   .
   As the JVM server is starting up it fails to start, this
   appears to be caused by a timeout waiting for Liberty to
   successfully startup.  A Webservice is installing at the same
   time and does not respect an exception that is returned and so
   continues processing when it really shouldn't.  This leads to a
   race condition with T8's and the TP.  The problem we believe is
   occurring because as the JVMSERVER decides to disable it sets
   itself enabled very briefly before going into disabling.  We
   believe this then allows the INSTALL_WSBIND to execute.
   Additional Symptom(s) Search Keyword(s): KIXREVDAM
   
   
    
   
   

LOCAL FIX
 *  n/a
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All CICS Users.                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: z/OS Connect JVMSERVER fails to start   *
   *                      with DFHKE0002 severe error code '0504' *
   *                      in DFHKEDS.                             *
   ****************************************************************
   The Liberty server is configured to use embedded xml within the
   server.xml.  When the z/OS Connect configured Liberty JVMSERVER
   attempts to start CICS tries to configure the server.xml because
   autoconfigure is enabled.  The embedded xml contains a reference
   to the CICS Default app that is now a feature, CICS is unable to
   change this because of them being in the embedded files.  This
   causes the JVM server to fail to start.
   
   While the JVM server was starting another task is installing
   WEBSERVICEs required for the z/OS Connect configuration.  As
   part of the install the JVM server responsible for these
   WEBSERVICEs is called to attempt to install them.  This call
   happens before the JVMSERVER is enabled, and if the timing is
   correct can happen during the disabling of the JVMSERVER that
   has failed to enable.  During the install of the WEBSERVICE
   a CHANGE_MODE is called to switch to the TP TCB which was
   deleted during the disabling of the JVMSERVER and this causes
   the DFHKE0002 abend.
   
   Additional Keywords: msgDFHKE0002
   
   
    
   
   

PROBLEM CONCLUSION
 *  DFHPIWR has been updated so that a WEBSERVICE install will only
   trigger the JVMSERVER install parts if the JVMSERVER is in an
   enabled state.
   
   DFHSJJS has been updated to fix a problem with the JVMSERVER
   state during a failure to start.
   
   Liberty Autoconfigure has been updated to handle the upgrading
   of the CICS default app with embedded xml files.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI79536
   
   
 * REPORTED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * REPORTED COMPONENT ID
   5655Y0400
   
   
 * REPORTED RELEASE
   000
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-04-06
   
   
 * CLOSED DATE
   2017-07-21
   
   
 * LAST MODIFIED DATE
   2017-08-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI49001 UI49002 UI49003 UI49004
   
   

MODULES/MACROS
 *  DFHPIWR  DFHSJJS  DFJ@H350
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * FIXED COMPONENT ID
   5655Y0400
   
   

APPLICABLE COMPONENT LEVELS
 * R000 PSY UI49001 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI49001]
   UP17/07/22 P F707
   
   
 * R00D PSY UI49002 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI49002]
   UP17/07/22 P F707
   
   
 * R100 PSY UI49003 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI49003]
   UP17/07/22 P F707
   
   
 * R10D PSY UI49004 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI49004]
   UP17/07/22 P F707
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.