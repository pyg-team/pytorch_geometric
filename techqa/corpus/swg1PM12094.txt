Title: IBM PM12094: SECJ5010E TOKENEXPIREDEXCEPTION IN RMI-IIOP CALL TO REMOTE EJB IN VALUEUNBOUND METHOD. - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  An application that attempts to make an outbound RMI-IIOP call
   from the method HttpSessionBindingListener.valueUnbound() in
   one WebSphere Application Server to another WebSphere
   Application Server.
   
   When the session timeout occurs the valueunbound method is
   called.  If the ltpa token has expired, any subsequent session
   timeouts continue to use an expired LTPA token resulting in
   stacktrace that looks similar to:
   
   Trace: 2009/09/04 15:22:05.268 01 t=6CBC68 c=UNK key=P8
   (13007002)
   ThreadId: 0000002e
   FunctionName:
   com.ibm.ws.security.token.WSCredentialTokenMapper
   SourceId: com.ibm.ws.security.token.WSCredentialTokenMapper
   Category: SEVERE
   ExtendedMessage: BBOO0220E: SECJ5010E: Could not create
   default
   AuthenticationToken during propagation login.  The following
   exception occurred:
   com.ibm.websphere.security.auth.TokenExpiredException
   Token expiration Date: Fri Sep 04 15:01:38 GMT+00:00 2009, cur
   rent Date: Fri Sep 04 15:22:05 GMT+00:00 2009
   com.ibm.ws.security.ltpa.LTPAToken.isValid(LTPAToken.java:259)
   com.ibm.ws.security.ltpa.LTPAToken.<init>(LTPAToken.java:82)
   com.ibm.ws.security.ltpa.LTPATokenFactory.validateTokenBytes(LTP
   com.ibm.ws.security.ltpa.LTPAServerObject.validateToken(LTPAServ
   com.ibm.ws.security.token.AuthenticationTokenImpl.initializeToke
   com.ibm.ws.security.token.WSCredentialTokenMapper.createAuthToke
   com.ibm.ws.security.server.lm.wsMapCSIv2OutboundLoginModule$1.ru
   com.ibm.ws.security.util.AccessController.doPrivileged(AccessCon
   com.ibm.ws.security.server.lm.wsMapCSIv2OutboundLoginModule.logi
   com.ibm.ws.security.common.auth.module.proxy.WSLoginModuleProxy.
   at sun.reflect.GeneratedMethodAccessor18.invoke(Unknown
   sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethod
   at java.lang.reflect.Method.invoke(Method.java(Compiled Code))
   javax.security.auth.login.LoginContext.invoke(LoginContext.java:
   javax.security.auth.login.LoginContext.access$000(LoginContext.j
   javax.security.auth.login.LoginContext$4.run(LoginContext.java:6
   at java.security.AccessController.doPrivileged1(Native Method)
   java.security.AccessController.doPrivileged(AccessController.jav
   javax.security.auth.login.LoginContext.invokeModule(LoginContext
   javax.security.auth.login.LoginContext.login(LoginContext.java:5
   com.ibm.ws.security.auth.JaasLoginHelper.jaas_login(JaasLoginHel
   com.ibm.ws.security.auth.zOSContextManagerImpl.login(zOSContextM
   com.ibm.ws.security.localOSORB.SecurityORBImpl.rmiOutboundLogin(
   at com.ibm.ws390.orb.ClientDelegate.jorbInvokeRequest(Native
   at com.ibm.ws390.orb.ClientDelegate.invoke(Unknown Source)
   org.omg.CORBA.portable.ObjectImpl._invoke(ObjectImpl.java:486)
   com.ibm.samples.interop.ejb._InteropEJBHome_Stub.create(_Interop
   com.ibm.samples.interop.MyListener.valueUnbound(MyListener.java:
   com.ibm.ws.webcontainer.httpsession.SessionData.processListeners
   com.ibm.ws.webcontainer.httpsession.SessionData.sessionUnbound(S
   com.ibm.ws.webcontainer.httpsession.SessionContext.notifySession
   com.ibm.ws.webcontainer.httpsession.SessionData.invalidate(Sessi
   com.ibm.ws.webcontainer.httpsession.SessionData.internalInvalida
   com.ibm.ws.webcontainer.httpsession.MemorySessionContext.process
   com.ibm.ws.webcontainer.httpsession.MemorySessionContext.perform
   com.ibm.ws.webcontainer.httpsession.SessionContext.pollInvalidat
   com.ibm.ws.webcontainer.httpsession.SessionAlarmListener.alarm(S
   armListener.java:59)
   at com.ibm.ejs.util.am._Alarm.run(_Alarm.java(Compiled Code))
   at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1475)
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of IBM WebSphere Application       *
   *                 Server.                                      *
   *                                                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: Within an application, there is a       *
   *                      HttpSessionBindingListener.valueUnbound *
   *                      () method that attempts to make an      *
   *                      outbound RMI-IIOP call from one         *
   *                      server within a node to another         *
   *                      server within a node. When the          *
   *                      session timeout occurs, the             *
   *                      valueUnbound method is called. If the   *
   *                      ltpa token has expired, any             *
   *                      subsequent session timeouts continue    *
   *                      to use an expired LTPA token            *
   *                      resulting in stacktrace:                *
   *                                                              *
   *                      SECJ5010E: Could not create default     *
   *                      AuthenticationToken during              *
   *                      propagation login.  The following       *
   *                      exception occurred:                     *
   *                      com.ibm.websphere.security.auth.TokenEx *
   *                      piredException:                         *
   *                                                              *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   A System Management class was not properly handling security
   credentials resulting in leaving the invocationSubject set as
   the serverSubject and may cause problems for the next user of
   the thread.  In this case, the HTTP Session invalidation
   process uses this thread and attempted to invoke the outbound
   EJB with the leftover serverSubject which is now expired and
   causes the tokenExpired exceptions.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Modified the code to properly handle the credentials.
   
   APAR PK12094 is currently targeted for inclusion in Service
   Level (Fix Pack) 6.1.0.31 of WebSphere Application Server V6.1.
   
   Please refer to URL:
   //www.ibm.com/support/docview.wss?rs=404&uid=swg27006970
   for Fix Pack availability.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM12094
   
   
 * REPORTED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * REPORTED COMPONENT ID
   5655I3500
   
   
 * REPORTED RELEASE
   610
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-04-12
   
   
 * CLOSED DATE
   2010-04-22
   
   
 * LAST MODIFIED DATE
   2010-06-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PK99578 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK99578]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  BBGUBINF BBOUBINF
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * FIXED COMPONENT ID
   5655I3500
   
   

APPLICABLE COMPONENT LEVELS
 * R610 PSY UK56378 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK56378]
   UP10/05/08 P F005
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.