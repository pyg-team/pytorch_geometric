Title: IBM PK68884: SQLCODE501 WHEN A COLLATING SEQUENCE IS DEFINED IN THE COBOL    PROGRAM - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When the program is prepared with the Precompiler ( not when
   prepared with the Coprocessor) with NEWFUN(YES), a FETCH
   statement in a COBOL application incorrectly results in
   SQLCODE501 when a COLLATING SEQUENCE is defined in the COBOL
   program.
   
   
    
   
   

LOCAL FIX
 *  N/A
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: Users of the DB2 Precompiler for COBOL       *
   *                 with DB2 UDB for z/OS V8.1 using the         *
   *                 COBOL COLLATING SEQUENCE phrase.             *
   ****************************************************************
   * PROBLEM DESCRIPTION: A FETCH statement in a COBOL program    *
   *                      incorrectly results in SQLCODE501 at    *
   *                      execution time when the program was     *
   *                      precompiled on DB2 V8.1 with            *
   *                      NEWFUN(YES), and the program contains   *
   *                      the COLLATING SEQUENCE phrase.          *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   Here is an example that exposes the problem:
   
          IDENTIFICATION DIVISION.
          PROGRAM-ID.    COBTEST.
          ENVIRONMENT DIVISION.
          CONFIGURATION SECTION.
          SOURCE-COMPUTER.  IBM-370.
          OBJECT-COMPUTER.  IBM-370
              PROGRAM COLLATING SEQUENCE IS MYSEQ.
   
          SPECIAL-NAMES.
              ALPHABET MYSEQ IS
                             'A'
                             'B'
                      ...
                             'Y'
                             'Z'.
          DATA DIVISION.
          WORKING-STORAGE SECTION.
          01 HV             PIC X(10).
              EXEC SQL DECLARE C1 CURSOR FOR SELECT COL1 FROM T1
              END-EXEC.
          PROCEDURE DIVISION.
              EXEC SQL OPEN  C1 END-EXEC.
              EXEC SQL FETCH C1 INTO :HV END-EXEC.
              EXEC SQL CLOSE C1 END-EXEC.
   
   When the program is executed, the FETCH statement results in
   SQLCODE501, when it should result in SQLCODE 0:
   
   SQLCODE = -501, ERROR:  THE CURSOR IDENTIFIED IN A FETCH OR
                           CLOSE STATEMENT IS NOT OPEN
   SQLSTATE   = 24501 SQLSTATE RETURN CODE
   SQLERRP    = DSNXERT SQL PROCEDURE DETECTING ERROR
   SQLERRD    = -240  0  0  -1  0  0 SQL DIAGNOSTIC INFORMATION
   
   The problem is due to a field in the SQL-PLISTn structures
   generated by the precompiler that is incorrectly initialized.
   
   The problem occurs only when the program is precompiled on
   DB2 V8.1 using NEWFUN(YES) (either explicitly or implicitly),
   and the program contains the COLLATING SEQUENCE phrase.
   
   The problem does not occur when the program is precompiled with
   NEWFUN(NO), or when using the DB2 Coprocessor for COBOL, or
   when the program does not contain the COLLATING SEQUENCE phrase,
   and the problem does not occur in DB2 V9.1 for z/OS.
   
   This apar includes a fix for DB2 V9.1 only to correct the
   initialization of the SQL-PLISTn fields in case the fields
   are used at a later time by DB2.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Precompiler code that initializes a field in the SQL-PLISTn
   structures generated by the Precompiler is corrected to use
   hex zeros intead of LOW-VALUE, since LOW-VALUE may not
   necessarily be hex zeros if a COLLATING SEQUENCE is defined
   in the COBOL program.
   
   A COBOL program exhibiting the problem described by this APAR
   must be precompiled, compiled, and linked after applying the
   ptf for the fix to take effect.
   
   DB2 does NOT need to be recycled after applying the ptf.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK68884
   
   
 * REPORTED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * REPORTED COMPONENT ID
   5740XYR00
   
   
 * REPORTED RELEASE
   810
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2008-07-11
   
   
 * CLOSED DATE
   2008-07-17
   
   
 * LAST MODIFIED DATE
   2008-09-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK38234 UK38235
   
   

MODULES/MACROS
 *  DSNHSTMC
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * FIXED COMPONENT ID
   5740XYR00
   
   

APPLICABLE COMPONENT LEVELS
 * R810 PSY UK38234 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK38234]
   UP08/08/04 P F808
   
   
 * R910 PSY UK38235 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK38235]
   UP08/08/04 P F808
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.