Title: IBM Configuring IBM Atlas Policy Suite to use Kerberos SSO for IBM WebSphere Application Server - United States

Text:
 PRODUCT DOCUMENTATION

ABSTRACT
 This document describes how to configure IBM Atlas Policy Suite for Kerberos for IBM WebSphere Application Server or the IBM Employee Retention Portal. Users logged in to a Window Active Directory domain can use IBM Atlas Policy Suite and the IBM Employee Portal without being prompted for credentials. 

CONTENT
You must complete three main steps to configure IBM Atlas Policy Suite or the IBM Emplyoee Retention Portal to use Kerberos SSO:




 1. Configure your SSO environment. 
 2. Verify your SSO configuration. 
 3. Configure and deploy IBM Atlas Policy Suite (PolicyAtlas) or the IBM Employee Portal (AtlasPortal) with Kerberos/SPNEGO.


Step 1: Configure your SSO environment

Before you configure single sign-on for SPNEGO/Kerberos for IBM Atlas Policy Suite, you must configure your web application server for SPNEGO/Kerberos. 

Prerequisites 

 1. Configure your Windows Active Directory domain and configure all client workstations as members of the same domain as your Active Directory server. You must use Windows Active Directory as your directory service to use Kerberos. If you have a more complex configuration, you can configure the client workstations as members of a different domain. However, you must cross-certify the servers. 
 2. Install WebSphere Application Server and enable application level security. If you are using WebSphere Application Server V7, fix pack 5 or later is recommended. Earlier versions send unnecessary but harmless HTTP authentication requests. 
 3. Configure WebSphere Application Server to use the domain controller (also called the KDC) for the LDAP repository.



Procedure  1. To configure your single-server environment for SSO, see chapter 7 ("Single sign-on to WebSphere Application Server using SPNEGO") of the IBM Redbook, Implementing Kerberos in a WebSphere Application Server Environment [http://www.redbooks.ibm.com/abstracts/sg247771.html]. 


Step 2: Verify your SSO configuration

To verify that SPNEGO/Kerberos is configured correctly, you must configure the web browsers on the client workstations in your environment and authenticate to the LDAP server by using SSO.

Prerequisite
Ensure that the browsers that are installed on the client workstations support SPNEGO authentication. 

Procedure 

 1. Log into the client workstation by using an Active Directory user ID. 
 2. Configure your web browser per chapter 7 of the IBM redbook, Implementing Kerberos in a WebSphere Application Server Environment [http://www.redbooks.ibm.com/abstracts/sg247771.html]. 
 3. From your web browser, connect to the snoop servlet by using the fully qualified host name of the WebSphere Application Server instance where you plan to deploy IBM Atlas Policy Suite. When SSO is correctly configured, the snoop servlet issues an authentication challenge to your web browser, which initiates the SPNEGO/Kerberos exchange.
    For example, enter: appserver1.addomain.home.com:9080/snoop 
 4. If the snoop servlet runs successfully, you can configure and deploy IBM Atlas Policy Suite. If the snoop servlet does not run successfully, troubleshoot your SSO configuration before you continue. For more information, see theTroubleshooting your deployment section [http://www-01.ibm.com/support/docview.wss?uid=swg27036837#ts]at the end of this document.
    


Step 3: Configure and deploy IBM Atlas Policy Suite (PolicyAtlas) or the IBM Employee Portal (AtlasPortal) with Kerberos/SPNEGO or both

Procedure  1. Run the Atlas installation program. AtlasHome is the installation directory, for example, AtlasHome:C:\Program Files (x86)\IBM\IBM_Atlas_Policy_Suite 
 2. Edit the AtlasHome\Atlas\Properties\ssoConfig.properties file and set the following properties:
    sso.enabled=true
    sso.type=KRB
    # LoginID or other column used as the Person identifier
    sso.column.name=LoginID 
 3. Open a command prompt or shell and enter the command to set the WAS_HOME environment variable. This is a convenience for referencing WebSphere's Apache Ant. For example, set WAS_HOME=C:\Program Files\IBM\WebSphere\AppServer 
 4. Change to the /AtlasHome directory, for example cd /AtlasHome


To configure IBM Atlas Policy Suite for Kerberos: 

 1. Run the Ant command to update PolicyAtlas.ear for Kerberos using the supplied Ant script. For example (in a Windows environment), "%WAS_HOME%\bin\ws_ant.bat" -buildfile Atlas\setup\WebSphere\Kerberos\updateForKerberos.xml 
 2. Install Atlas\EAR\PolicyAtlas.ear with the WebSphere Integrated Solutions Console. 
 3. Specifiy the class loader order.  1. In the WebSphere Integrated Solutions Console, navigate to the Enterprise Applications node in the Task menu. 
     2. Click the name of the application that you just deployed (AtlasPortal). 
     3. In the Modules section of the Configuration tab, click Manage Modules. 
     4. In the Module column, click web.war. 
     5. In the General Properties section, for Class loader order, select Classes loaded with local class loader first (parent last). 
     6. Click Apply and then click Save in the Messages section.
    
    
 4. Map PolicyAtlas's security role. See "Map Security role using the WebSphere Integrated Solutions Console" below.
    
 5. Start the application with the WebSphere Integrated Solutions Console.


To configure the IBM Employee Portal for Kerberos: 

 1. Run the Ant command to update AtlasPortal.ear by using the supplied Ant script, for example, "%WAS_HOME%\bin\ws_ant.bat" -buildfile Portal\Kerberos\WebSphere\updateForKerberos.xml 
 2. Install Portal\Kerberos\WebSphere\AtlasPortal.ear with the WebSphere Integrated Solutions Console. Important: Do not install the WAR file. Only the EAR file in this directory supports Kerberos. 
 3. Map AtlasPortal's security role. See "Map Security role using the WebSphere Integrated Solutions Console." 
 4. Start the application with the WebSphere Integrated Solutions Console.


Map Security role by using the WebSphere Integrated Solutions Console 

 1. Navigate to Applications > Application Types > WebSphere enterprise applications. 
 2. Click the appropriate application (PolicyAtlas or AtlasPortal). 
 3. Click Security role to user/group mapping. 
 4. In the Select column, select the row for the Authenticated role 
 5. In the Map Special Subjects pull-down menu, select All Authenticated in Application's Realm. 
 6. Click OK.


Troubleshooting your deployment 


Problem 
You receive this error message when attempting to connect to the Policy Atlas URL: 

Unauthorized Page you cannot access this page because you do not have the required permissions. Contact your Atlas System Administrator.

Solution 
Check the following items: 

 1. The logged in Active Directory user is also defined as an Atlas person. To check whether the Active Directory account is also defined as an Atlas person, open the IBM Atlas Policy Suite web client, click Admin > Persons, and ensure that the Active Directory account is also defined as an Atlas person. 
 2. "PolicyAtlas" is in the filter criteria of SPNEGO Web Authentication in the WebSphere Integrated Solutions Console. Chapter 7 of the IBM redbook, Implementing Kerberos in a WebSphere Application Server Environment [http://www.redbooks.ibm.com/abstracts/sg247771.html]., has an example of specifying snoop in the filter criteria. 
    Example: To specify SPNEGO for both snoop and PolicyAtlas: request-url^=snoop|PolicyAtlas 
 3. 

Problem 
You see the following error in the application server log: 
[ 10/18/13 10:35:53:600 PDT] 00000020 srt W om.ibm.ws.webcontainer.srt.SRTServletResponse addSessionCookie WARNING: Cannot set session cookie. Response already committed
[10/18/13 10:35:53:694 PDT] 00000020 Context E com.ibm.ws.security.spnego.Context begin CWSPN0011E: A non-valid SPNEGO token has been encountered while authenticating a HttpServletRequest 

Solution 
Usually, the Service Principal Name (SPN) user’s password has been changed. Reset the SPN user’s password to what it was when the keytab file was generated or generate a new keytab file while you are logged in with the current (changed) password. 

Problem 
You receive unnecessary 401 responses. 

Solution 
Upgrade to WebSphere Application Server Version 7.0.0.5. This is known issue that occurs only in a WebSphere Application Server Version 7.0.0.0 environment.