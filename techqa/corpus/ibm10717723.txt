Title: IBM WPA and S&P failures - United States

Text:
 HOW TO

SUMMARY
WPA and S&P began failing. with these sorts of errors

KSY_Overload_Critical (6/12), KSY_Summarization_Failures (6/12), KSY_Pruning_Failures (6/12). There are also KHD_Error_Critical alerts for CTX_JDBCError, CTX_ServerTimeout and CTX_RPCError. 

OBJECTIVE
Resolve issues and restore WPA/S&P function.

STEPS
The error condition is very clear in the S&P log - Summarization and Pruning - prodomega1l_sy_java_5b158bd4-01.log 

== 37553 t=work1 EXCEPTION: com.tivoli.twh.ksy.core.KSYException: com.ibm.db2.jcc.am.SqlException: The transaction log for the database is full.. SQLCODE=-964, SQLSTATE=57011, DRIVER=3.63.123 

DB2 maintains a transaction log, sort of a before and after copy of data blocks that are written to the database. That has gotten full and is blocking some or all of the SQL which updates the database. In particular the "pruning" logic is broken which means the detail data keeps extending instead of following your instructions. 

The following is a guideline about how to make the transaction log larger. In many cases it will be a database admin who does the work, but if you are who has to implement the changes, here are the instructions. They are for both TDW and the TEPS database, although this case involves the TDW. 

The first thing we want to do is see what the current transaction log size is set to. Log in as your DB2 instance owner and run the following command depending on whether you are on Unix or Windows: 

Unix:
db2 get db cfg for [warehous / TEPS] | grep LOG 

Windows:
db2 get db cfg for [warehous / TEPS] | find "LOG" 

It will be identified by LOGFILESIZ. I typically recommend making the changes below if your sizes match what is shown. 

the Log file size (4KB) (LOGFILSIZ) = 1024 - make this 4096 
Number of primary log files (LOGPRIMARY) = 13 - make this 20 

If the size is already something different than what is shown I usually recommend doubling the LOGFILESIZ value (LOGPRIMARY is not a necessary change). 

Run this command to change them to the values I show above: 

db2 update db cfg for warehous using LOGFILSIZ 4096 LOGPRIMARY 20 

After making the changes above: 

stop the TEPS, and warehouse proxy agent 

Log into DB2 and run this command in order to see if any connections are still active: 

db2 list applications 

If connections are still active, db2stop wonâ€™t stop the database 

db2stop force - will force the connections to disconnect and take db2 down 

Wait until all connections to TEPS and WAREHOUS are gone (from the output of the "db2 list applications" output). Then start up the TEPS and warehouse proxy agent. 

On the command notice it has [warehous / TEPS] - use whichever database is appropriate