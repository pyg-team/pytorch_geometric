Title: IBM IT03096: THE DISCOVERY OF HYPERVISOR IS FAILING IN THE TRACE.LOG FILE AND THE HYPERVISOR IS NOT VISIBLE IN THE UI. - United States

Text:
  DIRECT LINK TO FIX
2.3.0.1-CSI-ISCO-IF0009 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FTivoli%2FIBM+SmartCloud+Orchestrator&fixids=2.3.0.1-CSI-ISCO-IF0009&source=SAR]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The discovery of hypervisor is failing in the trace.log file
   and the hypervisor is not visible in the UI. The exception will
   happen at first discovery attempt and later when the 'discover'
   action will be triggered from the Cloud Group details page.
   
   The following exception will be visible in the trace.log file:
   
   [2014-06-05 12:55:05:020 EDT] 00000664 groovy        E
   app.scripts.groovy.rainmaker.core.SQLUtils.groovy  CWZCO1007E:
   Could not create resource: [pdq][10104][2.7.116] An error
   prevented the update operation from completing successfully.;
   Caused by: com.ibm.db2.jcc.am.SqlDataException: DB2 SQL Error:
   SQLCODE=-302, SQLSTATE=22001, SQLERRMC=null, DRIVER=4.14.113
   [2014-06-05 12:55:05:127 EDT] 00000664 groovy        E
   app.scripts.groovy.rainmaker.core.SQLUtils.groovy
   com.ibm.pdq.runtime.exception.DataRuntimeException:
   [pdq][10104][2.7.116] An error prevented the update operation
   from completing successfully.;  Caused by:
   com.ibm.db2.jcc.am.SqlDataException: DB2 SQL Error:
   SQLCODE=-302, SQLSTATE=22001, SQLERRMC=null, DRIVER=4.14.113
   
   com.ibm.pdq.runtime.internal.db.JdbcData.update_(JdbcData.java:4
   38)
   
   com.ibm.pdq.runtime.internal.db.DataImpl.update(DataImpl.java:54
   5)
       zero.data.Manager.insert(Manager.java:1605)
       zero.data.groovy.Manager.insert(Manager.java:1448)
   
   groovy.rainmaker.core.SQLUtils._createResource(SQLUtils.groovy:9
   0)
   
   groovy.rainmaker.core.SQLUtils$_createResource_closure4.doCall(S
   QLUtils.groovy:67)
   
   groovy.rainmaker.core.SQLUtils$_createResource_closure4.doCall(S
   QLUtils.groovy)
   
   groovy.rainmaker.core.SQLUtils.inTransaction(SQLUtils.groovy:648
   )
   
   groovy.rainmaker.core.SQLUtils$inTransaction.callCurrent(Unknown
   Source)
   
   groovy.rainmaker.core.SQLUtils.createResource(SQLUtils.groovy:67
   )
   
   groovy.rainmaker.core.SQLUtils.createResource(SQLUtils.groovy)
   
   groovy.rainmaker.cloud.PhysicalMachines.createPhysicalMachine(Ph
   ysicalMachines.groovy:56)
   
   groovy.rainmaker.cloud.PhysicalMachines.createPhysicalMachine(Ph
   ysicalMachines.groovy)
   
   groovy.rainmaker.cloud.VMSupportAccess._addPhysicalMachineFromHy
   pervisor(VMSupportAccess.groovy:1166)
   
   groovy.rainmaker.cloud.VMSupportAccess$__buildHypervisorReturnOb
   ject_closure31.doCall(VMSupportAccess.groovy:550)
   
   groovy.rainmaker.cloud.VMSupportAccess._buildHypervisorReturnObj
   ect(VMSupportAccess.groovy:540)
   
   groovy.rainmaker.cloud.VMSupportAccess$_buildHypervisorReturnObj
   ect.callCurrent(Unknown Source)
   
   groovy.rainmaker.cloud.VMSupportAccess._accessHypervisorEndpoint
   (VMSupportAccess.groovy:341)
   
   groovy.rainmaker.cloud.VMSupportAccess$_accessHypervisorEndpoint
   .callCurrent(Unknown Source)
   
   groovy.rainmaker.cloud.VMSupportAccess.discoverHypervisorDetails
   (VMSupportAccess.groovy:96)
       clouds._handleOnRetrieveDiscover(clouds.groovy:1304)
       clouds$_handleOnRetrieveDiscover.callCurrent(Unknown Source)
       clouds.onRetrieve(clouds.groovy:439)
   Caused by: com.ibm.db2.jcc.am.SqlDataException: DB2 SQL Error:
   SQLCODE=-302, SQLSTATE=22001, SQLERRMC=null, DRIVER=4.14.113
       com.ibm.db2.jcc.am.ed.a(ed.java:669)
       com.ibm.db2.jcc.am.ed.a(ed.java:60)
       com.ibm.db2.jcc.am.ed.a(ed.java:127)
       com.ibm.db2.jcc.am.oo.c(oo.java:2715)
       com.ibm.db2.jcc.am.oo.a(oo.java:2163)
       com.ibm.db2.jcc.t4.ab.o(ab.java:844)
       com.ibm.db2.jcc.t4.ab.j(ab.java:266)
       com.ibm.db2.jcc.t4.ab.d(ab.java:55)
       com.ibm.db2.jcc.t4.p.c(p.java:44)
       com.ibm.db2.jcc.t4.qb.j(qb.java:147)
       com.ibm.db2.jcc.am.oo.kb(oo.java)
       com.ibm.db2.jcc.am.po.b(po.java:4451)
       com.ibm.db2.jcc.am.po.b(po.java:4629)
       com.ibm.db2.jcc.am.po.ic(po.java:799)
       com.ibm.db2.jcc.am.po.executeUpdate(po.java:777)
   
   org.apache.commons.dbcp.DelegatingPreparedStatement.executeUpdat
   e(DelegatingPreparedStatement.java:101)
   
   com.ibm.pdq.runtime.internal.db.JdbcData.update_(JdbcData.java:4
   14)
   
   com.ibm.pdq.runtime.internal.db.DataImpl.update(DataImpl.java:54
   5)
       zero.data.Manager.insert(Manager.java:1605)
       zero.data.groovy.Manager.insert(Manager.java:1448)
   
   groovy.rainmaker.core.SQLUtils._createResource(SQLUtils.groovy:9
   0)
   
   groovy.rainmaker.core.SQLUtils$_createResource_closure4.doCall(S
   QLUtils.groovy:67)
   
   groovy.rainmaker.core.SQLUtils$_createResource_closure4.doCall(S
   QLUtils.groovy)
   
   groovy.rainmaker.core.SQLUtils.inTransaction(SQLUtils.groovy:648
   )
   
   groovy.rainmaker.core.SQLUtils$inTransaction.callCurrent(Unknown
   Source)
   
   groovy.rainmaker.core.SQLUtils.createResource(SQLUtils.groovy:67
   )
   
   groovy.rainmaker.core.SQLUtils.createResource(SQLUtils.groovy)
   
   groovy.rainmaker.cloud.PhysicalMachines.createPhysicalMachine(Ph
   ysicalMachines.groovy:56)
   
   groovy.rainmaker.cloud.PhysicalMachines.createPhysicalMachine(Ph
   ysicalMachines.groovy)
   
   groovy.rainmaker.cloud.VMSupportAccess._addPhysicalMachineFromHy
   pervisor(VMSupportAccess.groovy:1166)
   
   groovy.rainmaker.cloud.VMSupportAccess$__buildHypervisorReturnOb
   ject_closure31.doCall(VMSupportAccess.groovy:550)
   
   groovy.rainmaker.cloud.VMSupportAccess._buildHypervisorReturnObj
   ect(VMSupportAccess.groovy:540)
   
   groovy.rainmaker.cloud.VMSupportAccess$_buildHypervisorReturnObj
   ect.callCurrent(Unknown Source)
   
   groovy.rainmaker.cloud.VMSupportAccess._accessHypervisorEndpoint
   (VMSupportAccess.groovy:341)
   
   groovy.rainmaker.cloud.VMSupportAccess$_accessHypervisorEndpoint
   .callCurrent(Unknown Source)
   
   groovy.rainmaker.cloud.VMSupportAccess.discoverHypervisorDetails
   (VMSupportAccess.groovy:96)
       clouds._handleOnRetrieveDiscover(clouds.groovy:1304)
       clouds$_handleOnRetrieveDiscover.callCurrent(Unknown Source)
       clouds.onRetrieve(clouds.groovy:439)
   [2014-06-05 12:55:05:212 EDT] 00000664 groovy        E
   app.scripts.groovy.rainmaker.cloud.VMSupportAccess.groovy
   CWZCL3165E: An access attempt failed for hypervisor ID
   <id-goes-here>, address
   <hypervisor-address-region-and-name-goes-here>:
   java.lang.Exception: There was an internal database error - see
   the trace file for details.
   
   
    
   
   

LOCAL FIX
 *  N/A
   
   
    
   
   

PROBLEM SUMMARY
 *  BM SmartCloud Orchestrator performs the discovery of the
   OpenStack Regions and Avaibility Zones. For each Availability
   Zone a Cloud Group and corresponding Hypervisors is created. As
   the name of the Cloud Group and Hypervisor is made using the
   follwing pattern: <regionName>_<availabilityZoneName>, there is
   a possiblity that the name exceeds the maximum lengts and as a
   result could not be stored in the IBM SmartCloud Orchestrator
   database. Finally, the Cloud Group and Hypervisor for an
   Availability Zone with a long name will not appread in the user
   interface.
   OpenStack does not assume the maximum lenght neighter of the
   region name nor the availability zone name. IBM SmartCloud
   Orchestrator has as DB2 database schema that put a constrain on
   the lenght of those names. In case of long naming used by
   customers it could happend that the total length of the
   <regionName>_<availabilityZoneName> will execeeds the database
   column size.
   
   
    
   
   

PROBLEM CONCLUSION
 *  IBM SmartCloud Orchestrator database has been updated to allow
   the <regionName>_<availabilityZoneName> name lenght to be up to
   1024 characters. APAR contains the code change that addresses
   this.
   
   
    
   
   

TEMPORARY FIX
 *  Use short names.
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT03096
   
   
 * REPORTED COMPONENT NAME
   IWD FOR SCO/SCP
   
   
 * REPORTED COMPONENT ID
   5765PS1SC
   
   
 * REPORTED RELEASE
   400
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2014-07-11
   
   
 * CLOSED DATE
   2014-09-19
   
   
 * LAST MODIFIED DATE
   2014-09-19
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  999
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IWD FOR SCO/SCP
   
   
 * FIXED COMPONENT ID
   5765PS1SC
   
   

APPLICABLE COMPONENT LEVELS
 * R400 PSY
   UP