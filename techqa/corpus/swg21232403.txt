Title: IBM SOS above the line after many storage violations when STGRCVY=NO - United States

Text:
short on storage ; SOS ; DFHSM0133 DFHSM0102 MSGDFHSM0102 STGRCVY EUDSA UDSA transaction isolation traniso AEXZ 5655M1500 R640 640 R400 400 HCI6400 R650 650 R500 500 HCI6500 5655-M15 5655M15 ; 5655S9700 R660 660 R600 600 HCI6600 R670 670 R700 700 HCI6700 5655-S97 5655S97 ; 5655Y0400 R680 680 R800 800 HCI6800 5655-Y04 5655Y04 KIXINFO TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are running CICS Transaction Server for z/OS (CICS TS) and encounter a short on storage (SOS) condition above the line. This occurs after many storage violations. You have storage recovery (STGRCVY) set to NO and transaction isolation (TRANISO) set to YES. 

CAUSE
Excessive amount of storage violations and STGRCVY=NO specified. With STGRCVY=NO, if a running task issues a freemain for a piece of its storage, and it is found to be violated, this task will be abended AEXZ (abendAEXZ), backout will occur, and the storage associated with the violation will be orphaned. 

However, tasks *DO NOT* typically issue their own FREEMAINs for storage that they have obtained so CICS releases it for them at task termination. In this case, either the task issued a syncpoint at which point any data would be committed prior to any notification of the storage violation, so when the violation is detected no backout would occur. Or if no syncpoint was issued, CICS would syncpoint as a result of the EXEC CICS RETURN. Again this would be PRIOR to any freemain of task storage, so there would be no notification of the storage violation. 

Once syncpoint is finished and CICS is cleaning up the tasks control blocks, the freemain for the storage would be issued and then the storage violation would be detected. By this time, the task is gone so there is no task to abend AEXZ and nothing is backed out.

DIAGNOSING THE PROBLEM
If the DFHSM0102 message contains code 0F0C. This indicates the violation has been detected by the XM task at task termination. If you look at one of these dumps, you will notice the task that experienced the violation does not show up in many domains like KE or AP, since its control blocks have been cleaned up. In this case, STGRCVY=NO does not cause the task to be abended, but the storage associated with the storage violation will be orphaned. 


For this dump at the time of the SOS, it showed they had received x'109' (265) storage violations (found from looking at the DU domain for SM0102). They also were running with transaction isolation, which allocates a minimum of 1M of EUDSA for each task. Their log only showed 2 abend AEXZ which indicates the majority of these storage violations were detected at task termination. So for each storage violation occurring in EUDSA storage, at least 1M was orphaned 


RESOLVING THE PROBLEM
You need to resolve the storage violations that are occurring. In the meantime, you can specify STGRCVY=YES. With STGRCVY=YES, CICS will still issue message DFHSM0102 reporting the storage violation but will attempt to repair the storage violation. The storage will be freed at the end of the task, preventing this build up of orphaned storage. You can read more about this in the CICS documentation under STGRCVY [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.ts.doc/dfha2/parameters/dfha2_stgrcvy.html].



PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server