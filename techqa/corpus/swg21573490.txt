Title: IBM ncp_poller cannot connect to monitor db - United States

Text:
db2 ; libdb2.so.1 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When running ITNM as non-root, the poller fails to connect to the DB2 database 

SYMPTOM
The messages shown in the ncp_poller.DOMAIN.trace file will be similar to these: 

Could not open /home/netcool/opt/IBM/tivoli/netcool/precision/platform/linux2x86/lib/libNcpDbDb2.so: libdb2.so.1: cannot open shared object file: No such file or directory

Thu Nov 17 16:32:30 2011 Warning: A required dynamic library file is missing. found in file CNcpDbFactory.cc at line 783 - When attempting to open shared lib: /home/netcool/opt/IBM/tivoli/netcool/precision/platform/linux2x86/lib/libNcpDbDb2.so

Thu Nov 17 16:32:30 2011 Warning: A generic non-fatal error has occurred found in file CNcpDbPoller.cc at line 111 - Error: No databse configured for dbId: NCMONITOR

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CDbSnmpTargetFactory.cc at line 79 - Cannot get domain information from database

Thu Nov 17 16:32:30 2011 Warning: A generic non-fatal error has occurred found in file CChangedConfigPoller.cc at line 74 - SNMP target poller unable to connect to the database

Thu Nov 17 16:32:30 2011 Warning: A generic non-fatal error has occurred found in file CNcpPollerApplication.cc at line 615 - No changes to the SNMP configuration will be picked up without restarting the poller

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CMib.cc at line 1241 - cannot create database handle

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CMib.cc at line 174 - cannot initialise database connection for 'MIB'

Thu Nov 17 16:32:30 2011 Warning: Cannot connect to database found in file CEntityAlert.cc at line 70

Thu Nov 17 16:32:30 2011 Warning: A generic non-fatal initialisation error has occurred. found in file IPollDataMux.cc at line 46

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CMonitorApplication.cc at line 141 - cannot retrieve domain manager information

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CMonitorTemplateManager.cc at line 77 - cannot create DB handle for 'NCMONITOR'

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CMonitorPolicyManager.cc at line 136 - cannot create DB handle for 'NCMONITOR'

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CMonitorPolicyManager.cc at line 713 - no monitor DB

Thu Nov 17 16:32:30 2011 Warning: An unexpected nil pointer reference has been found. found in file CRealTimeTblCallback.cc at line 422


CAUSE
The DB2 libraries are not included in the ld.so.conf file, thus cannot be executed when the sticky bit (or access-right flag) is present on the ncp_poller processes.


ENVIRONMENT
non-root ITNM install, DB2 databases



RESOLVING THE PROBLEM
1 ) Stop your ITNM processes the normal ITNM user: 

[ netcool@testbox : ~/opt/IBM/tivoli/netcool/log/precision ]
$ itnm_stop ncp

[ netcool@testbox : ~/opt/IBM/tivoli/netcool/log/precision ]
$ itnm_status
OMNIbus:
nco_pad RUNNING PID=3799 NCO_PA
nco_objserv RUNNING PID=3827 NCOMS
nco_p_mttrapd RUNNING PID=4082 NCOMS
Network Manager:
ncp_ctrl NOT RUNNING
Tivoli Integrated Portal:
Server RUNNING PID=6555

2) As the root user, edit your /etc/ld.so.conf:
[ root@testbox : /etc ]
# vi /etc/ld.so.conf
include ld.so.conf.d/*.conf
/home/netcool/opt/IBM/tivoli/netcool/precision/platform/linux2x86/lib
/home/netcool/opt/IBM/tivoli/netcool/platform/linux2x86/lib
....
/home/netcool/sqllib/lib32/


3) As root user, run ldconfig. Use the "-v" option to get verbose output:
[ root@testbox : /etc ]
# ldconfig -v
/usr/lib/mysql:
libmysqlclient_r.so.14 -> libmysqlclient_r.so.14.0.0
libmysqlclient_r.so.10 -> libmysqlclient_r.so.10.0.0
...........

4) As your ITNM user, restart your ITNM processes:
[ netcool@testbox : ~/opt/IBM/tivoli/netcool/log/precision ]
$ itnm_start ncp
Network Manager:
Domain: DOMAIN
ncp_ctrl RUNNING PID=31961 DOMAIN
ncp_store IDLE PID= DOMAIN
ncp_class IDLE PID= DOMAIN
ncp_auth IDLE PID= DOMAIN
ncp_model IDLE PID= DOMAIN
ncp_disco IDLE PID= DOMAIN
ncp_f_amos IDLE PID= DOMAIN
ncp_d_helpserv IDLE PID= DOMAIN
ncp_config IDLE PID= DOMAIN
ncp_poller IDLE PID= DOMAIN
nco_p_ncpmonitor IDLE PID= DOMAIN
ncp_ncogate IDLE PID= DOMAIN
ncp_webtool IDLE PID= DOMAIN