Title: IBM RAM Migration with RAM Setup (ram.setup) on WAS 8.0.0.10+ or 8.5.5.4+ and SSLv3 disabled error - United States

Text:
java.lang.IllegalArgumentException; Only SSLv3 was enabled while com.ibm.jsse2.disableSSLv3 is set to true; SSLv3; poodle; security; RAM setup; RAMSetup; ram.setup; database; migration; upgrade; RTC; CCM; JTS TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Using the RAM Setup web application to upgrade from Rational Asset Manager (RAM) 7.5.2.1 to 7.5.2.2, results in an SSLv3 error after the Database setup and the migration of the IBM Rational Team Concert (RTC) databases cannot proceed. 

SYMPTOM

...org.apache.jasper.el.JspELException: /index.jsp(108,3)
'${ramConfigurationBean.lifecycleConfigurationBean.configurationStatus}'
Error reading 'configurationStatus' on type
com.ibm.ram.repository.setup.web.access.LifecycleConfigurationBean
at
org.apache.jasper.el.JspValueExpression.getValue(JspValueExpression.java
:112)
at com.ibm._jsp._index._jspx_meth_c_set_28(_index.java:1736)
at ...
Caused by: java.lang.IllegalArgumentException: Only SSLv3 was enabled while com.ibm.jsse2.disableSSLv3 is set to true
at com.ibm.jsse2.zb.a(zb.java:85)
at ...
....
com.ibm.jsse2.SSLSocketFactoryImpl.createSocket(SSLSocketFactoryImpl.java:6)
at
com.ibm.ram.repository.setup.web.rtc.client.HttpclientSecureProtocolSocketFactory.createSocket
(HttpclientSecureProtocolSocketFactory.java:115)
at ...



CAUSE
SSLv3 is disabled on IBM WebSphere Application Server (WAS) WAS v7.0.0.37,v8.0.0.10+ or v8.5.5.4+ 

ENVIRONMENT
Any supported Windows or Linux or AIX

DIAGNOSING THE PROBLEM
In the trace you see:





Caused by: java.lang.IllegalArgumentException: Only SSLv3 was enabled while com.ibm.jsse2.disableSSLv3 is set to true


RESOLVING THE PROBLEM
The invocation by the RAM Setup web application to start the RTC 4.0.1+ repotool batch/shell script for CCM or JTS has a dependency on SSLv3. WAS v7.0.0.37, v8.0.0.10+ or v8.5.5.4+ have disabled SSLv3. RAM Setup cannot kick off the repotools command to upgrade/populate the RTC databases because of a dependency on SSLv3.

This problem should not be confused with RTC Defect/WI 341700: 
- repotools-jazz (for ccm) -addTables throwing SEVERE: Failed to register SecureProtocolSocketFactory which has a similar error: 


java.security.NoSuchAlgorithmException: SSLv3 SSLContext not available, since it was possible to run the repotools scripts directly in a cmd prompt or shell.


See also:
- Security Bulletin: Vulnerability in SSLv3 affects multiple IBM Rational products based on IBM Jazz technology (CVE-2014-3566) [http://www-01.ibm.com/support/docview.wss?uid=swg21687762]

The repotools themselves use the JVM that is local to it and not the one in a WAS server.

For example in RAM 7.5.5.2 with RTC 4.0.7, 
{server profile}\config\cells\{yourcell}\RTC\[server{n} | {RTC Cluster name} ]\v407\jazz\server\
folder has the "repotools-ram{ccm|jts}.bat" scripts, and there is a local jre:
{server profile}\config\cells\{yourcell}\RTC\[server{n} | {RTC Cluster name} ]\v407\jazz\server\jre

For example on Windows the bat file has:
set START_DIR=%~dp0
set JAVA="%START_DIR%jre\bin\java"
The %~dp0 (that's a zero) variable when referenced within a Windows batch file will expand to the drive letter and path of that bat file.
In Linux: START_DIR=`dirname "$0"`

However, the RAM Setup application that invokes repotools is running on the WAS server using the WAS JVM and invokes the repotools script through a java ssl socket connection api. The RAM Setup fails to start as shown in the trace if SSLv3 is disabled, preventing the upgrade/migration.

------------

WAS v7.0.0.37+/v8.0.0.10+/v8.5.5.4+ disabled the SSLv3 protocol because of the SSLv3 Poodle security vulnerability described in:
- Security Bulletin: Vulnerability in SSLv3 affects IBM WebSphere Application Server (CVE-2014-3566) [http://www.ibm.com/support/docview.wss?uid=swg21687173]

The above technote indicates it is also possible to have an earlier WAS release with the APAR fix to disable SSLv3.


The temporary fix involves changes to the WAS JVM to disable SSLv3.
You can temporarily work around the problem by setting this new WAS 7.0.0.37+/8.0.0.10+/8.5.5.4+ JVM property
-Dcom.ibm.jsse2.disableSSLv3=false
which restores SSLv3 as it was in earlier WAS versions.

Interim Workaround:

If using WAS v7.0.0.37+ (with latest JDK) , v8.0.0.10+ or v8.5.5.4+


 1. Enable SSLv3 while doing RAM setup and finishing any RTC database migration being done using repotools, , by setting this new WAS 8.0.0.10+/8.5.5.4+ JVM property
    -Dcom.ibm.jsse2.disableSSLv3=false
    in the WAS admin console for Generic JVM arguments as follows:
    
    Navigate to Servers > Server Types > WebSphere application servers 
    > <servername {e.g. server1} >
    Configuration [Tab] > Java and Process Management > Process Definition
    Navigate to Additional Properties 
    > Java Virtual Machine : Generic JVM arguments [textbox]
    
    For more details. see:
    - Setting generic JVM arguments in WebSphere Application Server [http://www.ibm.com/support/docview.wss?uid=swg21417365]
    
    This setting restores SSLv3 as it was in the JVMs for earlier WAS versions.
    In the case of a cluster do this for every WAS server/JVM, Node and the DMgr.
    You need to restart WAS (and all WAS servers/JVMs, Nodes and DMgr in the case of a cluster). after saving the change and redo RAM Setup.
    
    Note: Close all Windows or anything referring to the WAS file system folders and any Browser web apps like the admin console or RAM Setup using that WAS, before doing the WAS server restart
    
    Wait some time after migration to allow for testing and use of RAM, to be sure all is well with the RAM upgrade in case you need to re-do RAM Setup, before going into production.
    
    This cannot be a long term solution since it leaves you exposed to the SSLv3 Poodle security vulnerability. 
    
    So next,....
    
    
 2. When "completely" finished the RAM upgrade/migration, restart WAS.
    Then disable SSLv3 by removing that JVM setting and again restart WAS as explained in 1. (above).
    
    


Contact IBM Support [http://www-01.ibm.com/software/rational/support/contact.html] for RAM if this does not help.