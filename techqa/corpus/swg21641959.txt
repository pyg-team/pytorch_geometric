Title: IBM Login failed for user 'DOMAIN\USERID$' - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 - New installation of CDM
- Unable to access CDM

Review of the AllErrors.log recorded the below error message.
Note. The userid referenced is in fact the application servername plus the '$'.


SYMPTOM
AllErrors.log:
[11] FATAL Ibm.CognosDM.Services.WebHost.Global - (null) Exception has been thrown by the target of an invocation. ? ? ? System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---> System.Data.SqlClient.SqlException: Login failed for user 'DOMAIN\USERID$'.
at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection)
at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()
at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
at System.Data.SqlClient.SqlInternalConnectionTds.CompleteLogin(Boolean enlistOK)
at System.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, Boolean redirectedUserInstance, SqlConnection owningObject, SqlConnectionString connectionOptions, TimeoutTimer timeout)
at System.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(SqlConnection owningObject, TimeoutTimer timeout, SqlConnectionString connectionOptions, String newPassword, Boolean redirectedUserInstance)
at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, Object providerInfo, String newPassword, SqlConnection owningObject, Boolean redirectedUserInstance)
at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection)
at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnection owningConnection, DbConnectionPool pool, DbConnectionOptions options)
at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject)
at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject)
at System.Data.ProviderBase.DbConnectionPool.GetConnection(DbConnection owningObject)
at System.Data.ProviderBase.DbConnectionFactory.GetConnection(DbConnection owningConnection)
at System.Data.ProviderBase.DbConnectionClosed.OpenConnection(DbConnection outerConnection, DbConnectionFactory connectionFactory)
at System.Data.SqlClient.SqlConnection.Open()
at Ibm.CognosDM.Cache.Storage.Providers.MsSqlCacheStorage.VerifyConnectionString()
at Ibm.CognosDM.Cache.Storage.Providers.MsSqlCacheStorage..ctor(String name, String connectionString, String schemaName, ICacheStorageEncryptionProvider encryptionProvider, Int32 pageSize)
--- End of inner exception stack trace ---


CAUSE
User (CDM application) missing SQL Server permission. 

Application and SQL Server on different servers. The default identity (LocalSystem) for the CDM application pool, doesn't have SQL Server permissions.


RESOLVING THE PROBLEM
Create a SQL Server login for the specified user (CDM AppPool identity "LocalSystem"). 
1. In SQL Server Management Studio, open Object Explorer and expand the folder of the server instance in which to create the new login.
2. Right-click the Security folder, point to New, and then click Login.
3. On the General page, enter the name 'DOMAIN\USERID$' (without quotes) in the 'Login name' box. 
4. Select Windows Authentication.
5. On the Server roles page, check the 'public' role.
6. On the User mapping page, check the databases for CDM core (by default, it is named CognosDM), and, in the "Database role membership for:", check 'public', 'db_datareader' and 'db_datawriter'. Note that the database name can be changed during installation.
7. Repeat the previous step for the CDM cache (CognosDMCache) and XBRL (CognosDMXbrl) databases, if they exist.
8. Click OK. 

Note. Another solution would be to change the AppPool identity to a domain user that has admin rights to the CDM Application server as well as SQL Server permissions.


RELATED INFORMATION
#IBM CDM - Best Practices Document (Page 4) [http://www-01.ibm.com/support/docview.wss?uid=swg27036748&aid=1]