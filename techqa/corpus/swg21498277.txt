Title: IBM With WebSphere Process Server (WPS) and IBM Business Process Manager (BPM), the LTPA Token expires although Timeoutleniency is set correctly - United States

Text:
WebSphere Process Server; LTPA; TokenExpiredException; SECJ0371W; digest; timeoutleniency; v70rnotes TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The LTPA Token expires although the Timeoutleniency value is set and the time has not elapsed yet. 

SYMPTOM
The following warning message occurs: 

SECJ0371W: Validation of the LTPA token failed because the token expired with the following info: Token expiration Date: <date>, current Date: <laterDate>

You might also see TokenExpiredExceptions exceptions.

This scenario can take place when you make asynchronous calls from a Business Process Execution Language (BPEL) process to a mediation. Two different digest values (part of the SCA message security header) are seen for the request and response message in the mediation flow.


CAUSE
The exceptions are thrown immediately after the LTPA Token Timeout value is reached, which suggests that the Timeoutleniency value is not taken into account at all. This scenario occurs because the digest check returns a false value. As a result of the SCA security implementation, the LTPA Token is not refreshed after it has expired. Consequently, you see the warning messages and TokenExpiredExceptions exceptions.


DIAGNOSING THE PROBLEM
The SystemOut.log file shows the previously mentioned SECJ0371W warning message. 

In addition, you can enable the following trace string on the server, reproduce the issue, and check the trace.log file for the digest values:
*=info:com.ibm.ws.sibx.*=all:com.ibm.wsspi.sibx.*=all:com.ibm.websphere.sibx.*=all:com.ibm.ws.sib.processor.utils.UserTrace=all:com.ibm.wbiserver.transform.*=all 

If the values from the request and response message for the explained scenario are different and you see 'digestChecked = false' for the SCA message in question, you might have run into the described issue.


RESOLVING THE PROBLEM
To address this issue, apply APAR JR39491 [http://www-933.ibm.com/support/fixcentral/swg/quickorder?parent=ibm%2FWebSphere&product=ibm/WebSphere/WebSphere+Process+Server&release=All&platform=All&function=fixId&fixids=7.0.0.3-WS-WBI-IFJR39491.zip&includeSupersedes=0&source=fc] as interim fix on WebSphere Process Server V7. 

The interim fix is also included in the IBM Business Process Manager V7.5.0 Fix Pack 1 (7.5.0.1) [http://www.ibm.com/support/docview.wss?uid=swg24030569] and in the V7.5 Refresh Pack 1 (7.5.1) [http://www.ibm.com/support/docview.wss?uid=swg24031230].

RELATED INFORMATION
 Using Timeoutleniency [http://www.ibm.com/support/docview.wss?uid=swg21445102]
Collect troubleshooting data for WebSphere ESB [http://www.ibm.com/support/docview.wss?uid=swg21268473]


 


Cross reference information Segment Product Component Platform Version Edition Business Integration IBM Business Process Manager Advanced Security AIX, Linux, Linux zSeries, Solaris, Windows, z/OS 7.5 Business Integration IBM Business Process Manager Express Security Linux, Linux zSeries, Windows 7.5 Business Integration IBM Business Process Manager Standard Security AIX, Linux, Linux zSeries, Solaris, Windows 7.5 
PRODUCT ALIAS/SYNONYM
 WPS
BPM