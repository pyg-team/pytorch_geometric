Title: IBM Connection fails due to SQLP_BADLOG errors - United States

Text:
db2; bad_log; corruption; db2cklog; db2diag.log TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Database connections either remote or local may fail if a bad log is encountered. This can happen during a database restart or an HADR replication for example. 

SYMPTOM
Possible messages that can appear in db2diag.log: 

 *  2015-04-07-04.10.50.693000+120 I1825037F2003 LEVEL: Severe
   PID : 7964 TID : 6552 PROC : db2syscs.exe
   INSTANCE: DB2 NODE : 000 DB : XXXXXXX
   APPHDL : 0-1170 APPID: *LOCAL.DB2.150406213008
   AUTHID : XXXXXXX HOSTNAME: XXXXXXX
   EDUID : 6552 EDUNAME: db2agent (XXXXXXX) 0
   FUNCTION: DB2 UDB, data protection services, SQLP_DBCB::setLogState,
   probe:5000
   MESSAGE : ZRC=0x8610000D=-2045771763=SQLP_BADLOG "Log File cannot be
   used"
   DIA8414C Logging can not continue due to an error.
   
   2015-04-07-04.10.50.912000+120 E1827042F1032 LEVEL: Critical
   PID : 7964 TID : 6552 PROC : db2syscs.exe
   INSTANCE: DB2 NODE : 000 DB : XXXXXXX
   APPHDL : 0-1170 APPID: *LOCAL.DB2.150406213008
   AUTHID : XXXXXXX HOSTNAME: XXXXXXX
   EDUID : 6552 EDUNAME: db2agent (XXXXXXX) 0
   FUNCTION: DB2 UDB, base sys utilities, sqleDoForceDBShutdownFODC,
   probe:10
   MESSAGE : ADM14001C An unexpected and critical error has occurred:
   "ForceDBShutdown". The instance may have been shutdown as a
   result. "Automatic" FODC (First Occurrence Data Capture) has been
   invoked and diagnostic information has been recorded in directory
   "C:\ProgramData\IBM\DB2\DB2COPY1\DB2\FODC_ForceDBShutdown_2015-04-07-
   04.10.50.912000_0000\". Please look in this directory for detailed
   evidence about what happened and contact IBM support if necessary to
   diagnose the problem.
   
   2015-04-07-04.10.50.974000+120 I1829244F595 LEVEL: Severe
   PID : 7964 TID : 2896 PROC : db2syscs.exe
   INSTANCE: DB2 NODE : 000 DB : XXXXXXX
   APPHDL : 0-1172 APPID: *LOCAL.DB2.150406213009
   AUTHID : XXXXXXX HOSTNAME: XXXXXXX
   EDUID : 2896 EDUNAME: db2agent (XXXXXXX) 0
   FUNCTION: DB2 UDB, relation data serv, sqlrr_rds_common_pre1, probe:650
   MESSAGE : Marking DBBAD since DB not active
   DATA #1 : Hexdump, 1 bytes
   0x0000000009E4A77A : 02 


CAUSE
The log became corrupted which could be due to a network issue during the transfer of the log from source to the target location or a disk issue which corrupted the log.

DIAGNOSING THE PROBLEM
You can find the corrupted log by checking the db2diag.log messages and can confirm the corruption using the db2cklog tool.



RESOLVING THE PROBLEM
The best solution would be copying the "good" log from the source system or restoring the database using end of backup if you have no "good" logs to copy from. This last option can cause a data loss depending on how many logs were generated following this corrupted log.

RELATED INFORMATION
 Diagnosing corruption when using IBM DB2 [http://www.ibm.com/developerworks/data/library/techarticle/dm-1208corruptiondb2/]
db2cklog - Check archive log file validity command [http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.admin.cmd.doc/doc/r0058520.html]