Title: IBM Sametime on IBM i: server upgrade fails - United States

Text:
sametime for i5/OS; iseries; upgrade fails; unable to upgrade; will not start; won't start TECHNOTE (TROUBLESHOOTING)

PROBLEM
When upgrading a Lotus Sametime installation on IBM i to a new release, either the install of Sametime fails or the install appears to complete but the Sametime server fails to start.

RESOLVING THE PROBLEM
Note: this technote applies only to upgrades of Domino-based Sametime servers, not to the WAS-based servers first introduced in Sametime 8.5. 

 * 
 * 
 * Some of the prerequisite software or fixes might not be installed. This is a common problem. 
 * The TCP/IP configuration might be incorrect. 
 * It may be that the Sametime server was active at the time that you attempted to install the new release of Sametime. When the server is running, various objects are locked and the install job is unable to update them.


Complete the following steps in order to isolate the upgrade problem, and retry the upgrade if necessary: 




Make sure that the Sametime server has fully stopped 

If the upgrade fails, the server may be left in a bad state and some jobs may still be running. Use the WRKDOMSVR command to check the status of your Sametime server. 

If the server does not end after a while (press F5 to refresh status), complete these steps: 

1. Make a note of the subsystem name for the Sametime server. 

2. Type option 6 (end server) next to the server and press F4 (prompt). 

3. Change *CNTRLD to *IMMED and press Enter. (The server should end soon...press F5 to refresh status.) 

4. Run the WRKSBS command to verify that the subsystem for the server has ended. If necessary, end it (specify *IMMED) and then wait a little while to ensure all locks have been released. 






Determine whether your Sametime server was upgraded 

Examine the contents of the UpgradeLog.log file for your Sametime server to determine if the server was upgraded. The UpgradeLog.log file is located in the following IFS directory on your system:/<Server_data_directory>/Trace 

The first line of the UpgradeLog.log file indicates the installed version of Sametime prior to the upgrade. If the server was successfully upgraded to the later release, the file will contain this text: Upgrade of <server_name> ended successfully. 

There is another log file that contains the upgrade information for all Sametime servers on the system. This log file is called Upgrade_to_xxx.log (where xxx is the new version of Sametime) and is located in this directory: /QIBM/UserData/LOTUS/Sametime. 

 * If the upgrade was successful but you are not able to start the server, then there must be a different problem. Consult the following documents: "Sametime for IBM i: Most Common Problems" (#1108423 [http://www.ibm.com/support/docview.wss?rs=203&uid=swg21108423]) or "Sametime for IBM i: Common reasons for server not starting" (#1097835 [http://www.ibm.com/support/docview.wss?rs=203&uid=swg21097835]). 
 * If the server was not upgraded successfully, continue with the next section in this technote. 





Determine whether new release of Sametime was successfully installed 

There are two phases to the upgrade process. In the first phase, the Sametime product software is installed on the system. In the second phase, existing Sametime servers are upgraded. It is possible that the product was successfully installed and that only the second phase failed. 

 1. Run the following command from any OS/400 command line to display the list of products installed on your system: DSPSFWRSC 
 2. Page down to display the following: 5724J23 Lotus Sametime 
 3. Press F11 and verify the "Release" number for 5724J23. For example, Sametime 8.5.1 release is displayed as V8R5M1 and Sametime 8.5 release is displayed as V8R5M0. 
 4. Run the following command: CHKPRDOPT 5724J23
    If no errors are detected by the CHKPRDOPT command, Sametime is properly installed and you can skip to the next section in this technote.
    If CHKPRDOPT indicates that errors were detected, complete these steps:  * Check the job log for more detailed messages and attempt to correct the problem 
     * Install Sametime again. 
     * Review the job log for errors and attempt to start the server.
    
    




Verify that you have installed all of the required software 

See "Sametime for IBM i: System Requirements", #1092193 [http://www.ibm.com/support/docview.wss?rs=477&uid=swg21092193] . The requirements are somewhat different for each release of Sametime. Be sure to verify that you have installed all options of the IBM Developer Kit for Java (57xxJV1) that are required for the new release. 






Verify that you have installed all of the required system fixes (PTFs) 

See "Sametime for IBM i: What System Fixes are Required?", #1089996 [http://www.ibm.com/support/docview.wss?rs=477&uid=swg21089996] . You must have all of the fixes installed. If you had to install a new Java option, remember to reinstall the latest Java group PTF. 






Verify your TCP/IP configuration 

Make sure that the fully qualified host name of your Sametime server is listed first in the system host table, before any short names. If your server is configured to search the Domain Name Server (DNS) before the IBM i host table, you must also make sure that the fully qualified host name of your Sametime server is listed first in the DNS. For detailed information about verifying and changing these values, see the section called "Server host name is incorrect" in Sametime for IBM i: Most Common Problems (#1108423 [http://www.ibm.com/support/docview.wss?rs=477&uid=swg21108423]). 

Also, verify the following entries in the Sametime server document. 

Basics tab: 

 * Fully qualified Internet host name field must contain the fully qualified host name for the Sametime server, as known by the DNS server.


Ports > Notes Network Ports tab:  * Port field contains TCPIP. 
 * TCP is specified as the protocol. 
 * Net Address Field contains the fully qualified host name of the Sametime server. For example: stdom1.acme.com. This MUST NOT be a numeric IP address. 


Internet Protocols > HTTP tab:  * Basics: Host Name field must contain the fully qualified host name of the Sametime server. This field may contain more than one name. If any of the names are incorrect or not needed, delete them. Make sure that the correct fully qualified host name is listed first in the field. 
 * Basics: Bind to host name field is set to Enabled. 
 * DSAPI: DSAPI filter file names field is blank.





Update the NOTES.INI file to force another attempt to upgrade the server 

 1. From the WRKDOMSVR display, type option 13 (Edit NOTES.INI) next to the name of your Sametime server and press Enter. 
 2. Page down to almost the end of the file and find the line that reads: 
    SametimeVersion=<release number>
    Change <release number> to the number of the release that you are upgrading from. For example, if you are upgrading from Sametime 8.0.2, change the line above to SametimeVersion=8.0.2. If you are upgrading from 8.5, change the line to SametimeVersion=8.5. 
 3. Press F3 twice to save the file and exit.





Verify that stconfig.nsf exists in the server data directory 

 1. Run the following command to view the list of subdirectories in the Sametime server data directory:
    WRKLNK OBJ('server_data_dir/*') OBJTYPE(*ALLDIR) 
 2. Page down if necessary and determine whether a backup directory was created when you attempted to upgrade Sametime. 
    The backup directory is located in the server data directory and is called ST<previous_version>BU. For example, the backup directory name is ST85BU if you upgraded from Sametime 8.5 and ST851BU if you upgraded from Sametime 8.5.1. 
 3. If the directory exists, copy stconfig.nsf from the backup directory to the Sametime server's data directory:
    CPY OBJ('<server_data_directory>/<backup_directory>/stconfig.nsf') TODIR('<server_data_directory>') REPLACE(*YES) OWNER(*KEEP)





Attempt to upgrade the Sametime servers again 

Run the following command from any IBM i command line to upgrade your Sametime servers:
SBMJOB CMD(CALL PGM(QSAMETIME/QLTSEXIT2) PARM('1')) ALWMLTTHD(*YES)

RELATED INFORMATION
 System Requirements [http://www.ibm.com/support/docview.wss?uid=swg21092193]
What System Fixes Are Required [http://www.ibm.com/support/docview.wss?uid=swg21089996]
Most Common Problems [http://www.ibm.com/support/docview.wss?rs=0&uid=swg21108423]




HISTORICAL NUMBER
 195124