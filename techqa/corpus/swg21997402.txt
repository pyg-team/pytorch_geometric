Title: IBM Installing maintenance on IBM WebSphere Commerce fails with ScriptingException: WASX7418E - United States

Text:
instance install apar ifix cf commerce deployment deployear ZipException ScriptingException WASX7418E IOException TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Attempts to install maintenance to the IBM WebSphere Commerce instance fails during EAR deployment with the following errors:

[wsadmin] ADMA5069E: The installation of application WC_demo failed. This application was in the middle of a full update and therefore is uninstalled from the configuration session. Discard your current configuration session immediately to recover the application. Do not save changes to the WebSphere Application Server configuration repository. The application is not uninstalled from this repository. Until the current configuration session is discarded you do not see this application in the current session.

[wsadmin] WASX7017E: Exception received while running file "opt/IBM/WebSphere/CommerceServer70/config/deployment/scripts/deployEar.jacl"; exception information: com.ibm.ws.scripting.ScriptingException: WASX7418E: Application update for WC_demo failed: see previous messages for details. 

SYMPTOM
The updatelog.txt contains the following messages:
(Jan 12, 2017 5:45:19 AM), Install, com.ibm.ws.install.ismp.actions.InstallListOfMaintenances, msg1, WCUPDIERR0005: Failed to deploy the WebSphere Commerce instance from /tmp/wcupdate directory.
(Jan 12, 2017 5:45:19 AM), Install, com.ibm.ws.install.ismp.actions.InstallListOfMaintenances, msg1, For more information, see the log file: "opt/IBM/WebSphere/CommerceServer70/logs/update/actions/install/deployear_WC_demo.log" or the "Troubleshooting: WebSphere Commerce Update Installer issues" topic in the Knowledge Center.
...
(Jan 12, 2017 5:45:19 AM), Install, com.ibm.ws.install.ismp.actions.InstallListOfMaintenances, err, com.ibm.ws.install.ni.framework.NIFException
at com.ibm.ws.install.ni.ismp.utils.ISMPLogUtils.logException(ISMPLogUtils.java:46)
...
(Jan 12, 2017 5:45:19 AM), Install, com.ibm.ws.install.ismp.actions.InstallListOfMaintenances, err, IOException: Ear deployment failed
(Jan 12, 2017 5:45:19 AM), Install, com.ibm.ws.install.ismp.actions.InstallListOfMaintenances, err, com.ibm.ws.install.ni.framework.NIFException: IOException: Ear deployment failed

deployear_WC_demo.log contains the following deployment error:
[wsadmin] ADMA5069E: The installation of application WC_demo failed. This application was in the middle of a full update and therefore is uninstalled from the configuration session. Discard your current configuration session immediately to recover the application. Do not save changes to the WebSphere Application Server configuration repository. The application is not uninstalled from this repository. Until the current configuration session is discarded you do not see this application in the current session.
[wsadmin] WASX7017E: Exception received while running file "opt/IBM/WebSphere/CommerceServer70/config/deployment/scripts/deployEar.jacl"; exception information: com.ibm.ws.scripting.ScriptingException: WASX7418E: Application update for WC_demo failed: see previous messages for details.

[wsadmin] WASX7341W: No "save" was performed before the interactive scripting session exited; configuration changes will not be saved.

BUILD FAILED
opt/IBM/WebSphere/CommerceServer70/config/deployment/xml/deployEar.xml:62: The following error occurred while executing this line:
opt/IBM/WebSphere/CommerceServer70/config/deployment/xml/deployEar.xml:440: The following error occurred while executing this line:
opt/IBM/WebSphere/CommerceServer70/config/deployment/xml/deployEar.xml:635: Java returned: 105

The wsadmin.traceout log shows the following:
[12.01.17 05:37:47:864 CET] 00000000 annotations W com.ibm.ws.amm.merge.webapp.manager.WebAppData addFilter class [com.ibm.commerce.messaging.composer.servlet.CompositionFilter] for filter [com.ibm.commerce.messaging.composer.servlet.CompositionFilter] cannot be found
org.eclipse.jst.j2ee.commonarchivecore.internal.exception.NestedJarException: IWAE0008E An error occurred reading WebSphereCommerceServerExtensionsLogic.jar from /tmp/app5789804086730515236.ear
Stack trace of nested exception:
java.util.zip.ZipException: invalid entry size (expected 2002059272 but got 1787 bytes)


CAUSE
WebSphereCommerceServerExtensionsLogic.jar could not be unzipped by the Javaâ„¢ utility.

DIAGNOSING THE PROBLEM
1. Copy the Master EAR from AppServer/profiles/<profileName>/config/cells/<cellName>/applications/WC_<instance>.ear to a temporary location and extract it.
2. Use the Java JAR tool to extract the JAR, for example:
jar -xf WebSphereCommerceServerExtensionsLogic.jar

This should result in the same error in the command line:
java.util.zip.ZipException: invalid entry size (expected 2002059272 but got 1787 bytes)
at java.util.zip.ZipInputStream.readEnd(ZipInputStream.java:398)
at java.util.zip.ZipInputStream.read(ZipInputStream.java:167)
at java.util.zip.ZipInputStream.closeEntry(ZipInputStream.java:111)
at sun.tools.jar.Main.extractFile(Main.java:1000)
at sun.tools.jar.Main.extract(Main.java:909)
at sun.tools.jar.Main.run(Main.java:253)
at sun.tools.jar.Main.main(Main.java:1213)

Note: You will likely not see any errors if you use another compression tool as there are different tolerance levels.

RESOLVING THE PROBLEM
1. Obtain a copy of the JAR from a working environment where it has the same contents or rebuild the JAR file from the source.
2. Re-run Step 2 from 'Diagnosing the Problem' to confirm there are no errors.
3. Deploy the working JAR from the WebSphere Application Server Administration Console or using your preferred deployment method.
4. Re-run the maintenance installation on the instance.