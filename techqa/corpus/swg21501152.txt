Title: IBM Sametime Database Maintenance and Best Practices - United States

Text:
sametime database maintanence compact fixup redbook QUESTION/ANSWER

QUESTION
What are good practices for database maintenance for a Sametime Community Server?

ANSWER
It is good practice to run regular maintenance against .nsf files to maintain healthy databases.


Key databases used by the Sametime Community server

 * names.nsf
 * stconfig.nsf
 * stlog.nsf
 * stnamechange.nsf
 * stofflinemessages.nsf
 * vpuserinfo.nsf


Recommended Maintenance Activities

Maintenance activity Frequency We recommend backing up your entire Sametime server installation. This includes the entire program directory (that is, \lotus\domino) and the entire data directory (that is, \lotus\domino\data). This gives an administrator the opportunity to restore the server to the last known good state if the need arises. If a full backup is not possible, then at the very least the following files should be backed up:  *   * notes.ini
    * sametime.ini
    * UserInfoConfig.xml
    * names.nsf
    * stconfig.nsf
    * stnamechange.nsf
    * stofflinemessages.nsf
    * vpuserinfo.nsf
   
   

The frequency depends on how often changes are made to this environment. Each time a configuration change is made, a backup should be made.
With regards to vpuserinfo.nsf, this database stores users’ buddy lists and changes daily. How often you back it up depends on your environment.
If you have more than 1,000 employees, it may be beneficial to back up this database on a nightly schedule. Again, the frequency at which this database is backed up is highly dependant on your environment, and can be altered to match the needs of your environment. Set space savers on the databases that will grow large over time like log.nsf and stlog.nsf. To enable space savers, see the document titled “Limiting the contents of a replica” in the Domino Administrator help guide. You will need to enable the “Remove documents not modified in the last x days” setting on the Space Savers panel. We recommend setting the following purge interval for  * log.nsf - 7 days
 * stlog.nsf - 30 days

Periodically, the sametime.log file should be archived or deleted. Every 3–4 weeks this file should be deleted unless you are troubleshooting a specific issue. Periodically, the contents of the trace directory (\lotus\domino\trace) should be purged. The frequency of this is dependent on how much space you have available on your hard drive and how fast the trace files are growing. If you are not troubleshooting a specific issue, we recommend purging this every 3–4 weeks. You may need to increase the frequency depending on how
much hard disk space you have available and how much tracing you have enabled. Create Domino program documents to run scheduled database maintenance (compact and updall) on the key databases used by the Sametime Community server.  * 

For an example on how to create a program document, see the help document titled “Setting a schedule for Updall in a Program document” in the Domino Administrator help guide. The following commands should be run weekly via a program document while the
server is up and running:

updall [database.nsf] -r
compact [database.nsf] -B

Note: In order for a copy-style compact to occur on these databases, they must not
be opened by any user. Therefore, we recommend following these maintenance
suggestions with the server shut down as well. In the cases where the above databases cannot be compacted due to open sessions, shut down the server and run maintenance on the same databases above.
1. Open a command prompt.
2. Navigate to the Domino program directory.
3. Run the following commands:
ncompact [database.nsf] -C
nupdall [database.nsf] -r This should be done every two weeks. 
Note: There are various options to run these commands

1. Manually while the server is running (Load compact -B database.nsf)
2. Manually while the server is offline (C:\Program Files\IBM\Lotus\Domino\ncompact -C database.nsf)
3. Using Domino Program documents. For details, reference Admin help [https://www.ibm.com/support/knowledgecenter/SSKTMJ_9.0.1/admin/tune_runningcompactusingaprogramdocument_t.html] or How to configure a Program Document to periodically run a server command [https://www.ibm.com/support/docview.wss?uid=swg21088932]
4. Using Microsoft @ commands [http://support.microsoft.com/kb/313565] or .bat scripts


RELATED INFORMATION
Administrator Guide for Domino Server maintenance [http://www.ibm.com/support/docview.wss?uid=swg27006573]