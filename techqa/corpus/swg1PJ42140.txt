Title: IBM PJ42140: TPF_SHA256_DIGEST YIELDS INCORRECT RESULTS. - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  See Problem Summary
   
   
    
   
   

LOCAL FIX
 *  na
   
   
    
   
   

PROBLEM SUMMARY
 *  APAR NUMBER:  PJ42140
   PRODUCT:  z/TPF
   FUNCTIONAL AREA:  Cryptography
   SHIPPED IN PUT:  11
   
   ABSTRACT:
   With PJ31336 [http://www-01.ibm.com/support/docview.wss?uid=swg1PJ31336] or PJ31807 [http://www-01.ibm.com/support/docview.wss?uid=swg1PJ31807] applied, the Secure Hash Algorithm
   (SHA) user APIs yield incorrect results that cause
   inter-operability problems with other platforms.
   
   PACKAGE CONTENTS:
   Source Segments:
   (C) base/exp/CTAL.exp
   (C) base/include/tpf/tpfapi.h
   (C) base/openssl/tpfssl/cryu.c
   (C) base/rt/crypt.c
   
   Object Only Binaries:
   None.
   
   Configuration Independent Binaries:
   (C) base/openssl/lib/libCRYU.so
   (C) base/openssl/load/CRYU.so
   (C) base/openssl/obj/cryu.o
   
   Support Files:
   base/openssl/lst/CRYU.map
   base/openssl/lst/cryu.lst
   
   OTHER BINARIES TO BUILD: YES
   (C) <sys>/obj/crypt.o
   (C) <sys>/stdlib/libCTAL.so
   (C) <sys>/stdload/CTAL.so
   COMMENTS:
   Creating hash values on z/TPF using the tpf_SHA1_Digest,
   tpf_SHA1_Init, tpf_SHA1_Update, tpf_SHA1_Final,
   tpf_SHA256_Digest, tpf_SHA256_Init, tpf_SHA256_Update or
   tpf_SHA256_Final APIs will result in an incorrect hash being
   returned because the parameters passed to CRYK from CRYU to
   perform the operation within the CPACF hardware are not set up
   correctly. This causes problems if z/TPF creates a SHA hash and
   sends that hash to another platform that then attempts to
   verify the hash value, or if another platform creates a SHA
   hash and sends that hash to z/TPF that then attempts to verify
   the hash value. The incorrect hash problem exists only when the
   z/TPF SHA APIs are used - other code in z/TPF such as SSL that
   creates/verifies SHA hash values does so correctly.
   
   
    
   
   

PROBLEM CONCLUSION
 *  SOLUTION:
   Some z/TPF customers are using the existing set of SHA APIs and
   persist those hash values along with data, then verify the hash
   values whenever the persisted data is read back into memory.
   For this reason, the behavior of the existing set of SHA1 and
   SHA256 APIs cannot be changed. This APAR introduces a new set
   of SHA APIs (tpf_SHA1_Digest_new, tpf_SHA1_Init_new,
   tpf_SHA1_Update_new, tpf_SHA1_Final_new, tpf_SHA256_Digest_new,
   tpf_SHA256_Init_new, tpf_SHA256_Update_new, and
   tpf_SHA256_Final_new) that has the same user interface as the
   existing set of APIs, but returns the correct hash value.
   If you have user code in z/TPF that created and saved SHA hash
   values using the existing SHA APIs, then that code should
   continue to use the existing SHA APIs to verify those saved
   hash values. However, if you are creating a SHA hash of new
   data or verifying SHA hashes created by other platforms, you
   should use the new set of SHA APIs.
   
   COREQS: NO
   None.
   
   MIGRATION CONSIDERATIONS: YES
   Application programming interface (API) changes:
   tpf_SHA1_Init_new()
   tpf_SHA1_Update_new()
   tpf_SHA1_Final_new()
   tpf_SHA1_Digest_new()
   tpf_SHA256_Init_new()
   tpf_SHA256_Update_new()
   tpf_SHA256_Final_new()
   tpf_SHA256_Digest_new()
   
   BUILD COMMANDS AND INSTRUCTIONS: YES
   #maketpf commands for linux
   maketpf -f CTAL crypt.o
   maketpf -f CRYU cryu.o
   maketpf CTAL link TPF_VERIFY_LINK_REFS=NO
   maketpf CRYU link
   maketpf CTAL link
   
   UPDATED INFORMATION UNITS: YES
   z/TPF C/C++ Language Support User's Guide
   
   See your IBM representative if you need additional information.
   
   DOWNLOAD INSTRUCTIONS:
   http://www.ibm.com/software/htp/tpf/maint/maintztpf.html [http://www.ibm.com/software/htp/tpf/maint/maintztpf.html]
   
   APAR URL:
   http://www.ibm.com/software/htp/tpf/ztpfmaint/put11/PJ42140.htm [http://www.ibm.com/software/htp/tpf/ztpfmaint/put11/PJ42140.htm]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PJ42140
   
   
 * REPORTED COMPONENT NAME
   Z/TPF
   
   
 * REPORTED COMPONENT ID
   5748T1501
   
   
 * REPORTED RELEASE
   110
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2014-03-20
   
   
 * CLOSED DATE
   2014-05-30
   
   
 * LAST MODIFIED DATE
   2014-05-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

Publications Referenced SK2T8062 FIX INFORMATION
 * FIXED COMPONENT NAME
   Z/TPF
   
   
 * FIXED COMPONENT ID
   5748T1501
   
   

APPLICABLE COMPONENT LEVELS
 * R110 PSY
   UP