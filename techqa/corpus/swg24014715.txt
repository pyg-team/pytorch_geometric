Title: IBM PK35105; 6.1.0.3: Application deployment fails with a StackOverflowError - United States

Text:
PK35105; PK35105; PK35105; StackOverflowError DOWNLOADABLE FILES

ABSTRACT
 A StackOverflowError occurs when an application having several thousand files in a single module is deployed. 

DOWNLOAD DESCRIPTION
PK35105 resolves the following problem:

ERROR DESCRIPTION:

Problem Descriptions:
Customer is deploying an application; deployment seems to be successful but has failed (not all of the application files were deployed).

The failure is noted by a StackOverflowError in the First Failure Data Capture (FFDC) log. This particular failure occurs only when a module file structure contains many (more than a thousand) files.

Following is an example of the StackOverflowError:
------Start of DE processing------ = [06-11-22 17:52:06:125
CST] , key = java.lang.StackOverflowError
com.ibm.ws.management.application.sync.AddBinaryTask.fullUpdate
121 
Exception = java.lang.StackOverflowError
Source =
com.ibm.ws.management.application.sync.AddBinaryTask.fullUpdate
probeid = 121
Stack Dump = java.lang.StackOverflowError
at
org.eclipse.emf.common.notify.impl.NotificationImpl.add(NotificationImpl.java:996)
... many repeats of this 'add' call omitted ...
at
org.eclipse.emf.common.notify.impl.NotificationImpl.add(NotificationImpl.java:1016)
at
org.eclipse.emf.ecore.impl.BasicEObjectImpl.eBasicSetContainer(BasicEObjectImpl.java:950)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.FileImpl.basicSetContainer(FileImpl.java:446)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.FileImpl.eInverseRemove(FileImpl.java:492)
at
org.eclipse.emf.ecore.impl.BasicEObjectImpl.eInverseRemove(BasicEObjectImpl.java:1017)
at
org.eclipse.emf.ecore.util.EcoreEList.inverseRemove(EcoreEList.java:299)
at
org.eclipse.emf.common.notify.impl.NotifyingListImpl.clear(NotifyingListImpl.java:1109)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.save(ArchiveImpl.java:1094)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ModuleFileImpl.save(ModuleFileImpl.java:161)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.strategy.SaveStrategyImpl.save(SaveStrategyImpl.java:114)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.strategy.SaveStrategyImpl.save(SaveStrategyImpl.java:123)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.strategy.SaveStrategyImpl.saveFiles(SaveStrategyImpl.java:145)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.strategy.SaveStrategyImpl.save(SaveStrategyImpl.java:100)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.save(ArchiveImpl.java:1083)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ModuleFileImpl.save(ModuleFileImpl.java:161)
at
org.eclipse.jst.j2ee.commonarchivecore.internal.impl.ArchiveImpl.extractTo(ArchiveImpl.java:473)
at
com.ibm.websphere.management.application.EarUtils.extractEar(EarUtils.java:126)
... additional lines omitted ...

Analysis shows that the overflow occurs because of a deep recursion on a linked list that is a long as the module file structure. The creation of the long linked list is a result of a coding error.

The only workaround for this problem is to reduce the number of files in the module file structure. No specific upper limit is known, but the know case failed on about 2,000 files.

The problem is more severe on 64 bit systems, because of higher memory requirements on these systems. The only fix for this problem is to install the associated ifix. This fix is targeted for inclusion in the v6.1.0.7 service pack.

This problem has been reported as Eclipse™ bugzilla 165931: 
https://bugs.eclipse.org/bugs/show_bug.cgi?id=165931 [https://bugs.eclipse.org/bugs/show_bug.cgi?id=165931] 

The code fault has been noted in the prereq levels that are present in both WebSphere Application Server levels 6.1 through 6.1.0.5, inclusive.

LOCAL FIX:
Local Fix/Work Around:

The patch is to the jar file: 
org.eclipse.emf.common_2.2.1.v200609210005.jar

There are two classes present in the patch jar file that are to replace the classes of the same name in the jar, above. The jar is present in the WAS_HOME/plugins directory.

PROBLEM SUMMARY

USERS AFFECTED:
IBM® WebSphere® Application Server Version v6.1 users who have applications with several thousand files in a single module.

PROBLEM DESCRIPTION:
A StackOverflowError occurs when an application having several thousand files in a single module is deployed.

RECOMMENDATION:
None

A StackOverflowError occurs when an application having several thousand files in a single module is deployed. (The trigger point is approximately 2000 files, but this will depend on the deployment environment.)

The StackOverflowError occurs because of a coding error in notification code. The coding error selected a recursive algorithm for traversing a file container instead of an iterative algorithm. The coding error was the use of a variable that had been cleared to zero in the test that selected the traversal agorithm.

PROBLEM CONCLUSION:
The coding error was reported as an Eclipse bugzilla defect, see:
https://bugs.eclipse.org/bugs/show_bug.cgi?id=165931 [https://bugs.eclipse.org/bugs/show_bug.cgi?id=165931]

The code change was integrated into the v6.1.0.7 service pack. 

The ++APAR PK37675 has been created for z/OS at service pack level v6.1.0.5.

PREREQUISITES
Please download the UpdateInstaller below to install this fix.

URL LANGUAGE SIZE(Bytes) UpdateInstaller [http://www.ibm.com/support/docview.wss?rs=180&uid=swg21205991] US English 7250000 
INSTALLATION INSTRUCTIONS
Please review the readme.txt for detailed installation instructions.

URL LANGUAGE SIZE(Bytes) Readme [ftp://public.dhe.ibm.com/software/websphere/appserv/support/fixes/PK35105/readme.txt] US English 11290 
DOWNLOAD PACKAGE


Download RELEASE DATE LANGUAGE SIZE(Bytes) Download Options 
What is DD? [http://www6.software.ibm.com/dldirector/doc/DDfaq_en.html] 6.1.0.3-WS-WAS-IFPK35105 01-22-2007 US English 21238 FTP [ftp://public.dhe.ibm.com/software/websphere/appserv/support/fixes/PK35105/6.1.0.3-WS-WAS-IFPK35105.pak] DD 
TECHNICAL SUPPORT
 Contact IBM Support using SR (http://www-306.ibm.com/software/support/probsub.html [http://www-306.ibm.com/software/support/probsub.html]), visit the WebSphere Application Server Support Web site (http://www.ibm.com/software/webservers/appserv/was/support/ [http://www.ibm.com/software/webservers/appserv/was/support/]), or contact 1-800-IBM-SERV(U.S. only). 

Cross Reference information Segment Product Component Platform Version Edition Application Servers Runtimes for Java Technology Java SDK 
 [/support/docview.wss?uid=swg24014715&aid=1]Problems (APARS) fixed [/support/docview.wss?uid=swg24014715&aid=2]Problems (APARS) fixed
PK35105, PK37675