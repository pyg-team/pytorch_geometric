Title: IBM SQL0302N error returned after increasing column length of the source and target tables - United States

Text:
SQL0302N; -302; enlarge column length; increase column length TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Federation server Oracle wrapper reports -302 error after increasing the cloumn length of the source and target tables when running IBM InfoSphere Replication Server. 

SYMPTOM
You increased the column length of source table, you increased the column length of the nickname by command "ALTER NICKNAME <NAME> ALTER COLUMN ....", you also increased the column length of the target table on the data source server, but you may still encountered -302 error when SQL Apply program of IBM InfoSphere Replication Server.


CAUSE
Error -302 happened because "REMOTE_COLUMN_LENGTH" that stored in SYSCAT.COLOPTIONS was not updated by command "ALTER NICKNAME <NAME> ALTER COLUMN..." while Federation Server always looks "REMOTE_COLUMN_LENGTH" for the length of the host variable. 

1. When you altered the nickname column length, it only adjusted the local column length, but it did not adjusted the remote column length "REMOTE_COLUMN_LENGTH" which stored in SYSCAT.COLOPTIONS.

2. SQL Apply program of IBM InfoSphere Replication Server submit insert/update SQLs with bind variables to Federation Server as:

INSERT INTO <NICKNAME> VALUES(?,?,...) UPDATE <NICKNAME> SET <COLUMN1> = ? ... WHERE <COLUMNX> = ?

3. When Federation Server was processing above SQLs, it bound variables for the columns, it looked at the REMOTE_COLUMN_LENGTH for the length, since the length was not increased, so -302 error returned if data length if larger than it actually showed in SYSCAT.COLOPTIONS.


ENVIRONMENT
Federated Server on Linux/Unix/Windows 

Data Source server: Oracle (or other data sources) 


DIAGNOSING THE PROBLEM
 

You can recreate the error with below steps: 

1. Create a remote table ttt on Oracle: 

 create table ttt(c1 varchar(9)) 

2. Create a nickname ttt pointing to table ttt 

3. Alter nickname ttt alter column c1 local data type varchar(10) 

 set passthru server1 

 alter table ttt modify c1 varchar(10) 

 set passthru reset 

4. Query the REMOTE_COLUMN_LENGTH 

 db2 => select SUBSTR(COLNAME,1,10),SUBSTR(OPTION,1,20),SUBSTR(SETTING,1,20) from 

 syscat.COLOPTIONS where TABNAME='TTT' 

 

1 2 3 

---------- -------------------- -------------------- 

C1 REMOTE_COLUMN_NAME C1 

C1 REMOTE_COLUMN_TYPE VARCHAR2 

C1 REMOTE_COLUMN_LENGTH 9 ==>IT IS STILL LENGTH OF 9! 

C1 COLUMN_CHAR_SEMANTIC N 

 

5. Create a Java application as: 

 String SQL = "insert into TTT values(?)"; 

 PreparedStatement stmt = con.prepareStatement(SQL); 

 stmt.setString(1,"1234567890"); 

 stmt.executeUpdate(); 

 con.commit(); 

 

6. Run above application, you should get error : 

com.ibm.db2.jcc.am.SqlDataException: DB2 SQL Error: SQLCODE=-302, 

SQLSTATE=22001 SQLERRMC=null, DRIVER=4.12.55 

 

NOTES: The error only happened when you run SQL with bind variables, that's to say: the error would not happen with SQL like: insert into TTT values("1234567890")



RESOLVING THE PROBLEM
Drop and recreate the nickname. 

Recreating nickname is required after increasing the column length of the source table when running Replication SQL Apply program or any SQL with bind variables.

 



Cross reference information Segment Product Component Platform Version Edition Information Management InfoSphere Replication Server Federated SQL replication Platform Independent 9.1, 9.5, 9.7