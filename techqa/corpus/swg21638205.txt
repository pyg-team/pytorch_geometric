Title: IBM Reconciliation Exhausts LDAP Connection Pool - United States

Text:
ldap connection; thread; pool; hang TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The LDAP connnection pool can become exhausted during large reconciliations leading to a hung

or very slow responding ITIM environment. 

SYMPTOM
SystemOut.log:

[4/9/13 22:01:33:688 CEST] 0000003a Cache A DYNA1070I: Cache 
instance "services/cache/ldap_lt_cache" is full and has reached the 
maximum configured size of 20000 entries. Space on the JVM heap for new 
entries will now be made by evicting existing cache entries using the 
LRU algorithm. Please consider enabling the disk offload feature for the
cache instance to prevent the discard of cache entries from memory. 
[4/9/13 22:29:49:169 CEST] 0000001a ThreadMonitor W WSVR0605W: Thread 
"SIBJMSRAThreadPool : 6" (00000056) has been active for 718434 
milliseconds and may be hung. There is/are 2 thread(s) in total in the 
server that may be hung. 
at java.lang.Object.wait(Native Method) 
at java.lang.Object.wait(Object.java:167) 
at com.sun.jndi.ldap.pool.Connections.get(Connections.java:137) 
at com.sun.jndi.ldap.pool.Pool.getPooledConnection(Pool.java:129) 

Javacore: 


3XMTHREADINFO "SIBJMSRAThreadPool : 2" 
J9VMThread:0x00000000320B2000, j9thread_t:0x0000010017B0A3A0, 
java/lang/Thread:0x0000000041EDC828, state:CW, prio=5 
3XMTHREADINFO1 (native thread ID:0x3CB00A1, native 
priority:0x5, native policy:UNKNOWN) 
3XMTHREADINFO3 Java callstack: 
4XESTACKTRACE at java/lang/Object.wait(Native Method) 
4XESTACKTRACE at 
java/lang/Object.wait(Object.java:167(Compiled Code)) 
4XESTACKTRACE at 
com/sun/jndi/ldap/pool/Connections.get(Connections.java:137(Compiled 
Code)) 
4XESTACKTRACE at 
com/sun/jndi/ldap/pool/Pool.getPooledConnection(Pool.java:129(Compiled 
Code)) 
4XESTACKTRACE at 
com/sun/jndi/ldap/LdapPoolManager.getLdapClient(LdapPoolManager.java:310
(Compiled Code)) 
4XESTACKTRACE at 
com/sun/jndi/ldap/LdapClient.getInstance(LdapClient.java:1572(Compiled 
Code))


CAUSE
Inadequate connection pool size or inadequate JVM heap size for environment and workload.


DIAGNOSING THE PROBLEM
Review the Websphere SystemOut.log and Javacore if they are available for the symptoms shown in the 'Symptom' section of this document,



RESOLVING THE PROBLEM
The following tuning is known to resolved this problem.


Update the LDAP Configuration:

- Edit ibmslapd.conf 
- Update 'ibm-slapdDbConnections' from 15 - 30 
- Restart the LDAP service

Update ITIM Connection Pool:

- Edit enRole.properties 
- Update enrole.connectionpool.maxpoolsize=300 (from 100) 
- Restart ITIM Application

Increase the ITIM Application JVM:

- Increase the Websphere JVM values min - 1024 max - 2048 (from 512 - 2048) 
See the ITIM Performance and Tuning Guide section 'â€œAdjusting the Java virtual machine size' for 
further details on Websphere JVM tuning.