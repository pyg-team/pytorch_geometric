Title: IBM TRANSACTION ROUTING DFHAC2033 NOT AUTHORIZED DFHAC2003 - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The customer defined a PROGRAM on the CICS/AIX region as
REMOTE on the CICS/ESA region. He uses CECI LINK PROG(RACFINFO) with
a COMMAREA that he has already developed under CECI.
When the mirror transaction runs on the mainframe, it contains the
default CICS userid instead of the userid that he logged on with.
But, it does get the OPID. He doesn't know if the PASSWORD is sent
or not.

He has OutboundUserids set to "Send only with password" in the CD.
He logs into the CICS/AIX region.
He signs on to CICS/AIX via the CESN transaction.

DPL appears to work:
He issues a CECI LINK PROG(xxxx) command.
This works. He gets his data back. No messages appear anywhere.
He thinks this means that the userid & password were sent up for the
RACF check because the resources are protected. Since he got the
data back, it had to have passed the RACF check.

Transaction Routing appears to fail:
He enters a tranid that is defined as remote.
1) On the screen he sees:
DFHAC2033 You are not authorized to use transaction TERM

2) In the CICS/ESA's CSMT log he sees:
MSGDFHAC2003 SECURITY VIOLATION HAS BEEN DETECTED TERM ID = @B1
TRANS ID = TERM USERID = <his userid>

3) On the mainframe, he uses the TMON monitor to watch what is going
on in the CICS/ESA region. It shows <his userid> there.

4) In the RACF messages he sees:
User "SYSSTC" in the ICH408I message. This is the default userid,
not <his userid>. 

RESOLVING THE PROBLEM
A trace of the data being passed showed that the userid is in both
the LU6.2 FMH 5 & the Relay FMH 43.
The password is only in the LU6.2 FMH 43.
There is no field for the password in the FMH 43, though.
So, it is no surprise that it isn't there.

The question is: Since the password is there, why isn't it used?

A CICS/ESA trace showed that the USERID & PASSWORD were both sent to
the CICS/ESA region. CICS went through the ADD_USER_WITH_PASSWORD
process to sign it on. So, RACF does know about the new user and its
password. Later in the trace we see:

XS 0701 XSRC ENTRY CHECK_CICS_RESOURCE
TERM,TRANSATTACH,EXECUTE
XS 0709 XSRC EVENT CHECK
SDEVLID.TERM CHECK_RESOURCE_ACCESS,1877FF38,00000029,TCICSTRN,READ,Y
XS 070A XSRC EVENT CHECK-COMPLETE
SDEVLID.TERM X708674 CHECK_RESOURCE_ACCESS,OK,0,0,0,0
XS 0709 XSRC EVENT CHECK
SDEVLID.TERM CHECK_RESOURCE_ACCESS,1877F530,00000001,TCICSTRN,READ,Y
XS 070B XSRC *EXC* CHECK-FAILED
SDEVLID.TERM SYSSTC CHECK_RESOURCE_ACCESS,EXCEPTION,NOTAUTH,8,4,8,4
XS FE01 XSSC ENTRY CHECK_RESOURCE_ACCESS
1877F530 , 00000001,TCICSTRN,READ,YES,18D8EBA8 , 0000000C
XS FE04 XSSC *EXC* CHECK_RESOURCE_ACCESS/EXCEPTION NOTAUTH,8,0,8,0

Notice that two (2) CHECK_RESOURCE_ACCESS requests are done:
1)For user X708674 which is the one that was sent up. This first
check is to see if the user making the request has authority to run
the transaction
2)For user SYSSTC which is the default userid for this region. This
second check is to see if the link being used has authority to have
the transaction run across it. This is required to keep unsecured
locations from gaining access to secured regions. A user is only
allowed a maximum amount of access that the link is allowed.

In this case we don't think that the customer has set up any link
security. Therefore, the link is only allowed the default user's
level.

He needs to code two things in CICS/ESA for the CICS/AIX to have
access:
1)In the CONNECTION definition:
ATTACHSEC=VERIFY
This will allow the userid and password to be accepted.
2)A userid with enough authority can be defined in either the
CONNECTION or SESSIONS definition.
In the CONNECTION definition:
SECURITYNAME=xxxx
In the SESSIONS definition:
USERID=xxxx
where xxxx is a userid defined to RACF with sufficient authority to
run the TERM transaction (or whatever else he needs to run).