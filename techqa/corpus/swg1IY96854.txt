Title: IBM IY96854: COM.IBM.RMI.IO.IIOPINPUTSTREAM.READ() IS BROKEN - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Error Message: 1.  com.ibm.rmi.io.IIOPInputStream.read()  is
   documented to return  a -1 of type int  when  EOF is
   encountered. It does not. It returns a -1 of type byte.  This
   causes loss of data when reading binary data due to you not
   being able to read one possible value (FF)  out of the 0-255
   byte range the method should return.
   2. MARSHAL exception is thrown when EOF encountered instead of
   EOFException or  IOException as documented.
   3. Even when exception is caught, it is still rethrown later
   preventing any workaround.
   The problem is seen when byte arrays are read in the
   readExternal method of an externalizable object by using any one
   of read() OR read(byte<OSB><CSB>, int, int) methods
   Stack Trace: java.rmi.MarshalException: CORBA MARSHAL 0x4942f8c1
   Maybe; nested exception is:
   org.omg.CORBA.MARSHAL: Request 8:read beyond end of data. No
   fragments available.  vmcid: IBM  minor code: 8C1 completed:
   Maybe
           at
   com.ibm.CORBA.iiop.UtilDelegateImpl.mapSystemException(UtilDeleg
   ateImpl.java:257)
           at javax.rmi.CORBA.Util.mapSystemException(Util.java:84)
           at _Hello_Stub.sayHello(_Hello_Stub.java:47)
           at Client.main(Client.java:17)
   Caused by: org.omg.CORBA.MARSHAL: Request 8:read beyond end of
   data. No fragments available.  vmcid: IBM  minor code: 8C1
   completed: Maybe
           at
   com.ibm.rmi.iiop.Connection.getNextFragment(Connection.java:2309
   )
           at
   com.ibm.rmi.iiop.IIOPInputStream.getNextBuffer(IIOPInputStream.j
   ava:319)
           at
   com.ibm.rmi.iiop.CDRInputStream.alignAndCheck(CDRInputStream.jav
   a:780)
           at
   com.ibm.rmi.iiop.CDRInputStream.alignAndCheck(CDRInputStream.jav
   a:711)
           at
   com.ibm.rmi.iiop.CDRInputStream.read_long(CDRInputStream.java:94
   0)
           at
   com.ibm.rmi.iiop.CDRInputStream.skipToEndOfValue(CDRInputStream.
   java:2003)
           at
   com.ibm.rmi.iiop.CDRInputStream.post_fast_read_value(CDRInputStr
   eam.java:1809)
           at
   com.ibm.rmi.iiop.CDRInputStream.read_value(CDRInputStream.java:2
   135)
           at _Hello_Stub.sayHello(_Hello_Stub.java:36)
           ... 1 more
   .
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  1.  com.ibm.rmi.io.IIOPInputStream.read()  is documented to
   return  a -1 of type int  when  EOF is encountered. It does not.
   It returns a -1 of type byte.  This causes loss of data when
   reading binary data due to you not being able to read one
   possible value (FF)  out of the 0-255 byte range the method
   should return.
   2. MARSHAL exception is thrown when EOF encountered instead of
   EOFException or  IOException as documented.
   3. Even when exception is caught, it is still rethrown later
   preventing any workaround.
   The problem is seen when byte arrays are read in the
   readExternal method of an externalizable object by using any one
   of read() OR read(byte<OSB><CSB>, int, int) methods
   
   
    
   
   

PROBLEM CONCLUSION
 *  This defect will be fixed in:
   5.0.0 SR6
   1.4.2 SR10
   .
   The IIOPInputStream read methods have been fixed to return
   proper values
   .
   To obtain the fix:
   Install build 20070825 or later
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IY96854
   
   
 * REPORTED COMPONENT NAME
   JAVA 5 ORB
   
   
 * REPORTED COMPONENT ID
   620500123
   
   
 * REPORTED RELEASE
   500
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-04-03
   
   
 * CLOSED DATE
   2007-08-30
   
   
 * LAST MODIFIED DATE
   2007-08-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PK42520
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   JAVA 5 ORB
   
   
 * FIXED COMPONENT ID
   620500123
   
   

APPLICABLE COMPONENT LEVELS
 * R500 PSN
   UP