Title: IBM RC127 error when executing remote scripts on Sterling Connect Direct for Unix v4.0.0 using Run Task option. - United States

Text:
profiles; CDU; C:D; ndm.env_vars; NDMAPICFG; run task TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Error RC127 when executing remote scripts on IBM Sterling Connect Direct for Unix v4.0.0 using Run Task option. Connect Direct v.4.0.0 was patched to fix 134. (fix date 17NOV2014). Vendor sending files and then triggers a script on the Sterling Connect Direct v4.0.0 server using the run task option. The vendor was able to trigger the script on the server prior to the Sterling Connect:Direct patch.


RESOLVING THE PROBLEM
Sterling Connect:Direct for Unix has never loaded the user profiles, it has always executed a run task in a restricted shell which does not run through the user profile.

It is possible that a run task executed in a restricted shell and inherited the environment variables which was a security leak. So Sterling Connect:Direct for Unix was fixed to prevent this, however if the user relied on an PATH variable to where ndmcli resides, then the run task will fail.

This is where you set the NDMAPICFG variable and call ndmcli without a full path so it fails:

NDMAPICFG=$HOME/cdunix/ndm/cfg/cliapi/ndmapi.cfg
export NDMAPICFG

ndmcli >> $uploadmsg 2>&1 << EOJ

You should change the call ndmcli to include the full path:

/full/path/to/ndmcli >> $uploadmsg 2>&1 << EOJ 


Alternatively, you can set the new Initparm below which should make it work by inheriting the PATH environment variable but it is not recommended that you use that setting as it is considered a security risk now.

ndm.env_vars:sanitize=n


Fix details:

004) RTC350216 / APAR IC86881 commit date: 03 Oct 2012
--------------------------------------------------------
Secure cdpmgr initialization procedure to sanitize inherited environment
variables, added for APAR IC82150, may prevent run task steps that depend
on one or more of the inherited environment variables from working
properly. Solution adds initparm record ndm.env_vars:sanitize=[y|n] to
allow user option to prevent cdpmgr from sanitizing inherited environment
variables. Default value is 'y'.

NOTE: This new initparm is added for convenience. IBM recommends coding
run task steps so that they don't rely on inherited environment
variables.