Title: IBM Update to any Poll policy fails with Database Error - United States

Text:
SQLSTATE=54048 ITNM Poll policy TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When trying to update any Poll policy/definition via GUI, it fails with "Error occurred while getting list of views DB2 SQL Error: SQLCODE=-1585, SQLSTATE=54048, SQLERRMC=null, DRIVER=4.13.127" - how to fix it? 

SYMPTOM
The following can be found in $NCHOME/precision/profiles/TIP/profiles/logs/tnm/ncp_monitor.*log/trace files: 

[2014-09-12T10:46:51.268] [WebContainer : 1] com.micromuse.topoviz.server.dblayer.NetworkViewDAOImpl.getLibraryViewList SEVERE: Error occured while getting list of views DB2 SQL Error: SQLCODE=-1585, SQLSTATE=54048, SQLERRMC=null, DRIVER=4.13.127
[2014-09-12T10:49:20.869] [WebContainer : 3] com.micromuse.topoviz.server.dblayer.NetworkViewDAOImpl.getLibraryViewList SEVERE: Error occured while getting list of views DB2 SQL Error: SQLCODE=-1585, SQLSTATE=54048, SQLERRMC=null, DRIVER=4.13.127
[2014-09-12T10:50:18.501] [WebContainer : 3] com.micromuse.topoviz.server.dblayer.NetworkViewDAOImpl.getLibraryViewList SEVERE: Error occured while getting list of views DB2 SQL Error: SQLCODE=-1585, SQLSTATE=54048, SQLERRMC=null, DRIVER=4.13.127


CAUSE
No temporary tablespace defined for given NCIM database instance.


ENVIRONMENT
v3.9 with NCIM database being DB2.



DIAGNOSING THE PROBLEM
Find out if there is temporary tablespace defined per ITNM database creation scripts i.e. 

You can also look at $NCHOME/precision/scripts/sql/db2/create_db2_database.sh - in which you could see following entry for temporary tablespace:

create system temporary tablespace largetemp2 pagesize 32k managed by system using ('systemp2') bufferpool buf32k

Here is excerpt from of v3.9(DB2) instance where you notice temporary tablespace called 'largetemp2' with below command:

$ db2pd -d NCIM -tablespace
Database Member 0 -- Database NCIM -- Active -- Up 0 days 00:00:07 -- Date 09/13/2014 09:08:09
Tablespace Configuration:
Address Id Type Content PageSz ExtentSz Auto Prefetch BufID BufIDDisk FSC NumCntrs MaxStripe LastConsecPg Name
0x0A000200153F30E0 0 DMS Regular 4096 4 Yes 4 1 1 Off 1 0 3 SYSCATSPACE
0x0A00020015430040 1 SMS SysTmp 4096 32 Yes 32 1 1 On 1 0 31 TEMPSPACE1
0x0A0002001543AF60 2 DMS Large 4096 32 Yes 32 1 1 Off 1 0 31 USERSPACE1
0x0A00020015443EA0 3 SMS Regular 32768 32 Yes 32 2 2 Off 1 0 31 USERSPACE2
0x0A0002001544EDC0 4 SMS SysTmp 32768 32 Yes 32 2 2 On 1 0 31 LARGETEMP2





RESOLVING THE PROBLEM
Here are 4 steps on how to recreate temporary table space:
1) Stop ITNM ($NCHOME/bin/itnm_stop ncp)
2) As db2admin (you can find user name from $NCHOME/etc/precision/DbLogins.DOMAIN.cfg) - run following commands: 

In below example - the user name is 'db2inst1':

$ db2 connect to NCIM user db2inst1 using <password>

Database Connection Information

Database server = DB2/AIX64 10.1.0
SQL authorization ID = DB2INST1
Local database alias = NCIM

$ db2 "create tablespace userspace2 pagesize 32k managed by system using ('usercont2') bufferpool buf32k"
DB20000I The SQL command completed successfully.
$ db2 "create system temporary tablespace largetemp2 pagesize 32k managed by system using ('systemp2') bufferpool buf32k"
DB20000I The SQL command completed successfully.
$ db2 "revoke use of tablespace userspace1 from public"
DB20000I The SQL command completed successfully.

3) Restart ITNM

4) You can now log onto GUI and be able to do necessary updates to any poll policy/definitions.