Title: IBM STRTCPSVR *DIRSRV Fails with SQL0843 Connection to Relational Database Does Not Exist - United States

Text:
MSGSQL0843 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The STRTCPSVR *DIRSRV command fails if the QSECOFR user profile has an invalid locale setting. 

RESOLVING THE PROBLEM
Note: This is not currently documented anywhere. Development is looking at documenting it in the InfoCenter for a future release. *MGTC (Management Central server) has a similar dependancy, and this is documented in the current InfoCenter. 

The STRTCPSVR *DIRSRV command fails if the QSECOFR user profile has a locale setting that is not valid. QSECOFR is used internally during the process. There is no requirement that QSECOFR be *ENABLED or have a valid password; however, it must have a valid locale or the locale must be set to *NONE. If QSECOFR has a locale that is not valid, the following error messages will be seen in the QDIRSRV JOBLOG:

SQL0843 Diagnostic 30 11/13/07 23:04:14.024552 QSQROUTS QSYS *STMT QSQROUTS QSYS *STMT
From user . . . . . . . . . : QSECOFR
From module . . . . . . . . : QSQSRVRC
From procedure . . . . . . : BLD0843
Statement . . . . . . . . . : 6395
To module . . . . . . . . . : QSQSRVRC
To procedure . . . . . . . : BLD0843
Statement . . . . . . . . . : 6395
Thread . . . . : 00000002
Message . . . . : Connection to relational database RCHASK60 does not exist.
Cause . . . . . : A SET CONNECTION, RELEASE, or DISCONNECT statement
specified relational database name RCHASK60 which is not active. Recovery .
. . : Specify the name of a relational database which has an active
connection.
SQ99999 Diagnostic 30 11/13/07 23:04:14.024624 QSQROUTS QSYS *STMT QGLDRDBM QSYS *STMT
From user . . . . . . . . . : QSECOFR
From module . . . . . . . . : QSQSRVRC
From procedure . . . . . . : BLD0843
Statement . . . . . . . . . : 4585
To module . . . . . . . . . : GLDRLSQL
To procedure . . . . . . . : __SQLConnect_a
Statement . . . . . . . . . : 55
Thread . . . . : 00000002
Message . . . . : Error occurred in SQL Call Level Interface
Cause . . . . . : A procedure call encountered an error. The error code is
17. Error codes are: 3 -- Program type out of range. 4 -- SQL data type out
of range. 9 -- Argument value not valid. 10 -- Function sequence error. 12
-- Transaction operation state not valid. 13 -- Memory management problem.
14 -- Maximum number of handles allocated. 15 -- No cursor name available.
16 -- Handle type for operation not valid. 17 -- Connection no longer
available. 21 -- Descriptor or descriptor information not valid. Recovery .
. . : Refer to the DB2 UDB for iSeries SQL Call Level Interface topic in
the Information Center book for a complete description of the error.
Specifically, look at the procedure that sent the error.
GLD040B Diagnostic 40 11/13/07 23:04:24.116464 QGLDLIBMSG QSYS *STMT QGLDRDBM QSYS *STMT
From user . . . . . . . . . : QSECOFR
From module . . . . . . . . : GLDM400
From procedure . . . . . . : OS400_send_table_message__FiT1PPc
Statement . . . . . . . . . : 146
To module . . . . . . . . . : GLDRDBX
To procedure . . . . . . . : map_rc_fnc__FilN22PCcT5
Statement . . . . . . . . . : 115
Thread . . . . : 00000002
Message . . . . : SQL error -99999 occurred.
Cause . . . . . : The IBM Directory Server 367575/QDIRSRV/QDIRSRV could not
perform the requested operation because an SQL error occurred. The SQL error
information is as follows: Return code = -99999 SQL state = HY017
SQL message = Error occurred in SQL Call Level Interface Recovery . . . :
The requested operation failed. SQL errors are logged in SQL server jobs.
Message SQL7908 in this job log indicates what SQL server jobs were used.
Refer to the SQL server job logs for the SQL errors that may have
contributed to this error.
GLD040A Diagnostic 40 11/13/07 23:04:24.116560 QGLDLIBMSG QSYS *STMT QGLDRDBM QSYS *STMT
From user . . . . . . . . . : QSECOFR
From module . . . . . . . . : GLDM400
From procedure . . . . . . : OS400_send_table_message__FiT1PPc
Statement . . . . . . . . . : 146
To module . . . . . . . . . : GLDRDBX
To procedure . . . . . . . : map_rc_fnc__FilN22PCcT5
Statement . . . . . . . . . : 120
Thread . . . . : 00000002
Message . . . . : SQL error -1 occurred.
Cause . . . . . : The IBM Directory Server 367575/QDIRSRV/QDIRSRV could not
perform the requested operation because an SQL error occurred. The SQL error
information is as follows: Error = -1 Function = SQLConnect String
= SYSA400 Recovery . . . : The requested operation failed. SQL errors
are logged in SQL server jobs. Message SQL7908 in this job log indicates
what SQL server jobs were used. Refer to the SQL server job logs for the
SQL errors that may have contributed to this error.
GLD0416 Diagnostic 40 11/13/07 23:04:24.117208 QGLDLIBMSG QSYS *STMT QGLDRDBM QSYS *STMT
From module . . . . . . . . : GLDM400
From procedure . . . . . . : OS400_send_table_message__FiT1PPc
Statement . . . . . . . . . : 146
To module . . . . . . . . . : GLDRCFGUTL
To procedure . . . . . . . : finish_read_config
Statement . . . . . . . . . : 78
Thread . . . . : 00000002
Message . . . . : Initialization error occurred.
Cause . . . . . : The IBM Directory Server 367575/QDIRSRV/QDIRSRV
encountered an error when initializing the directory database. The specific
error that occurred was 1. Check previous error messages for reasons that
may have contributed to this error.

To resolve, set the QSECOFR user profile locale to a valid location or to *NONE.

In similar issue, QDIRSRV not having authority to QBATCH jobd was a problem and giving QDIRSRV authority to the QBATCH Jobd resolved the issue. 

 


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.3 Operating System IBM i 7.2 Operating System IBM i 7.1 
HISTORICAL NUMBER
 472156367