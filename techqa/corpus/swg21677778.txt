Title: IBM Configuring SQL AlwaysOn node for legacy backup - United States

Text:
TDP SQL alwayson database DP TECHNOTE (FAQ)

QUESTION
 How to configure SQL AlwaysOn node for legacy backup? 

CAUSE
Data Protection for SQL AlwaysOn node configuration can be complicated, the examples below demonstrate how option files, configuration files and Tivoli Storage Manager server commands may be set up in a working environment. 

ANSWER
On Data Protection for SQL server machine: 

There are 3 SQL server machines:
NOTE: They must have the same level of Backup/Archive client and Data Protection for SQL installed.

Host Name: maltavm1.storage.usca.ibm.com
SQL Instance: maltavm1

Host Name: maltavm2.storage.usca.ibm.com
SQL Instance: maltavm2\maltavm2sql

Host Name: rangoonvm2.storage.usca.ibm.com
SQL Instance: rangoonvm2\rangoonvm2sql

Cluster Name: sqlcvtclstr1

Sample dsm.opt (Data Protection for SQL):
NODename MALTAVM1_SQL
PASSWORDAccess generate
TCPServeraddress gijoe
TCPPort 1500
HTTPport 1582

Sample tdpsql.cfg (Data Protection for SQL):
LOCALDSMAgentnode MALTAVM1
BACKUPMethod Legacy
ALWAYSONNode sqlcvtclstr1

Sample dsm.opt (Backup/Archive client):
NODename MALTAVM1
PASSWORDAccess generate
TCPServeraddress gijoe
TCPPort 1500
CLUSTERnode no
CLUSTERDISKSOnly no

NOTE: Configuration files on other machines are similar with above. (change hostname, set sqlinstance name)


On the Tivoli Storage Manager server (gijoe.storage.usca.ibm.com):
Sample commands for node registration on the Tivoli Storage Manager server:

Register the VSS Requestor nodes (Backup/Archive client): 

 * reg node maltavm1 maltavm1 passexp=0 backdel=yes dom=standard maxnummp=10 
 * reg node maltavm2 maltavm2 passexp=0 backdel=yes dom=standard maxnummp=10 
 * reg node rangoonvm2 rangoonvm2 passexp=0 backdel=yes dom=standard maxnummp=10


Register the Data Protection for SQL client nodes:  * reg node maltavm1_sql maltavm1_sql passexp=0 backdel=yes dom=standard maxnummp=10 
 * reg node maltavm2_sql maltavm2_sql passexp=0 backdel=yes dom=standard maxnummp=10 
 * reg node rangoonvm2_sql rangoonvm2_sql passexp=0 backdel=yes dom=standard maxnummp=10


Register the SQL AlwaysOn node:  * reg node sqlcvtclstr1 sqlcvtclstr1 passexp=0 backdel=yes dom=standard maxnummp=10


Sample commands to grant proxy authentication on the Tivoli Storage Manager server:  * grant proxy agent=maltavm1 target=maltavm1_sql 
 * grant proxy agent=maltavm2 target=maltavm2_sql 
 * grant proxy agent=rangoonvm2 target=rangoonvm2_sql 
 * grant proxy agent=maltavm1 target=sqlcvtclstr1 
 * grant proxy agent=maltavm2 target=sqlcvtclstr1 
 * grant proxy agent=rangoonvm2 target=sqlcvtclstr1 
 * grant proxy agent=maltavm1_sql target=sqlcvtclstr1 
 * grant proxy agent=maltavm2_sql target=sqlcvtclstr1 
 * grant proxy agent=rangoonvm2_sql target=sqlcvtclstr1


Query proxy for alwaysonnode on the Tivoli Storage Manager server: 
tsm: GIJOE_SERVER1>q proxynode ta=sqlcvtclstr1 


Target Node Agent Node --------------- --------------------------------------------- SQLCVTCLSTR1 MALTAVM1 MALTAVM1_SQL MALTAVM2 MALTAVM2_SQL RANGOONVM2 RANGOONVM2_SQL 

PRODUCT ALIAS/SYNONYM
 TSM