Title: IBM PJ44371: ADDING CASE SENSITIVE DOCUMENTS TO OBJECT STORES CREATED WITH CASE INSENSITIVE SEARCH ENABLED RESULTS IN AN E_NOT_UNIQUE ERROR - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Adding case sensitive documents to object stores created with
   case insensitive search enabled results in an E_NOT_UNIQUE error
   and the document not being filed.
   
   When an object store is created with case insensitive search
   enabled, database indexes are created with a lower option.
   
   For example:
   
   I_RELATIONSHIP27 has lower added to name.
   CREATE UNIQUE INDEX <database name>."I_RELATIONSHIP27" ON
   <database name>."RELATIONSHIP"
   ("TAIL_ID" ASC,
   LOWER(NAME) ASC) - Forced to lower case in the index definition.
   CLUSTER
   COMPRESS NO
   INCLUDE NULL KEYS ALLOW REVERSE SCANS;
   
   without case insensitive search it is created as follows
   CREATE UNIQUE INDEX <database name>."I_RELATIONSHIP27" ON
   <database name>."RELATIONSHIP"
   ("TAIL_ID" ASC,
   NAME ASC)
   CLUSTER
   COMPRESS NO
   INCLUDE NULL KEYS ALLOW REVERSE SCANS;
   
   This causes an issue for the auto unique naming logic as it does
   not take into account case insensitive names.
   
   Steps to reproduce:
   1.  Create an object store with case insensitive search enabled
   on databases with extended_row size enabled (For DB2, database
   version must be 10.5 or above).
   2.  Add a document to a folder with name (say "Document1 Name")
   3.  Add a document to the same folder with a case insensitive
   name (say "document1 name")
   4.  The document will fail to file with the following error:
   Caused by: com.filenet.api.exception.EngineRuntimeException:
   FNRCE0043E: E_NOT_UNIQUE: A uniqueness requirement has been
   violated. The value for property Id
   ({00000000-0000-0000-0000-000000000000}) of class
   DynamicReferentialContainmentRelationship is not unique.
   failedBatchItem=0 errorStack={
   ...
   com.filenet.api.exception.EngineRuntimeException: FNRCD0015E:
   DB_NOT_UNIQUE: The update or insert failed due to an attempt to
   create a duplicate value in a unique index. ObjectStore: "os
   name", SQL: ""INSERT INTO Relationship (object_class_id,
   epoch_id, creator, create_date, modify_user, modify_date,
   object_id, head_id, head_id_class, tail_id, name,
   version_series_id, security_id) VALUES (?, ?, ?, ?, ?, ?, ?, ?,
   ?, ?, ?, ?, ?)" ...
   
   To workaround the issue I_RELATIONSHIP27 can be dropped and
   recreated without lower.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * This problem may affect sites using IBM Content Platform     *
   * Engine 5.2.1.6-P8CPE-FP006 and prior when adding a document  *
   * with the same name but a different case to a case sensitive  *
   * database object store created with case insensitive search   *
   * enabled.                                                     *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Using Content Platform Engine (CPE) 5.2.1.6-P8CPE-FP006 and  *
   * prior, adding case sensitive documents to a case sensitive   *
   * object store database created with case insensitive search   *
   * enabled results in a E_NOT_UNIQUE error when adding a        *
   * document with the same name but different case.              *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Upgrade to 5.2.1.7-P8CPE-FP007 or higher.                    *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  A unique containment name can be automatically generated for
   documents with the same name but different cases where the
   object store database is case sensitive and the case insensitive
   search is enabled.  Fixed in 5.2.1.7-P8CPE-FP007 and higher.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PJ44371
   
   
 * REPORTED COMPONENT NAME
   CONTENT ENGINE
   
   
 * REPORTED COMPONENT ID
   5724R8101
   
   
 * REPORTED RELEASE
   521
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-09-01
   
   
 * CLOSED DATE
   2017-06-28
   
   
 * LAST MODIFIED DATE
   2017-06-28
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CONTENT ENGINE
   
   
 * FIXED COMPONENT ID
   5724R8101
   
   

APPLICABLE COMPONENT LEVELS