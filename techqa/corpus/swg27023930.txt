Title: IBM Open Mic Webcast recording: Troubleshooting Notes/Domino NRPC Mail Routing issues - 9 May 2012 - United States

Text:
STEwebcastDocument; lste_webcast; Tech Exchange; STEwebcast; openmic call; open microphone call; discussion; conference call; customer call; submit; ask the experts; discuss; open mic; questions; answers; questions and answers; q&a; replay; recording; webcast; FAQ; best practice; transcript; nrpc; mail routing WEBCAST

ABSTRACT
 IBM hosted an Open Mic webcast with Lotus Development and Support Engineers on 9 May 2012. The topic was "Troubleshooting Notes/Domino NRPC Mail Routing issues." 

CONTENT



IBM hosted an Open Mic webcast with Lotus Development and Support Engineers on 9 May 2012 on the topic of "Troubleshooting Notes/Domino NRPC Mail Routing issues." The slides and recording of the event are posted below. 


For more information about our Open Mic webcasts, visit the IBM Collaboration Solutions Support Open Mics [http://www.ibm.com/software/lotus/support/lotus-open-mics/] page.

You can see questions posted prior to the event at this forum post [http://www.lotus.com/ldd/nd85forum.nsf/DateAllThreadedWeb/e73e9b33b9daf305852579d2004129dd?OpenDocument].

Questions and Answers from the web chat and phone:






Q: Is there a command to show what tasks have a hold on the mail.box? 

A: Yes, you can use the command "show router show queue" to show when mail is delayed, or you can run an NSD and that will show you what has a handle on the mail.box 



Q: My server is showing the error message "Router : number of memory segments exceeded". What would cause this? 

A: This is an indication of a memory problem. Collect and NSD and also run a memory dump by issuing the following server console command: load server -m. This dump file is placed in the IBM_TECHNICAL_SUPPORT folder. When you've collected these files, contact Lotus Support and we can analyze these to be more specific about what is causing the problem and helping to resolve it. 



Q: How can I check to see if Router or the SMTP task is running ? 

A: Show tasks on the Domino console 



Q: I believe that anti-virus products mark the messages in MAIL.BOX as "DEAD" or "HELD", is this correct? 

A: Anti-virus products usually mark messages as HELD to prevent the Router from processing the message 


Q: How many router instances can a server have running? 

A: Only one router instance can be run per Domino instance, but you can host more than one Domino instance on a partitioned server 


Q: I receive "Error transferring to mail.global.xxx.xxx.com; SMTP Protocol Returned a Permanent Error 550 5.4.1 Relay Access Denied". How do I correct this? 

A: This error indicates that Domino was successful in connecting to the recipient server, but the recipient server is having an issue. It may be that the recipient server is not an open relay. 



Q: If the size of an attachment has a limit and if a mail comes in with the size more than that limit, will the mail be in server mail.box or in the local mail.box? 

A: If the message size reaches the limit, messages will arrive to your Domino server mail.box and the router will reject the message and send a Delivery Failure Report back to the sender. The mail will be deleted from the mail.box. 



Q: If a mail message is in the server mail.box as a held or dead message, how can I automatically get that mail out of the mail.box? 

A: We do not know of an "automatic" way to releasing messages from the mail.box. You can remove them by using space saver options. 



Q: We have two Connection Documents. Out of the two, how do we make sure that one of them has the highest priority for mail routing? The second one should only work if the first server is down. 

A: When we're looking to make a connection, we're first going to go by cost and then by hops. If those are equal, we're going to fall back on the name of the server. So, whichever server falls first alphabetically, that is the one that we are going to use. In a failover situation such as this, if the first server alphabetically is really the one you want to use under most circumstances, then you can really have the Connection Documents similarly configured with a routing cost of 1 on both of them. If the first server is unavailable, it will go to the second connection. If the one you want to use falls second alphabetically, you will configure your Connection Documents by having a routing cost of 1 for the primary connection and a routing cost of 2 for the secondary connection. A NOTES.INI parameter that will be helpful when connections have the same cost and the first connection is not available is DebugRouterUseCostBiasDecision=1. This will move to the second connection to route the message. 



Q: When setting up a cluster, what is the best recommended way to route mail into that cluster ? Would it be NNN or by Connection Documents via cluster name? 

A: By Connection Docs via cluster name is the way to go so that any server that is up and running is ready to handle the message. 



Q: Sometimes we notice mail in the mail.box, but when we try to open the message, we get a pop-up that it is a non-existent document. What could be happening? 

A: This indicates that the message has already routed and you are seeing a remnant of the message in the view of the mail.box. One easy way to clean these up is to issue a "tell router c" command, which is in-place compaction of the router and will clear out those ghost messages. 



Q: I enabled additional debugging because I am seeing error messages in the log. Every time my Barracuda sends SMTP mail to my Domino server, I get "Error getting host name for the IP address the remote server is not a known TCPIP host". Is the host name of the Barracuda something that should be set in DNS or is this something that I should be able to configure in a Connection Document? 

A: Something to check would be to do a reverse DNS lookup. There really is no reason that Domino would have to resolve an incoming connection unless it is trying to do a verification in the DNS. Go to Router SMTP Restrictions and Controls -> SMTP Inbound Controls tab -> there are couple of sections here to check. In the "Inbound Connection Controls" section, the first field "Verify connecting host name in DNS"; if that is enabled, that may be what is causing a problem here. Also look at "Inbound Sending Controls" and "Verify senders domain in DNS". If this doesn't help pinpoint your issue, we should work with you in a PMR. 



Q: When I try to delete a dead message from mail.box, I get a message saying "Cannot change UNID" 

A: We suspect this could be the anti-virus program that is trying to change the UNID. If you are unsure if this is the cause of the problem, this requires a PMR for us to work with you to run debug and get more specific. 



Q: We are going through a rebrand soon. What is the difference in the Global Domain Document between the "Alternate Internet Domain Aliases" field and "Local Primary Internet Domain"; specifically, if we move down the current domain to "Alternate Internet Domain Aliases" and replace the current with the new one. What ramifications does that have? 

A: There really is not much of a difference. As long as the name is listed in one of those fields you are going to be ok. Even if your primary name was listed as an alias, router would know to use it. One thing to be aware of, if on the Router SMTP Basics tab -> Address Lookup field -> when changing the Internet Domain, address lookup means that we are going to look for an exact match for the full internet address. In the case where we don't find an exact match and you have "fullname only" enabled, if we are searching an internet address based on an Alternate Internet Domain Alias, we will actually do a second lookup for an address based on the primary internet domain to look for a match. So you can see how if you switch an internet domain from primary to alternate, or visa versa, it could change whether an address is successfully found or not. 



Q: How can I display routing tables and the cost which will tell how a server selects a path to another server? 

A: If you are using a NNN, the routing will happen in an alphabetical order. When router is building its routing tables, the router is going to take the least cost, or easiest, path to route. That is determined when the router is started up and every few minutes it will re-evaluate. DebugRouter=3 will give some more information as well. To see a path to one particular server, use "Trace <Servername>". And "Tell router dump routing tables". 



Q: How can you control whether the mail routes based on server-hub-server or a server-to-server direct connection when everything is in the same NNN? Is there a way to force mail routing to go through server-to-hub-server connection? 

A: Even though they are in the same NNN, you can use a Connection Document and set the appropriate routing cost. If they are in the same NNN, a Connection Document is not necessary, but if one exists, Domino will use it. 




PRESENTATION
[http://www.ibm.com/i/v16/icons/weblecture.gif][/support/docview.wss?uid=swg27023930&aid=2]May092012_OpenMic_NRPCRouting.pdf [/support/docview.wss?uid=swg27023930&aid=1]



AUDIO
[http://www.ibm.com/i/v16/icons/aud.gif][/support/docview.wss?uid=swg27023930&aid=4] Notes_Domino NRPC Mail Routing Issues Open Mic May 9 2012 (edited).mp3 [/support/docview.wss?uid=swg27023930&aid=3]



RELATED INFORMATION
 Troubleshooting SMTP inbound/outbound issues open mic r [http://www.ibm.com/support/docview.wss?uid=swg27023670]




ORIGINAL PUBLICATION DATE
 2012/1/18