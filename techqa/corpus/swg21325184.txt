Title: IBM Using Alternate E-mail Addresses for Notification - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 Using Alternate E-mail Addresses for Notification 

ANSWER


OVERVIEW 
 Continuus/CM and Continuus/PT currently utilize the trigger facility in order to provide users with notification that they have been assigned a task or problem. The trigger facility is provided with the assignee's user ID and other information about the task or problem. With this information, the trigger facility then sends e-mail to the Continuus user via the ID letting them know the details of this task or problem. This document provides details on how to set up task and problem notification to use a user-specified e-mail address rather than the userid of the assignee. 

DETAILS 
 To enable a user specified e-mail address to be used for notification, the first step is to modify the Trig_ui.def file for the appropriate platform. This file defines which types of objects will trigger events and what actions to take at each state of the lifecycle for those objects. For example, the default behavior for tasks when they are moved to the assigned state is to send an e-mail to the resolver of the task. If no changes have been made to the standard Trig_ui.def file, problem notification is not enabled. The Trig_ui.def file is located in <dbpath>/lib/notify/<platform> where <platform> is either Windows or Unix. When setting up user specified e-mail address, you should change the Trig_ui.def file for the platform where your users are working. 

 For general information about the Trig_ui.def file and the trigger facility, see technical bulletin TB125 and the readme file located in <dbpath>/lib/notify . What follows is a description of only the modifications necessary to use alternate e-mail addresses for notification. 

In the Windows\Trig_ui.def file, the line relevant to task notification upon assignment is: >  task_assigned ccm_mail.exe "-s""CM Synergy/PT Notification""-r" resolver "-c" =tsk_asgn.tpl; 
Broken down into parts, this line says that when tasks are moved into the task_assigned state, execute ccm_mail.exe passing everything else on the line as a parameter. The parameters that are not enclosed in quotes are replaced by the trigger facility with the relevant information. 'resolver' will be replaced with the userid of the user to which the task was assigned. =tsk_asgn.tpl tells the trigger facility to read <dbpath>\lib\notify\tsk_asgn.tpl , create a temporary file with the same contents and then replace the keywords inside. The path to the temporary file is then passed as a parameter to ccm_mail.exe. So, when the script is actually executed for an example task assigned to ccm_root, the command line will look something like: >  ccm_mail.exe -s CM Synergy/PT Notification -r ccm_root -c c:\temp\daaa123.tmp 
The â€“r flag in this case denotes the recipient of the e-mail, who is ccm_root. The Unix/Trig_ui.def file has a line that is very similar: >  task_assigned mailer "CM Synergy/PT Notification" resolver =tsk_asgn.tpl; 
This line has the same function as its Windows equivalent; with the difference being that the command called is a shell script instead of an executable and that the shell script doesn't require the same flags as ccm_mail.exe. In CM Synergy/CM 5.x, the recipient of an e-mail is actually specified in the first line of the .tpl file and not in the trigger script. By default in 5.x, each template file (.tpl) will start with the line: >  To: %resolver 
or >  To: %submitter_email 
To use the scripts below to send the e-mail to another user, you should remove this top line from the template file. This is unnecessary in CM Synergy version 4.x, where that line does not appear in the templates. In order to use user-specified e-mail addresses instead of userids, it is necessary to change the Trig_ui.def file to call a script of your own creation rather than the default script (or executable). On Windows, the script called is typically a batch file, although it can be perl or another scripting language if desired. For security reasons, only files in <dbpath>\lib\notify\Windows or in %CCM_HOME%\bin\util are eligible for execution. You should place your script into the same directory as the Trig_ui.def file you are modifying. In order to call a user-defined script named mailsend.bat that is in the same directory as Trig_ui.def, the following line can be used instead of the default. >  task_assigned mailsend.bat resolver =tsk_asgn.tpl; 
The line for the UNIX Trig_ui.def file is very similar: >  task_assigned mailsend resolver =tsk_asgn.tpl; 
Now that the Trig_ui.def files have been set up to call a user-defined script rather than the default mail command, the script files must be defined. Included below are example scripts for both UNIX and Windows that can serve as a framework with which to build your own scripts. Each script does the simple function of testing the resolver given by the trigger facility against a list of known users and then replacing the userid with the correct e-mail address. Anyone familiar with UNIX shell scripting or DOS batch file syntax should be able to easily modify these scripts to use a more complex method if desired. The Windows example batch file begins here: >  @echo off rem This script takes two arguments, the CM Synergy userid of the assignee and rem the temporary file which contains the contents of the e-mail to send. rem The basic method used in this script is an if-then-else structure, which checks rem to see what the userid is and then replaces the value with the correct e-mail rem address. rem At the beginning, we set the ADDRESS to empty. This will force every user to be rem defined in this list. If the user is not in the list, the CM Synergy administrator rem will receive an e-mail indicating an error with notification. rem If you prefer to have the CM Synergy userid be the default value and not rem have the CM Synergy administrator get e-mail upon failure, uncomment the line setting rem address to %1 and comment out the line following it. rem set ADDRESS=%1 set ADDRESS="" IF "%1" == "username1" set ADDRESS=username1@long_company_address.com [ADDRESS=username1@long_company_address.com] IF "%1" == "ccm_root" set ADDRESS=ccm_admin1@hotmail.com [ADDRESS=ccm_admin1@hotmail.com] IF "%1" == "admin2" set ADDRESS=11223344@skymail.com [ADDRESS=11223344@skymail.com] IF %ADDRESS%=="" goto UNKNOWN_USER rem original mail command from Trig_ui.def: rem ccm_mail "-s""CM Synergy/PT Notification""-r" resolver "-c" =tsk_asgn.tpl ccm_mail -s "CM Synergy/PT Notification"-r %ADDRESS% -c %2 goto END :UNKNOWN_USER set ADDRESS=ccm_admin@company.com [ADDRESS=ccm_admin@company.com] ccm_mail -s "CM Synergy/PT Notification failed for user %1"-r %ADDRESS% goto END :END rem Make sure to clean up the temporary file after sending mail del /f %2 
The example UNIX shell script begins here: >  #!/bin/sh # # This script takes two arguments, the CM Synergy userid of the assignee and # the temporary file which contains the contents of the e-mail to send. # # The basic method used in this script is an if-then-else structure which # checks to see what the userid is and then replaces the value with the # correct e-mail address. # # At the beginning, we set the ADDRESS to empty. This will force every user to # be defined in this list. If the user is not in the list, the CM Synergy # Administrator will receive an e-mail indicating an error with notification. # # If you prefer to have the CM Synergy userid be used as the e-mail address for # users not listed in the script, uncomment the line that sets the address to # $1 and comment out the line following it. #---------------------- Function to send mail -------------------------------- mailer() { mail_cmd="/bin/mail" os="`uname -s`" case $os in SunOS) mail_cmd="/usr/ucb/Mail";; HP-UX) mail_cmd="/usr/bin/mailx";; AIX) mail_cmd="/bin/mail";; IRIX|IRIX64) mail_cmd="/usr/sbin/Mail";; OSF1) mail_cmd="/usr/ucb/Mail";; esac if [ "$AC_PT_MAILER" != ""]; then mail_cmd=$PT_MAILER fi $mail_cmd -s "$1" $2 < $3 } #------------------------- End Functions ------------------------------- # ADDRESS=$1 ADDRESS="PLACEHOLDER_STRING" CM Synergy_ID=$1 export PATH if [ $CM Synergy _ID = "developer1"]; then ADDRESS= developer1@hotmail.com [developer1@hotmail.com] elif [ $CM Synergy _ID = "ccm_root"]; then ADDRESS= admin@company.com [admin@company.com] # insert your addresses here fi if [ $ADDRESS = "PLACEHOLDER_STRING"]; then mailer "CM Synergy/PT Notification failed for user $CM Synergy _ID" ccm_admin@company.com /dev/null rm -f $2 exit 1 fi mailer "CM Synergy/PT Notification" $ADDRESS $2 rm -f $2 exit 0 
CM Synergy 4.5, 5.1, 5.1cs, 6.1, 6.2, 6.3, 6.4, 6.5TB168ContentProduct versionPartner ContentInternal ContentCategoryReference I 

HISTORICAL NUMBER
 KB1698