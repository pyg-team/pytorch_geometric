Title: IBM Tivoli® SA MP update can fail when applying some DB2® fix packs if peer domains are already defined - United States

Text:
SA MP update; SA MP upgrade; TSA upgrade; TSA update PREVENTIVE SERVICE PLANNING

ABSTRACT
 This technote describes how to manually update Tivoli System Automation for Multiplatforms (SA MP) to a new release level when using the DB2 High Availability (HA) feature and peer domains that have already been defined. 

CONTENT
For the DB2 HA feature, the DB2 integrated installer provides IBM® Tivoli System Automation for Multiplatforms (SA MP) and the Reliable Scalable Cluster Technology (RSCT) components. Periodically, DB2 fix packs include updated SA MP code containing critical fixes for it. 

Refer to the DB2 Information Center page titled: "Supported software and hardware for IBM Tivoli System Automation for Multiplatforms (SA MP)" for a listing of SA MP levels that are bundled with each DB2 fix pack.

When applying a DB2 fix pack that contains a new SA MP release level, the DB2 installer will not upgrade the SA MP Base Component if a peer domain is already defined. You might see the following error message in the install log:

The DB2 install could not update the IBM Tivoli System Automation for Multiplatforms Base Component (SA MP Base Component) because there exists one or more IBM Reliable Scalable Cluster Technology (RSCT) peer domains. You must manually update the SA MP Base Component. For information about manually updating the SA MP Base Component, see the SA MP Base Component Installation and Configuration Guide.

If you do not want to remove the peer domains and want to upgrade SA MP to the new SA MP level, you can use the following instructions rather than having to refer to the SA MP Installation and Configuration Guide.



Migration to a new SA MP release level

The following steps should be run as root unless indicated otherwise.


 1. Set the initial configuration on all nodes. On all nodes, set the following environment variables:
    # export CT_MANAGEMENT_SCOPE=2
    # export JAVA_COMPILER=none
    
 2. As instance owner, stop the DB2 instance by running the following command:
    # db2stop force
    
 3. Stop the existing cluster domain by running the following command:
    # stoprpdomain –f <domain_name>
    
 4. Apply the appropriate DB2 fix pack level (DB2 V9.5 Fix Pack 6a or a later fix pack) by running the following commands:
    # cd <db2_install_file_dir>
    # ./installFixPack -b <db2_base_install_location>
    
 5. Install the SA MP 3.1 or 3.2 package by running the following commands:
    # cd <db2_install_file_dir>/db2/<platform>/tsamp/
    # ./installSAM
    
 6. Start the existing cluster domain by running the following commands:
    # startrpdomain <domain_name>


Post-migration steps:  1. Verify the active and installed version number by running the following commands:
    # lssrc -ls IBM.RecoveryRM
    
    Daemon State:
    My Node Name : host01
    Master Node Name : host01 (node number = 1)
    Our IVN : <new SA MP level>
    Our AVN : <old SA MP level>
    
    # lsrpdomain
    Name OpState RSCTActiveVersion MixedVersions TSPort GSPort
    ha_domain Online <old RSCT version> Yes 12347 12348
    
    # lsrpnode
    Name OpState RSCTVersion
    host01 Online <new RSCT version>
    host02 Online <new RSCT version>
    
    Note: it can take a few minutes before RSCTVersion is updated to the newly installed version and before the domain reports MixedVersions is Yes. Wait until this occurs before proceeding. 
    
 2. Update the RSCTActiveVersion. Ensure that all the nodes are online before issuing the following command:
    # runact -c IBM.PeerDomain CompleteMigration Options=0
    Resource Class Action Response for CompleteMigration
    
    # lsrpdomain
    Name OpState RSCTActiveVersion MixedVersions TSPort GSPort
    ha_domain Online <new RSCT version> No 12347 12348
    
 3. Activate the new features and finish the migration by running the following commands:
    # samctrl -m
    Ready to Migrate! Are you Sure? [Y|N]:.
    Y
    # lssrc -ls IBM.RecoveryRM
    
    Daemon State:
    My Node Name : host01
    Master Node Name : host01 (node number = 1)
    Our IVN : <new SA MP level>
    Our AVN : <new SA MP level>

RELATED INFORMATION
 V9.5: Upgrading IBM Tivoli SA MP Base Component [http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/index.jsp?topic=/com.ibm.db2.luw.admin.ha.doc/doc/t0051367.html]
V9.7: Upgrading IBM Tivoli SA MP Base Component [http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/index.jsp?topic=/com.ibm.db2.luw.qb.server.doc/doc/t0051367.html]