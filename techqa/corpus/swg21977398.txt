Title: IBM After restoring BigFix server database, ILMT/BFI/SUA server may not import all the data since the restore correctly - United States

Text:
sequance number; resotre; database; missing data; gap TECHNOTE (TROUBLESHOOTING)

THIS DOCUMENT APPLIES ONLY TO THE FOLLOWING LANGUAGE VERSION(S):
 English 

PROBLEM(ABSTRACT)
 After you restore the BigFix database and run an import, new data is not displayed in BFI/SUA/LMT even after successful ETL imports. 

SYMPTOM
Not all data reported already by endpoints to BigFix server are visible in LMT/BFI console. This may include scan results, capacity data, etc.


CAUSE
BFI/SUA/LMT is designed to import only newly created data. To achieve this, the data is marked with the so-called sequence number. The sequence number is incremented during every change, upload, scan, etc. Every import contains data starting from the sequence number reported during the last successful import to the current sequence number. 

When the database is restored, the sequence number is restored to the value from the time when the database backup was created. Because of that, it might happen that the sequence number after the restoration is lower than the sequence number reported during the last successful import. In such case, the first import after the database restoration does not include any data. After that import, the sequence number is updated and the next import contains new data. Depending on your scan settings, you might need to wait some time for the import that contains new data. 

When the database is restored, the sequence number is restored to the value from the time when the database backup was created.

Data for the period from the last successful import before the restoration of the database until the restoration is never imported (obviously, as the data was removed by restoring the DB) and needs to be re-generated by re-running the scans if needed. 

Data from DB restoration time until first successful import is also by default not imported (causing a gap). To cover this gap you may follow the procedure described below.



RESOLVING THE PROBLEM
Warning: The following procedure will impact the length of the first import after the sequence is reset. After performing below steps ALL DATA from all endpoints available on BigFix server side will be imported (not only covering the problematic gap). For big environments the impact may be huge and it is better to re-run scans on selected endpoints instead.

1) Ensure that the import is not running and stop the BFI/SUA/LMT server.
2) To reset the sequence for all data sources and import all data, run the following query on the BFI/SUA/LMT database:

DB2:
UPDATE dbo.DATASOURCE_SEQUENCES set LAST_SEQUENCE = blob(x'0000000000000000');

MSSQL:
UPDATE dbo.datasource_sequences set last_sequence = 0x0000000000000000;

3) Start the BFI/SUA/LMT. 
4) Run an import.

 



Cross reference information Segment Product Component Platform Version Edition Security IBM BigFix Inventory