Title: IBM IZ70082: EXCEPTION FBTKES007E OCCURS DURING SAML 2.0 ENCRYPTION - United States

Text:
  FIXES ARE AVAILABLE
Tivoli Federated Identity Manager 6.2.0 Fixpack 8 (6.2.0-TIV-TFIM-FP0008) [http://www-01.ibm.com/support/docview.wss?uid=swg24025908]
Tivoli Fed Id Mgr Business Gateway v6.2.0, Fix Pack 8, 6.2.0-TIV-TFIMBG-FP0008 [http://www-01.ibm.com/support/docview.wss?uid=swg24025909]
Tivoli Federated Identity Manager 6.2.0 Fixpack 9 (6.2.0-TIV-TFIM-FP0009) [http://www-01.ibm.com/support/docview.wss?uid=swg24029497]
Tivoli Fed Id Mgr Business Gateway v6.2.0, Fix Pack 9, 6.2.0-TIV-TFIMBG-FP0009 [http://www-01.ibm.com/support/docview.wss?uid=swg24029498]
Tivoli Federated Identity Manager 6.2.0 Fixpack 13 (6.2.0-TIV-TFIM-FP0013) [http://www-01.ibm.com/support/docview.wss?uid=swg24032915]
Tivoli Fed Id Mgr Business Gateway v6.2.0, Fix Pack 13, 6.2.0-TIV-TFIMBG-FP0013 [http://www-01.ibm.com/support/docview.wss?uid=swg24035012]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  if the custom property key.selection.criteria=only.alias is
   set, and SAML assertion encryption is enabled, then assertion
   encryption will throw the following two exceptions:
   
   1.
   com.tivoli.am.fim.kess.service.jks.worker.impl.KessServiceJksWor
   kerImpl getAlgorithm
   com.tivoli.am.fim.kess.exception.KessServiceKeyNotFoundException
   
   FBTKES007E A key was not found with the given alias
   
   2.
   com.tivoli.am.fim.fedmgr2.trust.TokenExchangeCommandImpl
   exchange
   
   java.util.MissingResourceException: Can't find resource for
   bundle
   com.tivoli.am.fim.i18n.msgs.STMMessages, key
   sam_invalid_keystore_alias
   
   The second exception is caused by the first exception, but it
   seems to be using an invalid message key
   'sam_invalid_keystore_alias'.
   
   If the 'key.selection.criteria' property is not set, then
   assertion encryption works (with all other settings remain the
   same).
   
   
    
   
   

LOCAL FIX
 *  unset 'key.selection.criteria' property. another possible
   workaround is to avoid having multiple copies of same
   exact certificate appear in keystores.
   
   
    
   
   

PROBLEM SUMMARY
 *  APAR IZ70082
   
   ABSTRACT:
   SAML Assertion Encryption Broken using alias.only for KESS
   
   ERROR DESCRIPTION:
   For TFIM 6.2, based on a feature introduced in PMR
   19696,49R,000,
   if the custom property key.selection.criteria=only.alias is set,
   and SAML assertion encryption is enabled, then assertion
   encryption will throw two exceptions:
   
   1.
   com.tivoli.am.fim.kess.service.jks.worker.impl.KessServiceJksWor
   kerImpl
   getAlgorithm
   com.tivoli.am.fim.kess.exception.KessServiceKeyNotFoundException
   :
   FBTKES007E A key was not found with the given alias
   
   2. com.tivoli.am.fim.fedmgr2.trust.TokenExchangeCommandImpl
   exchange
   java.util.MissingResourceException: Can't find resource for
   bundle
   com.tivoli.am.fim.i18n.msgs.STMMessages, key
   sam_invalid_keystore_alias
   
   The second exception is caused by the first exception, but it
   seems to
   be using an invalid message key 'sam_invalid_keystore_alias'.
   
   If the 'key.selection.criteria' property is not set, then
   assertion
   encryption works (with all other settings remain the same).
   
   LOCAL FIX:
   N/A
   
   PROBLEM SUMMARY:
   This problem occurs only if there is more than one copy of a
   particular
   key (across all key stores) referenced by different aliases.
   When the
   keys are read in from the keystores, only one copy of each key
   was
   being kept, and only one alias was associated with that key.
   When
   later the key was referenced by another of it's aliases, it was
   not found.
   
   PROBLEM CONCLUSION:
   The fix for this APAR is contained in the following maintenance
   packages:
   
   | Fix Pack | 6.2.0-TIV-TFIM-FP0008 |
   
   
    
   
   

PROBLEM CONCLUSION
 *  The fix for this APAR is contained in the following maintenance
   packages:
   
   | Fix Pack | 6.2.0-TIV-TFIM-FP0008 |
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ70082
   
   
 * REPORTED COMPONENT NAME
   TIV FED ID MGR
   
   
 * REPORTED COMPONENT ID
   5724L7300
   
   
 * REPORTED RELEASE
   620
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-02-10
   
   
 * CLOSED DATE
   2010-07-22
   
   
 * LAST MODIFIED DATE
   2010-07-22
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TIV FED ID MGR
   
   
 * FIXED COMPONENT ID
   5724L7300
   
   

APPLICABLE COMPONENT LEVELS
 * R620 PSY
   UP