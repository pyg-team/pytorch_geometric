Title: IBM Understanding, configuring and troubleshooting Sametime Classic policies - United States

Text:
sametime policies; policy; sametime server policies; 0x8000000D; stpolicy; st policy TECHNOTE (FAQ)

QUESTION
What information is available about SametimeÂ® server policies?

ANSWER
This document covers the "classic" policies which means there is no Sametime System Console used to administer the Sametime Community server.
The main purpose of the Sametime Policy Server application is to provide user policy information to the client and the server applications through the Sametime Community system. Policies are created by going through the "Administer the Server" link and can be defined for both users and groups. 

NOTE: Policy changes take effect after the Policy service is restarted or after a configurable timeout which does not require a server restart. Default is 60 minutes.

NOTE: Mail only groups will not work with Policies.

1. What functionality can be controlled through Policies?
Instant Messaging policies
a. Save Chat
b. Automatically save chat
c. Client to client voice chat
d. Allow users to connect to external communities

Instant Meeting
a. Allow users to create Instant Meetings
b. Enable Sametime IP audio and video 

Telephony
a. Telephony enabled for contact lists, instant meetings and instant messaging


2. How to configure policies?
Policies can be configured by clicking on the "Administer the Server" link on stcenter.nsf and clicking on the Policy section. The default policy applies to all users and will disable the options to Save a Chat Transcript, use the Voice Suite and start Instant Meetings until the default policy is modified. It is important to enable replication of stpolicy.nsf so that there is one uniform policy for each Sametime community.

Changes made through the "Administer the Server" link will be updated according to the Directory and Configuration refresh interval defined in the Community Services document. 

 * Directory refresh interval (minutes): ST Policy uses this as the groups cache refresh interval. 
 * Configuration refresh interval (minutes): ST Policy uses this as the rules/assignment refresh interval.



In addition to fields provided in the previous Sametime versions, the new GroupMembership and BaseMembership fields are supplied for ST Policy service purpose. The values depend on the type of LDAP. Sample settings for various LDAP servers are as follows: 
 * Domino LDAP:

GroupMembership:(&(objectclass=groupofnames)(member=%s)) 
BaseMembership: may be empty 
 * Active Directory:

GroupMembership:(&(objectclass=groupofnames)(member=%s)) 
BaseMembership:dc=domain,dc=com 
 * IBM LDAP and SunOne:

GroupMembership:(&(objectclass=groupofuniquenames)(uniqueMember=%s)) 
BaseMembership:dc=domain,dc=com 


3. How are Stpolicy calculations are handled when a user is assigned to multiple policies: 


Policy Attribute Policy A Policy B User access File Transfer allowed No Yes No File Transfer size -- 5 MB -- File Transfer allowed Yes Yes Yes File Transfer size 1 MB 5 MB 1 MB Use exclude file types list Yes No Yes Excluded File Types exe -- exe (union) Use exclude file types list Yes No Yes Excluded File Types exe jpg, bmp, doc exe, jpg, bmp, doc (union) Real Time Gateway Yes No No Allow users to create Instant Meetings No Yes No Enable Sametime IP audio Yes No No Enable Sametime IP video Yes No No Save Chat Yes No No Automatically save chat [/support/docview.wss?uid=swg21245232&amp;aid=1] [/support/docview.wss?uid=swg21245232&amp;aid=1] [/support/docview.wss?uid=swg21245232&amp;aid=1] Allow Telephony for buddy lists Yes No No 


4. What is the process flow of STPolicy? 
The STPolicy service initializes, logs into the Community server and starts listening for incoming policy requests. Policy calculations are derived by performing lookups to the LDAP server to obtain the groups a user belongs to and applying the rules, as defined in stpolicy.nsf. 
[/support/docview.wss?uid=swg21245232&aid=2] [/support/docview.wss?uid=swg21245232&aid=2] 

5. How to debug stpolicy: 
Enable debug by adding the following flags to the [Debug] section of the sametime.ini. 
[Debug]  * POLICY_DEBUG_LEVEL=1 - default flag value is 1

POLICY_DEBUG_LEVEL=3 - common information and warnings 
POLICY_DEBUG_LEVEL=5 - all messages  * ST_POLICY_NOTES_GROUPS=1 - trace information from Domino Directory lookup 



Configuration parameters in the sametime.ini  * POLICY_ADAPTER_IMPL=com.ibm.sametime.policy.calculateservice.PolicyDefaultAdapter 

Name of java class that implements a current Policy Adapter for ST Policy SA. Currently only PolicyDefaultAdapter is implemented. 
 * POLICY_DB_BB_IMPL=com.ibm.sametime.policy.databasebb.notes.DbNotesBlackBox 

Name of java class that implements the access to the policy data storage stpolicy.nsf. 
 * POLICY_DIRECTORY_BB_IMPL=com.ibm.sametime.policy.directorybb.ldap.DirLdapBlackBox

Name of java class that implements a directory Black Box, which looks for user public groups through organization Directory. 
com.ibm.sametime.policy.directorybb.ldap.DirLdapBlackBox implementation is used for LDAP Directory, 
com.ibm.sametime.policy.directorybb.notes.DirNotesBlackBox implementation is used for Domino Directory. 
 * POLICY_MAX_THREADS=5

A number of worker threads, calculating a user effective policy. Default (and recommended) value is 5 . 
 * POLICY_UNIQUE_TRACE_FILES=1

Flag indicates whether a new trace file needs to be created on every application starting. If not provided, the same trace file is used. 


Known problems: 

1. Problem: Client application gets "requested service not supported" error (0x8000000D) 

Possible reasons: 
 * Incorrect value is provided for POLICY_DIRECTORY_BB_IMPL key in [Policy] section of sametime.ini 
 * Setting for Domino Directory: 

POLICY_DIRECTORY_BB_IMPL=com.ibm.sametime.policy.directorybb.notes.DirNotesBlackBox 
 * Setting for LDAP Directory: 
   POLICY_DIRECTORY_BB_IMPL=com.ibm.sametime.policy.directorybb.ldap.DirLdapBlackBox




2. Problem: Exception error on the Domino console: 

com.ibm.sametime.policy.types.PolicyException: 
java.lang.ClassNotFoundException: 
com.ibm.sametime.policy.databasebb.notes.DbnotesBlackBox 

Possible reason: 
STPolicy statements in the sametime.ini is case sensitive. 

Note the sametime.ini entry 
POLICY_DB_BB_IMPL=com.ibm.sametime.policy.databasebb.notes.DbnotesBlackBox 

DbnotesBlackBox should be DbNotesBlackBox (capital D,N and B's) 
DbldapBlackBox should be DbLdapBlackBox (capital D, L, and B's)