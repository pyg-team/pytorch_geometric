Title: IBM Controller process aborts with "The underlying connection was closed ... An unexpected error occurred on a receive" caused by IIS application pool not responding to ping - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 User runs an intensive (long-running) task, for example importing structures. After some time (for example 2 hours) the Controller client crashes.

Inside the Event Viewer there are some error messages, which occur at the exact time that the process crashes. 

SYMPTOM
The following example is from when the user was trying to import structures: 

 

Application Log
Log Name: Application
Source: Cognos Controller
Date: 18/04/2018 14:22:20
Event ID: 0
Task Category: None
Level: Warning
Keywords: Classic
User: N/A
Computer: VBRACONT8AP7
Description:
Error occured at 18/04/2018 14:22:20 in IBM Cognos Controller, Error No=5, Source=FrangoDirect.ImportStructuresD.UpdateImpServer#System.Web.Services, Description=The underlying connection was closed: An unexpected error occurred on a receive.

Log Name: Application
Source: Cognos Controller
Date: 18/04/2018 14:22:21
Event ID: 0
Task Category: None
Level: Warning
Keywords: Classic
User: N/A
Computer: VBRACONT8AP7
Description:
Standard Error
Number: 5
Source: FrangoDirect.ImportStructuresD.UpdateImpServer#System.Web.Services
Description: The underlying connection was closed: An unexpected error occurred on a receive.
at Microsoft.VisualBasic.ErrObject.Raise(Int32 Number, Object Source, Object Description, Object HelpFile, Object HelpContext)
at Cognos.Controller.Common.RaiseErrCli.RaiseError(Int32 lErrNo, String sErrSource, String sErrDesc, String sErrHelpFile, Int32 lErrHelpContext)
at Cognos.Controller.Common.RaiseErrCli.RaiseError(Int32 lErrNo, String sErrSource, String sErrDesc)
at Cognos.Controller.Direct.ImportStructuresD.UpdateImpServer(String sXmlDoc)
at Cognos.Controller.Forms.Form.frmImportStruc.DoImportServer()

Log Name: Application
Source: Cognos Controller
Date: 18/04/2018 14:22:57
Event ID: 0
Task Category: None
Level: Warning
Keywords: Classic
User: N/A
Computer: VBRACONT8AP7
Description:
Standard Error
Source: System.Web.Services
Description: System.Web.Services.Protocols.SoapException: Server was unable to process request. ---> System.Exception: Security Error 1
at Cognos.Controller.Proxy.SoapExtension.ServerExtension.ValidateNativeUser(SoapMessage& message)
at Cognos.Controller.Proxy.SoapExtension.ServerExtension.ValidateUser(SoapMessage& message)
at Cognos.Controller.Proxy.SoapExtension.ServerExtension.ProcessMessage(SoapMessage message)
at System.Web.Services.Protocols.SoapMessage.RunExtensions(SoapExtension[] extensions, Boolean throwOnException)
at System.Web.Services.Protocols.SoapServerProtocol.CreateServerInstance()
at System.Web.Services.Protocols.WebServiceHandler.Invoke()
at System.Web.Services.Protocols.WebServiceHandler.CoreProcessRequest()
--- End of inner exception stack trace ---
at System.Web.Services.Protocols.SoapHttpClientProtocol.ReadResponse(SoapClientMessage message, WebResponse response, Stream responseStream, Boolean asyncCall)
at System.Web.Services.Protocols.SoapHttpClientProtocol.Invoke(String methodName, Object[] parameters)
at Cognos.Controller.ControllerSoapHttpClientProtocol.Invoke(String methodname, Object[] parameters)
at Cognos.Controller.Proxy.FrMiscBT.WSFrMiscBT.SoxT_EndSox(String sGuid, String sUser, String sSourceName, String sTriggerID, String sPerakt, String sBol)
at Cognos.Controller.Direct.SoxD.SoxEnd(String sSourceName, SoxFunctionID iTriggerID, String sPerAkt, String sBol)
at Cognos.Controller.Forms.Form.frmImportStruc.DoSOXEnd()
at Cognos.Controller.Forms.Form.frmImportStruc.IForm_DoClick(Int32 lCmd, String& sTag) 

 

System Log:
[/support/docview.wss?uid=swg22015661&aid=1] [/support/docview.wss?uid=swg22015661&aid=1]
Log Name: System
Source: Microsoft-Windows-WAS
Date: 18/04/2018 14:22:18
Event ID: 5010
Task Category: None
Level: Warning
Keywords: Classic
User: N/A
Computer: VBRACONT8AP7
Description:
A process serving application pool '.NET v2.0' failed to respond to a ping. The process id was '9172'.


CAUSE
There are several possible causes for "The underlying connection was closed ... An unexpected error occurred on a receive" errors. 

 * TIP: For more examples, see separate IBM Technote #1674415.


This Technote relates to the scenario where the Controller application server is overloaded, causing the IIS application pool to not respond to a ping.


DIAGNOSING THE PROBLEM
Check the 'System' Event Viewer log for a 'WAS' event, which mentions 'A process serving application pool ... failed to respond to a ping'.



RESOLVING THE PROBLEM
Fix: 

Increase the hardware specification of the Controller application server. 

 

Workaround: 

Temporarily disable IIS application pool pinging. 

 * It is recommended not to disable it long-term.


Steps: 

1. Logon to the Controller application server 

2. Launch IIS Manager 

3. Expand 'Application Pools' 

4. Right-click on the relevant application pool (the one which is mentioned inside the 'WAS' event, inside the System log) and choose 'Advanced Settings':
[/support/docview.wss?uid=swg22015661&aid=2] [/support/docview.wss?uid=swg22015661&aid=2] 

 

5. Change the setting "Ping Enabled" to False:
[/support/docview.wss?uid=swg22015661&aid=3] [/support/docview.wss?uid=swg22015661&aid=3]

6. Click OK
7. Repeat the task (for example structures import).

RELATED INFORMATION
 1674415 - ** Troubleshooting ** "The underlying connect [http://www.ibm.com/support/docview.wss?uid=swg21674415]