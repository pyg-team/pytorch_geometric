Title: IBM Querying rows added in a given interval - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 How can you query rows that have been added in the past 24 hours? 

ANSWER
If you want to see any rows that have been added to a table since a certain time, such as the last time the table was loaded. NPS does not automatically retain this information. There is a 'hidden' column, createxid, but that is an integer, and does not map to any date or time.
The solution is to create the table with a column that has a default value of now(). Then you can query against that column to find which rows have been added, within a given interval, to the table. Here is an example, which was created on January 12, 2009:

1. Create the table with a column with a default value of now().


 * create table testtable(testint integer, createtime timestamp default now());


2. Insert old data values: 
 * insert into testtable values (1,'2009-01-11');


3. Insert a new row in which the createtime column uses the default value of now() 
 * insert into testtable values(2); --The default value of now() will be used as the createtime


To find rows that have been added in the past 24 hours, run the following command: 
 * select * from testtable
 * 
 * where createtime > now() - interval '24 hours';


The query results show that one row was created in the last 24 hours:  * 
 * 1 2009-01-12 19:46:21


If your table already exists and you want to add the createtime column to it, NPS does not provide for an alter table command to add a column to an existing table. You can, however follow the procedure below to add the new column: 

Assume that testtable already exists and is populated with values. You would add the new createtime column as follows: 
 * create table testtable2
 * 
 * as
 * 
 * select *,now() creattime
 * 
 * from testtable
 * 
 * 
 * alter table testtable2 set privileges to testtable;
 * 
 * 
 * alter table testtable rename to testtable_old;
 * 
 * alter table testtable2 rename to testtable;
 * 
 * drop table testtable_old;


The final result is that the new column, createtime, has been added to testtable. 

All existing rows in the table have been populated with the current system time. As new rows are added, you can use the following query to find rows that have been added in the past 24 hours: 
 * select * from testtable
 * 
 * where createtime > now() - interval '24 hours'; 

 

HISTORICAL NUMBER
 NZ989148