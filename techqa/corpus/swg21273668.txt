Title: IBM TSAMP commands hang immediately after domain brought online - United States

Text:
tsa; tsamp; TIMEOUT; GBLRES_MONITOR_TIMEOUT; validation; lsrg; hung; hang; RecRM TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 TSAMP commands such as 'lssam' and 'lsrg' are hanging after domain was restarted. Also, if TSAMP resource classes such as IBM.ResourceGroup are specified as arguments to the lsrsrc command, it will also hang. 

RESOLVING THE PROBLEM
Check the "In Config State" to see if it says FALSE. This can be checked with the following command: 

 * 
 * lssrc -ls IBM.RecoveryRM


A state of FALSE would suggest that IBM.RecoveryRM is still performing "resource validation" which is a legitimate reason why commands like lsrg would be ignored by RecoveryRM and thus appear to be hung. Resource validation is the process which involves determining the OpState of all resources during domain startup, a process which uses the monitor scripts of each resource to check their OpStates. 

If TSAMP commands continue to appear hung well after the domain has successfully started, then there is the possibility that the validation process is not completing within the required period. This would be evident by seeing IBM.RecoveryRM bouncing on each node. If the validation process does not complete, IBM.RecoveryRM is intentionally terminated. It is then automatically restarted and resource validation starts again. Check the syslog for multiple messages that tell you IBM.RecoveryRM is starting over and over, and also look for messages that tell you that the master node is changing, over and over. 

In this situation, look for evidence of monitor command timeouts. This can be seen in the syslog with messages that contain the following text: 
GBLRESRM_MONITOR_TIMEOUT 

Check which resource's monitor script is timing out and start diagnosis of the script in an effort to find out why it is not completing. It is most likely the monitor TIMEOUTs that are causing the validation process to be incomplete since these monitor scripts are needed to determine the OpStates. So the monitor TIMEOUTs are the most likely root cause for IBM.RecoveryRM bouncing and thus the hung TSAMP command symptom. 

Note: There are documented cases where the monitor script (db2_monitor.ksh) for DB2 instance resources is relying on an NFS server running, yet this NFS server wouldn't be started until TSAMP comes online, thus the db2_monitor.ksh script wouldn't work during the resource validation process. The result is the problem described above. Modifying the db2_monitor.ksh script to not rely on an NFS server running would resolve the above described problem in the event that the monitor TIMEOUTs were linked to DB2 instance resources. The "In Config State" would be set to TRUE if IBM.RecoveryRM was ready to process user commands like "lsrg".