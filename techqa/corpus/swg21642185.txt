Title: IBM Multi-Protocol Gateway (MPGW) with XPath Routing Map configured in the Routing Action is not supported for MQ-to-HTTPS traffic pattern - United States

Text:
MQ; HTTPS; MPGW; XPATH; ROUTING TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 MPGW using Route Action with selection method as "use XPath to select Destination" and having the Routing Map object will not work for MQ to HTTPS. 

This may cause unexpected behavior when the traffic pattern is incorrectly set to MQ-to_HTTPS.



SYMPTOM
Unexpected behavior when using Routing Map, XPath, and MQ-to-HTTPS traffic.


CAUSE
When MPGW service uses a Routing Action with selection method as "Use XPath to select Destination" and having the Routing Map object configured, it uses <dp:set-target> extension element with its associated host and port attributes. Since the front side protocol is non-HTTP, it does not set those values for the "var://service/routing-url" routing variable correctly. Hence the message cannot be not routed. This method works if using the correct traffic pattern of HTTP(S)-to-HTTP(S). 

The solution for non-HTTP-to-HTTP(S) traffic pattern is to use DataPower read-write variable "var://service/routing-url" to route message to its designated destination. Here is the example of how to set this variable using XSLT: 

<dp:set-variable name="var://service/routing-url"
value="'protocol://target/URI'" />

For XML Firewall services: 

 * The protocol must be HTTP or HTTPS. If any other protocol, the service generates an error. 
 * The URI is stripped. To specify the URI, use the var://service/URI variable, as shown in the following excerpt: 

<dp:set-variable name="'var://service/routing-url'"
value="'http://10.10.36.11:2064'" />
<dp:set-variable name="'var://service/URI'"
value="'/service'" /> 
For Multi-Protocol Gateway and Web Service Proxy services:  * The protocol can be any supported protocol. 
 * The URI is absolute and cannot be controlled with the Propagate URI property (WebGUI) or propagate-uri command.


RESOLVING THE PROBLEM
The proper implementation would be to use "var://service/routing-url"
in a XSLT in the Route Action with Selection Method as "Use Stylesheet to Select Destination" or in the Transform Action to set this variable with the destination URL