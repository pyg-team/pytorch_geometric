Title: IBM KeyNotFoundException and CNTR0020E issued by the mediation flow component of WebSphere Enterprise Service Bus (WESB) and WebSphere Process Server (WPS) - United States

Text:
KeyNotFound; KeyNotFoundException; CNTR0020E; CWSXM0054E; WESB; ESB; mediation TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 If the Service Component Architecture (SCA) rolls back during processing, a KeyNotFoundException and a CNTR0020E message is issued by the mediation flow component. 

SYMPTOM
When the SCA container, which houses a mediation flow component, rolls back during the processing of an asynchronous callback response flow, any subsequent retry attempts might result in the following KeyNotFoundException thrown by the mediation flow component: 

CNTR0020E: EJB threw an unexpected (non-declared) exception during invocation of method "transactionRequiredActivitySessionSupports" on bean "BeanId(ULESBEAIApp#ULESBEAIEJB.jar#Module, null)". Exception data: com.ibm.wsspi.sibx.mediation.flow.action.FlowActionException: com.ibm.wsspi.sibx.context.KeyNotFoundException: CWSXM0054E: Key _EJX8oLoYEd6zT5BcoZ1pXg not found in context store when locating correlation information for module ULESBEAI


CAUSE
By default, a mediation flow component is configured to be part of a local transaction, which is separate from the SCA container in which it is housed. If the transaction for the SCA container experiences a rollback (for example in a heavily loaded system if the transaction for the SCA container timeout time is reached), the response processing for the mediation flow component continues to completion. As part of this asynchronous response processing, a message is removed from the context destination for the mediation flow component .

Default configuration
If the processing of the mediation flow component completes successfully, even if the transaction for the SCA container transaction experiences a rollback, this message is not put back onto the context destination. As a consequence, any retry attempt performed by the SCA container results in a KeyNotFoundException and the response flow processing for the mediation flow component fails.


DIAGNOSING THE PROBLEM
If you use WebSphere Enterprise Service Bus and WebSphere Process Server V6.0 and V6.1 and are experiencing transaction rollbacks while processing an asynchronous callback response flow, which involves a Mediation Flow Component, you might be affected by this problem.



RESOLVING THE PROBLEM
Configure your mediation flow component to be part of the same transaction unit as the SCA container in which it resides. You can complete this task by using WebSphere Integration Developer to perform the following steps: 

 1. Select the mediation flow component in the assembly diagram and view the properties.
    
    
 2. Select the Implementation tab followed by the Qualifiers tab.
    
    
 3. Add a "Transaction" qualifier, and set its value to "Global".

 

Cross reference information Segment Product Component Platform Version Edition Business Integration WebSphere Enterprise Service Bus Mediation Flow Module AIX, HP-UX, Solaris, Windows 6.1.2, 6.1, 6.0.2 Business Integration WebSphere Process Server Mediation AIX, HP-UX, Solaris, Windows 6.1.2, 6.1, 6.0.2 Business Integration WebSphere Process Server Service Component Architecture AIX, HP-UX, Solaris, Windows 6.1.2, 6.1, 6.0.2