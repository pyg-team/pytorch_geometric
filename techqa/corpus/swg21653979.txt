Title: IBM Big SQL authentication problems using JDBC or ODBC when using a secured web console to authenticate - United States

Text:
bigsql TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When the Big SQL component of BigInsights uses an SSL secured web console to authenticate, Big SQL cannot always authenticate a user connection with JDBC or ODBC.

This problem can be intermittent or persistent and impacts V2.1.0 and V2.1.0.1. 

SYMPTOM
You might see an exception similar to the following on your client or in the Big SQL log: 


java.sql.SQLException: Could not establish connection to jdbc:bigsql://11.22.333.73:7052/default [bigsql://9.30.164.73:7052/default]: Used host<11.22.333.73>
and port<7052> : authentication failed with authenticator = WebConsole : com.ibm.jsse2.util.j: PKIX path building failed
: java.security.cert.CertPathBuilderException: unable to find valid certification path to requested target
at com.ibm.biginsights.bigsql.jdbc.BigSQLConnection.<init>(BigSQLConnection.java:251)
at com.ibm.biginsights.bigsql.jdbc.BigSQLDriver.connect(BigSQLDriver.java:134)
at TestJDBCConn.main(TestJDBCConn.java:35)
Caused by: BigSQLServerException(message:authentication failed with authenticator = WebConsole : com.ibm.jsse2.util.j: PKIX path building failed: java.security.cert.CertPathBuilderException: unable to find valid certification path to requested target, errorCode:-30082, SQLState:08001)
at com.ibm.biginsights.bigsql.jdbc.driver.generated.ThriftBigSQL$connect_result.read(ThriftBigSQL.java:1625)
at bigsql.org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:78)
at com.ibm.biginsights.bigsql.jdbc.driver.generated.ThriftBigSQL$Client.recv_connect(ThriftBigSQL.java:113)
at com.ibm.biginsights.bigsql.jdbc.driver.generated.ThriftBigSQL$Client.connect(ThriftBigSQL.java:100)
at com.ibm.biginsights.bigsql.jdbc.BigSQLConnection.<init>(BigSQLConnection.java:212)
... 2 more 


RESOLVING THE PROBLEM
 

 1. Stop the Big SQL server by typing the following command on the Linux command line: 
    $BIGSQL_HOME/bin/bigsql stop
    
 2. Open the $BIGSQL_HOME/conf/bigsql-conf.xml file on the machine that is running the Big SQL server. The value of property bigsql.security.webConsole.url should be a hostname of the web console, not an IP address. This hostname must be the same as the name that is specified in the web console SSL certificate.
    
 3. Set the trust-store location in the $BIGSQL_HOME/bin/bigsql file immediately after the #!/bin/sh line on the machine that is running the Big SQL server. The location depends on one of the following two options:  *  If you have not changed the default SSL certificate of the web-console-server after the installation, then the keyStore file path of the web console server is: $BIGINSIGHTS_HOME/console/wlp/usr/servers/waslp-server/resources/security/biginsights.jks 
       
       This file is present only on the host that runs the web console server. If the Big SQL server is running on a different host, then copy the file from the web console server host to the bigsql-server host.
       
       Add the following line to $BIGSQL_HOME/bin/bigsql: 
       
       (note: make sure that the export instruction is on one line)
       export BIGSQL_JAVA_OPTS=
       "-Djavax.net.ssl.trustStore= $BIGINSIGHTS_HOME/console/wlp/usr/
       servers/waslp-server/resources/security/biginsights.jks $BIGSQL_JAVA_OPTS"
       If you have changed the default SSL certificate of the web console server after the installation, then extract the public-key from the keystore and put it in a trustStore file by using $JAVA_HOME/bin/keytool.
       
       Add the following line to $BIGSQL_HOME/bin/bigsql: 
       
       (note: make sure that the export instruction is on one line)
       
       export BIGSQL_JAVA_OPTS=
       "-Djavax.net.ssl.trustStore=
       </path/to/trust-store-file> $BIGSQL_JAVA_OPTS"
       
    
    
 4. Restart the Big SQL server by typing the following command on the Linux command line:
    $BIGSQL_HOME/bin/bigsql start