Title: IBM Social Media Publisher deployment fails on Portal 8.0.0.1 upgrade when configured with Oracle 11.2.0.2 or higher - United States

Text:
ConfigEngine; Oracle TECHNOTE (TROUBLESHOOTING)

PROBLEM
 The deployment of Social Media Publisher for Web Content Manager fails when deploying on a WebSphere Portal 8.0.0.1 system that was configured by upgrading from WebSphere Portal 8.0 and configured to use Oracle 11.2.0.2 or higher prior to upgrading to WebSphere Portal to 8.0.0.1

SYMPTOM
The ConfigEngine task deploy-wcm-social fails with the following error:

[ConfigModuleClient] Force unlock option: True<br/>
[ConfigModuleClient] Failed to complete: com.aptrix.pluto.util.RepositoryException: Message: Failed to import the directory "/opt/IBM/WebSphere/wp_profile/paa/wcm_social/components/wcm_social/content/wcm/libraries". Error message: Message: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed., Cause: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed., Cause: java.lang.Exception: Failed to import the directory "/opt/IBM/WebSphere/wp_profile/paa/wcm_social/components/wcm_social/content/wcm/libraries". Error message: Message: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed., Cause: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed.<br/>
</body>
[echo] deploy-apps-applySIFeaturePack EJPCE0101E: Extension point implementation task failure on component for the following assembly: wcm_social, component components/wcm_social
[echo] [si-deploy-paa-content] EJPCE0016E: Task has failed to complete with the following arguements: ConfigExtensionList=-applySIFeaturePack, ComponentList=components/wcm_social, FunctionalArea=featurepackSI
[echo] [deploy-paa]: wcm_social /opt/IBM/WebSphere/wp_profile/paa.EJPCE0007E: Task failed to complete. Please check logs for further details

BUILD FAILED
/opt/IBM/WebSphere/PortalServer/wcm/prereq.wcm/config/includes/extensions_cfg.xml:121: The following error occurred while executing this line:
/opt/IBM/WebSphere/PortalServer/solutionInstaller/wp.si/config/includes/SolutionInstaller_cfg.xml:552: [deploy-paa]: wcm_social /opt/IBM/WebSphere/wp_profile/paa.EJPCE0007E: Task failed to complete. Please check logs for further details

Total time: 4 minutes 8 seconds
FAILURE_LOG_DIR=null
isIseries currently set to: null
Creating failure log in directory: /opt/IBM/WebSphere/wp_profile/ConfigEngine/log
traceFile created /opt/IBM/WebSphere/wp_profile/ConfigEngine/log/failure2012-12-15-11.16.41.log
basepath = /opt/IBM/WebSphere/PortalServer/solutionInstaller/wp.si


CAUSE
 Invalid column storage type in the database.

RESOLVING THE PROBLEM
Reconfigure Oracle JCR Domain Database - XML Column type 

1) Examine the existing definition of the column( adjust the schema as needed ):

set long 10000;
set pagesize 10000;
SELECT dbms_metadata.get_ddl('TABLE','ICMUTSWIDE0','JCR') FROM dual;


We are looking for the line stanza that defines the XML Column type. 
This will start with: XMLTYPE COLUMN "STRUCTUREDDATA" STORE AS

If the definition contains STORE AS ... CLOB (
then the schema is correct and no action is necessary. For example:
XMLTYPE COLUMN "STRUCTUREDDATA" STORE AS BASICFILE CLOB (
TABLESPACE "ICMLFQ32" ENABLE STORAGE IN ROW CHUNK 8192 RETENTION
NOCACHE LOGGING


If the definition is contains STORE AS ... BINARY XML (
then the schema is incorrect and the following activity needs to be completed. 
For example:
XMLTYPE COLUMN "STRUCTUREDDATA" STORE AS SECUREFILE BINARY XML (
TABLESPACE "ICMLFQ32" ENABLE STORAGE IN ROW CHUNK 8192
NOCACHE LOGGING


PLEASE NOTE. Before continuing, make sure you have a valid backup of your JCR Domain Database.

2) Rename the existing XML column ( adjust the schema as needed )
ALTER TABLE JCR.ICMUTSWIDE0 RENAME COLUMN STRUCTUREDDATA TO STRUCTUREDDATABIN;

3) Create a new XML column that is STORED AS CLOB ( adjust the schema as needed )
ALTER TABLE JCR.ICMUTSWIDE0 ADD(STRUCTUREDDATA XMLTYPE) XMLType COLUMN STRUCTUREDDATA STORE AS CLOB (TABLESPACE "ICMLFQ32" CHUNK 8192 NOCACHE LOGGING );
** Note that specific storage options such as the table tablespace, extent information, etc can be taken from Step #1 or modified as necessary.

4) Copy Data From old column to new column ( adjust the schema as needed )
UPDATE JCR.ICMUTSWIDE0 SET STRUCTUREDDATA = STRUCTUREDDATABIN;

5) Drop the original column ( adjust the schema as needed )
ALTER TABLE JCR.ICMUTSWIDE0 DROP COLUMN STRUCTUREDDATABIN;

6) Verify the steps have produced the desired schema change by performing Step #1 again.

7) Rerun ConfigEngine task deploy-wcm-social





 * 
 *