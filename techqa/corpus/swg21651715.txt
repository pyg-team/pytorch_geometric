Title: IBM Embedded images in XLS reports - United States

Text:
tcr excel xls xlwa missing image picture worksheet trcmd distribute mht url gateway TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 A Cognos report includes an image in the header. The image is correctly showed when the report format is HTML or PDF.
If the report is executed via command line using trcmd -distribute command with -format XLS, the output does not include the expected image. 

SYMPTOM
Running the report from CLI with command: 

trcmd -distribute -report "/content/package[@name='Report_excel']/report[@name='ReportName']" -format XLS -location /tmp/Sample.xls -user <user> -password <password> 

TCR generates a report in Excel 2000 format.
The report content is correct, but the image is not showed, in its place there is a little icon indicating a missing/not found object.


CAUSE
The problem is not related to the image size or format.
Even using a very small image and one of the supported format, the xls output file does not contain it.
The problem is actually related to the way Cognos handles URL file name resolution for Excel 2000/2002 format.

When you execute the report from CLI, you can only generate Excel 2000 (using format option XLS) or
Excel 2002 (using format option XLWA).
Excel 2007 format can be only requested using TCR GUI.

The Excel 2000/2002 formats generated by Cognos are in fact MHT (Multipage-HyperText) formatted for Excel, while Excel 2007 is a binary file.

The MHT file does not contain the actual images, they are referenced as external http links (URLs). 
When you open the report output file with Excel, it downloads the image using this URL and then shows it in the worksheet as per report design.
If the image path is not fully qualified in the report, the server name that is prefixed to the path is taken from the gateway URI as found in Cognos Configuration.
If the gateway URI is defined using localhost (or any other notation not accessible from the client machine where Excel is being launched), the above problem occurs.

The problem does not occur if you select "Excel 2007" format from TCR GUI, because the generated file is a binary that embeds picture data instead of referencing an external link.


RESOLVING THE PROBLEM
Using Cognos Configuration GUI, change the Gateway URI from the original one (hostname of TCR server or 'localhost') to the fully qualified domain name (FQDN) address of the TCR server. 

The TCR FQDN must be reachable from the machine you are executing the Excel program on. 
Save the configuration and restart TCR to activate the changes.
Run the report again using trcmd -distribute command.
Now the image will be correctly shown into the report output.
This solution works fine when opening the report file using an Excel version older than 2007.
Excel 2007 introduced meaningful changes in the way it manages MHT files and some features have been removed, so it is possible that the report content is correct but the image is not shown anyway.
In this case, the only option is to run the report from TCR GUI and select "Excel 2007" format to have an output that is 100% compatible with Excel 2007.

 

PRODUCT ALIAS/SYNONYM
 Tivoli Common reporting V2.1.1