Title: IBM Case Analyzer Microsoft SQL Database tables not populated after installation or upgrade - United States

Text:
Case Analyzer event tables not updated microsoft sql server database TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After an event is generated by IBM Case Manager, the Case Analyzer (CA) fact tables are not updated. 


SYMPTOM
Running SELECT * FROM schema_name.F_Event lists all elements in the F_Event table. There will be no new entries in the table since the time of installation or upgrade.


CAUSE
The database collation may be configured with an unsupported setting causing the datetime type to receive values in an unreadable format. For example, DD-MM-YYYY rather than YYYY-MM-DD. 

The value of analyzer.db.updateMode may be set to CUSTOM_BATCH



ENVIRONMENT
Filenet Content Manager 5.2.1
Microsoft SQL database
Microsoft SQL Server 2012



DIAGNOSING THE PROBLEM
The pesvr_system.log will contain the following:

2016/05/17 16:26:21.628+0000 CAPublisher d24081f2 [Error] Unexpected exception occurred while processing task CAPublisher for store CAStore for Case Analyzer.; Exception: com.microsoft.sqlserver.jdbc.SQLServerException: The conversion of a varchar data type to a datetime data type resulted in an out-of-range value. 
at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDatabaseError(SQLServerException.java:197) 
at com.microsoft.sqlserver.jdbc.TDSTokenHandler.onEOF(tdsparser.java:246) 
at com.microsoft.sqlserver.jdbc.TDSParser.parse(tdsparser.java:83) 
at com.microsoft.sqlserver.jdbc.SQLServerStatement.getNextResult(SQLServerStatement.java:1488) 
at com.microsoft.sqlserver.jdbc.SQLServerStatement.doExecuteStatement(SQLServerStatement.java:775) 
at com.microsoft.sqlserver.jdbc.SQLServerStatement$StmtExecCmd.doExecute(SQLServerStatement.java:676) 
at com.microsoft.sqlserver.jdbc.TDSCommand.execute(IOBuffer.java:4575) 
at com.microsoft.sqlserver.jdbc.SQLServerConnection.executeCommand(SQLServerConnection.java:1400) 
at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeCommand(SQLServerStatement.java:179) 
at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeStatement(SQLServerStatement.java:154) 
at com.microsoft.sqlserver.jdbc.SQLServerStatement.executeUpdate(SQLServerStatement.java:633) 
at com.ibm.ws.rsadapter.jdbc.WSJdbcStatement.pmiExecuteUpdate(WSJdbcStatement.java:1804) 
at com.ibm.ws.rsadapter.jdbc.WSJdbcStatement.executeUpdate(WSJdbcStatement.java:1135) 
at filenet.eventexporter.ca.publisher.fact.FactDataEnvironment.customBatchInsert(FactDataEnvironment.java:209) 
at filenet.eventexporter.ca.publisher.fact.FactDataEnvironment.bulkInsert(FactDataEnvironment.java:461) 
at filenet.eventexporter.ca.publisher.fact.BulkFactTable.update(BulkFactTable.java:143) 
at filenet.eventexporter.ca.publisher.fact.FactManager.performBulkUpdate(FactManager.java:218) 
at filenet.eventexporter.ca.publisher.CAEventPublisherBucket.doPublisherBulkInsert(CAEventPublisherBucket.java:210) 
at filenet.eventexporter.ca.publisher.CAEventPublisherTask.doPublisherBulkInsert(CAEventPublisherTask.java:254) 
at filenet.eventexporter.common.EventPublisherTask.doJob(EventPublisherTask.java:167) 
at filenet.jpe.server.common.DelayBackgroundTask.run(DelayBackgroundTask.java:232) 
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1157) 
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:627) 
at java.lang.Thread.run(Thread.java:801)

Run SELECT * FROM scheme_name_X_CAProperties. The output will show that the value for analyzer.db.updateMode is set to CUSTOM_BATCH.



RESOLVING THE PROBLEM
Change collation of Microsoft SQL database to English. For example: SQL_Latin1_General_CP1_CI_AS.

The value for analyzer.db.updateMode should be set to BATCH. IBM support can provide instructions on how to do this.