Title: IBM pureScale: How to setup multipath devices for failover to take place in Spectrum Scale Replication. - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 I have setup multipath devices to work with Spectrum Scale (GPFS) replication in my pureScale cluster.
However, the pureScale system is hanging if one of the storage device goes offline.

Why does this happen, and how can I setup the devices for GPFS failover to take place as expected? 

CAUSE
The multipath devices might be configured as features= "1 queue_if_no_path" by default like as below:.


 * 
 * 
 * defaults {
   user_friendly_names yes
   find_multipaths yes
   }
   blacklist {
   }
   

 * 
 * 
 * mpathe (360050768028488816800000000000024) dm-8 IBM ,2145
 * 
 * size=100G 
 * features='1 queue_if_no_path'
 * hwhandler='0' wp=rw
 * 
 * 


The I/O would stop in a storage failure due to the settings, then it causes a hang issue on pureScale cluster. Please see the Linux manual page for more information on the queue_if_no_path settings.

Issues with queue_if_no_path feature [https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/7/html/DM_Multipath/queueifnopath_issues.html]
If a multipath device is configured with features "1 queue_if_no_path", then any process that issues I/O will hang until one or more paths are restored.



ANSWER
Please setup multipath devices as below: 

 

1. Make sure of Device Mapper Multipathing (DM-MP) settings in your multipath device manuals, then follow the instructions. 

For instance, if you use IBM Storwize V7000, please see:
Multipath support for hosts running the Linux operating system [https://www.ibm.com/support/knowledgecenter/ST3FR7_7.8.0/com.ibm.storwize.v7000.780.doc/svc_linmultipathovr_21bb33.html]
Settings for Linux hosts [https://www.ibm.com/support/knowledgecenter/ST3FR7_7.8.0/com.ibm.storwize.v7000.780.doc/svc_linux_settings.html]

2. Update /etc/multipath.conf so that GPFS failover can take place accordingly.

IBM Spectrum Scaleâ„¢ Frequently Asked Questions and Answers [https://www.ibm.com/support/knowledgecenter/SSFKCN/com.ibm.cluster.gpfs.doc/gpfs_faqs/gpfsclustersfaq.html#dmmp]
Q4.6: What considerations are there when setting up DM-MP multipath service? 

 * 
 * 
 * 
 * 
 * features "0"
 * 
 * failback immediate
 * 
 * no_path_retry fail



Figure 1.sample multipath.conf with V7000 in RHEL 7.2: 

defaults {
user_friendly_names yes
find_multipaths yes
polling_interval 30
}
devices {
device {
vendor "IBM"
product "2145"
path_grouping_policy "group_by_prio"
path_selector "service-time 0" # Used by Red Hat 7.x
prio "alua"
path_checker "tur"
failback "immediate"
no_path_retry fail
rr_weight uniform
rr_min_io_rq "1"
dev_loss_tmo 120
features "0"
}
}
blacklist {
} 
Figure 2. sample multipath -l on the same setup as figure 1. 

mpathe (360050768028488816800000000000024) dm-7 IBM ,2145
size=100G features='0'hwhandler='0' wp=rw
|-+- policy='service-time 0' prio=0 status=active
| |- 5:0:2:0 sdn 8:208 active undef running
| |- 5:0:3:0 sdt 65:48 active undef running
| |- 6:0:2:0 sdbn 68:16 active undef running
| `- 6:0:3:0 sdbt 68:112 active undef running
`-+- policy='service-time 0' prio=0 status=enabled
|- 5:0:1:0 sdh 8:112 active undef running
|- 5:0:0:0 sdb 8:16 active undef running
|- 6:0:0:0 sdbb 67:80 active undef running
`- 6:0:1:0 sdbh 67:176 active undef running 
RELATED INFORMATION
#