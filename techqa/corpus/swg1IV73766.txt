Title: IBM IV73766: IBM I OS AGENT PRIVATE SITUATION USING *REGEX DOES NOT START - United States

Text:
  A FIX IS AVAILABLE
IBM Tivoli Monitoring 6.3.0 Fix Pack 6 (6.3.0-TIV-ITM-FP0006) [http://www-01.ibm.com/support/docview.wss?uid=swg24040390]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  IBM i OS agent private situation does not start if the regular
   expression (*REGEX) predicate function is used in the criteria
   to define a situation.
   
   If *REGEX is used in the situation criteria, the situation does
   not start and a message is written to the agent log similar to
   this:
   
   The private situation definition <situation_name> is rejected.
   The regular expression <regular_expression> validation failed at
   Line 0 offset 0 status U_INVALID_CHAR_FOUND.
   
   RECREATE INSTRUCTIONS:
   1. Create a private situation in the a4_situations.xml file that
   uses *REGEX in the criteria. For example:
   
   <privatesit>
       <SITUATION NAME="CPI80MSGS" INTERVAL="000500" ></SITUATION>
       <criteria>
         <![CDATA[ *VALUE OS400_Message.Message_Queue_Library *EQ
   QSYS *AND
                   *VALUE OS400_Message.Message_Queue *EQ QSYSOPR
   *AND
                   *REGEX OS400_Message.ID *EQ "pattern.*" ]]>
       </criteria>
       <sitinfo>
         <![CDATA[SEV=CRITICAL;COUNT=1;]]>
       </sitinfo>
   </privatesit>
   
   The a4_situations.xml file is located by default in the
   following IFS directory:
   
   /QIBM/UserData/IBM/ITM/localconfig/a4
   
   2. Restart the IBM i OS agent.
   
   3. The situation is not displayed in the OMA log (i.e.
   DSPOMALOG)
   
   4. Look for a message in the agent log (i.e.
   QAUTOTMP/KA4AGENT01) that indicates the situation was not
   started. To locate, search on the situation name. If the
   message is not located, set KBB_RAS1 tracing
   level to ERROR (UNIT:KRA ALL) in QAUTOTMP/KMSPARM.
   
   
    
   
   

LOCAL FIX
 *  No workaround available.
   
   
   If possible, redefine the situation criteria to not use the
   *REGEX predicate function.
   
   
    
   
   

PROBLEM SUMMARY
 *  An i5/OS platform autonomous agent private situation that
   includes the *REGEX (Regular Expression) operator will cause the
   situation to end with an error.  The i5/OS agent RAS1 log will
   show these error messages:
   
   The private situation definition <situation_name> is rejected.
   The regular expression <regular_expression> validation failed at
   Line 0 offset 0 status U_INVALID_CHAR_FOUND.
   
   This problem only occurs with i5/OS platform agents.
   There were multiple problems discovered for this APAR.
   
   Item 1.) Any i5/OS platform autonomous agent private situation
   that includes the *REGEX (Regular Expression) operator will
   cause the situation to end with an error.
   
   For example, if you define this situation in the
   localconfig/a4/a4_situations.xml file, the situation will be
   rejected with an error.
   
     <privatesit>
       <SITUATION NAME="PMR9258869G760" INTERVAL="000000"
   ></SITUATION>
       <criteria>
         <![CDATA[ *VALUE OS400_Message.Message_Queue_Library *EQ
   QSYS *AND
                   *VALUE OS400_Message.Message_Queue *EQ QSYSOPR
   *AND
                   *REGEX OS400_Message.ID *EQ "CPI80.*" ]]>
       </criteria>
       <sitinfo>
         <![CDATA[SEV=CRITICAL;COUNT=1;]]>
       </sitinfo>
     </privatesit>
   
   When the agent starts, the RAS1 log will show these error
   messages:
   
   The private situation definition <PMR9258869G760> is rejected.
   The regular expression <*VALUE
   OS400_Message.Message_Queue_Library *EQ QSYS *AND *VALUE
   OS400_Message.Message_Queue *EQ QSYSOPR *AND *REGEX
   OS400_Message.ID *EQ "CPI80.*"> validation failed at Line 0
   offset 0 status U_INVALID_CHAR_FOUND.
   
   This issue occured because the *REGEX input string in the i5/OS
   EBCDIC private situation is not being properly translated before
   it gets passed to the TEMA ICU Regular Expression engine.
   
   
   Item 2.) When defining an i5/OS platform private situation using
   the *REGEX regular expression operator, if the *REGEX value
   contains square bracket or carot characters, the EIF event sent
   to Omnibus shows question marks '?' instead of square bracket or
   carot characters, in the Summary field or slot.
   This occurs for both CHAR or UTF8 string type attributes.
   
   For example, this situation:
   
     <privatesit>
       <SITUATION NAME="i5OS_Disk_Name_REGEX_upper_num"
   INTERVAL="000500" ></SITUATION>
       <criteria>
         <![CDATA[ *REGEX i5OS_Disk.Name *EQ "[[A-Z]|[0-9]]" ]]>
       </criteria>
       <sitinfo>
         <![CDATA[ATOM=KA4DISKI5.NAME;SEV=CRITICAL;COUNT=1;]]>
       </sitinfo>
     </privatesit>
   
   Results in this entry in the Omnibus Event Console summary slot:
   Summary : i5OS_Disk_Name_REGEX_upper_num[Name = ??A-Z?|?0-9?? ]
   
   Any characters used in the regular expression statement should
   be displayed properly in the resulting EIF event.
   
   
   Item 3.) A specialized issue exists when defining a *REGEX
   Private Situation with the OS400_Message attribute group using
   the fix for this APAR IV73766. When a OS400_Message attribute
   group situation is started, its data collector attempts to
   retrieve any OS400_Message messages that were generated in the
   last 30 minutes.  Including the *REGEX operator in a
   OS400_Message private situation will result in these existing
   messages from the last 30 minutes being discarded or thrown
   away.  Once the *REGEX situation is started, all new messages
   will be collected and evaluated as expected.
   
   
   Item 4.) The *REGEX operator can not be used with certain
   attributes from the IBM i OS Agent attribute group named
   i5OS_Integrated_File_System_Object.  You can not specify a
   regular expression string for the
   i5OS_Integrated_File_System_Object.Path or
   i5OS_Integrated_File_System_Object.Name attributes. The data
   collector for these attributes requires valid path and file name
   values in order to collect data.
   
   
    
   
   

PROBLEM CONCLUSION
 *  These fixes listed below were made to address the 3 problems
   noted:
   
   Item 1.) For the i5/OS platform, the fix insures the input
   private situation *REGEX expression string is properly converted
   from the native EBCDIC code page before being passed to the ICU
   service to evaluate the *REGEX regular expression thresholds.
   
   Item 2.) The TEMA code that formats and displays the EIF event
   situation formula strings was corrected to ensure that regular
   expression characters like square brackets '[' ']' or carot '^'
   are correctly converted from EBCDIC to ASCII so they are
   properly displayed on the EIF Omnibus console.
   
   Item 3.) There is currently no code fix that will ensure any
   existing OS400_Message messages created in the last 30 minutes
   will be collected and evaluated when a *REGEX operator is
   defined for a OS400_Message private situation. Once the *REGEX
   situation for the OS400_Message attribute group has been
   started, all new OS400_Message messages will be collected and
   evaluated using the *REGEX regular expression.
   
   Item 4.) There is currently no code fix that will allow you to
   specify a regular expression string for either the
   i5OS_Integrated_File_System_Object.Path or
   i5OS_Integrated_File_System_Object.Name attributes when using
   the *REGEX operator.
   
   
   The fix for this APAR is contained in the following maintenance
   packages:
   
     | fix pack | 6.3.0-TIV-ITM-FP0006
   
   
    
   
   

TEMPORARY FIX
 *  Item 3)
   when defining a private situation using the *REGEX operator
   against the OS400_Message attribute group.  You can set the
   agent configuration variable KA4_MSGS_FROM_SIT_START=1 to tell
   the OS400_Message collector to intentionally skip collection of
   the last 30 minutes of messages and only collect any new
   messages generated since the situation starts.  This will avoid
   any error messages being printed as a result of using *REGEX
   with the OS400_Message attribute group.
   
   
   Item 4)
   Using the *REGEX operator with the
   i5OS_Integrated_File_System_Object attribute group.  You can
   specify a regular expression string with any other string
   attribute except Path and Name.
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV73766
   
   
 * REPORTED COMPONENT NAME
   TEMA
   
   
 * REPORTED COMPONENT ID
   5724C04TE
   
   
 * REPORTED RELEASE
   630
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2015-06-01
   
   
 * CLOSED DATE
   2015-08-19
   
   
 * LAST MODIFIED DATE
   2015-12-10
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TEMA
   
   
 * FIXED COMPONENT ID
   5724C04TE
   
   

APPLICABLE COMPONENT LEVELS
 * R630 PSY
   UP