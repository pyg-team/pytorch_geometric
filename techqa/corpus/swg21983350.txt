Title: IBM The Timeline Visualizer does not show events in the Case Manager Client - United States

Text:
replay; resynch; reinitialize; blank; empty TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Timeline Visualizer does not show events in the Case Manager Client 

SYMPTOM
 

The Timeline Visualizer widget stops displaying events. For example: 

.
[/support/docview.wss?uid=swg21983350&aid=1] [/support/docview.wss?uid=swg21983350&aid=1]


CAUSE

The event sequence numbers are higher the Case History store database than the event sequence numbers in the target object store. 
.
That is an invalid state. The Case History service collects events in the Case History store from two sources in the target object store:
. 

 *  the Event table; the VWLOG tables. 

. 
The Case History service queries those tables in the target object store with sequence numbers that are higher than the corresponding most recent sequence numbers (bookmarks) in the Case History store database. 
. 
This situation can be created by incorrectly restoring database backups or database failovers, for example. In these scenarios, the target object store database data can be taken back in time if the restored data does not have all the data most recently generated by the Content Platform Engine. Consequently, event sequence numbers in the target object store can fall behind event sequence numbers in the Case History store. 
DIAGNOSING THE PROBLEM
 

You can check and compare the maximum sequence numbers in the Case History store and the target object store. 

Comparing Event table event sequence numbers 

Run this query in the target object store database: 

 * SELECT max(audit_sequence) FROM [CMTOS].[dbo].[Event] 

Run this query in the Case History store database:  * SELECT * FROM CH_X_CEEVENTSTATE 


Comparing VWLOG table event sequence numbers Run a query similar to the following in the target object store database: 

 * SELECT max(F_SeqNumber) FROM [CMTOS].[dbo].[VWVL1_TG1_CaseType1] 

Run a query similar to the following in the Case History store database:  * SELECT * FROM CH_X_PEEVENTSTATE WHERE EVENTLOG = 'VWVL1_TG1_CaseType1' 


NOTE: In the queries above, we used the view name associated with the VWLOG table for the case where the Timeline Visualizer does not display the events. You have to use the correct view name in place of VWVL1_TG1_CaseType1 on your system. 
. 
The view name consists of three parts: 
.  * [VWVLx]_[solution prefix]_[case type name] 

. 
where: 
.  *  x in [VWVLx] is the region number associated with the Case Manager target environment; [solution prefix] is the prefix of the Case Manager solution that is associated with the case that has the problem; [case type name] is the name of the Case Manager Case Type associated with the case that has the problem. 
 * 

You can see all the VWLOG view names in the EVENTLOG column of the CH_X_PEEVENTSTATE table. 
. 
In this example, the correct view name associated with the problematic case is VWVL1_TG1_CaseType1: 
. 
(click on the image to enlarge it) 
[/support/docview.wss?uid=swg21983350&aid=2] [/support/docview.wss?uid=swg21983350&aid=2] 

Sample Comparison 

The example below shows a good state where the highest sequence numbers match. 

It would also be a good state if the sequence number in the first query output below were higher than in the second query output, or the sequence number in the third query output were higher than in the fourth query output. 

The Timeline Visualizer widget will not show events if:  *   * the sequence number in the first query output below is higher than in the second query output, OR 
    * the sequence number in the third query output is higher than in the fourth query output.
   
   


(click on the image to enlarge it) 
[/support/docview.wss?uid=swg21983350&aid=3] [/support/docview.wss?uid=swg21983350&aid=3] 
RESOLVING THE PROBLEM
 

Resolution option 1 

If you do not have to preserve Case History store data, then the easiest resolution is to drop and recreate the Case History store in the Case Manager administration client. With this option, the Timeline Visualizer widget will display events for cases that are created after the Case History store is recreated. 

 You can delete the Case History store by clicking on Actions -> Delete in on the Case History Store tab. For example: 

[/support/docview.wss?uid=swg21983350&aid=4] [/support/docview.wss?uid=swg21983350&aid=4] 

. 

After deleting the Case History store and before creating it again, check if the Case History tables are still in the Case History store database. If yes, delete them. These tables have names starting with CH_. For example: 

. 

 *  [/support/docview.wss?uid=swg21983350&amp;aid=5] 

. Resolution option 2 

If you have to preserve Case History store data, then the easiest option is to restore a Case History store database backup that was generated at or earlier than the time when target object store data was taken back in time by a database restore or failover. 

Resolution option 3 

If you have to preserve Case History store data but you do not have a good Case History store database backup, then you can reinitialize the Case History store, reset its date and have the Case History service replay Case History data. This process may take several days while the Case History store catches up with current events. 

. 

Steps: 

 1. Make sure only one node is up on the Case Manager and Content Platform Engine servers. 
 2. In the Case Manager administration client, delete and recreate the Case History store as described in option 1.  * IMPORTANT: when you are creating the Case History store, make sure that the Enable case history store check box is NOT selected. 
     * (click on the image to enlarge it) 
    
    
 3. In the Case History store database, open the CH_X_SchemaInfo table for editing.  * NOTE: the CH_X_SchemaInfo table only has one column.
    
    
 4. In the INSTALLDATE column in the CH_X_SchemaInfo table, change the date back to a time from which you want to replay Case History events.  * NOTE: events for cases created after that date and time will be replayed.
    
    
 5. Restart the Content Platform Engine and Case Manager servers. 
 6. Enable the Case History store in the Case Manager administration client.  * You can do this by checking the Enable case history store check box and clicking Save on the Case History Store tab. 
     * For example: 
     * (click on the image to enlarge it) 
     * .
    
    
 7. Optional: you can monitor the progress of the Case History event replay. You can do this by periodically comparing the event sequence numbers as described in the diagnosing the problem section


 * SELECT max(audit_sequence) FROM [CMTOS].[dbo].[Event] 
   SELECT * FROM CH_X_CEEVENTSTATE 
   SELECT max(F_SeqNumber) FROM [CMTOS].[dbo].[VWVL1_TG1_CaseType1] 
   SELECT * FROM CH_X_PEEVENTSTATE WHERE EVENTLOG = 'VWVL1_TG1_CaseType1' 

.  * REMINDER: use the correct view name on your system in place of VWVL1_TG1_CaseType1. 


If the options above do not resolve the problem, then you can generate Case History event streams and analyze them or contact IBM software support for further help. Generating Case History event streams is described in tech note 1983334 [http://www.ibm.com/support/docview.wss?uid=swg21983334].