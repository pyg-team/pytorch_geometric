Title: IBM BACKUP VM error ANS4174E RC=-1 - United States

Text:
SAN HOTADD NBD VMVSTORTRANSPORT ANS4174E RC=-1 ANS5283E backup VM VMware vddk TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Virtual Machine backup fails with RC=-1 when actual selected transport is not in the VMVSTORTRANSPORT option list. 

SYMPTOM
If the VMVSTORTRANSPORT option for data mover is set to only the following advanced transport modes: SAN, HOTADD or NBDSSL, it will fail with the following errors if actual selected transport is NBD. 

In the dsmerror.log :

ANS1228E Sending of object 'vmname' failed.
ANS5283E The operation was unsuccessful.

In the dsmsched.log :

ANS4174E Full VM backup of VMware Virtual Machine 'vmname' failed with RC=-1 mode=Incremental forever - Incremental, target node name=<datacenter node>, data mover node name=<datamover node> 

 

If the VMVSTORTRANSPORT is not set, or NBDSSL and/or NBD values are also added, the backup transport mode will switch to the NBD or NBDSSL modes and complete successfully.


CAUSE
The backup process has permission or other access problems to the VMware Virtual Disk Development Kit (VDDK) temporary directory.


ENVIRONMENT
By default, and depending on the user <account> that performs the backup this directory is located : 


For the Local System Account: C:\Windows\Temp\vmware-system 
For any other user <account> :
Windows 2003: C:\Documents and Settings\<account>\AppData\Local\Temp\vmware-<account>\
Windows 2008, 2012: C:\Users\<account>\AppData\Local\Temp\vmware-<account>\
On all versions of Windows the userâ€™s TEMP environment setting overrides the vddk default Temp folder location. If the TEMP or Windows default Temp folder is not found, VDDK (and other VMware software) have a fallback to <localAppDir>\Temp.


DIAGNOSING THE PROBLEM
There can be many causes to the BACKUP VM error ANS4174E with RC=-1, this document only is about the root cause being an access issue to the VDDK temporary directory. 

That cause can be identified with a Tivoli Storage Manager client trace. 

Using VMware VDDK trivia tracing and client traceflags VM, the following message can be observed : 


<timestamp> : vmvddksdk.cpp (1224): <timestamp> [06656 error 'Default'] Cannot use advanced transport modes for <vcenter_address>/moRef=vm-xxxx/snapshot-yyyyyy: Cannot create directory C:\Windows\TEMP\vmware-SYSTEM\421f91d5-41f9-3329-6515-0d05d42750b7-vm-xxxx.


RESOLVING THE PROBLEM
To correct the problem : 


1. if needed, clean up the temporary location and delete everything under it when no TSM or VMware related process is running.
2. ensure nothing is locked in that location
3. is there sufficient free space on the drive ?
4. has the user performing the backup sufficient rights to that location to create directories and files ?
5. attempt to define another temporary location for the vddk operations by adding in the dsmvddk.opt file located in c:\program files\Tivoli\TSM\baclient :
tmpDirectory = "<TempDirectory>"
ensure the <TempDirectory> has no special or accentuated characters in the name.