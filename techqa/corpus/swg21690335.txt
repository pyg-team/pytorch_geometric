Title: IBM Startup issues for both IBM Sterling B2B Integrator and IBM Sterling File Gateway caused by Microsoft® Windows Patch KB2992611 for Microsoft® Security Bulletin MS14-066 - United States

Text:
 FLASH (ALERT)

ABSTRACT
 Applying Windows Patch KB2992611 for Microsoft® Security Bulletin MS14-066 could prevent startup of both IBM Sterling B2B Integrator and IBM Sterling File Gateway. 

CONTENT
IBM Support has received several production down calls from IBM Sterling B2B Integrator and IBM Sterling File Gateway customers running:
Microsoft® Windows OS
SQL Server database
Oracle JDK 1.6

and who have applied Microsoft® Windows Patch KB2992611 for Microsoft® Security Bulletin MS14-066 released earlier in November (https://technet.microsoft.com/library/security/ms14-066 [https://technet.microsoft.com/library/security/ms14-066]). After applying this OS patch, B2B Integrator and File Gateway are unable to start up with the following error:

[2014-11-13 17:31:50.498] ERROR 000310100002 UTIL.FRAME_JDBC.ERR_ConnectionFactory_create [ConnectionFactory].create()
[2014-11-13 17:31:50.499] ERROR [1415899910498] The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption. Error: "SQL Server returned an incomplete response. The connection has been closed.".
[2014-11-13 17:31:50.499] ERRORDTL [1415899910498]com.microsoft. sqlserver.jdbc.SQLServerException: The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption. Error: "SQL Server returned an incomplete response. The connection has been closed.".

This error appears to be caused by a compatibility issue with the ciphers in use on the server that is running SQL Server and the security providers in the Oracle JDK.

On November 18, 2014, Microsoft® released a new version of the patch for KB2992611, which will also install a new patch, KB3018238. This new patch will resolve the connectivity issue to the SQL Server database, and applying this revised version of KB2992611 and KB3018238 should be the preferred solution to the issue.

More details can be found at the following link:
https://support.microsoft.com/kb/2992611 [https://support.microsoft.com/kb/2992611]

See the section 'Known issues with this security update' for details.

The above patches should be applied to all Windows servers, but the connectivity issue will be corrected by applying the revised patch to the server that is running SQL Server.

Alternate Solution:

If the application of the above revised and new patches does not resolve the issue, or if they cannot be applied for some reason, the below procedure can be attempted. Applying this resolution should not affect the application of the Microsoft patch, and the patch should work without issue if the below procedure is done.

The following steps should be followed to resolve this issue:
1. Log into the Windows server (using an administrator account) that is running the SQL Server database that IBM Sterling B2B Integrator is connecting to.

2. Open the Group Policy Object Editor by opening a command prompt session and typing in 'gpedit.msc'

3. Expand 'Computer Configuration' > 'Administrative Templates' > 'Network', and then click 'SSL Configuration Settings'.

4. Under 'SSL Configuration Settings', click the 'SSL Cipher Suite Order' setting.

5. On the left side of the upper box, ensure that 'Enabled' is selected.

6. Under 'SSL Cipher Suites', copy the ENTIRE contents of the text box and save this in a text file on the server to back it up. Be sure to not skip this step!
Tip: click in the box, press Ctrl+A to select all, then Ctrl+C to copy it. Then open Notepad and paste (Ctrl+V) the contents. Save this file to a safe location.

7. Delete the entire contents of the text box, and then copy the following list of ciphers into the box. Be SURE to not add any line breaks or carriage returns to this list. This should all be one continuous line with no spaces or line breaks:
TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_3DES_EDE_CBC_SHA,TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384

8. Click 'Apply' and then 'Ok'.

9. Restart the Windows server to enable the change, and then restart the IBM Sterling B2B Integrator application and confirm that it can connect.

The steps for this change (minus the new list of ciphers in step 7) can be found at the following link:
http://msdn.microsoft.com/en-us/library/windows/desktop/bb870930%28v=vs.85%29.aspx [http://msdn.microsoft.com/en-us/library/windows/desktop/bb870930%28v=vs.85%29.aspx]

IBM has verified that Sterling B2B Integrator 5.2.4.2 and File Gateway 2.2.4.2 Windows OS customers using the IBM JDK will not encounter this issue.

Contact IBM Customer Support [https://www.ibm.com/support/servicerequest/Home.action]if you have any further questions on this issue.

RELATED INFORMATION
 Microsoft Security Bulletin MS14-066 [https://technet.microsoft.com/library/security/ms14-066]