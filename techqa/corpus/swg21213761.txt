Title: IBM Unexpected FTP Client Connection Failure to a Host known by Multiple IP Addresses - United States

Text:
gethostbyname getaddrinfo multiple backup zosftp TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Domain Name System (DNS) server returns more than one address defined for an FTP server's host name. Usage of the z/OS FTP client specifying that host name was expected to attempt to establish a connection to each of the listed addresses until one of them was successful. However, the client terminated after the first connection attempt failed. 

SYMPTOM
Messages similar to the following are produced: 

EZA1554I [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halm001/eza1554i.htm]Connecting to: FTP.MYCORP.COM 10.11.12.13 port: 21.
EZA2590E [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halm001/eza2590e.htm]recv error from getNextReply - EDC8130I [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.ceea900/cs00427.htm]Host cannot be reached. (errno2=0x74500442 [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.bpxa800/errnojrs.htm])
EZA1475I [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halm001/eza1475i.htm]Connection with FTP.MYCORP.COM terminated





CAUSE
The z/OS FTP client will attempt a connection to another address in the list returned from DNS when there is no response from an address within the configured MYOPENTIME [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halz001/ftpclientmyopentime.htm] period (or overridden with the TIMEOUT option on the FTP command [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halu001/entrftpenv.htm]). However, if the remote address returns a "Connection refused" response (a RESET packet), the process will terminate without any further connection attempts.


RESOLVING THE PROBLEM
 

 * Ensure that the list of IP addresses returned from the DNS server is correct for the host name supplied. 
 * Ensure that the FTP server software is functional whenever the TCP/IP stack on each of the listed hosts is up. 
 * Specify another host name that selects a desired subset of the IP addresses returned. Or specify an individual IP address instead of a host name. 
 * Repeated attempts to use the FTP client with the hostname specified will probably result in the DNS server returning the list of IP addresses in a different order. It is likely that one (or more) of the other addresses will work.


NOTE for z/OS 1.11 and above:  * 
 * 
 * resolver caching
 * 
 *  Check the cache entry using a NETSTAT RESCACHE [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halu101/rescacherpt.htm#rescacherpt] DETAIL (HOSTNAME FTP.MYCORP.COM command. A retry after the reported Expired Time will retrieve a new list. Contact the administrator of the authoritative DNS server for that domain to see if a shorter Time To Live (TTL) can be configured (if appropriate). Note that the reported expiration will be reported as GMT (UCT) unless the TZ environment variable [http://www.ibm.com/support/docview.wss?rs=852&uid=swg21140187] has been set for the user issuing the NETSTAT command. Clear the resolver cache using a MODIFY RESOLVER [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halu101/resolvecmd.htm],FLUSH command. However this will (temporarily) affect performance for all DNS queries on the system. Override the TCPIP.DATA [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halz002/resolver_cfg_files.htm] input used for this FTP session to use an input that has the NOCACHE [https://www.ibm.com/support/knowledgecenter/SSLTBW_2.2.0/com.ibm.zos.v2r2.halz001/nocachestatement.htm] statement specified. 

[/support/docview.wss?uid=swg21213761&amp;aid=1] NOTE for z/OS 2.2 and above:  * 
 * 
 * CACHEREORDER
 * 
 * SETUP file
 * 
 * IP Configuration Guide
 *