Title: IBM Logjam attack and openssl update - United States

Text:
logjam openssl cipher encryption TECHNOTE (TROUBLESHOOTING)

PROBLEM
Since the openssl update to Protector on August 11th, it would not be possible to send mail over TLS to mail servers which have a weak key cipher strength of less than 768bits.

This improvement to openssl is to circumvent the Logjam man-in-the-middle attack

SYMPTOM
SSL3_CHECK_CERT_AND_ALGORITHM:dh key too small

"417 Temporary delivery error" 

ErrCode = -234


CAUSE
openssl has been updated to fix serveral security issues.

In particular 
CVE-2015-4000: The Logjam Attack (weakdh.org) has been addressed by rejecting connections with DH parameters shorter than 1024 bits. 2048-bit DH parameters are now generated by default.

DIAGNOSING THE PROBLEM
"417 Temporary delivery error" for mails to hosts with this keysize.

When using openssl directly from a SSH session on Protector you can see an error is generated against such a mail server, substitute the example server below with the one in question.

openssl s_client -connect examplemailserver.org:25 -starttls smtp

If the key strength is too small you will see the following error response from openssl
SSL3_CHECK_CERT_AND_ALGORITHM:dh key too small

RESOLVING THE PROBLEM
1. Disable the elliptic curve support in Protector (this will provide more compatibility at the expense of less security )

Remove the following entries from the server.tab at ISSSSLOptions line
0x00080000L and 0x00100000L

The line should look like this:
"ISSSSLOptions" "0x01000000L,0x02000000L"


2. Convince the mailserver admin to set recommended secure dhparams settings ( 1024 bit and higher )