Title: IBM WebSphere MQ monitoring Agent cannot startup in Linux RedHat 6.x x86_64 with WebSphere MQ 7.1 or later installed - United States

Text:
5724k3500TR TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This technote describes a possible issue for MQ agent when starting up on Linux x86_64 with WebSphere MQ 7.1 or later environment and solution. 

SYMPTOM
You may see single or multiple error messages of following when you try to start agent. 

1. "itmcmd agent -o <qmgr> start mq" command returns error message:

KCIIN0198E - unable to start agent 

2. Log entry in MQ agent log files:

error while loading shared libraries : libmqm_r.so: cannot open shared
object file : no such file or directory

3. Log entries indicating error related to libstdc++.


CAUSE
Configuration issue. Some dependent files are missing or cannot be loaded successfully.

1. 32 bit libstdc++ is not installed because It is common for Linux RedHat 6.x on 64 bit systems to have only the 64 bit bundles installed for the default OS installation. 

2. MQ agent which is 32 bit program requires several WebSphere MQ library files (libmqm*) in 32 bit. In WebSphere MQ releases prior to V7.1, symbolic links are created under /user/lib during installation so MQ agent can locate the required libraries. However, since WebSphere MQ 7.1, MQ installation does not create the library symbolic links by default any longer, this results in that MQ agent cannot start up without additional manual configuration.


ENVIRONMENT
Linux x86_64



DIAGNOSING THE PROBLEM
1. Check if 32 bit libstdc++ has been installed. 

rpm -q --qf "%{NAME}-%{ARCH}-%{VERSION}\n" --whatprovides /*/lib*/libstdc++.so.6 

Following example shows that the 32 bit package is installed.
[root@tivfpvm130 ~]# rpm -q --qf "%{NAME}-%{ARCH}-%{VERSION}\n" --whatprovides /*/lib*/libstdc++.so.6
libstdc++-x86_64-4.4.7
libstdc++-i686-4.4.7

Note that i386, i586 or i686 are all 32 bit identifiers. so you may see different name to the example in your system and they are fine.

2. Change current directory to ITM directory and issue command to check which files cannot be found. The following example shows that libmqm_r.so is 'not found'. Sometimes, there are multiple files. 

[/support/docview.wss?uid=swg21655472&aid=1] [/support/docview.wss?uid=swg21655472&aid=1] 





RESOLVING THE PROBLEM
1. Ensure that 32 bit libstdc++ is installed. Contact your OS administrator where to download and install for your Linux distribution. 

2. Locate the files in 'not found' in your system. Issue command: 

"find / -name libmqm_r.so" 
[/support/docview.wss?uid=swg21655472&amp;aid=2]

In the example, /opt/MQ7501/lib is the directory where the libmqm_r.so resides. lib64 is for 64 bit application so it is not what you want for MQ agent.


3. Update LD_LIBRARY_PATH in $CANDLEHOME$/config/mq.ini to add the correct WebSphere MQ library path at the beginning. 

Before change:
LD_LIBRARY_PATH=$ICCRTE_DIR$/$GSKLIB$:$CANDLEHOME$/$BINARCH$/$PRODUCTCODE$/lib:$CANDLEHOME$/$ARCHITECTURE$/lib

After change:
LD_LIBRARY_PATH=/opt/MQ7501/lib:$ICCRTE_DIR$/$GSKLIB$:$CANDLEHOME$/$BINARCH$/$PRODUCTCODE$/lib:$CANDLEHOME$/$ARCHITECTURE$/lib

Refer to technote # 1633727 [http://www-01.ibm.com/support/docview.wss?uid=swg21633727] [http://www-01.ibm.com/support/docview.wss?uid=swg21633727] further for other scenarios why WebSphere MQ library cannot be loaded.

4. Restart agent. [http://www-01.ibm.com/support/docview.wss?uid=swg21633727]