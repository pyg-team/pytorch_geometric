Title: IBM SQL30020N calling stored procedure on IBM i from DB2 client (DRDA) - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 SQL30020N calling stored procedure on IBM i from DB2 client (DRDA) 

RESOLVING THE PROBLEM
This is potentially related to R610 SE48046 / R710 SE54955. If a DB2 client calls a stored procedure over DRDA connection the client can potentially report a SQL30020N. The ENDUOWRM (ENDUOWRM - End Unit of Work Condition) with UOWDSP (UOWDSP - Unit of Work Disposition) response from the IBM i is not what the client expects. The valid values that can be returned are x'01' - Commit or x'02' Rollback. If the stored procedure being called is defined with Commit Hold or Rollback Hold the IBM i may potentially send back a wrong value, x'98' Commit Hold or x'99' Rollback Hold. This causes the client to give the error SQL30020N. 

The ptfs provided enable the use of data area QSQHLDOVR. When this data area is created with

CRTDTAARA DTAARA(QSYS/QSQHLDOVR) TYPE(*CHAR)

this will cause the IBM i to override the response on the ENDUOWRM UOWDSP to correctly report
x'01' Commit instead of x'98' Commit Hold and x'02' Rollback instead of x'99' Rollback Hold.

Note: There are other reasons why an SQL30020N can be reported so it is important to know the specifics about the failure.

 


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.2 Operating System IBM i 7.1 Operating System IBM i 6.1