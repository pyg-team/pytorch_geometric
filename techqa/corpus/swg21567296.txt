Title: IBM ADMA0158I: [EJBDeploy] error: Could not load class com.ibm.ejs.container.EJSWrapperBase - United States

Text:
RAD; RSA; WAS; websphere; ejbdeploy; Prepare for deploy; ejb; rmic; classload; RMICException; nosuchmethod; EJSWrapperBase; JDK; classloading TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 EJBdeploy of an EAR on WebSphere Application Server 7.0.0.17 on HP-UX 11i v3 (64bit) results in rmic error: 
ADMA0158I: [EJBDeploy] error: Could not load class com.ibm.ejs.container.EJSWrapperBase
The same EAR can be deployed on WebSphere Application Server 7.0.0.17 on AIX, Linux and Solaris. why does EJBDeploy fail on HP-UX? 

SYMPTOM
WebSphere Application Server 7.0.0.17 on HP-UX 11i v3 (64bit) fails upon adding application EAR using the admin console. 

SystemOut.log shows an rmic failure on EJBDeploy: 

 

************ Start Display Current Environment ************ 
WebSphere Platform 7.0.0.17 [ND 7.0.0.17 cf171115.15] running with process name {hostname}Cell01\{hostname}CellManager01\dmgr and process id 19800
Host Operating System is HP-UX, version B.11.31 Java version = 1.6.0.01, Java Compiler = null, 
Java VM name = Java HotSpot(TM) 64-Bit Server VM
was.install.root = /opt/IBM/WebSphere/AppServer 
user.install.root = /opt/IBM/WebSphere/AppServer/profiles/Dmgr01
...
Java Library path = /opt/IBM/WebSphere/AppServer/java/jre/lib/IA64W: 
..
.
************* End Display Current Environment *************
...
.. 

[9/30/11 14:20:46:597 EDT] 00000037 DeployEJBTask I ADMA0158I: [EJBDeploy] SEVERE: Error generating RMI code: RMIC command failed on project: BusinessServicesWSEJB with message:
[9/30/11 14:20:46:646 EDT] 00000037 DeployEJBTask I ADMA0158I: [EJBDeploy] error: Could not load class com.ibm.ejs.container.EJSWrapperBase. 

-------- 

 

Similarly, when using the ejbdeploy.sh from<WAS_HOME>/deploytool/itp, you get similar EJBDeploy errors in the ejbdeploy.log with the -trace and -log options. 

 

The last error shows: 

ADMA0158I: [EJBDeploy] error: Could not load class com.ibm.ejs.container.EJSWrapperBase.



CAUSE
WebSphere Application Server 7.0.0.17 on HP-UX 11i v3 (64bit) has an old JDK/JSE 1.6. 

 

Note: The com.ibm.ejs.container.EJSWrapperBase should be part of the WebSphere Application Server 7.0.0.17 HP installation in{WAS_HOME}/plugins/com.ibm.ws.runtime.jar , and the jar should show on the : rmic - classpath .... invocation. 

If so, this is typically an rmic bug in the WebSphere Application Server JDK.


DIAGNOSING THE PROBLEM
Verify the JDK version on the WebSphere Application Server 7.0.0.17 on HP-UX 11i v3 (64bit / IA64W) as follows:

> cd {WAS_HOME}\java\bin
> java -fullversion


java full version "1.6.0.01-jinteg_07_jun_2008_07_15-b00" 

 

ADDITIONAL DETAILS: 

The JDK Updates are typically separate from the WebSphere Application Server update fix packs and may be missed. 

For example: 

7.0.0.17: WebSphere Application Server V7.0 Fix Pack 17 [http://www.ibm.com/support/docview.wss?uid=swg24029634], has a link to the following JDK update:


 * 7.0.0.17: Java SDK 1.6 SR9 FP1 Cumulative Fix for WebSphere Application Server [http://www.ibm.com/support/docview.wss?uid=swg24029894]

[http://www.ibm.com/support/docview.wss?uid=swg24029894] 
The build level table in the above JDK fix shows the following java version for HP-UX IA64: 

1.6.0.10-jinteg_11_mar_2011_09_19-b00 28_Mar_2011_14_00 hpux IA64W (SR9 FP1) 

In this problem scenario, updating to that JDK version for HP-UX IA64, resolves the issue. 

Had the issue not been resolved, the next step would be to try and update to the latest JDK update for WebSphere Application Server 7.0.0.x and re-test. 

For example, at the time of this scenario the latest JDK update (available as of WebSphere Application Server 7.0.0.19) was: 
 * 7.0.0.19: Java SDK 1.6 SR9 FP2 Cumulative Fix for WebSphere Application Server [http://www.ibm.com/support/docview.wss?uid=swg24030661]
   


COLLECTING TRACE: 

If applying the latest JDK does not help, provide IBM Support for Rational Application Developer the following output from a run of ejbdeploy.{sh|bat} with -trace -keep and -log options. 

This information will help with problem recreate and engaging WebSphere Application Server JDK support to investigate a possible rmic defect. 

 

Note: If using Rational Application Developer v7.5/8.x to do Prepare for Deploy on an EJB 1.x/2.x project ( == EJB Deploy), it may also be necessary to specify this workspace preference to avoid rmic classloading issues: 

Window > Preferences > {J2EE | Java EE} > WebSphere Application Server:
EJB Deployment ( 1.x - 2.x)
[x] Always run rmic in a separate process

This insures the rmic in the JDK of the specified WebSphere Application Server runtime target is used and in a separate process. For background on this preference consult this technote:

EJBDeployer failed with RMIC command failed during Prepare for deployment on Rational Application Developer 7.0 with WebSphere Application Server 6.1.0.21 [http://www.ibm.com/support/docview.wss?uid=swg21392149]


RESOLVING THE PROBLEM
 

WORKAROUND: 

 1. If available, install a fully built EAR that works on another operating system platform (for example SUN 64) or from Rational Application Developer v7.5/v8.0 (with Prepare for Deploy/ejbdeploy already done) 
 2. Install the EAR on the HP WebSphere Application Server v7 using the admin console, with ejb deploy unchecked to avoid doing an ejbdeploy code regeneration.