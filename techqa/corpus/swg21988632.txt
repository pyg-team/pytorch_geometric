Title: IBM SOAP Dynamic Services report "ae.invokeservice:Java heap space" in status report and error out in "Interrupted_man" status - United States

Text:
ae.invokeservice:Java heap space; soap; dynamic service TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 SOAP Dynamic Services report "ae.invokeservice:Java heap space" in status report and error out with "Interrupted_man" status 

SYMPTOM
noapp.log captured OutOfMemory event.

JVMDUMP010I System dump written to /opt/apps/GIS_INSTALL/noapp/bin/core.20160622.105023.19985.0001.dmp
JVMDUMP032I JVM requested Heap dump using '/opt/apps/GIS_INSTALL/noapp/bin/heapdump.20160622.105023.19985.0002.phd' in response to an event
JVMDUMP010I Heap dump written to /opt/apps/GIS_INSTALL/noapp/bin/heapdump.20160622.105023.19985.0002.phd
JVMDUMP032I JVM requested Java dump using '/opt/apps/GIS_INSTALL/noapp/bin/javacore.20160622.105023.19985.0003.txt' in response to an event

Thread Dump (javacore file) showed following stack trace. But it may vary from between tests.

3XMTHREADINFO "HAR.992027.Thread" J9VMThread:0x000000007B03AD00, j9thread_t:0x00007F094D7844B0, java/lang/Thread:0x000000000E40BFF0, state:R, prio=5
3XMJAVALTHREAD (java/lang/Thread getId:0x930, isDaemon:false)
3XMTHREADINFO1 (native thread ID:0x40F1, native priority:0x5, native policy:UNKNOWN, vmstate:R, vm thread flags:0x00000020)
3XMTHREADINFO2 (native stack address range from:0x00007F093324A000, to:0x00007F093328B000, size:0x41000)
3XMCPUTIME CPU usage total: 32.458255027 secs
3XMHEAPALLOC Heap bytes allocated since last GC cycle=0 (0x0)
3XMTHREADINFO3 Java callstack:
4XESTACKTRACE at java/lang/StringBuffer.ensureCapacityImpl(StringBuffer.java:338(Compiled Code))
4XESTACKTRACE at java/lang/StringBuffer.append(StringBuffer.java:204(Compiled Code))
5XESTACKTRACE (entered lock: java/lang/StringBuffer@0x000000000EBB67B8, entry count: 1)
4XESTACKTRACE at org/apache/xerces/dom/DeferredDocumentImpl.getNodeValueString(Bytecode PC:212(Compiled Code))
4XESTACKTRACE at org/apache/xerces/dom/DeferredDocumentImpl.getNodeValueString(Bytecode PC:3(Compiled Code))
4XESTACKTRACE at org/apache/xerces/dom/DeferredTextImpl.synchronizeData(Bytecode PC:19(Compiled Code))
4XESTACKTRACE at org/apache/xerces/dom/CharacterDataImpl.getNodeValue(Bytecode PC:8(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/BaseMarkupSerializer.serializeNode(Bytecode PC:71(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/XMLSerializer.serializeElement(Bytecode PC:1742(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/BaseMarkupSerializer.serializeNode(Bytecode PC:749(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/XMLSerializer.serializeElement(Bytecode PC:1742(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/BaseMarkupSerializer.serializeNode(Bytecode PC:749(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/BaseMarkupSerializer.serializeNode(Bytecode PC:1022(Compiled Code))
4XESTACKTRACE at org/apache/xml/serialize/BaseMarkupSerializer.serialize(Bytecode PC:11)
4XESTACKTRACE at com/sterlingcommerce/woodstock/services/soa/dynamicservice/helper/SOAPRequestProcessor.generateDocumentSOAPMessage(SOAPRequestProcessor.java:1095)
4XESTACKTRACE at com/sterlingcommerce/woodstock/services/soa/dynamicservice/helper/SOAPRequestProcessor.processRequest(SOAPRequestProcessor.java:299)
4XESTACKTRACE at com/sterlingcommerce/woodstock/services/soa/dynamicservice/WSDLConsumerService.processData(WSDLConsumerService.java:88)
4XESTACKTRACE at com/sterlingcommerce/woodstock/workflow/activity/engine/ActivityEngineHelper.invokeService(ActivityEngineHelper.java:1818)



CAUSE
java/lang/OutOfMemoryError due to low Java Heap allocation

ENVIRONMENT
This particular incident is reported in 5250_x fixpack installed on Solaris OS, but theoretically it could happen in any fixpack version on any OS as long as heap allocation is low.

DIAGNOSING THE PROBLEM
Look for OutOfMemory event in noapp.log

RESOLVING THE PROBLEM
Allot extra RAM to the application by increasing Java Heap Settings through Operations->System->Performance->Tuning Wizard.





Increase Physical Memory accordingly. And other memory settings as indicated below.
Initial Heap = 0.4 * Physical Memory 
Max Heap = 0.8 * Physical Memory 
Initial Nursery Heap = 0.33 * Initial Heap 
Max Nursery Heap = 0.33 * Max Heap

Please note that the application needs to be restarted and setupfiles script run for the changes to take effect.