Title: IBM PK57930: STORED PROCEDURES ACCESSED REMOTELY RETURN ONLY ONE ROW PER     BLOCK WHEN OPTIMIZE FOR 1 ROW IS CODED - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  DB2DDF DDFL09 DB2SP
   defects 03236_499_000 d03236_499_000 pk57930 dpk57930
   If OPTIMIZE FOR 1 ROW is coded to influence access path
   selection for a stored procedure, only 1 row per block is
   returned to the requester. This can have a neagtive performance
   impact because more I/O is required to return the complete
   results set.
   *************************************************
   Additional symptoms and keywords:
     Optimize for n rows perf performance
     Stored Procedure SP Result Set Sets RS
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All Distributed Data Facility (DDF) users.   *
   *                 Specifically those that call remote stored   *
   *                 procedures.                                  *
   ****************************************************************
   * PROBLEM DESCRIPTION: When a remote stored procedure result   *
   *                      set cursor is declared with the         *
   *                      "OPTIMIZE FOR n ROWS" clause and the    *
   *                      value of n < 4, the application         *
   *                      encounters worse than expected          *
   *                      performance when fetching from the      *
   *                      cursor.                                 *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   The "OPTIMIZE FOR n ROWS" clause is used to control both access
   path selection and DRDA blocking. When a small n (0 < n < 4)
   is used to influence the choice of access path, the effect on
   DRDA blocking may be undesirable. When only a small number of
   rows are fetched per block, the application must perform more
   remote DRDA operations to retrieve answer set data from the
   server, resulting in decreased performance. To mitigate this,
   DB2 by design uses a blocking factor of 16 instead of n when
   n is 1, 2 or 3. For the case of stored procedure result sets,
   DB2 was incorrectly using the value of n instead of 16,
   resulting in behavior that did not conform to DB2's documented
   behavior.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The DB2 server has been corrected to conform to the
   documented behavior and will return 16 rows per DRDA block
   when n is 1, 2, or 3 for a stored procedure result set which
   has specified the "OPTIMIZE FOR n ROWS" clause.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK57930
   
   
 * REPORTED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * REPORTED COMPONENT ID
   5740XYR00
   
   
 * REPORTED RELEASE
   810
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-12-10
   
   
 * CLOSED DATE
   2008-01-11
   
   
 * LAST MODIFIED DATE
   2008-02-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK32903 UK32904
   
   

MODULES/MACROS
 *  DSNLXGVR
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * FIXED COMPONENT ID
   5740XYR00
   
   

APPLICABLE COMPONENT LEVELS
 * R810 PSY UK32903 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK32903]
   UP08/01/28 P F801
   
   
 * R910 PSY UK32904 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK32904]
   UP08/01/28 P F801
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.