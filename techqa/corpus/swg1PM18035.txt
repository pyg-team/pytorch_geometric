Title: IBM PM18035: ABEND04E, RC00D31010 FROM DSNLCMSL:0008 FOR A STORED PROCEDURE  RETURNING LOB DATA - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  An ABEND04E-00D31010 from DSNLCMSL:0008 can happen when a stored
   procedure is called from a remote requester and LOB data is
   being returned. The abend is issued when DSNLCMSL checks the
   length of the returned data against the expected value.
   00D31010 0008
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All DB2 for z/OS V8 users of LOBs for the    *
   *                 Stored Procedure INOUT parameter.            *
   ****************************************************************
   * PROBLEM DESCRIPTION: An ABEND04E rc00D31010 can occur at     *
   *                      location DSNLCMSL:0008 for a Stored     *
   *                      Procedure when returning a LOB as       *
   *                      output data.                            *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   An ABEND04E rc00D31010 can occur at DSNLCMSL 0008 for a Stored
   Procedure when returning LOB data as the output via the INOUT
   parameter.
   
   The following example illustrates the problem.
   
   1. Create a Stored Procedure having a LOB datatype
      for an output parameter.
   
      CREATE PROCEDURE SPF (OUT_PARM CLOB(10) INOUT)
       LANGUAGE PLI
       EXTERNAL
       WLM ENVIRONMENT WLMENV2
       PROGRAM TYPE MAIN
       COLLID TEST
       PARAMETER CCSID UNICODE;
   
      Note:
        Inside the SPF Stored Procedure, OUT_PARM is set to a
        CLOB with length of 3.
   
   
   2. In a Java calling application which invokes the SPF Stored
      Procedure, setup the LOB output parameter.
   
      ......
      String shortString = "tesclob";
      java.io.Reader readerLrg =
                        new java.io.StringReader (shortString);
   
      ......
      cstmt = con.prepareCall("{CALL SPF(?)}");
   
      // pass character stream as input
      cstmt.setCharacterStream(1, readerLrg, shortString.length());
   
      // register output parameter as CLOB
      cstmt.registerOutParameter(1, java.sql.Types.CLOB);
   
      // execute the call statement
      cstmt.execute();
   
   
   3. Execute the calling application to invoke the stored
      procedure.
   
   
   The setCharacterStream method returns DBCLOB data via the INOUT
   parameter of the SPF stored procedure and it also sets the
   return data type (DBCLOB) the application expects.  Since SPF
   returns a CLOB data type by definition, and because the DB2
   server does not convert from CLOB to DBCLOB on the way out, the
   execute statement could cause DB2 to issue an ABEND04E with
   rc00D31010 at DSNLCMSL:0008.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The code in DB2 has been modified to perform the additional
   needed steps to do the conversion for the Stored Procedure if
   being executed on the server.  This will prevent the abend from
   occurring.
   
   Additional keywords: SQLSP SQLLOB SQLSTOREDPROC
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM18035
   
   
 * REPORTED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * REPORTED COMPONENT ID
   5740XYR00
   
   
 * REPORTED RELEASE
   810
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-07-07
   
   
 * CLOSED DATE
   2010-08-25
   
   
 * LAST MODIFIED DATE
   2010-10-01
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK59983
   
   

MODULES/MACROS
 *  DSNDOIFB DSNOLMAT DSNOMATL DSNXROU  DSNXROUA
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * FIXED COMPONENT ID
   5740XYR00
   
   

APPLICABLE COMPONENT LEVELS
 * R810 PSY UK59983 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK59983]
   UP10/09/09 P F009
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.