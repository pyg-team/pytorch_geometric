Title: IBM DataStage Hierarchichal stage rest API SSL handhake failure, TLSv1.2 - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Simple rest api call is failing the SSL hansdhake, 

SYMPTOM
Failure seen in job log when -Djavax.net.debug=SSL has been specified in the stage optional java options, to produce extra handsake logging details. 

Extension ec_point_formats, formats: [uncompressed]
Extension signature_algorithms, signature_algorithms: SHA512withECDSA, SHA512withRSA, SHA384withECDSA, SHA384withRSA, SHA256withECDSA, SHA256withRSA, SHA224withECDSA, SHA224withRSA, SHA1withECDSA, SHA1withRSA, SHA256withDSA, SHA1withDSA
***
pool-1-thread-1, WRITE: TLSv1.2 Handshake, length = 153
pool-1-thread-1, READ: TLSv1.2 Alert, length = 2
pool-1-thread-1, RECV TLSv1 ALERT: fatal, handshake_failure
pool-1-thread-1, called closeSocket()
pool-1-thread-1, handling exception: javax.net.ssl.SSLHandshakeException: Received fatal alert: handshake_failure
pool-1-thread-1, called close()
pool-1-thread-1, called closeInternal(true)

If the SNI extension option is being used the following would be seen 

Extension ec_point_formats, formats: [uncompressed]
Extension signature_algorithms, signature_algorithms: SHA512withECDSA, SHA512withRSA, SHA384withECDSA, SHA384withRSA, SHA256withECDSA, SHA256withRSA, SHA224withECDSA, SHA224withRSA, SHA1withECDSA, SHA1withRSA, SHA256withDSA, SHA1withDSA
Extension server_name, server_name: [host_name: myserver.com.au]
*** 


CAUSE
The target server requires SNI (Server Name Indication), this is not not being presented as an extension in the Client Hello.


DIAGNOSING THE PROBLEM
To test if the server you are connecting to requires SNI, use the openssl client if the connection works with the -servername option but not without it, then it is required such a test would look like 


openssl s_client -connect myserver.com.au:443 -servername myserver.com.au 


RESOLVING THE PROBLEM
If you have a proxy server available configuring the stage to use this to access the server, this may well resolve the issue. Alternatively ask Information Server support if they can provide updated http client libraries that send the SNI extension as expected.