Title: IBM Using distinguished names in search filters - United States

Text:
DNs; DN; search filter; escaping rules; hex escape; bwm8 TECHNOTE (FAQ)

QUESTION
 This technote discusses why using full DNs as search filters usually fail. 

ANSWER
While LDAP DNs may look very similar to search filters, there are many cases in which they are different, and cannot be used, without modification, as a search filter. It's not uncommon when programming in ldap environment to return a full DN in one operation, then plug that DN as a search filter to get more information. However, most attempts to use DNs without modification will result in some form of the following:
bad search filter

or will quietly and unexpectedly return no output.

Here's why DNs generally don't work as a search filter:

1) DNs are not an attribute. Only attributes are supported in search filters.

2) Full DNs are not in the right format. For example, the following DN from our sample.ldif file:

cn=Mary Burnnet, ou=Widget Division, ou=Austin, o=IBM, c=US

is in the wrong format. Using this as a search filter doesn't return an error, however, it also searches differently than expected. It actually returns the results of search for a cn value of "Mary Burnnet, ou=Widget Division, ou=Austin, o=IBM, c=US". So, generally, using a full DN as a search filter will not return an error, but will also return no results.

RDNs do work, however, as a search filter in ITDS. In this example, that would be:

(cn=Mary Burnnet)

3) The escaping rules for search filters are different than they are for DNs. Special characters in DNs can be escaped with the following three methods:

* If a character to be escaped is one of special characters, precede it by a backslash ('\' ASCII 92). This example shows a method of escaping a comma in an organization name:

CN=L. Eagle,O=Sue\, Grabbit and Runn,C=GB

This is the preferred method.
* Otherwise replace the character to be escaped by a backslash and two hex digits, which form a single byte in the code of the character. The code of the character must be in UTF-8 code set.

CN=L. Eagle,O=Sue\2C Grabbit and Runn,C=GB

* Surround the entire attribute value by "" (quotation marks) (ASCII 34) that are not part of the value. Between the quotation character pair, all characters are taken as is, except for the \ (backslash). The \ (backslash) can be used to escape a backslash (ASCII 92) or quotation marks (ASCII 34), any of the special characters previously mentioned, or hex pairs as in method 2. For example, to escape the quotation marks in cn=xyz"qrs"abc, it becomes cn=xyz\"qrs\"abc or to escape a \:

"you need to escape a single backslash this way \\" 

Another example, "\Zoo" is illegal, because 'Z' cannot be escaped in this context.

Search filters do not allow the presence of "\" characters. Instead, the hex escape sequence must be used for any special characters. For example, to include a "," in a search filter, it must be passed in as "\2C".

 

PRODUCT ALIAS/SYNONYM
 ITDS
TDS
Secureway
IDS
LDAP
Secureway Directory Server
Directory Server