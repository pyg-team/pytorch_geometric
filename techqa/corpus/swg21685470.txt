Title: IBM Optim Performance Manager encounters error "Invalid operation: Connection is closed." after DB2 migration to V10.5 FP4 - United States

Text:
OPM DB2 V10.5 FP4 unable check current DB2 version 4470 08003 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Optim Performance Manager stops working after DB2 migration to V10.5 FP4 or later, showing the following errors in db2pesrv.log file:
[2014-09-11 09:08:55.919]java.lang.Exception: Unable to check current DB2 version, caused by: com.ibm.db2.jcc.am.
SqlNonTransientConnectionException: [jcc][10335][10366][3.66.46]
Invalid operation: Connection is closed. ERRORCODE=-4470, SQLSTATE=08003
at com.ibm.db2pm.server.master.PEMaster$PDB.checkDB2Version(Unknown Source)
at com.ibm.db2pm.server.master.PEMaster$PDB.setup(Unknown Source)
at com.ibm.db2pm.server.master.PEMaster.iterate(Unknown Source)
at com.ibm.db2pm.server.master.PEThread.run2(Unknown Source)
at com.ibm.db2pm.server.master.PEThread.run(Unknown Source)
at com.ibm.db2pm.server.master.PEMaster.start(Unknown Source)
at com.ibm.db2pm.server.master.PEMaster.main(Unknown Source) 

CAUSE
The JCC driver, bundled together with OPM V5.3.0 and older, can not communicate with the newer DB2 Server V10.5 FP4.

RESOLVING THE PROBLEM
Replace the old JCC drivers from DB2 V10.5 FP4 (or later) folder into OPM folders.


- Stop OPM
- Backup or rename the existing OPM db2jcc.jar files, from the following locations:
. Windows:
OPM Web Console Server:
<opminstall>\dscomponents\CommonWeb\com.ibm.datatools.shared.db.drivers_2.2.0.v20130819_0646\db2jcc.jar
OPM Repository Server:
<opminstall>\RepositoryServer\bin\db2jcc.jar
. UNIX:
OPM Web Console Server:
<opminstall>/dscomponents/CommonWeb/com.ibm.datatools.shared.db.drivers_2.2.0.v20130819_0646/db2jcc.jar
OPM Repository Server:
<opminstall>/RepositoryServer/bin/db2jcc.jar

- Copy the JCC driver located in <DB2_SQLLIB>/java folder and place it the locations described above.

For example:
. Windows:
OPM Web Console Server:
copy <DB2_SQLLIB>\java\db2jcc.jar <opminstall>\dscomponents\CommonWeb\com.ibm.datatools.shared.db.drivers_2.2.0.v20130819_0646
OPM Repository Server:
copy <DB2_SQLLIB>\java\db2jcc.jar <opminstall>\RepositoryServer\bin
. UNIX:
OPM Web Console Server:
cp <DB2_SQLLIB>/java/db2jcc.jar 
<opminstall>/dscomponents/CommonWeb/com.ibm.datatools.shared.db.drivers_2.2.0.v20130819_0646
OPM Repository Server:
cp <DB2_SQLLIB>/java/db2jcc.jar <opminstall>/RepositoryServer/bin

- Restart OPM

In OPM V5.3.1 and OPM V5.3.0 7384 driver (or later), JCC drivers already have been updated to the newer version.