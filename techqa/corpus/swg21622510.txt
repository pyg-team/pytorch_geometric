Title: IBM ILMT/TAD4D 7.5 data consistency problems, error 'CODDB2002E' while signing reports - United States

Text:
CODDB2002E; CODBL0004W; database object; result set TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 ILMT/TAD4D 7.5 users can be affected by TLMA database consistency issues. Due to invalid records in TLMA database some ILMT/TAD4D tasks or internal processes will fail. 

SYMPTOM
Even despite Fix Pack 1 installation (the solution suggested in result of the APAR IV23154) the following error message can be displayed while working with reports at ILMT/TAD4D 7.5.0.10 (7.5 FP1) level: 

---
CODDB2002E An error has occurred with a database object. 
Explanation: A required database object could not be found. 
---

The following exception can be found in '<path_to_IBM>\IBM\tivoli\common\COD\logs\admin\trace\trace*.log' log files of ILMT/TAD4D server:

---
<Exception><![CDATA[java.sql.SQLException: ResultSet has no more 
elements 
at 
com.ibm.license.mgmt.util.integration.dao.db2.DB2Utility.forceNextResultSet(DB2Utility.java:158)
(...)
---

NOTE:
As data consistency issues may block internal and periodic ILMT/TAD4D processes, this issue may also be accompanied by the 'CODBL0004W' warning message appearing in the 'View Reports' panel and indicating that essential periodic calculations are failing.
Please note this is a general warning message, one of the most common in ILMT/TAD4D. You always need to review ILMT/TAD4D server logs (path specified above) in order to verify the underlying root cause, e.g.:

---
<LogText>
<![CDATA[[LOG]: Error CODDB2001E occurred when executing periodic task: 
com.ibm.license.mgmt.admin.periodictasks.scheduler.tasks.RecalculationTask]]>
</LogText>
---


CAUSE
This issue is currently being investigated by LMT/TAD4D development unit. A workaround is available as of now. Please find the corrective procedure below.


RESOLVING THE PROBLEM
1. 

Stop ILMT server. 

2. 
Backup the current state of your TLMA database (MANDATORY!). 

3. 
Download the 'clear_aggregation_generic.sql' script attached to this technote and run it as DB2ADMIN / instance owner. That script operates on ILMT/TAD4D TLMA database only.
Command to be used: 

# db2 -vf clear_aggregation_generic.sql -td% > clear-aggregation-generic-log.txt 

*In case of DB2 9.1 use the 'clear_aggregation_generic_DB2-9.1.sql' script and run:

# db2 -vf clear_aggregation_generic_DB2-9.1.sql -td% > clear-aggregation-generic-log.txt

4. 
Check the 'clear-aggregation-generic-log.txt' file. You should be able to find SQL queries listed and confirmed by 'DB20000I The SQL command completed successfully.' entries. There will be also entries like: 

--- 
SQL0100W No row was found for FETCH, UPDATE or DELETE; or the result of a query is an empty table. SQLSTATE=02000
--- 

which are valid too. Keep the log file for future reference purposes.

5. 
When the 'clear_aggregation_generic.sql' script execution has finished, start ILMT server. 

6. 
You will notice the 'CODBL0004W' message indicating that essential periodic calculations are missing. This is expected. Server will be re-aggregating data since the last signed report. It may take some time 
- about 1 hour per each month. Please observe the date specified. It will be progressing towards the current date.

7. 
When the data aggregation is completed (no 'CODBL0004W' message) you may review and try to sign the first ready report.

clear_aggregation_generic.sql [/support/docview.wss?uid=swg21622510&aid=2]clear_aggregation_generic.sql [/support/docview.wss?uid=swg21622510&aid=1]clear_aggregation_generic_DB2-9.1.sql [/support/docview.wss?uid=swg21622510&aid=4]clear_aggregation_generic_DB2-9.1.sql [/support/docview.wss?uid=swg21622510&aid=3]