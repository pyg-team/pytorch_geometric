Title: IBM IZ15447: FAILOVER IS TRIGGERED UPON REDISCOVERY DUE TO FAILURE OF THE VIRTUAL DOMAIN PROCESS TO GENERATE HEALTH CHECK EVENTS. - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The virtual domain process performs health checks at a
   configured interval (60 seconds, by default). After establishing
   the health status of the local domain, the internal
   state.domains table is updated to reflect the current state. The
   state.domains table is 'active' - upon update, further
   functionality is triggered. Part of that functionality involves
   sending remote OQL commands to the monitor and gateway
   processes, to set the current failover state. This is done
   irrespective of whether or not the state has changed, to ensure
   that each process is up-to-date.
   
   The problem occurs as the virtual domain waits for confirmation
   that this update was successful. Following rediscovery, the
   topology updates that are broadcast from model are picked up by
   the gateway and monitor processes, which lock their local stores
   to perform the entire batch of updates. As a result, the
   failover update from the virtual domain is queued up, and can
   take a number of minutes to be processed.
   
   
    
   
   

LOCAL FIX
 *  n/a
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: ALL                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION: The virtual domain process performs     *
   *                      health checks at a configured interval  *
   *                      (60 seconds, by default). After         *
   *                      establishing the health status of the   *
   *                      local domain, the internal              *
   *                      state.domains table is updated to       *
   *                      reflect the current state. The          *
   *                      state.domains table is 'active' - upon  *
   *                      update, further functionality is        *
   *                      triggered. Part of that functionality   *
   *                      involves sending remote OQL commands to *
   *                      the monitor and gateway processes, to   *
   *                      set the current failover state. This is *
   *                      done irrespective of whether or not the *
   *                      state has changed, to ensure that each  *
   *                      process is up-to-date.                  *
   *                                                              *
   *                      The problem occurs as the virtual       *
   *                      domain waits for confirmation that this *
   *                      update was successful. Following        *
   *                      rediscovery, the topology updates that  *
   *                      are broadcast from model are picked up  *
   *                      by the gateway and monitor processes,   *
   *                      which lock their local stores to        *
   *                      perform the entire batch of updates. As *
   *                      a result, the failover update from the  *
   *                      virtual domain is queued up, and can    *
   *                      take a number of minutes to be          *
   *                      processed.                              *
   *                                                              *
   *                      That wait was preventing the virtual    *
   *                      domain process from generating health   *
   *                      check events, resulting in fail over.   *
   ****************************************************************
   * RECOMMENDATION: none                                         *
   ****************************************************************
   Failover occurs following rediscovery, when the topology
   updates are sent out from ncp_model.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The OQL messages to update the config.failover tables of the
   listening processes are now sent in a separate thread, so as to
   prevent the main functinoality of the virtual domain process
   from being blocked.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ15447
   
   
 * REPORTED COMPONENT NAME
   NC/PREC TPL SV
   
   
 * REPORTED COMPONENT ID
   5724O6000
   
   
 * REPORTED RELEASE
   360
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2008-02-12
   
   
 * CLOSED DATE
   2008-02-20
   
   
 * LAST MODIFIED DATE
   2008-02-20
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  NETCOOL
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   NC/PREC TPL SV
   
   
 * FIXED COMPONENT ID
   5724O6000
   
   

APPLICABLE COMPONENT LEVELS
 * R360 PSY
   UP