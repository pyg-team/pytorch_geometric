Title: IBM IC56835: SOAP Headers present in request messages are returned in        response messages, regardless of component architecture - United States

Text:
 
APAR STATUS
 * CLOSED AS SUGGESTION FOR FUTURE RELEASE.
    
   
   

ERROR DESCRIPTION
 * WHEN A MESSAGE FLOW IS INVOKED WHICH INCLUDES PROPOGATING SOAP
   HEADERS THROUGH SCA COMPONENTS IN A REQUEST/RESPONSE MESSAGE,
   YOU MAY NOTICE THAT THE RESPONSE MESSAGE ALSO CONTAINS THESE
   HEADERS, REGARDLESS OF IF THEY WERE RETURNED FROM THE END
   POINT SERVICE PROVIDER OR NOT.
   
   FOR EXAMPLE, CONSIDER THE FOLLOWING FLOW:
   
   -------------- ---------------- --------
   | WEB SERVICE| |MEDIATION FLOW| | POJO |
   | CLIENT |--->| COMPONENT |---->| |
   -------------- ---------------- --------
   
   THE WEB SERVICE CLIENT INVOKES THE MEDIATION FLOW COMPONENT
   (MFC) WITH A MESSAGE WHICH CONTAINS A SOAP HEADER. THE MFC IN
   TURN INVOKES (USING THE SAME MESSAGE) A POJO (PLAIN OLD JAVA
   OBJECT), WHICH STRIPS THE SOAP HEADER OFF THE MESSAGE AND
   RETURNS THE MESSAGE TO THE MFC IN THE RESPONSE FLOW.
   
   HOWEVER, IN THE PROCESSING OF THE RESPONSE FLOW, THE
   SERVICEMESSAGEOBJECT (SMO) WHICH FLOWS THROUGH THE MFC AGAIN
   CONTAINS THIS SOAP HEADER. WHEN THIS MESSAGE IS RETURNED TO
   THE WEB SERVICE CLIENT, THE SOAP HEADER IS AGAIN PROPOGATED
   BACK. FURTHERMORE, IF YOU ATTEMPT TO REMOVE THE SOAP HEADER
   (FOR A SECOND TIME) WITHIN THE MFC (BY A HEADER DELETION), THE
   WEB SERVICE CLIENT WILL STILL RECEIVE THE HEADER IN THE
   MESSAGE IT RECEIVES FROM THE MFC.
   
   EACH TIME THE RESPONSE MESSAGE PASSES OVER A SCA BOUNDARY, THE
   CURRENT DESIGN OF THE PRODUCT IS SUCH THAT THE SOAP HEADER
   PART OF THE REQUEST MESSAGE IS REUSED FOR THE RESPONSE, WITH
   ANY ADDTIONS OR CHANGES TO THE SOAP HEADERS IN THE RESPONSE
   MESSAGE OVERLAYED OVER THE REQUEST MESSAGE.
   
   CONSEQUENTLY, DELETING A SOAP HEADER IN A RESPONSE FLOW WILL
   NOT PREVENT THE HEADER FROM BEING RETURNED TO THE INVOKING
   SERVICE.
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS
 * IF YOU EXPERIENCE THIS ISSUE, AND REQUIRE TO REMOVE THE
   INVOKING MESSAGE'S SOAP HEADER, THEN YOU SHOULD SET THE VALUE OF
   THE SOAP HEADER TO BE NULL IN THE SCA COMPONENT. FOR EXAMPLE,
   IF YOU ARE USING AN MFC, YOU COULD INSERT A CUSTOM MEDIATION
   PRIMITIVE INTO THE RESPONSE FLOW, WITH CODE OF THE FOLLOWING
   FORM TO NULL THE VALUE OF THE FIRST SOAP HEADER WITHIN THE SMO:
   
   COM.IBM.WEBSPHERE.SIBX.SMOBO.SOAPHEADERTYPE SOAPHEADER =
   (COM.IBM.WEBSPHERE.SIBX.SMOBO.SOAPHEADERTYPE)
   SMO.GETHEADERS().GETSOAPHEADER().GET(0);
   SOAPHEADER.SETVALUE(NULL);
   OUT.FIRE(SMO);
   
   THE RESULT OF THIS WILL BE THAT THE RESPONSE MESSAGE WHICH IS
   PASSED BACK TO THE WEB SERVICE CLIENT IN THE ABOVE EXAMPLE
   WILL NOT CONTAIN THE NULLED SOAP HEADER. IF THERE WAS MORE
   THAN ONE SOAP HEADER, THEN EACH ONE WOULD NEED TO BE NULLED.
   
   NOTE THAT THE FOLLOWING SCENARIO, EVEN IF THE SOAP HEADER
   VALUE IS NULLED OUT IN MFC2, IT WILL STILL BE SEEN IN MFC1,
   AND SUBSEQUENTLY WILL STILL BE PASSED BACK TO THE WEB SERVICE
   CLIENT.
   
   -------------- -------- -------- --------
   | WEB SERVICE| | MFC1 | | MFC2 | | POJO |
   | CLIENT |--->| |---->| |---->| |
   -------------- -------- -------- --------
   
   TO AVOID THE HEADER BEING SENT BACK TO THE CLIENT, THE VALUE
   MUST BE NULLED OUT IN MFC1 IN THIS CASE.
   
   NOTE ALSO THAT WHEN USING THIS WORKAROUND, IF YOU ATTEMPT TO
   VALIDATE THE SMO AGAINST THE SCHEMA, VALIDATION WILL FAIL.
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   IC56835
   
   
 * REPORTED COMPONENT NAME
   WEB ESB FOR WIN
   
   
 * REPORTED COMPONENT ID
   5724I8200
   
   
 * REPORTED RELEASE
   300
   
   
 * STATUS
   CLOSED SUG
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2008-06-17
   
   
 * CLOSED DATE
   2008-06-23
   
   
 * LAST MODIFIED DATE
   2008-06-23
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS