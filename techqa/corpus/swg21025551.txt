Title: IBM CICS Sockets application hangs due to connection time out - United States

Text:
TCPIP TCP/IP MVS SOCKETS hang hung stuck connection timeout error 5697E9300 630 HCI6300 5697-E93 5697E93 5752SC100 KIXINFO retention23 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are having a problem with TCPIP V3.1 for MVS. You use a large CICSÂ® Sockets application that utilizes a Windows PC as a client, and CICS as a server. Every end-user transaction results in a new TCP connection to CICS, data transfer, and then TCP session tear down. You are using the standard IBM supplied Listener for CICS. The problem is intermittent connection timeouts experienced by the PC. 

CAUSE
The SMF collection interval of 30 minutes is causing a delay in CICS.

DIAGNOSING THE PROBLEM
A packet trace performed on the MVS system shows the TCP SYN packets being received, but no response being sent. The PC then retries a few times and eventually gives up, causing the user to get the connection timeout error.

The Listener writes messages to the CICS log every time a new connection is processed, and when it ends. These are the attach and detach messages with message ID EZACIC03. These messages are date and time stamped. By looking at these messages you can see the periods of time when TCPIP stops accepting new connections because there are big gaps in the time stamps. This is very obvious because you normally see 3 to 8 new connections per second, and then you see over a minute go by with no messages at all being created. Further investigation of these messages shows this happens every 30 minutes. The period of time when no new connections are accepted is currently about 90 seconds but seems to be increasing. So it seems something happens to TCPIP every 30 minutes that causes it to stop processing new connections for awhile (currently about 90 seconds) and then resume normal processing again.

Looking at the screen captures of the QR TCB, you can see during the wait, the TCBSRBND bit is set. In the original dump, you checked and found ASCBSSSS is set. TCBSRBND and ASCBSSSS , either one would prevent CICS from operating.

Completion of a CICS/TCPIP sockets request causes ASCBSSSS to be set and prevents the CICS QR TCB from running. It is set to 0002 because there were 2 DB2 thread TCBs that were waiting on a local lock. It was waiting on an SMF lock. The processing was related to the SMF parameter DDCONS (YES).

Your SMF collection interval is set to 30 minutes. With DDCONS(YES), there will be lots of CPU-intensive processing at every 30 minute interval. Because of the series of circumstances enumerated above, this DDCONS-related processing affects the CICS address space.

You were concerned about using DDCONS(NO). APAR OY25606 states how DDCONS(NO) will cause SMF to add entries to the end of a table, rather than spending the time to search the table for an existing matching entry. Does this mean this SMF table will continue to grow as entries are added to the end? Or is there some process that prunes old entries out of the table? You do not want to get into a storage problem with DB2.

These records are kept in the High Private storage of the address space. The records do continue to grow for the life of the address space. There is a potential for storage problems but there are no known storage problems. The more common potential problem is being able to write all these records to the SMF data set when the address space is shut down. If you were to see these messages:

IEE986E SMF HAS USED xx% OF AVAILABLE BUFFER SPACE 
IEE979W SMF DATA LOST - NO BUFFER SPACE AVAILABLE

then you would need to review some general SMF tuning issues (is the CISIZE optimal for the DASD device type and the size of the SMF records being created, is there contention for the SMF data sets, what data is being collected). At this point, the use of DDCONS(NO) should not cause you any storage problems.

RESOLVING THE PROBLEM
Change the SMF parameter DDCONS [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/iea2e2b0/76.9?SHELF=EZ2ZBK0K&DT=20100707150358] from "YES" to DDCONS(NO) to correct this problem.



PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server