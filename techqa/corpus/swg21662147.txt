Title: IBM APMUI 7.7 LDAP authentication fails - United States

Text:
APMUI; 5724G70UITR; scapm TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The LDAP user cannot log into the APMUI after implementing LDAP user registry as per instructions in the APMUI User Guide. 

SYMPTOM
console.log in APMUI_HOME//usr/servers/apmui/logs has following messages:
[AUDIT ] CWWKG0028A: Processing included configuration resource: /usr/Tivoli/APMUI/usr/shared/config/ldapRegistry.xml
....
[AUDIT ] CWWKS1100A: Authentication did not succeed for user ID apmadmin. An invalid user ID or password was specified.



CAUSE
LDAP properties in ldapRegistry.xml are not correct.

RESOLVING THE PROBLEM
 Section "Configuring an LDAP user registry for Liberty profile" of Application Performance Management User Interface (APMUI) User Guide has a sample ldapRegistry.xml. The properties in this sample are only examples, the settings in this file are dependent on the specific LDAP setup in your environment. 


1) Contact LDAP administrator to determine LDAP Server settings for APMUI users. Validate what filters must be used, as well as values for the bindDN and bindPassword etc, based on how the LDAP Directory Information Tree (DIT) is configured. 

The meaning of various properties in the ldapRegistry.xml are as follows: 

baseDN: specifies the starting point in the LDAP (DIT) for all LDAP searches
bindDN: specifies the distinguished name for the application server to use when it attempts to bind to the LDAP server
bindPwd: specifies the password for the application server to user when binding to LDAP

The filters:

userFilter: defines the filter is used to search LDAP for users
groupFilter: defines the filter used to search LDAP for groups
userIdMap: specifies the LDAP filter that maps the short name of a user to an LDAP entry
groupIdMap: specifies the LDAP filter that maps the short name of a group to an LDAP entry
groupMemberIdMap: specifies the LDAP filter that identifies user-to-group relationships. It specifies which property of an objectclass stores the list of members belonging to the group represented by the objectclass.

The filters do not need to be specified. If they are not specified they contain default values depending on the LDAP server type (IBM Directory Server, Microsoft Active Directory etc). So these are always required, but if the default values match with the LDAP tree's configuration, then they do no need to be explicitly specified in the server.xml file.

For Active Directory, if no filters are specified, the default values for the filters are as follows:

// Active Directory LDAP

filters.put(LdapConfig.USER_FILTER, "(&(sAMAccountName=%v)(objectcategory=user))");
filters.put(LdapConfig.GROUP_FILTER, "(&(cn=%v)(objectcategory=group))");
filters.put(LdapConfig.USER_ID_MAP, "user:sAMAccountName");
filters.put(LdapConfig.GROUP_ID_MAP, "*:cn");
filters.put(LdapConfig.GROUP_MEMBER_ID_MAP, "memberof:member");

Again, these should match with how the LDAP server is actually set up in terms of objectclasses, and attributes on the LDAP entries. The LDAP admin can confirm the same. 


2) Use ldapsearch utility to verify the settings in ldapRegistry.xml. 

Note: If you have IBM Lotus Notes installed, ldapsearch utility can be found under "notes" directory. 

For example, if the ldapRegistry is setup as follows:
<server> 
<ldapRegistry id="ldap" realm="SampleLdapADRealm" 
ldapType="Microsoft Active Directory" 
host="apmldap.sc.us.ibm.com" port="389" ignoreCase="true" 
baseDN="cn=users,dc=sc,dc=us,dc=ibm,dc=com" 
bindDN="cn=apmadmin,cn=users,dc=sc,dc=us,dc=ibm,dc=com" 
bindPassword="testpassword" 
userFilter="(&amp;(sAMAccountName=%v)(objectcategory=user))" 
groupFilter="(&amp;(cn=%v)(objectcategory=group))" 
userIdMap="user:sAMAccountName" 
groupIdMap="*:cn" 
groupMemberIdMap="memberOf:member"> 
</ldapRegistry> 
</server> 

 

The following command matches what the APMUI Liberty Profile server does at runtime to authenticate user apmadmin based on above ldapRegistry.xml settings:
ldapSearch -h apmldap.sc.us.ibm.com -p 389 -b cn=users,dc=sc,dc=us,DC=ibm,DC=com -D cn=apmadmin,cn=users,dc=sc,dc=us,dc=ibm,dc=com -w testpassword uid=apmadmin 

Here the parameters to ldapsearch tool are as follows: 

-h host ldap server [server.acme.com] 
-p port port on ldap server [389] 

-b baseDN base dn for search [""] 

-D bindDN bind dn for simple authentication [NULL i.e. anonymous]

If the ldapsearch command does not execute successfully, then this confirms that the issue is with the
ldapRegistry.xml settings.