Title: IBM High query cost estimate for Full Outer Join queries generated by MicroStrategy - United States

Text:
Microstrategy; generated query; large SQL cost; FULL OUTER JOIN TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 MicroStrategy generated queries might have a very large estimated cost associated with the query. 

SYMPTOM
Queries generated by MicroStrategy that contain a series of Full Outer Join operations and expressions with COALESCE function could exhibit very high estimated cost. For example, QUERY_COST_ESTIMATE = 950138918693502976. This technote attempts to explain one of the reasons this may be so in DB2 LUW v9.7.


CAUSE
If the query is complex and returns billions or trillions of rows, a large cost is expected. However, the following characteristics were common to the queries reviewed: 

 * 
 * 
 * 
 * 


Significance:  * 
 * 
 * 


Using a simplified query and access plan:  * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 


[/support/docview.wss?uid=swg21626646&aid=1] [/support/docview.wss?uid=swg21626646&aid=1] 

MicroStrategy has a VLDB (Very Large Database) setting that can be configured to indicate the underlying database software does not support Full Outer Join operation. This allows the FOJ to be rewritten to a different kind of join in the query. In some cases, it could be appropriate to change this setting for DB2 LUW. This may bring down the large estimated cost of the query. It is not necessary that this configuration change will improve the performance of the FOJ query. Consult with MicroStrategy before changing this setting in the production environment. 

DB2 v10 incorporates a new design in the way FOJ are handled. In DB2 v10, optimizer functionality is enhanced to use HASH JOINS as well where there are expressions. At this level, you may see some improvements in the query cost. 

ENVIRONMENT
DB2 LUW database handling complex MicroStrategy queries



DIAGNOSING THE PROBLEM
Examine the query for Full outer joins, and expressions.



RESOLVING THE PROBLEM
If the cost or the performance is the concern, consult with MicroStrategy about changing the VLDB setting for DB2 for Full Outer Join Support from the default 'Supported' to test performance improvement. 

Upgrade to DB2 LUW v10.1 to take advantage of the changes made to optimizer functionality.