Title: IBM Installation Time for BRMS - United States

Text:
MSGBRM402B; MSGBRM40A2; MSGBRM40A8; MSGBRM40A6; MSGBRM40A4 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document describes how to estimate the amount of time it will take to upgrade BRMS (5722BR1) on a system from one release to another. 

RESOLVING THE PROBLEM
If the size of the QUSRBRM library on your server is large, you could experience long installation times when upgrading BRMS to a higher release. This is due to the conversion of the physical files in the QUSRBRM library to a new file format. The benefits of this conversion are: 

o More storage available on your system o Shorter save times when saving the user libraries on your system o Less time to save the BRMS media information after each backup 
The following is a summary of the installation time required when a BRMS upgrade from V5R1M0 to V5R2M0 was performed and where the size of the QUSRBRM library before the installation was 27 gigabytes consisting of 8,570,000 million records. 

*PGM installation time 00:01:51 
*LNG installation time 01:00:06 

The QUSRBRM storage size after the installation was 7.6 gigabytes. The physical file conversion rate for the above installation was approximately 175,000 records per minute. 

The physical file conversion occurs during the post processing phase of the primary language installation. The time required to convert the files in library QUSRBRM will vary depending on the system model, storage configuration, and number of records in the physical file in the QUSRBRM library. If the size of the QUSRBRM library on your system is significantly larger than the example above, you must plan for the extended installation time. 

V5R2M0 and Earlier 

Note: When you perform the estimation process below, ensure the system environment that you plan to use when installing BRMS is emulated. The conversion performs best when system activity is minimized. 

To estimate the conversion time, do the following: 

1. If you are upgrading from V5R1M0 (without BRMS PTF SI08485 installed) or from an earlier release, complete steps 2 through 8 to determine the estimated conversion time for your system.

If you are upgrading from V5R1M0 (with BRMS PTF SI08485 installed) or from V5R2M0, type the following command to determine the estimated conversion time:

CALL QBRM/Q1ARMLT PARM('ESTCONVTIM')

Press the Enter key. Review the job log or the BRMS log for the following message with the estimated conversion time: 

BRM402B: ESTIMATED CONVERSION TIME IS nn HOURS AND nn MINUTES. 2. Use the Display File Description (DSPFD) command to determine the Current number of records and the Number of deleted records for the following files in the QUSRBRM library:

QA1ADI
QA1ADI2
QA1AHS
QA1AHH 
QA1ALI
QA1ALI2
QA1AMB
QA1AOD
QA1AOQ 3. If the Number of deleted records for any file is large, then use the Reorganize Physical File Member (RGZPFM) command to remove the deleted records prior to completing the remaining steps. 4. On the operating system command line type the following command to create a duplicate of one of the larger files, listed above, to the QTEMP library:

CRTDUPOBJ OBJ(QA1ALI) FROMLIB(QUSRBRM) OBJTYPE(*FILE) TOLIB(QTEMP) DATA(*YES) 

Press the Enter key. 5. Review the job log to determine the time (in minutes) required to complete the file duplication. 6. Divide the number of records in the file by the duplication time to determine the number of records duplicated per minute. 7. Calculate the total number of records by summing the Current number of records for each of the files listed in Step 2 above. 8. Determine the approximate conversion time by dividing the total number of records (from Step 7) by the number of records duplicated per minute (from Step 6). 
V5R3M0 and Above 

If you are migrating from a system to a V5R3M0 system and changing the physical hardware of the system, the QUSRBRM library from the previous release is restored and then the BRMS license program product (LPP) is installed. When this occurs, the following happens: 

During the installation process, the Q1ACXINST exit program creates the data area QUSRBRM/Q1APRDINZ. All BRMS menus and command CPPs will issue the following message if this data area exists when the command or menu function is invoked: 

BRM40A2 - BRMS product initialization required. 

Also, menu option numbers are hidden when this data area exists. 

After completing the installation, Q1ACXINST submits the command INZBRM OPTION(*RUNPRDINZ) to the "installer" batch queue to complete the initialization process and send the following message to the QSYSOPR message queue: 

BRM40A8 - BRMS initialization job submitted to batch. 

Data area QUSRBRM/Q1APRDINZ contains the qualified job name of the initialization task. If the system is in restricted state or the subsystem job queue is not started, then the initialization task will not begin until the job queue is released. To estimate how long this job will run, type the following command: 

INZBRM OPTION(*ESTPRDINZ) 

Press the Enter key. A BRM402B - Estimated initialization time is &6 hours and &7 minutes message will be returned. 

If another user in another job attempts to run initialization, the INZBRM command detects the job name in data area QUSRBRM/Q1APRDINZ and sends the following message: 

BRM40A6 - BRMS product initialization already started. 

Note: It is possible that while initialization is running, the user might IPL the system or cancel the initialization job. In this instance, message BRM40A6 is issued but you cannot find the job in the system. The work around for this follows: 1. On the operating system command line type the following:

CHGDTAARA DTAARA(QUSRBRM/Q1APRDINZ (1 28)) VALUE(' ')

Press the Enter key. 2. On the operating system command line type the following:

INZBRM OPTION(*RUNPRDINZ) 

Press the Enter key. If the user applies a PTF to BRMS before the initialization process is complete, the QBRM/Q1ACHPTF PTF exit program creates the data area QUSRBRM/Q1APTFINZ. The PTF exit is not run in this case and the data area contains the parameters needed to call the q1achptf exit program after initialization completes. 

After product initialization completes, it checks for the existence of the Q1APTFINZ data area and, if it exists, calls the PTF exit program using the parameters in the data area. After the PTF exit completes, BRMS initialization completes successfully and the Q1APRDINZ and Q1APTFINZ data areas are deleted. The following message is sent: 

BRM40A4 - BRMS product initialization successful. 

To ensure that BRMS functions correctly after you complete the installation, load and apply the latest PTF for 5722BR1. 

Note: Due to the complexity of new code, the INZBRM OPTION(*ESTPRDINZ) will ALWAYS return a time of 10 minutes. 
If you need a better estimate of the time it will take to initialize the BRMS product after the upgrade you should use the call statement in the section: 
V5R2M0 and Earlier CALL QBRM/Q1ARMLT PARM('ESTCONVTIM') 

If this time frame is too long based upon your window for the upgrade and the time you have between the upgrade and when your first full system save should take place, you should follow the documentation as outlined on the BRMS Wiki at the following URL: 

Improving time for initializing BRMS with product initialization during system upgrades [https://www.ibm.com/developerworks/community/wikis/home?lang=en#/wiki/IBM%20Backup%2C%20Recovery%20and%20Media%20Services%20%28BRMS%29%20for%20i/page/Improving%20time%20for%20initializing%20BRMS%20with%20product%20initialization%20during%20system%20upgrades] [https://www.ibm.com/developerworks/community/wikis/home?lang=en#/wiki/IBM%20Backup%2C%20Recovery%20and%20Media%20Services%20%28BRMS%29%20for%20i/page/Improving%20time%20for%20initializing%20BRMS%20with%20product%20initialization%20during%20system%20upgrades]  



Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.2 Operating System IBM i 7.1 Operating System IBM i 6.1 Operating System IBM i 7.3 
HISTORICAL NUMBER
 374033593