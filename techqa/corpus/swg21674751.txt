Title: IBM A "Next Service Item Not Defined" error occurs after migrating process instances with Stay on Page Event (SOPE) for IBM Business Process Manager (BPM) - United States

Text:
move token next service not defined sope stay on page event postpone policy file migration instance tokens TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After you migrate process instances to a new snapshot version, you might find that some of your migrated instances are in a "Next Service Item Not Defined" error state. The meaning of this error state is that the instance does not have a valid token path and cannot be routed after the migration has completed. 

SYMPTOM
Your code runs as a service that contains a Stay on Page Event (SOPE) object, which follows immediately after a Postpone object. When the instance is on the Stay on Page Event (SOPE) and is migrated to a new snapshot version, the instance enters an error state with the "Next Service Item Not Defined" error.


CAUSE
This "Next Service Item Not Defined" error state after an instance migration most often occurs when a new instance version deletes a destination, which results in migrated instances not having a valid destination. This situation can occur even when the destination is recreated due to the destination ID being different. To avoid that issue, always make use of policy files as documented in the Managing orphaned tokens with a policy file [http://pic.dhe.ibm.com/infocenter/dmndhelp/v8r5m0/index.jsp?topic=/com.ibm.wbpm.admin.doc/topics/managing_orphans_with_policyfile.html] topic within the IBM Business Process Manager product documentation.

However, this error also occurs when you use a Stay on Page Event (SOPE) object, which follows immediately after a Postpone object. These situations are not remedied by using the Policy File as described previously. Instead, these situations are unsupported use cases and they should be avoided. The reason for this behavior is that the postpone feature is intended for a user to "save" or "complete" whatever state they currently have and then leave the task for a later time. Specifying a stay on page after a postpone does not really adhere to the purpose and design of the postpone event.

Additionally, the postpone event is used in a service that does not utilize tokens. Instance migration only works on the tokens that keep track of the process instance flow and where it is at in the process. However, instance migration does not handle the flow state inside of a service. All of that is handled within the Runtime engine, which is why instance migration loses track of where the flow is and cannot find where in the process should it migrate the token.

RESOLVING THE PROBLEM
The Move Token API was created for an Orphaned Token event. Sometimes during instance migration, tokens get orphaned and stuck in a process at a given time. This issue is due to edits or to non-token-based scenarios, such as the scenarios that are addressed by this document. This causes the process to be in limbo. By moving the token, you can restart the process at a certain point in time and re-initiate the flow of the process so that it can proceed as it is supposed to in the newly migrated snapshot.

However, data is not retained when you use the Move Token API. Depending on how far back one moves the token, a lot of data might be lost which had previously been compiled. This scenario is a limitation in the way the function was designed. Later versions of the product, such as IBM Business Process Manager V8.0.1, include the ability to move the token within linked or sub-processes rather than having to move the token to the beginning of the process to restart all of the events. If you are running a series of services though, then you might need to restart the entire flow and rebuild all of the data. For more information regarding orphaned tokens, see Managing tokens using the REST API Client and Process Inspector [http://pic.dhe.ibm.com/infocenter/dmndhelp/v8r5m0/topic/com.ibm.wbpm.admin.doc/topics/tmanagingtokens.html] in the product documentation.



Cross reference information Segment Product Component Platform Version Edition Business Integration IBM Business Process Manager Standard Application Deployment AIX, Linux, Linux zSeries, Solaris, Windows 8.5, 8.0.1, 8.0, 7.5.1, 7.5 Business Integration IBM Business Process Manager Express Application Deployment Linux, Windows 8.5, 8.0.1, 8.0, 7.5.1, 7.5 
PRODUCT ALIAS/SYNONYM
 BPM