Title: IBM WebSphere Portal throws DB2 errors on startup - United States

Text:
db2; icm.properties; startup TECHNOTE (TROUBLESHOOTING)

PROBLEM
WebSphere Portal throws DB2 error, DB2 SQL Error: SQLCODE=-104,
SQLSTATE=42601, on startup

SYMPTOM
These DB2 errors are found in the SystemOut.log during Portal startup....

[3/19/14 10:24:25:663 EDT] 00000016 NodeImpl E
com.ibm.icm.jcr.NodeImpl getPath
com.ibm.icm.ci.data.CDMContentException: DB2 SQL Error: SQLCODE=-104,
SQLSTATE=42601, SQLERRMC=PRIOR;CRLV00001 CONNECT BY;PRIOR,
DRIVER=4.14.113Thread 1920299637 : qlSyntaxErrorException: DB2 SQL
Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=PRIOR;CRLV00001 CONNECT
BY;PRIOR, DRIVER=4.14.113
at com.ibm.db2.jcc.am.ed.a(ed.java:677)


CAUSE
In this case, the incorrect values for the database properties in the icm.properties file was a result of changing the Portal database from Oracle to DB2. The Portal environment was a 2 node cluster and these errors were occurring on the secondary node. This was because the database-transfer config task was ran on the primary node and the task updates the icm.properties on the primary node. The task is not required to run on secondary nodes because the WSAS sync process pushes the new database config from the primary node to the secondary nodes. However, so the icm.properties needs to be updated manually on secondary nodes because it is not part of the WSAS config and does not get synced.

ENVIRONMENT
Portal 7.0.0.2
DB2
Linux

DIAGNOSING THE PROBLEM
The class listed in the error above, which starts with
com.ibm.icm.ci.data.CDMContentException, indicates the error is coming from the WCM code. 
Therefore review the 
<wp_profile>/PortalServer/jcr/lib/com/ibm/icm/icm.properties file on this node and find the database properties.....see below....and ensure they are pointing to the correct database type...

jcr.database.type
jcr.database.driver

RESOLVING THE PROBLEM
Edit the icm.properties and ensure the following properties are set correctly...

jcr.database.type
jcr.database.driver




Example syntax...
jcr.database.type=DB2
jcr.database.driver=com.ibm.db2.jcc.DB2Driver 


Please check your icm.properties for further examples of proper values based on your configuration. 


Discuss this topic further in the WebSphere Portal forum at this link....

https://www.ibm.com/developerworks/community/forums/html/topic?id=f1532b12-5379-412b-bdab-248ea56dccb8 [https://www.ibm.com/developerworks/community/forums/html/topic?id=f1532b12-5379-412b-bdab-248ea56dccb8]