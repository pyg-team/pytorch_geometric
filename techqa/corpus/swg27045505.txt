Title: IBM Creating a Remote Microsoft SQL Server Database for IBM® Content Manager OnDemand - United States

Text:
 RELEASE NOTES

ABSTRACT
 In a typical installation, the IBM® Content Manager OnDemand and the Microsoft SQL Server reside on the same system. The database used by the Content Manager OnDemand instance is created locally and resides on the local file system.

Although it is not preferred, it is possible to run the Content Manager OnDemand server against a remote SQL Server database. In this case, the database resides on a different machine on which the Microsoft SQL Server is installed. 

CONTENT
Let's assume there are two physical Windows machines, the machine with Microsoft SQL Server installed (the SQL Server machine) and the machine with the Content Manager OnDemand Server installed (the Content Manager OnDemand Library Server machine). We will discuss steps to be performed on each machine separately.


Prepare the SQL Server Machine 

To install the SQL Server, click setup.exe on the install media. The SQL Server must be installed with Mixed Mode authentication to allow both Windows authentication and SQL Server authentication to be used. For more information about this, refer to this document titled Installing and Configuring Microsoft SQL Server 2012 for IBM® Content Manager OnDemand [http://www-01.ibm.com/support/docview.wss?uid=swg27045453]. 

 

After the SQL Sever has been installed, start the SQL Server Management Studio and create a database with an upper case name that will be used as the Content Manager OnDemand instance name. Right click Databases and select New Database... Once the database is created, we need to map a user to it and assign a default schema name. This user ID should be the Windows user ID that will be used to create the Content Manager OnDemand instance on the Content Manager OnDemand Library Server machine. If this ID does not exist, go to Security, right click Logins, New Login... to create it. This ID should be set to use the SQL Server authentication. Locate this user ID and double click it to bring up the Login Properties panel. Go to the User Mapping page and select the database we just created. Enter the same user name to the Default Schema field. Click OK to save the changes. 

 

Prepare the Content Manager OnDemand Library Server Machine 

 

Before installing the Content Manager OnDemand Server on the Content Manager OnDemand Library Server machine, you must verify the existence of the following Microsoft SQL Server 2008 R2 Server Management Objects (SMO) files:


 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.ConnectionInfo.dll 
 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.Management.Sdk.Sfc.dll 
 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.Smo.dll 
 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.SmoExtended.dll 
 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.SqlEnum.dll 
 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.SqlWmiManagement.dll 
 * C:\Program Files\Microsoft SQL Server\100\SDK\Assemblies\Microsoft.SqlServer.WmiEnum.dll


These files are required because during the Content Manager OnDemand Server installation, the installer registers the Content Manager OnDemand SMO. The process needs the files listed above to complete the Content Manager OnDemand SMO DLL registration during the Content Manager OnDemand Server installation. 

If above files do not exist, you will need to download and install Microsoft® SQL Server® 2008 R2 Shared Management Objects which is included in Microsoft® SQL Server® 2008 R2 Feature Pack. 

The Microsoft® SQL Server® 2008 R2 Feature Pack can be found at the following link: 

https://www.microsoft.com/en-us/download/details.aspx?id=16978 [https://www.microsoft.com/en-us/download/details.aspx?id=16978] 

The Microsoft® SQL Server® 2008 R2 Feature Pack includes many other components which you may or may not need. The feature pack also includes Microsoft® SQL Server® 2008 R2 Native Client. 

On the Content Manager OnDemand Library Server machine, you need to install a version of the Microsoft SQL Server Native Client that is compatible with the version of SQL Server installed on the SQL Server machine. If there is only one version of the SQL Server involved, you can just install the SQL Native Client on the same media that was used to install the SQL Server on the SQL Server Machine. The version included in the Microsoft® SQL Server® 2008 R2 Feature Pack can also be used with Content Manager OnDemand Server V9.0 and V9.5.  

To install the Microsoft SQL Server Native Client, click setup,exe to launch the SQL Server Installation Center. Select Installation on the left panel. Select New SQL Server standalone installation or add features to an existing installation on the right panel. Make sure there are no failures on the following Setup Support Rules panels. 

 

On the Setup Role panel, choose SQL Server Feature Installation. On the Feature Selection screen, select Client Tools Connectivity. Make sure there are no failures on the Installation Rules panel. 

 

When the SQL Server Native Client installation completes, make sure there are no errors, close the SQL Server Installation Center and reboot if required. 


Once the SQL Sever Native Client is installed successfully, you can proceed and create a new SQL server instance using the OnDemand Configurator. On the Database page, Advanced Options for Microsoft SQL Server panel, enter the host name or IP address of the SQL Server machine in the field labeled Microsoft SQL Server Name, If the SQL Server was not installed with the default instance name, MSSQLSERVER, you must specify the instance name along with the host name or IP address of the SQL Server machine in the format as shown on the Advanced Options for Microsoft SQL Server panel of the OnDemand Configurator. When the Configurator prompts to create the database, click Cancel. 

 

When the Content Manager OnDemand instance is created, a set of directories are also created locally on the Content Manager OnDemand Server machine. The same set of directories used by the database should also be created on the SQL Server machine with the same drive letter and path name. For example, if the instance used d:\SQL2014T\arsmslog as the transaction log path, the identical path, d:\SQL2014T\arsmslog, should be created on the SQL Server machine. Repeat this for the Database path and the optional filegroups path if defined. 

 

Open an OnDemand Command Window and type the following command to create the database tables and indexes. 

 

arsdb -I instance_name -ctv 

 

If the entire process is successful, you should see messages like this:

ARS4018I Creating the Microsoft SQL Server instance_name database
... 


ARS4026I Creating table schema_name.arsag
ARS4034I Creating index arsag_name_idx
ARS4034I Creating index arsag_agid_idx
ARS4026I Creating table schema_name.arsag2fol
ARS4034I Creating index arsag2fol_idx
...

You may also see an exception message such as this:

----------
Cannot write property DefaultSchema.This property is not available on SQL Server 7.0.
Microsoft.SqlServer.Management.Smo.UnknownPropertyException
Int32 PropertyNameToIDLookupWithException(System.String, Microsoft.SqlServer.Management.Smo.PropertyAccessPurpose)
----------

The exception is caused by the arsdb command, which is trying to do the database creation and the database already exists. You need the -c option to create the ODBC data source. If the ODBC data source already exists, you can use the -rtv options to create the database tables and indexes without seeing the exception.


Once the database and tables are created, you need to run arssyscr.exe to initialize the system tables. From the same OnDemand Command Window, enter following commands.

arssyscr -I instance_name -a
arssyscr -I instance_name -l
arssyscr -I instance_name -m

The Content Manager OnDemand instance with the remote SQL Server database is now created.

Before the OnDemand LibSrvr ( instance_name) service can be started, its dependent service, MSSQLServer, should be deselected because the SQL Server service is on a different computer. Locate the OnDemand LibSrvr service for the newly created remote SQL server instance and double click it. Single click the MSSQLServer listed under Required Services to deselect it.



RELATED INFORMATION
 Installing and Configuring Microsoft SQL Server [http://www.ibm.com/support/docview.wss?uid=swg27045453]