Title: IBM DFHAC2047 Transaction routing security violation if using multiple MVS images - United States

Text:
LU62 LU6.2 LUTYPE62 APPC RACF ESM ATTACHSEC IDENTIFY FMH5 FMH-5 Group Groupid GROUP GROUPID DFHAC2047 ; 5655M1500 R640 640 R400 400 HCI6400 R650 650 R500 500 HCI6500 5655-M15 5655M15 ; 5655S9700 R660 660 R600 600 HCI6600 R670 670 R700 700 HCI6700 5655-S97 5655S97 KIXINFO TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Your CICS Transaction Server for z/OS (CICS TS) region receives message DFHAC2047. This occurs when ATTACHSEC=IDENTIFY is specified across an LU62 connection, and both USERID and GROUPID are specified. All of your CICS regions are not on the same MVS image. 

SYMPTOM
DFHAC2047 [http://publib.boulder.ibm.com/infocenter/cicsts/v4r2/topic/com.ibm.cics.ts.messages.doc/cics_mc/dfhac/AC2047.html] While performing an attach for node netname a security violation was detected.


CAUSE
An LU62 partner sends USERID and GROUPID in the FMH-5 attach header. The GROUPID, that is part of security checking, was not defined in the External Security Manager (ESM) where the target CICS system was running on another MVS image.

DIAGNOSING THE PROBLEM
From an AUXTRACE the following can be seen: 


 * A transaction on an LU62 connection is initiated in the target CICS region. 
 * A SIGNON WITHOUT PASSWORD is done by CICS due to the link having ATTACHSEC=IDENTIFY specified. 
 * The FMH-5 ATTACH HEADER contains in the Access Security Information Subfield (ASIS) a USERID and a GROUPID which will be validated by the target CICS system.


 1. CICS to CICS LU62 connection on the same MVS Image
    
    If the above scenario is run on two connected CICS systems in the same MVS image this will work correctly as the same ESM will be used by both systems.
    
    
 2. CICS to CICS LU62 connection on different MVS Images
    
    If the above scenario is run on two connected CICS systems across different MVS images this might fail if both the USERID and GROUPID are not defined in both ESMs. This is because if a USERID is propagated from one CICS system to another at another MVS image for transaction routing, the GROUPID is also propagated, and both are subject to checking by the ESM (such as RACF) there. This means that at the target system the GROUPID and the USERID must be defined.



See Information about remote users [http://publib.boulder.ibm.com/infocenter/cicsts/v4r2/topic/com.ibm.cics.ts.doc/dfht5/topics/dfht54j.html] in the CICS TS information center that describes this situation. 
RESOLVING THE PROBLEM
Define the user ID and the group ID to the external security manager in the target MVS.







Cross reference information Segment Product Component Platform Version Edition Host Transaction Processing CICS Transaction Server Terminal Control 
PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server