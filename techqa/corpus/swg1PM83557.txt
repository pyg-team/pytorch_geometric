Title: IBM PM83557: ILLEGALSTATEEXCEPTION WHILE PROCESSING TRANSACTIONS. - United States

Text:
z/os  A FIX IS AVAILABLE
8.5.0.2: WebSphere Application Server V8.5 Fix Pack 2 [http://www-01.ibm.com/support/docview.wss?uid=swg24034672]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Transactions fail with java.lang.IllegalStateException when
   Resource Recovery Service (RRS) integration is enabled on z/OS.
   
   The following is seen in the ffdc logs:
   xception = java.lang.IllegalStateException
   Source =
   com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters
   probeid = 1105
   Stack Dump = java.lang.IllegalStateException: Context
   [ContextImpl [Token: caf14e5002edb53704000000041af450,
   RegistryToken:
   c2c2c7e9d9c5c7e30000000100000040000000007eea49000000000000000000
   0200000000000000000000000000000000000000000000000000000000000000
   , State: ACTIVE, UOWCoordinator:
   com.ibm.tx.ltc.embeddable.impl.EmbeddableLocalTranCoordImpl@8c4c
   d8d1;RUNNING;]] is not associated with the unit of work trying
   to suspend it:
   com.ibm.tx.ltc.embeddable.impl.EmbeddableLocalTranCoordImpl@4679
   472c;SUSPENDED;
    at
   com.ibm.ws.zos.tx.internal.ContextManagerImpl.suspend(ContextMan
   agerImpl.java:390)
    at
   com.ibm.ws.zos.tx.internal.NativeTransactionManager.UOWEvent(Nat
   iveTransactionManager.java:1624)
    at
   com.ibm.tx.ltc.impl.LocalTranCurrentImpl.invokeEventListener(Loc
   alTranCurrentImpl.java:518)
    at
   com.ibm.tx.ltc.impl.LocalTranCurrentImpl.suspend(LocalTranCurren
   tImpl.java:204)
    at
   com.ibm.tx.ltc.impl.LocalTranCurrentSet.suspend(LocalTranCurrent
   Set.java:170)
    at
   com.ibm.ws.transaction.services.LocalTransactionCurrentService.s
   uspend(LocalTransactionCurrentService.java:147)
    at
   com.ibm.ws.transaction.services.WebAppTransactionCollaboratorImp
   l.preInvoke(WebAppTransactionCollaboratorImpl.java:256)
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  All users of IBM WebSphere Application      *
   *                  Server                                      *
   *                  Liberty Profile                             *
   ****************************************************************
   * PROBLEM DESCRIPTION: IllegalStateException seen when         *
   *                      running transaction work and            *
   *                      the Resource Recovery Service           *
   *                      integration feature is enabled.         *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   When running a transactional workload with the Resource and
   Recovery Service (RRS) integration feature configured,
   transactions may fail with a java.lang.IllegalStateException.
   The failure takes place because the state of the
   context associated with the current thread of execution was
   not properly cleared when the thread that used it
   last terminated normally.
   The following is an exmaple of what can be seen in the ffdc
   logs:
   exception = java.lang.IllegalStateException
   Source =
   com.ibm.ws.webcontainer.filter.WebAppFilterManager.invokeFilters
   probeid = 1105
   Stack Dump = java.lang.IllegalStateException: Context
   [ContextImpl [Token: caf14e5002edb53704000000041af450,
   RegistryToken:
   c2c2c7e9d9c5c7e30000000100000040000000007eea49000000000000000000
   0200000000000000000000000000000000000000000000000000000000000000
   , State: ACTIVE, UOWCoordinator:
   com.ibm.tx.ltc.embeddable.impl.EmbeddableLocalTranCoordImpl@8c4c
   d8d1;RUNNING;]] is not associated with the unit of work trying
   to suspend it:
   com.ibm.tx.ltc.embeddable.impl.EmbeddableLocalTranCoordImpl@4679
   472c;SUSPENDED;
   at
   com.ibm.ws.zos.tx.internal.ContextManagerImpl.suspend(ContextMan
   agerImpl.java:390)
   at
   com.ibm.ws.zos.tx.internal.NativeTransactionManager.UOWEvent(Nat
   iveTransactionManager.java:1624)
   at
   com.ibm.tx.ltc.impl.LocalTranCurrentImpl.invokeEventListener(Loc
   alTranCurrentImpl.java:518)
   at
   com.ibm.tx.ltc.impl.LocalTranCurrentImpl.suspend(LocalTranCurren
   tImpl.java:204)
   at
   com.ibm.tx.ltc.impl.LocalTranCurrentSet.suspend(LocalTranCurrent
   Set.java:170)
   at
   com.ibm.ws.transaction.services.LocalTransactionCurrentService.s
   uspend(LocalTransactionCurrentService.java:147)
   at
   com.ibm.ws.transaction.services.WebAppTransactionCollaboratorImp
   l.preInvoke(WebAppTransactionCollaboratorImpl.java:256)
   
   
    
   
   

PROBLEM CONCLUSION
 *  Code was updated to properly clean the state of the context
   during normal thread termination.
   
   The fix for this APAR is currently targeted for inclusion in
   fix pack following 8.5.0.2. Please refer to the Recommended
   Updates page for delivery information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM83557
   
   
 * REPORTED COMPONENT NAME
   LIBERTY - Z/OS
   
   
 * REPORTED COMPONENT ID
   5655W6514
   
   
 * REPORTED RELEASE
   850
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2013-02-25
   
   
 * CLOSED DATE
   2013-03-26
   
   
 * LAST MODIFIED DATE
   2013-03-26
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   LIBERTY - Z/OS
   
   
 * FIXED COMPONENT ID
   5655W6514
   
   

APPLICABLE COMPONENT LEVELS
 * R850 PSY
   UP