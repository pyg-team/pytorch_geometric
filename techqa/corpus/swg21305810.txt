Title: IBM Accessing Informix databases from Infosphere Warehouse - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document discusses how to configure the Informix JDBC driver for use with the Design Studio and DWE Admin Console. Workarounds for accessing not-logged Informix databases are discussed, in particular how to configure the Informix data source within Websphere which requires special configuration. 

SYMPTOM
When accessing an Informix SQL identifier ( ie. schema, table, column, etc ) delimited by double quotes ( lower case is the default for IDS, so if you have a SQL identifier that's not delimited, IDS will convert it to all lower case , an error code -201 is returned from the Administration Console during execution. 

When retrieving data from a not-logged Informix database from the Design Studio the following SQL Exception is returned : 
SQL Exception: SQL state = IX000; error code = -79744; error Message = Transactions not supported

In the Infosphere Admin Console, errors such as the following are logged when attempting to access the database : 
SQW30820E: Error while attempting to make connection to <database> 


CAUSE
The -201 error code is caused by a configuration mismatch between the Informix database default handling for delimited strings and the SQL generated by the Design Studio. By default the Design Studio is configured to handle the identifiers that are delimited with double quotes, but the Websphere data source requires explicit configuration. 


The -79744 error code is caused by the expectation by the Design Studio runtime logic that a commit or rollback can be called against any database using JDBC. Since Informix not-logged databases do not support transactions, the commit or rollback will cause this error.

The SQW30820E error is caused by the expectation by the Websphere connection management that the isolation level can be changed. Changing the isolation level when accessing an Informix not-logged database causes the connection to the Informix database to fail.



RESOLVING THE PROBLEM
 

Issue 1 - Handling lower-case identifiers or identifiers with spaces 

The Design Studio will place double quotes around SQL identifiers such as tables and columns. The Informix database may not be configured to handle the double-quotes as delimiters for identifiers and as a result the -201 error can occur when the application is deployed to a Websphere environment. 

To solve this problem, the DELIMIDENT=y option needs to be appended to the JDBC connection string when connecting to the Informix database. The Design Studio will have this environment variable set by default, but in the Websphere environment, the attribute must be explicitly set when configuring the JDBC data source. 

 1. From the Integrated Solutions Console ( ISC ), navigate to the Data sources page and choose the newly created Informix data source. 
 2. Choose the Custom properties link from the Additional Properties section of the page. This will display all the customer properties for the Informix JDBC driver. 
 3. Navigate through the list of properties looking for ifxDELIMIDENT. Once you find this property, click on the property name and set the value to true. 
 4. Click on the OK button and save the configuration when prompted.


Issue 2 - Connecting with not-logged Informix databases from Websphere 

Connections to Informix data sources within the Admin Console environment must be established using a Websphere managed data source. The Websphere connection management code expects to be able to set the default isolation level for the database. By default the JDBC driver will report that repeatable-read is the default for the connection, which causes the Websphere code to attempt to change the isolation level which results in an error. 

The workaround for this problem is to overload the data store helper class to indicate that the server does not transactions which will cause the Websphere connection manager to skip setting the isolation level and allows the connection to the database to complete without error. 

 

APAR PJ33653 provides a data source helper class called com.ibm.datatools.dwe.idsdatastorehelpers.InformixNotLoggedDataStoreHelper that can be used to avoid this problem. 

In order to install this fix : 

 1. After applying APAR PJ33653 or Infosphere 9.5.2 or later release. 
 2. From the Integrated Solution Console(ISC), navigate to the Informix JDBC Provider page and add the location of the InformixNotLoggedDataStoreHelper.jar file to the classpath for the driver. Add${DWE_INSTALL_LOCATION}/DWEAdmin/lib/InformixNotLoggedDataStoredHelper.jar to the Class path property. 
 3. From the ISC, navigate to the Informix data source that is being used by the DWE Admin application. 
 4. Find the Data store helper class name property and change the radio button selection to "Specify a user-defined data store helper". Next type in the name of the helper class : com.ibm.datatools.dwe.idsdatastorehelpers.InformixNotLoggedDataStoreHelper 
 5. Click on the OK button at the bottom of the page and save the configuration when prompted.


Issue 3 - Retrieving data from a not logged Informix database using 

The Infosphere warehouse components have been written with the assumption that transactions are supported by the data sources that it accesses. As a result after working with a database, an explicit commit or rollback is typically issued which results in the -79744 error code. 

A code change is required to avoid the -79744 error when working with a not logged data source. APAR PJ33653 is available from IBM to workaround this problem until it is permanently fixed in Infosphere 9.5.2. This patch needs to be applied to both the Design Studio and Admin Console.