Title: IBM Potential Issues When VirtualServer or ServerInstance Name Changes Occur - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Although typically an explicit action taken by an administrator, VirtualServer and ServerInstance names changes can have unintended consequences – especially in multi-site configurations. This article discusses what issues might be encountered when the VirtualServer or ServerInstance names of an existing configuration are changed – either intentionally or, in rare cases, unintentionally. 

SYMPTOM
VirtualServer and ServerInstance name changes can produce various issues and can be identified by some of these symptoms. 

 1. P8 logging may have appeared to stop, yet the system appears to be running fine. 
 2. The configuration settings previously configured at a particular VirtualServer or ServerInstance level appear to revert back to the default settings - or take on the settings configured at the Site or Domain levels. 
 3. In a multi-site environment, request forwarding or asynchronous operations for a particular object store do not appear to work or requests seem to take longer to complete. 


CAUSE
The cause of these symptoms is likely due to changes in the VirtualServer and/or ServerInstance names. In addition, these changes could be unintentionally introduced due to the nature of these objects and their relationship to the application server framework.

RESOLVING THE PROBLEM
Because Content Engine VirtualServer and ServerInstance objects are automatically created, it would be helpful to understand how the CE goes about creating these objects. A general definition of each of these objects and their relationship with other P8 Domain objects can be found in the P8 Domain Concepts page [http://publib.boulder.ibm.com/infocenter/p8docs/v5r0m0/index.jsp?topic=/com.ibm.p8.ce.admin.doc/aboutem/dom_concepts.htm] of the online help. 


Name Determination and Object Creation
When the CE server starts, one of the first things it does is determines the name of the VirtualServer and ServerInstance objects. This is accomplished by first asking the application server software for these names. For example, in WebSphere, the VirtualServer name is derived from the WAS node name, while the ServerInstance name is derived from the WAS server name. Should any issues occur looking up the ServerInstance name, the server’s host name will be used. Likewise, should any issues occur looking up the VirtualServer’s name, the ServerInstance name will be used. 

Once these names have been determined, the startup logic will then see if such named objects exist in the current collection of VirtualServers and ServerInstances in the GCD. If it finds that the VirtualServer does not exist, it creates a VirtualServer object and adds it to the default site (identified on the Domain object). Likewise, if the ServerInstance does not exist, it creates a new object and adds it to its VirtualServer – which may have just been created itself. 

The CE allows the above name determination logic to be skipped by setting the following JVM properties in the server’s JVM: (If objects of these names do not exist, the same creation logic as described above will be performed.) 

com.filenet.gcd.VirtualServerName=<myVirtualServerName> 

com.filenet.gcd.ServerInstanceName=<myServerInstanceName> 

Due to the nature of name derivation, if an application server administrator happens to change the server or node name, new objects can be created. Likewise, if there were issues previously (e.g., application server security was not configured correctly) preventing the name lookups and the host names were used, then the previous issues are resolved, this will also result in new sets of VirtualServer and ServerInstance objects getting created. If this results in the creation of a new VirtualServer, and the P8 Domain happens to consist of more than just the Initial Site, the new VirtualServer could possibly be associated with the wrong site (in cases where the previous VirtualServer had not been associated with the default site).




Symptoms (and Resolutions) of Name Changes
The following are symptoms of name changes and their resolutions: 

“My logging activity in the P8 logs has stopped, yet the software appears to be running fine.” 

In this case, the ServerInstance name was probably changed (intentionally or not) and logging is getting directed into a different ServerInstance-based directory. This can be verified by navigating to the FileNet directory located in the application server’s working directory, and checking for a new directory that is a sibling to the previous ServerInstance name directory. You should see P8 logs in that directory. If this is not acceptable, the previous ServerInstance object could be forced by setting the JVM property and restarting the application server. 

“The configuration settings that I had configured directly on my ServerInstance object don’t appear to be recognized after I restarted the server.” 

Since a new ServerInstance object was created due to the name change, it will consist of the default configuration settings – which means they will be inherited from a different topology object (VirtualServer, Site, or Domain) in the hierarchy. In this case, you will need to re-configure the settings on the new ServerInstance object – or, again, force the use of the original ServerInstance object by setting the JVM property. 

“I have a distributed environment and some ObjectStores appear to be very slow in processing requests.” 

In this case the VirtualServer name had changed and a new VirtualServer was created and added to the default site, which is not the site of the original VirtualServer. As a result, operations against ObjectStores of the other site will not be forwarded if that site now has no ServerInstances and any non-forwarded requests will likely be accessing the ObjectStores databases over a WAN and slow performance may be experienced. This issue can be resolved by setting the JVM property corresponding to VirtualServerName. 

Please note that in releases following the CE 5.0 release, the CE stores the name of the assigned site and will reassign new VirtualServers to that site upon their creation. However, the other issues described above still apply and can occur.