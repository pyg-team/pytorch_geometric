Title: IBM Some sql may get warning sql0473w rc=6 - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 Why some sql which may use indexscan returns sql0473w rc=6 ? 

CAUSE

When running some kind of sql which do index scan, it may get warning like below

db2 "SELECT * FROM TEST.TAB1 WHERE FL_SEQNO=18 "

SQL0437W Performance of this complex query might be sub-optimal. Reason code: "6". SQLSTATE=01602

At this time, check the index definition

CREATE UNIQUE INDEX TRLIST_BF1_IDX1 ON TEST.TAB1
("FL_SEQNO" ASC,
"COL2" ASC,
"COL3" ASC) 

Check the statistics info for the table

UPDATE SYSSTAT.TABLES
SET CARD=2506,
NPAGES=324,
FPAGES=1474,
OVERFLOW=0,
ACTIVE_BLOCKS=0
WHERE TABNAME = 'TAB1' AND TABSCHEMA = 'TEST';


UPDATE SYSSTAT.COLUMNS
SET COLCARD=2507,
NUMNULLS=0,
SUB_COUNT=-1,
SUB_DELIM_LENGTH=-1,
AVGCOLLENCHAR=-1,
HIGH2KEY='992013',
LOW2KEY='71',
AVGCOLLEN=4
WHERE COLNAME = 'FL_SEQNO' AND TABNAME = 'TAB1' AND TABSCHEMA = 'TEST'; 

can found the colcard for columns is larger than the card for table, which is wrong.



ANSWER
The COLCARD value is collected from the index; while the table card is collected from the table itself. If there are rows inserted between collecting table stats and collecting index stats, then we can get COLCARD greater than table card. 


To solve the warning, just run runstats again with "allow read access"

RUNSTATS ON TABLE TEST.TAB1 ON ALL COLUMNS WITH DISTRIBUTION ON ALL COLUMNS AND SAMPLED DETAILED INDEXES ALL ALLOW READ ACCESS