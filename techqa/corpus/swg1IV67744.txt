Title: IBM IV67744: ADDING AN ATTRIBUTE TO A TABLE THAT HAS AN AUDIT TABLE LEADS TO AN INDEX BEING CREATED ON AUDIT TABLE - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  PROBLEM:
   Adding an attribute to the CCICIINTERESTEDPARTY table after if
   has Audit enabled results in an Oracle error during DBConfig
   step.  While there seems to be several reasons for them getting
   this error, first and foremost, there is no reason why TPAE
   should be adding an index to the audit table at a time well
   after the audit table was established and a new attribute is
   added to the main table, which is not realated to the index it
   is adding.
   Customer wrote:
   ====================
   Limited functionality and error when configuring and auditing
   the CCICIINTERESTEDPARTY table.
   Prior to incidents described below, the client has turned on
   auditing on the CCICIINTERESTEDPATY table and the following
   fields are being audited.
   PERSONID
   PERSONGROUP
   TYPE
   The requirement was to add a DATETIME field to the table and
   populate it with sysdate.  The requirement states that the
   field not be shown through the app, just available for queries.
   Results:
   When the field was added, multiple errors were encountered
   performing the database configuration and below are the steps
   taken to get the field configured.  I should note here that I
   restored from backup a couple of times before I found a way to
   get through the configuration successfully.
   The first error was related to trying to create a domain index
   on A_CCICIINTERESTEDPARTY table and that the field was too
   long.  There are currently no indexes on that table and the
   only DOMAIN index on the CCICIINITERESTEDPARTY table is
   CCICIINTEREST_NDX1, NONUNIQUE, on the DESCRIPTION field.
   After a couple of restores, where I received that error, I
   tried just performing the dbconfig again, because the dbconfig
   was still showing To be changed.  After I performed the config
   a second time (after the second or third restore from backup,
   can t remember for sure which), I noted that the field was
   added to the A_CCICIINTERESTEDPARTY table, but
   not to the CCICIINTERESTEDPARTY table (by looking at the tables
   through a SQL tool).  Still showing To be changed, I tried
   another config and got the message that the <NEWDATEFIELD>
   already existed in the A_CCICIINTERESTEDPARTY table.  Note:  I
   have substituted generic values within the brackets (<>).
   Next step was to delete the field from the CCICIINTERESTEDPARTY
   table and configure through dbconfig.  Then I added the field
   back and dbconfig performed the configuration successfully  and
   the field was added to both the main and audit tables.  In this
   initial configuration (first successful configuration), the
   &SYSDATE& was NOT a part of the configuration.
   Once the DATETIME field has been added to the table, we are not
   able to add new rows to interested parties through the CI
   application.  The error returned is as follows:
   BMXAA4211E   Database error number 29861 has occurred when
   operating on CCICIINTERESTEDPARTY : CI:=<CINAME> Person= Person
   Group =<PERSONGROUP> Type=Support.  Report the error to the
   owner of the deployment.  Note:  I have substituted generic
   values within the brackets (<>).
   I tried several scenarios at this point.
   - Added the &SYSDATE& with a non-structural configuration.
   Result:
   Received exact same error when trying to add an interested
   party.
   - When I noticed that PERSONID, PERSONGROUP, and TYPE are read
   only after save, I thought I could possibly change the solution
   for the requirement by adding auditing to the DESCRIPTION field
   and using the audit table as part of the solution using the
   EAUDITTIMESTAMP date. However, after removing the &sysdate& and
   adding the audit check to the DESCRIPTION field, the same
   results were encountered (same error as above when trying to
   add an interested party).
   - An IBM technical note was found relating to the same error
   (which I just tried to Google again, but did not find) and it
   recommended running the drop/create Lexer indexes script and
   dropping/recreating the offending domain index which I had
   already done several times.
   - Removed the audit flag on the DESCRIPTION field and performed
   non-structural config.
   
   The only way I could get the application to function again and
   allow me to add rows to the interested parties without error,
   was to remove auditing from the CCICIINTERESTEDPARTY table.
   ====================
   
   
   PERFORMANCE ISSUE:  no
   
   
   STEPS TO REPRODUCE:
   1) in DB Config app:  find the CCICIINTERESTEDPARTY object.
   2) on the main page for that object, mark the Audit checkbox
   and save
   3) go to the Attributes table and for each of these attributes
   mark the Audit checkbox and save:  PERSONID, PERSONGROUP and
   TYPE
   4) Admin Mode ON
   5) run DB Configuration action
   6) Admin Mode OFF
   7) open same object in DB Config app again.
   8) now add an attribute of type DATETIME
   9) Admin Mode ON
   10) run DB Config action.
   11)  Now you get these errors:
   BMXAA6818I - RestoreFromBackup started for schema MAXIMO,
   connected to database
   jdbc:oracle:thin:@peachvm2.tivlab.austin.ibm.com:1521:ctginst1
   BMXAA6818I - ConfigDB started for schema MAXIMO, connected to
   database
   jdbc:oracle:thin:@peachvm2.tivlab.austin.ibm.com:1521:ctginst1
   BMXAA0364I - Getting metadata
   BMXAA0349I - Configuring tables
   BMXAA0345I - Altering table A_CCICIINTERESTEDPARTY. ORA-29855:
   error occurred in the execution of ODCIINDEXCREATE routine
   ORA-20000: Oracle Text error:
   DRG-11439: index name length exceeds maximum of 25 bytes
   ORA-06512: at "CTXSYS.DRUE", line 160
   ORA-06512: at "CTXSYS.TEXTINDEXMETHODS", line 366
   BMXAA6819I - ConfigDB completed with errors.
   BMXAA6820I - RestoreFromBackup completed without errors.
   
   CURRENT ERRONEOUS RESULT:
   Adding an attribute to the CCICIINTERESTEDPARTY table when it
   has an audit table enabled leads to an error due to TPAE
   creating an unnecesary index that conflicts with an Oracle
   index name length limitation.
   
   EXPECTED RESULT:
   No unnecessary index getting created.
   
   ADDITIONAL INFO:  APAR opened at mgmt direction
   
   ENVIRONMENT:
   SCCD  7510
   TPAE  7504
   Oracle  11.2
   Base Language:  English
   Additional Language:  English
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * Maximo users on Oracle database using the DBConfig app       *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Adding an attribute to a table that has an audit table leads *
   * to an index being created on audit table                     *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Apply fixpack release 7.5.0.8 of TPAE or request an interim  *
   * fix                                                          *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Fix has been made to remove checking for database when
   converting a text search type to wildcard
   
   Fix for this APAR is contained in the following maintenance
   package
   
       | release\fix pack\7.5.0.8 fix pack of TPAE
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV67744
   
   
 * REPORTED COMPONENT NAME
   ADMINISTRATION
   
   
 * REPORTED COMPONENT ID
   5724R46A1
   
   
 * REPORTED RELEASE
   750
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2014-12-10
   
   
 * CLOSED DATE
   2015-01-23
   
   
 * LAST MODIFIED DATE
   2015-01-23
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  MAXIMO
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   ADMINISTRATION
   
   
 * FIXED COMPONENT ID
   5724R46A1
   
   

APPLICABLE COMPONENT LEVELS
 * R750 PSY
   UP