Title: IBM PI90090: DFHUS0002 A SEVERE ERROR (CODE X'030C') HAS OCCURRED IN MODULE DFHUSAD. 17/11/10 PTF PEREMOVE - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  You are receiving the following DFHUS0002 message,
   MESSAGE: DFHUS0002 A severe error (code X'030C') has
             occurred in module DFHUSAD.
    SYMPTOMS:PIDS/5655Y0400 LVLS/690 MS/DFHUS0002 RIDS/DFHUSAD
             PTFS/UI44531 PRCS/0000030C
    .
    The trace shows the following trace entries,
     DD 0201 DDDI  ENTRY DELETE_ENTRY ENTRY_NAME(3CE60070)
                         DIRECTORY_TOKEN(3B900FB0)
                         DIRECTORY_NAME(USD1)
                         NAME(<UserID>   NO ...................)
     DD 0202 DDDI  EXIT  DELETE_ENTRY/EXCEPTION
                         REASON(NOT_FOUND)
                         DATA_TOKEN(00000000 , 00000000)
     US 030C USAD  *EXC* User-not-in-directory
                         FUNCTION(DELETE_USER)
                         SIGNOFF_TYPE(USER_SIGN_OFF)
                         DELETE_IMMEDIATE(YES)
                         USER_TOKEN(00000F70)
   .
   You have the process driver uses X numbers of sequential
   terminals to execute the transaction. The driver finds an
   available terminal, and starts an intermediary transaction(yyyy)
   on the terminal. yyyy signs off the previous userid, signs on
   the new userid, and finally starts the transaction defined in
   the MQ message under this same terminal.
   .
   Further diagnosis, found the following sequences of the events,
   - A terminal signon is done for <UseID>.  This is at a
     sequential terminal and so appears to user domain to look
     exactly like a non terminal signon.
   - An ENF notification is received for <UserID> and the USUDB
     is flagged.
   - A non terminal signon occurs for <UserID>.  This finds the
     USUDB for the terminal signon (not normally expected).
   - A notification had been received so the USD1 entry for
     <UserID> is removed. USUD_DELETED_FROM_DIRKEY is set on.
   - The non terminal task completes.
   - A terminal signoff is done for <UserID>.  Code added by
     PI40828 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI40828] detects that situation and deletes the USD1 entry.
     This is intended to allow a task to issue a SIGNOFF/SIGNON for
     the same userid to pick up security changes. The USD1 deletion
     does not check the USUD_DELETED_FROM_DIRKEY flag because this
     is a terminal signoff and so the entry should always be there.
   - The USD1 deletion fails because the entry has already been
     deleted.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All CICS users.                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: CICS terminates with                    *
   *                      DFHUS0002 A severe error code X'030C'   *
   *                      has occurred in module DFHUSAD.         *
   ****************************************************************
   * RECOMMENDATION: .                                            *
   ****************************************************************
   - A terminal signon is done for Userid UUUUUUUU.
     This is at a sequential terminal and so appears to user
     domain to look exactly like a non terminal signon.
   - An ENF notification is received for Userid UUUUUUUU and the
     USUDB is flagged.
   - A non terminal signon occurs for Userid UUUUUUUU.
     This finds the USUDB for the terminal signon
     (not normally expected).
   - A notification had been received so the USD1 entry for
     Userid UUUUUUUU is removed.
     USUD_DELETED_FROM_DIRKEY is set on in the USUDB.
   - A new USD1 and USD2 entry are created along with a new USUDB.
   - The non terminal task completes and the new USUDB is put on
     the user timeout queue.
   - The USRDELAY time expires.
     This causes the new USUDB to be freed.
     The USD1 and new USD2 entry get deleted.
   - A terminal signoff is done for Userid UUUUUUUU.
     Code added at this release
     detects that situation and deletes the USD1 entry.
     This is intended to allow a task to issue a SIGNOFF/SIGNON
     for the same userid to pick up security changes.
     The USD1 deletion does not check the USUD_DELETED_FROM_DIRKEY
     flag because this is a terminal signoff
     and so the entry should always be there.
   - The USD1 deletion fails because the entry has already been
     deleted by the earlier non-terminal task.
   Additional keywords: MSGDFHUS0002
   
   
    
   
   

PROBLEM CONCLUSION
 *  DFHUSAD has been changed to prevent it from deleting an entry
   from the USD1 directory more than once.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI90090
   
   
 * REPORTED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * REPORTED COMPONENT ID
   5655Y0400
   
   
 * REPORTED RELEASE
   000
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-11-10
   
   
 * CLOSED DATE
   2017-11-17
   
   
 * LAST MODIFIED DATE
   2018-01-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PI85903 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI85903]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI51991 UI51992
   
   

MODULES/MACROS
 *  DFHUSAD
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * FIXED COMPONENT ID
   5655Y0400
   
   

APPLICABLE COMPONENT LEVELS
 * R000 PSY UI51992 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI51992]
   UP17/12/05 P F712
   
   
 * R100 PSY UI51991 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI51991]
   UP17/11/22 P F711
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.