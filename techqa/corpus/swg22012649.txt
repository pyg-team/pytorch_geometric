Title: IBM Intermittent "Attempted to read or write protected memory ... System.AccessViolationException  ... InvokeDispMethod" error, using Data Entry or running a report, caused by Click-to-Run MS Office - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 User is inside Excel. User tries to use the Data Entry or Report functionality. 

Intermittently, an error appears. 

SYMPTOM
Example: 

(Inner Exception) 
Date and Time: 1/16/2018 9:25:43 AM 
Machine Name: PCNAME
IP Address: fe80:
Current User: DOMAIN\username 

Application Domain: C:\Program Files\IBM\IBM Cognos Controller Local Client\ 
Assembly Codebase: file:///C:/Windows/Microsoft.NET/Framework64/v4.0.30319/mscorlib.dll [file:///C:/Windows/Microsoft.NET/Framework64/v4.0.30319/mscorlib.dll] 
Assembly Full Name: mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089 
Assembly Version: 4.0.0.0 

Exception Source: mscorlib 
Exception Type: System.AccessViolationException 
Exception Message: Attempted to read or write protected memory. This is often an indication that other memory is corrupt. 
Exception Target Site: InvokeDispMethod 

---- Stack Trace ---- 
System.RuntimeType.InvokeDispMethod(name As String, invokeAttr As BindingFlags, target As Object, args As Object[], byrefModifiers As Boolean[], culture As Int32, namedParameters As String[]) 
mscorlib.dll: N 00000 (0x0) JIT 
System.RuntimeType.InvokeMember(name As String, bindingFlags As BindingFlags, binder As Binder, target As Object, providedArgs As Object[], modifiers As ParameterModifier[], culture As CultureInfo, namedParams As String[]) 
mscorlib.dll: N 0492 (0x1EC) IL 
Microsoft.VisualBasic.CompilerServices.VBBinder.InvokeMember(name As String, invokeAttr As BindingFlags, objType As Type, objIReflect As IReflect, target As Object, args As Object[], namedParameters As String[]) 
mscorlib.dll: N 0129 (0x81) IL 
Microsoft.VisualBasic.CompilerServices.LateBinding.InternalLateSet(o As Object, objType As Type&, name As String, args As Object[], paramnames As String[], OptimisticSet As Boolean, UseCallType As CallType) 
mscorlib.dll: N 0672 (0x2A0) IL 
Microsoft.VisualBasic.CompilerServices.NewLateBinding.LateSet(Instance As Object, Type As Type, MemberName As String, Arguments As Object[], ArgumentNames As String[], TypeArguments As Type[], OptimisticSet As Boolean, RValueBase As Boolean, CallType As CallType) 
mscorlib.dll: N 0083 (0x53) IL 
Cognos.Controller.ControllerForms12.clsDataEntry.ActivateStandardForm(bDataEntry As Boolean) 
mscorlib.dll: N 1781 (0x6F5) IL 
Cognos.Controller.ControllerForms12.clsDataEntry.ActivateDataEntryForm() 
mscorlib.dll: N 0452 (0x1C4) IL 
Cognos.Controller.ControllerForms12.clsDataEntry.OpenSelectedForm(UserSelection As UserParameters&, openType As OpenType) 
mscorlib.dll: N 0295 (0x127) IL 
Cognos.Controller.ControllerForms12.clsDataEntry.DoDataEntry() 
mscorlib.dll: N 0314 (0x13A) IL 
Controller.ExcelLink.AddinModule.btnDataEntry_OnClick(sender As Object, control As IRibbonControl, pressed As Boolean) 
mscorlib.dll: N 0017 (0x11) IL 
AddinExpress.MSO.ADXRibbonButton.DoInternalAction(e As ADXRibbonOnActionEventArgs) 
mscorlib.dll: N 0035 (0x23) IL 


CAUSE
Client device has unsupported type of Microsoft Office installed. 

 * Specifically, its MS Office was installed via 'click to run'.


More Information 
Modern Microsoft Office versions can be installed in two different ways: 
(1) Traditional method  * This is sometimes called the 'MSI' or 'Windows Installer' method 
 * It is also sometimes known as the 'Volume License' method 
 * The application is installed (and runs) natively/directly on the users client device 
 * This is supported for use with Controller.


(2) Click-to-run  * The user "streams" the portion of Office that they need (downloading extra portions as and when they need it). 
 * The software is running in an isolated 'Sandbox' environment ('virtual bubble') on the computer. 
 * This is currently unsupported for use with Controller.


For more information on the differences, see separate IBM Technote #1984103. 
ENVIRONMENT
Client PC has Microsoft Office 'click to run' (CTR) installed.



RESOLVING THE PROBLEM
Fix: 

Upgrade Controller to 10.3.1 (or later), which supports MS Office 'click to run'. 

 * Afterwards, ensure that MS Office is patched with the latest Microsoft patches.


Workaround: 
Uninstall Microsoft Office 'click to run' and re-install MS Office using the standard (MSI) type installation.  * TIP: For more information on the differences, see separate IBM Technote #1984103.

RELATED INFORMATION
 1984103 - Is Office 365 supported for Controller? [http://www.ibm.com/support/docview.wss?uid=swg21984103]