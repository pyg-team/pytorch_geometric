Title: IBM JR59553: SqlDataException for findUsersByPersonalizationId - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When submitting an order, the following error is seen:
   [5/14/18 9:27:31:653 CDT] 000000f5 RemoteExcepti E CNTR0019E:
   EJB threw an unexpected (non-declared) exception during
   invocation of method "findUsersByPersonalizationId". Exception
   data: com.ibm.ejs.persistence.EJSPersistenceException: find
   failed:; nested exception is:
   com.ibm.db2.jcc.am.SqlDataException: DB2 SQL Error:
   SQLCODE=-302, SQLSTATE=22001, SQLERRMC=null, DRIVER=4.19.49 at
   com.ibm.commerce.user.objects.EJSJDBCPersisterCMPUserBean_dca866
   44.findUsersByPersonalizationId(EJSJDBCPersisterCMPUserBean_dca8
   6644.java:704) at
   com.ibm.commerce.user.objects.EJSCMPUserHomeBean_dca86644.findUs
   ersByPersonalizationId(EJSCMPUserHomeBean_dca86644.java:175) at
   com.ibm.commerce.user.objects.EJSRemoteCMPUserHome_dca86644.find
   UsersByPersonalizationId(EJSRemoteCMPUserHome_dca86644.java:501)
    at
   com.ibm.commerce.user.objects._UserHome_Stub.findUsersByPersonal
   izationId(_UserHome_Stub.java:550) at
   com.ibm.commerce.user.objects.UserAccessBean.findUsersByPersonal
   izationId(UserAccessBean.java:1202) at
   com.ibm.commerce.member.internal.server.util.MemberAttributeHelp
   er.isMarketingTrackingOptIn(MemberAttributeHelper.java:209) at
   com.ibm.commerce.marketing.internal.runtime.persistence.TriggerH
   andlerPersistenceManager.createTriggerSender(TriggerHandlerPersi
   stenceManager.java:1500) at
   com.ibm.commerce.marketing.runtime.engine.TriggerHandler.registe
   rTriggerSender(TriggerHandler.java:238) at
   com.ibm.commerce.marketing.runtime.engine.TriggerHandler.forward
   Triggers(TriggerHandler.java:2256) at
   com.ibm.commerce.marketing.runtime.engine.TriggerHandler.raiseTr
   igger(TriggerHandler.java:1706) at
   com.ibm.commerce.marketing.facade.server.commands.ProcessMarketi
   ngTriggerSendActionCmdImpl.performExecute(ProcessMarketingTrigge
   rSendActionCmdImpl.java:68)
   
   After the error, we can see the following personalizationId was
   used which caused a problem:
   [5/14/18 9:27:31:653 CDT] 000000f5 MemberAttribu W There was an
   error while fetching marketing tracking consent for
   personalizationId: 1549635041590-1496MKT2018-05-14 09:28:25.325
   
   
    
   
   

LOCAL FIX
 *  Disable the marketing activities before applying the new fix.
   
   
    
   
   

PROBLEM SUMMARY
 *  USERS AFFECTED:
   WebSphere Commerce V8.0.4.12 or later, and WebSphere Commerce
   Version 7 customers who applied the JR59223 [http://www-01.ibm.com/support/docview.wss?uid=swg1JR59223] GDPR APAR.
   
   PROBLEM ABSTRACT:
   SqlDataException for findUsersByPersonalizationId
   
   BUSINESS IMPACT:
   Some dialog activities do not work as expected if you enable
   GDPR-related features. If you create marketing activities with
   the trigger "Customer Places Order", shoppers cannot complete
   the order.
   
   
   RECOMMENDATION:
   
   
    
   
   

PROBLEM CONCLUSION
 *  Added a processing logic to get the accurate personalization id.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   JR59553
   
   
 * REPORTED COMPONENT NAME
   WC BUS EDITION
   
   
 * REPORTED COMPONENT ID
   5724I3800
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   YesSpecatt / Pervasive / Xsystem
   
   
 * SUBMITTED DATE
   2018-05-15
   
   
 * CLOSED DATE
   2018-05-25
   
   
 * LAST MODIFIED DATE
   2018-05-25
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WC BUS EDITION
   
   
 * FIXED COMPONENT ID
   5724I3800
   
   

APPLICABLE COMPONENT LEVELS