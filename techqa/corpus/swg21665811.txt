Title: IBM Logging in to AppScan Enterprise from AppScan Source results in "Unable to process the database transaction" or "Database Connection" - United States

Text:
Oracle; LDAP; connection string; AppScan Source; AppScan Enterprise Server TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Logging in to IBM SecurityAppScan Enterprise from IBM Security AppScan Source in an environment configured to use ldap.ora instead of TNSNnames.ora. results in error "Unable to process the database transaction. Error: ORA-12154" or "Database Connection". 

CAUSE
Using an ldap.ora file to resolve the Oracle database connection alias, as opposed to the standard tnsnames.ora file that is commonly used, results in problems on both the AppScan Source and the AppScan Enterprise side of Oracle connections using LDAP: 

 1. AppScan Source can connect with an alias using ldap.ora to resolve it, but cannot connect with a full LDAP connection string.
    
    
 2. AppScan Enterprise can connect with a full LDAP connection string, but not with an alias using ldap.ora to resolve it.


This means that, using a full LDAP connection string, you can successfully register the AppScan Source database with AppScan Enterprise using the IBM Security AppScan Enterprise Server Database Configuration utility. This tool is <install_dir>\bin\appscanserverdbmgr.bat (where <install_dir> is the location of your AppScan Source installation - or <install_dir>/bin/appscanserverdbmgr.sh on Linux). 

However, when an AppScan Source client authenticates with AppScan Enterprise and receives back the full LDAP connection string, it cannot make the connection. 

If you try to register using an alias (using ldap.ora to resolve it), the registration fails because AppScan Enterprise cannot make the connection from the opposite direction. 
ENVIRONMENT
Using Oracle as the backend database for AppScan Source (using LDAP).



RESOLVING THE PROBLEM
To work around this behavior and be able to make an Oracle database connection using LDAP, complete these steps: 

 

 1. Before installing AppScan Source, perform these steps on the machine hosting the Appscan Enterprise Server:
    
    Windows  * Edit <AppScan Source>\bin\appscanserverdbmgr.bat. (where<AppScan Source> is the path where AppScan Source is installed. The default is C:\Program Files (x86)\IBM\AppScanSource). 
     * On the last line add -Doracle.net.tns_admin and set it to the location of ldap.ora. For example:
       
       %JAVA_EXE% -Dcom.ibm.jsse2.usefipsprovider=true -cp "%ALLJARS%" -Doracle.net.tns_admin=<path_to_ldap.ora> com.ibm.rational.appscansrc.appscanserverdbmgr.DBConfigurator %* 
     * Open a command prompt and change directory to<AppScan Enterprise>\JazzTeamServer\server\tomcat\bin and then run this command:
       
       Tomcat7w //ES//AppScanServerTomcat
       
       (where<AppScan Enterprise> is the path where AppScan Enterprise is installed. The default is C:\Program Files (x86)\IBM\AppScan Enterprise)
       
     * This opens the AppScan Enterprise Server â€“ Tomcat Properties dialog box.
       
     * Select the Java tab and then add the-Doracle.net.tns_admin option with the path to the ldap.ora file. For example:
       
       -Doracle.net.tns_admin=D:\oracle\product\11.2.0\NETWORK\ADMIN
       
     * Click the Apply button.
       
     * Navigate to <AppScan Enterprise>\JazzTeamServer\server\conf\asc and then open the asc.properties file in a text editor.
       
       NOTE: You may need to shut down the AppScan Enterprise Tomcat service in order to make changes.
       
     * On a new line, add core.db.oracle.jdbc.connection.string and set the value to be the full LDAP connection string. For example:
       
       core.db.oracle.jdbc.connection.string=ldap\://oid\:389/<SID>,cn\=OracleContext,dc\=pudding,dc\=com
       
       (where <SID> is the Oracle SID name)
       
     * Save the file and restart the AppScan Enterprise Tomcat service.
       
       
       Linux 
     * Edit <AppScan Source>/bin/appscanserverdbmgr.sh. (where<AppScan Source> is the path where AppScan Source is installed. The default is /opt/ibm/appscansource). 
     * On the last line add -Doracle.net.tns_admin and set it to the location of ldap.ora. For example:
       
       %JAVA_EXE% -Dcom.ibm.jsse2.usefipsprovider=true -cp "%ALLJARS%" -Doracle.net.tns_admin=<path_to_ldap.ora> com.ibm.rational.appscansrc.appscanserverdbmgr.DBConfigurator %*
       
       
     * Add Java options for <JazzTeamServer>/server/server.startup to enable Tomcat to locate theldap.ora file (where <JazzTeamServer> is the install directory for the Jazz Server and Tomcat instance). For example:
       
       Add:
       JAVA_OPTS="$JAVA_OPTS -Doracle.net.tns_admin=<ORACLE_HOME>/network/admin"
       (where <ORACLE_HOME> is the path to the Oracle home directory). For example:
       
       if [ `uname` = Darwin ];
       then
       JRE_HOME=/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home
       JAVA_OPTS="$JAVA_OPTS -Djazz.connector.sslProtocol=TLS" JAVA_OPTS="$JAVA_OPTS -Djazz.connector.algorithm=SunX509"
       else
       JRE_HOME=`pwd`/jre
       JAVA_OPTS="$JAVA_OPTS -Djazz.connector.sslProtocol=SSL_TLS"
       JAVA_OPTS="$JAVA_OPTS -Djazz.connector.algorithm=IbmX509"
       JAVA_OPTS="$JAVA_OPTS -Doracle.net.tns_admin=/u01/app/oracle/product/11.2.0/dbhome_1/network/admin"
       fi
       
     * Save <JazzTeamServer>/server/server.startup and restart the tomcat daemon.
       /etc/init.d/ase_tomcat restart
       
       NOTE: If connection fails, try restarting the daemon again and verify that you can log in to JazzTeamServer via a browser.
       
     * Navigate to <AppScan Enterprise>/JazzTeamServer/server/conf/asc and then open the asc.properties file in a text editor.
       
       NOTE: You may need to shut down the AppScan Enterprise Tomcat daemon in order to make changes.
       
     * On a new line, add core.db.oracle.jdbc.connection.string and set the value to be the full LDAP connection string. For example:
       
       core.db.oracle.jdbc.connection.string=ldap\://oid\:389/<SID>,cn\=OracleContext,dc\=pudding,dc\=com
       
       (where <SID> is the Oracle SID value)
       
     * Save the file and restart the AppScan Enterprise Tomcat daemon.
       
       
       
    
    
 2. Install AppScan Source and, on the "IBM Security AppScan Enterprise Server Configuration" panel, deselect the Configure the AppScan Enterprise Server now check box and complete the installation.
    
    
    
 3. Copy theldap.ora file to the <AppScan Source>\bin directory.
    
    
    
 4. Open a command prompt to run appscanserverdbmgr.bat (or appscanserverdbmgr.sh on Linux) to register and configure the AppScan Source database with AppScan Enterprise. For example:
    
    appscanserverdbmgr.bat -s https://<fully qualified hostname>:9443/asc-u <username> -p <password> -dbClient 2 -dbUserid <db_user> -dbPassword <db_password> -dbConnString ldap://oid:389/<SID>,cn=OracleContext,dc=pudding,dc=com
    
    If successful, you should get this output:
    
    Successfully logged in to AppScan Server.
    The database information was successfully configured in the AppScan Enterprise server.
    
    
    
 5. If you log in to AppScan Source at this stage, you will receive an error since AppScan Source cannot connect with the full LDAP connection string. AppScan Source is expecting an alias instead, so you will need to change this on the AppScan Enterprise side so that the alias can be passed back to AppScan Source for the connection to succeed.
    
    Perform these steps:
     * Navigate to <AppScan Enterprise>\JazzTeamServer\server\conf\asc and then open the asc.properties file in a text editor.
       
       NOTE: Again, you may need to shut down the AppScan Enterprise Tomcat service in order to make changes.
       
     * In the asc.properties file, change the core.db.connection.string from the full LDAP connection string to just the alias:
       
       core.db.connection.string= ldap://oid:389/<SID>,cn=OracleContext,dc=pudding,dc=com
       
       to
       
       core.db.connection.string= <SID>
       
     * Save the changes and start/restart the AppScan Enterprise Tomcat service/daemon.
       
       
       
    
    
 6. AppScan Source should now be able to log in.