Title: IBM Troubleshooting: OnDemand search performance problems on DB2 - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This is a troubleshooting guide for IBM® Content Manager OnDemand search performance problems, focusing on troubleshooting a search performance problem against a single folder or query in OnDemand running on a DB2® database. 

RESOLVING THE PROBLEM
 

TAB NAVIGATION
 * Troubleshooting- selected tab,
 * Collecting data [http://www.ibm.com/support/docview.wss?uid=swg21432789]




OnDemand is heavily dependent on the database management system in regards to search performance, so it is important to ensure your system and database have been tuned and optimized to meet your performance requirements. 

Note: If the overall OnDemand server is slow, review the OnDemand TechNote [http://www-01.ibm.com/support/docview.wss?rs=0&uid=swg21318327] regarding an accumulation of arssockd processes or threads and collect data for an OnDemand server Hang/Performance Degradation [http://www-01.ibm.com/support/docview.wss?rs=0&uid=swg21410001] issue instead. 

Inspect the OnDemand configuration 
When a search performance problem occurs, OnDemand must be investigated first. Ensure the following: 

 1. Display Document Location is disabled in the folder. Enabling this option has a significant performance impact, as a query is sent to OnDemand storage for each document hit in the hit list. 
    
    
 2. Catalog statistics are up to date for each application group in the folder by running arsmaint -r or runstats. The DB2 optimizer uses the catalog tables to obtain information about the database, table data, and other characteristics to choose the best way to access data. If statistics are not available or up to date, the optimizer might choose an inefficient access plan.
    
    
 3. An application group Segment date field is mapped to a folder field and being used in the search. The Segment field is used by an application group to maintain the minimum and maximum date range per table. This allows OnDemand to query only the tables that contain the relevant date range in the search. Minimizing the number of tables to query will significantly improve search performance in large application groups. 
    
    
 4. A server based full text search is not being issued. During a full text search, each document that matches your search criteria is retrieved and then sequentially searched for the text in question before presenting a document hit list back to the client. These operations occur on the server and will incur a performance hit on the server depending on the amount of documents that will be full text searched. 
    
    
 5. Relevant application group database indexes have been created. Index information allows the DB2 optimizer to choose the best access plan to access data. OnDemand supports defining individual, composite, and cluster indexes.
    
    An index should be defined on one or more database fields that offer the highest cardinality and relevance in a search operation. For example, a field that contains date values is typically used in a search, but usually does not have a high cardinality, and therefore should not be indexed.
    
    DB2 Design Advisor [http://publib.boulder.ibm.com/infocenter/db2luw/v9/topic/com.ibm.db2.udb.admin.doc/doc/c0005144.htm] is a utility that provides index recommendations based on a given SQL query. You can create indexes in OnDemand through the OnDemand Administrator client.


Note: Most SQL statements issued by OnDemand consist of simple and repeated SQL. To increase performance, OnDemand utilizes parameter markers. Parameter markers allow the same repeated SQL statement to be prepared only once, and then executed many times, instead of preparing each SQL statement. This comes at a cost though. When using parameter markers, DB2 must create an access plan without the literal values that will be used in the query, therefore DB2 cannot take advantage of distribution statistics collected and must assume uniform distribution of table values. This means skewed table data could result in a poor access plan. 

The REOPT parameter can be enabled in DB2 to force SQL containing parameter markers to be prepared when the statement is executed, allowing the optimizer to create an access plan based on the literal values and distribution statistics. This bypasses the benefit of using parameter markers in hopes that a better access plan will be generated by the DB2 optimizer. There are two REOPT settings: REOPT ONCE determines the access plan when the query is first executed, allowing the plan to be cached and used for subsequent execution and REOPT ALWAYS informs DB2 to always compile and re-optimize using the literal values at every execution, bypassing dynamic statement caching. 

In a properly tuned and configured OnDemand and DB2 environment, REOPT should not be used. 

Inspect the DB2 configuration 
If the search performance problem persists after inspecting OnDemand, DB2 must be investigated. 

 1. Use DB2's Snapshot monitor or enable DB2 CLI trace to identify the slow SQL statement from OnDemand. 
    
    
 2. Follow the instructions in DB2 UDB performance tuning scenarios: Part 1, DB2 UDB OLTP tuning illustrated with a Java program [http://www.ibm.com/developerworks/data/library/techarticle/dm-0508chong/] to tune the following DB2 parameters for the slow SQL statement:  * Buffer pools 
     * Asynchronous page cleaners and I/O servers 
     * Sorts 
     * Log buffer size 
     * Group commit statements
       
       
    
    
 3. Run the reorgchk command to determine if the indexes and table(s) involved in the slow SQL statement need to be reorganized. 
    
    
 4. Analyze the access plan using the DB2 SQL explain utility. Identify which point the most time is spent running the SQL statement and whether new indexes may help improve the access plan.
    
    
 5. Review Chapter 6.2.3, "Tuning OnDemand to enhance performance", in the Content Manager OnDemand Guide [http://www.redbooks.ibm.com/abstracts/sg246915.html] for further DB2 parameters that affect OnDemand performance.


What next? 
If you require IBM assistance in performance optimization and tuning after following these steps, contact your IBM Services team. Performance optimization and tuning is outside the realm of defect support, but if a defect is suspected, contact IBM Support. RELATED INFORMATION
 Part 1 DB2 UDB OLTP tuning [http://www.ibm.com/developerworks/data/library/techarticle/dm-0508chong/]
DB2 Tuning Tips for OLTP Applications [http://www.ibm.com/developerworks/data/library/techarticle/anshum/0107anshum.html]
Best Practices Tuning Monitoring DB2 System Performance [http://www.ibm.com/developerworks/data/bestpractices/systemperformance/]
Best practices for tuning DB2 UDB v8.1 and its database [http://www.ibm.com/developerworks/data/library/techarticle/dm-0404mcarthur/]
Distribution statistics uses with the DB2 optimizer [http://www.ibm.com/developerworks/data/library/techarticle/dm-0606fechner/index.html]
Content Manager OnDemand Guide [http://www.redbooks.ibm.com/abstracts/sg246915.html]
How to enable DB2 CLI trace [http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/topic/com.ibm.db2.luw.admin.trb.doc/doc/c0020795.html]