Title: IBM PK82739: WPS ON Z/OS 6.0.2.4 REMOTE ARTIFACT LOADER INITIALIZATION ISSUE - United States

Text:
z/os SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  After applying the actions that will be addressed with PK81982 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81982]
   customer is seeing Remote Artifact Loader initialization
   problems.
   
   This is the entry
   
   Error message: BBOO0220E: SRVE0068E: Could not invoke the
   service() method on servlet RALServerServlet.
   Exception thrown : java.lang.NullPointerException
   Followed by:
   Trace: XXXX/XX/XX 14:20:42.799 01 t=8BB828 c=4.1 key=P8
   (13007002)
      ThreadId: 00000088
      FunctionName: queryApp(String)
      SourceId: ArtifactLoader
      Category: WARNING
   ExtendedMessage: CWLAG0302E: Remote artifactloader can not query
   the application <App>.
   The error is java.io.IOException: Server returned HTTP response
   code: 500 for URL:
   http://<server>:<port>/RemoteALWeb/QueryServlet?appName=<App> [http://<server>:<port>/RemoteALWeb/QueryServlet?appName=<App>]
   
   
   Root Cause:
   
   This is a timing issue. RAL is calling the function
   'getDmgrAdminClient' in the SERVANT. To give a valid result back
   the SERVANT needs to have discovered it's node agent process on
   the system indicating in the JOBLOG with this line.
   
   ****************************************************************
   (alcontrol.log) Trace: XXXX/XX/XX 18:41:08.715 01 t=9BC560 c=UNK
   key=P2
   (13007002)
      ThreadId: 0000005f
      FunctionName: com.ibm.ws.management.discovery.DiscoveryMBean
      SourceId: com.ibm.ws.management.discovery.DiscoveryMBean
      Category: INFO
      ExtendedMessage: BBOO0222I: ADMD0023I: The system discovered
   process
   (name: nodeagent, type: NodeAgent, pid: 000009f400000003)
   ****************************************************************
   
   RAL is doing the call before this discovery. That's why it's
   receiving a NullPointer Exception.
   
   This timing issue is addressed by the fix.
   
   
    
   
   

LOCAL FIX
 *  n/a
   
   
    
   
   

PROBLEM SUMMARY
 *  Users Affected
   ==============
   User of WebSphere Process Server V6204 on z/OS
   
   
   
   Problem Description:
   ********************
   
   The context of the problem is that we tried a temporary
   workaround to
   the slow server problem reported in 25870,010,678.
   The workaround was to remove the <was_hom>/profiles/default
   directory
   from the ws.ext.dirs classpath.
   That workaround fixed the slow startup problem because when
   ../profiles/default is in the ws.ext.dirs, WAS goes looking
   through
   the entire contents of ..profiles/default loading artifacts.
   This processing takes several hours because of the large number
   of
   applications in the ..profiles/default/installedApps directory.
   
   After removing the ..profiles/default from the ws.ext.dirs
   classpath,
   this new problem with Remote Artifact Loader (RemoteAL) showed
   up.
   Now RemoteAL is being called when the application is executed
   but
   RALServerServlet failing with an NPE.
   We suspect that when ..profiles/default was in the ws.ext.dirs
   classpath it was acting as a kind of global shared library
   so all applications had access to any artifact in any other
   application installed in the node.
   When ..profiles/default is not in the ws.ext.dirs it looks like
   WPS
   calls RemoteAL to locate artifacts in another application but
   RemoteAL
   is failing with the NPE.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Problem Solution:
   *****************
   
   We came to conclusion that there is a timing issue.
   I.e  ConnectorNotAvailableException is occurred before the
   nodeagent
   has discovered the Dmgr.
   
   
   Here there is a problem that dmgr is unavailable.
   
   Trace: 2009/03/10 17:23:42.642 01 t=9FF028 c=UNK key=S2
   (13007002)
      ThreadId: 0000000a
      FunctionName: ConfigHelper
      SourceId: ArtifactLoader
      Category: FINER
      ExtendedMessage: Caught exception, use Repository service
   instead.com.ibm.websphere.management.exception.AdminException:
   com.ibm.w
    ebsphere.management.exception.ConnectorNotAvailableException
     at
   com.ibm.ws.management.AdminServiceImpl.getDeploymentManagerAdmin
   Client(A
   dminServiceImpl.java:1453)
     at
   com.ibm.ws.al.util.ConfigHelper$2.run(ConfigHelper.java:192)
     at java.security.AccessController.doPrivileged1(Native Method)
     at
   java.security.AccessController.doPrivileged(AccessController.jav
   a(Compil
   ed Code))
     at
   com.ibm.ws.al.util.ConfigHelper.<init>(ConfigHelper.java:190)
     at
   com.ibm.ws.ral.RALServerComponent.start(RALServerComponent.java:
   86)
     at
   com.ibm.ws.runtime.component.ContainerImpl.startComponents(Conta
   inerImpl
   .java:820)
     at
   com.ibm.ws.runtime.component.ContainerImpl.start(ContainerImpl.j
   ava:649)
     at
   com.ibm.ws.runtime.component.ServerImpl.start(ServerImpl.java:44
   4)
     at
   com.ibm.ws.runtime.WsServerImpl.bootServerContainer(WsServerImpl
   .java:18
   7)
     at
   com.ibm.ws.runtime.WsServerImpl.start(WsServerImpl.java:133)
     at com.ibm.ws.runtime.WsServerImpl.main(WsServerImpl.java:387)
     at com.ibm.ws.runtime.WsServer.main(WsServer.java:53)
     at com.ibm.ws390.orb.CommonBridge.WsServerStartup(Unknown
   Source)
     at com.ibm.ws390.orb.ControlRegionBridge.initCSI(Unknown
   Source)
     at
   com.ibm.ws390.orb.ORBEJSBridge.initCSI(ORBEJSBridge.java:256)
    Caused by:
   com.ibm.websphere.management.exception.ConnectorNotAvailableExce
   ption
     at
   com.ibm.ws.management.discovery.Utils.getParentAdminClient(Utils
   .java:14
   5)
     at
   com.ibm.ws.management.discovery.Utils.getDmgrAdminClient(Utils.j
   ava:89)
     at
   com.ibm.ws.management.AdminServiceImpl.getDeploymentManagerAdmin
   Client(A
   dminServiceImpl.java:1450)
   
   Here only nodeagent discovered dmgr.
   
   Trace: 2009/03/10 17:23:48.067 01 t=9B9BE0 c=UNK key=P2
   (13007002)
      ThreadId: 00000022
      FunctionName: com.ibm.ws.management.discovery.DiscoveryMBean
      SourceId: com.ibm.ws.management.discovery.DiscoveryMBean
      Category: INFO
      ExtendedMessage: BBOO0222I: ADMD0023I: The system discovered
   process
   (name: dmgr, type: DeploymentManager, pid: 000009c800000001)
   
   Finally, it looks like WPS team gave a patch to make sure,
   RALServerComponent's starting steps are executed after the
   server has
   started, and thus after Discovery MBean has finished its task.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK82739
   
   
 * REPORTED COMPONENT NAME
   WEB PROC SRVR F
   
   
 * REPORTED COMPONENT ID
   5655N5300
   
   
 * REPORTED RELEASE
   610
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-03-17
   
   
 * CLOSED DATE
   2009-05-14
   
   
 * LAST MODIFIED DATE
   2009-05-14
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    JR32394
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEB PROC SRVR F
   
   
 * FIXED COMPONENT ID
   5655N5300
   
   

APPLICABLE COMPONENT LEVELS
 * R602 PSY
   UP