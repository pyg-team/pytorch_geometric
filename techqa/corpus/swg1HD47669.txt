Title: IBM HD47669: MEMORY MANAGEMENT ON FILE UPLOAD IN CMT - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  ST R13 SP8 HF6
   Scenario:
   Customer is facing a problem with Memory
   consumption during the
   upload operation in Community Workspace. In
   fact the would
   like to share large zip files within CMT (up to 1GB).
   We noticed
   that they usually have Out Of Memory Exception
   during the
   operation with large files (400, 500MB or more) but
   sometimes
   they also have it with smaller files (100 or 200MB).
   customer description:
   I have seen this error coming on larger filesizes -
   this time it
   was 192Mb file but I have seen it coming with 100
   Mb file sizes,
   too. What is memory need for Community
   Workspace when is
   in this kind of use (several users, large files).
   Error in Community Workspace: Exception of type
   System.OutOfMemoryException was thrown.
   Description: An unhandled exception occurred
   during the
   execution of the current web request. Please
   review the stack
   trace for more information about the error and
   where it
   originated in the code.
   Exception Details: System.OutOfMemoryException:
   Exception
   of type System.OutOfMemoryException was
   thrown.
   Source Error: An unhandled exception was
   generated during
   the execution of the current web request.
   Information
   regarding the origin and location of the exception
   can be
   identified using the exception stack trace below.
   Stack Trace:&#65462;&#65448;OutOfMemoryException: Exception
   of type
   System.OutOfMemoryException was thrown.!
   Version Information: Microsoft .NET Framework
   Version:1.1.4322.573; ASP.NET
   Version:1.1.4322.947
   DS study of the issue
   DS first answer was to make a tuning of the
   server :
   maxRequestLenth in web.config, processModel in
   the
   machine.config, /3GB option in windows in order to
   allocate
   more memory to the ASP.NET process.
   In Parallel, we did some tests and researches on
   my installation
   and, I have noticed when debbuging CMT code that
   the
   increase of memory happens before the
   SMARTEAM code is
   called. When looking on the internet we found a
   Microsoft
   article that explains that during the upload the file
   is put
   entierly in memory before it can be accessed by
   the application
   code.
   http://support.microsoft.com/default.aspx?
   scid=kb;en- [http://support.microsoft.com/default.aspx?scid=kb;en-]
   us;295626
   During analysis DS found that there is a specific
   key in the
   web.config of CMT (commented by default) :
   So we tested to change this key to a value of a
   blank asp page
   I created :
   value="/mySmarTeam/CustomUpload/CustomUploa
   d.aspx"/>
   And CMT is redirecting to my page, and even with
   no code
   (uploade not treated) the memory increases in the
   same size
   as the uploaded file due to the fact that MS loads
   all the contect
   of the POST into memory.
   .
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  Memory Management on File upload in CMT
   ST R13 SP8 HF6
   Scenario:
   Customer is facing a problem with Memory
   consumption during the
   upload opreration in Community Workspace. In
   fact the would
   like to share large zip files within CMT (up to 1GB).
   We noticed
   that they usually have Out Of Memory Exception
   during the
   operation with large files (400, 500MB or more) but
   sometimes
   they also have it with smaller files (100 or 200MB).
   Customer description:
   I have seen this error coming on larger filesizes -
   this time it
   was 192Mb file but I have seen it coming with 100
   Mb file sizes,
   too. What is memory need for Community
   Workspace when is
   in this kind of use (several users, large files).
   Error in Community Workspace: Exception of type
   System.OutOfMemoryException was thrown.
   Description: An unhandled exception occurred
   during the
   execution of the current web request. Please
   review the stack
   trace for more information about the error and
   where it
   originated in the code.
   Exception Details: System.OutOfMemoryException:
   Exception
   of type System.OutOfMemoryException was
   thrown.
   Source Error: An unhandled exception was
   generated during
   the execution of the current web request.
   Information
   regarding the origin and location of the exception
   can be
   identified using the exception stack trace below.
   Stack Trace:  OutOfMemoryException: Exception
   of type
   System.OutOfMemoryException was thrown.!
   Version Information: Microsoft .NET Framework
   Version:1.1.4322.573; ASP.NET
   Version:1.1.4322.947
   DS study of the issue
   DS first answer was to make a tuning of the
   server :
   maxRequestLenth in web.config, processModel in
   the
   machine.config, /3GB option in windows in order to
   allocate
   more memory to the ASP.NET process.
   In Parallel, we did some tests and researches on
   my installation
   and, I have noticed when debbuging CMT code that
   the
   increase of memory happens before the
   SMARTEAM code is
   called. When looking on the internet we found a
   Microsoft
   article that explains that during the upload the file
   is put
   entierly in memory before it can be accessed by
   the application
   code.
   http://support.microsoft.com/default.aspx?
   scid=kb;en- [http://support.microsoft.com/default.aspx?scid=kb;en-]
   us;295626
   During analysis DS found that there is a specific
   key in the
   web.config of CMT (commented by default) :
   So we tested to change this key to a value of a
   blank asp page
   I created :
   value="/mySmarTeam/CustomUpload/CustomUploa
   d.aspx"/>
   And CMT is redirecting to my page, and even with
   no code
   (uploade not treated) the memory increases in the
   same size
   as the uploaded file due to the fact that MS loads
   all the contect
   of the POST into memory.
   .
   
   
    
   
   

PROBLEM CONCLUSION
 *  THIS PROBLEM WILL BE FIXED ON SMARTEAM
   VERSION 5 RELEASE 17 GA level.
   NOTE THAT THIS PROBLEM WILL ALSO BE FIXED
   ON V5R14SP09 AND V5R16SP04.
   .
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   HD47669
   
   
 * REPORTED COMPONENT NAME
   SMARTEAM NT>XP
   
   
 * REPORTED COMPONENT ID
   569199970
   
   
 * REPORTED RELEASE
   513
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2005-12-14
   
   
 * CLOSED DATE
   2006-03-23
   
   
 * LAST MODIFIED DATE
   2009-06-24
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   SMARTEAM NT>XP
   
   
 * FIXED COMPONENT ID
   569199970
   
   

APPLICABLE COMPONENT LEVELS
 * 514 
   
   
   
 * R514 PSN SP51409
   UP06/04/06 N 1000
   
   
 * R515 PSN
   UP
   
   
 * R516 PSN SP51604
   UP06/04/11 I 1000