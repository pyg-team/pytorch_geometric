Title: IBM IT08610: WMQ V7.5 CLASSES FOR JMS: MQ AMS FAIL TO OBTAIN THE SECURITY POLICY WITH MQRC 6114. - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When using the WebSphere MQ v7.5 classes for JMS or classes for
   Java to connect to an IBM MQ v8 queue manager that has the
   Advanced Message Security component installed, opening a queue
   on a queue manager results in the following exception being
   thrown to the application:
   
   MQJE001: Completion Code '2', Reason '6114'.
   com.ibm.msg.client.jms.DetailedJMSException: JMSWMQ2008: Failed
   to open MQ queue 'QUEUE1'.
   JMS attempted to perform an MQOPEN, but WebSphere MQ reported an
   error.
   Use the linked exception to determine the cause of this error.
   Check that the specified queue and queue manager are defined
   correctly.
   at
   com.ibm.msg.client.wmq.common.internal.Reason.reasonToException(
   Reason.java:585)
   at
   com.ibm.msg.client.wmq.common.internal.Reason.createException(Re
   ason.java:221)
   at
   com.ibm.msg.client.wmq.internal.WMQMessageConsumer.checkJmqiCall
   Success(WMQMessageConsumer.java:129)
   at
   com.ibm.msg.client.wmq.internal.WMQConsumerShadow.initialize(WMQ
   ConsumerShadow.java:988)
   at
   com.ibm.msg.client.wmq.internal.WMQSyncConsumerShadow.initialize
   (WMQSyncConsumerShadow.java:139)
   at
   com.ibm.msg.client.wmq.internal.WMQMessageConsumer.(WMQMessageCo
   nsumer.java:257)
   ...
   Caused by: com.ibm.mq.MQException: JMSCMQ0001: WebSphere MQ call
   failed with compcode '2' ('MQCC_FAILED') reason '6114'
   ('MQRC_INSUFFICIENT_DATA').
   at
   com.ibm.msg.client.wmq.common.internal.Reason.createException(Re
   ason.java:209)
   ... 9 more
   Caused by: com.ibm.mq.jmqi.JmqiException: CC=2;RC=6114
   at
   com.ibm.mq.ese.intercept.JmqiOpenInterceptorImpl.processExceptio
   nAfterOpen(JmqiOpenInterceptorImpl.java:712)
   at
   com.ibm.mq.ese.intercept.JmqiOpenInterceptorImpl.afterSpiOpen(Jm
   qiOpenInterceptorImpl.java:212)
   at
   com.ibm.mq.ese.jmqi.InterceptedJmqiImpl.spiOpen(InterceptedJmqiI
   mpl.java:411)
   at com.ibm.mq.ese.jmqi.ESEJMQI.spiOpen(ESEJMQI.java:513)
   at
   com.ibm.msg.client.wmq.internal.WMQConsumerShadow.initialize(WMQ
   ConsumerShadow.java:961)
   ... 7 more
   Caused by: The IBM WebSphere MQ Advanced Message Security Java
   interceptor failed to obtain the security policy. Reason Code:
   '6114'
   The IBM WebSphere MQ Advanced Message Security Java interceptor
   was not able to obtain the security policy.
   See subsequent messages in the exception for more details about
   the cause of the error.
   at
   com.ibm.mq.ese.service.PolicyServiceImpl.failedToObtainPolicyExc
   eption(PolicyServiceImpl.java:407)
   at
   com.ibm.mq.ese.service.PolicyServiceImpl.policyFromPcf(PolicySer
   viceImpl.java:613)
   ...
   Caused by: com.ibm.mq.headers.MQDataException: MQJE001:
   Completion Code '2', Reason '6114'.
   at
   com.ibm.mq.headers.MQDataException.getMQDataException(MQDataExce
   ption.java:314)
   at com.ibm.mq.headers.internal.Header.read(Header.java:620)
   at com.ibm.mq.headers.pcf.MQCFST.(MQCFST.java:138)
   at
   com.ibm.mq.headers.pcf.PCFParameter.nextParameter(PCFParameter.j
   ava:73)
   ...
   Caused by: java.io.EOFException
   at java.io.DataInputStream.readFully(DataInputStream.java:209)
   at
   com.ibm.mq.headers.internal.DataInputWrapper.readFully(MessageWr
   apper.java:247)
   at
   com.ibm.mq.headers.internal.store.ByteStore.readFrom(ByteStore.j
   ava:303)
   ...
   
   
   The above exception would be thrown even when the queue that the
   application attempted to open is not AMS protected.
   
   
    
   
   

LOCAL FIX
 *  1. Use IBM MQ V8 classes for JMS/Java
   
   2. Use WMQ V7.5.0.4 classes for JMS, then disable the AMS
   function.  Please refer to following page in the Knowledge
   Center that describes how to do this:
   
   https://www.ibm.com/support/knowledgecenter/SSFKSJ_7.5.0/com.ibm
   .mq.sec.doc/q127080_.htm#q127080 [https://www.ibm.com/support/knowledgecenter/SSFKSJ_7.5.0/com.ibm.mq.sec.doc/q127080_.htm#q127080]
   
   3. Remove the AMS component from the queue manager installation
   if this is not required by the connecting applications.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects all users of the:
   
     - WebSphere MQ v7.5 classes for JMS
     - WebSphere MQ v7.5 classes for Java
   
   who run their applications in a JVM with a file encoding scheme
   which does not guarantee a one-to-one mapping of byte to String
   conversion. An example of such a file encoding scheme is UTF-8,
   where a single character may be represented by one or more
   bytes, as opposed to Cp1252 where each character is represented
   by exactly one byte.
   
   It is also required that the queue manager installation includes
   the Advanced Message Security (AMS) component, although it does
   not need to be in active use.
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   Advanced Message Security (AMS) capability is included in the
   WebSphere MQ v7.5 (and later) classes for JMS and classes for
   Java. As such, when an application using this version of the
   Java client attempts to open a queue on a queue manager, a check
   is made to determine whether an AMS policy has been defined for
   that queue.
   
   The WebSphere MQ v7.5 classes for JMS client was incorrectly
   treating the policy information it received from the queue
   manager as character data and internally constructed a
   "java.lang.String" object from the received data bytes. When
   this data was subsequently parsed to determine whether a policy
   existed on the queue, the "java.lang.String" object was
   converted back into a sequence of bytes.
   
   Due to the use of the JVM's default character encoding (which
   varies by platform), during this byte to string and back to byte
   conversion, the final byte sequence was not necessarily the same
   as the bytes which were returned by the queue manager.
   
   For example, the byte '0x80' can be returned as part of the byte
   sequence when a policy for a queue does not exist. When using
   UTF-8 as the default JVM charset, such is the case on the Linux
   platform, performing the conversion operations described above
   can result in this byte being replaced by the sequence of bytes,
   '0xEF', '0xBF' and '0xBD', resulting in being two bytes longer
   than the original byte sequence.
   
   This results in a failure to parse the byte sequence as the
   length is not as expected, resulting in the MQRC 6114
   'MQRC_INSUFFICIENT_DATA' exception code.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The WebSphere MQ v7.5 classes for JMS and classes for Java have
   been updated such that the byte sequence that describes Advanced
   Message Security (AMS) policy information for a particular queue
   is stored internally as a byte sequence, and not converted to a
   Java String.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v7.5       7.5.0.6
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT08610
   
   
 * REPORTED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * REPORTED COMPONENT ID
   5724H7241
   
   
 * REPORTED RELEASE
   750
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2015-04-28
   
   
 * CLOSED DATE
   2015-08-28
   
   
 * LAST MODIFIED DATE
   2018-02-06
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * FIXED COMPONENT ID
   5724H7241
   
   

APPLICABLE COMPONENT LEVELS