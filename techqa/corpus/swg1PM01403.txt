Title: IBM PM01403: WMQ V7: ABEND0C4 - 04 IN CSQL1GET (BASE) + X'1760' - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  CSQL1GET gets the ABEND trying to access LNMR previous entry in
   the lock name chain.
   .
   This problem is limited to MQ systems that use IMS OTMA.
   However, the loop in SRB mode described below can impact the
   performance of the rest of the system, including the coupling
   facility ( CF / XCF ).
   *
   ADDITIONAL SYMPTOMS:
   ABEND0C4 in CSQLGETL+x'954' (CSQLLPLM+1AF4).  The failing
   instruction is E380 2038 0024.  The opcode is STG, which is
   a 64-bit instruction.
   .
   ABEND0C4 in CSECT CSQLGETL+x'D68', Load Module CSQLLPLM+x'1F08'
   or other nearby offsets.
   .
   CSQV086E QUEUE MANAGER ABNORMAL TERMINATION REASON=00E50705
   .
   ABN=0C4-00000004,,C=R3600.700.LOCK-CSQL1GET,M=CSQGFRCV,
   LOC=CSQLLPLM.CSQL1GET+12DA
   .
   ABN=0C4-00000004, LOCK-CSQL1REL,M=CSQGFRCV,LOC=CSQLLPLM.CSQL1REL
   LOC=CSQLLPLM.CSQL1REL +0FF6
   .
   ABN=0C4-00000004,U=SYSOPR,C=R3600.700.LOCK-CSQL1RST,
   M=CSQGFRCV,LOC=CSQLLPLM.CSQL1RST+0732
   .
   ABN=0C4-00000010,C=R3600.700.LOCK-CSQL1GET,
   M=CSQGFRCV,LOC=CSQLLPLM.CSQL1GET+1B20
   .
   ABEND5C6-00E7014F
   .
   Spin loop in load module CSQLLPLM, CSECT CSQL1RST + x'72E'
   or in CSQL1SVT
   LOGREC has ABEND071 EXCESSIVE SPIN DETECTED
   ABENDS071 S071 S0071
   .
   If the queue manager can not be cancelled or forced, an IPL
   will be needed to stop the loop.
   
   
    
   
   

LOCAL FIX
 *  ++APAR AM01403 is available for WMQ 7.0.0 and 7.0.1 from the
   suppoert center. Only apply it to MQ systems that use IMS OTMA,
   because there is a small CPU and storage increase.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere MQ for z/OS Version 7 *
   *                 Release 0 Modification 0 & Modification 1    *
   ****************************************************************
   * PROBLEM DESCRIPTION: Abend0C4s in modules CSQL1GET,CSQL1REL, *
   *                      CSQLGETL,CSQLRELL,CSQL1RST,CSQLRSTL or  *
   *                      a CPU loop in MODULES CSQL1RST,CSQLRSTL *
   *                      when processing IMS OTMA InDoubt        *
   *                      transactions after a transaction Abend  *
   *                      or Abend of the IMS address space       *
   *                      (including a CANCEL of IMS).            *
   *                      These Abends may cause QMGR termination *
   *                      and the loop which occurs in SRB mode   *
   *                      can impact the performance of other     *
   *                      processes running in the LPAR such that *
   *                      an IPL of the LPAR may be necessary.    *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   MQ version 700 and above introduced preallocated LNMR blocks
   which are part of the storage allocated to the LOWN. The MQ
   OTMA save/restore lock routines used when processing InDoubt
   OTMA threads which move lock chains to/from a 'saved' InDoubt
   LOWN block take no account of the fact that the lnmrs in the
   thread and request lock chains (and also the lnan's lnmr chain)
   can exist in the preallocated area within the LOWN that will
   be freed by thread deallocation when the InDoubt thread is
   terminated.This leaves freed lnmrs in the lock chains.
   Subsequently allocation for a different thread can get the
   same LOWN address and will initialize the preallocated lnmrs
   some of which may still be in the lock chains for the 'saved'
   InDoubt thread's LOWN. When the InDoubt thread resumes, the
   lock chains containing those lnmrs are restored to the LOWN
   for the newly initialized InDoubt OTMA thread. The chain ptrs
   in those 'preallocated' lnmrs will contain bad pointers which
   when attempts are made to free those locks or indeed a request
   to get a lock on the same 'name' by ANY other thread can result
   in Abend0C4s when manipulating the chains.
   In addition other Abend0C4s or a loop can occur in modules
   CSQL1RST or CSQLRSTL due to an incorrect migration of the V600
   Apar PK30876 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK30876] after an MQ MSTR restart if InDoubt OTMA threads
   exist.
   
   
    
   
   

PROBLEM CONCLUSION
 *  CSQL1SVT (CSQLSVTL at V701) now obtains and initializes a new
   Lown, Moves the current thread Lown to the InDoubt chain, and
   replaces the RALE RALERMUS Lown pointer with the new (empty)
   Lown.
   CSQL1RST (CSQLRSTL at V701) now just moves the saved Lown from
   the InDoubt chain to the RALE RALERMUS Lown pointer and frees
   the old thread Lown.
   CSQL1SLK (CSQLSLKO at V701) has been changed to properly
   initialize the request lock chain and the preallocated (cache)
   LNMRs.
   CSQL1GET (CSQLGETL at V700) is shipped with this Apar in
   unmodified form to replace that shipped with previous ++APARs
   000Y
   010Y
   CSQLGETL
   CSQLRSTL
   CSQLSLKO
   CSQLSVTL
   CSQL1GET
   CSQL1RST
   CSQL1SLK
   CSQL1SVT
   
   
    
   
   

TEMPORARY FIX
 *  *********
   * HIPER *
   *********
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM01403
   
   
 * REPORTED COMPONENT NAME
   WMQ Z/OS V7
   
   
 * REPORTED COMPONENT ID
   5655R3600
   
   
 * REPORTED RELEASE
   000
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-11-16
   
   
 * CLOSED DATE
   2010-06-18
   
   
 * LAST MODIFIED DATE
   2010-08-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK58081 UK58082
   
   

MODULES/MACROS
 *  CSQLGETL CSQLRSTL CSQLSLKO CSQLSVTL CSQL1GET
   CSQL1RST CSQL1SLK CSQL1SVT
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ Z/OS V7
   
   
 * FIXED COMPONENT ID
   5655R3600
   
   

APPLICABLE COMPONENT LEVELS
 * R000 PSY UK58081 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK58081]
   UP10/07/08 P F007
   
   
 * R010 PSY UK58082 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK58082]
   UP10/07/08 P F007
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.