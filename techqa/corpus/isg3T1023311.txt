Title: IBM HSM causes a high CPU spike every hour, on the hour. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 HSM consumes high CPU once every hour starting at the beginning of the hour and lasting for several minutes. 

CAUSE
All primary volumes eligible for Interval Migration are space checked at the beginning of IM processing. This typically occurs every hour at the start of the hour but the IM start time can be staggered in secondary HSM hosts.

ENVIRONMENT
This can occur in any system where HSM manages primary volumes via Interval Migration. For non-SMS primary volumes, IM manages them if SETSYS INTERVALMIGRATION is set. For SMS-managed volumes, IM manages all volumes in a Storage Group where AM=Y is specified and SETSYS INTERVALMIGRATION is set, and it manages all SMS volumes in any storage group where AM=I is specified regardless of the SETSYS INTERVALMIGRATION|NOINTERVALMIGRATION setting.

DIAGNOSING THE PROBLEM
Determine if the system has IM eligible volumes. Every volume in a Storage Group with AM=I is eligible for interval migration regardless of the SETSYS NOINTERVALMIGRATION command. For non-SMS volumes, IM will be performed if SETSYS INTERVALMIGRATION is set.

RESOLVING THE PROBLEM
This CPU spike is inherent to Interval Migration and can not be avoided. If the customer can't tolerate the CPU spike, the alternative is to employ On-Demand Migration (ODM) that became available in z/OS 1.13. ODM performs space management on a volume based on an ENF72 signal that is generated by SMS when an SMS-managed volume has an allocation or an extent that causes it to go over the volume's occupancy threshold. In this way, primary volumes are space managed when needed instead of en masse at the top of every hour. No hourly space checks are performed on all of the volumes. Instead, a space check is performed on a volume at the end of its ODM space management processing, for that volume only. Only volumes that are space managed via ODM are space checked during ODM processing.




Setting up and using ODM is fully discussed in the DFSMShsm Storage Administration manual. As part of the set up, all storage groups that require ODM processing should have AM=Y. There should be no storage groups with AM=I if the customer does not wish Interval Migration to run on the system. There are other set up requirements, as well. Please refer the manual for information.