Title: IBM PI56041: DFHKE0002 A SEVERE ERROR (CODE X'0504') HAS OCCURRED IN MODULE DFHKEDS. - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A CICS region processing JAVA/DB2 workload was suffering severe
   problems which lead to message DFHKE0002 A severe error (code
   X'0504') has occurred in module DFHKEDS.
   
   The CICS region then terminates after message DFHPC0409 XXXXXXX
   Abends processing abend AEXZ for the same task, transaction
   YYYY.
   
   
   The Dump showed several issues:
   
   
   - Loop in DFHAPLJP recovery. This happened because a task was
     switching back from QR TCB to the wrong T8 TCB (which was
     associated to another task).
   
   - The repeated AEXZ abends that bring CICS down are caused by
     ERM failing to change mode back to T8 after calling DB2 on L8.
     This causes an AEXZ abend. During that is another attempt to
     change back to T8 which fails again. This drives recovery in
     ERM again and produces another AEXZ. Third time round that
     loop brings CICS down.
   
   
    
   
   

LOCAL FIX
 *  PTF required
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All CICS users.                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: CICS becomes unresponsive after issuing *
   *                      DFHKE0002 and DFHPC0409.                *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   An application program, running on an L8 TCB, issued a LINK to a
   Java application program. DFHSJTH was invoked, and the task
   moved to a T8 TCB. The Java program made a call to a program
   defined as THREADSAFE and OPENAPI, and the task moved back to
   the L8 TCB. This request hung, and was eventually purged,
   destroying the L8 TCB in the process.
   Control returned to DFHSJTH on the T8 TCB. DFHSJTH attempted to
   return the task to the L8 TCB, but this was not possible because
   that TCB had been destroyed. The CHANGE MODE returned EXCEPTION
   TCB_FAILED. DFHSJTH returned to its caller, and the task
   remained on the T8 TCB. DFHEPC did return the task to the QR
   TCB, but did not fully dissociate from the T8. The task then
   performed other work so did not leave the system.
   Another task ran and got the same T8 TCB. That task also issued
   a LINK to a THREADSAFE OPENAPI application program, and so moved
   to an L8 TCB. After this call, CICS attempted to return the
   task to its T8 TCB, but dispatcher picked a new T8 TCB because
   the original one was still associated with the first task.
   Various errors occurred and DFHAPLJP looped in recovery (AP196C)
   while unstacking this task on the wrong T8 TCB:
   .
   DFHKE0002 xxxxxxxx A severe error (code X'0504') has occurred in
   module DFHKEDS.
   DFHPC0409 xxxxxxxx Abends AEXZ and AEXZ have been issued while
   processing abend AEXZ for the same task, transaction xxxx.
   .
   Additional keywords: msgDFHKE0002 msgDFHPC0409 KE0002 PC0409
                        abendAEXZ DSAT_TCB_FAILED
   
   
    
   
   

PROBLEM CONCLUSION
 *  DFHSJTH has been updated to ensure that any failure to return to
   the calling TCB will cause the task to change to the QR TCB to
   complete the DFHSJTH cleanup. This will allow the task to
   correctly dissociate from the T8 TCB.
   
   
    
   
   

TEMPORARY FIX
 *              *********
               * HIPER *
               *********
   FIX AVAILABLE BY PTF ONLY
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI56041
   
   
 * REPORTED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * REPORTED COMPONENT ID
   5655Y0400
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-01-26
   
   
 * CLOSED DATE
   2016-02-05
   
   
 * LAST MODIFIED DATE
   2016-03-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PI53385 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI53385]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PI56065 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI56065] UI35284 UI35285
   
   

MODULES/MACROS
 *  DFHSJDM  DFHSJDUF DFHSJJS  DFHSJST  DFHSJTH
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * FIXED COMPONENT ID
   5655Y0400
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY UI35284 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI35284]
   UP16/02/19 P F602 ¢
   
   
 * R900 PSY UI35285 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI35285]
   UP16/02/19 P F602 ¢
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.