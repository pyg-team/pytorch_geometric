Title: IBM The manageprofiles.sh/bat command fails when adding an additional node to the existing Portal cluster - United States

Text:
manageprofiles; enable-profiles; cluster TECHNOTE (TROUBLESHOOTING)

PROBLEM
An existing 2 node WebSphere Portal cluster exists and is running fine. An attempt to add a 3rd node to the Portal cluster fails during the step that runs the manageprofiles.sh/bat command.

SYMPTOM
The wp_profile_create.log may show either of the following errors while running the following command...

./manageprofiles.sh -create -templatePath
/opt/IBM/WebSphere/PortalServer/profileTemplates/managed.portal -
profileName wp_profile -profilePath /opt/IBM/WebSphere/wp_profile -
cellName <cellname> -nodeName <nodename> -hostName <hostname>

Error 1

<record>
<date>2014-12-03T04:32:59</date>
<millis>1417624379557</millis>
<sequence>3211</sequence>
<logger>com.ibm.ws.install.configmanager.actionengine.ant.utils.
ANTLogToCmtLogAdapter</logger>
<level>WARNING</level>
<class>com.ibm.ws.install.configmanager.logging.LogUtils</class>
<method>logException</method>
<thread>0</thread>
<message>/opt/IBM/WebSphere/PortalServer/profileTemplates/managed.
portal/actions/checkPortalProfileValid.ant:104: The Profile Template is
not valid for this Installation. The Profile is build for the code
version=8.0.0.1 , but the Portal installation has the version=8.0.0.0

Error 2...

<record>
<date>2014-12-04T10:07:32</date>
<millis>1417730852377</millis>
<sequence>3220</sequence>

<logger>com.ibm.ws.install.configmanager.actionengine.ant.utils.ANTLogTo
CmtLogAdapter</logger>
<level>WARNING</level>
<class>com.ibm.ws.install.configmanager.logging.LogUtils</class>
<method>logException</method>
<thread>0</thread>

<message>/opt/IBM/WebSphere/PortalServer/profileTemplates/managed.portal
/actions/unzipPortalConfigToProfile.ant:12: Error while expanding
/opt/IBM/WebSphere/PortalServer/profileTemplates/default.portal/zip/Prof
ileEnhancements.zip
at org.apache.tools.ant.taskdefs.Expand.expandFile(Expand.java:128)
at org.apache.tools.ant.taskdefs.Expand.execute(Expand.java:92)
at
org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:275)
at org.apache.tools.ant.Task.perform(Task.java:364)
at org.apache.tools.ant.Target.execute(Target.java:341)

....

Caused by: java.io.FileNotFoundException:
/opt/IBM/WebSphere/PortalServer/profileTemplates/default.portal/zip/Prof
ileEnhancements.zip (No such file or directory)
at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.java:233)
at org.apache.tools.zip.ZipFile.&lt;init&gt;(ZipFile.java:140)
at org.apache.tools.ant.taskdefs.Expand.expandFile(Expand.java:117)
... 53 more


CAUSE
In this case, the root cause was identified as the profileTemplate that is originally created during the initial cluster creation by the enable-profiles configuration task was either never created (ie, the enable-profiles task was never ran) or it was somehow deleted at some point.

ENVIRONMENT
Portal 8001
Linux

DIAGNOSING THE PROBLEM
Review the ConfigTrace.log history to see if the enable-profiles task was ever ran. Or attempt to determine if the profileTemplate was ever deleted.

RESOLVING THE PROBLEM
The enable-profiles task will not run in a clustered environment, so recreating the profileTemplate on the Primary node is not possible. In this case the only way to resolve the problem is to add additional nodes to this cluster using this alternative method...

1. Install the Portal Server and profile (using the standard method
using IIM) on Node 3 and upgrade it to the same version as the Primary
Node...which in your case is Portal 8.0.0.1
2. Make a backup of the original wkplc.properties,
wkplc_dbtype.properties, and wkplc_comp.properties on Node 3
3. Copy the wkplc.properties, wkplc_dbtype.properties, and
wkplc_comp.properties from the Primary Node to Node 3 to ensure the
same database configuration.
4. Copy over the database drivers and ensure the DbLibrary property in
wkplc_dbtype.properties is the correct path for Node 3
5. Pick up on Step 8 of page 68 in the Portal 8 Cluster
Guide...http://www-10.lotus.com/ldd/portalwiki.nsf/dx/Step-by-Step_Cluster_Guide_for_IBM_WebSphere_Portal_v8