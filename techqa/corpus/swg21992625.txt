Title: IBM Upgrading from DB2 LUW with TSA3 to DB2 LUW with TSA4 may cause TSA issue during Fixpack update and upgrade (SQL1677N) - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The DB2 instance may not be able to start after upgrading a pureScale or non-purescale instance to DB2 v10.5 Fixpack 8. 

SYMPTOM
 

Instance will fail to start with SQL1677N:

$db2start
SQL1677N DB2START or DB2STOP processing failed due to a DB2 cluster services error.

db2diag.log shows:

2016-10-04-12.38.48.324967+180 I1468623E469 LEVEL: Error
PID : 424 TID : 139855091312416 PROC : db2start
INSTANCE: db2inst1 NODE : 000
HOSTNAME: xxxxxxxxxx
FUNCTION: DB2 UDB, high avail services, sqlhaVerifyHostLicenses, probe:18358
MESSAGE : The cluster manager license for the host is not ok:
DATA #1 : String, 8 bytes
xxxxxxxxxx
DATA #2 : SQLHA_LICENSE_STATUS, PD_TYPE_SQLHA_LICENSE_STATUS, 4 bytes
SQLHA_LICENSE_STATUS_UNKNOWN


CAUSE
TSAMP v4.1 is shipped with DB2 starting from DB210.5 FP8 and DB2V11.1 GA. As a result, the TSAMP level will get updated as part of DB2 installation. 

However, the Try & Buy TSAMP license file is shipped in FixPack universal images so the TSA license cannot be upgraded to the TSA4 permanent license automatically. Since the TSA license for TSA version 3 will not work on TSA version 4, starting the instance may fail with SQL1677N.


DIAGNOSING THE PROBLEM
Scan the db2diag.log for the above stated error message. The TSAMP license status can also be verified by running the following command: 

'samlicm -s'


RESOLVING THE PROBLEM
- If you have already installed DB2 v10.5 Fixpack 8, this issue can be resolved by downloading the sam41.lic file from the Passport Advantage site and running the following command: 

'samlicm -i sam41.lic

- If you are planning to install DB2 v10.5 Fixpack 8, then:
- Download the DB2 v10.5 Fixpack 8 image and extract its contents.
- Download the sam41.lic file from the Passport Advantage site.
- Copy the sam41.lic file to the following directory: <DB2 v10.5fp8 image location>/db2/<OSversion>/tsamp/license/
e.g. cp sam41.lic /home/db2inst1/FIXPACK8/universal/db2/linuxamd64/tsamp/license/
- Remove the sam41TB.lic from the following directory: <DB2 v10.5fp8 image location>/db2/<OSversion>/tsamp/license/
e.g. rm /home/db2inst1/FIXPACK8/universal/db2/linuxamd64/tsamp/license/sam41TB.lic
- Proceed with DB2 v10.5 Fixpack 8 installation.
- Confirm that the TSA v4.1 license has been applied on all hosts in the cluster by running the following command:
'samlicm -s'

RELATED INFORMATION
 samlicm [https://www.ibm.com/support/knowledgecenter/SSRM2X_4.1.0/com.ibm.samp.doc_4.1/samprgsamlicm.html]
Fix pack installation methods [http://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.qb.server.doc/doc/c0025016.html]
DB2 Version 10.5 for LUW fix pack [http://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.wn.doc/doc/c0061179.html]
DB2 Version 10.5 Fix Pack 8 for LUW [http://www-01.ibm.com/support/docview.wss?uid=swg24042680]
How do I download my DB2 license from PA [http://www-01.ibm.com/support/docview.wss?uid=swg21305417]
Upgrading a DB2 pureScale server [http://www.ibm.com/support/knowledgecenter/SSEPGG_11.1.0/com.ibm.db2.luw.qb.upgrade.doc/doc/t0060571.html]
Error: No product license found [http://http://www-01.ibm.com/support/docview.wss?uid=swg21997315]
A Japanese translation is available [http://www.ibm.com/support/docview.wss?uid=swg21993047]