Title: IBM WebSphere Portal 8 Migration: ConfigEngine upgrade-profile fails with error ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591] - United States

Text:
wp8migrate TECHNOTE (TROUBLESHOOTING)

PROBLEM
WebSphere Portal 8 Migration upgrade-profile step fails with error ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591]

SYMPTOM
ConfigEngine upgrade-profile fails with error message ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591] found in the <WP-PROFILE>/logs/SystemOut.log


CAUSE
There is a JCR node Lock on a IBM Web Content Management object which is stored in the JCR Database

ENVIRONMENT
WebSphere Portal 8

DIAGNOSING THE PROBLEM
ConfigEngine upgrade-profile fails with error message ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591]


The <WP-PROFILE>/ConfigEngine/log/ConfigTrace.log contains the following messages

[java] running: update-wcm-profile-categories

……………….

[java] java.lang.Exception: Failed to process 1 item(s). See SystemOut.log file for more details. 
[java] removing the stateful bean. 
[java] at com.ibm.workplace.wcm.app.migration.ejb.MigrationBeanClient.runTask(MigrationBeanClient.java:161)
[java] at com.ibm.workplace.wcm.app.migration.ejb.MigrationBeanClient.main(MigrationBeanClient.java:204) 

The <WP-PROFILE>/logs/SystemOut.log contains an error message similar to the following

ProfileCatego E com.ibm.workplace.wcm.app.migration.worker.ProfileCategoriesMigrationWorker.runNextTask Failed to migrate profile categories with uuid: c2c0de80468e95b1bf7eff1eb6bbede3. Error message: ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591] com.ibm.icm.jcr.access.AccessDeniedException: ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591]

NOTE: The running task update-wcm-profile-categories, the class name com.ibm.workplace.wcm.app.migration.worker.ProfileCategoriesMigrationWorker, the text "profile categories" and the uuid can differ.


RESOLVING THE PROBLEM
1) Backup the JCR Database 


2) Download the WCM Support Tools Portlet from the following URL

http://www.ibm.com/developerworks/lotus/documentation/webcontentmanagement/supportportlet/#download [http://www.ibm.com/developerworks/lotus/documentation/webcontentmanagement/supportportlet/#download]

3) Obtain the WCM Support tool portlet unlock access code from the IBM Web Content Management Support team to enable the unlock feature of the tool

4) Install the WCM Support tool portlet

5) Use the WCM Support tool portlet to find and unlock the uuid associated with the error message ACC3502E: The requested operation violates one or more lock constraints.: [ErrorCode:7591] 

NOTE: in some cases the Portal environment is not yet in a state where the WCM Support tools portlet can be installed and or used. In this case the following steps should be taken to unlock the nodes and continue the upgrade-profile step of the migration

1) Backup the JCR Database
2) This issue is occurring due to the fact there are "user" locks that were left over from the source environment when the database was copied to the target system. These user locks are maintained by the JCR and are stored in the database. Since this is migrated data you can remove all the JCR "user" locks with the following DB2 commands:

DELETE FROM JCR.ICMSTJCRNODELOCKS WHERE WSID = 1 AND LOCKOPTION = 128
COMMIT

2) After the above DB2 commands are executed run upgrade-profile again using the option to resume upgrade-profile task from the last point of failure. For example

-Dwp.migration.framework.resume=post-apply-PTF (That parameter could vary; It is based on the progress already made in the upgrade-profile task)






 * 
 *