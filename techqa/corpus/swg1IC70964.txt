Title: IBM IC70964: DOCUMENTATION ON SETTING UP TIVOLI STORAGE MANAGER V6 IN HACMP CLUSTER NEEDS TO BE UPDATED - United States

Text:
AIX  A FIX IS AVAILABLE
IBM Tivoli Storage Manager V6.1 Fix Pack 5 (6.1.5) Server Downloads [http://www-01.ibm.com/support/docview.wss?uid=swg24029664]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS DOCUMENTATION ERROR.
    
   
   

ERROR DESCRIPTION
 *  Tivoli Storage Manager v6.1 and v6.2 Administrator Guide,
   Appendix A, insufficiently documents how to set up Tivoli
   Storage Manager Server in an AIX HACMP cluster environment.
   
   The following steps should be taken to successfully implement
   Tivoli Storage Manager v6 in HACMP cluster.
   
   After implementing Tivoli Storage Manager v6 server on the
   primary node, setup the v6 configuration on the second node in a
   HACMP cluster. Apart from the steps documented in the
   Administrator Guide, some additional configuration steps need to
   be done to enable the second node to take over and start the
   Tivoli Storage Manager server. The required instance user, which
   was already created on the first node of the cluster, needs to
   be created on the second node as well. This task must be
   completed before you could continue with the next steps below.
   
   1 Failover database, log and instance directories
   Failover the shared database, log and instance directories to
   the second node of the HACMP cluster.
   
   2 Create an empty DB2 Tivoli Storage Manager Server Instance
     - LOGIN as root on the second node of the HACMP cluster
     - Start the db2icrt command to create an empty instance for
   the Tivoli Storage Manager server, please ensure that the
   instance user is specified in the end of the command:
       /opt/tivoli/tsm/db2/instance/db2icrt -a SERVER -u <INSTANCE
   USER> <INSTANCE USER>
       The db2icrt command is preparing the basic DB2 setup on the
   second node of the HACMP cluster, which include the sqllib
   directory in the instance user?s home directory and the required
   entries in the /etc/services file (search for DB2_).
   
   3 Copy required files from the first node
     - You need to copy the following files from the first node of
   the cluster:
       /home/<INSTANCE USER>/sqllib/userprofile
       /usr/tivoli/tsm/client/api/bin64/dsm.sys
     - The tsmdbmgr.opt file, if it is not on the shared disks and
   accessible for the second node of the cluster
     - Ensure that the userprofile file have the correct ownership:
       chown <INSTANCE USER>.<INSTANCE GROUP> /home/<INSTANCE
   USER>/sqllib/userprofile
   
   4 Adjust DB2 settings
     - LOGIN as <INSTANCE USER>
     - Enter following commands to update the DB2 configuration for
   the new created instance:
       db2 catalog database tsmdb1 on <INSTANCE DIRECTORY>
       db2 update dbm cfg using dftdbpath <INSTANCE DIRECTORY>
       set db2instance=<INSTANCE USER>
       db2set -i <INSTANCE USER> DB2CODEPAGE=819
   
   5 Reload profile and start the Tivoli Storage Manager server in
   the foreground
     - Reload profile from the instance user to activate the new
   settings by logoff and logon as the instance user. Additionally
   stop and restart DB2 to activate the new settings:
       db2stop
       db2start
     - Start the Tivoli Storage Manager server in the foreground
       /opt/tivoli/tsm/server/bin/dsmserv -i <INSTANCE DIRECTORY>
   
   6 Test the setup by attempting a failover to make sure the setup
   is correct. It is also recommended to test the TSM DB Backup
   facility on both sides.
   
   Platforms and versions affected:
   Tivoli Storage Manager 6.x on AIX HACMP cluster
   
   Initial Impact:
   Medium
   
   
   Additional Keywords:
   zz61 zz62 hacmp cluster high availability ha tsm db2
   
   
    
   
   

LOCAL FIX
 *  Follow instructions given in this APAR until the Administrator
   Guide has been updated.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All Tivoli Storage Manager AIX server users  *
   *                 installing and configuring HACMP             *
   ****************************************************************
   * PROBLEM DESCRIPTION: The steps for configuring HACMP for     *
   *                      AIX changed and were not properly       *
   *                      documented in the Administrator's       *
   *                      Guide.                                  *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   1. Define the shared file systems and logical volumes, as
   required. You may want to put files in separate file systems
   or on separate physical disks for integrity or performance
   reasons. Mirror the logical volumes to provide maximum
   availability (including the underlying file systems). The file
   systems that must be defined include the IBM  Tivoli Storage
   Manager server instance directory, the database directories,
   the log directories, all disk storage pool directories, and
   FILE device type storage pool directories.
   
   2. Configure HACMP so that the production node owns the shared
   volume groups and the standby node takes over the shared
   volume groups if the production node fails.
   
   3. Configure HACMP so that the file systems also fail over.
   
   4. Configure HACMP so that the standby node takes over the
   IP address of the production node in the event of a failure.
   
   5. Failover the shared database and the log and instance
   directories to the standby node of the HACMP cluster.
   
   6. Create an empty DB2 Tivoli Storage Manager server instance:
      1. Log in as root on the standby node of the HACMP cluster.
      2. Issue the DB2ICRT command to create an empty instance
   for the Tivoli Storage Manager server. Ensure that the instance
   user is specified in the command. For example:
   
               /opt/tivoli/tsm/db2/instance/db2icrt
               -u INSTANCE_USER INSTANCE USER
   
   7. Copy the following required files from the production node
   to the standby node:
             * /usr/tivoli/tsm/client/api/bin64/dsm.sys
             * tsmdbmgr.opt if this file is not on the shared
   disks and is accessible from the standby node.
             * /home/INSTANCE USER/sqllib/userprofile
   Note: Ensure that the userprofile file has the correct
   ownership.
   Issue the following command:
   
   chown instance user.instance group/home/instance
   user/sqllib/userprofile
   
   8. Adjust the DB2 settings. Log in as instance user and issue
   the following commands to update the DB2 configuration for the
   newly-created instance:
   
         db2 catalog database tsmdb1 on instance directory
         db2 update dbm cfg using dftdbpath instance directory
         dbset -i instance user DB2CODEPAGE=819
   
   9. As the instance user, log off and then log on to activate
   the new settings.
   
   10. Start the Tivoli Storage Manager server in the foreground:
   
          /opt/tivoli/tsm/server/bin/dsmserv -i instance directory
   
   11. Stop and restart DB2 to activate the new settings:
   
         db2stop
         db2start
   
   12. Attempt a failover to test the setup. Test the Tivoli
   Storage Manager DB Backup facility on both sides.
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC70964
   
   
 * REPORTED COMPONENT NAME
   TSM SERVER
   
   
 * REPORTED COMPONENT ID
   5698ISMSV
   
   
 * REPORTED RELEASE
   62A
   
   
 * STATUS
   CLOSED DOC
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-09-09
   
   
 * CLOSED DATE
   2010-11-08
   
   
 * LAST MODIFIED DATE
   2010-11-08
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

Publications Referenced SC23976902 FIX INFORMATION

APPLICABLE COMPONENT LEVELS