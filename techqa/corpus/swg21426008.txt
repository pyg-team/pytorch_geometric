Title: IBM Change to AAA Post Processing for LTPA in IBM WebSphere DataPower SOA Appliance - United States

Text:
DataPower; LTPA; token; SSO; Set-Cookie; Cookie; header TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 There is a behavior change in the 3.8.0 and later firmware related to AAA Policy when an LTPA token is generated in a Post-Processing action.

IBM WebSphere DataPower appliances have the capability of creating WebSphere Application Server Lightweight Third Party Authentication (LTPA) credentials in the AAA Post-Processing action. An LTPA credential contains a client's identity. These LTPA credentials can be in the form of either an HTTP Cookie or within a WS-Security binary security token. LTPA credentials are a cryptographic protected SSO credential. 

SYMPTOM
Customers migrating from firmware versions 3.7.3 or before to 3.8.0 or later may encounter errors or response-related failures associated with the LTPA Set-Cookie header if their AAA Policy generates an LTPA token in Post-Processing and they are also providing their own Set-Cookie for LTPA handling. Failure may occur due to two LTPA cookies in the Set-Cookie header for the response.


CAUSE
There is a difference in the LTPA token generation in the AAA Post Processing step between firmware versions 3.7.x and version 3.8.0 or later. 

Previously, when DataPower generated an LTPA cookie to be consumed by a backend service, only the Cookie header was generated. 

In version 3.8.0 and later, the DataPower firmware generates a Set-Cookie header, in addition to the Cookie header, so the LTPA cookie can be consumed by the caller. 

The LTPA cookie generated by DataPower in Set-Cookie will have the following attributes: 

 * domain: not set 
   path: not set 
   secure: not set 
   HttpOnly: not set 

For customers who provide their own Set-Cookie for LTPA handling, this could potentially lead to two LTPA cookies in the Set-Cookie header for the response. 
DIAGNOSING THE PROBLEM
Examine the Set-Cookie header in the response using packet capture or probe and check if two LTPA cookies are present.



RESOLVING THE PROBLEM
In the Post Processing action, use a custom stylesheet to remove the LTPA Set-Cookie generated by the DataPower appliance before any custom processing takes place. Modify the custom Set-Cookie for LTPA to utilize the new Set-Cookie generated by DataPower firmware. For this option, if you wish to change any of the attributes set by DataPower (as listed above), a custom stylesheet is required.


Alternately, upgrade firmware to include APAR IC81690 [http://www-304.ibm.com/support/docview.wss?uid=swg1IC81690] available in 4.0.1.9, 4.0.2.5, or above firmware, which adds a new toggle "Insert LTPA Set-Cookie". This toggle is associated with the AAA Post-Processing action. Setting this toggle to "off" reverts the Post-Processing action to the pre-3.8.0 behavior of generating only the Cookie header. 


For a more comprehensive overview, please refer to the section "Generating LTPA tokens" in the product documentation [http://www.ibm.com/software/integration/datapower/library/documentation] specific to your appliance model and firmware version.






Cross reference information Segment Product Component Platform Version Edition Business Integration WebSphere DataPower XML Security Gateway XS40 3.8 Business Integration WebSphere DataPower Integration Appliance XI50 3.8 Business Integration WebSphere DataPower B2B Appliance XB60 3.8