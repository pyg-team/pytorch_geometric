Title: IBM PM54323: WITH ERRORDETECTIONMODEL SET TO EXCEPTIONMAPPING CONNECTION POOL DOES NOT GET PURGED IN RARE CASE - United States

Text:
  FIXES ARE AVAILABLE
7.0.0.23: WebSphere Application Server V7.0 Fix Pack 23 [http://www-01.ibm.com/support/docview.wss?uid=swg24032493]
8.0.0.4: WebSphere Application Server V8.0 Fix Pack 4 [http://www-01.ibm.com/support/docview.wss?uid=swg24033190]
7.0.0.25: WebSphere Application Server V7.0 Fix Pack 25 [http://www-01.ibm.com/support/docview.wss?uid=swg24033267]
8.0.0.5: WebSphere Application Server V8.0 Fix Pack 5 [http://www-01.ibm.com/support/docview.wss?uid=swg24033754]
7.0.0.27: WebSphere Application Server V7.0 Fix Pack 27 [http://www-01.ibm.com/support/docview.wss?uid=swg24033882]
8.0.0.6: WebSphere Application Server V8.0 Fix Pack 6 [http://www-01.ibm.com/support/docview.wss?uid=swg24034673]
7.0.0.29: WebSphere Application Server V7.0 Fix Pack 29 [http://www-01.ibm.com/support/docview.wss?uid=swg24034966]
8.0.0.7: WebSphere Application Server V8.0 Fix Pack 7 [http://www-01.ibm.com/support/docview.wss?uid=swg24035457]
8.0.0.8: WebSphere Application Server V8.0 Fix Pack 8 [http://www-01.ibm.com/support/docview.wss?uid=swg24036729]
7.0.0.31: WebSphere Application Server V7.0 Fix Pack 31 [http://www-01.ibm.com/support/docview.wss?uid=swg24036768]
7.0.0.27: Java SDK 1.6 SR13 FP2 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24035324]
7.0.0.33: WebSphere Application Server V7.0 Fix Pack 33 [http://www-01.ibm.com/support/docview.wss?uid=swg24037573]
8.0.0.9: WebSphere Application Server V8.0 Fix Pack 9 [http://www-01.ibm.com/support/docview.wss?uid=swg24037574]
7.0.0.35: WebSphere Application Server V7.0 Fix Pack 35 [http://www-01.ibm.com/support/docview.wss?uid=swg24038310]
8.0.0.10: WebSphere Application Server V8.0 Fix Pack 10 [http://www-01.ibm.com/support/docview.wss?uid=swg24039242]
7.0.0.37: WebSphere Application Server V7.0 Fix Pack 37 [http://www-01.ibm.com/support/docview.wss?uid=swg24039338]
8.0.0.11: WebSphere Application Server V8.0 Fix Pack 11 [http://www-01.ibm.com/support/docview.wss?uid=swg24040425]
7.0.0.39: WebSphere Application Server V7.0 Fix Pack 39 [http://www-01.ibm.com/support/docview.wss?uid=swg24041013]
8.0.0.12: WebSphere Application Server V8.0 Fix Pack 12 [http://www-01.ibm.com/support/docview.wss?uid=swg24041590]
7.0.0.41: WebSphere Application Server V7.0 Fix Pack 41 [http://www-01.ibm.com/support/docview.wss?uid=swg24041931]
8.0.0.13: WebSphere Application Server V8.0 Fix Pack 13 [http://www-01.ibm.com/support/docview.wss?uid=swg24042746]
7.0.0.43: WebSphere Application Server V7.0 Fix Pack 43 [http://www-01.ibm.com/support/docview.wss?uid=swg24043400]
8.0.0.14: WebSphere Application Server V8.0 Fix Pack 14 [http://www-01.ibm.com/support/docview.wss?uid=swg24044096]
7.0.0.45: WebSphere Application Server V7.0 Fix Pack 45 [http://www-01.ibm.com/support/docview.wss?uid=swg24044551]
8.0.0.15: WebSphere Application Server V8.0 Fix Pack 15 [http://www-01.ibm.com/support/docview.wss?uid=swg24044734]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  With errorDetectionModel set to ExceptionMapping and
   terminate the database connections ( negative test case)
   using " db2 force applications all" the JDBC Driver throws
   an XAException during start of UOW.
   
   This exception is caught by the WebSphere RRA code and
   a StaleConnectionException is instantiated. Since the SCE
   was instantiated, the existing code does not have the
   functionality to fire the connection error event and
   thereby the connection pool does not get purged.
   
   But in the case of errorDetectionModel set to
   ExceptionChecking, the above scenario results in
   the connection pool getting purged.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  All users of IBM WebSphere Application      *
   *                  Server                                      *
   ****************************************************************
   * PROBLEM DESCRIPTION: With errorDetectionModel set to         *
   *                      ExceptionMapping the connection pool    *
   *                      does not get purged in rare cases       *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   When the connection pool error detection model is configured to
   exception mapping, the stale connection exception indicates
   that the connection is no longer valid. Consider the scenario
   where the DB2 database connections are terminated using "db2
   force applications all" command and the JDBC Driver throws an
   XAException during start of UOW. This exception is caught by
   the WebSphere RRA code and a StaleConnectionException is
   instantiated and thrown back to the application.
   Typically when a StaleConnectionException results from the
   exception mapping process a connection error event is fired and
   subsequently the connection pool gets purged.  However in this
   rare case scenario the SCE is instantiated, but does
   not fire the connection error event for the pool to get purged.
   When connections are terminated at the database side,
   upon requesting a new connection, the driver throws an
   XAException. Under such condition, with
   errorDetectionModel=ExceptionMapping, you observe connection
   pool not getting purged, then with this apar you can force a
   ConnectionErrorEvent to be fired so that the connection pool
   gets purged based on the purge policy.
   Note : The APAR is not enabled by default and in order to
   enable the APAR you will have to define a datasource custom
   property on the respective datasources
   Navigate to:
   Resources > JDBC > JDBC providers > JDBC_provider > Data
   sources > (data_source) > Custom properties
   Define the following custom property :
   Property Name : fireCEEventOnSCE
   Value : true
   Restart the servers for the custom property to take effect.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The WebSphere RRA code has been changed such that the pool
   purged properly upon a StaleConnectionException when using
   ExceptionMapping as the errorDetection model.
   The fix for this APAR is currently targeted for inclusion in
   fix packs 7.0.0.23 and 8.0.0.4.  Please refer to the
   Recommended Updates page for delivery information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM54323
   
   
 * REPORTED COMPONENT NAME
   WEBS APP SERV N
   
   
 * REPORTED COMPONENT ID
   5724H8800
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2011-12-14
   
   
 * CLOSED DATE
   2012-03-28
   
   
 * LAST MODIFIED DATE
   2016-02-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBS APP SERV N
   
   
 * FIXED COMPONENT ID
   5724H8800
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP
   
   
 * R800 PSY
   UP