Title: IBM PI87724: IMS LOG READER TO DETECT WHEN OLDS DATA WAS READ AND RE-WRITE TO THE NEXT OLDS DUE TO AN I/O ERROR ON A SECONDARY OLDS - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  USERS AFFECTED     :  Data Replication for IMS
   :  IBM InfoSphere Classic Change
   DataCapture for z/OS for IMS
   
   
   
   PROBLEM DESCRIPTION:
   
   When IMS dual logging is in effect IMS keeps the information
   recorded in the RECON consistent for primary and secondary
   OLDS. When IMS writes data to the OLDS, data is written to the
   primary OLDS and then the secondary OLDS. If an I/O error is
   detected on the secondary OLDS then IMS records information
   about the last block successfully written to the secondary OLDS
   in the RECON, truncates the primary OLDS so that it is
   consistent with the secondary OLDS, performs a log switch and
   writes the data to the new set of primary/secondary OLDS.
   
   
   If the IMS log reader is reading data from the primary OLDS it
   is possible that it reads the newly written block of data
   before IMS truncates the file. If this happens then the IMS log
   reader is stuck and goes into a loop trying to read more data
   from the primary OLDS that it is currently processing. Because
   the last LSN information recorded in the RECON is in-consistent
   with what the IMS log reader has successfully read from the
   active OLDS it does not understand that IMS is now writing data
   to a new OLDS.
   
   
   
   PROBLEM CONCLUSION :
   
   The IMS log reader is being modified to detect the condition
   where IMS has switched to a new OLDS and the last LSN
   information recorded in the RECON is less than the last LSN
   successfully read by the IMS log reader. This condition will
   only be detected when the IMS log reader is at logical end of
   log at which point DBRC is checked at 30 second intervals to
   see if IMS has performed an unexpected log switch.
   
   If this condition is detected the IMS log reader writes the
   following message to the console and reports the error to the
   IMS log reader service:
   
   CECZ0974E Active OLDS log reading out-of-sync with what is
   recorded in DBRC for subsystem subsystem-id.
   
   Replication is stopping for all subscriptions associated with
   log stream log-stream-name.
   
   The IMS log reader notifies the capture services of the
   problem. The capture service stops replication for the
   subscriptions that were associated with the change stream.
   Replication can simply be restarted for the affected
   subscriptions since the IMS logs and RECON are not in sync at
   this point.
   
   
    
   
   

LOCAL FIX
 *  Stop replication and capture operations for the affected
   subscriptions and then restart replication.
   
   Since the IMS logs and information recorded in the RECON are
   now consistent the IMS log reader will detect the log switch
   without any problems.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: Data Replication for IMS                     *
   *                 IBM InfoSphere Classic Change Data Capture   *
   *                 for z/OS for IMS                             *
   ****************************************************************
   * PROBLEM DESCRIPTION: When transactions were running under    *
   *                      IMS and CCDC MQ publisher was           *
   *                      reading an IMS log, and the             *
   *                      secondary OLDS has an I/O error, the    *
   *                      DFS0414i message appeared and the       *
   *                      publisher stopped processing.           *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   When IMS dual logging is in effect IMS keeps the information
   recorded in the RECON consistent for primary and secondary
   OLDS. When IMS writes data to the OLDS, data is written to
   the primary OLDS and then the secondary OLDS. If an I/O error
   is detected on the secondary OLDS then IMS records information
   about the last block successfully written to the secondary
   OLDS in the RECON, truncates the primary OLDS so that it is
   consistent with the secondary OLDS, performs a log switch and
   writes the data to the new set of primary/secondary OLDS.
   If the IMS log reader is reading data from the primary OLDS
   it is possible that it reads the newly written block of data
   before IMS truncates the file. If this happens then the IMS
   log reader is stuck and goes into a loop trying to read more
   data from the primary OLDS that it is currently processing.
   Because the last LSN information recorded in the RECON is
   in-consistent with what the IMS log reader has successfully
   read from the active OLDS it does not understand that IMS is
   now writing data to a new OLDS.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The IMS log reader is being modified to detect the condition
   where IMS has switched to a new OLDS and the last LSN
   information recorded in the RECON is less than the last LSN
   successfully read by the IMS log reader. This condition will
   only be detected when the IMS log reader is at logical end of
   log at which point DBRC is checked at 30 second intervals to
   see if IMS has performed an unexpected log switch. If this
   condition is detected the IMS log reader writes the following
   message to the console and reports the error to the IMS log
   reader service:
   CECZ0974E Active OLDS log reading out-of-sync with what is
   recorded in DBRC for subsystem subsystem-id. Replication is
   stopping for all subscriptions associated with log stream
   log-stream-name.
   The IMS log reader notifies the capture services of the
   problem. The capture service stops replication for the
   subscriptions that were associated with the change stream.
   Replication can simply be restarted for the affected
   subscriptions since the IMS logs and RECON are not in sync
   at this point.
   
   
    
   
   

TEMPORARY FIX
 *  Stop replication and capture operations for the affected
   subscriptions and then restart replication. Since the IMS
   logs and information recorded in the RECON are now consistent
   the IMS log reader will detect the log switch without
   any problems.
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI87724
   
   
 * REPORTED COMPONENT NAME
   CLASSIC FED & E
   
   
 * REPORTED COMPONENT ID
   5697I8200
   
   
 * REPORTED RELEASE
   B30
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-09-21
   
   
 * CLOSED DATE
   2017-09-26
   
   
 * LAST MODIFIED DATE
   2017-10-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI50606
   
   

MODULES/MACROS
 *     CACCHICT CACENGCT CACJPNCT CACZHOCT CECCLRFU
   CECCLRIC CECCLRID CECCLRIE CECCLRIH CECCLRII CECCLRIM CECCLRIQ
   CECCLRIR CECCLRIS CECCLRIT
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CLASSIC FED & E
   
   
 * FIXED COMPONENT ID
   5697I8200
   
   

APPLICABLE COMPONENT LEVELS
 * RB30 PSY UI50606 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI50606]
   UP17/09/27 P F709
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.