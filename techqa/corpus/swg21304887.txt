Title: IBM About the NULLID schema for EJB 1.x/2.x CMP mappings and Generate Unqualified SQL - United States

Text:
RATLC00311863; RAD; v7.v6; ejb; cmp; mapping; map; generated coded; deploy; schema name; schema; NULLID; ejbdeploy; SQL; prefix; table; EJBDEPLOY_GENERATE_UNQUALIFIED_SQL; PK58731; z/OS; DB2; 7.0.0.6; 1304887; v7.5; Generate Unqualified SQL; deployment TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This technote identifies an IBM Rational Application Developer for WebSphere Software v7.0 documentation defect related to the CMP EJB mapping created against a Data Model using a specific Schema name that results in generated SQL code using the schema name prefix (schema_name.table). 

SYMPTOM
In Rational Application Developer v7.0, a CMP EJB v1.x or v2.x mapping created against a Data Model using a specific Schema name results in generated SQL code using the schema name prefix (schema_name.table). 


Note: The Database could be DB2 or Oracle or other supported vendor. 

This issue does not allow for flexibility when specifying a corresponding Data source in WebSphere Application Server v5.x or v6.x to be independent of the Schema name in the generated code, by having the schema name to be automatically set to be the same as the login-id used to connect to the database.



CAUSE
Documentation defect APAR PK65968 has been submitted against the Rational Application Developer v7.0 Help requesting the use of a NULLID schema in a cmp ejb mapping to be explained.



RESOLVING THE PROBLEM
Hard coding the schema name into a CMP EJB 1.x or 2.x mapping for reasons of flexibility is not considered sound practice. 


If the schema name NULLID is used in the database model, then the generated EJB deployment code SQL statements will be independent of the schema name and allowing flexibility in the Datasource specified on the WebSphere Application Server (WAS)WAS v5.x or v6.x server. The NULLID prefix of the generated SQL statements (NULLID.table) will be changed at runtime by the WAS server EJB/Datasource runtime to correspond to the login-id specified for the server Datasource.

However, as of Rational Application Developer v7.0.0.6, a NULLID schema is not always required for unqualified SQL. 
Note: For more details refer to APAR PK58731 [http://www.ibm.com/support/docview.wss?rs=203&uid=swg1PK58731].

In Rational Application Developer v7.0.0.6+ you can set the system property mentioned in the APAR information to generate unqualified SQL rather than rely on NULLID. 

The property is: EJBDEPLOY_GENERATE_UNQUALIFIED_SQL

You need to edit:
<RADv7.0.0.x Install Dir>\SDP70\configuration\config.ini 
and specify the system property as follows:

EJBDEPLOY_GENERATE_UNQUALIFIED_SQL=true

Note: Make a backup copy of the config.ini file before modifying it.

In Rational Application Developer V7.5.1+ there is an EJB 1.x/2.x project property checkbox that can be set:

Right Click on EJB 1.x/2.x Project > Properties > EJB Deployment : [ ] Generate Unqualified SQL


WORKAROUND: (especially if using versions prior to v7.0.0.6):

If an EJB mapping is done against a Database connection which results in a Data Model in the ejb backend folder in which the Schema name is other then NULLID, it can be changed as follows:


 1. In the case of Rational Application Developer v7.0, there is a logical Data Models folder in an EJB project in the Project Explorer view of the J2EE perspective. The Data Models folder when expanded shows the database model file: {some name}.dbm. This file is physically located in the EJB project folder: ejbModule/META-INF/backends/{database vendor backend folder}.
    
 2. The *.dbm Data Model file can be opened in the Physical Data Model editor and consequently making the model tree available for expansion ( "+" ) viewing, by a double mouse click or Right Mouse Click (RC) > Open. 
    
 3. Expanding the dbm file in the Data Models folder will show the schema. 
    
 4. Click on the Schema and its information will show in Properties view, were its name can be changed to NULLID.
    
 5. Make sure to save the open Physical Data Model editor associated with your *.dbm file.


Now when the cmp ejb project is regenerated (i.e. using RC > Prepare for deploy), the generated SQL code will now be prefixed with NULLID. This prefix will be modified at runtime by the WAS server to send SQL statements having a schema prefix corresponding to the login-id. 

Note: There are some database vendor and version scenarios where it is not acceptable to have the schema name correspond to the login-id of the server Datasource and requires setting custom properties. In the case of z/OS DB2, refer to the technote: 
"Specifying a runtime DB2 z/OS DataSource Schema for a CMP EJB Project with a NULLID mapped Schema" [http://www.ibm.com/support/docview.wss?uid=swg21205455] 


RELATED INFORMATION
#RAD v7.5 Help: Flexible schema names [http://publib.boulder.ibm.com/infocenter/radhelp/v7r5/index.jsp?topic=/com.ibm.jee5.doc/topics/rmgcmpweblogic.html]
EJBDeploy generation and deletion .. and generated [http://www.ibm.com/support/docview.wss?uid=swg21244438]