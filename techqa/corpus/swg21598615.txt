Title: IBM Unable to update the Relative Distinguished Name for a user or group in Portal - United States

Text:
EJPSG0044E; puma; vmm; rdn; attribute TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You have a requirement to update the Relative Distinguished Name of a user or group in a user repository via the Portal server. When attempting to do so, you receive a EJPSG0044E error message indicating the property cannot be updated. This Technote will document why this error occurs and how to workaround the error message. 

CAUSE
 Neither the Portal User Management Architecture (PUMA) component of WebSphere Portal nor the Virtual Member Manager (VMM) component of WebSphere Application Server will permit updates to the attribute which is contained in the full distinguished name of a user or group.
Let's assume we have a user "testuser" with a full distinguished name as follows: 

uid=testuser,ou=Users,dc=ibm,dc=com

Then the "uid" attribute of this user would not be permitted to be updated. Similarly, let's assume we have a group "testgroup" with a full distinguished name as follows 

cn=testgroup,ou=Groups,dc=ibm,dc=com

Then the "cn" attribute of this group would not be permitted to be updated.


ENVIRONMENT
Any WebSphere Portal 6.1, 7.0, or 8.0 environment.



DIAGNOSING THE PROBLEM
Portal's PUMA component will throw following error: 

com.ibm.wps.um.exceptions.impl.ModifyReadOnlyAttributeExceptionImpl: com.ibm.portal.puma.UpdateReadOnlyAttributeException:EJPSG0044E: Updating the rdn attribute uid is not supported 

 

WebSphere Application Server's VMM component will not throw an error, however, VMM will filter out any attempts to update the rdn attribute. Other attributes may be updated successfully in the same call to update other attributes, but VMM will filter out attempts to update the rdn attribute. 

 

Most WebSphere Portal out-of-the-box portlets block attempts to update the rdn attribute. For example, if the rdn attribute for a user is set to the "uid" attribute, then the "Edit my Profile" / Selfcare portlet will not allow the user ID field to be edited. All other fields will be permitted to be edited. However, custom code utilizing the PUMA API could be used to trigger a request to update the rdn attribute. Example sample code used when authoring this document is as follows: 


userList = pumaLocator.findUsersByAttribute("uid","*");
User editUser = (User)userList.get(i);
HashMap userAttstoUpdate = new HashMap();
userAttstoUpdate.put("uid","test");
pumaController.setAttributes(editUser, userAttstoUpdate);

A more detailed explanation of the sample code is available at the end of this document under the link titled "Portal User Management Architecture (PUMA) sample scenarios in IBM WebSphere Portal"


RESOLVING THE PROBLEM
There are three possible courses of resolution for this condition: 

1) Do not use Portal to update the rdn of a user or a group 

2) Use direct JNDI calls bypassing Portal and VMM validation checks 

3) Change repository data and Portal configuration to use a different rdn attribute 

 

1) Do not use Portal to update the rdn of users or groups 

Generally speaking, updating the rdn of a user or group is rarely performed. Once the user or group is created, the rdn itself typically remains constant while other attributes may be changed.


Using the example user previously noted: 

uid=testuser,ou=Users,dc=ibm,dc=com 


Let's suppose the user has a name change. In such a case, the cn, sn, or givenName attributes could change, but the uid attribute we would expect not to change. Similarly, let's suppose we wish to change the name of our group previously noted: 

cn=testgroup,ou=Groups,dc=ibm,dc=com


In most cases, the existing group name would remain, and a new group composed of the same members as the original group would be created. This would allow applications dependent on the old group to migrate to the new group.


However, if a requirement does exist to update the rdn of the user or group, one possible solution is to make the change directly in repository itself, rather than going through the Portal server. i.e. For an LDAP server, update the uid attribute for a user directly in LDAP, rather than through the Portal server. On a small scale where such changes are needed infrequently, this may provide a solution.


2) Use direct JNDI calls bypassing Portal and VMM validation checks


This document assumes that either Portal and/or VMM are being invoked to make a change to data in a user repository. Assuming the user repository is an LDAP server, rather than going through Portal and/or VMM to commit the change to the LDAP server, custom code could be authored which would bypass the Portal and VMM layers altogether, making direct calls to the LDAP server. Once the changes are made on the LDAP server, the Portal and VMM layers would recognize the changes and begin utilizing the new data. This would be beneficial in scenarios that need to make such changes frequently and/or on a programmatic basis, rather than relying on manual intervention of an LDAP administrator each time the change needs to be made. 


Limitation of IBM Support: Note that IBM Support cannot assist with specifics of how to author custom code for this option. Such a customization is provided by IBM Services but not by IBM Support. Reference material from a third party is provided at the end of this document and details the specifics of JNDI calls to LDAP servers should you wish to pursue this option further.


Note: If you choose to implement this method, ensure you to clean up the Portal databases after updating the user or group data per the instructions in this document [https://www.ibm.com/support/docview.wss?uid=swg21377025].



3) Change repository data and Portal configuration to use a different rdn attribute

In the previous example given, distinguished names for a test user and test group were given as: 

uid=testuser,ou=Users,dc=ibm,dc=com 

cn=testgroup,ou=Groups,dc=ibm,dc=com


If the distinguished names were changed to be: 

serialNumber=12345,ou=Users,dc=ibm,dc=com 

groupNumber=67890,ou=Groups,dc=ibm,dc=com


And the corresponding Portal server configuration changes are made (in wimconfig.xml file): 
<config:supportedEntityTypes defaultParent="o=defaultWIMFileBasedRealm" name="PersonAccount">
<config:rdnProperties>serialNumber</config:rdnProperties>
</config:supportedEntityTypes>

<config:supportedEntityTypes defaultParent="o=defaultWIMFileBasedRealm" name="Group">
<config:rdnProperties>groupNumber</config:rdnProperties>
</config:supportedEntityTypes>


Then the original attributes of "uid" for the user and "cn" for the group will be permitted to be changed. 

Note #1: In most circumstances, changing the repository data is not desirable, and this option is the least recommended. However, if your user repository already contains a custom attribute contained within the full distinguished name of users and/or groups, such as the serialNumber attribute for users and groupNumber attribute for groups given in the example above, this may be a desirable option as only the configuration on the Portal server would need to change. However, note with this configuration change that both the serialNumber and groupNumber attributes now would not be permitted to be changed, as they are now the rdn attributes for users and groups respectively. 


Note #2: If you choose to implement this method, ensure you cleanup the Portal databases after updating the user or group data per the instructions in this document [https://www.ibm.com/support/docview.wss?uid=swg21377025].

RELATED INFORMATION
 Java and JNDI [http://docs.oracle.com/javase/tutorial/jndi/ldap/jndi.html]
PUMA sample scenarios [http://www.ibm.com/developerworks/websphere/zones/portal/proddoc/dw-w-pumascenarios/index.html]


 


Cross reference information Segment Product Component Platform Version Edition Organizational Productivity- Portals & Collaboration WebSphere Portal End of Support Products AIX, HP-UX, IBM i, Linux, Solaris, Windows, z/OS 7.0, 6.1