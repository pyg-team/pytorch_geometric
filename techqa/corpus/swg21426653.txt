Title: IBM Why is the asnqacmd command failing with ASN0507E? - United States

Text:
ASN0507E TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After a Q Apply program starts, all asnqacmd commands that are run against the Q Apply program fail with the following error:

ASN0507E "AsnQAcmd" : "QASN1" : "Initial" : The program could not create the replication communications message queue.

This error can happen with asnqccmd, asnacmd and asnccmd commands as well. The solution is the same for all these commands. 


CAUSE
The asnqacmd program is not able to create its IPC command message queue. The asnqacmd program uses the message queue to communicate with Q Apply. Every time the asnqacmd program starts, it tries to create a new message queue. If the message queue exists, the asnqacmd program tries to remove the queue and create a new one.

DIAGNOSING THE PROBLEM
Run the asnqacmd command using the logstdout option. The asnqacmd output should display the key value of the message queue that asnqacmd is attempting to create and the reason that asnqacmd could not create the message queue. 




Example -

asnqacmd apply_server=SAMPLE status logstdout

ASN0600I "AsnQAcmd" : "" : "Initial" : Program "asnqacmd 9.1.0" is starting.
ASN0592I "AsnQAcmd" : "QASN1" : "Initial" The program attached to the IPC queue with keys "(0x30000004)".
ASN0596I "AsnQAcmd" : "QASN1" : "Initial" The program could not create an IPC queue with keys "(0x30000005)" for path "/myDir/SAMPLE.QASN.QAPP.IPC.CMD2719858". OSSE reason is "The specified message queue ID already exists for the key parameter".
ASN0507E "AsnQAcmd" : "QASN1" : "Initial" : The program could not create the replication communications message queue.

If the reason is "The specified <resource> ID already exists for the key parameter," perform the steps below to remove the file and its associated message queue manually. 

Please note that the first IPC queue reported in the ASN0592I message, with keys (0x30000004), is the IPC queue for the Q Apply program itself. Q Apply did not have any problems creating this IPC queue, and this should be left untouched. 


RESOLVING THE PROBLEM
1. Note the key value in the ASN0596I message. The key value will look similar to this: 0x30000005 in the example above.

2. Log on to the server with the user ID that was used to start asnqacmd.


Enter the following command for the key of the message queue asnqacmd was unable to create. 

ipcs grep | 0x30000005 

If the key is located, note its IPC resource type, ID, and owner. The IPC resource type (m, q, or s) will be in column 1 of the IPCS output, and the ID will be in column 2. 

3. If the key is not located, log on to the server using the superuser ID and enter the IPCS command in step 2 above for the key. Note its IPC resource type, ID, and owner as in step 2.

4. Log on to the server using the user ID that owns the IPC resources located in step 2 or step 3 above. 

If the key identifies a shared memory segment, remove the shared memory segment:
ipcrm -m ID 

If the key identifies a semaphore, remove the semaphore:
ipcrm -s ID 

If the key identifies a message queue, remove the message queue: 
ipcrm -q ID 

5. Log on to the server using the user ID that owns the IPC file that was specified in the ASN0596I message noted in Step 1. Enter a command to remove the IPC file, as in this example: 

rm /myDir/SAMPLE.QASN.QAPP.IPC.CMD2719858 

6. Reissue the asnqacmd command.