Title: IBM Connect:Direct error CSPA317E certificate failures - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When trying to send from a Windows server to a UNIX server, receiving errors related to the certificates private key.


SYMPTOM
IBM Sterling Connect:Direct (C:D) for Windows version 4.6.0.2 build 35, displays the error 

CSPA317E Error loading certificate private key rc 8, fdbk 168 

IBM Sterling Connect:Direct for UNIX, version 4.1.0.2, destination server, displays the errors 

Message ID XIPT016I, rc=16, fdbk=0.|MSST=TCP lost the connection. System error is Broken pipe.
Message ID XIPT008I, rc=8, fdbk=0.|MSST=TCP write failed. System error is Error 0.
Message ID XSMG623I, rc=8, fdbk=8.|MSST=The send response operation failed.

CAUSE
Connect:Direct Windows can not decrypt the private key:


CipherSuites: DES-CBC3-SHA
cdspssl: SSL_CTX_use_PrivateKey_file err=168, file C:\Program Files\Sterling
Commerce\Connect Direct v4.6.00\Server\Secure+\Certificates\keycert2013_copy.txt failed
cdspssl: Error queue first 0D0680A8:lib(13):func(104):reason(168)
cdspssl: Error queue last 140B0009:lib(20):func(176):reason(9)
..
asn1 encoding routines:ASN1_CHECK_TLEN:wrong tag:tasn_dec.c:1002:

asn1 encoding routines:ASN1_ITEM_EX_D2I:nested asn1 Type=PKCS8_PRIV_KEY_INFO

PKCS12 routines:PKCS12_DECRYPT_D2I:decode error:.\crypto\pkcs12\p12_decr.c:140: 

PEM routines:PEM_ASN1_read_bio:ASN1 lib:.\crypto\pem\pem_pkey.c:122:

SSL routines:SSL_CTX_use_PrivateKey_file:PEM lib:.\ssl\ssl_rsa.c:709:



ENVIRONMENT
IBM Sterling Connect:Direct for Windows 4.6.02 

IBM Connect:Direct for Unix 4.1.02



RESOLVING THE PROBLEM
1. Decrypt the key using openssl:

# openssl pkcs8 -in /tmp/oldpriv.key -out /tmp/newpriv.rsa
Enter Password:
# cat /tmp/newpriv.rsa
-----BEGIN RSA PRIVATE KEY-----
...
-----END RSA PRIVATE KEY-----
#

2. Re-encrypt using the following command:

openssl pkcs8 -topk8 -v2 des -in /tmp/newpriv.rsa -out
/tmp/oldpriv.newkey
Enter Encryption Password:
Verifying - Enter Encryption Password:

3. Create new Keycert file using new encrypted private key above and
existing certificate