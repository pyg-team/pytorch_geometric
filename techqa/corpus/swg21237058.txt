Title: IBM Could not determine synchronization mode for replica - United States

Text:
1237058; Could not determine synchronization mode; Could not determine synchronization mode for replica; synchronization mode; syncreplica -import; update; packet; syncmgr TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This technote explains why the error, multitool: Error: Could not determine synchronization mode for replica "some_replica_name", occurs when attempting to export or import an update packet in IBM® Rational® ClearCase MultiSite®. 

SYMPTOM
 

Attempts to export or import a syncreplica packet, results in the following error:

multitool: Error: Could not determine synchronization mode for replica "replica_name"


CAUSE


There are multiple possible causes for this error which include the following:


 1. The updated VOB registry files may have been overwritten. During the upgrade an upgrade tool rgy_upgrade is run to upgrade the VOB registry objects on the registry server. If those updated registry files are overwritten with a pre-upgrade copy of those files, (in ... /var/adm/rational/clearcase/rgy on UNIX® and Linux® or ...\var\rgy on Windows®), this would back out the updates causing this error.
    
 2. The import may report an error like the following if the patches are not installed correctly:
    
    multitool: Warning: Version mismatch, software:5.0, packet:3.0
    multitool: Error: Could not determine synchronization mode for replica "myhost"
    
    You may run into this issue if the latest ClearCase patches have been installed, but the latest MultiSite patches have not been installed on the server.
    
    For example, the latest ClearCase patches are clearcase_p2003.06.00-21 and clearcase_p2003.06.00-22, while the latest MultiSite patch is multisite_p2003.06.00-8. In the below cleartool -verall output, the ClearCase patches are current, but the latest MultiSite patch only goes up to multisite_p2003.06.00-6.
    
    %cleartool -verall
    ClearCase version 2003.06.00 (Fri Apr 25 09:05:22 EDT 2003)
    clearcase_p2003.06.00-2 (Wed Aug 20 14:45:03 EDT 2003)
    clearcase_p2003.06.00-3 (Thu Jan 29 16:37:58 EST 2004)
    clearcase_p2003.06.00-4 (Fri Apr 02 17:50:59 EST 2004)
    clearcase_p2003.06.00-5 (Wed Apr 07 17:24:54 EDT 2004)
    multisite_p2003.06.00-6 (Fri Dec 03 09:14:05 EST 2004)
    clearcase_p2003.06.00-15 (Wed Nov 24 11:03:49 EST 2004)
    clearcase_p2003.06.00-17 (Thu Dec 09 08:20:07 EST 2004)
    clearcase_p2003.06.00-19 (Tue Apr 05 22:23:24 EDT 2005)
    clearcase_p2003.06.00-20 (Wed Apr 06 08:26:56 EDT 2005)
    clearcase_p2003.06.00-21 (Wed Apr 06 16:09:19 EDT 2005)
    clearcase_p2003.06.00-22 (Tue Apr 26 12:19:27 EDT 2005)
    <cut>
    
 3. The packet being imported is old, and it references a replica that no longer exists or, at least, it does not reside on this host.
    
 4. The synchronization mode of that replica is not set.
    
    To confirm, check the synchronization mode of the replica with the command:
    
    multitool syncserver -inquire -vob <vobtag>
    
    Example:
    
    multitool> syncserver -inquire -vob \km
    vob:\km sync method: not set
    
    
 5. You may experience this problem after a VOB was migrated to a new server and the replica hostname is wrong. The output of a multitool lsreplica -l will display the wrong host for the replica. 
    The output of a cleartool lsvob may also not display the replicated attribute(replicated)for the VOB where the packet is being importing although the VOB is replicated.


RESOLVING THE PROBLEM
 


The rgy_upgrade tool will have to be run manually.

Verifying successful ClearCase MultiSite installation (CC 2003.06):

In some cases, you may have installed ClearCase MultiSite Version 2003.06.14 on your registry and replica servers, but the installation may not have completed successfully. 

To verify that the ClearCase MultiSite Version 2003.06.14 installation completed successfully on your ClearCase registry server, perform the following steps: 


 1. Run a cleartool hostinfo –long command and record the name of the ClearCase registry server machine.
    
    
 2. Run a multitool lssetting –site –inquire command and verify that ms_site_name is set to Site_registry-server-name. If the ms_site_name setting is not available, your ClearCase registry server was not upgraded correctly.


To verify that the ClearCase MultiSite Version 2003.06.14 installation completed successfully on a ClearCase replica server, run a cleartool lsvob –host command and verify that all replicated VOBs have the .replicated. flag set. If the .replicated. flag is not present, your ClearCase replica server was not upgraded correctly. 

Fixing an unsuccessful ClearCase MultiSite installation: 

WINDOWS: 
If the ClearCase MultiSite installation did not complete successfully on either your registry server or one or more replica servers, the following steps must be taken: 
 * On your ClearCase registry server, run the following command: 

<ccase–home–dir>\bin\rgy_upgrade.exe -site 
 * On a ClearCase replica server, run the following command for each replicated VOB:

<ccase–home–dir>\bin\ rgy_upgrade.exe -tag vob-tag [...] 


UNIX/LINUX: 
If the ClearCase MultiSite installation did not complete successfully on either your registry server or one or more replica servers, the following steps must be taken: 
 * On your ClearCase registry server, run the following command: 

<ccase–home–dir>/etc/ rgy_upgrade -site 
 * On a ClearCase replica server, run the following command for each replicated VOB:

<ccase–home–dir>/etc/ rgy_upgrade -tag vob-tag [...]


Note: If there are many VOBs on the server that need to be updated, you can use the following syntax to update all VOBs on the current host rather than specifying each VOB tag individually. 

UNIX: <ccase–home–dir>/etc/ rgy_upgrade -vobs 
WINDOWS: <ccase–home–dir>\bin\ rgy_upgrade.exe -vobs 


Solution 2 (CC 2003.06) Install the latest MultiSite patch whenever you upgrade to the latest ClearCase patches.



Solution 3 

The update packet can be removed (deleted) using the appropriate operating system command. 




Solution 4 

Set the desired synchronization mode on the replica.


 * If the replica should be managed run the command:
   
   multitool syncserver -manage -vob <vobtag>


 * If the replica should be unmanaged run the command:
   
   multitool syncserver -nmanage -vob <vobtag>


Review the ClearCase MultiSite Command Reference Guide on the topic of syncserver ( multitool man syncserver) for more information. 


Solution 5 

Change the replica hostname using the multitool chreplica [http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m1/index.jsp?topic=/com.ibm.rational.clearcase.cc_ms_ref.doc/topics/mt_chreplica.htm] -host command and specifying the correct hostname. 





Cross reference information Segment Product Component Platform Version Edition Software Development Rational ClearCase Multitool