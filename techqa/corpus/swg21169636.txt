Title: IBM Documentation required by WebSphere MQ support to diagnose an SSL problem - United States

Text:
Documentation required by WMQ to diagnose an SSL ssl doc MQSeries mqseries Websphere MQ mqm400l2 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You want to know what documentation is required by the WebSphere MQ support team to diagnose an SSL problem. 

RESOLVING THE PROBLEM
Collect the following documentation for the WebSphere MQ support team. 
To address SSL set up problems, please make the following checks and collect the following documentation:

1) Verify the following components are installed at the required release level: 

 * MQ is at v7 with refresh pack 0.1.10 or greater 
 * MQ is at v6 with fixpack 0.2.2 or greater 
 * MQ is at v5.3, ideally with fixpack 14 (5724B41 V5R3M0 WebSphere MQ for iSeries) 
 * HTTP Server is installed (5722DG1 V5R2M0 IBM HTTP Server) 
 * Operating system level (5722SS1 V5R2M0 L00 Operating System/400) 
 * DCM is installed (5722SS1 V5R2M0 OS/400 - Digital Certificate Manager) 
 * Check the Cipher Spec level (5722AC3 V5R2M0 Crypto Access Provider 128-bit for AS/400) 


2) If possible check the equivalent level at the remote end. 

3) Issue the DSPMQM command for the queue managers involved, in particular review the key repository path. 

SSL Key Repository: /QIBM/USERDATA/ICSS/CERT/CERTAUTH/DEFAULT 
 *  There should not be a .KDB extension in this parameter. 


4) Check that QMQMADM has *RX permission to ALL directories in the IFS path for the key repository and also to the *.KDB file. 

Check QMQMADM authority on the path containing the stash file QMQMADM should have *RWX to the file: 

/ssl/Stash.sth in the qmgr directory 


5) Channel definitions from both ends. 

DSPMQMCHL we are particularly interested in the keywords 

SSL client authentication: *REQUIRED 
SSL CipherSpec: *NULL_MD5 


If you get to this point..and can't see a problem then collect the following doc as well as the definitions, and authorities listed above. 

6) MQ TRACE taken at the same time..at both ends. 

7) AMQERRnn.LOG files at Queue Manager level. 

8) Job logs from AMQRMPPA/RUNMQCHL /AMQZLAA0. 



Note: If you receive the following error message: 

AMQ9660......SSL key repository: password stash file absent or unusable 

If it's not permission and not the wrong path, it may be incorrect, you can reset it with: 

CHGMQM ... SSLKEYRPWD('mypassword') 

AMQ9657...... The key repository could not be opened (channel '&3'). 

Check path permissions '/qibm/userdata/icss/cert/server/. 
Check ssl key repository path on QMGR. Is should NOT have .kdb extension. 


If there is a problem with labels on certificates, unless they are missing completely, 
it is most likely a case sensitive issue, or a spelling error. The label should be lower 
case ibmwebspheremq'yourqmgr' where 'yourqmgr' is your queue manager name. 

It might be that you have fixed the problem, but you will need a restart to pick up the changes. 


When changes become effective: 
 * Changes to the certificates in the certificate store and to the key repository attribute become effective:  * When a new outbound single channel process first runs an SSL channel. 
    * When a new inbound TCP/IP single channel process first receives a request to start an SSL channel. 
   
   

 * For channels that run as threads of a process pooling process (amqrmppa), when the process pooling process is started or restarted and first runs an SSL channel. If the process pooling process has already run an SSL channel, and you want the change to become effective immediately, restart the queue manager. 

 * For channels that run as threads of the channel initiator, when the channel initiator is started or restarted and first runs an SSL channel. If the channel initiator process has already run an SSL channel, and you want the change to become effective immediately, restart the queue manager. 

 * For channels that run as threads of a TCP/IP listener, when the listener is started or restarted and first receives a request to start an SSL channel. 

 

PRODUCT ALIAS/SYNONYM
 WMQ MQ IBMMQ