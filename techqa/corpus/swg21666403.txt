Title: IBM WinCollect troubleshooting: The RPC server is unavailable. Error code 0x06BA - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 What can I do to try to troubleshoot RPC issues with my WinCollect agent? 

CAUSE
The Wincollect agents fails to open the event log for a remote event source with ''Reason: Error code 0x06BA: The RPC server is unavailable.'

ANSWER
About this issue 

This error message is typically displayed when a remote machine being monitored is being rebooted or is simply not on the network anymore. If the WinCollect machine itself loses its network connection or cannot be discovered via DNS, then a large number of RPC server unavailable messages can be displayed in the error log. This error message might also be seen when the host being polled is installed in a virtual environment. This is due to virtual machines hibernating because they were set up with the default power management profile and the WinCollect agent cannot connect.


The error message
<13>Apr 17 10:54:41 myhostname.com LEEF:1.0|IBM|WinCollect|7.2|4|src=myhostname.com dst=10.10.10.10 sev=5 log=Device.WindowsLog.EventLogMonitor msg=Failed to open event log myhostname.com [myhostname.com:Security]; will try again in approx 60 seconds. Reason: Error code 0x06BA: The RPC server is unavailable.

If this error is accompanied by another error mentioning “Interface not found” it is very likely that either the remote machine or the WinCollect machine is being rebooted or hibernating in a VM environment.



The most common causes of the RPC server is unavailable message
This article will apply to you if:


 *  You have WinCollect log sources that remotely poll for events from other Windows systems, but the remote host is unreachable. You have WinCollect log sources where the Local System check box selected and the log source has a non-resolvable hostname or is using the FQDN instead of the short form hostname in the Log Source Identifier field (See Solution 1 below). If you have a cloud environment or network environment where the WinCollect log source cannot resolve the IP address, hostname, or a network device is blocking ports/traffic. Services are not started on the Windows host to collect events.
   
   








SOLUTION 1. IS THE LOG SOURCE CONFIGURED WITH THE CORRECT IP ADDRESS OR HOST NAME IN THE LOG SOURCE IDENTIFIER FIELD?
The Log Source Identifier field should be populated with either an IP address or hostmane. You should not use a FQDN myhostname.domain.com in the Log Source Identifier field with remote polled events because there is a separate Domain field in the log source configuration when remotely polling Windows systems. For example, \\myhostname.domain.com will generate RPC error messages because the field expects the short form of the hostname or an IP address. 

 

 * 
 * Correct Log Source Identifier values
 *   * Hostname 
    * IP address
   
   
 * 
 * Incorrect Log Source Identifier values
 *   * \\myhostname 
    * myhostname.domain.com (This is OK only in the case where the Local System check box is selected. When 
      
      
      Note: The agent must be configured to allow automatic updates to update the log source on the remote agent. The Configuration Polling Interval for the agent determines the frequency with which the agent requests log source and software updates from the Console. After you save your log source update to correct the Log Source Identifier field, you can click save, then wait for the configuration interval to expire, which will update the remote WinCollect agent.
      Automatic updates must be true to receive log source configuration updates from the console. [/support/docview.wss?uid=swg21666403&aid=1] [/support/docview.wss?uid=swg21666403&aid=1]
   
   







SOLUTION 2. VERIFY THE STATUS OF THE REMOTE SYSTEM

Is the remote system powered on, available on the network, or is the remote system hibernating? 







SOLUTION 3. VERIFY THE CORRECT SERVICE ARE ENABLED ON THE REMOTE SYSTEM

If the WinCollect agent is logging errors, the administrator can verify that the services requires by RPC are enabled on the remote system. 

Procedure 

 *  Log in to the remote system. Select Start > Programs > Administrative Tools, and then click Services. In the Status column, the Remote Procedure Call (RPC) service must display Started. In the Status column, the Remote Registry service must display Started.
   







SOLUTION 4. VERIFY THE USER IN YOUR LOG SOURCE INCLUDES THE CORRECT USER RIGHT ASSIGNMENT 

The user defined in your log source must include the ability to manage auditing and security log. 

Procedure 

 *  Log in to the remote system. Select Start > Programs > Administrative Tools, and then click Local Security Policy. From the navigation menu, select Local Policies > User Rights Assignment. Right-click on Manage auditing and security log and select Properties. From the Local Security Setting tab, click Add User or Group to add your WinCollect user to the local security policy. Log off of the Windows host and attempt to remotely poll the host for Windows events with your WinCollect log source. 
 * 
 * 
 * 
 * 
 * 
 * 






SOLUTION 5. VERIFY YOU CAN OPEN THE EVENT VIEWER ON THE REMOTE SYSTEM

If you are remotely polling another Windows host for events, you can try to remotely open the event viewer from the system running the WinCollect agent. 

Procedure 

 *  Log on to the Windows host that has the WinCollect agent locally installed. Select Start > Programs > Administrative Tools, and then click Event Viewer. Click Action > Connect to another computer. Select the Another computer option and type the IP address or host name of the server you want to remotely poll for events. Click the Connect as another user check box. Click Set User. In the User name field, type the domain\username for the user you specified in your log source configuration. For example, test.qradar.com\JonathanP. Type the password for the user and click OK. 

 * 
 * What to do next
 *  If you cannot remotely view the event viewer on the remote host, then an RPC Server is unavailable message is displayed. 
   
   Administrators can complete an nslookup from the command-line on the host name or IP address you specified. The nslookup should provide you with the host name or FQDN (fully qualified domain name) that you can use to try and remotely connect to the event viewer.
   
   Procedure
   1. Click Start > Run, type cmd and press Enter.
   2. To verify the DNS entry for your computer, type the following command: nslookup %computername%
   3. If the results return an unexpected IP address or name, then you might have to correct conflicting IP information your DNS server. 
   
   Note: If you think this issue might be related to the DNS server and the location of the system, you can do an nslookup for the Active Directory server. To see the Active Directory server in an type nslookup ad or nslookup ad.domain.name and compare the results.
   
   4. If the DNS server is not in your zone or if the lookup does not resolve correctly, use the Enable Active Directory Lookups check box.
   5. To specify a server to complete an Active Directory Lookup, type an IP address or FQDN of a domain controller in the Override Domain Name Controller field.
   6. To specify a server to complete the DNS Lookup for a host, type an IP address or FQDN of a domain controller in the Override DNS Domain Name field. 
 *   * If you successfully connected to the event viewer of the remote system, then you should verify that the log source configuration is correct and that the Log Source Identifier field contains the host name or FQDN used to connect to the event viewer of the remote system. 
      
   
   







SOLUTION 6. VERIFY REQUIRED PORTS ARE OPEN ON THE WINDOWS HOST AND THAT REMOTE EVENT LOG MANAGEMENT IS ALLOWED

All firewalls located between the agent and the system that is being polled for events must allow communication on the following ports: To verify the Windows Firewall allows Remote Event Log Management: 

Procedure 

 *  Log in to the remote system. Select Start > Programs > Administrative Tools, and then click Windows Firewall with Advanced Security. Click Inbound Rules. Verify that the Enabled column lists Yes for all of the Remote Event Log Management firewall rules. 
 * 
 * List of ports used by WinCollect to remotely poll for events. 
 *  TCP port 135 Microsoft Endpoint Mapper UDP port 137 NetBIOS name service UDP port 138 NetBIOS datagram service TCP port 139 NetBIOS session service TCP port 445 Microsoft Directory Services for file transfers that use a Windows share 
 * 
 * Note: If you are using DNS for name resolution, you might also verify that UDP and TCP port 53 are listening. You might need to have firewall exceptions in place on your Windows firewall for these ports. 


Note: To verify if a port is listening, administrators can type the following command: netstat -an | find "port#" 

 

 

 

------
Where do I find more information? 
If you have additional questions or some of this content is not clear, you can see the QRadar forum or contact customer support: 

 * Online QRadar Customer Forums [https://ibm.biz/BdR2kC] 
 * Submit and manage your support tickets online 24x7 using IBM Service Request [http://www.ibm.com/software/support/servicerequest/quick_start.html] 
 * QRadar Downloads - IBM Fix Central [http://www.ibm.com/support/fixcentral/options?selection=Security+Systems;ibm/Other+software/IBM+Security+QRadar+SIEM]