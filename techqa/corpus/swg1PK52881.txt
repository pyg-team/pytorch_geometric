Title: IBM PK52881: J2CA0081E ERROR MAY CAUSE JDBC CONNECTIONS TO LEAK - United States

Text:
z/os  FIXES ARE AVAILABLE
Java SDK 1.5 SR8 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24020073]
Java SDK 1.5 SR8 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24021203]
Java SDK 1.5 SR10 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24024201]
6.1.0.31: Java SDK 1.5 SR11 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24026453]
6.1.0.33: Java SDK 1.5 SR12 FP1 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24027786]
6.1.0.29: Java SDK 1.5 SR11 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24025191]
6.1.0.35: Java SDK 1.5 SR12 FP2 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24028574]
6.1.0.37: Java SDK 1.5 SR12 FP3 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24029525]
6.1.0.39: Java SDK 1.5 SR12 FP4 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24030426]
6.1.0.41: Java SDK 1.5 SR12 FP5 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24031035]
6.1.0.43: Java SDK 1.5 SR13 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24031963]
6.1.0.45: Java SDK 1.5 SR14 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24033270]
6.1.0.47: WebSphere Application Server V6.1 Fix Pack 47 [http://www-01.ibm.com/support/docview.wss?uid=swg24035508]
6.1.0.47: Java SDK 1.5 SR16 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24035649]
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Multiple instances of the following error can be seen in the
   application server servant output.  If this error is
   encountered, a physical connection to the database will not be
   closed.
   
   Trace: 2007/05/30 18:07:18.952 01 t=9BB448 c=UNK key=P8
   (13007002)
     ThreadId: 0000003c
     FunctionName: com.ibm.ejs.j2c.MCWrapper
     SourceId: com.ibm.ejs.j2c.MCWrapper
     Category: SEVERE
     ExtendedMessage: BBOO0220E: J2CA0081E: Method cleanup failed
   while trying to execute method cleanup on ManagedConnection
   WSRdbManagedConnectionImpl@3d723d72 from resource
   jdbc/DB2DATASOURCE5.
   Caught exception: com.ibm.ws.exception.WsException: DSRA0080E:
   An exception was received by the Data Store Adapter. See
   original exception message: Cannot call 'cleanup' on a
   ManagedConnection while it is still in a transaction..
   .at com.ibm.ws.rsadapter.exceptions.DataStoreAdapterException
   .at com.ibm.ws.rsadapter.exceptions.DataStoreAdapterException
   .at com.ibm.ws.rsadapter.AdapterUtil.createDataStoreAdapterExcep
     tion
   .at com.ibm.ws.rsadapter.spi.WSRdbManagedConnectionImpl.
     cleanupTransactions
   .at com.ibm.ws.rsadapter.spi.WSRdbManagedConnectionImpl.cleanup
   .at com.ibm.ejs.j2c.MCWrapper.cleanup
   .at com.ibm.ejs.j2c.FreePool.returnToFreePool
   .at com.ibm.ejs.j2c.PoolManager.release
   .at com.ibm.ejs.j2c.MCWrapper.releaseToPoolManager
   .at com.ibm.ejs.j2c.RRSLocalTransactionWrapper.afterCompletion
   .at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.
     informSynchronizations
   .at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.cleanup
   .at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.end
   .at com.ibm.ws.webcontainer.webapp.WebAppTransactionCollaborat
     or.postInvoke
   .at com.ibm.ws.wswebcontainer.webapp.WebApp.transactionPostIn
     voke
   .at com.ibm.ws.wswebcontainer.servlet.ServletWrapper.handleRequ
     est
   ...
   .at com.ibm.ws.util.ThreadPool$ZOSWorker.run
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere Application Server    *
   *                 V6.1 for z/OS using DB2 Universal Drive      *
   *                 type-2 z/OS connectivity and local           *
   *                 transaction support.                         *
   ****************************************************************
   * PROBLEM DESCRIPTION: Multiple instances of J2CA0081E:        *
   *                      Method cleanup failed -- cannot call    *
   *                      'cleanup' on a ManagedConnection        *
   *                      while it is still  in a transaction --  *
   *                      causing connection leaking and          *
   *                      subsequent                              *
   *                      ConnectionWaitTimeoutException.         *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   Multiple instances of the following error can be seen in the
   application server servant output.  If this error is
   encountered, a physical connection to the database will not be
   closed.
   
   Trace: 2007/05/30 18:07:18.952 01 t=9BB448 c=UNK key=P8
   (13007002)
   ThreadId: 0000003c
   FunctionName: com.ibm.ejs.j2c.MCWrapper
   SourceId: com.ibm.ejs.j2c.MCWrapper
   Category: SEVERE
   ExtendedMessage: BBOO0220E: J2CA0081E: Method cleanup failed
   while trying to execute method cleanup on ManagedConnection
   WSRdbManagedConnectionImpl@3d723d72 from resource
   jdbc/DB2DATASOURCE5.
   Caught exception: com.ibm.ws.exception.WsException: DSRA0080E:
   An exception was received by the Data Store Adapter. See
   original exception message: Cannot call 'cleanup' on a
   ManagedConnection while it is still in a transaction..
   .at com.ibm.ws.rsadapter.exceptions.DataStoreAdapterException
   .at com.ibm.ws.rsadapter.exceptions.DataStoreAdapterException
   .at com.ibm.ws.rsadapter.AdapterUtil.createDataStoreAdapterExcep
   
   tion
   .at com.ibm.ws.rsadapter.spi.WSRdbManagedConnectionImpl.
   cleanupTransactions
   .at com.ibm.ws.rsadapter.spi.WSRdbManagedConnectionImpl.cleanup
   .at com.ibm.ejs.j2c.MCWrapper.cleanup
   .at com.ibm.ejs.j2c.FreePool.returnToFreePool
   .at com.ibm.ejs.j2c.PoolManager.release
   .at com.ibm.ejs.j2c.MCWrapper.releaseToPoolManager
   .at com.ibm.ejs.j2c.RRSLocalTransactionWrapper.afterCompletion
   .at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.
   informSynchronizations
   .at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.cleanup
   .at com.ibm.ws.LocalTransaction.LocalTranCoordImpl.end
   
   
    
   
   

PROBLEM CONCLUSION
 *  Local transaction has been modified to correctly enlisted with
   RRS to commit or rollback on a transaction boundary and allow
   the connection to be cleanup without J2CA0081E.
   
   APAR PK52881 is currently targeted for inclusion in Service
   Level (Fix Pack) 6.1.0.13 of WebSphere Application Server V6.1
   for z/OS.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK52881
   
   
 * REPORTED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * REPORTED COMPONENT ID
   5655I3500
   
   
 * REPORTED RELEASE
   610
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-09-13
   
   
 * CLOSED DATE
   2007-10-20
   
   
 * LAST MODIFIED DATE
   2007-12-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPHERE FOR Z
   
   
 * FIXED COMPONENT ID
   5655I3500
   
   

APPLICABLE COMPONENT LEVELS
 * R500 PSN
   UP
   
   
 * R601 PSN
   UP
   
   
 * R610 PSY UK31212 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK31212]
   UP07/11/22 P F711
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.