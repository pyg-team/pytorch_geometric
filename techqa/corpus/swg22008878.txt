Title: IBM Daeja ViewONE Virtual fails to load using Load balancer and IBM Websphere On Demand Router - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Daeja Virtual viewer works as expected when accessing the node that hosts the viewer directly. 
However when the viewer is launched using the Load Balancer URL, it fails to load at all and only a white screen is seen in its place. 

SYMPTOM
Seen in place of viewer and loaded document:

[/support/docview.wss?uid=swg22008878&aid=1] [/support/docview.wss?uid=swg22008878&aid=1]


CAUSE
Caching is enabled in the Websphere OnDemand Router (WAS ODR) and this causes WAS ODR to add its own cache control headers. These cache-control headers prevent the client PC from making the required callbacks to the back end webserver to obtain the resources it needs to start.

ENVIRONMENT
Any load balanced environment using Webshere OnDemand Router (ODR)

DIAGNOSING THE PROBLEM
To diagnose this issue, the developer tools in the browser need to be used to analyse the network requests.




In the console log for the success case, you should see a call for "getViewoneBootstrap" - this call does not appear anywhere in the console in the failure case.


From the network traces, the following differences can be seen:

Request via Loadbalancer\ODR:

HTTP/1.1 200 OK
X-Powered-By: Servlet/3.0
Content-Type: text/css; charset=UTF-8
Cache-Control: max-age=86400
Last-Modified: Tue, XX Sep XXXX 18:35:44 GMT
Content-Language: en-GB
Date: Wed, XX Sep XXXX 10:32:55 GMT
Age: 13378
Transfer-Encoding: chunked
Content-Encoding: gzip


Request to App server direct:

HTTP/1.1 200 OK
X-Powered-By: Servlet/3.0
Date: Wed, XX Sep XXXX 14:15:27 GMT
Content-Type: text/plain
Last-Modified: Wed, XX Jul XXXX 14:33:38 GMT
Content-Length: 9131
Content-Language: en-GB




RESOLVING THE PROBLEM
Disable the WAS ODR caching completely form the Admin console: 


Servers -> On Demand Routers -> <ODR server name> -> On Demand Router Settings -> On Demand Router Properties -> On Demand Router settings
-> Caching
From here, uncheck the "Enable caching" tick box. 

Restart the application in full for the setting to take effect. 

RELATED INFORMATION
 WAS ODR Caching Configuration [https://www.ibm.com/support/knowledgecenter/en/SSAW57_8.5.5/com.ibm.websphere.nd.doc/ae/tjpx_cachestatdyn.html]