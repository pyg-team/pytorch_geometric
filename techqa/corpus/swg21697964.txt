Title: IBM SQL Server Agent fails connecting to the database - United States

Text:
KOQSQLD database open failed not exist SRVE107E sql server agent connection fails client TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When the ITM MSSQL Server Agent is started, it fails connecting the monitored database and as a consequence no data is retrieved, TEP views are empty. 

SYMPTOM
The collector log file (<hostname>_OQ_<instance>_col.out) shows the following messages: 

**********
MSU0500I (2015-02-14 09:48:52) (1452)SQLSTATE: 08001, Native error: 17, 
Message: [Microsoft][ODBC SQL Server Driver][DBNETLIB]SQL Server does not exist or access denied.
MSU0500I (2015-02-14 09:48:52) (1452)SQLSTATE: 01000, Native error: 53, 
Message: [Microsoft][ODBC SQL Server Driver][DBNETLIB]ConnectionOpen (Connect()). 
MSU0425E (2015-02-14 09:48:52) (1452)Database open failed. Server:MV-PLMDB User:<user>. 
SRVE107E (2015-02-14 09:48:52) KOQSQLD(4068) (1452)Could not connect to MS SQL Server
********


DIAGNOSING THE PROBLEM
This is a common condition that may occur if the userID used to connect the database does not exist, is inactive or an invalid password is used. 

But there are also other possible scenarios where you can experience above error sequence. 

1) If the userID has not been granted public privileges on the monitored databases 

2) if the SQL Server has been configured to listen to a different port than default 1433. 

3) if the communication protocols (tcpip, named pipes) are not enabled and configured in the SQL Server client configuration. 

 

If all the above three conditions have been already verified and are ok, then the failure can be caused by the value of COLL_PORT parameter.


RESOLVING THE PROBLEM
In order to check if you are in this scenario, please follow below steps: 

 
1. Open SQL Server Configuration Manager. 
2. Go to tab 'SQL Server Network Configuration' 
3. Select the 'Protocols for <instance name>' tab for required instance 
(e.g. Protocols for MSSQLSERVER for default instance) 
4. Select 'TCP\IP' protocol in the right column. 
5. Right click on that and select properties. 
6. 'TCP\IP Properties' window will be opened. 
7. Go to 'IP Addresses tab' 
8. Check if the value of 'TCP Port' attribute is blank. 

If the value is blank for all the IP values then follow the steps below to change value of COLL_PORT accordingly: 

a) Open Manage Tivoli Enterprise Monitoring Services (MTEMS) window on Agent machine. 
b) Stop the configured Instance from MTEMS Window 
c) Select the 'Monitoring Agent for Microsoft SQL Server <instance name>' in the MTEMS window.
<instance name> is the agent instance we are working with,
d) Select the menu 'Actions' > 'Advance' > Edit Variables. 
e) A new window will be showed, having caption 
'Monitoring Agent for Microsoft SQL Server: Override Local Variable Settings' 
f) Please edit COLL_PORT value to 0, by clicking 'Edit'. 
COLL_PORT=0 
g) Click Ok button. 

Restart the agent and problem will be fixed.

 

PRODUCT ALIAS/SYNONYM
 ITCAM Microsoft SQL Server Agent V6.3