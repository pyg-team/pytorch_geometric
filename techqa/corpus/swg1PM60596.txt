Title: IBM PM60596: An Excel object makes FSR crash - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PERMANENT RESTRICTION.
    
   
   

ERROR DESCRIPTION
 *  Version: ?FSR 6.5.1 SP4 HFB?Office XP??Priority:
   ?High??Description of issue:?1. Create an FSR report and an
   Excel object;?2. Import the attached Excel file;?3. FSR will
   crash:??Type: COMException ?Message: The server threw an
   exception. (Exception from HRESULT: 0x80010105
   (RPC_E_SERVERFAULT)) ?Stack Trace: at Excel.WorkbookClass.Save()
   ?at Clarity.FSR.Office.ExcelWrapper.OpenCloseExcelApp(Workbooks
   myBooks, String ExcelFile, Int32
   updateExternalLinkMethodForExcel, FSRRefreshErrorCollection
   errorCollection, ObjectDataSourceInfo dataSourceInfo) ?at
   Clarity.FSR.Office.ExcelWrapper.GetWorkbookBinaryString(Applicat
   ionClass
   myExcel, Workbook wb, Boolean ignoreOpenInExcel, Int32
   updateExternalLinkMethodForExcel, String fileName, Boolean
   asFile, FSRRefreshErrorCollection errorCollection,
   ObjectDataSourceInfo dataSourceInfo) ?at
   Clarity.FSR.UI.Forms.LayoutForm.RefreshExcelObject_Refresh(Hasht
   able
   disconnectedSharedObjects, Boolean willUpdateNoteId, Int32
   objectId, ObjectRow objectRow, String xmlData,
   FSRRefreshErrorCollection errorCollection, ObjectDataSourceInfo
   dataSourceInfo) ?at
   Clarity.FSR.UI.Forms.LayoutForm.RefreshExcelObject(IEnumerable`1
   objectsToRefresh, Hashtable disconnectedSharedObjects, Boolean
   willUpdateNoteId, FSRRefreshErrorCollection errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.LoadAndRefreshObjects(IEnumerabl
   e`1
   objectsToRefresh, Hashtable disconnectedSharedObjects, Boolean
   willUpdateNoteId, FSRRefreshErrorCollection errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.LoadAndRefreshObjects(IEnumerabl
   e`1
   objectsToRefresh, Boolean willUpdateNoteId,
   FSRRefreshErrorCollection errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.ProcessNativeObjects_Refresh(Lis
   t`1
   nativeObjects, IEnumerable`1 sourceVariablesInSharedObjects,
   Boolean willUpdateNoteId, FSRRefreshErrorCollection
   errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.ProcessNativeObjects(List`1
   nativeObjects, List`1 allSharedObjects, List`1
   preprocessedSharedObjects, Boolean willUpdateNoteId,
   FSRRefreshErrorCollection errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.ProcessNativeObjects(List`1
   nativeObjects, List`1 allSharedObjects, Boolean
   willUpdateNoteId, FSRRefreshErrorCollection errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.RefreshForNavigation(ObjectRow
   objectRow, FSRRefreshErrorCollection errorCollection) ?at
   Clarity.FSR.UI.Forms.LayoutForm.RefreshExcelData(ObjectRow
   objectRow, ArrayList& worksheets_To_Refresh_HFM_On, String
   sFileName) ?at
   Clarity.FSR.UI.Forms.LayoutForm.RefreshExcelObjectData(Int32
   ObjID, ArrayList& s) ?at
   Clarity.FSR.UI.Forms.LayoutForm.ProcessExcelContent_Helper(Int32
   ObjID, String XmlData) ?at
   Clarity.FSR.UI.Forms.LayoutForm.ProcessExcelContent(Int32 ObjID,
   String XmlData) ?at
   Clarity.FSR.UI.Forms.LayoutForm.SetContentType(ContentType
   contentType) ?at
   Clarity.FSR.UI.Forms.LayoutForm.HandleSectionObjectSelection()
   ?at Clarity.FSR.UI.Forms.LayoutForm.InitControls() ?at
   Clarity.FSR.UI.Forms.LayoutForm.tlObj_AfterFocusNode(Object
   sender, NodeEventArgs e) ?at
   DevExpress.XtraTreeList.TreeList.RaiseAfterFocusNode(TreeListNod
   e
   node) ?at
   DevExpress.XtraTreeList.TreeList.InternalSetFocusedRowIndex(Int3
   2
   newFocusedRowIndex) ?at
   DevExpress.XtraTreeList.TreeList.set_FocusedRowIndex(Int32
   value) ?at
   DevExpress.XtraTreeList.Handler.TreeListHandler.NodePressedState
   .ChangeSelection(RowInfo
   pressRowInfo) ?at
   DevExpress.XtraTreeList.Handler.TreeListHandler.NodePressedState
   .Init()
   ?at
   DevExpress.XtraTreeList.Handler.TreeListHandler.SetControlState(
   TreeListState
   state) ?at
   DevExpress.XtraTreeList.Handler.TreeListHandler.NormalState.OnPr
   essNode()
   ?at
   DevExpress.XtraTreeList.Handler.TreeListHandler.NormalState.Mous
   eDown(MouseEventArgs
   e, TreeListHitTest ht) ?at
   DevExpress.XtraTreeList.Handler.TreeListHandler.OnMouseDown(Mous
   eEventArgs
   e) ?at
   DevExpress.XtraTreeList.TreeList.OnMouseDown(MouseEventArgs e)
   ?at System.Windows.Forms.Control.WmMouseDown(Message& m,
   MouseButtons button, Int32 clicks) ?at
   System.Windows.Forms.Control.WndProc(Message& m) ?at
   DevExpress.XtraEditors.Container.EditorContainer.WndProc(Message
   &
   m) ?at
   System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Messa
   ge&
   m) ?at
   System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message
   &
   m) ?at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd,
   Int32 msg, IntPtr wparam, IntPtr lparam) ??Operating System:
   Windows XP (Microsoft Windows NT 5.2.3790 Service Pack 2)
   ?Platform: Win32NT ?CLR Version: 2.0.50727.5653 ?.NET Framework:
   .NET Framework 4.0 ?Working Set: 207,34 MB ?Physical Memory:
   8,58 GB ?FSR Version: 6.5.1.1092 ?FSR DB Version: 6.5.1.127
   ?Excel Version: 10.0 ?Word Version: 10.0 ??Steps taken so
   far:?Saw the issue live at client;?Replicated the issue on my
   VPC ( FSR 6.6.0.454 and Office 2007 ).??ADDITIONAL
   DETAILS!!:??1. The file was created in Excel XP;?2. I determined
   the error is caused by the "OVERVIEW CLIENT RESHAPED" sheet. If
   you delete that sheet, the file can be imported. However I could
   not find out what exactly causes the error. I tried deleting
   elements from the sheet one by one, but I faced inconsistent
   behavior in FSR with no relevant results;?3. When you click on
   that sheet within Excel, you get an error: "The reference is not
   valid. References for titles, values, or sizes must be a single
   cell, row, or column.". This error does NOT appear to be related
   to the FSR error. If you delete the 5 chart ares in the Business
   Lines Clients section of the sheet, this error will go away, but
   the FSR error will not;?4. Re-creating the whole sheet did not
   solve the issue.
   
   
    
   
   

LOCAL FIX
 *  Workaround to import/save:
   1. Create a backup of the xls
   2. Open file in Excel2007/2010 and save it as .xlsm (there are m
   acros on the file)
   3. Open .xlsm file and save it as .xls
   4,. Import/Save file in FSR
   
   After workaround is applied a crash will appear on machines that
    have office 2007/2010 see FogBugz case 36037. This case should
   not affect the clients that have WinXp with Office Xp as in this
    scenario it works.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All Users                                                    *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * See error description.                                       *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Comments from Dev:
   This appears to be an Office XP specific issue and should not be
    present if the objects are created in a newer version of Excel.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM60596
   
   
 * REPORTED COMPONENT NAME
   COGNOS FSR
   
   
 * REPORTED COMPONENT ID
   5725D3400
   
   
 * REPORTED RELEASE
   61X
   
   
 * STATUS
   CLOSED PRS
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2012-03-16
   
   
 * CLOSED DATE
   2013-11-22
   
   
 * LAST MODIFIED DATE
   2013-11-22
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS