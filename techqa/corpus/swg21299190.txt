Title: IBM Out of Memory condition occurs during migration to WebSphere Portal V6.1 or V7.0 - United States

Text:
migration; outofmemoryerror; out of memory; WPv610GA; MIGR0272E; OOM; V61PRN; WPv7000eGA; error; out of memory error; portal preupgrade task; portal_pre-upgrade; task TECHNOTE (TROUBLESHOOTING)

PROBLEM
When running the portal-pre-upgrade task to export content from an earlier version of IBM WebSphereÂ® Portal, the heap might run out of memory and throw java.lang.OutOfMemory errors.

SYMPTOM
The following error occurs when running the portal-pre-upgrade task: 

[exec] MIGR0300I: The migration function is starting to save the existing WebSphere Application Server environment.
[exec] MIGR0302I: The existing files are being saved.
[exec] MIGR0385I: Starting to save profile wp_profile.
[exec] JVMDUMP006I Processing Dump Event "systhrow", detail "java/lang/OutOfMemoryError" - Please Wait.
[exec] JVMDUMP007I JVM Requesting Snap Dump using '/usr/IBM/wp610/AppServer/bin/Snap0001.20080303.173641.569434.trc'
[exec] JVMDUMP010I Snap Dump written to /usr/IBM/wp610/AppServer/bin/Snap0001.20080303.173641.569434.trc
[exec] JVMDUMP007I JVM Requesting Heap Dump using '/usr/IBM/wp610/AppServer/bin/heapdump.20080303.173641.569434.phd'
[exec] JVMDUMP010I Heap Dump written to /usr/IBM/wp610/AppServer/bin/heapdump.20080303.173641.569434.phd
[exec] JVMDUMP007I JVM Requesting Java Dump using '/usr/IBM/wp610/AppServer/bin/javacore.20080303.173641.569434.txt'
[exec] JVMDUMP010I Java Dump written to /usr/IBM/wp610/AppServer/bin/javacore.20080303.173641.569434.txt
[exec] JVMDUMP013I Processed Dump Event "systhrow", detail "java/lang/OutOfMemoryError".
[exec] java.lang.OutOfMemoryError incompatible with java.lang.RuntimeException
[exec] MIGR0272E: The migration function cannot complete the command.


RESOLVING THE PROBLEM
1. Change to AppServer_root/bin where AppServer_root is the directory where WebSphere Application Server is installed. 


2. Open WASPreUpgrade.sh/bat in a text editor and edit the file as follows. At the bottom of the file, you should find a command structured similar to the following examples. The exact command depends on the platform and the product version. In all cases, the keywords that are highlighted in the example for each platform will be present. 

 * 
 * On a Microsoft Windows system:
 * 
 * 
 * "%JAVA_HOME%\bin\java" 
 * -Dcmd.properties.file
 * =%TMPJAVAPROPFILE% %WAS_LOGGING% %CONSOLE_ENCODING% ...
 * 
 * 
 * On a UNIX or Linux-based system:
 * 
 * 
 * "$JAVA_HOME/bin/java" \
 * 
 * ...
 * 
 * -Dcom.ibm.websphere.migration.serverRoot="$WAS_HOME"
 * \
 * 
 * -Dws.ext.dirs="$WAS_EXT_DIRS" \
 * 
 * -classpath "$WAS_CLASSPATH" com.ibm.ws.bootstrap.WSLauncher \
 * 
 * ...
 * 

3. Insert the parameter, " -Xmx512m", before the highlighted reference as shown in the examples below. The 512 can be increased depending on the amount of memory available on the system. 
 * On a Windows system:
 * 
 * 
 * "%JAVA_HOME%\bin\java" 
 * -Xmx512m
 * -Dcmd.properties.file=%TMPJAVAPROPFILE% %WAS_LOGGING% %CONSOLE_ENCODING% ...
 * 
 * 
 * On a UNIX or Linux-based system:
 * 
 * 
 * "$JAVA_HOME/bin/java" \
 * 
 * ...
 * 
 * -Xmx512m
 * -Dcom.ibm.websphere.migration.serverRoot="$WAS_HOME" \
 * 
 * -Dws.ext.dirs="$WAS_EXT_DIRS" \
 * 
 * -classpath "$WAS_CLASSPATH" com.ibm.ws.bootstrap.WSLauncher \ 
 * 
 * ...
 * 
 * 
 * NOTE: 
 * 
 * -Xmx512m
 * 


4. Save WASPreUpgrade.bat/sh. 

5. Remove the previous migration backup and run portal-pre-upgrade again. 

6. Verify that the task completed successfully before you run the portal-post-upgrade task. 

7. (Optional) After you complete the migration process, remove the changes made to WASPreUpgrade.bat/sh. 


 * 
 *