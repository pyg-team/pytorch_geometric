Title: IBM IV16948: SYSROUTE OF IV08525: SLO FAILS ON THE SECOND SP WHEN INITIATED ON THE FIRST SP IF BOTH ON THE SAME DOMAIN - United States

Text:
  FIXES ARE AVAILABLE
Tivoli Federated Identity Manager 6.2.2 Fixpack 2 (6.2.2-TIV-TFIM-FP0002) [http://www-01.ibm.com/support/docview.wss?uid=swg24032786]
Tivoli Federated Identity Manager 6.2.2 Fixpack 6 (6.2.2-TIV-TFIM-FP0006) [http://www-01.ibm.com/support/docview.wss?uid=swg24034604]
Tivoli Federated Identity Manager 6.2.2 Fixpack 7 (6.2.2-TIV-TFIM-FP0007) [http://www-01.ibm.com/support/docview.wss?uid=swg24035214]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  There is one single itfim domain, called ISQ1FIMDomain,
   consisting of one Dmgr and two runtime nodes.
   On this domain there are two federations defined , one for each
   service provider : PSELVMinID (servicing DP / applikasjoner-q)
   and
   SBLMinID (servicing DU / tjenester-q).
   Each SP has a partner definition for the same IDP
   minid-ver.yyy.no, one linked to each federation.  The partner
   definitions are pretty much identical save for the default
   post-authentication URL parameter.
   
   reproducing steps
   
   logged in  onto first SP ( DP applikasjoner-q) via SAML 2.0 http
   redirect profile on the IDP minid-ver.yyy.no  and then use the
   SSO functionality to log on to the second SP ( DU tjenester-q),
   then from this tried to perform a global sign off, this will
   succed from DU, however when IDP forward the the Single Sign-Off
   to the first SP ( DP / applikasjoner-q )  it effectively failed
   to drop the session.  Conversely the reverse process of logging
   onto DU, moving to DP and signing out at DP will also sometimes
   fail at signing the user out from DU.  However, as I understand
   it, the bug does not appear 100% reliably.  I have not been able
   to determine the precise requirements for when it will succeed
   and when it will fail.
   
   ITFIM trace report the following
   
   
   [6/25/11 10:19:45:422 CEST] 00000039 SAML20Validat <
   com.tivoli.am.fim.saml20.protocol.actions.SAML20ValidateRequestA
   bstractAction validateRequest RETURN
   [6/25/11 10:19:45:422 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction runProtocol Validating logout-specific portions
   of the LogoutRequest; validating partner
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat >
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAtSPAction validatePartner ENTRY
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAtSPAction validatePartner Executing on SP, bypassing
   verification of issuer = minid-ver.yyy.no against providers in
   the logout list
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAtSPAction validatePartner Partner is valid = true
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat <
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAtSPAction validatePartner RETURN
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction runProtocol Validating NameId
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat >
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction validateNameId ENTRY
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction validateNameId NameID stored for this partner;
   validation needed
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction validateNameId Comparing stored qualifer
   'https://tjenester-q.xxx.no/sso/sps/SBLMinID/saml20' with
   qualifier in request
   'https://applikasjoner-q.xxx.no/FIM/sps/PSELVMinID/saml20'
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction validateNameId SPNameQualifier stored for this
   partner does not match SPNameQualifier in request
   [6/25/11 10:19:45:423 CEST] 00000039 SAML20Validat 1
   com.tivoli.am.fim.saml20.protocol.actions.slo.SAML20ValidateLogo
   utRequestAction validateNameId Error: Logout NameID is invalid
   
   
    
   
   

LOCAL FIX
 *  to set SPs on different domains
   
   
    
   
   

PROBLEM SUMMARY
 *  SLO fails when two SPs are authenticated using the
   same session index and both SP federations are on
   the same TFIM domain.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The fix for this APAR is expected to be contained in the
   following maintenance delivery vehicle:
   | fix pack | 6.2.2-TIV-TFIM-FP0001
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV16948
   
   
 * REPORTED COMPONENT NAME
   TIV FED ID MGR
   
   
 * REPORTED COMPONENT ID
   5724L7300
   
   
 * REPORTED RELEASE
   622
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2012-03-12
   
   
 * CLOSED DATE
   2012-03-22
   
   
 * LAST MODIFIED DATE
   2012-03-22
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    IV08525 [http://www-01.ibm.com/support/docview.wss?uid=swg1IV08525]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TIV FED ID MGR
   
   
 * FIXED COMPONENT ID
   5724L7300
   
   

APPLICABLE COMPONENT LEVELS
 * R622 PSY
   UP