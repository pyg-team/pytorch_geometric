Title: IBM High CPU usage and slower performance due to frequent System.gc() calls from Memory Overload Protection of On Demand Router in V8.5.5.2 and V8.5.5.3 - United States

Text:
 FLASH (ALERT)

ABSTRACT
 After WebSphere Application Server V8.5.5 Fix Pack 2 (V8.5.5.2) or Fix Pack 3 (V8.5.5.3) is installed, high CPU usage and slower performance may occur for application servers that use the On Demand Router (ODR) due to a problem introduced by APAR PI08088, which is included in these fix pack levels. In an environment that uses the ODR, the Memory Overload Protection feature of Intelligent Management calls System.gc() in an application server to check the current heap utilization. When this problem occurs, Memory Overload Protection calls System.gc() too frequently, resulting in high CPU usage and slow performance. 

CONTENT
Versions affected: 

Versions 8.5.5.2 and 8.5.5.3 for Distributed Platforms and z/OS. The IBM i platform is not affected. 

 

Problem Description: 

WebSphere Application Server V8.5.5.2 and V8.5.5.3 include the fix for APAR PI08088. As a result of a change introduced by the fix for this APAR, users of the On Demand Router (ODR) in WebSphere Application Server Network Deployment V8.5.5.2 and V8.5.5.3 might see high CPU usage and slower performance on application servers caused by frequent System.gc() called from the Memory Overload Protection feature of Intelligent Management. This problem would not affect environments where the ODR is not used. 

When the "Maximum percentage of the WebSphere Application Server maximum heap size to use" setting for the Memory Overload Protection is set to the default value of 100, Memory Overload Protection is effectively disabled, but the problem still occurs. With the default value of 100, the System.gc() would be invoked every 5 seconds. With the setting to a value less than 100, the issue can be mitigated, and the System.gc() would be invoked every 5 minutes. 

 

Solutions: 

To work around the problem without installing any fixes, the Memory Overload Protection feature and the System.gc() calls can be disabled by adding AutoMemoryOverloadProtection=false in the arfm.cfg file:
1. Stop all application servers.
2. Edit arfm.cfg in the WAS_HOME/profiles/profile_name/properties directory.
3. Add the following property in Java properties format:
AutoMemoryOverloadProtection=false
4. Start the application servers for the change to take effect. 

Applying Interim Fix APARs PI24706 and PI28492 , which replace the original APAR PI08088 (as specified below), or a Fix Pack containing the APAR (as specified below), resolves this issue. 

Important Note: The Interim Fix APAR PI24706 should be applied prior to APAR PI28492. 


For IBM WebSphere Application Server for Distributed:

For V8.5.5.2 and V8.5.5.3: 

 * Apply Interim Fix APARs PI24706 [http://www.ibm.com/support/docview.wss?uid=swg24038806] and PI28492 [http://www.ibm.com/support/docview.wss?uid=swg24038851]
   --OR-- 
 * Apply Fix Pack 4 or later (V8.5.5.4 targeted to be available in December 2014)


For IBM WebSphere Application Server for z/OS: 

For V8.5.5.2 and V8.5.5.3:  * Apply Interim Fix APARs PI24706 [http://www.ibm.com/support/docview.wss?uid=swg24038806] and PI28492 [http://www.ibm.com/support/docview.wss?uid=swg24038851]

--OR--  * Apply the [http://www-03.ibm.com/systems/i/software/websphere/services/service.html]WebSphere Application Server z/OS PTF group [http://www-01.ibm.com/support/docview.wss?uid=swg21175164] which includes Fix Pack 4, or later when available (V8.5.5.4 targeted to be available in December 2014)
   

Additional documentation: [http://w3.ibm.com/support] [http://w3.ibm.com/support/techdocs] [https://longspeak.boulder.ibm.com/WebRetain/logon.jsp] 
For additional details and information on WebSphere Application Server product updates:  * For Distributed, see Recommended fixes for WebSphere Application Server. [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980] 
 * For z/OS, see WebSphere Application Server for z/OS. [http://www-1.ibm.com/support/docview.wss?uid=swg27006970]



Related information
PI24706: ARFM MOP CONFIGURATION PROPERTY IS NOT REFLECTING AFTER SERVER RESTART [http://www.ibm.com/support/docview.wss?uid=swg1PI24706]
PI28492: MEMORY OVERLOAD PROTECTION CALLS SYSTEM.GC VERY FREQUENTLY IN ND 8.5.5.3 AND IT CAUSES HIGH CPU USAGE. [http://www.ibm.com/support/docview.wss?uid=swg1PI28492]
Memory overload protection [http://www14.software.ibm.com/webapp/wsbroker/redirect?version=phil&product=was-nd-dist&topic=cwve_odmopover]
Configuring memory overload protection [http://www14.software.ibm.com/webapp/wsbroker/redirect?version=phil&product=was-nd-dist&topic=twve_odconfigmop]

Change history
11 November 2014: Original copy published
26 November 2014: Updated the links to download the interim fixes