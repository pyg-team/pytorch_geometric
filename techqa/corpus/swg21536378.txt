Title: IBM How do you capture an IBM SYSTEM SSL Trace & analyse the output. (SCI68684) - United States

Text:
STERLINGPRI TECHNOTE (FAQ)

QUESTION
 How do you capture an IBM SYSTEM SSL Trace & analyse the output. (SCI68684) 

ANSWER


To diagnosis SSL / TLS connection or encryption problems, IBM Support or Connect:Direct Support may ask for a System SSL trace or a GSKSRVR Component trace. The IBM System SSL trace requires Connect:Direct to be cycled and it will trace all SSL activity. The GSKSRVR Component Trace can be executed without cycling Connect:Direct but requires pre-trace operating system set-up. Refer to Inquira Article FAQ2368 - FAQ - How do you capture an IBM GSKSRVR Component SSL Trace, for information about the IBM GSKSRVR Component SSL Trace. Following is information about IBM System SSL Trace. Following are the Steps needed to get a IBM SYSTEM SSL Trace in Connect:Direct.

1) Create a PDS formatted DCB is RECFM=VB LRECL=137 BLKSIZE=27998 DSORG=PO. This file will be used to change the USS Environment Parameters. 

2) Add member to new PDS using the following parameter entries as a guide:

TZ=CST6CDT

LC_ALL=EN_US.IBM-037

GSK_TRACE_FILE=/u/somedirectory/gsk44a.txt

GSK_SSL_HW_DETECT_MESSAGE=1

GSK_SSL_ICSF_ERROR_MESSAGE=1

GSK_SSL_BSAFE_ERROR_MESSAGE=1

GSK_TRACE=255

*NOTE: somediretory is a USS directory to which the Connect:Direct address space can write. 

These parameters mean

TZ - Time Zone

LC-ALL= Language

GSK_TRACE_FILE is file that will contain GSK Trace data. 

3) Add the //ENVIRON DD DISP=SHR,DSN=PDS created in step1 (with member created in step2) to the Connect:Direct Job. 

4) Using OE (OpenEdition) create a new file in UNIX directory accessible by Connect:Direct. The file needs to be empty (This can be done by opening the file in Edit mode and adding characters to one line, closing the file, then re-opening the file in Edit mode and deleting the line of characters previously added). Browse the file to verify that it is there (it should indicate there are no contents).

5) Make sure the Unix file created in step 4 is the name of the file in the GSK_TRACE_FILE in the PDS member in the //ENVIRON DD DSN.

6) Change permissions on the new file so that the Userid running Connect:Direct can read and write to the Unix file: chmod 777 file.name

7) Start Connect:Direct with SSL. Run Test scenario. All GSK trace info will go to the trace file indicated in the //ENVIRON DD.

8) The trace data is in raw form. To format into text readable format use the following Unix gsk command and pipe output to another file: 
gsktrace /u/somedirectory/gsk44a.txt > /u/somedirectory/gsk44a.for

9) Go back to OE (OpenEdit) and browse the contents.



How to tell from trace if Hardware Encryption is being used. 

Near the start of the SSL trace there are messages indicating the available hardware encryption features

e.g.

crypto_init(): SHA-1 crypto assist is available 
crypto_init(): SHA-224 crypto assist is available 
crypto_init(): SHA-256 crypto assist is available 
crypto_init(): SHA-384 crypto assist is not available 
crypto_init(): SHA-512 crypto assist is not available 
crypto_init(): DES crypto assist is available 
crypto_init(): DES3 crypto assist is available 
crypto_init(): AES 128-bit crypto assist is available 
crypto_init(): AES 256-bit crypto assist is not available 
crypto_init(): ICSF FMID is HCR7751 
crypto_init(): PCI cryptographic accelerator is available 
crypto_init(): PCIX cryptographic coprocessor is available 
crypto_init(): Public key hardware support is available 

When hardware encryption is unavailable you will see something like

INFO crypto_init(): SHA-1 hardware assist disabled 
INFO crypto_init(): SHA-224 hardware assist disabled 
INFO crypto_init(): SHA-256 hardware assist disabled 
INFO crypto_init(): SHA-384 crypto assist is not available 
INFO crypto_init(): SHA-512 crypto assist is not available 
INFO crypto_init(): DES hardware assist disabled 
INFO crypto_init(): DES3 hardware assist disabled 
INFO crypto_init(): AES 128-bit hardware assist disabled 
INFO crypto_init(): AES 256-bit crypto assist is not available 
INFO crypto_init(): ICSF FMID is HCR7751 
INFO crypto_init(): PCI cryptographic accelerator is available 
INFO crypto_init(): PCIX cryptographic coprocessor is available 
INFO crypto_init(): Hardware PKE disabled



For a transfer there will be numerous encrypt & decrypt message. These will contain the words Clear key when hardware encryption is being used, and the word Software when hardware encryption is not being used

e.g.

With hardware encrytion

INFO crypto_des3_decrypt_ctx(): Clear key DES3 decryption performed for 680 bytes
INFO crypto_des3_encrypt_ctx(): Clear key DES3 encryption performed for 96 bytes 


Without hardware encryption

INFO crypto_des3_decrypt_ctx(): Software DES3 decryption performed for 680 bytes
INFO crypto_des3_encrypt_ctx(): Software DES3 encryption performed for 96 bytes 


Note: You can disable hardware encryption via the //ENVIRON DD card in the C:D DTF JCL by specifying GSK_HW_CRYPTO=0 .

e.g.

//ENVIRON DD DISP=SHR,DSN=hlqs.UNIX.PERMISS(ICSFOFF)

Member ICSFOFF contains instructions to run an SSL trace and disable hardware encryption.

GSK_TRACE_FILE=/u/gmcga1/gskssl.%.trc 
GSK_SSL_HW_DETECT_MESSAGE=1 
GSK_SSL_ICSF_ERROR_MESSAGE=1 
GSK_SSL_BSAFE_ERROR_MESSAGE=1 
GSK_HW_CRYPTO=0 
GSK_TRACE=255

Note:

Tests with 3DES indicated that C:D used 8 times more CPU time when hardware encryption was disabled.



 

HISTORICAL NUMBER
 PRI19869 

PRODUCT ALIAS/SYNONYM
 

Fact




Connect:Direct OS/390, All Releases 
SCI68684


Goal




FAQ: How do you capture an IBM SYSTEM SSL Trace?