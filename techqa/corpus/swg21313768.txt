Title: IBM Collecting Data: Portal Access Control (PAC) for WebSphere Portal 6.1 - United States

Text:
mustgatherdocument; mustgather; mustgather; mustgather; PORTSE; PAC; access control; permissions; authorization; MustGatherDocument TECHNOTE (TROUBLESHOOTING)

PROBLEM
This technote covers collecting data for Portal Access Control (PAC) issues with the IBM WebSphere Portal version 6.1. Gathering this information before calling IBM Support will help you understand the problem and save time analyzing the data.

RESOLVING THE PROBLEM
If you already contacted IBM Support and must collect data to determine the nature of a problem in WebSphere Portal, review the information below regarding data collection. Otherwise, review Collecting Data: Read first for WebSphere Portal [http://www.ibm.com/support/docview.wss?rs=688&uid=swg21312740]. 

Portal Access Control (PAC) Information
Problems with Portal Access Control include: unable to deploy portlets due to lack of administrative rights, unable to perform administrative actions, unable to access resources, such as pages and portlets, unable to search users or groups, unable to run XMLaccess, and so on. 

Detailed Problem Description 

 * Step-by-step process to recreate the problem. 
 * Error message, if any, shown in the web browser or in logs; take screenshots if possible. 
 * Special conditions such as: only some user IDs having the problem but not others; nonstandard or custom objectclasses or attributes being configured; LDAP referrals or dynamic groups. 
 * Constant problem or only intermittent.


System Information  * Fix pack level of WebSphere Portal and WebSphere Application Server and interim fixes installed. 
 * Platform and configuration (cluster or stand-alone, how many nodes if clustered). 
 * Edge components, HTTP server, Load Balancer, and so on. 
 * Network topology: remote or local servers, firewall configuration. 
 * LDAP server vendor, version, user and group configuration; if available, provide the LDIF output of affected users and/or groups. 
 * Database server type and version as well as JDBC driver info. 
 * Third-party security components such as Tivoli Access Manager or other such solutions integrated into the environment.


Automated collection of troubleshooting data 

Automated log collection is available for this information and is the recommended method for improving accuracy of the data collection. 

IBM Support Assistant Lite 
Download Tool [http://www.ibm.com/support/docview.wss?rs=688&ca=portall2&uid=swg24008662] | View Demo of Trace Collection [http://www-10.lotus.com/ldd/portalwiki.nsf/dx/isalite-fundamentals-version-1.3.3-for-ibm-websphere-portal] 

After downloading IBM Support Assistant Lite, perform the following steps to collect the data and send to IBM Support: 0. Get a full export using an XMLaccess command such as 

<WP_root>/base/wp.xml/bin/xmlaccess.bat(.sh) -in ExportRelease.xml -user <portaladmin> -pwd <password> -url http://<portalhost>:10038/wps/config -out fullexport.xml
where <password> is the password of <portaladmin> and fullexport.xml is the file to be sent to IBM. You can find ExportRelease.xml in directory <WP_root>/doc/xml-samples. If the problem is in a virtual portal, the full export should be taken from the virtual portal context. Move the "fullexport.xml" file to the <wp_profile>/logs/WebSphere_Portal directory so that it can be collected by ISALite. 
1. Extract the contents of the downloaded file to the <wp_profile_root>/PortalServer directory which will create the subdirectory "ISALite" (e.g. /opt/IBM/WebSphere/wp_profile/PortalServer/ISALite). 

2. Run the runISALite.bat file (Windows) or runISALite.sh (UNIX or Linux) from the ISALite directory (/opt/IBM/WebSphere/wp_profile/PortalServer/ISALite/).

3. Once the tools starts, select the following Problem Type: WebSphere Portal -> Portal Access Control Problem.

4. Provide the output path and a file name of "<PMR #>.isalite.zip" (22222,111,000.isalite.zip).

5. Click Collect Data and follow the series of dialog boxes to set the tracing, reproduce the issue, and send the files to IBM Support. 

Manual collection of troubleshooting data

Use the following manual instructions for collecting the necessary troubleshooting data.


Enable Tracing
Enable the following traces through WebSphere Application Server Integrated Solutions Control (ISC aka the administrative control) with the following strings:


 * com.ibm.websphere.wim.*=all:com.ibm.ws.wim.*=all:com.ibm.wsspi.wim.*=all:
 * 
 * com.ibm.wps.ac.impl.AccessControlConfigFederator=all:com.ibm.wps.puma.*=all:
 * 
 * com.ibm.wps.ac.impl.AccessControlFederator=all:com.ibm.wps.engine.*=all:
 * 
 * com.ibm.wps.services.puma.*=all:com.ibm.wps.um.*=all:com.ibm.wps.sso.*=all
 * 

These strings should be on the same line with no line breaks and be separated with a colon (:). We strongly recommend to increase the size of log files to 20 MB and historical copies to 20. 

If External Security Management (ESM) software such as Tivoli Access Manager or Computer Associates' eTrust SiteMinder is configured for access control, add the following trace strings in addition to the above (colon separated and with no spaces):  * com.ibm.wps.ac.esm.*=all:wps.ibm.wps.ac.authtable.*=all
 * 

For further information regarding logging and tracing in the portal, refer to "Trace Logging" in the WebSphere Portal Information Center [http://publib.boulder.ibm.com/infocenter/wpdoc/v6r1m0/index.jsp?topic=/com.ibm.wp.ent.doc/trouble/pd_intr_logs.html]. 

After traces are enabled, stop the WebSphere Portal and WebSphere Application Server. Archive and clean up the <WP_profile_root>/logs/WebSphere_Portal/ directory and then restart WebSphere Portal. After recreating the scenario, immediately stop the portal server to stop the tracing and to reduce irrelevant log entries. Write down the time of the test and the user ID used in the test. 

Collect the following files from the server (or the primary Portal node in a cluster): 

1. Configuration files:  * <WP_profile_root>/config/cells/<cell>/security.xml, 
 * <WP_profile_root>/config/cells/<cell>/fileRegistry.xml (if the file registry is still configured) 
 * <WP_profile_root>/config/cells/<cell>/nodes/<node>/servers/WebSphere_Portal/resources.xml (if standalone) 
 * <DMGR_profile_root>/config/cells/<cell>/clusters/<WPcluster>/resources.xml (if clustered) 
 * <WP_profile_root>/config/cells/<cell>/wim/config/wimconfig.xml 
 * <WP_profile_root>/ConfigEngine/properties/wkplc.properties


2. A full export using the XMLaccess command such as 
<WP_root>/base/wp.xml/bin/xmlaccess.bat/.sh -in ExportRelease.xml -user <portaladmin> -pwd <password> -url http://<portalhost>:10038/wps/config -out fullexport.xml 
where <password> is the password of <portaladmin> and fullexport.xml is the file to be sent to IBM. You can find ExportRelease.xml in directory <WP_root>/doc/xml-samples. If the problem is in a virtual portal, the full export should be taken from the virtual portal context. 

3. LDIF output: If the problem is related to permission settings for users and/or groups, generate LDIF output from the LDAP server for the objects involved. 

4. Specific PAC configurations: If there are specific access control settings such as role-blocks and nested groups or dynamic group configurations, please specify them clearly. 

5. Run-time and configuration log files:  * <WP_profile_root>/ConfigEngine/log/ConfigTrace.log 
 * <WP_profile_root>/logs/WebSphere_Portal/SystemErr.log, SystemOut.log and trace.log (and their rolled over copies with timestamps)


Be sure to indicate the relevant date and time to IBM Support in your communications and use specific entries from the log to illustrate the problem reported if necessary. 
Send the diagnostic information to IBM Support:
Send files to IBM Support by using the instructions outlined in Exchanging information with IBM Technical Support for problem determination [http://www.ibm.com/support/docview.wss?rs=688&uid=swg21201571]. 

Related Information 

 * Overview: WebSphere Portal Support [http://www.ibm.com/software/genservers/portal/support/] 
 * Steps to getting support for WebSphere Portal [http://www.ibm.com/developerworks/websphere/zones/portal/support/portal_support.html] 
 * Collecting Data: Read first for WebSphere Portal [http://www.ibm.com/support/docview.wss?rs=688&uid=swg21312740]