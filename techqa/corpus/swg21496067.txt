Title: IBM Fix Pack 7.0.0.1 fails at action-import-defaultnodes-wp.filestore/base task. - United States

Text:
7001eGA TECHNOTE (TROUBLESHOOTING)

PROBLEM
The 7.0.0.1 fixpack executes a ConfigEngine script called "action-import-defaultnodes-wp.filestore/base". This script imports node files into the JCR database. The node files have the following user ID hardcoded within them: 

uid=wpsadmin,o=defaultwimfilebasedrealm

If you have configured a federated ldap and left the default file repository in place, but have removed the Base Entry for the file repository from the realm, then the 7001 upgrade may fail at this point. 

How to check if you will encounter this problem:

1. Log into the DMGR or WAS instance
2. Navigate to Security -> Global Security
3. In the "User account repository" section of this page, click 'Configure'.
4. In the 'Repositories in the Realm', does this entry exist?

o=defaultwimfilebasedrealm

5. Still on this page, click the link for "Manage Repositories"
6. In this table, do you see an entry for:

InternalFileRepository

If you answered "NO" to step 4 and "YES" to step 6, then you will encounter the failure described in this technote, and preventative action must be taken. Follow the steps in the "Resolving the Problem" section of this technote.

If you answered any other way to these questions (such as NO to both, or YES to both), no further action is needed and you can proceed with the upgrade. 

NOTE: The user 'uid=wpsadmin,o=defaultwimfilebasedrealm' is not required to actually exist. All that is required is that if the default file repository still exists, a base entry also exists for it. That is all. 


SYMPTOM
In the ConfigTrace.log, you will see the following output: 


================================
action-import-defaultnodes-wp.filestore/base:
[echo] Import default JCR configuration from /prod/sys/Portal7/wp_profile/ConfigEngine/config/work/wp.filestore/base/nodes/default
[echo] Using uid=myadmin,ou=Users,dc=ibm,dc=com
Tue Apr 05 11:26:36 EDT 2011
Target started: import-nodes

.....

BUILD FAILED
/prod/sys/Portal7/PortalServer/installer/wp.config/config/includes/wp_ptf_7001.xml:29: The following error occurred while executing this line:
/prod/sys/Portal7/PortalServer/installer/wp.config/config/includes/wp_ptf_7001.xml:81: The following error occurred while executing this line:
/prod/sys/Portal7/PortalServer/ext/wp.filestore/base/config/includes/wp.filestore.base_cfg.xml:26: The following error occurred while executing this line:
/prod/sys/Portal7/PortalServer/jcr/wp.content.repository.install/config/includes/jcr.install_cfg.xml:984: "Http Error, Response code 500. Exception : com.ibm.icm.jcr.command.CommandException: Import of one or more files failed. . Please check the server log for details.
====================================


In the SystemOut.log, you will also see these exceptions:

====================================
[4/5/11 11:26:36:667 EDT] 00000056 AbstractImpor E com.ibm.icm.jcr.command.AbstractImportNodeCommand getPath com.ibm.icm.jcr.command.CommandException: com.ibm.wps.util.DataBackendException: EJPSG0015E: Data Backend Problem com.ibm.websphere.wim.exception.EntityNotInRealmScopeException: CWWIM0515E The 'uid=wpsadmin,o=defaultwimfilebasedrealm' entity is not in the scope of the 'defaultWIMFileBasedRealm' realm.
com.ibm.icm.jcr.command.CommandException: com.ibm.wps.util.DataBackendException: EJPSG0015E: Data Backend Problem com.ibm.websphere.wim.exception.EntityNotInRealmScopeException: CWWIM0515E The 'uid=wpsadmin,o=defaultwimfilebasedrealm' entity is not in the scope of the 'defaultWIMFileBasedRealm' realm.
=====================================


CAUSE
If the base entry for the default file repository does not exist, but the default repository itself still does, then the hardcoded value for the user ID will create a problem here. 

 

This will be fixed in a future Portal fixpack.


RESOLVING THE PROBLEM
To resolve the problem, there are two options: 


Option 1 (recommended) - Remove the default file repository completely. This is the recommended action if you do not use the file repository.

1. If in a cluster , ensure the DMGR is started.
2. Execute the following ConfigEngine script:

./ConfigEngine.sh wp-delete-repository -Dfederated.delete.id=InternalFileRepository

3. Restart the servers so the new changes are picked up.


Option 2 - Add the Base Entry for the default repository back to the realm

1. Log in to the DMGR or WAS instance
2. Navigate to Security -> Global Security
3. In the "User account repository" section of this page, click 'Configure'.
4. Click 'Use built-in repository'. This will add an entry for the default user repository to the realm.
5. Save all changes and restart the servers.