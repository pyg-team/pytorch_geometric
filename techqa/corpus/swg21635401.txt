Title: IBM Tool to create DB2 HADR policy for TSAMP on Windows - United States

Text:
tsa; tsamp; Win; windows; hadr; db2; tsahadrwin.sh; tsahadrwin; policy TECHNOTE (FAQ)

QUESTION
 Need a tool that will streamline the creation of an automation policy (resource model) that will allow TSAMP to manage a DB2 HADR environment on the Windows platform. 

ANSWER
The attached package contains a script that will simplify the process of integrating DB2 HADR and TSAMP on the Windows platform. Included is a response file (hadr.rsp) that contains a set of parameters that you would need to provide values before the associated script can be used. 

There are some requirements and a set of steps that need to be completed before the script can be utilized. 

Requirements: 

1. All commands in the steps below are run within the SUA shell (UNIX prompt) and need to be run as the user that was used to install the TSAMP product. 

2. For a non-domain joined Windows environment, you *must* use the actual "Administrator" account and not some other account within the Administrator's group. The "Administrator" account must have been used to install both the TSAMP and DB2 products. 

3. Add the hostnames for both of the Windows servers to each of their "etc\hosts" files. Both hostnames (and their associated IP address) should appear in both "etc\hosts" files. 

4. TSAMP v3.2.2.0+ is recommended. For Windows domain-joined, TSAMP v3.2.2.3+ is required. 

5. Ideally, the DB2 instances should be running and the HADR database should already be Peer connected. 

6. Ensure there is a directory called "/usr/sbin/rsct/sapolicies/db2" on both servers and that it contains the DB2 automation scripts with the following permissions, file ownership, and group ownership:
$ pwd
/usr/sbin/rsct/sapolicies/db2
$ ls -al
total 80
drwxrwxrwx 1 Administrator +Administrators 4096 Apr 24 17:30 .
drwxrwxrwx 1 Administrator +Administrators 0 Apr 19 13:25 ..
-rwxrwxrwx 1 Administrator +Administrators 6731 Apr 5 2012 README
-rwxrwxrwx 1 Administrator +Administrators 1230 Apr 16 23:54 db2.def
-rwxrwxrwx 1 Administrator +Administrators 255 Apr 5 2012 db2ip.def
-rwxrwxrwx 1 Administrator +Administrators 733 Apr 19 13:52 hadr.def
-rwxrwxrwx 1 Administrator +Administrators 8682 Apr 5 2012 hadr_monitor.ksh
-rwxrwxrwx 1 Administrator +Administrators 9263 Apr 5 2012 hadr_start.ksh
-rwxrwxrwx 1 Administrator +Administrators 4561 Apr 5 2012 hadr_stop.ksh
-rwxrwxrwx 1 Administrator +Administrators 1001 Apr 16 23:51 mkdb2
-rwxrwxrwx 1 Administrator +Administrators 1191 Apr 19 13:57 mkhadr
-rwxrwxrwx 1 Administrator +Administrators 1011 Apr 5 2012 rmdb2 

 

Pre-script steps: 

1. If you've unsuccessfully attempted to create a policy previously, then run the following command on *both* servers to be sure you have a fresh/vanilla environment to work with:
/usr/sbin/rsct/install/bin/recfgct 

2. Prepare the access control lists for each server by running the following command on *both* servers with the same hostnames added to the hadr.rsp file and the Windows "etc\hosts" file :
preprpnode <node01> <node02> 

3. A domain needs to be created, using the same domain name that is added to the hadr.rsp file:
mkrpdomain <domain_name> <node01> <node02> 

4. Bring the domain online:
startrpdomain <domain_name>


Now you can use the "tsahadrwin.sh" script. Untar the attached tar file within the SUA (UNIX) environment on one of your Windows servers. 

tsahadrwin_1.3_2013-04-24.tar [/support/docview.wss?uid=swg21635401&aid=2]tsahadrwin_1.3_2013-04-24.tar [/support/docview.wss?uid=swg21635401&aid=1] 

Edit the "hadr.rsp" file with the values specific to your environment. Some special considerations: 

A. The DOMAIN_NAME must match the name of the domain you created in step #3 above. 

B. The node names must have the same case sensitivity as defined in the "hosts" files on each Windows box. 

Run the script as follows: 

./tsahadrwin.sh -r hadr.rsp 

 

There are additional best practices and advise you should consider. Check the following technote:
http://www.ibm.com/support/docview.wss?uid=swg21576966 [http://www.ibm.com/support/docview.wss?uid=swg21576966]
Note that the "tsahadrwin.sh" script already takes care of line items #2, #3, #9, #12, #13