Title: IBM How to upgrade the database schema from IBM Content Collector 2.2 to IBM Content Collector 3.0 - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 What changes does the Configuration Manager do to the database schema when upgrading to IBM Content Collector 3.0, what permissions are required for the upgrade, and what is the recovery process if the schema upgrade fails because of missing permissions? 

ANSWER
What specific database schema changes does the Configuration Manager perform when upgrading to IBM Content Collector 3.0?
The Content Collector 3.0 data store upgrader performs the following operations: 

 * ALTER TABLE (to drop constraints and columns and add a column) 
 * DB2 only: CALL SYSPROC.ADMIN_CMD / REORG TABLE 
 * DROP TABLE 
 * DELETE / UPDATE TABLE 
 * CREATE TABLE 
 * CREATE VIEW


How can I check if my current Content Collector 2.2 database connection has sufficient permissions to perform the upgrade? 
If you used the Content Collector 2.2 Initial Configuration wizard to set up the configuration database, you might not have sufficient permissions to perform the upgrade. For IBM Content Collector 2.2, the required permissions for the database user were permission to create, read, and write to tables. Content Collector 3.0 requires additional permissions. 

To check if the user ID that is used to connect to the configuration database with Content Collector 2.2 has sufficient permission to run the upgrade to Content Collector 3.0:  1. In the Configuration Manager, switch to the Data Stores view. Click the active data store connection to see which user ID is used to connect to the database. 
 2. On the database server, verify that the user ID has the following required permissions: SELECT, INSERT, UPDATE, DELETE and CREATE, ALTER, and DROP for TABLE and VIEW.


How can I change the database credentials before upgrading? 
To change the database credentials before upgrading:  1. Stop the Task Routing Engine service on all Content Collector servers. 
 2. On all Content Collector servers, navigate to the ctms directory in the Content Collector installation directory and delete the file CTMSConfigStore.xml. Deleting this file removes all data store connections that you have configured. The actual Content Collector configuration data is not affected. 
 3. Open the Configuration Manager on the primary node and create a data store connection with the new credentials. 
 4. After the connection is established and working, copy the file CTMSConfiguration.xml to all Content Collector servers.


How can I recover from a schema upgrade failure? 
If the Content Collector 3.0 upgrade fails due to missing permissions, for example if a new view cannot be created, complete the following steps:  1. Revert the configuration database to the state before the upgrade. To do so, restore the database on the database server from a full database backup. Importing a Content Collector 2.2 data store export XML file is not sufficient, because the database structure was altered and must be reverted to the state before the upgrade. 
 2. Change the database permissions of the user ID that is used to connect to the configuration database to meet the Content Collector 3.0 requirements (see above). 
 3. Run the Configuration Manager again and perform the upgrade.


If you did not create a full database backup before running the Content Collector 3.0 upgrade, contact IBM Software Support.