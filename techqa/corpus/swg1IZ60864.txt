Title: IBM IZ60864: TITLE: ITIM RMI ADAPTER (DISPATCHER) AL TERMINATION NOT PROPERLY CLOSING - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Title: ITIM RMI Adapter (Dispatcher) AL termination not properly
   closing
   out, resulting in unreleased file handles and an eventual
   response of
   "Too many open files"
   
   
   Description: Customer is having issue where after the TIM/TDI
   dispatcher
   is running for some time and being used by their 4 custom
   adapters, that
   then request will start to fail with following message:
   
   "Too many open files"
   
   Customer increased the OS file handle limit setting from 2K to
   32K.
   This worked to have the dispatcher running for 7 days before
   hitting the
   32K limit.  So there is some sort of leak or not closing of open
   file
   handles occurring.
   
   The customer's custom adapters all have logging defined on the
   ALs to
   log to separate files.
   
   The various jar files attached to the PMR are the TIM adapter
   profiles
   that contain the xml files of the ALs.  The logging defined are
   standard
   daily rolling log file on the ALs for info and error level.
   
   We can see in lsof output on the dispatcher machine that the
   number of
   file descriptors increases each time one of the ALs is run and
   this
   number does not decrease.  Using the ncheck command to look at
   the inode
   of the lsof output, we can see that what is increase is open
   file
   descriptors to the logs files defined on the ALs.
   
   At this point with the customer's setting of 32K open files on
   the OS,
   after 32K requests run through the dispatcher(each run an AL),
   then the
   process will start failing with the "too many open files"
   message until
   the dispatcher is stopped and restarted.
   
   Steps to Duplicate: With any of the standard TIM/RMI adapter,
   define TDI
   daily rolling log file on the ALs in the config.  Each time the
   AL runs
   for some request for the adapter from TIM, this opens a file
   descriptor
   to the defined log file and this does not close.  Support
   reproduced
   this in support lab with dispatcher running AIX 145 machine and
   using
   standard LDAP adapter.
   
   Desired Behavior: To not have the open file handles keep
   increasing
   until the limit is reached and the dispatcher has to be
   restarted.
   
   Environment: TDI 6.1.1 FP6, TIM 5.0, AIX 5.3
   
   
    
   
   

LOCAL FIX
 *  Resolution: The solution provided by TDI L3 Team was to use
   'executeTerminateAL' instead of 'usingTerminate()' in
   Dispatcher. ITIM
   Adapter Dev has confirmed that this addresses the open files
   issue and
   is executing thorough testing to ensure there are no ill effects
   to the
   Dispatcher as a result of this new call.
   For now the customer has deployed a workaround of simply not
   separating
   out the content into different log files. They have TDI
   configured to
   direct all log content to the default ibmdi.log file.
   
   
    
   
   

PROBLEM SUMMARY
 *  Log file handles not released if additional log
   ging is specifid in the TDI config.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Fix shipped in Dispatcher build 5.119 and 5.
   719
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ60864
   
   
 * REPORTED COMPONENT NAME
   ITIM AGENTS
   
   
 * REPORTED COMPONENT ID
   5724C34AG
   
   
 * REPORTED RELEASE
   500
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-09-18
   
   
 * CLOSED DATE
   2009-09-30
   
   
 * LAST MODIFIED DATE
   2009-09-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  AGENT
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   ITIM AGENTS
   
   
 * FIXED COMPONENT ID
   5724C34AG
   
   

APPLICABLE COMPONENT LEVELS
 * R500 PSY
   UP
   
   
 * R510 PSY
   UP