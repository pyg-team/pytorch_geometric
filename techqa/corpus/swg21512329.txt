Title: IBM How to change the device communication timeout values. - United States

Text:
ITNCM; Intelliden; timeout values; device communication; timeout; device; communication TECHNOTE (FAQ)

QUESTION
 How do I change the device communication timeout values?




CAUSE
Due to environmental variables (network performance, device config size, etc,), customers may occasionally need to adjust their device communication timeout values for a particular device, or set of devices, in order for a unit of work (UOW) to complete successfully.



ANSWER
If Units of Work (UOW's) fail against a particular device, or set of devices, you may need to adjust the device communication timeout values. You can do this by editing the Resource Access Document (RAD) being used by that device or devices. Follow the procedures below to change the device communication timeout values: 

 

 

1) Open up the RAD being used by the device(s) for editing. 

 

 

2) Select the "Access Types" that you have enabled. 

 

 

3) Click on the "Transport" tab (below is an example of the screenshot you should see): 

 


[/support/docview.wss?uid=swg21512329&aid=1] [/support/docview.wss?uid=swg21512329&aid=1]



4) Enter the desired time-out value in the appropriate fields. Below is a general overview of the different time-out values and how to use them:

a) ----- Connection Timeout ----- This value is used to determine how long to wait for a TCP connection to a socket on the network device. The default of this value is determined by the operating system that the worker server is installed on. An example of this time-out can be found in Figure 11 where a user logs into the operating system of the worker server and tries to connect to a non-existent IP address. Here it took over 3 minutes to fail the connection to the socket. 



[/support/docview.wss?uid=swg21512329&aid=2] [/support/docview.wss?uid=swg21512329&aid=2] Figure 11 TCP time-out example



The OS defaults can be very troublesome when you are initially importing a network and the IP/DNS values provided are not correct. A long time-out value for the OS will cause the UOW execution to slow down when there are no devices at the other end of an IP address. The current default is to try three connections to the IP address which in turn could tie up a worker server thread for 10 minutes before the UOW will be failed. b) ----- Character Timeout ----- This value, defined in milliseconds, will be used to place time-outs between each character that is sent to the device. Character must be selected for this time-out to be used. 

c) ----- Connection Response Timeout ----- This time-out defines how long to wait for the global connection script to complete. The global connection script includes logging into the device with authentication credentials as well as setting up the session for terminal interactions with ITNCM. The default value of 20,000 milliseconds is encoded in the application. 

d) ----- Connection Retry Delay ----- ITNCM checks sockets throughout the device interaction. This is done in code. A socket check usually entails the sending of a carriage return to the device and awaiting a prompt to be returned (specifically the default.prompt defined in the device script.) If a prompt is not returned in a timely fashion, the socket is considered dropped and a reconnection occurs after waiting for this delay which by default is 1000 milliseconds. 

e) ----- Max Response Timeout ----- This time-out, which by default is 300,000 milliseconds, determines the maximum amount of time to wait for a specific value (as defined by the device script) to be returned from a device. Review the following script. 


ftp.01.send=copy ftp://$ftp_username$:$ftp_password$@$ftp_hostname$/$ftp_filename$ running-config\r
ftp.02.wait=?
ftp.03.send=\r
ftp.04.wait=#
ftp.05.sleep=5000
ftp.06.send=copy running-config startup-config\r
ftp.07.wait=?
ftp.08.send=\r
ftp.09.wait=#


 Step 01 of the script sends a “copy ftp running-config” command to the device. Step 02 is waiting for a “?” to be returned. Using this Max-Response-Timeout, the code will wait 5 minutes for the “?” to appear before failing the Unit of Work. If the “?” is returned in less than that time, the code will move onto the next steps in the script. 

f) ----- Response Timeout ----- This timeout is serving a similar function to the Max Response Timeout but in a different fashion. Its default is 600,000 milliseconds or 10 minutes. Here the timer is only looking for data to be returned back to the device in the stream. Any time data is returned, the Response Timeout is reset to zero. Be aware, anything in the character stream will reset this timer, even though it does contain the string that is being searched for by a “wait” statement. 

The Max Response Timeout and Response Timeouts are probably the most important timers that you may need to modify from their default settings. The traditional use case that comes to mind is the retrieval of a very large configuration from a device. Take for instance the Juniper ERX aggregation router. This router can hold a configuration of 500,000 lines or more. Being so large, it takes awhile to actually retrieve a configuration. Take the two possible ways to retrieve the configuration: 

The configuration can be streamed off the device. This streaming can take over five minutes for very large configurations. Here, the data buffer is constantly being added to as the commands stream from the device so the Response Timeout is being reset constantly. However, the Max Response Timeout will be tripped when it takes over 5 minutes to get the configuration completely from the device. The UOW will fail do to a false-positive. 

The configuration can be FTP’d off the device. In the case of an ERX device, this means that it will write its configuration to disk. This process can take just as long as streaming the configuration. Here the Response Timeout could be an issue since the device may not send data over the VTY session for some time as the file gets written to disk (this would not happen in a default situation as the Max Response Timeout is shorter than the Response time and it would fail on the Max Response Timeout.) 

 

5) After you have entered the desired values, save the changes.