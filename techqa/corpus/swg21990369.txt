Title: IBM Connections: A User That is a Member of a Great Number of Restricted Communities Reports Unusual Search Results. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
IBM Connections: A User That is a Member of a Great Number of Restricted Communities Reports Unusual Search Results.

SYMPTOM
IBM Connections users report some incorrect or unexplained behaviour for Search, in particular with regard to content that belongs to Restricted Communities. 

For example, in one customer case, a user was unable to find a Restricted Community that they were an owner of. In other words, when that user performed an "All Content" search for the community's exact title, the community was not returned in the search results. This issue happened for that user, regardless of which browser type or version that they used. 

For other users who were members of the same community, the issue did not occur, meaning that the community was indeed present in the index. 

The issue persisted even after the Search index was completely rebuilt.


CAUSE
The IBM Connections Search application uses a Lucene 3.0.3 index. 

There is a ACL clause limit set in Lucene which is explained here:
http://lucene.apache.org/core/3_0_3/api/core/org/apache/lucene/search/BooleanQuery.html [http://lucene.apache.org/core/3_0_3/api/core/org/apache/lucene/search/BooleanQuery.html]
BooleanQuery.setMaxClauseCount()

This config setting from Lucene means that there is a limit of 1024 ACL Clauses whenever a search is performed in IBM Connections Search. 

What is an ACL Clause limit? 

Restricted Files and other private data are associated directly with the user's ACL token. Therefore when a search is done, only the ACL of that individual user needs to be searched (e.g. "find all files associated with acl=<user id>"). 

Restricted Communities are special due to the amount of content contained within them. As a result, the content within a Restricted Community is indexed with the UUID of the Community as an ACL token. 

With Restricted Communities, when the ACL tokens are checked, we see what Restricted Communities that user is a member of. The list then gets passed to the Search query as a restriction.
This is where the clause limit comes into play. One clause is needed on the Search request for every ACL token the user has. 

The Search query would now look something like: "find everything where acl=<user id> OR acl=<restricted community 1> OR acl=<restricted community 2> ....." 

If the user is a member of a great many Restricted Communities therefore, then the clause limit of 1024 could be reached. 

The 1024 clause limit only affects Restricted Communities. This doesn't apply to Public or Moderated Communities as they have special ACLs which can be found by everyone so no additional information is needed in the Search query. 

 

This concept can be more clearly illustrated by logging into Connections and then changing the browser URL to this: http://<connections server root url>/communities/seedlist/authverify/getACLTokens 

In the response, each row corresponds to one ACL token/clause. For example: 

[/support/docview.wss?uid=swg21990369&aid=1] [/support/docview.wss?uid=swg21990369&aid=1] 

The first row above ('ADenne') corresponds to the user's own ACL. It takes up one ACL clause therefore. 

The remaining rows correspond to UUID's for Restricted Communities. Each restricted community takes up an ACL clause, and an additional one (i.e. 2 clauses) if the searching user is the owner. 

In the case of the example shown above, the limit has not been reached, as the user has 36 clauses.


ENVIRONMENT
IBM Connections 4.0, 4.5, 5.0 or 5.5



DIAGNOSING THE PROBLEM
In one customer case, the affected user was found to be the owner of 767 restricted communities.
As the clause limit is 1024 clauses, this was well over the limit (it is >1500 ACL clauses) and truncation of the list occurs.

For a user who is a member of / owns this many communities, search results will be affected by hitting the clause limit. To ensure search results are correct for all associated communities, the number of communities for which this user is a member needed to be reduced.

To confirm if a user is perhaps hitting the ACL clause limit on the search query, log in to Connections as the user who cannot successfully search.
Then go to the URL: http://<connections server root url>/communities/seedlist/authverify/getACLTokens 

Count the number of rows in the response.



RESOLVING THE PROBLEM
For users where the number of ACL clauses exceeds 1024, the administrator should work with that user to reduce the number of Restricted Communities that they are a member of. No re-indexing of content is necessary.