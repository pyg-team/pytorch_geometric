Title: IBM IT06183: MQRC 2063 (MQRC_SECURITY_ERROR) WHEN CONSUMING MESSAGES FROM Z/OS AMS ENABLED QUEUE USING JMS CLIENT - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  z/OS PTF UK80834 for APAR PM69493 [http://www-01.ibm.com/support/docview.wss?uid=isg1PM69493]
   
   http://www-01.ibm.com/support/docview.wss?uid=isg1PM69493 [http://www-01.ibm.com/support/docview.wss?uid=isg1PM69493]
   
   enabled function that exposed the following behaviour in the MQ
   for JMS classes:
   
   A WebSphere MQ classes for JMS client application, using IBM MQ
   Advanced Message Security (AMS) functionality, fails to receive
   a message from an IBM MQ AMS enabled queue that is defined on a
   z/OS queue manager. The following JMS Exception is returned to
   the application:
   
   JMSCMQ0001: WebSphere MQ call failed with compcode '2'
   ('MQCC_FAILED') reason '2063' ('MQRC_SECURITY_ERROR').
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects users who have either:
   
   - WebSphere MQ classes for JMS, or
   - WebSphere MQ classes for Java
   
   applications that consume encrypted messages from an IBM MQ
   Advanced Message Security enabled queue, where the message
   contains one or more of the following message headers:
   
   - MQIIH
   - MQCIH
   - MQDLH
   
   If consuming messages from a WebSphere MQ for z/OS queue manager
   APAR PM69493 [http://www-01.ibm.com/support/docview.wss?uid=isg1PM69493] (included in PTF UK80834) also needs to have been
   applied to the z/OS queue manager.
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   When sending encrypted messages using IBM MQ Advanced Message
   Security (AMS), message headers should not be encrypted along
   with the message body. On the z/OS queue manager, APAR PM69493 [http://www-01.ibm.com/support/docview.wss?uid=isg1PM69493]
   introduced a change to ensure IBM MQ AMS on z/OS behaved the
   same as its distributed platform counterparts such that
   WebSphere MQ message headers are skipped and not protected by
   the AMS encryption mechanism.
   
   When a WebSphere MQ classes for JMS or classes for Java
   application attempts to consume an encrypted message, it parses
   and skips over unprotected message headers into order to locate
   the IBM MQ AMS header, which directly precedes the encrypted
   message payload. This AMS message header contains the data which
   the client application uses to decrypt the message payload.
   
   However, the IBM MQ AMS code did not interpret the following
   WebSphere MQ message headers correctly:
   
   - MQIIH
   - MQCIH
   - MQDLH
   
   After applying PTF UK80834 for APAR PM69493 [http://www-01.ibm.com/support/docview.wss?uid=isg1PM69493] on the z/OS queue
   manager, these MQIIH/MQCIH/MQDLH message headers are no longer
   encrypted, as per the design of the fix. However the AMS
   component within the Java/JMS classes did not interpret these
   headers appropriately, which resulted in a failure to locate the
   IBM MQ AMS message header. As such, the IBM MQ AMS code failed
   to decrypt the message body, resulting in an exception being
   thrown back to the application with an MQRC 2063
   (MQRC_SECURITY_ERROR) return code.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The IBM MQ Advanced Message Security code has been updated such
   that the following WebSphere MQ message headers:
   
   - MQIIH
   - MQCIH
   - MQDLH
   
   are parsed and interpreted correctly when consuming an IBM MQ
   AMS protected message.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v7.0       7.0.1.14
   v7.5       7.5.0.6
   v8.0       8.0.0.2
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT06183
   
   
 * REPORTED COMPONENT NAME
   WMQ ADV MSG SEC
   
   
 * REPORTED COMPONENT ID
   5724Z9400
   
   
 * REPORTED RELEASE
   701
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2014-12-19
   
   
 * CLOSED DATE
   2015-04-28
   
   
 * LAST MODIFIED DATE
   2015-04-28
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ ADV MSG SEC
   
   
 * FIXED COMPONENT ID
   5724Z9400
   
   

APPLICABLE COMPONENT LEVELS
 * R701 PSY
   UP