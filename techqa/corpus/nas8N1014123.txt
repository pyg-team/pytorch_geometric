Title: IBM i5/OS Timed Power On Behavior on HMC Managed System - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 IBM i5/OS scheduled power on events can be used to power on HMC-managed partitioned systems. 

RESOLVING THE PROBLEM
IBM i5/OS provides timed powered ons (TPOs) using the GO POWER function and the QIPLDATTIM system value. On HMC-managed servers, an i5/OS partition TPO can be run even when the server is in a power off state. 

On an HMC-managed server, every partition has its own timed power on setting. When a TPO is scheduled for one or more partitions, the Hypervisor will set a Hypervisor TPO in the flexible service processor (FSP). If you then power down all partitions and the entire system, the system will power back on when the time expires on the first partition. Only partitions that have expired times will power on. All other partitions that have yet to expire will not be automatically IPLed, even if they are set in the HMC to power on with the managed system. The Power on with Managed System setting applies only to platform power types that are user initiated (for example, pressing the power on button on the operator panel), not automatic IPLs (timed power on, auto power restart or utility power restored). The partition settings used for the TPO are whatever resources the partition currently owns, as defined by the last activated profile and any subsequent dynamic LPAR operations.

Note: For the TPO to succeed from a server power-off state, the server keylock position must be "Normal". In addition, POWER 5 servers and POWER 6 servers at firmware level Ex340 and earlier must set the server start policy to Boot to system server firmware to Running. 

1. Verify Keylock position is Normal
On the server properties panel select the Power-On Parameters tab. The Keylock position of the server should be Normal. If it is not, change the setting to Normal and click OK.

power on parameters panel [/support/docview.wss?uid=nas8N1014123&aid=1] [/support/docview.wss?uid=nas8N1014123&aid=1]

2. Verify the server start policy
Note: This step is required only for POWER 5 servers and POWER 6 servers at firmware level Ex340 and earlier. Firmware Ex350 and later modified the start policy such that TPOs will start for all Partition Start Policy settings. 

In HMC Version 7.3.5 and later the "boot to system server firmware" setting can be modified using the HMC server properties panel, Power-On Parameters tab shown in step 1. Change the Partition start policy to Auto-Start Always.

The property can also be changed using Advanced System Manager. Launch ASM, login, expand Power/Restart Control, then click Power On/Off System. Confirm Boot to system server firmware is set to Running. If it is Standby, then change the setting to Running and click Save Settings. Caution: HMC Versions 7.3.4 and earlier modify this property each time a user initiates a server power on to standby. The setting needs to be reset after each power on to standby.

The ASMI screen displays the Power/Restart Control - Power On/Off System options. [/support/docview.wss?uid=nas8N1014123&aid=2] [/support/docview.wss?uid=nas8N1014123&aid=2]

Examples 
Consider the following example of a scheduled power down over the weekend. Assume that the platform and all partitions utilize the same local time-of-day base. The Hypervisor algorithm is actually more general than this. It handles differing time bases for each partition and the platform, where one is UTC-based and others are local time in different time zones; however, this would unnecessarily complicate the example.

Initially, the platform is running, and each partition has the following timed power on values set:

Partition Power On Time HMC setting: Power On With Managed System
--------- ------------- -----------------------------------------
1 Monday 6:00am Auto IPL
2 Monday 6:05am false
3 not set Auto IPL
4 not set false
5 Monday 7:00am Auto IPL
6 Monday 7:05am false

The system administrator powers off all partitions to the not activated state and the platform to power off state on Friday evening. The platform will then remain powered off for the remainder of Friday night and all of Saturday and Sunday. Monday morning, at 6:00 am, the platform will power on because partition 1 has the earliest Power On Time. The following is a sequence of events that will occur on Monday: 

6:00 am The platform begins powering on because the platform Power On Time is expiring (this is automatically set based on the earliest partition's Power On Time). 6:10 am Let us assume that it took a total of 10 minutes to reach the point in the system IPL where the Hypervisor is ready to auto-start partitions. Partitions 1 and 2 are started automatically because the Power On Times have expired. The remaining partitions will not auto-IPL because they have Power On Times that have not yet expired or they do not have a power on time. 7:00 am Partition 5 begins IPLing because its Power On Times is expiring. 7:05 am Partition 6 begins IPLing because its Power On Times is expiring. 
The reason that partitions 3 and 4 are not automatically IPLed in this example is because we want the system to behave the same, regardless of whether the platform was powered off or not. 

If you replay the example, but this time do not power off/on the platform (for example, let it stay on, with no partitions running, during the entire weekend), the results are exactly the same from a partition perspective (ignoring the small time it takes to actually power on the platform). Namely, after 7:05 am, partitions 1, 2, 5, and 6 will be running, but partitions 3 and 4 will not. If a partition administrator specifically powered off their partition on Friday at noon, and came in Monday at 8:00 am, they would wonder why sometimes it was still off (the platform did not power off/on over the weekend), and sometimes it was running (the platform powered off/on automatically during the weekend). That is the rationale for why the Hypervisor does not utilize the Auto/Hold setting when the platform powers on automatically via a Timed Power On. 

Consider another variation on this example where the AC power is removed while the system is powered off. This will have no effect, regardless of the value of the Auto Power Restart setting. Auto Power Restart restores the system to its previous state. Because the system was already at power off state, the system will IPL to power off when power is restored and stop. The timed power ons will occur at the scheduled time. 

HISTORICAL NUMBER
 463246052