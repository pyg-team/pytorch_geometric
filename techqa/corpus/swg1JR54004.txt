Title: IBM JR54004: PURGING MANY TASKS OR INSTANCES MIGHT CAUSE OUT OF MEMORY ERROR ON NODES PROCESSING TASK AND INSTANCE INDEXING INFORMATION - United States

Text:
  DIRECT LINKS TO FIXES
8.0.1.3-WS-BPM-IFJR56171 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Standard&fixids=8.0.1.3-WS-BPM-IFJR56171&source=SAR]
8.5.0.2-WS-BPM-IFJR55539 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Standard&fixids=8.5.0.2-WS-BPM-IFJR55539&source=SAR]
8.5.6.2-WS-BPM-IFJR55539 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Standard&fixids=8.5.6.2-WS-BPM-IFJR55539&source=SAR]
8.5.0.1-WS-BPM-IFJR55539 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Standard&fixids=8.5.0.1-WS-BPM-IFJR55539&source=SAR]
8.0.1.3-WS-BPM-IFJR54004 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Standard&fixids=8.0.1.3-WS-BPM-IFJR54004&source=SAR]
Version 8.5 Refresh Pack 7 for the IBM Business Process Manager products [http://www-01.ibm.com/support/docview.wss?uid=swg24041575]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  An OutOfMemory error might occur when you purge of a large
   number of tasks and instances from IBM Business Process Manager
   (BPM) nodes that process task and instance indexing information.
      These are some exceptions you may see in the log
   [3/2/16 17:59:18:019 CET]     FFDC
   Exception:java.lang.OutOfMemoryError
   SourceId:com.ibm.ws.asynchbeans.J2EEContext.run ProbeId:394
   Reporter:com.ibm.ws.asynchbeans.J2EEContext@364e018c
   java.lang.OutOfMemoryError: Java heap space
    at java.util.Calendar.<init>(Calendar.java:945)
    at
   java.util.GregorianCalendar.<init>(GregorianCalendar.java:585)
    at
   java.util.GregorianCalendar.<init>(GregorianCalendar.java:552)
    at
   com.ibm.bpm.search.persistence.spi.impl.AbstractPersistenceManag
   er.getGregorianCalendarFromUTCTimestamp(AbstractPersistence
   Manager.java:238)
    at
   com.ibm.bpm.search.persistence.spi.impl.AbstractTaskIndexPM.buil
   dTaskIndex(AbstractTaskIndexPM.java:112)
    at
   com.ibm.bpm.search.persistence.spi.impl.AbstractTaskIndexPM.list
   PendingTaskIndexDeletions(AbstractTaskIndexPM.java:597)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexBatchHelper.remo
   veOrphanProcessIndexEntries(ProcessIndexBatchHelper.java:502)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessSearchIndexerImpl.rem
   oveOrphanProcessIndexEntries(ProcessSearchIndexerImpl.
   java:2333)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.pr
   ocessTaskChangeMessages(ProcessIndexUpdaterDaemon.java:686)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.pe
   rformActiveWork(ProcessIndexUpdaterDaemon.java:246)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.ru
   nActive(ProcessIndexUpdaterDaemon.java:204)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.ru
   n(ProcessIndexUpdaterDaemon.java:138)
   
   [3/4/16 0:48:26:750 CET]     FFDC
   Exception:java.lang.OutOfMemoryError
   SourceId:com.ibm.ws.asynchbeans.J2EEContext.run ProbeId:394
   Reporter:com.ibm.ws.asynchbeans.J2EEContext@34aa3925
   java.lang.OutOfMemoryError: Java heap space
    at java.lang.Long.valueOf(Long.java:568)
    at
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO.<init>(TaskI
   ndexVO.java:61)
    at
   com.ibm.bpm.search.persistence.spi.impl.AbstractTaskIndexPM.buil
   dTaskIndex(AbstractTaskIndexPM.java:114)
    at
   com.ibm.bpm.search.persistence.spi.impl.AbstractTaskIndexPM.list
   PendingTaskIndexDeletions(AbstractTaskIndexPM.java:597)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexBatchHelper.remo
   veOrphanProcessIndexEntries(ProcessIndexBatchHelper.java:502)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessSearchIndexerImpl.rem
   oveOrphanProcessIndexEntries(ProcessSearchIndexerImpl.
   java:2333)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.pr
   ocessTaskChangeMessages(ProcessIndexUpdaterDaemon.java:686)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.pe
   rformActiveWork(ProcessIndexUpdaterDaemon.java:246)
    at
   com.ibm.bpm.search.process.spi.impl.ProcessIndexUpdaterDaemon.ru
   nActive(ProcessIndexUpdaterDaemon.java:204)
   
      There are a large number of this object on the heap
   java.util.ArrayList @ 0x719d3de70
   24 3,300,142,144 88.36%
   \
   java.lang.Object[2872626] @ 0x7e08a2fa8
   11,490,520 3,300,142,120 88.36%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a079f0 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07a28 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07a60 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07a98 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07ad0 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07b08 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07b40 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07b78 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07bb0 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07be8 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07c20 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07c58 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07c90 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07cc8 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07d00 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07d38 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07d70 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07da8 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07de0 56 1,560 0.00%
   .+
   com.ibm.bpm.search.persistence.spi.impl.TaskIndexVO @
   0x796a07e18 56 1,560 0.00%
   
   PRODUCTS AFFECTED
   IBM Business Process Manager (BPM) Advanced
   IBM BPM Standard
   IBM BPM Express
   
   
    
   
   

LOCAL FIX
 *  Rebuild the process index by following the procedure documented
   in the article:
   https://developer.ibm.com/answers/questions/209176/how-to-invest
   igate-and-solve-a-portal-index-out-of.html [https://developer.ibm.com/answers/questions/209176/how-to-investigate-and-solve-a-portal-index-out-of.html]
   
   
    
   
   

PROBLEM SUMMARY
 *  When you use the BPMProcessInstancesCleanup wsadmin command to
   purge tasks and instances from the database, the next time the
   IBM Process Portal indexer runs (automatically, during the next
   indexing interval), the indexer tries to delete those tasks and
   instances from the Process Portal index in one transaction. As a
   result, the deletion might use enough heap memory to cause an
   out of memory error.
   
   
    
   
   

PROBLEM CONCLUSION
 *  A fix is available for IBM BPM V8.5.5.0 that splits the deletion
   of tasks and instances from the Process Portal index into
   batches of 5000 per transaction, limiting the heap usage and
   reducing the likelihood of an out of memory error.
   
   On Fix Central (http://www.ibm.com/support/fixcentral), search
   for JR54004.
   
    1. Select IBM Business Process Manager with your edition from
   the product selector, the installed version to the fix pack
   level, and your platform, and then click Continue.
    2. Select APAR or SPR, enter JR54004, and click Continue.
   
   When you download fix packages, ensure that you also download
   the readme file for each fix. Review each readme file for
   additional installation instructions and information about the
   fix.
   
   
    
   
   

TEMPORARY FIX
 *  Not applicable
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   JR54004
   
   
 * REPORTED COMPONENT NAME
   BPM ADVANCED
   
   
 * REPORTED COMPONENT ID
   5725C9400
   
   
 * REPORTED RELEASE
   855
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2015-08-04
   
   
 * CLOSED DATE
   2015-12-11
   
   
 * LAST MODIFIED DATE
   2016-04-01
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   BPM ADVANCED
   
   
 * FIXED COMPONENT ID
   5725C9400
   
   

APPLICABLE COMPONENT LEVELS
 * R855 PSY
   UP