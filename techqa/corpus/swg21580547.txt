Title: IBM Secondary ImpactServer starts, but doesn't process events - United States

Text:
netcool; impact; netcool/impact; nci; cluster; impactcluster; primary; secondary; running; process; processing; processes; time; out; timeout; ping TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Although the Secondary ImpactServer is running it is not seen to be processing anything 

SYMPTOM
No new entries in the Secondary PolicyLogger log files or EventProcessor.


DIAGNOSING THE PROBLEM
A Secondary ImpactServer (called Geoff in this example) is started in the Cluster and (from Geoff's netcool.log) it recognises that there is a Primary ImpactServer (called Brian in this example) already running: 

INFO [ClusterMember] A valid primary is running with name: Brian
...
DEBUG [ClusterMember] Added as a cluster member: Geoff. Primary is: Brian

All well and good so far. Also (from Brian's netcool.log) we see Brian acknowledge that Geoff has registered as a Secondary with the NameServer for the Cluster (called MikeLuster in this example):

INFO [ClusterMember] Added Geoff into the cluster MikeLuster

However (from Brian's netcool.log again) Brian's attempt to ping Geoff times out:

DEBUG [ClusterMember] Ping to cluster member Geoff has timed out.

It seems that at this point Brian declares Geoff a non-entity and will not be attempting to send events to Geoff for processing. Also (from Geoff's netcool.log) we see that Geoff has timed out waiting for Brian's ping:

DEBUG [ClusterMember] Did not receive a ping message from primary: Brian. Checking to become primary

Geoff then backs down when it finds Brian is in fact still running:

DEBUG [ClusterMember] No need to convert to Primary because the current primary Brian is running ok

and then (from Geoff's netcool.log again) we see that Geoff has finally fully started:

INFO [ImpactServerManagedBean] Impact instance [Geoff] started successfully

Geoff keeps on timing out on waiting for Brian's pings and seeks to become Primary only to back down each time when it confirms with the NameServer that Brian is still the Primary ImpactServer in the MikeLuster Cluster. All the while Brian is regarding Geoff as a dead ImpactServer.




RESOLVING THE PROBLEM
This is presumed to be a network latency issue and an increase the ping time-out values is in order. These are set in the ImpactServer properties file: 


$NCHOME/impact/etc/[ImpactServerName]_server.props

on each host and is covered by the property:

impact.cluster.pingtimeout=[n]

However, if one is going to increase this (default 6000 (milliseconds)) we would suggest also increasing the interval between pings (default also 6000) by a similar amount:

impact.cluster.pinginterval=[n]

and the number pings to fail before throwing in the towel (default 3):

impact.cluster.repingcount=[n]

Here's what a default Cluster configuration looks like:

impact.cluster.name=NCICLUSTER
impact.cluster.pinginterval=6000
impact.cluster.pingtimeout=6000
impact.cluster.repingcount=3
impact.cluster.resyncbeforestandby=true
impact.replication.receiveupdatesfor.orgnodes=true
impact.replication.receiveupdatesfor.hibernations=true
impact.replication.receiveupdatesfor.servicestates=true
impact.replication.receiveupdatesfor.types=true
impact.replication.receiveupdatesfor.policies=true