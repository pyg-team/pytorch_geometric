Title: IBM PK80871: MESSAGING ENGINE FAILS TO START WITH ARRAYINDEXOUTOFBOUNDS EXCEPTION BEING THROWN DUE TO CORRUPT MESSAGE - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS UNREPRODUCIBLE IN NEXT RELEASE.
    
   
   

ERROR DESCRIPTION
 *  Messaging engine fails to start due to ArrayIndexOutOfBounds
   Exception. The "java.lang.ArrayIndexOutOfBoundsException: 0"
   exception from MessageItem.restore indicates that the column
   in the table that should contain the data for this message is
   empty. The exception handling causes the whole messaging engine
   to fail to start with the following error:
     CWSIS0002E: The messaging engine encountered an
     exception while starting. Exception:
     com.ibm.websphere.sib.exception.SIErrorException:
     java.lang.ArrayIndexOutOfBoundsException: 0
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  Users of the default messaging provider     *
   *                  for WebSphere Application Server            *
   *                  Version 6.0, Version 6.1 or Version 7.0     *
   ****************************************************************
   * PROBLEM DESCRIPTION: An ArrayIndexOutOfBoundsException       *
   *                      due to data store corruption caused by  *
   *                      APAR PK81848 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81848] prevents a messaging       *
   *                      engine from starting with a CWSIS0002E  *
   *                      error.                                  *
   ****************************************************************
   * RECOMMENDATION:  Follow the instructions in this APAR to     *
   *                  confirm APAR PK81848 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81848] has been               *
   *                  encountered, and manually correct the       *
   *                  corruption in the data store.               *
   *                  Apply a fix for PK81848 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81848].                    *
   ****************************************************************
   APAR PK81848 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81848] might cause corruption within the data store of a
   messaging engine, after a period of slow database response.
   This corruption is limited to individual transactions that
   have already been rolled back by the transaction manager.
   
   Correcting the corruption in the database tables for the
   messaging engine that fails to start allows the messaging
   engine to restart. Applying a fix for PK81848 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81848] prevents the
   issue from re-occurring.
   
   The manual procedure described below allows the data store
   corruption to be corrected.
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX
 *  The following procedure can be used to identify the
   corrupt data associated with a rolled back transaction
   (caused by PK81848 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK81848]) and roll back that transaction manually to
   allow the messaging engine to start:
   1. Take a full backup of the database schema for the messaging
      engine that cannot start.
      If any mistakes are made when issuing SQL statements that
      alter the database in the following steps, this backup
      should be restored, and the steps should be repeated with
      the mistake corrected before any attempt is made to
      restart the messaging engine.
   2. Find the most recent FFDC report containing one of
      the following probeid values:
      WebSphere Application Server V6.0:   1:1729:1.199.1.6
      WebSphere Application Server V6.1:   1:1899:1.212.1.3
      This FFDC will be in the 'logs/ffdc' directory of the
      application server that logged the CWSIS0002E error.
      If you do not find an FFDC report with a matching
      probeid then you should not attempt to follow any of the
      later steps, and should contact IBM Support for guidance.
   3. Open the FFDC file in a text editor, and search for the
      text "tranID". You should find section of the FFDC
      containing some text between the following XML-like tags:
      <tranID></trandID>
   4. Take a copy of the text that is between the
      <tranID></trandID> tags. You will use this in later steps.
   5. Issue the following SQL query against the schema in the
      database for the messaging engine that has failed to start:
        SELECT ID,DATA_SIZE,DELETED FROM
                          MYMESCHEMA.SIB001 WHERE XID IN 'TRANID'
      Replace MYMESCHEMA with the schema for the messaging engine
      Replace TRANID with the text copied in step (4)
   6. Confirm at least one row is returned from the above query,
      and that at least one row in the rows returned contains
      a DATA_SIZE column with value 0.
   7. For each row returned take a note of the ID column, and
      whether the boolean DELETED column has value true or false.
      Note: Depending on your database implementation, true and
            false may be represented as 1 and 0.
   8. For each row from step (7) for which the DELETED column is
      boolean true, issue the following SQL update:
        UPDATE MYMESCHEMA.SIB001 SET
                          DELETED = BOOL_FALSE WHERE ID = ROWID
      Replace MYMESCHEMA with the schema for the messaging engine
      Replace BOOL_FALSE with the appropriate identifier for a
        true boolean value in the SQL for your database (0/FALSE)
      Replace ROWID with the ID column for the row from step (7)
   8. For each row from step (7) for which the DELETED column is
      boolean false, issue the following SQL update:
        DELETE FROM MYMESCHEMA.SIB001 WHERE ID = ROWID
      Replace MYMESCHEMA with the schema for the messaging engine
      Replace ROWID with the ID column for the row from step (7)
   9. Issue the following SQL update:
        DELETE FROM MYMESCHEMA.SIBXACTS WHERE XID IN 'TRANID'
      Replace MYMESCHEMA with the schema for the messaging engine
      Replace TRANID with the text copied in step (4)
   Once the above steps have been completed, an attempt can be
   made to start the messaging engine.
   If the messaging engine fails to start with the same
   CWSIS0002E error, then there may be multiple transactions
   affected by the issue. In this case repeat steps (2) to (9).
   If any other symptoms are seen that prevent the messaging
   engine from starting, or operating correctly, then use the
   collector tool to gather all logs, ffdcs and configuration from
   the node logging the failure and submit it to IBM Support for
   investigation. Please also send the backup of the database
   taken in step (1).
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK80871
   
   
 * REPORTED COMPONENT NAME
   PLAT MSG COM
   
   
 * REPORTED COMPONENT ID
   620400101
   
   
 * REPORTED RELEASE
   100
   
   
 * STATUS
   CLOSED UR1
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-02-18
   
   
 * CLOSED DATE
   2009-03-31
   
   
 * LAST MODIFIED DATE
   2009-03-31
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   PLAT MSG COM
   
   
 * FIXED COMPONENT ID
   620400101
   
   

APPLICABLE COMPONENT LEVELS
 * R100 PSY
   UP