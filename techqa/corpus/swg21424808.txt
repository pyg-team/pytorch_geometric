Title: IBM Health Check events Node and Domain and their interactions. - United States

Text:
HealthCheck failed events; nco_p_ncpmonitor.rules; VirtualDomain TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 HealthCheck failed events are being received, nco_p_ncpmonitor.rules has been customized. 

SYMPTOM
Although both the Primary and Backup domains are up and (according to their mutual VirtualDomain processes) are healthy, each is sending Health Check Failed events for the other domain.


CAUSE
This document only applies to those installations where the nco_p_ncpmonitor.rules file has been edited to modify the inserted value for @Node in alerts.status or where @Node is being modified for health check events by some other external process. 

Each ITNM Gateway (ncp_ncogate) in the Primary and Backup domain retrieves health check events from alerts.status and constructs an update into the state.domains table in the VirtualDomain process. Please review the documentation in the 'Related Information' section below for more information on the Health Check process.


DIAGNOSING THE PROBLEM
When you run the ncp_ncogate process in debug you can see the update that the gateway makes in state.domains. The value for m_Domain should be the same as the Domain name for the Primary or the Backup domain. It should not be the name of the Virtual domain. 


ProcessHealthCheck sent:update state.domains set m_HealthStatus=1 where m_Domain='ITNM';


RESOLVING THE PROBLEM
The value for m_Domain is taken from the value for Node (@Node) in alerts.status for the health check event. If you have altered the inserted value for @Node, either by modifying the nco_p_ncpmonitor.rules file or by some other method such as an Automation or Impact policy, then the resulting update for state.domains will fail. Ensure that the rules governing the modification of @Node allow for the value of @Node to remain unchanged for health check events.

RELATED INFORMATION
#failover [http://publib.boulder.ibm.com/infocenter/tivihelp/v8r1/topic/com.ibm.networkmanagerip.doc_3.8/itnm/ip/wip/install/concept/nmip_ins_failoverop.html]