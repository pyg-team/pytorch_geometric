Title: IBM IV96080: SET THE APPROPRIATE SSL PROPERTIES IN CODES THAT ARE REQUIRED FOR MUTUAL KEYSTORE AUTHENTICATION. - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS FIXED IF NEXT.
    
   
   

ERROR DESCRIPTION
 *  we are using Omnibus 8.1 and the new Huawei U2000 Corba probe.
   With
   this probe we are not able to connect to the Huawei U2000 EMS.
   It looks
   somehow for me like a problem with SSL. I saw also, that its not
   working if we use the encrypted password in the probe properties
   file
   for the KeyStorePassword property
   
   Seems you have an issue with the SSL keystore:
   
   
   Failed to resolved to Naming Context
   :org.omg.CORBA.NO_PERMISSION:
   Client-side policy requires SSL/TLS, but server doesn't support
   it
   vmcid: 0x0  minor code: 0  completed: No
   
   It's looking like it's trying sslv3 but can't due to no
   certificate, a
   little later it goes;
   
   ClientMessageReceptor0, WRITE: SSLv3 Handshake, length = 64
   ClientMessageReceptor0, waiting for close_notify or alert: state
   1
   ClientMessageReceptor0, READ: SSLv3 Alert, length = 2
   ClientMessageReceptor0, RECV SSLv3 ALERT:  fatal,
   handshake_failure
   %% Invalidated:  [Session-1, SSL_RSA_WITH_3DES_EDE_CBC_SHA]
   ClientMessageReceptor0, called closeSocket()
   ClientMessageReceptor0, Exception while waiting for close
   javax.net.ssl.SSLHandshakeException: Received fatal alert:
   handshake_failure
   %% Invalidated:  [Session-1, SSL_RSA_WITH_3DES_EDE_CBC_SHA]
   ClientMessageReceptor0, called closeSocket()
   ClientMessageReceptor0, handling exception:
   javax.net.ssl.SSLHandshakeException: Received fatal alert:
   handshake_failure
   ProbeRunner, handling exception:
   javax.net.ssl.SSLHandshakeException:
   Received fatal alert: handshake_failure
   2016-12-14 15:09:57.538 FINE  Transport to 172.17.116.25:22001:
   stream
   closed Received fatal alert: handshake_failure
   2016-12-14 15:09:57.544 FINE  to_COMM_FAILURE: Caught exception
   javax.net.ssl.SSLHandshakeException: Received fatal alert:
   handshake_failure
   ---------
   
   Customer is hitting a
   javax.net.ssl.SSLHandshakeException:áReceivedáfataláalert:
   handshake_failure
   %%áInvalidated:áá[Session-1,áSSL_RSA_WITH_3DES_EDE_CBC_SHA]
   
   and requesting for reasons for handshake failure.
   
   ----------
   echo "nco_p_huawei_u2000_env"
   echo $CLASSPATH
   
   
   NCO_JPROBE_JAVA_FLAGS="-Djavax.net.debug=ssl:handshake:verbose
   $NCO_JPROBE_JAVA_FLAGS"
   NCO_JPROBE_JAVA_FLAGS="-Dcom.ibm.jsse2.disableSSLv3=false
   $NCO_JPROBE_JAVA_FLAGS"
   NCO_JPROBE_JAVA_FLAGS="-Djavax.net.ssl.keyStore=$NCHOME/etc/prop
   s/keysto
   re_test/testik2.jks -Djavax.net.ssl.keyStorePassword=netcool
   $NCO_JPROBE_JAVA_FLAGS"
   
   NDE_DEFAULT_LOG_LEVEL=debug
   NDE_FORCE_LOG_MODULE=/opt/IBM/tivoli/netcool/omnibus/probes/nonn
   native_f
   orce.log
   NCO_P_NONNATIVE_TRANSCRIPT=/opt/IBM/tivoli/netcool/omnibus/probe
   s/nonnat
   ive_debug.log
   export NDE_DEFAULT_LOG_LEVEL
   export NDE_FORCE_LOG_MODULE
   export NCO_P_NONNATIVE_TRANSCRIPT
   export NCO_JPROBE_JAVA_FLAGS
   
   -------
   Customer asked for permenant fix to env file workaround:
   
   
   NCO_JPROBE_JAVA_FLAGS="-Dcom.ibm.jsse2.disableSSLv3=false
   -Djavax.net.ssl.keyStore=/home/test/March_27/13934.124.848.testi
   k2.jks
   -Djavax.net.ssl.keyStorePassword=netcool"
   
   As they require encrypted passwords
   
   So a summary what I see still as a content of the current
   ticket:
   
   ·         Fix the necessity of workaround with using env file
   for
   defining keystore and password (plaintext)
   
   ·         Fix that keystore is not picked up from props properly
   
   ·         Fix that keystore password in props encrypted by
   nco_g_cryp
   does not work
   
   APAR is to set the appropriate SSL properties in codes that are
   required
   for mutual keystore authentication.
   
   
    
   
   

LOCAL FIX
 *  None really, though setting the file locations in the ..env file
   will get farther than earlier;
   
    Customer asked for permenant fix to env file workaround:
   
   
   NCO_JPROBE_JAVA_FLAGS="-Dcom.ibm.jsse2.disableSSLv3=false
   -Djavax.net.ssl.keyStore=/home/test/March_27/13934.124.848.testi
   k2.jks
   -Djavax.net.ssl.keyStorePassword=netcool"
   
   As they require encrypted passwords
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All users of CORBA probes with dependency on Corba Framework *
   * in environment where mutual SSL authentication is required.  *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * When target device requires mutual SSL authentication, the   *
   * probe may observe SSL handshake failure.                     *
   *                                                              *
   * ClientMessageReceptor0, WRITE: SSLv3 Handshake, length = 64  *
   * ClientMessageReceptor0, waiting for close_notify or alert:   *
   * state 1                                                      *
   * ClientMessageReceptor0, READ: SSLv3 Alert, length = 2        *
   * ClientMessageReceptor0, RECV SSLv3 ALERT:  fatal,            *
   * handshake_failure                                            *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * User need to upgrade to Probe Corba Framework v8.3.          *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX
 *  Include the following flag in probe .env file:
   NCO_JPROBE_JAVA_FLAGS="-Djavax.net.ssl.keyStore=<keystore_path>
   -Djavax.net.ssl.keyStorePassword=<keystore_password>
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV96080
   
   
 * REPORTED COMPONENT NAME
   HUAWEI U2000 MT
   
   
 * REPORTED COMPONENT ID
   5724S44HU
   
   
 * REPORTED RELEASE
   100
   
   
 * STATUS
   CLOSED FIN
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-05-10
   
   
 * CLOSED DATE
   2017-05-30
   
   
 * LAST MODIFIED DATE
   2017-05-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS
 * R100 PSY
   UP