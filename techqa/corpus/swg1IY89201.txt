Title: IBM IY89201: BIP2384E WHEN USING ACCOUNTING AND STATISTICS WITH AGGREGATION - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  BIP2384E WHEN USING ACCOUNTING AND STATISTICS WITH AGGREGATION
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere Message Broker        *
   *                 using Accounting and Statistics data         *
   *                 gathering.                                   *
   ****************************************************************
   * PROBLEM DESCRIPTION: When using message flow aggregation     *
   *                      with accounting and statistics          *
   *                      gathering active, the aggregation       *
   *                      message flow may fail with error        *
   *                      messages BIP2121E and BIP2384E          *
   *                      written to the system log. The          *
   *                      Execution Group terminates and          *
   *                      restarts.                               *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   There are actually two problems. The first is specifically
   related to aggregation message flows. There is a separate
   thread that handles the timeout processing, and this thread is
   started as soon as the AggregateReply node is instantiated,
   which may be before all of the message flow nodes have been
   instantiated on broker startup. This thread may then start to
   gather accounting and statistics information before the
   complete message flow had been instantiated, and therefore
   before the complete node list had been created. Hence message
   BIP2384E is logged to indicate that the container used to
   gather statistics for a message flow transaction does not
   match the shape of the message flow that processed the input
   message.
   The second problem can occur with message flows that contain
   multiple input nodes, including aggregation message fan-in
   flows that contain an input queue for aggregation replies and
   an input queue for the control message. The multiple threads
   for the same message flow will share the same container that
   stores the accounting and statistics information for that
   message flow. The creation of this container does not have any
   locking mechanism around it such that it is possible that a
   second thread may start using the container before the list of
   nodes for  that message flow has been fully initialised.
   Again, this can lead to the BIP2384E error message.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The AggregateReply node timeout thread has been modified so
   that it does not start collecting accounting and statistics
   information until the message flow has been fully initialised.
   Also, locking has been implemented around the creation of the
   accounting and statistics container object so that multiple
   threads will not start to use it until it has been fully
   initialised with the list of nodes.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IY89201
   
   
 * REPORTED COMPONENT NAME
   WMB AIX V6
   
   
 * REPORTED COMPONENT ID
   5724J0501
   
   
 * REPORTED RELEASE
   100
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-09-05
   
   
 * CLOSED DATE
   2007-01-31
   
   
 * LAST MODIFIED DATE
   2007-10-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMB AIX V6
   
   
 * FIXED COMPONENT ID
   5724J0501
   
   

APPLICABLE COMPONENT LEVELS
 * R100 PSY
   UP