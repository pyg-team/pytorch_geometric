Title: IBM Summary of Backup and Recovery recommendations when using DAOS on IBM i - United States

Text:
Domino Attachment and Object Service; iSeries; OS/400; AS/400 TECHNOTE (FAQ)

QUESTION
How can I be sure I am saving all of the required data to restore my Domino environment when running Domino Attachment Object Service (DAOS)? What do I need to do to avoid affecting operation of my Domino servers when saving the rest of the system? 

Also, the abilities and available functions available with BRMS have changed over time. How do I know when specific options became available?


ANSWER
 

The answer varies depending on the save method and the Domino release. This document will cover native saves (SAV command), and BRMS. This document will also document the evolution of BRMS save / restore functionality throughout the Domino 8.5.0 - 8.5.2 releases. Here are the topics discussed in this document: 

1. Native saves using the SAV command (including a "option 21 save" or IBM operational assistant backup) at Domino 8.5.x 

2. Using BRMS to perform Full Saves of your Domino server while it is active at Domino release 8.5.1 or higher 

3. Omitting the DAOS files when using SAVDOMBRM to save your Domino server 

4. Using BRMS to perform Saves of your IFS while the Domino server is active at Domino release 8.5.1 or higher 

5. BRMS Incremental Saves 

6. Using BRMS to Save your Domino server while it is active at Domino release 8.5.0 

 

Native saves using the SAV command (including a "option 21 save" or IBM operational assistant backup) at Domino 8.5.x 

In this scenario the Domino server must be ended prior to the save. As long as you are saving the Domino data directory and the directory storing your .nlo files (may or may not be within the data directory) no changes are required to your existing save. 

 

back to top 

 

Using BRMS to perform Full Saves of your Domino server while it is active at Domino release 8.5.1 or higher 

At Domino 8.5.1 and higher, BRMS will automatically detect that DAOS is enabled and save the DAOS directory and all of the .nlo files within the DAOS directory. 

In this scenario there are a number of changes that may need to be made. 

 

1. Verify that BRMS PTF SI36193 (i 5.4) or PTF SI36197 (i 6.1) is applied. 

 

2. Omit the daoscat.nsf from the save (8.5.1 only). For example: 

 

[/support/docview.wss?uid=swg21420013&aid=1] [/support/docview.wss?uid=swg21420013&aid=1] 

 * 


It is possible you may see conflicts between Domino and BRMS when trying to save .nlo files. For more information refer to technote 1450004 "Object in use" or "Device is busy/In use" errors on .nlo files during SAVDOMBRM". [http://www.ibm.com/support/docview.wss?uid=swg21450004]  * 


back to top  

Omitting the DAOS files when using SAVDOMBRM to save your Domino server 

 

Starting at Domino release 8.5.1 FP2 and 8.5.2 you have the ability to omit the DAOS directory from your online save. To omit the DAOS directory you must specify the omit using the complete path of the DAOS directory followed by /*. For example: /DominoSvr/DAOS/*. Be aware this is different syntax from Domino database omits which must be specified relative to the Domino server's data directory. 

 

 * [/support/docview.wss?uid=swg21420013&amp;aid=2]


back to top 

 

Using BRMS to perform saves of your IFS while the Domino server is active 

 * 


There are default lists provided to you use to save the IFS data related to the Domino servers. Below is a table for your reference:  * 
 * 
 *  Native List Name System i Navigator Option Description *LNKOMTLTS Directories: Exclude all Lotus server save items Saves all IFS directories, but automatically excludes the data directory for all of the Domino servers. *LNKOMTONL Directories: Exclude Lotus server online save items Saves all of the IFS directory, including the Domino data directories. However; objects saved by a SAVDOMBRM save are automatically omitted. *LTSOMTONL All Lotus servers excluding online save items Saves the Domino server data directory excluding objects that are saved by a SAVDOMBRM save. 

 If you are using any of those lists while the Domino server is active you must ensure that files needed by Domino are omitted. This includes the notes.ini, server.id files and the transaction log and DAOS directories. A complete list can be found in "Note 3" in the BRMS documentation [http://www-03.ibm.com/systems/i/support/brms/dominitbrm.html]. Below is an example omit list for a *LNKOMTONL save: 

 

 * [/support/docview.wss?uid=swg21420013&amp;aid=3]



Note: At Domino 8.5.1FP5, 8.5.2 or above and minimum BRMS PTF SI40001(i 5.4), SI40006 (i 6.1), or SI40005 (i 7.1) the transaction log directory will be automatically omitted. 


Note: A data area can be used to automatically omit the *.ini, *.id, gtrhome directory and /tmp directory when using a BRMS/Domino dynamic linked list (*LNKOMTONL and *LTSOMTONL). This new function/data area check was added with BRMS PTFs SI34916 (i 5.4) and SI34918 (i 6.1). The data area is Q1ANLSTOMT [http://www.ibm.com/systems/i/support/brms/dataAreas.html] and needs to be created in library QUSRBRM. The QNOTES user profile must have access to the data area and library. Here is an example of the commands required to implement this option: 
 * CRTDTAARA DTAARA(QUSRBRM/Q1ANLSTOMT) TYPE(*CHAR) LEN(1)
 * 
 * 
 * GRTOBJAUT OBJ(QUSRBRM) OBJTYPE(*LIB) USER(QNOTES) AUT(*USE) 
 * 
 * 
 * GRTOBJAUT OBJ(QUSRBRM/Q1ANLSTOMT) OBJTYPE(*DTAARA) USER(QNOTES) AUT(*USE)
 * 
 * 


back to top



BRMS Incremental Saves 

 

BRMS incremental saves and restores are supported starting with Domino 8.5.1. When running a DAOS incremental save, all .nlo files created or changed since the last save will be saved. Outside of the general recommendations for changes when saving DAOS data at 8.5.1, no additional changes are required for incremental saves. 

 

At Domino 8.5.2 with BRMS PTF SI40001 (i 5.4), SI40006 (i 6.1) or SI40005 (i 7.1) you can choose to mix and match Domino and DAOS incremental saves. This would essentially give you the option to perform full .nsf saves daily, but incrementally save the .nlo files. Since .nlo files are static there is no need to save these files daily if you are in need of a way to reduce the time or space needed for your nightly saves. For more information refer to the BRMS documentation [http://www.ibm.com/systems/i/support/brms/domdaos.html].



back to top


Using BRMS to Save your Domino server while it is active at Domino release 8.5.0 


1. Domino 8.5.0 does not automatically save .nlo files. This means that if you are using SAVDOMBRM to save your Domino data you will need to create a custom linked list to save your .nlo files and modify your control group to save your new list. An example list is displayed below. For additional information on this, refer to the Power Systems Magazine article "Saving and Restoring Data in a DAOS Environment" [http://www.ibmsystemsmag.com/ibmi/november09/tipstechniques/27640p3.aspx]. 
 * [/support/docview.wss?uid=swg21420013&amp;aid=4]


2. Omit the daoscat.nsf from the save. See Figure 1 above. 

3. If you are saving the rest of the IFS using the a *LINK save with the QLNKOMT omit list or the *LNKOMTLTS linked list, you will need to modify your omit list so that your transaction logs and DAOS directories (assuming they are located outside the Domino Data Directory) are not saved using this method while the server is up. This is in addition to all previous recommendations to omit the server.id, notes.ini and /tmp directory. Figure 2 is an example of a modified QLNKOMTLTS which is the list associated with a *LNKOMTLTS save. Note: The server.id and notes.ini are not included in this example as they are included by default when running a *LNKOMTLTS save, but should be omitted for *LNKOMTONL and *LTSOMTONL saves. back to top

RELATED INFORMATION
 Saving and Restoring Data in a DAOS Environment [http://www.ibmsystemsmag.com/ibmi/november09/tipstechniques/27640p3.aspx]