Title: IBM IY53287: s12574 - Mq Error when stopping ITIM - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Problem Description:
   MQ error occurs when stopping ITIM server on WAS.
   
   Can Customer Recreate:
   Yes, and Japan L2 reproduced.
   
   ITIM Server Version - 4.5 with 0007LA
   
   Server Environment
   Operating System   : AIX5.1
   Database server    : DB2 V8.1 w/ FP2
   Directory server   : IDS5.1 w/ FP2
   Application Server : WebSphere V5.0 w/ FP2
   Java Version       :
   
   Desired Behavior:
   ITIM server should be stopped without any MQ error.
   
   Steps to Duplicate:
   This phenomena is caused by stopping enRole application from
   WebSphere
   Administration Console.
   The error message written into SystemOut.log is as follows;-
   
   J2CA0056I: The Connection Manager received a fatal connection
   error from
   the Resource Adaptor for resource JMS$ITIM Queue Connection
   Factory$JMSManagedConnection@1439461852.  The exception which
   was
   received is javax.jms.JMSException: MQJMS2002: failed to get
   message
   from MQ queue
   
   When WAS Diagnostic Trace Service is set to *=all=enabled, the
   following
   additional information is logged into the following directory.
   
   /var/mqm/errors
        AMERR01.LOG
        MQnnnnn.0.FDC
        AMQnnnnn.0.FDC     Note: nnnnnn is digits.
   
   /var/mqm/log/WAS_sprite_server1/active
        S0000000.LOG
   
   This phenomena has been investigated by embedded MQ team of WAS
   L3 in
   another PMR01523,6X8,760, and the comments is as follows;-
   
   ================================================================
   ========
   01523,6X8,760
   We have analysed the trace files with development, and believe
   we have
   spotted the cause of the problem.
   
   The traces obtained on December 12th show that an attempt was
   made to
   shut down the application server at 17:49:20:239. A few
   milliseconds
   later, the trace shows a number of occurrences of the following
   errors:
   ConnectionEve A J2CA0056I: The Connection Manager received a
   fatal
   connection error from the Resource Adaptor for resource JMS$ITIM
   Queue Connection Factory$JMSManagedConnection@2145446126.
   The exception which was received is javax.jms.JMSException:
   MQJMS2002: failed to get message from MQ queue
   
     javax.jms.JMSException: MQJMS2002: failed to get message from
   MQ queue
       at com.ibm.mq.jms.services.ConfigEnvironment.
          newException(ConfigEnvironment.java:540)
       at com.ibm.mq.jms.MQQueueReceiver.
          getMessage(MQQueueReceiver.java:1730)
       at com.ibm.mq.jms.MQQueueReceiver.
          receiveInternal(MQQueueReceiver.java:1152)
       at
   com.ibm.mq.jms.MQQueueReceiver.receive(MQQueueReceiver.java:545)
       at com.ibm.ejs.jms.JMSMessageConsumerHandle.
          receive(JMSMessageConsumerHandle.java:279)
       at com.ibm.itim.messaging.MessageManagerListener.
   
   processTransactedQueue(MessageManagerListener.java(Compiled
          Code))
       at com.ibm.itim.messaging.MessageManagerListener.
          run(MessageManagerListener.java:303)
     --- Begin backtrace for Nested Throwables
     com.ibm.mq.MQException: MQJE001: Completion Code 2, Reason
   2009
       at com.ibm.mq.MQQueue.getMsg2(MQQueue.java:893)
       at com.ibm.mq.jms.MQQueueReceiver.
          getMessage(MQQueueReceiver.java:1473)
          at com.ibm.mq.jms.MQQueueReceiver.
         receiveInternal(MQQueueReceiver.java:1152)
      at
   com.ibm.mq.jms.MQQueueReceiver.receive(MQQueueReceiver.java:545)
      at com.ibm.ejs.jms.JMSMessageConsumerHandle.
         receive(JMSMessageConsumerHandle.java:279)
      at com.ibm.itim.messaging.MessageManagerListener.
   
   processTransactedQueue(MessageManagerListener.java(Compiled
         Code))
      at com.ibm.itim.messaging.MessageManagerListener.
         run(MessageManagerListener.java:303)
   
   Each thread that shows the MQJE001 error then experiences a
   number of
   additional JMS and XA exceptions when attempting to close the
   connection.
   
   
   The exceptions are generated from the run() method in the class:
   
     com.ibm.itim.messaging.MessageManagerListener
   
   After seaching through RETAIN, I believe that this class is
   shipped as
   part of IBM Tivoli Identity Manager. Can you please ask the
   customer if
   their system is using this software?
   
   From the class name, we believe that ITIM is implementing their
   own
   Message Listener rather than using the standard one provided by
   WebSphere Application Server. This Message Listener is not
   registered as
   a Quiesce Listener with the application server, which means it
   is not
   contacted by the workload regulator during shut down. The
   Message
   Listener would continue to run until they receive errors
   indicating that
   the queue manager has gone away (as shown by the 2009 reason
   code).
   
   To resolve this problem, the ITIM development team will need to
   work
   with the workload regulator team to investigate how they can
   register
   the MessageManagerListener class as a quiesce listener.
   
   
    
   
   

LOCAL FIX
 *  s12574
   
   
    
   
   

PROBLEM SUMMARY
 *   Fixed and shipped in Interim fix 4.5.1-TIM-0008
   for BEA and 4.5.1-TIM-0009 for WebSphere.
   
   
    
   
   

PROBLEM CONCLUSION
 *  PROBLEM SUMMARY: Fixed and shipped in Interim fix 4.5.1-TIM-0008
   for BEA and 4.5.1-TIM-0009 for WebSphere.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IY53287
   
   
 * REPORTED COMPONENT NAME
   IBM TIV IDENT M
   
   
 * REPORTED COMPONENT ID
   5724C3402
   
   
 * REPORTED RELEASE
   450
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2004-02-04
   
   
 * CLOSED DATE
   2004-04-13
   
   
 * LAST MODIFIED DATE
   2004-04-13
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *     SERVER
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IBM TIV IDENT M
   
   
 * FIXED COMPONENT ID
   5724C3402
   
   

APPLICABLE COMPONENT LEVELS
 * R450 PSY
   UP