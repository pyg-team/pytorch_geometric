Title: IBM WebSEAL 6.1.1 Persistent Junction Connections Explained - United States

Text:
juction pooling; webseal; persistent connection; max-cached-persistent-connections TECHNOTE (FAQ)

QUESTION
 Explain how junction pooling / persistent connections work for TAMeb/WebSEAL 6.1.1 work. 

ANSWER
TAMeb/WebSEAL 6,1,1 introduced the support for junction pooling / persistent connections. 
Junction Persistent Connection Description:

The number of active connections to the backend Webserver are not
limited by the Junction Persistent Connections.

If an existing persistent connection is available to the backend
Webserver it will be used, otherwise a new socket will be created.

After the HTTP response has completed these checks are performed to
determine if the socket can remain persistent:
a) socket
b) HTTP response
c) server persistent connections are
less than the max-cached-persistent-connections

If all the checks are successful, the socket will remain persistent
otherwise the socket will be closed.

If Junction Persistent Connections is properly tuned, performance can
be significantly improved especially for SSL junction(s).

Tuning:

a) Global Persistent Connections

[junction]
...
max-cached-persistent-connections = <number_of_connections>
persistent-con-timeout = <= number_of_seconds>


b) Per Junction Persistent Connections Tuning

Where {junction_name} refers to the junction point for a standard
junction (including the leading / character) or the virtual host label
for a virtual host junction.

[junction:{junction_name}]
...
max-cached-persistent-connections = <number_of_connections>
persistent-con-timeout = <number_of_seconds>

Per Junction Persistent Connections Tuning overrides any Global
settings (if they exist).


The persistent connection max-cached-persistent-connections setting is
on a per server basis

For examples below with [junction] max-cached-persistent-connections = 10

a) If WebSEAL has 1 junction with 1 server the number of
persistent connections preserved could be as high as 10 connections
( 10 * 1 * 1 == 10 ).

b) If WebSEAL has 1 junction with 8 servers the number of
persistent connections preserved could be as high as 80 connections
( 10 * 1 * 8 == 80 ).

c) If WebSEAL has 20 junctions each with 8 servers the number of
persistent connections preserved could be as high as 1600 connections.
( 10 * 20 * 8 == 1600 )


The number of max-cached-persistent-connections should carefully consider
i) the number of file descriptors allowed by the WebSEAL process

File descriptors are a limited and should not be over committed.
The total number of file descriptors could be reduced further by the
process ulimits or system limits. If file descriptors are over committed,
then performance will be negatively impacted.

A simple backend Webserver request will utilize 2 (or more) file descriptors.
A file descriptor will be used by the Browse<->WebSEAL socket.
Another file descriptor will be used by the WebSEAL<->backend Webserver socket.

Additional file descriptors are utilized by
- junction ping requests
- user registry requests
- administrative requests
- external requests

The total number of junction persistent connection file descriptors
should be carefully calculated accessed against all other file descriptor requirements.



ii) the number of ephemeral ports available on the machine the WebSEAL process is running

The maximum number of ports on a per machine is limited to 65,535 (AIX - other OSs will have 
restrictions based on available file descriptors)

The number of available ephemeral (non-privilege and non-committed
ports) can be reduced by
- system configuration port to start ephemeral port scanning
- additional non-ephemeral port ranges
- TCP/IP tuning

Junction Persistent Connections reduce the number of available
ephemeral ports on the machine because the ports are being preserved
The persistent-con-timeout helps to reduce unneeded Junction
Persistent Connections and resources based on inactivity time.