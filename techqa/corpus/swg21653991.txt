Title: IBM SCA transaction behavior changes when migrating from WebSphere Process Server (WPS) V6.x - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The SCA global transaction behavior changed beginning with WebSphere Process Server V7.x and IBM Business Process Manager (BPM) Advanced. When you migrate an application from WebSphere Process Server V6.x, some use cases in the error handling for an application might behave differently. 

SYMPTOM
In later versions, a transaction might not roll back that was previously rolled back in WebSphere Process Server V6.x.


CAUSE
In WebSphere Process Server 6.x, the SCA layer automatically marks a transaction to rollback when it receives a runtime exception. This action prevents the application from catching the exception and performing custom error handling. This behavior was an undocumented internal product behavior that can change without notice. 

To allow for more flexibility in dealing with runtime exceptions, the behavior was changed in WebSphere Application Server V7, WebSphere Process Server V7, and subsequently, in IBM Business Process Manager Advanced releases. The change in the SCA layer is that it only marks a global transaction to rollback if the transaction was started at the SCA layer and the runtime exception is not caught by the application.

This behavior is defined in the SCA transaction intents [http://pic.dhe.ibm.com/infocenter/wasinfo/v7r0/topic/com.ibm.websphere.jpafep.multiplatform.doc/info/ae/ae/csca_global_trans.html] topic within the WebSphere Application Server Information Center under the "Rollback" section.

A global transaction can include the processing of various types of components and external resource managers(databases). This approach does not affect another component or resource manager from being able to force the rollback of the global transaction.


DIAGNOSING THE PROBLEM
A difference in behavior might be seen in the following cases: 

 * The runtime exception is caught and handled before reaching the end of the transaction. Previously, the transaction was rolled back even if the exception was caught. 
 * The global transaction is started by a non-SCA component and an SCA component is also involved in the transaction. However, the component handles the Javaâ„¢ exceptions differently. Some components like Enterprise JavaBeans (EJB) files or BPEL processes might not automatically rollback on an exception. You can review the documentation of the component type for specific information.

RESOLVING THE PROBLEM
To make it easier for you to migrate from WebSphere Process Server V6.x, APAR JR47431 provides a configuration flag that allows the WebSphere Process Server V6.x transaction behavior. With this flag enabled, the global transaction is marked to rollback when the SCA layer receives a runtime exception. You can enable the WebSphere Process Server V6.x transaction behavior by creating the SCA_ROLLBACK_TRANSACTION_IMPORT WebSphere environment variable and setting its value to true. 

 

You can also modify your application global transaction boundaries and component settings to get the desired behavior. The SCA transaction setting is described in the Transactions [http://pic.dhe.ibm.com/infocenter/dmndhelp/v8r0m1/topic/com.ibm.wbpm.wid.admin.doc/qos/topics/ctransactions.html] topic within the IBM Business Process Manager Information Center. 

 

If the transaction starts at the SCA layer, then you see the same behavior for uncaught exceptions with either behavior. If the global transaction is started by another component type, then you would need to review the related documentation for that component to determine its uncaught exception handling behavior. For example a BPEL component handles exceptions differently depending on the continue-on-error [http://pic.dhe.ibm.com/infocenter/dmndhelp/v8r0m1/topic/com.ibm.wbpm.bpc.doc/topics/cfaulthandling_continueonerror.html] setting or the fault handling [http://pic.dhe.ibm.com/infocenter/dmndhelp/v8r0m1/topic/com.ibm.wbpm.bpc.doc/topics/cfaulthandling_behavior.html] that is implemented. 

 



Cross reference information Segment Product Component Platform Version Edition Business Integration WebSphere Process Server Service Component Architecture AIX, HP-UX, i5/OS, Linux, Linux zSeries, Solaris, Windows, z/OS 7.0, 6.2, 6.1.2, 6.1, 6.0.2 
PRODUCT ALIAS/SYNONYM
 WPS