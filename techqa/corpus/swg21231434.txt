Title: IBM Getting DSRA0080E, "com.ibm.db2.jcc.b.SqlException: invalid operation: connection closed" due to DisconnectException - United States

Text:
DB2; DSRA0080E; com.ibm.db2.jcc.b.SqlException; connection closed; com.ibm.db2.jcc.b.DisconnectException; com.ibm.websphere.ce.cm.StaleConnectionException TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Customer uses DB2. After a normal application server start, many DSRA0080E exceptions are generated in the in the SystemOut.log. 

A trace with the components j2c, RRA and database enabled looks like: 

com.ibm.websphere.ce.cm.StaleConnectionException: A communication error has been detected. Communication protocol being used: UWReply.fill(). Communication API being used: recvBuff(). Location where the error was detected: ReasonCode=71. Communication function detecting the error: *. Protocol specific error codes(s) TCP/IP SOCKETS DB2ConnectionCorrelator: *LOCAL.db2inst1.050809212337
at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:80)
...
com.ibm.db2.jcc.b.DisconnectException: A communication error has been detected. Communication protocol being used: UWReply.fill(). Communication API being used: recvBuff(). Location where the error was detected: ReasonCode=71. Communication function detecting the error: *. Protocol specific error codes(s) TCP/IP SOCKETS DB2ConnectionCorrelator: *LOCAL.db2inst1.050809212337
at com.ibm.db2.jcc.c.a.a(a.java:374)
at com.ibm.db2.jcc.uw.UWReply.b(UWReply.java:108)
at com.ibm.db2.jcc.c.cb.c(cb.java:222)
...

[8/9/05 16:24:29:859 CDT] 1cc4f3f8 WSJdbcUtil e Encountered a Stale Connection: 
com.ibm.ws.rsadapter.jdbc.WSJccConnection@d8333c9
[8/9/05 16:24:29:859 CDT] 1cc4f3f8 WSJccConnecti > close
com.ibm.ws.rsadapter.jdbc.WSJccConnection@d8333c9
...
[8/9/05 16:24:29:919 CDT] 1cc4f3f8 GenericDataSt > mapExceptionHelper
[8/9/05 16:24:29:919 CDT] 1cc4f3f8 DB2DataStoreH > findMappingClass for: com.ibm.db2.jcc.b.SqlException: invalid operation: connection closed
[8/9/05 16:24:29:919 CDT] 1cc4f3f8 DB2DataStoreH e the DataStoreHelper is: 
com.ibm.websphere.rsadapter.DB2UniversalDataStoreHelper@71e173df
[8/9/05 16:24:29:919 CDT] 1cc4f3f8 GenericDataSt > findMappingClass for exception
com.ibm.db2.jcc.b.SqlException: invalid operation: connection closed
at com.ibm.db2.jcc.b.o.Ab(o.java:3683)
at com.ibm.db2.jcc.b.o.getCatalog(o.java:1704)
at com.ibm.db2.jcc.b.ec.getCatalog(ec.java:223)
at com.ibm.ws.rsadapter.spi.WSRdbManagedConnectionImpl.getCatalog(WSRdbManagedConnectionImpl.java:688)
...
[8/9/05 16:24:29:920 CDT] 1cc4f3f8 WSRdbManagedC W DSRA0080E: An exception was received by the Data Store Adapter. See original exception message: com.ibm.db2.jcc.b.SqlException: invalid operation: connection closed
at com.ibm.db2.jcc.b.o.Ab(o.java:3683)
at com.ibm.db2.jcc.b.o.getCatalog(o.java:1704)
... 

CAUSE
The root cause of the problem is the com.ibm.db2.jcc.b.DisconnectException.
When the database socket is disconnected due to a reason such as the database is down or the network has a problem, a connection is not there. 

Nevertheless, the resource adaptor FFDC tries to process it and triggers the DSRA0080E SqlException, connection closed, which surfaces a stale connection. 

Although this causes no bad effects, it is confusing to see these DSRA0080E SqlExceptions.


RESOLVING THE PROBLEM
Fix the DisconnectException, which is a communication issue due to a reason such as the database is down or the network has a problem, or there is a firewall that blocks connections. The issue should be reviewed by the network team, the DB2 Database Administrator and possibly DB2 support team. This technote is intended to point out that the DSRA0080E is not the root cause of the problem.

 



Cross reference information Segment Product Component Platform Version Edition Application Servers Runtimes for Java Technology Java SDK 
HISTORICAL NUMBER
 01986
999
781