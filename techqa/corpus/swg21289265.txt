Title: IBM Use the Type 4 JDBC driver in JPA applications with data sources that are configured as a <non-jta-data-source> entry - United States

Text:
V61EJBFPR; PersistenceException; COMMIT or ROLLBACK invalid for application execution environment; fatal general error; fatal; Type 4 JDBC driver; Type 2 JDBC driver; type 4; JPA applications; JPA; data sources; non-jta-data-source TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 As part of the Feature Pack for EJB 3.0, IBM® WebSphere® Application Server V6.1 provides the ability to configure a non-transactional data source, which you configure as a <non-jta-data-source> entry within the persistence.xml file for the Java Persistence API (JPA) application. Non-transactional data sources are not automatically enlisted in the current transaction context like other data sources that are configured in WebSphere Application Server.

Type 2 Java Database Connectivity (JDBC) drivers do not work consistently with a data source that is configured as a <non-jta-data-source> entry for JPA applications.

The Type 2 JDBC driver still enlists the data source with the current transaction context despite a non-transactional data source configuration. This automatic enlistment prevents the application and application server code from invoking local commit or rollback methods at run time that are explicit to the database resource. This situation occurs because the database server is waiting for instructions from the external transaction. 

SYMPTOM
The SystemOut log file contains an exception that is similar to the following entry: 

<openjpa-1.0.1-r420667:592145 fatal general error>
org.apache.openjpa.persistence.PersistenceException: 
COMMIT or ROLLBACK invalid for application execution 
environment
:
Caused by: com.ibm.db2.jcc.a.SqlException: 
COMMIT or ROLLBACK invalid for application execution 
environment
at com.ibm.db2.jcc.a.p.g(p.java:1197)
at com.ibm.db2.jcc.a.p.commit(p.java:1184)
at com.ibm.db2.jcc.a.dc.commit(dc.java:163)
at com.ibm.ws.rsadapter.jdbc.WSJdbcConnection.
commit(WSJdbcConnection.java:893)
at org.apache.openjpa.lib.jdbc.DelegatingConnection.
commit(DelegatingConnection.java:204)
at org.apache.openjpa.lib.jdbc.
LoggingConnectionDecorator$LoggingConnection.
commit(LoggingConnectionDecorator.java:257)
at org.apache.openjpa.lib.jdbc.DelegatingConnection.
commit(DelegatingConnection.java:204)
at org.apache.openjpa.lib.jdbc.
ConfiguringConnectionDecorator$
ConfiguringConnection.commit
(ConfiguringConnectionDecorator.java:124)
at org.apache.openjpa.jdbc.kernel.AbstractJDBCSeq.
closeConnection(AbstractJDBCSeq.java:202)
... 52 more


ENVIRONMENT
This behavior is only applicable to the Type 2 JDBC driver with WebSphere Application Server for z/OS®. This behavior does not occur with Type 2 JDBC drivers on other operating systems.


RESOLVING THE PROBLEM
Use the Type 4 JDBC driver for data sources that you configure as a <non-jta-data-source> entry.

RELATED INFORMATION
#Release notes: Feature Pack for EJB 3.0 [http://www14.software.ibm.com/webapp/wsbroker/redirect?version=v610ejb&product=was-base-dist&topic=relnotes]