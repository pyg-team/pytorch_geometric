Title: IBM Force swap/change of Master IBM.RecoveryRM Daemon - United States

Text:
TSA; TSAMP; force; master; swap; recrm; ibm.recoveryrm; ibm.recoveryrmd; samreset TECHNOTE (FAQ)

QUESTION
 To force the Master IBM.RecoveryRM (RecRM) daemon hosted by one node to move to another node, the following information is available. 

CAUSE
There are various reasons to force the switch of the Master RecRM daemon from one node to another ... here are a few of them :
1. Appears that the Master RecRM daemon is hung 
2. Cluster appears to be in an abnormal/inconsistent state per lssam output
3. Clearing a move request in TSAMP 2.2 or earlier
4. Commands appear hung or are not returning


ANSWER
New/Preferred Method: 

You can download the latest version of getsadata (V8.3.5+)from the following technote:
http://www-01.ibm.com/support/docview.wss?rs=820&uid=swg21285496 [http://www-01.ibm.com/support/docview.wss?rs=820&uid=swg21285496]
Issue the getsadata command as root on any node in the cluster with the following syntax:
./getsadata -samreset

You will see status messages showing you where the new master has moved to. 

 

Previous/Alternate Method: 

The first step in forcing the move of the Master RecRM daemon to another node is determining which node is currently host to the Master daemon. There are a number of ways to determine this, some of them include: 

1. lssamctrl -V 

2. lssrc -ls IBM.RecoveryRM | grep -i master 

3. lsrg -V 

Here is an example of the first command and its output:
[/support/docview.wss?uid=swg21443445&aid=1] [/support/docview.wss?uid=swg21443445&aid=1]

Once the node hosting the Master RecRM daemon is identified you need to open a shell to that node if you do not already have one open. 
You must perform the next steps as the root user or a user with similar permissions.

Issue a "ps -ef" command to find the IBM.RecoveryRMd processes running :

salx1:~ # ps -ef | grep -i ibm.recoveryrmd | grep -v grep
root 26464 1985 0 Aug09 ? 00:00:01 /usr/sbin/rsct/bin/IBM.RecoveryRMd

Then kill the PID of the parent IBM.RecoveryRMd process. In the example above its '26464'.

# kill 26464

The process will immediately be restarted by srcmaster ... you can check with the ps command to see the new PID. Another node in the cluster should now be hosting the Master RecRM daemon.

Check the first command to see if the Master RecRM has now moved to a different node.

Once you complete the move of the master to the new node you should verify that resource validation has completed before issuing any new TSAMP commands. To verify that resource validation has completed use the following command and attribute value:

[/support/docview.wss?uid=swg21443445&aid=2] [/support/docview.wss?uid=swg21443445&aid=2]

If the value of "In Config State" is true then resource validation has completed. If the value is false then resource validation is still in process. While resource validation is still being performed (In Config State = False) then some TSAMP commands will appear to hang but in reality they are being ignored by TSAMP until the resource validation period is completed.