Title: IBM Copying the LATEST directory version of a sub-branch to the MAIN LATEST directory version - United States

Text:
copy; version; merge; branch; copy/merge; element; move data; 1125348 TECHNOTE (FAQ)

QUESTION
 How can you perform a copy (merge) of the exact LATEST directory version on a sub-branch to the MAIN LATEST directory version when using IBM® Rational® ClearCase® on Microsoft® Windows®, UNIX® or Linux®? 

ANSWER
 

The actual merge operation requires that there are element versions on both the source, branch A, and the target, branch B, where the resulting versions are a combination of the versions that pre-existed on those branches. 

For more details on how the merge works, review the merge algorithm, which is documented in the IBM Rational ClearCase Developing Software manual under Base ClearCase: "Working On a Team" > "Merging". 

These instructions will step you through completing a copy of the LATEST element versions on the source, branch A, to the target, branch B, where the resulting versions on branch B will be identical to the versions on branch A. 

Note: There will not be a merge arrow created as a result of this procedure between the source and target directories; hence, the procedure is referred to as a copy (merge). 


Use these steps to perform a copy (merge) of the exact LATEST directory version of a sub-branch (contains directories and elements and some new elements that do not exist in the MAIN branch) to be the MAIN LATEST directory version. 

Note: These examples were created using a dynamic view, however, they will work in a snapshot view, but you must have the source and destination locations loaded into your view. 

 

 1. On UNIX or Linux, this can be done in two steps. First, for the directories so that all of the file elements can be seen on the target branch, MAIN, and then again for the file elements. 
    
    
 2. On Windows, there are more steps because the command line syntax changes, but it does the same process.
    


EXAMPLE Scenario: There is a MAIN branch and a sub-branch, R1.0, in a VOB. After some development, the code on R1.0 needs to be released. The merge to MAIN LATEST will be a duplicate/copy of the R1.0 LATEST version. 

Note: This is only an example and the command syntax can be modified to perform the copy to and from alternate branches.


From a view with a default config_spec, do the following:


On UNIX or Linux: 

 1. cleartool findmerge . -fversion /main/R1.0/LATEST -type d -merge
    
    
 2. cleartool find . -type f -version 'version(.../R1.0/LATEST)' -exec 'cleartool co -nc "$CLEARCASE_PN" ; cp "$CLEARCASE_XPN" "$CLEARCASE_PN" ; cleartool ci -ident -nc "$CLEARCASE_PN"'


Note: To verify the results of the copy (merge) prior to checking in the directory version on MAIN, you should omit, ; cleartool ci -ident -nc $CLEARCASE_PN', from the command syntax of step #2. Then set to a MAIN LATEST view to confirm the results of the copy merge. If the results are correct, then you can just run the command syntax in step #2. The copy (merge) will just repeat, but nothing new will get copied and the versions will get checked in on MAIN. Otherwise, the checkouts can be canceled by modifying the command syntax of step #2 to run ; cleartool unco $CLEARCASE_PN', instead. The copy operation will repeat, but nothing new will get copied and then the checkouts will get canceled allowing you to back-out of the copy (merge) operation.  

 

On Windows: 

 1. cleartool findmerge . -fversion /main/DEV2/LATEST -type d -merge
    
    
 2. cleartool find . -type f -version "version(.../main/DEV2/LATEST)" -print -exec "cleartool co -nc %CLEARCASE_PN%"
    
    
 3. cleartool find . -type f -version "version(.../main/DEV2/LATEST)" -print -exec "cmd /c copy %CLEARCASE_XPN% %CLEARCASE_PN%"
    Note: You may find under some circumstances (for instance, to find filenames that contain spaces) that it is necessary to place double quotes around the variable %CLEARCASE_PN%.
    
    
 4. Use a MAIN LATEST view to verify the results of the copy (merge) prior to proceeding to step #5.The checkouts can be canceled by modifying the command syntax of step #5 to run cleartool unco, instead. This is a method to cancel (or back out) of the operation to start over, 
    
    
 5. cleartool find . -type f -version "version(.../main/DEV2/LATEST)" -print -exec "cleartool ci -ident -nc %CLEARCASE_PN%"


This will copy everything from the source directory version on the sub-branch to the LATEST directory version created on MAIN. The commands also include directions to perform a check in on the target branch after the copy merge has been completed. This does not draw the merge arrow for files it only copies over the file and checks it in. In order to draw the hyperlink you can can run a find command similar to the following: 

cleartool find . -type f -version "version(/main/branch/LATEST)" -print -exec "cleartool mkhlink -unidir Merge %CLEARCASE_XPN% %CLEARCASE_PN%" 

 

For more information on the cleartool find, cleartool findmerge or any of the cleartool sub-commands used in this technote, refer to the IBM Rational ClearCase Command Reference, or run cleartool man <sub-command>.


RELATED INFORMATION
#New Merge Type Copy feature with ClearCase version 7 [http://www.ibm.com/support/docview.wss?uid=swg21240740]
Handling binary files in ClearCase [http://www.ibm.com/support/docview.wss?uid=swg21123371]
Trivial merge of a binary file in a ClearCase VOB [http://www.ibm.com/support/docview.wss?uid=swg21122828]
About merging Microsoft Office files in ClearCase [http://www.ibm.com/support/docview.wss?uid=swg21244423]