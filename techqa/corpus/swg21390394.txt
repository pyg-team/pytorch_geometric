Title: IBM Use of the MD5 algorithm in WebSphere MQ SSL certificate management tools (version 7.0 and earlier) - United States

Text:
MD5 sufficiently secure alternative algorithm TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 By default, some of the WebSphere MQ SSL certificate management tools used the MD5 digital signature algorithm when generating certificates and certificate requests. Many users no longer regard MD5 as sufficiently secure and choose to use an alternative algorithm. This technote explains how to do so. 

SYMPTOM
When using iKeycmd (gsk7cmd and runmqckm) tools or the iKeyman GUI equivalents (gsk7ikm and strmqikm) to create self-signed certificates or certificate signing requests, you notice that the MD5 digital signature algorithm has been used.


CAUSE
The MD5 algorithm was the default digital signature algorithm for the iKeyman and iKeycmd certificate management tools in GSKit versions 7.0.4.21 and earlier. When these tools created a self-signed certificate or a certificate signing request, MD5 was used.

GSKit 7.0.4.22 and later versions use SHA-1 as the default digital signature algorithm for the iKeyman and iKeycmd tools. An updated GSKit version was shipped in WebSphere MQ 6.0.2.8 and 7.0.1.0. 

In all GSKit versions, the gskcapicmd tool uses SHA-1 by default. This issue therefore does not apply to gskcapicmd.


DIAGNOSING THE PROBLEM
To determine what GSKit version you currently have installed, run the following commands: 


gsk7ver (on all platforms except HP IA64)
gsk7ver64 (on HP IA64 only)

The command output shows the installed version (FileVersion) as follows:

SYS
============
@(#)CompanyName: IBM Corporation
@(#)LegalTrademarks: IBM
@(#)FileDescription: IBM Global Security Toolkit
@(#)FileVersion: 7.0.4.20
@(#)InternalName: gsksys
@(#)LegalCopyright: Licensed Materials - Property of IBM GSKit
(C) Copyright IBM Corp.1995, 2007
All Rights Reserved. US Government Users
Restricted Rights - Use, duplication or disclosure
restricted by GSA ADP Schedule Contract with IBM Corp.
@(#)OriginalFilename: libgsk7sys.so
@(#)ProductName: gsk7d (GoldCoast Build) 080916
@(#)ProductVersion: 7.0.4.20
@(#)ProductInfo: 08/09/11.02:11:07.08/09/16.16:56:58
@(#)CMVCInfo: gsk7d_080911/gsk7d_doc gsk7d_080911/gsk7d_ssl gsk7d_071122/gsk7d_pkg gsk7d_080911/gsk7d_ikm gsk7d_060620/gsk7d_acme gsk7d_080911/gsk7d_cms gsk7d_080721/gsk7d_support

To determine which digital signature algorithm is used on a particular certificate, use the following command syntax.

gsk7cmd -cert -details -db key.kdb -pw password -label ibmwebspheremqqmgr

Note: 

 * On HP-UX IA64 only, you should run gsk7cmd_64 instead of gsk7cmd. The command syntax is otherwise identical. 
 * On Windows only, you should run runmqckm instead of gsk7cmd. The command syntax is otherwise identical.


If the output shows Signature Algorithm 1.2.840.113549.1.1.4 then this is an MD5-based signature algorithm. 

You can also view the digital signature algorithm in the graphical iKeyman tool. You can start this using the gsk7ikm command. On HP-UX IA64 only, the command is gsk7ikm_64. On Windows only, the command is strmqikm, 

Open the key database in iKeyman, select the certificate to check then click View. A window like the following is displayed, showing the signature algorithm used: 
[/support/docview.wss?uid=swg21390394&amp;aid=1] 
RESOLVING THE PROBLEM
Users of affected GSKit versions can either upgrade to a newer version of GSKit or run the gsk7capicmd tool instead of gsk7cmd. 

 

The gsk7capicmd tool uses SHA-1 by default and has the same command syntax as gsk7cmd. For example, the following command generates a self-signed certificate with a SHA-1 digital signature: 

gsk7capicmd -cert -create -db key.kdb -pw example -label ibmwebspheremqqmgr -dn "CN=Example Queue Manager,OU=Test,O=IBM,C=US" 

 

For more information about gsk7capicmd, refer to the WebSphere MQ documentation. 

Use of a non-MD5 digital signature algorithm on a certificate signing request does not guarantee that the signed personal certificate received from the Certificate Authority will not use MD5. It is for the CA to decide which digital signature algorithm to use when signing a certificate request. The CA plays an important role in the choice of digital signature algorithm for CA-signed certificates and customers who use CA-signed certificates are advised to work with their CA to ensure that appropriate digital signatures are provided.

After a digital certificate has been generated, whether it is self-signed or CA-signed, the digital signature algorithm in the certificate cannot be changed. If you want to change an existing certificate with an MD5 digital signature then you must replace it with a new certificate.

After changing any SSL certificates for WebSphere MQ, bear in mind that the new certificates might not be picked up immediately. Certificate changes take effect as follows:


 * When a new outbound single channel process first runs an SSL channel. 
 * When a new inbound TCP/IP single channel process first receives a request to start an SSL channel. 
 * When the REFRESH SECURITY TYPE(SSL) command is issued to refresh the contents of the SSL key repository. 
 * For client application processes, when the last SSL connection in the process is closed. The next SSL connection picks up the certificate changes. 
 * For channels that run as threads of a process pooling process (amqrmppa), when the process pooling process is started or restarted and first runs an SSL channel. If the process pooling process has already run an SSL channel, and you want the change to become effective immediately, you should issue a REFRESH SECURITY TYPE(SSL) command. 
 * For channels that run as threads of the channel initiator, when the channel initiator is started or restarted and first runs an SSL channel. If the channel initiator process has already run an SSL channel, and you want the change to become effective immediately, you should issue a REFRESH SECURITY TYPE(SSL) command. 
 * For channels that run as threads of a TCP/IP listener, when the listener is started or restarted and first receives a request to start an SSL channel. If the listener process has already run an SSL channel, and you want the change to become effective immediately, you should issue a REFRESH SECURITY TYPE(SSL) command.

 

PRODUCT ALIAS/SYNONYM
 WMQ MQ