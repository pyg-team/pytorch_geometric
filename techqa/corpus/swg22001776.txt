Title: IBM How to create a basic maintenance plan (for Oracle-based Controller databases) to automatically update Oracle statistics and indexes - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Customer is hosting their Controller database using Oracle. Customer would like to maximise performance by ensuring that the Oracle database's statistics and indexes are regularly updated.

How can the customer achieve this automatically? 

SYMPTOM
If regular maintenance is not performed on the Controller database, then the following can occur: 

 * Poor performance, caused by out-of-date database statistics 
 * Poor performance, caused by out-of-date (fragmented) database indexes


CAUSE
There are many different causes for poor performance when using Oracle. 

TIP: For more examples of ideas to improve performance, see separate IBM Technote #1346962. 
This Technote specifically relates to the scenario where the cause is that the customer would like to automate the update/improvement of database statistics and indexes. 

 * In this scenario, there are several different methods to achieve this. 
 * The customer's database administrator (Oracle DBA) should choose whichever method suits their needs best.

ENVIRONMENT
Customer's Controller database hosted on Oracle database server.



RESOLVING THE PROBLEM
Consult your I.T. department's database server administrator (DBA) to ensure that your databases' indexes and statistics are regularly updated. 

 * Your DBA should be experienced in database optimise techniques, and should also be able to tune those techniques to work best in your specific environment.


IBM cannot give official in-depth advice on a third-party (non-IBM) product. All advice given in this IBM Technote is purely basic 'best endeavour' advice.  * For more in-depth advice on third-party (non-IBM) Oracle maintenance routines, see separate third-party articles such as the those from Oracle themselves.


However, as a simple starting point for experienced DBAs (or as an overall guide for inexperienced Oracle administrators) IBM Support recommends that customers create Oracle database maintenance routines (to automatically/regularly perform some tasks in the background) similar to the ones described below. 

#################################################################### 

Oracle 11G and 12C 
Oracle automatic maintenance tasks were introduced (from version 11G) to automate some tasks that Oracle DBAs used to have to do manually in earlier versions.  * Specifically you can automate the updating of statistics


(a) How to check if the statistics are automatically being updated (also known as "collected") 
Launch an Oracle tool (for example SQL Delveoper) and run this script: 
 * select client_name, status, attributes from dba_autotask_client;


By default, the output will be:  * [/support/docview.wss?uid=swg22001776&amp;aid=1]

This shows that the automatic statistics updater is enabled. 

(b) How to check when the statistics will be updated 
Launch an Oracle tool (for example SQL Developer) and run this script: 
 * SELECT * FROM dba_autotask_schedule;


This will give you the full information about the current 'maintenance window' dates/times. 

~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 
To confirm which of those days the statistics are being updated, run this script: 
 * select window_name, autotask_status, optimizer_stats from dba_autotask_window_clients;
 * 
 *  

[/support/docview.wss?uid=swg22001776&aid=2] [/support/docview.wss?uid=swg22001776&aid=2] 
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
(c) How to check the history of past maintenance jobs (to find out when they ran, and if they were successful) run this script: 
 * SELECT client_name, window_name, window_start_time, job_status from DBA_AUTOTASK_JOB_HISTORY ORDER BY window_start_time DESC;


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 

(d) How to schedule the re-indexing of the database (for example, once a week) 

Controller provides an SQL procedure that analysis the schema in the Controller database and gathers the appropriate statistics, which Oracle requires for optimal performance. 

Therefore, you can create an Oracle job (for example called 'Analyze_Controller_Schema_week') to schedule it to run automatically (on a weekly basis).  * The following is a script that achieves this:

 * DECLARE JOB BINARY_INTEGER;
 * 
 * BEGIN
 * 
 * DBMS_SCHEDULER.create_job (
 * 
 * job_name => 'Analyze_Controller_Schema_week',
 * 
 * job_type => 'PLSQL_BLOCK',
 * 
 * job_action => 'BEGIN PRC_ANALYZE_SCHEMA; END;',
 * 
 * start_date => SYSTIMESTAMP,
 * 
 * repeat_interval => 'freq=weekly; byday=sat; byhour=9; byminute=0;
 * 
 * bysecond=0;',
 * 
 * end_date => NULL,
 * 
 * enabled => TRUE,
 * 
 * comments => 'Analyze schema job to be run Saturdays 9:00 AM');
 * 
 * END;


#################################################################### 

Oracle 10G (and older) 
In older versions of Oracle, database maintenance routines were not automatically enabled (by default). Therefore, the general advice is that customers should manually implement the following: 

(a) Update Statistics (daily) 

You could schedule the following to run each night: 
 * 
 * 
 * 
 * 
 * 


For example, if your schemaname was 'fastnet', then the command would be: 
 * begin
 * 
 * dbms_stats.GATHER_SCHEMA_STATS('fastnet');
 * 
 * end;


If you wanted it to run every night at 3am, then the command would be: 
 * DECLARE JOB BINARY_INTEGER;
 * 
 * BEGIN
 * 
 * DBMS_SCHEDULER.create_job (
 * 
 * job_name => 'Update_Controller_statistics_daily',
 * 
 * job_type => 'PLSQL_BLOCK',
 * 
 * job_action => 'BEGIN dbms_stats.GATHER_SCHEMA_STATS('fastnet'); END;',
 * 
 * start_date => SYSTIMESTAMP,
 * 
 * repeat_interval => 'freq=daily; byhour=3; byminute=0;
 * 
 * bysecond=0;',
 * 
 * end_date => NULL,
 * 
 * enabled => TRUE,
 * 
 * comments => 'Update statistics job to be run every morning 3:00 AM');
 * 
 * END;
 * 
 *  


(b) Analyse Schema (for example weekly) 
Controller provides an SQL procedure that analysis the schema in the Controller database and gathers the appropriate statistics, which Oracle requires for optimal performance. 

Therefore, please create an Oracle job (for example called 'Analyze_Controller_Schema_week') to schedule it to run automatically (on a weekly basis). The following is a script that achieves this: 
 * DECLARE JOB BINARY_INTEGER;
 * 
 * BEGIN
 * 
 * DBMS_SCHEDULER.create_job (
 * 
 * job_name => 'Analyze_Controller_Schema_week',
 * 
 * job_type => 'PLSQL_BLOCK',
 * 
 * job_action => 'BEGIN PRC_ANALYZE_SCHEMA; END;',
 * 
 * start_date => SYSTIMESTAMP,
 * 
 * repeat_interval => 'freq=weekly; byday=sat; byhour=9; byminute=0;
 * 
 * bysecond=0;',
 * 
 * end_date => NULL,
 * 
 * enabled => TRUE,
 * 
 * comments => 'Analyze schema job to be run Saturdays 9:00 AM');
 * 
 * END;


======================================================== RELATED INFORMATION
 1346962 - Best Practices (Performance Tuning) for Oracl [http://www.ibm.com/support/docview.wss?uid=swg21346962]