Title: IBM IC81239: JDBC RECONNECTION FAILS AFTER DB OUTAGE, JDBC COMMIT FAILURES DO NOT ROLLBACK NON JDBC RESOURCES - United States

Text:
  A FIX IS AVAILABLE
WebSphere Message Broker V8.0 - Fix Pack 8.0.0.2 [http://www-01.ibm.com/support/docview.wss?uid=swg24034567]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Managed JDBC connections obtained in a JavaCompute fail to
   reconnect to a database server because of an outage on that
   server or a network failure.
   
   When a database outage results in a JDBC commit failure it is
   found that other resources in the same message flow
   transaction are not always being rolled back.
   
   
    
   
   

LOCAL FIX
 *  n/a
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   All users of WebSphere Message Broker V7.0 and higher versions.
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM SUMMARY:
   JDBC client code behaves in vendor specific ways when a database
   server becomes unavailable. WebSphere Message Broker was not
   recognizing some of the return codes and messages from the
   vendors JDBC clients, so it was not resetting broken JDBC
   connections.
   
   The following symptoms may be observed:
   1) If a JavaCompute node is performing an SQL call on a JDBC
   connection, this may cause the node, and even the execution
   group to hang.
   2) The WebSphere Message Broker JDBC connection pools may become
   populated with stale connections, which do not get reset.
   3) If the outage occurs during commit processing, then updates
   to non JDBC resources in the same message flow do not get rolled
   back.
   
   
    
   
   

PROBLEM CONCLUSION
 *  WebSphere Message Broker JDBC connection handling has been
   modified in the following way:
   
   1. The JDBC connection handling recognizes vendor specific SQL
   exceptions, and resets JDBC connections when the database server
   becomes available again.
   2. A fix was also made to JDBC commit processing to report
   failures, which enables roll back of other resources being
   coordinated in the same transaction.
   3. WebSphere Message Broker automatically reconnects to a JDBC
   database server following an outage.
   4. When WebSphere Message Broker discovers stale JDBC
   connections during, or after a database server outage input
   messages will be rolled back, and re-processed.
   
   Note that WebSphere Message Broker manages the
   java.sql.Connection objects that are obtained using the
   JavaComputeNode getJDBCType4Connection() API. The user must
   manage any dependent objects such as java.sql.Statement or
   java.sql.Resultset created using that Connection object.
   
   Consider using java.sqlStatement setQueryTimeout() method to
   reduce the possibility of SQL calls hanging when a database
   server becomes unavailable.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Platform           v7.0
   --------           --------------------
   Multiplatforms     7.0.0.6
   
   Platform           v8.0
   --------           --------------------
   Multiplatforms     8.0.0.2
   
   The latest available maintenance can be obtained from
   'WebSphere Message Broker Recommended Fixes'
   http://www.ibm.com/support/docview.wss?rs=849&uid=swg27006041 [http://www.ibm.com/support/docview.wss?rs=849&uid=swg27006041]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere Message
   Broker Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=849&uid=swg27006308 [http://www-1.ibm.com/support/docview.wss?rs=849&uid=swg27006308]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC81239
   
   
 * REPORTED COMPONENT NAME
   WEB MESSAGE BRO
   
   
 * REPORTED COMPONENT ID
   5724J0510
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2012-02-08
   
   
 * CLOSED DATE
   2012-11-29
   
   
 * LAST MODIFIED DATE
   2012-11-29
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEB MESSAGE BRO
   
   
 * FIXED COMPONENT ID
   5724J0510
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP