Title: IBM Extended Oracle agent, DBA is getting false alert on listener - United States

Text:
5724V09ORTR; rz; SSL TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The TCPS protocol listener is active, but ITCAM Extended agent for Oracle database sends false alert on the listener status.



SYMPTOM
 Agent is reporting correct status for TCP listener, but for TCPS, it is reporting "Inactive" connection status in Listeners view. 

[/support/docview.wss?uid=swg21671988&aid=1] [/support/docview.wss?uid=swg21671988&aid=1]


CAUSE
There is a change in the Extended Oracle monitoring agent design to use sqlnet.ora from its own ITM installation directory. 
The older release of Extended Oracle agent uses sqlnet.ora from Oracle by default. 
This caused sqlnet.log to fill up with error messages returned by Oracle when the agent monitors listeners/NET aliases from tnsnames.ora and some of the aliases are not available. This affects Oracle database when sqlnet.log size became too big. 

Extended Oracle agent (v6.3.1 FP1 and FP2) behavior is as follows:
If TNS_ADMIN is not set by user, Extended Oracle agent sets TNS_ADMIN as agent installation directory and creates self-defined sqlnet.ora here.: 
<install_dir>/logs/<host>_rz_<agent_instance_name>

With the agent self-defined sqlnet.ora, when agent monitors listeners/NET aliases, all Oracle returned detailed error messages are directed to <install_dir>/logs/krzsqlnet.log. This way, agent does not fill up sqlnet.log in Oracle database environment and does not affect Oracle database.


ENVIRONMENT
Extended Oracle agent 6.3.1 FP1 or greater. 
Oracle instance has two listeners enabled, TCP and TCPS, and both need to be monitored. 



DIAGNOSING THE PROBLEM
krzclient log has following errors: 

"Oracle error at ServerAttach during Net Service checking" error code is:28759, error message is: Error while trying to retrieve text for error ORA-28759 




RESOLVING THE PROBLEM
Set TNS_ADMIN variable in Oracle agent instance configuration file to the full path to Oracle TNS admin directory. This will cause the sqlnet.ora for Oracle instance to be used by the agent. The agent finds the settings for SSL configuration and reports the correct TCPS listener status. 

In <ITM_HOME>/config/rz_<agent_instance_name>.config file, set the following: 

TNS_ADMIN=<ORACLE_HOME>/network/admin 

For example in /opt/IBM/ITM/config/rz_ORCL.config, add following: 
TNS_ADMIN=/opt/oracle/product/11.2.0/db/network/admin 


Restart the agent. 
The agent now reports the correct listener status for both TCP and TCPS protocol listeners.