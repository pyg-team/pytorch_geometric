Title: IBM Diagnosing slow logon or logon hangs. - United States

Text:
slow logon PCDINIT CDPRIP PDRDS A-PDS TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 In subarea, APPN or mixed subarea and APPN networks, a logon can sometimes hang or take considerable time for the session to setup. There are VTAM start options that can help reduce some of these problems as well as methods to determine what may be causing these issues. 

CAUSE
The most common problem is on a network search for the DLU. An APPN LOCATE or Subarea CDINIT is sent to another CP or CDRM in the network and a response is not received back. The session can hang waiting on this response which may never come. Some of the more common states the session can show up in are PCDINIT, CDPRIP, PDRDS, A-PDS [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1D2B0/5.2.2].

RESOLVING THE PROBLEM
There are VTAM start options that are provided to help with these types of problems. 

IOPURGE [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B6C0/4.3] is used to purge outstanding CDINITs, Locates, DSRLST and some Route setup hangs. This only purges the outstanding request, which may be enough to allow the search to continue and allow the session to eventually setup successfully. VTAM searching can be a serial search of the ADJSSCP table. If the search hangs on the second CDRM in the ADJSSCP list, IOPURGE will purge the CDINIT to that CDRM when the timer expires. This allows VTAM to continue down the ADJSSCP table. If the DLU is located across one of these other CDRMs, then the session will setup successfully. IOPURGE is generally set to 3 minutes but this is really based on how your particular network performs. IOPURGE can be dynamically modified using the F NET,VTAMOPTS [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0],IOPURGE=xx command. 

MAXLOCAT [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B6C0/4.3] is used to stop sending searches to an APPN CP that is not responding to APPN Locates or is temporarily congested. MAXLOCAT is only applicable if NODETYPE [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B6C0/4.3] is coded. 

 

Identify the last 2 CPs in the locate chain with the following procedures. The last 2 CPs will be the CP where a locate request was sent from and the CP that the request was sent to and that is not responding. The responding CP may or may not have received the request but both CPs should be investigated. Verify that both of these CPs are running normally. Excessive CPU, a hung system, storage problems or other failures could be a reason for the delay or hang of a session setup. Investigate the logs for error messages or use any other tools to determine the health of the CP. 

 

To diagnose a problem of this nature, use the D NET,SRCHINFO [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0] command. Using variations of this command will help determine what CP or CDRM is not responding to a CDINIT or LOCATE request. 

D NET,SRCHINFO by itself, will give you a count of how many searches are outstanding to each adjacent CP or CDRM. This can identify a CDRM or CP in which many searches are getting queued up to. 

 

 1. If you display an LU that is hung and use the SID in the D NET,SRCHINFO,SID=xxxxxxxxxxxxxxxx, the output will include Subarea search information and APPN search information. The IST1537I [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1C6B0/9.0] will tell you what node VTAM is waiting for a reply from. The subarea side will either list a CDRM name or will list ISTAPNCP. If it only contains a CDRM name, then reissue this same display with the same SID on the CDRM that is listed. Continue issuing this display on the VTAM that is listed in the IST1538I [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1C6B0/9.0]. 
    
    You will eventually get to a CDRM where either the SID is unknown or the SRCHINFO does not indicate what CP or CDRM it is waiting on. You can try to inactivate this hung session on both VTAMs by issuing a V NET,TERM [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0],SID=xxxxxxxxxxxxxxxx,TYPE=FORCE,SCOPE=ALL. Many times sessions will continue to hang between these CDRMs. This is only corrected by bouncing the CPCP or CDRM sessions between these 2 VTAMs. If the problem is in the network between VTAMs, then bouncing the CDRM session may not resolve these issues and the resources in the network need to be investigated. At minimum, you will need dumps of VTAM both of VTAMs to diagnose a problem. If it is re-creatable a VTAM trace that includes the CDINIT or LOCATE flows between these 2 nodes would be needed as well. 
    
    Bouncing a CDRM session by inactivating the CDRM minor node with SAVESESS will allow LU to LU sessions to remain active. New LU to LU sessions will not be established until the CDRM to CDRM session is reactivated. 
    V NET,INACT,ID=remote_cdrm_name,SAVESESS,I [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0]
    V NET,ACT,ID=remote_cdrm_name [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0]
    
    
 2. If the D NET,SRCHINFO [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0] indicates the Subarea side is waiting on ISTAPNCP, then the problem is in APPN. ISTAPNCP is the CDRM name for APPN. Continue issuing the D NET,SRCHINFO in the CP identified in the IST1538I message. 
    
    You will eventually get to a CP where either the SID is unknown or the SRCHINFO does not indicate what CP or CDRM it is waiting on. Try inactivating the session with the V TERM for that session ID on both CPs.
    
    Again, bouncing the CPCP session between these 2 nodes may be necessary to correct the problem. If the problem is in the network between VTAMs, then the resources in the network should be investigated. Bouncing the CPCP session may not resolve these issues. 
    
    V NET,INACT,ID=adjacent_cp_name,IDTYPE=CP,TYPE=FORCE [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0]
    V NET,ACT,ID=adjacent_cp_name,IDTYPE=CP [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0]
    
    Bouncing the CPCP session between VTAMs will not impact LU to LU sessions that are already established. These sessions will continue without any impact. New LU to LU sessions will not be able to be established between these 2 VTAMs until the CPCP session is reactivated. 
    
    
 3. If the D NET,SRCHINFO has message IST1533I [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1C6B0/9.0] with Concentrated=yes, then use the SID in the IST1536I to track down the CP that is not responding. VTAM will concentrate new session requests for the same DLU behind a search that is already outstanding for that same DLU. 
    
    
    
 4. In any of these cases, when the 2 CDRMs or CPs are identified in which requests or responses are not flowing between them, use the F NET,CSDUMP [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0] command to get dumps of both CDRMs or CPs while the session is still hung. Also, save the console log so we know what session SID to look for in the dumps. 
    
    If the problem is re-creatable then the trace options can vary depending on the type of connection. A trace that will cover most interfaces would be the following:
    F NET,TRACE [http://publibz.boulder.ibm.com/cgi-bin/bookmgr_OS390/BOOKS/F1A1B7B0/2.0],TYPE=VTAM,MODE=EXT,OPT=(PIU,PSS,SSCP,NRM,MSG,API,APPC,HPR,CIA,CIO,SMS)
    
    You must run this trace on both VTAMs.