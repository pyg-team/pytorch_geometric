Title: IBM Case Manager failed on error message [FNRPE1210001000E]Database error when executing stored procedure from DB Execute step - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 1. Configured the DB alias for DBExecute in Workflow system.
2. Created a stored procedure to insert details in a table.
3. Tested the stored procedure from database and inserting the record
successfully.
4. Configured the DBExecute step in a task workflow with and without
schema name.
5. After launching the task workitem is moving to conductor queue, which means the stored procedure was not executed. 

SYMPTOM
The call we are making to CallableStatement.execute for stored procedure is passed in as "{call p8dbuser.INSERT_APT_DETAILS_TA(?,?,?,?)}". From the exception for the JDBC stack the exception is showing P8DBUSER.INSERT_APT_DETAILS_TA which is not what was passed in. 

It appears to us that the DB2 JDBC code is uppercasing the stored procedure string. 

Caused by: [FNRPE1210001000E]Database error. See chained exception:
Cannot execute statement, msecs=, SQL: "{call p8dbuser.INSERT_APT_DETAILS_TA(?,?,?,?)}"
at filenet.jpe.database.DbDesc.MapDB2Error(DbDesc.java:1290)
at filenet.jpe.database.DbDesc.ConvertError(DbDesc.java:1134)
at filenet.jpe.database.DbCallableStatement.convertError(DbCallableStatement.java:90) 
at filenet.jpe.database.DbStatement.execute(DbStatement.java:149)
at filenet.jpe.definitions.DbSPExecute.evalStoredProcedure(DbSPExecute.java:135)
... 15 more 
Caused by: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-440,SQLSTATE=42884,SQLERRMC=P8DBUSER.INSERT_APT_DETAILS_TA;PROCEDURE
DRIVER=4.19.49 
at com.ibm.db2.jcc.am.kd.a(Unknown Source)
at com.ibm.db2.jcc.am.kd.a(Unknown Source)
at com.ibm.db2.jcc.am.kd.a(Unknown Source)
at com.ibm.db2.jcc.am.fp.c(Unknown Source)
at com.ibm.db2.jcc.am.fp.d(Unknown Source)
at com.ibm.db2.jcc.am.fp.a(Unknown Source)
at com.ibm.db2.jcc.am.gp.a(Unknown Source)
at com.ibm.db2.jcc.t4.bb.h(Unknown Source)
at com.ibm.db2.jcc.t4.bb.e(Unknown Source) 
at com.ibm.db2.jcc.t4.p.d(Unknown Source)
at com.ibm.db2.jcc.t4.vb.l(Unknown Source)
at com.ibm.db2.jcc.am.fp.lb(Unknown Source)
at com.ibm.db2.jcc.am.gp.zc(Unknown Source)
at com.ibm.db2.jcc.am.gp.b(Unknown Source)
at com.ibm.db2.jcc.am.CallableStatement.nc(Unknown Source)
at com.ibm.db2.jcc.am.CallableStatement.execute(Unknown Source)
at filenet.jpe.database.DbStatement.execute(DbStatement.java:103)
... 16 more


CAUSE

1.Test from terminal.
(1)
db2 "call \"p8dbuser\".INSERT_APT_DETAILS_TA('aaa', 'bbb’)” : OK
(2)
db2 "call "p8dbuser".INSERT_APT_DETAILS_TA('aaa', 'bbb')” : 0440 Error
(3)
db2 "call p8dbuser.INSERT_APT_DETAILS_TA('aaa', 'bbb’)” : 0440 Error

SQL0440N No authorized routine named “P8DBUSER.INSERT_APT_DETAILS_TA”

2.Test by simple java application
=> Basically same as calling from terminal.

(1) Case 1. "call p8dbuser.INSERT_APT_DETAILS_TA ~~

=> getting the same error (X)
com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error:
SQLCODE=-440, SQLSTATE=42884,
SQLERRMC=P8DBUSER.INSERT_APT_DETAILS_TA;PROCEDURE

(2) Case 2.Calling by checking case sensitivity strictly.
"call \"p8dbuser\”.INSERT_APT_DETAILS_TA ~~
=> No error(O).


DIAGNOSING THE PROBLEM
When we send the stored procedure to DB2 database, our code didn't check the case sensitivity. Even customer use the correct lower case schema name in their stored procedure, and the real schema name is lower case, there will be error because the upper case schema name will be transferred to DB2 side.



RESOLVING THE PROBLEM
Option a: create a new schema, and the schema name should be in upper case. And use the new upper case schema name in the stored procedure. Stop to use the old lower case schema name. 

 

Option b. create a new DB2 account, and use the existing lower case schema name as default schema. Details as following: 


1. create a new user to run that stored procedure. 
2. configure that user to have p8dbuser as its default schema. 
3. configure the dbexecute connection to use that new user to call that stored procedure. 
4. configure the dbexecute call to call INSERT_APT_DETAILS_TA that is, don't try to call p8dbuser.INSERT_APT_DETAILS_TA.