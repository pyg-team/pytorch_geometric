Title: IBM Why does the stored procedures for WDI 3.3 on z/OS give me a  SQLCODE = -991 SQLSTATE 57015 RC1=0008 RC2=00F30049 - United States

Text:
WDI; 3.3; z/OS; stored; procedures; storedprocedures; db2; grant; execute; 15925300; RC2=00F30034; RC1=0008; RC2=00F30049 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 User receives SQLCODE -991 with an SQLSTATE 57015 RC1=0008 RC2=00F30049, when attempting to execute the stored procedures for WDI 3.3 on z/OS. This is due to an additional CAFcall being made after the original error in WDI 3.3. 

SYMPTOM
The user receives the SQLCODE -991 with an SQLSTATE 57015 when attempting to execute the stored procedures for WDI 3.3 on z/OS. 

DSNT408I SQLCODE = -991, ERROR: CALL ATTACH WAS UNABLE TO ESTABLISH AN IMPLICIT CONNECT OR OPEN TO DB2. RC1=0008 RC2=00F30049 DSNT418I SQLSTATE = 57015 SQLSTATE RETURN CODE DSNT415I SQLERRP = DSNACA00 SQL PROCEDURE DETECTING ERROR DSNT416I SQLERRD = 0 0 0 -1 0 0 SQL DIAGNOSTIC INFORMATION DSNT416I SQLERRD = X'00000000' X'00000000' X'00000000' X'FFFFFFFF' X'00000000' X'00000000' SQL DIAGNOSTIC INFORMATION


CAUSE
WDI is attempting another CAF call after the original error, which is masking the true reason for the error.


DIAGNOSING THE PROBLEM
Trace the WDI Client remote submissions on z/OS by making a directory "/tmp/edidproc". This triggers WDI to write trace files to this directory. Note: The wlm_userid requires write permission to this directory. Then recreate the problem. Example of the trace produced: 


PERFORM REMOVE TRANSACTIONS WHERE THANDF(THAND);)

ediproc(1388): runAsyncScript() wrote:(;
term;)
ediproc(1391): runAsyncScript() block:0

ediproc(753): entering startSession()

ediproc(805): sqlcode: 0
ediproc(1449) pre spawn uid: wlm_userid
env: _BPXK_JOBLOG=STDERR
env: PATH=/bin
env: EDITSIN=PLAN(EDIENU33) SYSTEM(DB2T) CAF(8) 00000100

ediproc(1471) spawn pid:16778092/820017432
ediproc(1482) waiting for:16778092
DB2 Connect Error Code : 8 8 15925300
PLAN : (EDIENU33)
DBID : (DB2T)
CAF : (8)
DI Translator Started, build date: Dec 19 2006
Error 24
Error 24
concatenating: @30D2B178 ( REMOVE TRANSACTIONS WHERE THA)
+ DSNT408I SQLCODE = -991, ERROR: CALL ATTACH WAS UNABLE TO ESTABLISH A
+N IMPLICIT CONNECT OR OPEN TO DB2. RC1=0008 RC2=00F30049 DSNT418I SQLS
+TATE = 57015 SQLSTATE RETURN CODE DSNT415I SQLERRP = DSNACA00 SQL PROC
+EDURE DETECTING ERROR DSNT416I SQLERRD = 0 0 0 -1 0 0 SQL DIAGNOSTIC I
+NFORMATION DSNT416I SQLERRD = X'00000000' X'00000000' X'00000000' X'FF
+FFFFFF' X'00000000' X'00000000' SQL DIAGNOSTIC INFORMATION
DI Translator Error. RC=8, ERC=32
Syntax error: ;
DI Translator shutdown
ediproc(1497) runAsyncScript() exit. errno/rc 0/8
ediproc(1884): after runAsyncScript() 8
edidproc(1978):returning session: 111 rc: 8 


RESOLVING THE PROBLEM
Within the trace, you will see entry: 

DB2 Connect Error Code : 8 8 15925300 

Converting decimal 15925300 into hex yields: 00F30034 

According to the DB2 Knowledge Center: http://www.ibm.com/support/knowledgecenter/SSEPEK_12.0.0/codes/src/tpc/00f30034.html [http://www.ibm.com/support/knowledgecenter/SSEPEK_12.0.0/codes/src/tpc/00f30034.html] 
This is a plan authorization problem. The userid as identified in the trace: ediproc(1449) pre spawn uid: wlm_userid 

Have your DB2 admin ensure the userid is authorized to execute the DB2 plan. If not, issue a GRANT EXECUTE on the PLAN for the userid, e.g. 

"GRANT EXECUTE ON PLAN EDIENU33 TO wlm_userid"