Title: IBM FIFO functionality deadlocks when any ActiveMQ queue reaches flow control capacity - United States

Text:
Extensions; Adapters; Performance; STERLINGNFX TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 FIFO functionality deadlocks when any ActiveMQ queue reaches flow control capacity 

SYMPTOM


MSMQ FIFO functionality



When any ActiveMQ queue in the system reaches flow control capacity, the response queues are unable to send messages. This results in a deadlock in the FIFO code. 

This behavior only exists when using JMS transactions.


RESOLVING THE PROBLEM


First, we are introducing a flow control mechanic that will set a maximum number of messages that can be present on the FIFO queues at any one time.

Second, we will be removing the WorkFlowContext and associated documents from storage on ActiveMQ. This serves two purposes. First, it will constitute an overall reduction in the amount of memory on the ActiveMQ queues regardless of the size of document and process data. ActiveMQ controls flow via memory usage and as a result, this is an important part of avoiding issues on the ActiveMQ side. Second, this once again makes the database the primary storage for the workflow and process data and makes ActiveMQ only important in execution but removes it as a factor in terms of data loss.

In order to accomplish this, an enhancement must be made to the Recovery state filter service to disallow the recovery of in-process FIFO messages.

Third, the JMS sessions and producers are being separated out by function to allow sessions to independently be transactional and/or persist ant. Out of the box, the following will be the session assignments:

Tasks ( i/e BPs ): transactional, persistent
Responses: ( notification of a BP completion ): Non-transactional, persistent
Flow Control: Non-transactional, persistent ( considered setting non-persistent, but not enough testing)

In addition, all consumers that are waiting on a message will now periodically close the consumer and re-open it as this solves one of the persistent issues we have been having where messages are available on the queue, but un-readable.

Please apply Gentran Integration Suite, Release 4.3 Build 4315 or later.



 

Cross reference information Segment Product Component Platform Version Edition Commerce Sterling B2B Integrator Adapters 
HISTORICAL NUMBER
 NFX4623 

PRODUCT ALIAS/SYNONYM
 

Function Area


Platform


Escalation ID


QC


Fix ID


168870


Severity


Normal


Type


NormalFix


Build


4315