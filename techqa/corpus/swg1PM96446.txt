Title: IBM PM96446: SQLSYNTAXERROREXCEPTION IS THROWN WHEN ENABLESEAMLESSFAILOVER PROPERTY SET TO 1 FOR THE DATASOURCE - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  After migrating DB2 on Z/OS to DB2 UDB and WebSphere
   Application Server to v7.0.x when the application server
   is restarted the following errors occured:
   
   J2CA0027E: An exception occurred while invoking prepare on
   an XA Resource Adapter from DataSource jms/XXX, within
   transaction ID {XidImpl: formatId(57415344), gtrid_length
   (36), bqual_length(54),data(00000140caea90c1000000010003cab2
   bb5483f46743a3000154ce05ae9bebd741c606fe00000140caea90c10000
   00010003cab2bb5483f46743a3000154ce05ae9bebd741c606fe00000001
   0000000000000000000000000002)} : javax.transaction.xa.
   XAException: CWSIC8007E: An exception was caught from the
   remote server with Probe Id 3-013-0010. Exception: .
    at com.ibm.ws.sib.comms.common.CommsByteBuffer.parseSingle
    Exception(CommsByteBuffer.java:1753)
    at com.ibm.ws.sib.comms.common.CommsByteBuffer.getException
    (CommsByteBuffer.java:1263)
    at com.ibm.ws.sib.comms.common.CommsByteBuffer.checkXA
    CommandCompletionStatus(CommsByteBuffer.java:1218)
    at com.ibm.ws.sib.comms.client.OptimizedSIXAResourceProxy.
    prepare(OptimizedSIXAResourceProxy.java:749)
    at com.ibm.ws.sib.comms.client.SuspendableXAResource.
    prepare(SuspendableXAResource.java:386)
    at com.ibm.ws.sib.api.jmsra.impl.JmsJcaRecoverableSiXa
    Resource.prepare(JmsJcaRecoverableSiXaResource.java:260)
    at com.ibm.ejs.j2c.XATransactionWrapper.prepare(XA
    TransactionWrapper.java:1136)
    at com.ibm.tx.jta.JTAXAResourceImpl.prepare(JTAXA
    ResourceImpl.java:226)
    at com.ibm.tx.jta.RegisteredResources.prepareResource
    (RegisteredResources.java:1159)
    at com.ibm.tx.jta.RegisteredResources.distributePrepare
    (RegisteredResources.java:1415)
    at com.ibm.tx.jta.TransactionImpl.prepareResources
    (TransactionImpl.java:1446)
    at com.ibm.ws.tx.jta.TransactionImpl.stage1Commit
    Processing(TransactionImpl.java:557)
    at com.ibm.tx.jta.TransactionImpl.processCommit(Transaction
    Impl.java:986)
    at com.ibm.tx.jta.TransactionImpl.commit(TransactionImpl.
    java:920)
    at com.ibm.ws.tx.jta.TranManagerImpl.commit(TranManager
    Impl.java:436)
    at com.ibm.tx.jta.TranManagerSet.commit(TranManagerSet.
    java:161)
    at com.ibm.ws.tx.jta.UserTransactionImpl.commit(User
    TransactionImpl.java:293)
    at com.ibm.ejs.container.UserTransactionWrapper.commit
    (UserTransactionWrapper.java:305)
    .......
   Caused by: com.ibm.websphere.sib.exception.SIErrorException:
   CWSIC8002E: An internal error occurred. An unknown or
   unexpected exception was thrown by the core API: exception
   com.ibm.ws.sib.msgstore.RollbackException: CWSIS1002E: An
   unexpected exception was caught during transaction completion.
   Exception: com.ibm.ws.sib.msgstore.PersistenceException:
   CWSIS1501E: The data source has produced an unexpected
   exception:
   com.ibm.db2.jcc.am.SqlSyntaxErrorException: [jcc][10172]
   [10415][3.62.56] The InputStream object does not contain
   10688 characters. ERRORCODE=-4461, SQLSTATE=42815.
    at com.ibm.ws.sib.comms.common.CommsByteBuffer.
    parseSingleException(CommsByteBuffer.java:1884)
    ... 40 more
   Caused by: com.ibm.websphere.sib.exception.SIErrorException:
   CWSIC8002E: An internal error occurred. An unknown or
   unexpected exception was thrown by the core API: exception
   com.ibm.ws.sib.msgstore.PersistenceException: CWSIS1501E:
   The data source has produced an unexpected exception:
   com.ibm.db2.jcc.am.SqlSyntaxErrorException: [jcc][10172]
   [10415][3.62.56] The InputStream object does not contain
   10688 characters. ERRORCODE=-4461, SQLSTATE=42815.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  Users of the default messaging provider     *
   *                  for IBM WebSphere Application Server V7.0   *
   ****************************************************************
   * PROBLEM DESCRIPTION: In a WebSphere Application Server       *
   *                      using Service Integration Bus, when     *
   *                      the database property,                  *
   *                      enableSeamlessFailover, is set to 1,    *
   *                      SqlSyntaxErrorException is thrown by    *
   *                      setBinaryStream method while reading    *
   *                      the Input stream to determine the       *
   *                      length.                                 *
   *                      com.ibm.db2.jcc.am.SqlSyntaxErrorExcept *
   *                      ion: [jcc][10172][10415][3.62.56] The   *
   *                      InputStream object does not contain     *
   *                      10688 characters. ERRORCODE=-4461,      *
   *                      SQLSTATE=42815.                         *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   enableSeamlessFailover is a database property which when set
   attempts to retry the connection on the new database server
   during failover without informing the application. When the
   enableSeamlessfailover option is set, the DB2 jdbc driver
   calls the read() on the input stream without any parameters.
   This reads the data byte by byte from the stream and once
   finished, the data would be persisted in the data store.
   Currently the implementation of read() function without
   parameters is not implemented and it just returns -1 which
   indicates the end of stream.
   Since there is a mismatch between the length passed and the
   byte data read from the input stream using read(), it throws
   the following exception -
   ----------------------------------------------------------------
   com.ibm.db2.jcc.am.SqlSyntaxErrorException:
   [jcc][10172][10415][3.62.56] The InputStream object does not
   contain 10688 characters.
   ERRORCODE=-4461, SQLSTATE=42815.
   at
   com.ibm.ws.sib.comms.common.CommsByteBuffer.parseSingleException
   (CommsByteBuffer.java:1884)
   ... 40 more
   Caused by: com.ibm.websphere.sib.exception.SIErrorException:
   CWSIC8002E: An internal error occurred. An unknown or
   unexpected exception was thrown by the core API: exception
   com.ibm.ws.sib.msgstore PersistenceException: CWSIS1501E: The
   data source has produced an unexpected exception:
   com.ibm.db2.jcc.am.SqlSyntaxErrorException:
   [jcc][10172][10415][3.62.56] The InputStream object does not
   contain 10688 characters. ERRORCODE=-4461, SQLSTATE=42815.
   ----------------------------------------------------------------
   
   
    
   
   

PROBLEM CONCLUSION
 *  The solution involves implementing the read function in the
   DataSliceInputStream.java to read the byte by byte data and
   return the correct length of the input stream.
   
   The fix for this APAR is currently targeted for inclusion in
   fix pack 7.0.0.33.  Please refer to the Recommended Updates
   page for delivery information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM96446
   
   
 * REPORTED COMPONENT NAME
   WAS SIB & SIBWS
   
   
 * REPORTED COMPONENT ID
   620800101
   
   
 * REPORTED RELEASE
   300
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-09-05
   
   
 * CLOSED DATE
   2013-11-22
   
   
 * LAST MODIFIED DATE
   2013-11-22
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WAS SIB & SIBWS
   
   
 * FIXED COMPONENT ID
   620800101
   
   

APPLICABLE COMPONENT LEVELS
 * R300 PSY
   UP