Title: IBM JR47810: DIRECT PATH REFRESH FAILS IF TABLE HAS A DESCENDING INDEX AND PARALLEL REFRESH IS USED - United States

Text:
  A FIX IS AVAILABLE
Fix list for IBM InfoSphere Change Data Capture [http://www-01.ibm.com/support/docview.wss?uid=swg24029318]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  CDC for Oracle refresh uses Oracle direct path refresh whenever
   possible. In CDC, this is called 'fastload". To be able to use
   direct path load efficiently, we drop all indexes prior to
   doing the refresh and then we recreate them afterwards. For
   parallel refresh, the direct path loader does not allow indexes
   to exist. So for parallel refresh, dropping the indexes is not
   just a performance optimization - it is required. The customer
   has a table which is failing parallel refresh with an error
   that indexes exist, even though we did drop all the indexes we
   thought existed. This succeeds for non-parallel refresh because
   dropping the indexes is not required. All their other tables
   succeed in refreshing in parallel, so why did this one table
   fail? Why did we not drop all the indexes on this table?
   
   The reason:
   For some reason, the code to drop the indexes will only drop
   those whose type is "NORMAL". NORMAL is only 1 of 8 types of
   Oracle indexes. The full list of types is:
   
   NORMAL
   FUNCTION-BASED NORMAL
   BITMAP
   FUNCTION-BASED BITMAP
   IDT-TOP
   DOMAIN
   LOB
   CLUSTER
   
   If the index has at least one column that is marked as DESC
   (descending) instead of the default of ASC ((ascending), then
   the Oracle sets the type to "FUNCTION-BASED NORMAL" instead of
   NORMAL. Because we only drop indexes whose type are NORMAL, we
   will not drop any descending indexes. The immediate fix for the
   customer problem is to drop indexes which have a type of NORMAL
   or FUNCTION-BASED NORMAL. But why not drop ALL indexes,
   regardless of type? Parallel refresh will fail if any index
   exists, regardless of the type. For non-parallel refresh , I
   doubt it is less expensive to maintain a bitmapped index, for
   example, then to drop and recreate it. "IDT-TOP" is the primary
   key for an index organized table, which is the table itself.
   You cannot drop the primary key of an index organized table, so
   we would not want to drop an index of type IOT-TOP. But we
   shouldn't even be using direct path load to refresh an IOT,
   because it is not allowed by Oracle unless the table is
   partitioned, and even if it is partitioned it is of
   questionable performance benefit!
   
   
    
   
   

LOCAL FIX
 *  Disable parallel refresh, or drop any indexes with descending
   columns.
   
   
    
   
   

PROBLEM SUMMARY
 *  IIDR 10.2 for Oracle fails to refresh with direct path errors.
   This occurs if the table has at least one index with at least
   one descending column and parallel refresh is enabled.
   
   This issue affects users running IIDR 10.2 Interim Fix 9 for
   Oracle Redo (and below).
   
   
    
   
   

PROBLEM CONCLUSION
 *  This issues is fixed by applying IIDR 10.2 Interim Fix 10 for
   Oracle Redo.
   
   
    
   
   

TEMPORARY FIX
 *  Disable parallel refresh or drop the index with descending
   columns.
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   JR47810
   
   
 * REPORTED COMPONENT NAME
   IS CDC ORACLE
   
   
 * REPORTED COMPONENT ID
   5725E30OR
   
   
 * REPORTED RELEASE
   A20
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-09-16
   
   
 * CLOSED DATE
   2013-10-31
   
   
 * LAST MODIFIED DATE
   2013-10-31
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IS CDC ORACLE
   
   
 * FIXED COMPONENT ID
   5725E30OR
   
   

APPLICABLE COMPONENT LEVELS
 * RA20 PSY
   UP