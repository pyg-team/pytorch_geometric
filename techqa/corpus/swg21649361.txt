Title: IBM FileNet Image Services Courier Timeout Enhancement - United States

Text:
cormon; server stubs; hang; COR_set_recv_timeout TECHNOTE (FAQ)

QUESTION
 Is there a way to break down a courier connection from a client that is not responding to the Image Services server? 

CAUSE
The client station is not responding to a request from the Image Services server leaving the server stub in RCVMSG mode as shown in cormon due to a client application or network issue.

ANSWER
A new Courier Timeout enhancement has been added to Image Services software in releases 4.1.2.18 and 4.2.0.0. 

This new courier enhancement provides a timeout feature that enables the user to gracefully break down any courier connection (for any given stub type, such as CSMs, DOCs, INXs, etc.) based on a user configured value. The enhancement makes the Osar server more resilient to connectivity and application issues by not allowing CSMs server stub connections to remain in a RECEIVE state waiting for data over the network for an extended period of time. 

The timeout period can be set as a static number in the /fnsw/etc/serverConfig file or dynamically through the new utility named "COR_set_recv_timeout". An entry in the IS elog will be added when the timeout value is set and when the timeout has been triggered. The "IS Elog Examples of Timeouts" section below contains elog samples. 

Set Timeout as a static number that remains persistent between IS recycles 

 * 
 * 
 * /fnsw/etc/serverConfig 
 * 
 * If no number exists in the seventh column the timeout feature is set to off and the original code base will be used. 
 * Here is an example of setting the timeout value to 90 seconds for CSMs and BESs stub in the serverConfig file:
   
 * NCHs 02 2 24 1 0 
   CSMs0134231040 1 24 1 0 90 
   DOCs 0134231041 1 24 1 0 
   INXs 0134231042 1 24 1 0 
   PRIs 0134231043 1 24 1 0 
   BESs0134231044 1 16 1 0 90 
 * 
 * 
 * COR_set_recv_timeout
 * 


New Tool to Dynamically Set the Timeout  * 
 * 
 * COR_set_recv_timeout 
 * 


Usage: 
COR_set_recv_timeout [Server Stub][timeout in seconds]  

Usage Options with Examples:

0 Turns off the timeout feature. 

 *   *   * 
       * 
       * 
       * 
       * 
      
      
   
   


timeout in seconds Sets the threshold timeout value 
Example of setting the timeout to 120 seconds.  *   *   * 
       * 
       * 
      
      
   
   


no parameters Displays the current threshold timeout  *   *   * 
      
      
   
   

A value of zero means there is no timeout. 
Example that shows the timeout is set to 120 seconds for CSMs 
 *   *   * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
       * 
      
      
   
   


-h Displays tool usage 
Example of -h.  *   *   * 
       * 
       * 
      
      
   
   


Non-Integer If run with any parameter other than an integer, it displays a usage message: 
 *   *   * 
       * 
       * 
      
      
   
   



IS Elog Examples of Timeouts 

Example of setting the timeout to 60 seconds using the COR_set_recv_timeout utility 
 * 
 * 
 * 
 * 
 * 


Example of a Timeout due to the Client Application not closing the connection 
 * 
 * 
 * 


Example of timeout due to communication error 
 * 
 * 
 * 



Files Included 
 * 
 * 
 * 
 * 
 * 



How to Determine if a Connection is Waiting on a Client 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * ftp://public.dhe.ibm.com/software/data/cm/filenet/docs/isdoc/412x/Systools.pdf


Example: 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * RCVMSG X 450776 0 CSMs 615 eisuserid@10.1.171.137 [1946] 
 * 
 * 
 * 



What causes a server stub to remain in a RCVMSG state for an extended period? 
 * 


Application Examples  *  The client application is waiting for a user response before sending a close. The client application has a bug that does not always send a close. The client application received a error prior to closing the connection and the connection was not closed during its error handling. The client application aborted before closing the connection. 


Network Examples  *  The client application did not received the data from the server for any reason. The client application send a close but, was not received by the server for any reason such as, the packet was dropped. 


Common CSMs RPC Example 

The eladisp sample below shows typical series of RPCs that will open a CSM connection, place it into RCVMSG state and then close it. 
 *  A CSMs stub would be opened on the CSM:OpenCsumObject call. The CSMs state would be put into a RCVMSG when the IS server sends data back to the client over the network as a reply to the RPC request. The CSMs connection would be closed and removed from the cormon output when the CSM:CloseObject is received from the client. 




eladisp sample of a typical CSMs call 

$514 CSM:OpenCsumObject 12:54:31.150 0.00 Secs 0.00 KB 
NETID = [1add9e55,000000000000,0000] 
------------------------------------------------------- 
$842 CSM:ReadObject 12:54:33.850 0.00 Secs 65.54 KB 
NETID = [1add9e55,000000000000,0000] 
------------------------------------------------------- 
$843 CSM:ReadObject 12:54:33.850 0.00 Secs 22.77 KB 
NETID = [1add9e55,000000000000,0000] 
------------------------------------------------------- 
$844 CSM:CloseObject 12:54:33.850 0.00 Secs 0.00 KB 
NETID = [1add9e55,000000000000,0000]