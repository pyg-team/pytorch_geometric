Title: IBM IZ83475: BROWSE-WITH-MARK MESSAGES ARE SEEN IN APPLICATION SERVER        SYSTEMERR.LOG OR SYSTEMOUT.LOG FILE - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0 Fix Pack 7.0.1.5 [http://www-01.ibm.com/support/docview.wss?uid=swg24029055]
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.5 [http://www-01.ibm.com/support/docview.wss?uid=swg24029788]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Multiple Message Listener Ports or Activation Specifications are
   configured within an application server to read messages from
   the same WebSphere MQ v7 queue.
   
   The following message is seen in the application server's log
   files:
   
   [1/01/10 01:00:00:000 EDT] 00000038 SystemErr     R 1/01/2010
   01:00:00 [MessageListenerThreadPool : 0]
   com.ibm.msg.client.jms.internal.JmsQueueSessionImpl
   WebSphere classes for JMS attempted to get a message for
   delivery to an message listener, that had previously been marked
   using browse-with-mark, but the message was not there.
   
   EXPLANATION:
   The connection browser marks messages using browse-with-mark and
   assigns them to sessions for subsequent delivery to message
   listeners. When a session attempted to get such a message, the
   message had already been got. This might be because the mark on
   the message had expired, allowing another session to get the
   message. When running in an application server, marks can expire
   if the server is too heavily loaded or the expiration time is
   too short.
   
   ACTION:
   Increase the mark expiry time or reduce the workload on the
   application server.
   
   No apparent change of behaviour of the application server MDB
   processing is observed, messages continue to be consumed and
   processed as normal.
   
   
    
   
   

LOCAL FIX
 *  Ignore error until issue is resolved.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects users of application servers which are using
   the WebSphere MQ classes for Java Message Service (JMS) v7
   connected to a WebSphere MQ v7 queue manager, where multiple
   activation specifications (or Listener Ports in the case of
   WebSphere Application Server) are configured to get messages
   from the same queue.
   
   Platforms affected:
   All Distributed (iSeries, all Unix and Windows) +Java
   ****************************************************************
   PROBLEM SUMMARY:
   When using an activation specification (or Listener Port within
   WebSphere Application Server) connected to a WebSphere MQ v7
   queue using the WebSphere MQ classes for JMS v7 client, in the
   default configuration a message browser thread is used to look
   for Message Driven Bean (MDB) suitable messages on the queue.
   
   If a message if found, the client makes use of the new WebSphere
   MQ v7 distributed functionality to put a marker on the message,
   which indicates to other message browser threads that this
   message is about to be consumed by an MDB.
   
   These message marks expire after a period of time, defined by
   the queue manager property, 'MARKINT', which defaults to 5000ms
   (5 seconds).  After this time, if the message is still on the
   queue the browse mark is removed, and other message browse
   threads can mark the message for their own MDB server sessions.
   
   If the original browse thread MDB's server session takes longer
   than 5 seconds from the point of marking to retrieving the
   message, a window of opportunity exists for another message
   browser's MDB to get the message.  When this occurs and the
   first MDB eventually attempts to get the message, it finds the
   message is no longer on the queue and issues the following
   message:
   
   WebSphere Application Server v6, in the SystemErr.log :
   ----------------------------------------------------------------
   WebSphere classes for JMS attempted to get a message for
   delivery to an message listener, that had previously been marked
   using browse-with-mark, but the message was not there.
   
   EXPLANATION:
   The connection browser marks messages using browse-with-mark and
   assigns them to sessions for subsequent delivery to message
   listeners. When a session attempted to get such a message, the
   message had already been got. This might be because the mark on
   the message had expired, allowing another session to get the
   message. When running in an application server, marks can expire
   if the server is too heavily loaded or the expiration time is
   too short.
   
   ACTION:
   Increase the mark expiry time or reduce the workload on the
   application server.
   ----------------------------------------------------------------
   
   
   WebSphere Application Server v7, in the SystemOut.log :
   ----------------------------------------------------------------
   [1/01/10 01:00:00:000 EDT] 0000005f SibMessage    W   [:]
   CWSJY0003W: WebSphere classes for JMS attempted to get a message
   for delivery to an message listener, that had previously been
   marked using browse-with-mark, but the message was not there.
   ----------------------------------------------------------------
   
   
   This message is only displayed once for each JMS Session
   associated with the server session.  It is not intended to
   indicate that a fault has occurred.
   
   The typical configuration which triggers the message is where
   multiple application servers are driving MDBs off the same
   queue, where the MDB processing takes some time to occur, eg.
   greater 5 seconds.
   
   
    
   
   

PROBLEM CONCLUSION
 *  If this message is seen, and the system administrator is
   confident that message processing is occurring in an acceptable
   timely fashion, then the message can be ignored.
   
   Alternatively, the 'MARKINT' property on the queue manager can
   be increased.  Using a value which is greater than the maximum
   length of time an MDB takes to process a message will result in
   the message not being seen.
   The negative side of increasing this value is that it may take
   longer for a message to be processed by an MDB.  If a problem
   with an MDB processing occurs (for example if a connection to a
   database is lost and the MDB waits for the connection to be
   re-established), then that server session will not be available
   to process further messages.  However, a second application
   server's MDB may have spare resource to process this message.
   It must wait the length of time indicated by the 'MARKINT'
   property until the second application server's MDB is driven.
   
   Finally, a code change associated with this APAR provides a
   property which can be set in the Java Virtual Machine (JVM)
   which disables the displaying of the message.
   
   This property is:
   
     com.ibm.msg.client.wmq.suppressBrowseMarkMessageWarning
   
   If its value is set to 'true', the message will not be
   displayed.  For example, to set the variable in WebSphere
   Application Server, open the Administration Console and
   navigate to:
   
   Servers -> Application Servers -> <select server> ->
              Java and Process Management -> Process Definition ->
              Java Virtual Machine -> Custom Properties -> New
   
    Name = com.ibm.msg.client.wmq.suppressBrowseMarkMessageWarning
    Value = true
   
   Restart the application server, and the message will no longer
   be displayed.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v7.0
   Platform           Fix Pack 7.0.1.5
   --------           --------------------
   Windows            U200324
   AIX                U839183
   HP-UX (PA-RISC)    U839621
   HP-UX (Itanium)    U839626
   Solaris (SPARC)    U839622
   Solaris (x86-64)   U839628
   iSeries            tbc_p700_0_1_5
   Linux (x86)        U839623
   Linux (x86-64)     U839627
   Linux (zSeries)    U839624
   Linux (Power)      U839625
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ83475
   
   
 * REPORTED COMPONENT NAME
   WMQ LIN X86 V7
   
   
 * REPORTED COMPONENT ID
   5724H7224
   
   
 * REPORTED RELEASE
   701
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-08-24
   
   
 * CLOSED DATE
   2010-09-30
   
   
 * LAST MODIFIED DATE
   2010-11-25
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ LIN X86 V7
   
   
 * FIXED COMPONENT ID
   5724H7224
   
   

APPLICABLE COMPONENT LEVELS
 * R701 PSY
   UP