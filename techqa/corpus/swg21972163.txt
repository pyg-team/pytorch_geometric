Title: IBM Security Network Protection (XGS) is in Offline status but events are seen in the SiteProtector Console - United States

Text:
XGS; AM TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Security Network Protection (XGS) is in Offline status due to Agent Manager persistent connection setting being enabled 

SYMPTOM
XGS is in Offline status but new events can be seen in the SiteProtector Console.


CAUSE
Persistent connection is enabled by default or user configured after registering the XGS to SiteProtector Server.

DIAGNOSING THE PROBLEM
There were several fixes that were tried before disabling the XGS persistent connection which did not resolve the issue in this case. : 

 1. Re-registering the XGS to Site Protector.
    
    
 2. Changing the Agent Manager heartbeat size or communication timeout settings (as per Technote 1667549: Sensors unable to successfully heartbeat to SiteProtector due to policy size [http://www.ibm.com/support/docview.wss?uid=swg21667549]).
    
    
 3. Restarting the SiteProtector Application Server services.
    
    
 4. Refreshing the XGS or stopping and starting the Agent Manager.
    
    
 5. Port M.1 was configured as 100H, changed port settings to 100F or 1000F.
    
    

Reviewing the Agent Manager rsspdc.log the following errors are present: 

EX::Wed, 28 Oct 2015 12:45:57: 0x000009c4, ERROR: Failure communicating with server. CURL code: 7 Message: Could not Perform request to server: https://127.0.0.1:8443/siteprotector/cml/repositoryError Code: 0xc74900b7
EX::Wed, 28 Oct 2015 12:45:57: 0x000009c4, ERROR: amSchemaRetrievalPollJob::getLatest() - could not get latest package. 

and 

VB::Wed, 04 Nov 2015 20:52:22: 0x00001510, Schema Retrieval server: hostname.Itauchile.cl port: 3994 user:
[...]
VB::Wed, 04 Nov 2015 20:52:22: 0x00001510, _HelperInternalRequest server: hostname.Itauchile.cl port: 3994 resource: /siteprotector/cml/repository

Attempting to connect to various Application Server services: (debug log; rsspdc.log) 
EX::Wed, 04 Nov 2015 15:05:11: 0x000009d8, ERROR: amGenericProxy::proxyRequest() - request to server failed. HTTP CODE: 404Error Code: 0xc74900b9
EX::Wed, 04 Nov 2015 15:05:11: 0x000009d8, ERROR: amGenericProxySevices::proxyRequest()Received no response data after posting the request!
EX::Wed, 04 Nov 2015 15:05:11: 0x000009d8, ERROR: amGenericProxy::proxyRequest() - request to server failed. HTTP CODE: 404 CML: CML code: 0x00000000 IP: x.x.x.x Error Code: 0xc7490003

IN::Wed, 04 Nov 2015 20:53:59: 0x00001498, INFO: amGenericProxySevices::proxyRequest() Contacting server: hostname.Itauchile.cl port: 3994 user: SiteProtector
VB::Wed, 04 Nov 2015 20:53:59: 0x00001498, HelperPostRequest - Enter
VB::Wed, 04 Nov 2015 20:53:59: 0x00001498, _HelperInternalRequest - Enter
VB::Wed, 04 Nov 2015 20:53:59: 0x00001498, _HelperInternalRequest server: hostname.Itauchile.cl port: 3994 resource: /iss/task_services

Reviewing the SiteProtector iss-services.log, the following errors are present: 

2015-11-04T20:48:20 [main] OFF net.iss.ms.service.site.SslServerAdaptor:35 - initialize()::https://127.0.0.1:8443
2015-11-04T20:48:20 [main] DEBUG net.iss.ms.service.site.SslServerAdaptor:71 - https://hostname.Itauchile.cl:3994


RESOLVING THE PROBLEM
Upon checking the Persistent Connection configuration, it was found to be enabled, and disabling it changed the XGS status from Offline to Active immediately. 

To disable Persistent Connection option: 


 1. Open SiteProtector Console Agent view.
    
    
 2. Right-click on the XGS and choose Configure Agent.
    
    
 3. Select Disable Persistent Connections for selected agents.
    
    
 4. Select OK.
    
    
 5. Right-click on the GX and Refresh Agent.
    





[/support/docview.wss?uid=swg21972163&aid=1] [https://ibm.biz/BdHdZx] [/support/docview.wss?uid=swg21972163&aid=2] [http://ibm.biz/InfraSecForumTechnote] [/support/docview.wss?uid=swg21972163&aid=3] [http://ibm.biz/SecSuptUTube] [/support/docview.wss?uid=swg21972163&aid=4] [http://ibm.biz/InfraSecFixes] [/support/docview.wss?uid=swg21972163&aid=5] [http://ibm.biz/FlexLicLogin] [/support/docview.wss?uid=swg21972163&aid=6] [http://ibm.biz/MyNotification] [/support/docview.wss?uid=swg21972163&aid=7] [http://ibm.biz/ContactSecSupport]