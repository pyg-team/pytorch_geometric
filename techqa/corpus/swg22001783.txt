Title: IBM Security Guardium: Unix STAP Troubleshooting Steps - United States

Text:
STAP; GIM; Troubleshoot; UNIX TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 How to toubleshoot Unix STAP issues 

SYMPTOM
1. STAP not showing up in the GUI console 

 2. Guardium STAPs are showing as red or Inactive in the GUI console.
3. STAP shows green, but no traffic is collected.


RESOLVING THE PROBLEM
Verifying that the Guardium and the database server for the S-TAP are connected

1. Verify that sniffer process is running

Before connecting to the database, check whether the sniffer process is running on the Guardium system. The sniffer is responsible for communicating with each S-TAP and processing the data that is received. If the sniffer is not running, responses from the S-TAP will not be recognized.

On Guardium, run following commands from CLI to start the services:

restart stopped_services ==> Use this CLI command to restart services previously stopped
support clean servlets ==> Use this CLI command to delete generated Java servlets and 
restart gui
stop inspection-core ==> Use this CLI command to stop sniffer process
start inspection-core ==> Use this CLI command to start sniffer process

2. Verify that Guardium meets the minimum system requirements for RAM, otherwise Guardium STAP 
might not be visible in the GUI console.

For, v9.5(32-bit)
8 GB (min) to 16 GB (max)

For, v9.5(64-bit)
16 GB (min) to motherboard max 

For, v10.x (64-bit)
24 GB (min) to motherboard max

3. Verify IP address


 * Verify that the sqlguard_ip parameter is set to the correct guardium_hostname_or_ip for the InfoSphere Guardium server 
 * Verify that the tap_ip is set to the correct host name or ip for the database server where the S-Tap is installed

Consider changing the sqlguard_ip and tap_ip to IP addresses instead of host names. 

If necessary, click the edit icon next to the IP address to update the S-TAP settings. 
Refresh the S-TAP Host status to clear any network communication issues. If a network issue interrupts the synchronization of S-TAP configuration changes, the status might get stuck at yellow. In the S-TAP Control window, click Refresh button to reset the communication with the S-TAP component. Once light has become green, make the same changes again and apply. 

4. Verify that the Guardium S-TAP database server components are online. 

UNIX: Verify that the S-TAP process is running 
On the database server, from the command-line, run the command: 
ps -ef | grep -i stap 

If the STAP installation was done using GIM, 

Unix: Verify that the GIM and supervisor process is running 
On the database server, from the command-line, run the command: 

ps -ef | grep -i gim 
ps -ef | grep -i supervisor 

Refer following link for "How to start and stop STAP" on Unix 
https://www.ibm.com/support/knowledgecenter/SSMPHH_10.1.0/com.ibm.guardium.doc.stap/stap/unix_stap.html [https://www.ibm.com/support/knowledgecenter/SSMPHH_10.1.0/com.ibm.guardium.doc.stap/stap/unix_stap.html] 


5. Verify KTAP module 

Verify if a ktap module is running 
On the database server, from the command-line, Use the appropriate command for your platform, 
For example: 

Linux : lsmod | grep ktap 
Solaris : modinfo | grep tap 
HP-UX : lsdev | grep tap 
AIX : genkex | grep tap 

If a device such as ktap_<release> is shown, means the ktap module is running. 
If found that KTAP module not loaded, then perform following steps to reload the KTAP module. 

Run these commands as root: 

<STAP directory>/KTAP/guard_ktap_loader stop 
<STAP directory>/KTAP/guard_ktap_loader install 
<STAP directory>/KTAP/guard_ktap_loader start 

Use following link for STAP Flex loading instructions for GIM and non-GIM environments that can help when an exact match between module and kernel version does not exist. 
http://www-01.ibm.com/support/docview.wss?uid=swg21608038 [http://www-01.ibm.com/support/docview.wss?uid=swg21608038] 

Verify that KTAP is supported with OS Kernel version. 
To verify, please download latest KTAP_List_of_Modules from IBM Fix-central website. 

6. Verify that an Inspection Engine exists and it is correctly configured 

Expand the Inspection Engines section to verify that an inspection engine is defined for the S-TAP. 
For instructions on how to add an inspection engine, 

Inspection Engine Configuration 
https://www.ibm.com/support/knowledgecenter/SSMPHH_10.1.0/com.ibm.guardium.doc.admin/config/inspection_engine_configuration.html [https://www.ibm.com/support/knowledgecenter/SSMPHH_10.1.0/com.ibm.guardium.doc.admin/config/inspection_engine_configuration.html] 

Adding inspection engines for your databases 
https://www.ibm.com/support/knowledgecenter/en/SS2S7B_2.1.0/com.ibm.datatools.capturereplay.install.doc/topics/cr_add_inspection_engines.html [https://www.ibm.com/support/knowledgecenter/en/SS2S7B_2.1.0/com.ibm.datatools.capturereplay.install.doc/topics/cr_add_inspection_engines.html] 


7. Verify the connection between the Guardium and the database server for the Guardium S-TAP. 

Depending on the status of the InfoSphere Guardium S-TAP connection, resolve any connectivity issues by following the instructions in the corresponding user response. 

(a) Verify that you can ping the InfoSphere Guardium appliance from the database server. 
(b) If the ping is successful, verify that you can telnet to the following ports: 
UNIX: 16016/16018 

(c) If there is a firewall between the database server and the InfoSphere Guardium server, verify that the 
following ports are open for traffic between these two systems. 

UNIX: TCP Port 16016 or TLS Port 16018 for encrypted connections. 
Use the following command to check the port availability: 

nmap -p port guardium_hostname_or_ip 
netstat -aon | grep port 

8. Create a session list report to verify if the traffic is being captured on the Guardium Server 

Steps to create a session list report, 

For v9.x : 
Log on to the InfoSphere Guardium web console with the admin user ID (or any user that has the admin role) 

Navigate to Tools > Report Building > Report Builder > Report Title (Select Session List from drop down list) > Add To Pane 

For v10.x : 
Log on to the InfoSphere Guardium web console with the admin user ID (or any user that has the admin role) 

Navigate to Reports > Report Configuration Tools > Report Builder > Report Title (Select Session List from drop down list) > Add To My Custom Reports 

9. Run iptraf from CLI and check if the packets being captured from DB Server 

To run iptraf utility, please do the following: 

1) Login as cli 
2) Run command: iptraf 
3) Choose Option: IP traffic monitor 
4) Choose Option: All Interfaces (alternatively, you can select the interface your STAP traffic is coming through, default is eth0) 

If the above information is not able to resolve your problem, Guardium support can assist. If you need to open a PMR please attach: 
 *  Support must gather sniffer issues 
 *  STAP Diagnostics

RELATED INFORMATION
 Guardium v10.0/10.1/10.1.2 and v9.0/9.1/9.5 Open Ports [http://www-01.ibm.com/support/docview.wss?uid=swg21973188]
Mustgather for Guardium appliance [http://www-01.ibm.com/support/docview.wss?uid=swg21971158]
IBM MustGather: Collecting data for Guardium STAP [http://www-01.ibm.com/support/docview.wss?uid=swg21579891]