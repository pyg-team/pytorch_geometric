Title: IBM PM10959: APPLICATION SERVER HANG CAN OCCUR IF A THREAD LOGGING AN FFDC HANGS. - United States

Text:
  FIXES ARE AVAILABLE
7.0.0.13: WebSphere Application Server V7.0 Fix Pack 13 for AIX [http://www-01.ibm.com/support/docview.wss?uid=swg24027977]
7.0.0.13: WebSphere Application Server V7.0 Fix Pack 13 for HP-UX [http://www-01.ibm.com/support/docview.wss?uid=swg24027999]
7.0.0.13: WebSphere Application Server V7.0 Fix Pack 13 for IBM i [http://www-01.ibm.com/support/docview.wss?uid=swg24028000]
7.0.0.13: WebSphere Application Server V7.0 Fix Pack 13 for Linux [http://www-01.ibm.com/support/docview.wss?uid=swg24028001]
7.0.0.13: WebSphere Application Server V7.0 Fix Pack 13 for Solaris [http://www-01.ibm.com/support/docview.wss?uid=swg24028002]
7.0.0.13: WebSphere Application Server V7.0 Fix Pack 13 for Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24028003]
7.0.0.13: Java SDK 1.6 SR8FP1 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24028004]
7.0.0.15: WebSphere Application Server V7.0 Fix Pack 15 for AIX [http://www-01.ibm.com/support/docview.wss?uid=swg24028875]
7.0.0.15: Java SDK 1.6 SR9 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24028881]
7.0.0.15: WebSphere Application Server V7.0 Fix Pack 15 for HP-UX [http://www-01.ibm.com/support/docview.wss?uid=swg24029071]
7.0.0.15: WebSphere Application Server V7.0 Fix Pack 15 for IBM i [http://www-01.ibm.com/support/docview.wss?uid=swg24029072]
7.0.0.15: WebSphere Application Server V7.0 Fix Pack 15 for Linux [http://www-01.ibm.com/support/docview.wss?uid=swg24029073]
7.0.0.15: WebSphere Application Server V7.0 Fix Pack 15 for Solaris [http://www-01.ibm.com/support/docview.wss?uid=swg24029074]
7.0.0.15: WebSphere Application Server V7.0 Fix Pack 15 for Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24029075]
7.0.0.17: WebSphere Application Server V7.0 Fix Pack 17 [http://www-01.ibm.com/support/docview.wss?uid=swg24029634]
7.0.0.17: Java SDK 1.6 SR9 FP1 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24029894]
7.0.0.19: WebSphere Application Server V7.0 Fix Pack 19 [http://www-01.ibm.com/support/docview.wss?uid=swg24030660]
7.0.0.21: WebSphere Application Server V7.0 Fix Pack 21 [http://www-01.ibm.com/support/docview.wss?uid=swg24031366]
7.0.0.23: WebSphere Application Server V7.0 Fix Pack 23 [http://www-01.ibm.com/support/docview.wss?uid=swg24032493]
7.0.0.25: WebSphere Application Server V7.0 Fix Pack 25 [http://www-01.ibm.com/support/docview.wss?uid=swg24033267]
7.0.0.27: WebSphere Application Server V7.0 Fix Pack 27 [http://www-01.ibm.com/support/docview.wss?uid=swg24033882]
7.0.0.29: WebSphere Application Server V7.0 Fix Pack 29 [http://www-01.ibm.com/support/docview.wss?uid=swg24034966]
7.0.0.31: WebSphere Application Server V7.0 Fix Pack 31 [http://www-01.ibm.com/support/docview.wss?uid=swg24036768]
7.0.0.27: Java SDK 1.6 SR13 FP2 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24035324]
7.0.0.33: WebSphere Application Server V7.0 Fix Pack 33 [http://www-01.ibm.com/support/docview.wss?uid=swg24037573]
7.0.0.35: WebSphere Application Server V7.0 Fix Pack 35 [http://www-01.ibm.com/support/docview.wss?uid=swg24038310]
7.0.0.37: WebSphere Application Server V7.0 Fix Pack 37 [http://www-01.ibm.com/support/docview.wss?uid=swg24039338]
7.0.0.39: WebSphere Application Server V7.0 Fix Pack 39 [http://www-01.ibm.com/support/docview.wss?uid=swg24041013]
7.0.0.41: WebSphere Application Server V7.0 Fix Pack 41 [http://www-01.ibm.com/support/docview.wss?uid=swg24041931]
7.0.0.43: WebSphere Application Server V7.0 Fix Pack 43 [http://www-01.ibm.com/support/docview.wss?uid=swg24043400]
7.0.0.45: WebSphere Application Server V7.0 Fix Pack 45 [http://www-01.ibm.com/support/docview.wss?uid=swg24044551]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A javacore taken during the time of the hang will show that
   there is one thread which blocks many or all of the other
   threads in the JVM:
   
   In this example, "WebContainer : 0" is blocking almost all of
   the other "WebContainer : XX" threads in the JVM.  It is holding
   onto the 'FfdcProvider' monitor:
   
   3LKMONOBJECT
   com/ibm/ws/ffdc/impl/FfdcProvider@0x00000006C122A790/0x00000006C
   122A79C: Flat locked by "WebContainer : 0" (0x0000000031D83300),
   entry count 2
   3LKWAITERQ          Waiting to enter:
   3LKWAITER              "WebContainer : 1" (0x0000000032599A00)
   3LKWAITER              "WebContainer : 2" (0x000000003061C800)
   3LKWAITER              "WebContainer : 4" (0x0000000031AA2C00)
   3LKWAITER              "WebContainer : 5" (0x0000000032505400)
   ...
   3LKWAITER              "WebContainer : 46" (0x000000003C2A0A00)
   3LKWAITER              "WebContainer : 47" (0x0000000034DA0A00)
   3LKWAITER              "WebContainer : 48" (0x000000003C2CCD00)
   3LKWAITER              "WebContainer : 49" (0x000000003C2C7000)
   
   
   It is stuck waiting for a .socketRead0 call to complete.  The
   top of stack of this thread can be anything which fails to
   complete:
   
   "WebContainer : 0" TID:0x0000000031D83300,
   j9thread_t:0x0000000125CF14C0, state:R, prio=5
          (native thread ID:0xF2043, native priority:0x5, native
   policy:UNKNOWN)
       at java/net/SocketInputStream.socketRead0(Native Method)
       at
   java/net/SocketInputStream.read(SocketInputStream.java:140(Compi
   led Code))
       at
   java/io/FilterInputStream.read(FilterInputStream.java:127(Compil
   ed Code))
   
   
   The key thing to notice is that all of the other hung threads
   need to enter the 'FfdcProvider'.  They have stacks similar to
   this:
   
   "WebContainer : 2" TID:0x000000003061C800,
   j9thread_t:0x00000001230082C0, state:B, prio=5
          (native thread ID:0x613021, native priority:0x5, native
   policy:UNKNOWN)
       at
   com/ibm/ffdc/util/provider/FfdcProvider.getIncident(FfdcProvider
   .java:66(Compiled Code))
       at
   com/ibm/ffdc/util/provider/Ffdc.<init>(Ffdc.java:60(Compiled
   Code))
       at
   com/ibm/ffdc/util/provider/FfdcProvider.getFfdc(FfdcProvider.jav
   a:269(Compiled Code))
       at com/ibm/ffdc/impl/Ffdc.getFfdc(Ffdc.java:176)
       at
   com/ibm/ws/ffdc/FFDCFilter.processException(FFDCFilter.java:112)
   
   
   Until the call which "WebContainer : 0" is making completes,
   none of the other threads in the JVM will be able to move
   forward.  This results in a hang.
   
   
    
   
   

LOCAL FIX
 *  Disable FFDC.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  IBM WebSphere Application Server V7.0 users *
   *                  of FFDC                                     *
   ****************************************************************
   * PROBLEM DESCRIPTION: Syncrhonization between FFDC            *
   *                      incidents can cause a server hang       *
   *                      when an unrecoverable problem           *
   *                      occurs in a given incident.             *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   FFDC has been modified to ensure that incidents can continue
   to be logged from other components when a given component's
   incident-handling hangs a thread.  The impact to this is that
   the FFDC summary log may indicate that the incident file of a
   bad thread was created, while the thread may not have returned
   so the incident will not exist.  Therefore, a missing incident
   entry that might have appeared in a summary file is an
   indication that the component logging to FFDC did not return
   control.
   
   
    
   
   

PROBLEM CONCLUSION
 *  FFDC has been modified to ensure that incidents can continue
   to be logged from other components when a given component's
   incident-handling hangs a thread.
   The fix for this APAR is currently targeted for inclusion in
   fix pack 7.0.0.13.  Please refer to the Recommended Updates
   page for delivery information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS
 *  Fix incomplete, see PM45011 [http://www-01.ibm.com/support/docview.wss?uid=swg1PM45011]
   
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   PM10959
   
   
 * REPORTED COMPONENT NAME
   WEBS APP SERV N
   
   
 * REPORTED COMPONENT ID
   5724H8800
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-03-26
   
   
 * CLOSED DATE
   2010-05-20
   
   
 * LAST MODIFIED DATE
   2011-09-21
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBS APP SERV N
   
   
 * FIXED COMPONENT ID
   5724H8800
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP