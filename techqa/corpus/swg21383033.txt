Title: IBM Portal startup reports "EJPDB0160E: The sanity checks of the database layer failed" with correct UTF-8 encoding - United States

Text:
database; sanity; transfer; layer; utf; utf-8; utf8; encoding; EJPDB0160E; layout; EJPDB0085W; EJPDB0159E TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 IBM® WebSphere® Portal is installed successfully. A DB2® database is configured for use with WebSphere Portal and a database transfer was successful from Derby™ to DB2. During the next startup of WebSphere Portal, the log file SystemOut.log reports an error message of "EJPDB0160E: The sanity checks of the database layer failed". 

This technote provides an overview of how to diagnose and resolve this error message. 

DIAGNOSING THE PROBLEM
1. Run commands to determine if the character encoding of the database is UTF-8. 

 * 
 * 

 * Sample output for the release database generated by "db2 get db cfg" command:
 * 
 * 
 * Database Configuration for Database 
 * 
 * 
 * Database configuration release level = 0x0b00
 * 
 * Database release level = 0x0b00
 * 
 * 
 * Database territory = us
 * 
 * Database code page = 1208
 * 
 * Database code set = UTF-8
 * 
 * 
 * NOTE: If the database code set is anything other than UTF8, AL32UTF8, or AL16UTF16, please stop at this step and refer to Document #1317981, "
 * 'EJPDB0160E: The sanity checks of the database layer failed' error occurs during startup after successful database transfer"
 * to resolve the database using an incorrect, unsupported code set.
 * 
 * 
 * The remainder of this technote assumes the database code set is correctly set to a supported code set.


2. Review the Portal log file SystemOut.log and observe the following: 
 * [datetime] 00000017 Servlet E com.ibm.wps.engine.Servlet init EJPFD0016E: Initialization of service failed.
 *  com.ibm.wps.util.DataBackendException: EJPDB0160E: The sanity checks of the database layer failed. 

RESOLVING THE PROBLEM
 

Reviewing the wkplc_comp.properties file: 

 * 
 * 
 *  community.DbName=commun 
   customization.DbName=custom 
 * 
 * 
 * 
 *  community.DbUrl=jdbc:db2:commun 
   customization.DbUrl=jdbc:db2:commun 
 * 
 * 
 * 
 * 
 * NOTE: 
 * 


Run the database transfer a second time:  * 
 * 
 * 
 * 
 * customization.DbUrl=jdbc:db2:custom
 * 
 * 
 * 
 * 
 * 
 *  ConfigEngine (.sh/.bat) database-transfer -DTransferDomainList=release,customization,community,jcr,feedback,likeminds 

 

Cross reference information Segment Product Component Platform Version Edition Organizational Productivity- Portals & Collaboration WebSphere Portal End of Support Products AIX, HP-UX, IBM i, Linux, Solaris, Windows, z/OS 7.0, 6.1