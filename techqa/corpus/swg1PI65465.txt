Title: IBM PI65465: FORCEPURGE OF A TASK CAUSES AEXZ ABEND LOOP - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS UNREPRODUCIBLE IN NEXT RELEASE.
    
   
   

ERROR DESCRIPTION
 *  A task has entered the system, running a Java program
   on a T8 TCB. A PURGE_TRANSACTION FORCE request was
   issued against this task. At the time this occurred, T8
   was processing a DB2 request, under the control of
   DFHD2D2, though I suspect that the TCB was over in DB2
   at the time of the purge. As part of the purge request,
   T8 has been made unusable.
   DFHD2D2 initiates an abend, and percolates that up
   through DFHD2EX1 to DFHERM. Cleanup is completed, and
   DFHERM exits the recovery environment and attempts to
   change back to the caller's TCB (T8). This fails because
   that TCB is no longer available, which leads to the loop
   of AEXZ abends. Each time round the loop we exit recovery,
   and attempt to switch back to T8, resulting in a new AEXZ abend.
   .
   Additional symptoms / keywords:
   CICS takes a KERNDUMP and abends after DB2 is cancelled. The
   dump shows an L8 TCB associated with a task doing DB2 work
   was abended with 04E, reason code 00F30011 indicating that DB2
   was not active. During retry of the 04E abend, the QR TCB also
   issued an abend 999 or x'3E7', targeting the L8 TCB. This would
   be the CDBF task trying to purge all remaining tasks that had
   been active in DB2. Because this is a recursive error for this
   TCB, DFHKESTX chooses to abend CICS.
   KTCB_KESTX_IN_PROGRESS 3E7 abend40E S40E abendS40E abend999
   
   
    
   
   

LOCAL FIX
 *  *
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All CICS Users.                              *
   ****************************************************************
   * PROBLEM DESCRIPTION: Loop of AEXZ abends from DFHERM         *
   *                      after a purge of a Java transaction     *
   *                      while accessing DB2.                    *
   ****************************************************************
   * RECOMMENDATION: .                                            *
   ****************************************************************
   A user task is running in a JVM server in CICS on a T8 TCB.
   It makes a data base request to DB2 using JDBC. The task
   remains on the T8 TCB to perform the interaction with DB2,
   and while this is occurring, a CICS Task PURGE is issued
   for this task.
   .
   DFHERM sets the task to ABTERM_ALLOWED before calling DB2,
   so the CICS dispatcher performs the PURGE using CALLRTM.
   The CICS ESTAE (DFHKESTX) is driven for the T8 TCB.
   The abend does not allow retry, so the task is moved from
   the T8 TCB to the QR TCB in order that the task can begin
   abend processing, and the T8 TCB can terminate.
   The T8 TCB is marked unusable.
   .
   Now running on the QR TCB, the task runs the recovery
   routines for DFHD2D2, DFHD2EX1, and DFHERM.
   DFHERM exits the recovery environment, then attempts
   to switch back to the original (T8) TCB.
   This TCB is no longer available.
   This generates a new AEXZ abend, and re-enters the DFHERM
   recovery routine. DFHERM becomes trapped in a loop,
   continually issuing AEXZ abends.
   Eventually the region will become short on storage.
   .
   Additional Keywords: DFHSM0133 abendAEXZ TCB_FAILED AD2R
   AP 319D D2EX1 *EXC* THREAD TCB HAS ABENDED WITH ABEND 000003E7
   AP 2535 ERM   *EXC* DSAT-CHANGE-MODE-FAILED
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS
 *  DFHERM has been updated to avoid the loop of AEXZ abends
   when the application was running on a T8 TCB, and that
   TCB is no longer available.
   Furthermore, the CICS Java domain has been updated so that
   after a T8 TCB terminates unexpectedly, CICS is able to
   run recovery for the abending task under the QR TCB.
   CICS will then terminate and automatically restart
   the JVM server.
   Message DFHSJ1007 will be issued to notify the user of the
   JVM server restart.
   .
   The CICS Transaction Server for z/OS Version 5 Release 2
   'CICS Messages and Codes Vol 1' manual (GC34-7283-00)
   will be updated after 'DFHKEnnnn messages' with a new message:
   DFHKE0996 applid DFHKESTX DRIVEN FOR CANCEL WHILE PERFORMING
   RETRY.   COMPLETION CODE code ON TCB tcb.
   Explanation: MVS has issued a cancel abend against this TCB
   while CICS was attempting to locate the retry point for an
   earlier, retryable abend.
   User Response: None.
   CICS Response: This TCB will be terminated.
   .
   The CICS Transaction Server for z/OS Version 5 Release 3
   'CICS Messages and Codes Vol 1' manual (GC34-7418-00)
   will be updated after 'DFHKEnnnn messages' with a new message:
   DFHKE0996 applid DFHKESTX DRIVEN FOR CANCEL WHILE PERFORMING
   RETRY.   COMPLETION CODE code ON TCB tcb.
   Explanation: MVS has issued a cancel abend against this TCB
   while CICS was attempting to locate the retry point for an
   earlier, retryable abend.
   User Response: None.
   CICS Response: This TCB will be terminated.
   
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   PI65465
   
   
 * REPORTED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * REPORTED COMPONENT ID
   5655Y0400
   
   
 * REPORTED RELEASE
   900
   
   
 * STATUS
   CLOSED UR1
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-07-07
   
   
 * CLOSED DATE
   2017-06-22
   
   
 * LAST MODIFIED DATE
   2018-06-08
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI48213 UI48214 UI48215 UI48216 UI48217 UI48218 UI48219 UI48220
   
   

MODULES/MACROS
 *  DFHABAB  DFHAPJVM DFHAPLI1 DFHAPLI2 DFHAPLI3 DFHAPLJ1 DFHAPLJP
   DFHAXIS2 DFHCDJNI DFHCDK64 DFHCDKRN DFHCPI   DFHEIG   DFHEIP
   DFHERM   DFHKEDS  DFHKERN  DFHKESTX DFHKETCB DFHLONGN DFHMEKEC
   DFHMEKEE DFHMEKEK DFHMSG64 DFHMSGIF DFHSJBD  DFHSJDM  DFHSJDS
   DFHSJDST DFHSJDUF DFHSJIN  DFHSJINT DFHSJIS  DFHSJJS  DFHSJL
   DFHSJPTI DFHSJRL  DFHSJSA  DFHSJSC  DFHSJST  DFHSJTH  DFHSJTRI
   DFHSJXM  DFHTRC64 DFHTRCIF DFHWS002 DFHWS003 DFHWS004 DFHWS005
   DFHWS006 DFHWS007 DFHWS008 DFHWS009 DFHWS010 DFHWS011 DFHWS012
   DFHWS013 DFHWS014 DFHWS015 DFHWS016 DFHWS017 DFHWS018 DFHWS019
   DFHWS020 DFHWS021 DFHWS022 DFHWS023 DFHWS024 DFHWS025 DFHWS026
   DFHWS027 DFHWS028 DFHWS029 DFHWS030 DFHWS031 DFHWS032 DFHWS033
   DFHWS034 DFHWS035 DFHWS036 DFHWS037 DFHWS038 DFHWS039 DFHWS040
   DFHWS041 DFHWS042 DFHWS043 DFHWS044 DFHWS045 DFHWS046 DFHWS047
   DFHWS048 DFHWS049 DFHWS050 DFHWS051 DFHWS052 DFHWS053 DFHWS054
   DFHWS055 DFHWS056 DFHWS057 DFHWS058 DFHWS059 DFHWS060 DFHWS061
   DFHWS062 DFHWS064 DFHWS065 DFHWS066 DFHWS068 DFHWS069 DFHWS070
   DFHWS071 DFHWS072 DFHWS073 DFHWS074 DFHWS075 DFHWS076 DFHWS077
   DFHWS078 DFHWS079 DFHWS081 DFHWS082 DFHWS083 DFHWS084 DFHWS085
   DFHWS086 DFHWS087 DFHWS088 DFHWS089 DFHWS090 DFHWS091 DFHWS092
   DFHWS122 DFHWS123 DFJ@H356 DFJ@H360 DFJ@H427 DFJ@H467 DFJ@H468
   DFJDTCOE DFJOUTRE DFJWLPPL
   
   
    
   
   

Publications Referenced GC34728300 GC34741800 FIX INFORMATION
 * FIXED COMPONENT NAME
   CICS TS Z/OS V5
   
   
 * FIXED COMPONENT ID
   5655Y0400
   
   

APPLICABLE COMPONENT LEVELS
 * R000 PSY UI48217 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48217]
   UP17/07/20 P F707
   
   
 * R003 PSY UI48220 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48220]
   UP17/07/21 P F707
   
   
 * R00D PSY UI48218 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48218]
   UP17/07/20 P F707
   
   
 * R00W PSY UI48219 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48219]
   UP17/07/20 P F707
   
   
 * R900 PSY UI48213 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48213]
   UP17/07/20 P F707
   
   
 * R903 PSY UI48216 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48216]
   UP17/07/20 P F707
   
   
 * R90D PSY UI48214 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48214]
   UP17/07/20 P F707
   
   
 * R90W PSY UI48215 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI48215]
   UP17/07/20 P F707
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.