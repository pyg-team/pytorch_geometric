Title: IBM IY90244: Heap corruption can cause MQ exception handler to hang. - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V6.0 for iSeries Fix Pack 6.0.2.1 [http://www-01.ibm.com/support/docview.wss?uid=swg24013915]
WebSphere MQ V6.0 Fix Pack 6.0.2.1 [http://www-01.ibm.com/support/docview.wss?uid=swg24013914]
WebSphere MQ 6.0 for HP OpenVMS Alpha and Itanium - Fix Pack 6.0.2.7 [http://www-01.ibm.com/support/docview.wss?uid=swg24027266]
WebSphere MQ 6.0 for HP OpenVMS Alpha and Itanium - Fix Pack 6.0.2.10 (FP03) [http://www-01.ibm.com/support/docview.wss?uid=swg24029987]
WebSphere MQ V5.3 and WebSphere MQ Express V5.3 - Fix Pack 14 (CSD14) [http://www-01.ibm.com/support/docview.wss?uid=swg24017668]
WebSphere MQ V5.3 for iSeries - Fix Pack 14 (CSD14) [http://www-01.ibm.com/support/docview.wss?uid=swg24017684]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When a process suffers heap corruption then when malloc/free
   are called the C runtime can suffer a SIGBUS/SIGSEGV. If control
   was in MQ code at the time of the malloc/free then the MQ
   exception handler is called. Under these circumstances it is
   important that the exception handler does not call malloc/free
   itself or a deadlock can occur.
   Possible reasons that this error might arise include
   applications corrupting the heap in an application process
   or channel exits corrupting the heap in an MQ process.
   In one example an FDC file is issued for an amqrmppa channel
   process when a channel experiences a SIGBUS.  The probe id is
   XC130003 and the function stack looks
   like
   MQM Function Stack
   ccxResponder
   rrxResponder
   rriFreeSess
   rriTermExits
   rriCALL_EXIT
   xcsFFST
   
   If this error occurs in a channel pool process (amqrmppa) then
   it is possible that the listener (runmqlsr) will also hang  (if
   it is waiting for a response from that amqrmppa process). This
   might give the impression that the queue manager is
   hanging.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   Typically users with invalid applications or exits causing heap
   corruption.
   
   Platforms affected:
    All Distributed (iSeries, all Unix and Windows)
   ****************************************************************
   PROBLEM SUMMARY:
   The MQ exception handler should NEVER call malloc/free as this
   can cause a hang if the exception handler is invoked from
   malloc/free.
   A call to malloc in a function called from the exception
   handler resulted in the hang.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The call to malloc from within control of the MQ exception
   handler has been eliminated.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v5.3
   Platform           Fix Pack 14
   --------           --------------------
   Windows            U200266
   AIX                U808477
   HP-UX (PA-RISC)    U808478
   Solaris (SPARC)    U808480
   iSeries            SI24366
   Linux (x86)        U808481
   Linux (zSeries)    U808483
   
                      v6.0
   Platform           Fix Pack 6.0.2.1
   --------           --------------------
   Windows            U200265
   AIX                U807983
   HP-UX (PA-RISC)    U807999
   HP-UX (Itanium)    U808353
   Solaris (SPARC)    U808000
   Solaris (x86-64)   U808451
   iSeries            SI25716
   Linux (x86)        U808001
   Linux (x86-64)     U808369
   Linux (zSeries)    U808002
   Linux (Power)      U808352
   Linux (s390x)      U808368
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IY90244
   
   
 * REPORTED COMPONENT NAME
   WEBS MQ FOR SUN
   
   
 * REPORTED COMPONENT ID
   5724B4103
   
   
 * REPORTED RELEASE
   530
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-10-04
   
   
 * CLOSED DATE
   2006-11-02
   
   
 * LAST MODIFIED DATE
   2007-07-27
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBS MQ FOR SUN
   
   
 * FIXED COMPONENT ID
   5724B4103
   
   

APPLICABLE COMPONENT LEVELS
 * R530 PSY
   UP