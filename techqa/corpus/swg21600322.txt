Title: IBM CPU metrics inconsistency in Tivoli Monitoring Agent for Unix OS on AIX - United States

Text:
CPU; AIX; ITM Unix Aggregate; SMP TECHNOTE (FAQ)

QUESTION
 Why aggregate values for CPU metrics collected by the Tivoli Monitoring Agent for Unix OS are not equivalent to the average of the values for the different CPUs on AIX? 

ANSWER
The methods to collect the metrics for a single CPU and the aggregate row by the Tivoli Monitoring Agent for Unix OS, referred to as the agent here after, are changed using the APAR IZ42543. The fix for the APAR IZ42543 is included in Tivoli Monitoring v6.2.0 Fix Pack 3 and higher versions.

The purpose of the APAR IZ42543 is to make the CPU metrics calculations by the agent match with the output of AIX OS commands vmstat, mpstat and lparstat in a shared CPU LPAR. The agent calculated the aggregate CPU values as average of the values of single CPUs prior to this fix. However, they are incorrect for a shared CPU LPAR.

For a shared CPU and when Simultaneous Multi Threading (SMT) enabled, the calculation of ALL field is not directly the average of the individual CPU's. The reason for this is that the individual CPU value is calculated as percentage of the fraction of the physical CPU consumed by a particular logical CPU but the ALL field is calculated as the percentage of the allocated entitlement. The average against the sum of individual CPUs is not applicable in the shared SMT environment. The average against the entitled CPU time gives the exact number as how much percentage of entitled CPU is being used. Hence, the value for ALL is calculated against the entitled CPU. 

The agent code is changed to match the calculations performed by AIX commands on a shared CPU LPAR. The agent computes the aggregate CPU values as the simple average over the single logical CPUs for an unshared CPU LPAR.

The output of the AIX command "mpstat 30" can be compared against the data returned by the agent for aggregate row. 

RELATED INFORMATION
 IZ42543 [http://www-01.ibm.com/support/docview.wss?uid=swg1IZ42543]




PRODUCT ALIAS/SYNONYM
 ITM 6 Unix OS agent
Tivoli Unix Agent
5724C040U