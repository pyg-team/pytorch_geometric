Title: IBM Error "retry NetUserGetLocalGroups failed" from sqloLookupGroupInfoForUser after machine was added to a new domain. - United States

Text:
NetUserGetLocalGroups; sqloLookupGroupInfoForUser; domain change TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 I see error "retry NetUserGetLocalGroups failed" from sqloLookupGroupInfoForUser in the db2diag.log after the machine has been moved to a new Windows domain. I also receive authentication errors or delays when connecting to a database with a non SYSADM user after the machine has been moved to a new domain. If I'm able to connect succesfully after the delay, I receive authorization errors when I run SQL statements such as SELECTS.




SYMPTOM
You see the following error in the db2diag.log after changing the machine to a new domain:

2010-01-29-10.27.04.670000-360 I3651H406 LEVEL: Error 
PID : 2208 TID : 2204 PROC : javaw.exe 
INSTANCE: DB2 NODE : 000 
FUNCTION: DB2 UDB, oper system services, sqloLookupGroupInfoForUser, 
probe:208 
MESSAGE : retry NetUserGetLocalGroups failed, retry count: 
DATA #1 : Hexdump, 4 bytes 
0x000637B0 : 3C00 0000 

Additionally, you may also observe one or more of the following issues:

- You receive an authentication error when you try to connect to a database with a non SYSADM DB2 user.
- When you try to connect to a database with a non SYSADM DB2 user, it takes very long. It finally connects but you receive authorization errors when you try to execute any statement, such as a SELECT.
- You try to connect to a database using Control Center and you receive an error indicating the user does not have authority to access the database.


CAUSE
DB2 registry variable DB2_GRP_LOOKUP is not set and the user starting the DB2 Service does not have authority to authenticate users at the domain of the user receiving the error.


RESOLVING THE PROBLEM
You can do one of the following to resolve the problem: 

 * Make sure the user starting the DB2 instance service has enough Windows privileges at the domain where the user getting the error is defined, so it can authenticate users at this domain. For example, add the user starting the DB2 instance service to the Administrators group on the domain machine where the user getting the error is defined. 
 * Perform all the following steps: 1. Add the user starting the DB2 instance service to one of the following groups: 
   
    * 
    * 
    * - The group pointed by database manager configuration parameter SYSADM_GROUP (if SYSADM_GROUP database manager configuration parameter is set). 
    * - If you have extended security enabled in DB2, add the user to the DB2ADMNS group, or to the group you defined to be your DB2 Administrators Group.
   
   
   2. Add the domain user that is receiving the error to a local DB2 group.  * 
    * 
   
   
   3. Run the following DB2 command as a SYSADM user:  * 
    * 
   
   
   4. Recycle the db2 instance after setting the above registry variable:  db2stop 
   
    * 
    *