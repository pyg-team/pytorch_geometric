Title: IBM Journaling - Problem Determination for CPF7024 - United States

Text:
JRN; MSGCPF7024 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document provides reasons why a DLTJRNRCV would fail. 

RESOLVING THE PROBLEM
Valid Reasons Why a DLTJRNRCV Receives Message CPF7024 RC1 

The following are valid reasons why a DLTJRNRCV receives message CPF7024 with RC1 - a journaled object associated with journal receiver &1 has changes that have not been forced to auxiliary storage: 

o Changes have not been forced to DASD. To resolve the problem, do one of the following:

o Close files that are being journaled.
o Bring the system into a restricted state; the DLTJRNRCV should now successfully delete the journal receivers. o The Index builds over the file under commitment control. The commit ID might be closed; however, the access path build was started when it was open, and it has no way of knowing that it is closed (open commit cycle). So, the receiver cannot be deleted until the index build finishes. 

To resolve the problem, you should wait until the indexes have finished building. Stop all new jobs, such as report jobs, from starting up. Let jobs that are currently in IDX- status finish, and then try deleting the receiver.  *   *  
      Valid Reasons Why a DLTJRNRCV Receives Message CPF7024 RC2 
   
   


The following are valid reasons why a DLTJRNRCV receives message CPF7024 with RC2 - the receiver contains entries for changes that are not committed or rolled back: o There are uncommitted changes. To resolve the problem, type WRKJRNA for the journal, press F15 to get into the receiver directory, and select Option 8 on the journal receiver to be deleted.

For example, if a journal receiver called rcv34011 was attached on 12-13-99 at 13:03 and detached at 13:18, the user can locate the job that has not done a commit or rollback since 13:18. The user can use the WRKJRNA for the journal, press F19 and use Option 6 to display all commitment definitions currently associated with the journal. Work with each job that is active and determine if it was started after the Journal Receiver in question was attached and if this job can be ended.

On this Work with Commitment Definitions screen, press F11 until the State field is displayed. 

Any commitment definitions with a State of PREPARED or LAST AGENT PENDING represent transactions that the application tried to commit, but are in-doubt due to a failure between phases one and two of the two-phase commit. Now determine whether the in-doubt commitment definitions are XA transactions by pressing F11 again until the Global Transaction ID field is displayed. If that field is blank, the transaction is non-XA, and should resolve by itself once communications are re-established with the remote system(s) involved in the transaction. If some unrecoverable error has occurred that will prevent communications with those system(s) from ever being re-established, the transaction will have to be manually completed using Option 14=Forced commit or Option16=Forced rollback, followed by Option 19=Cancel resync to make the commitment definition go away. If the Global Transaction ID field is not blank, the commitment definition represents an XA transaction. Such transactions must be completed per XA standard protocol. 

If any of the commitment definitions are not in a PREPARED or LAST AGENT PENDING state, they are still pending commit or rollback. You can display the commit cycle for such transactions by using Option 5=Display from the Work with Commitment Definitions screen, then Option F6=Display resource status, page down and select Journal, then Option 5=Display commit cycle entries. If the timestamp of the first entry (C SC) is later than the timestamp when the journal receiver was detached, this transaction is not preventing the receiver from being deleted. If the C SC timestamp is older than that, the user will have to determine why their application has not committed or rolled back such an old transaction.  *   * There are cases where DLTJRNRCV should work; however, it fails due to an operating system coding error. These problems are documented in multiple APARs. To find relevant PTFs, search on the system version and release as well as keyword MSGCPF7024. 
   
   

 

Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 7.2 Operating System IBM i 7.1 Operating System IBM i 6.1 
HISTORICAL NUMBER
 18204810