Title: IBM Page Expired received on browser after upgrading CICS - United States

Text:
Page Expired ; BACK button clicks clicked pressed presses migrates migration migrating upgrades upgrading 5655M1500 R640 640 R400 400 HCI6400 R650 650 R500 500 HCI6500 5655-M15 5655M15 5655S9700 R660 660 R600 600 HCI6600 5655-S97 5655S97 5655S9700 R670 670 R700 700 HCI6700 5655-S97 5655S97 kixinfo KIXDCFCIC640 KIXDCFCIC650 KIXDCFCIC660 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You have upgraded to CICS Transaction Server for z/OS (CICS TS) V3.1, or later, from CICS TS V2.3, or earlier. Your application that worked on your previous release of CICS TS now receives a "Page Expired" message on the Web browser when the BACK button is clicked. This will typically show up with Microsoft Internet Explorer (IE), but a similar problem might be seen on any Web browser. 

CAUSE
Your CICS application is not sending the correct "Content-Length: nnnnn" value in the HTTP header.

DIAGNOSING THE PROBLEM
Microsoft IE opens, writes, and closes the file to cache. But then deletes the file from the cache. This leads to the page expired message when the BACK button is pressed. The reason it is deleted from the cache is because IE thinks it did not receive all of the data from the server application since the Content-Length was incorrect. So, IE decides not to cache a page that it thinks is incomplete.

In this case, the Content-Length being supplied by the application in CICS was larger than the actual user data being sent. With CICS TS V2.3, or previous releases, the default behavior is for CICS (the Web server) to close the socket when the data was sent. As a result, IE caches and the BACK button works fine. With CICS TS V3.1, or later, the default behavior is for persistent sessions, and the default socketclose is NO. The application sends the incorrect Content-Length as it did before, but the socket remains open and the browser (IE) does not think it has received all of the data. When the socket eventually times out (either due to something in IE, the network, or the user clicking on another page), IE deletes the "file" from the cache and the page-expired will occur since it is not in the cache. IE does not think it received all of the data and does not want to cache an incomplete page.

RESOLVING THE PROBLEM
Correct your CICS application to send the correct value for the "Content-Length: nnnnn" header. Note that if the Content-Length header is not found by CICS when it scans the headers, CICS calculates the size of the user data and inserts a Content-Length header with the proper value. IE will then receive the proper Content-Length and will cache the page.

The long term recommendation is to rewrite the application(s) to be HTTP V1.1 compliant and use the EXEC CICS WEB application programming interface (API) commands [http://pic.dhe.ibm.com/infocenter/cicsts/v4r2/index.jsp?topic=/com.ibm.cics.ts.applicationprogramming.doc/topics/dfhp4_commands.html]. Until this happens, WBRA_COMMAREA [http://pic.dhe.ibm.com/infocenter/cicsts/v4r2/index.jsp?topic=/com.ibm.cics.ts.internet.doc/topics/dfhtlo2.html] can be set so that CICS will not send out any HTTP V1.1 specific headers to the client. Although this was not the cause of the problem, you do not want the client to think it is communicating with a V1.1 server application unless the application truly understands and communicates with the V1.1 protocol.



PRODUCT ALIAS/SYNONYM
 CICS TS CICS Transaction Server