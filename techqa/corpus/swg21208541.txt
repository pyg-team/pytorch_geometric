Title: IBM Debugging hang problems in HSM for GPFS environment. - United States

Text:
HSM GPFS DMAPI TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 If there are hang symptoms in Tivoli Storage Manager HSM for GPFS environment, you need to verify if GPFS/DMAPI is waiting for outstanding requests sent to HSM. 

RESOLVING THE PROBLEM
You can use "mmfsadm dump dmapi" to list outstanding requests. 

Example output:
DMAPI is enabled at this node (Shared.EnableDmapi==true)

DMAPI version string at this node: GPFS DMAPI 2.20 

No sessions created at this node (9.155.52.87)

Sessions known at this node:
Sessions registered for mount: 1
sessid: 1429C5D4F
Node:9.155.52.86, partial_info:rec2, CleanupTicks:inactive
Cached tokens list:
session index 0
num cached tokens 0
Sessions not registered for mount: 3
sessid:1429C4312:
Node:9.155.52.86, partial_info:sct2, CleanupTicks:inactive
Cached tokens list:
session index 1
num cached tokens 0
sessid:1429C414D:
Node:9.155.52.86, partial_info:mon2, CleanupTicks:inactive
Cached tokens list:
session index 2
num cached tokens 0
sessid:1429DC44E:
Node:9.155.52.86, partial_info:wat2, CleanupTicks:inactive
Cached tokens list:
session index 3
num cached tokens 0

Session manager is 9.155.52.86 (other node)

Stripe groups at this node:
"gpfs1" id 099B3457:4152D68B 
Stripe group manager is 9.155.52.86(other node)
Session manager for this Stripe group is 9.155.52.86(other node)
Stripe group is mounted at this node
Mount point from /etc/filesystems: "/gpfs1"
DMAPI is enabled for the stripe group
DMAPI Disposition is set for the following events:
CLOSE event: sessid 1429C5D4F (node 9.155.52.86).
PREUNMOUNT event: sessid 1429C5D4F (node 9.155.52.86).
NOSPACE event: sessid 1429C414D (node 9.155.52.86).
READ event: sessid 1429C5D4F (node 9.155.52.86).
WRITE event: sessid 1429C5D4F (node 9.155.52.86).
TRUNCATE event: sessid 1429C5D4F (node 9.155.52.86).
DMAPI dmAttrName Disabled
Number of held DMAPI access rights: 0
Stripe group descriptor:
EnableDmapi: yes
dmSGEventList: 0x00000014
"gpfs2" id 099B3456:4152D526 
Stripe group manager is 9.155.52.86(other node)
Session manager for this Stripe group is 9.155.52.86(other node)
Stripe group is mounted at this node
Mount point from /etc/filesystems: "/gpfs2"
DMAPI is enabled for the stripe group
DMAPI disposition is not set for any event.
DMAPI dmAttrName Disabled
Number of held DMAPI access rights: 0
Stripe group descriptor:
EnableDmapi: yes
dmSGEventList: 0x00000000
"gpfs3" id 099B3456:4152D6BA 
Stripe group manager is 9.155.52.86(other node)
Session manager for this Stripe group is 9.155.52.86(other node)
Stripe group is mounted at this node
Mount point from /etc/filesystems: "/gpfs3"
DMAPI is enabled for the stripe group
DMAPI Disposition is set for the following events:
CLOSE event: sessid 1429C5D4F (node 9.155.52.86).
PREUNMOUNT event: sessid 1429C5D4F (node 9.155.52.86).
NOSPACE event: sessid 1429C414D (node 9.155.52.86).
READ event: sessid 1429C5D4F (node 9.155.52.86).
WRITE event: sessid 1429C5D4F (node 9.155.52.86).
TRUNCATE event: sessid 1429C5D4F (node 9.155.52.86).
DMAPI dmAttrName Disabled
Number of held DMAPI access rights: 0
Stripe group descriptor:
EnableDmapi: yes
dmSGEventList: 0x00000014
"gpfs4" id 099B3457:4152D6D8 
Stripe group manager is 9.155.52.86(other node)
Session manager for this Stripe group is 9.155.52.86(other node)
Stripe group is mounted at this node
Mount point from /etc/filesystems: "/gpfs4"
DMAPI is disabled for the stripe group
DMAPI disposition is not set for any event.
DMAPI dmAttrName Disabled
Number of held DMAPI access rights: 0
Stripe group descriptor:
EnableDmapi: no
dmSGEventList: 0x00000000

Eventbox system:
Eventboxes available (total/free): 12/12
Daemon eventbox handler threads (maximum/total/free): 12/2/2
Synchronous eventbox allocation successes/failures: 3/0
Total events generated by this node (sync/async): 3/163
Total orphan events: 0
Total failed events (error returned to client): 0
Total event retries: 0
Maximum retries per event: 2
Timeout for NFS events: Wait time: -1 milliseconds (no timeout)
Tick period: -1 millisecondss (disabled)
Number of ticks: -1 (disabled)
Timeout after session failure: Wait time: 0 seconds (immediate timeout)
Tick period: -1 seconds (disabled)
Number of ticks: 0 
Timeout for mount disposition: Wait time: 60 seconds 
Tick period: 6 seconds 
Number of ticks: 10 
Timeout for orphan eventboxes: Wait time: 10 seconds 
Tick period: 5 seconds 
Number of ticks: 3 
Timeout for sesssion cleanup: Wait time: 86400 seconds 
Tick period: 3600 seconds 
Number of ticks: 25 
Pending mount operations waiting for mount event disposition: 0
Pending events (sync/async/orphan): 0/0/0
Pending events with activated timeout (response/recovery/orphan): 0/0/0 

 

Check for the pending events reported.

The GPFS mmfsadm command provides information display and change capabilities intended for use by trained service personnel and should only be used on request.

The mmfsadm dump what:
Dumps the state of a large number of internal state values that may be useful in determining the sequence of events. The what parameter may be set to all indicating that all available data should be collected, or another value indicating more restricted collection of data. The output is presented to stdout and should be collected by redirecting stdout.

Provide the selected output to Tivoli Storage Manager support personnel for analysis. If it is necessary to include GPFS development into the analysis, provide the to output of "mmfsadm dump all" and "mmfsadm dump kthread"