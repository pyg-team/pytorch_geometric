Title: IBM Quick Reference:  SSL Setup for WebSphere MQ on IBMi using *SYSTEM store - United States

Text:
SSL Setup DCM *SYSTEM IBMi TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Guidelines for setting up SSL for a WebSphere MQ (WMQ) queue manager on IBMi using the *SYSTEM store with SDR/RCVR channels.

NOTE: This assumes two way authetication is being performed. 

RESOLVING THE PROBLEM

The following must be complete before you begin setup steps:
1)A valid signed CA exists for IBMi 
2)A valid signed Server Certificate exists for IBMi
3)CAs have been exchanged between the two systems 
4)Partner CA has been imported into the *SYSTEM store on IBMi 
5)Queue manager, channels, remote, transmission and local queues exist on the appropriate system
6)Listener has been started on appropriate system 
7)*Most Important* Verify channels can connect successfully without SSL CipherSpecs specified.

NOTE: SSL is not enabled until the channels have been updated with the desired CipherSpecs.

Steps to enable SSL for WMQ on IBMi are as follows: 

1) Change the queue manager to point to the location of the certificate store. 
CHGMQM MQMNAME(<QMGRNAME>) SSLKEYR(*SYSTEM)

This SSLKEYR value indicates that the queue manager uses the system certificate store, and the 
queue manager is registered for use as an application with Digital Certificate Manager (DCM). 

2) Stash the password for the *SYSTEM key repository. The password must be entered in single 
quotation marks and is case sensitive. 
CHGMQM MQMNAME(SSL) SSLKEYRPWD('xxxxxxx'). 

3) Authorize the QMQM user profile to the system default certificate store file path name in the IFS. On 
i5/OS, the default path and stem are /QIBM/UserData/ICSS/Cert/Server/Default.kdb. 

CHGAUT OBJ('/QIBM/UserData/ICSS/Cert/Server') USER(QMQM) DTAAUT(*RWX) 
CHGAUT OBJ('/QIBM/UserData/ICSS/Cert/Server/DEFAULT.KDB') USER(QMQM) DTAAUT(*RWX)
CHGAUT OBJ('/QIBM/UserData/ICSS/Cert/Server/DEFAULT.RDB') USER(QMQM) DTAAUT(*RWX)


4) Assign the Server Certificate to the Queue Manager.

In step 1, when the SSLKEYR parameter was changed to *SYSTEM, WebSphereÂ® MQ
registered the queue manager as a server application with a unique application
label of QIBM_WEBSPHERE_MQ_QMGRNAME and a label with a description of 
QMGRNAME(WMQ).
The queue manager then appears as a server application in DCM and you must assign this 
application to the IBMi server or client certificate in the *SYSTEM store.

>Go to the Digital Certificate Manager via a web browser and sign-in 

e.g. //yourhostoripaddress:2001/QIBM/ICSS/Cert/Admin/qycucm1.ndm/main0

>Click on Select a Certificate Store 
>Select *SYSTEM and click continue 
>Enter key repository password and click continue
>Expand Manage Applications 
>Click on View application definition, verify Server is selected and click continue
>Verify the queue manager name is listed
>Click on Update Certificate Assignment , verify Server is selected and click continue 
>Select QMGRNAME (WMQ) and click on Update certificate assignment 
>Select the appropriate certificate and click on Assign New Certificate 
The following message is displayed "The certificate was assigned to the application." 

5)Update the channel(s) Cipher Spec parameter
CHGMQMCHL CHLNAME(<QM1.TO.QM2>) MQMNAME(<QMGRNAME>) CHLTYPE(*SDR) 
SSLCIPH(*TRIPLE_DES_SHA_US) 
and
CHGMQMCHL CHLNAME(<QM1.TO.QM2>) MQMNAME(<QMGRNAME>) CHLTYPE(*RCVR) 
SSLCIPH(*TRIPLE_DES_SHA_US) SSLCAUTH(*REQUIRED)

The SSLCIPH parameter must be the same for the SDR and RCVR channels. *REQUIRED means that two way authentication will be performed, ie. both sides of channel will validate incoming connection. 

6)Refresh SSL security
RFRMQMAUT QMNAME(QMGRNAME) TYPE(*SSL) 

7)SDR side - start the channel. 
RCVR side - verify listener is started on correct port.

RELATED INFORMATION
 Working with SSL on IBMi [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.0.1/com.ibm.mq.csqzas.doc/sy11910_.htm]
CipherSpecs [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.0.1/com.ibm.mq.csqzas.doc/sy12870_.htm]
Accessing DCM [http://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy11930_.htm]




PRODUCT ALIAS/SYNONYM
 WMQ MQ