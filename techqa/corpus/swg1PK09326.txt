Title: IBM PK09326: TOO MANY OPEN FILES CAUSE DMGR TO HANG - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  We are getting an error that the ND has too many open files. If
   we get these messages the ND will hang and we can only kill the
   dmgr processes. No errors/exceptions occurred when the files are
   closed.  Yet, from both file dir (from collector output) and
   lsof output, the temp files created in
   /opt/IBM/WebSphere/AppServer/profiles/Dmgr01/config/temp/ dir
   were not closed.
   
   How to debug:
   Linux 2.1.72 and above on Intel-based systems to determine if
   the number of open files are growing over a period of time,
   issue lsof to report the open files against a PID on a periodic
   basis.
   
   For example:
   
     lsof -p (PID of process) -r (interval in seconds, 1800 for 30
     minutes) > lsof.out
   
   The output will provide you with all of the open files for the
   specified process ID. You will be able to determine which files
   are opened and which files are growing over time.
   
   This problem seems to happen in mixed cell environment only.
   That is, v6 dmgr with at least one v5 node.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: Websphere Application Server users with      *
   *                 deployment manager (dmgr) at the version 6   *
   *                 level and node agent at the version 5 level. *
   ****************************************************************
   * PROBLEM DESCRIPTION: Too many files opened even though       *
   *                      they are shown as deleted while         *
   *                      updating applications in Application    *
   *                      Server version 6 with a mixed cell      *
   *                      configuration.                          *
   *                                                              *
   *                      We can see this by running              *
   *                      lsof -p <process id of dmgr>            *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   To recreate:
   - Start with a version 5 ND environment (dmgr + a node with a
   couple of applications  installed on the node)
   - install Version 6 ND, and create a dmgr profile
   - migrate Version 5 dmgr to Version6 (see
   http://publib.boulder.ibm.com/infocenter
   /wasinfo/v6r0/index.jsp?topic=/com.ibm.websphere.nd.doc [http://publib.boulder.ibm.com/infocenter/wasinfo/v6r0/index.jsp?topic=/com.ibm.websphere.nd.doc]
   /info/ae/ae/tins_migratend50x.html for help on migration)
   - start dmgr (at version 6 level now) and node agent (still at
   version 5 level)
   - run "lsof -p <process id of dmgr>" to see a list of open
   files.
   
   You may want to pipe the output to a file for an easier view.
   what you should see are there are several repository files
   listed, and marked as "deleted".  The lsof command lists all
   the files opened by the dmgr process.
   For the ones marked with "deleted", they are the files that
   have been removed but are not closed (which should not happen).
   If you deploy another application to the Version 5 node, you
   will see more open files marked as "deleted." All these
   "deleted" open files are temp files residing in the
   <config_home>/temp/ directory
   If dmgr is left running and many application deployments are
   performed, dmgr could run over the open file limit and result
   in a "too many open files" error.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Code has been corrected so that the files get closed.
   
   The fix for this APAR is currently targeted for inclusion
   in fixpack 6.0.2.5. Please refer to the recommended updates
   page for delivery
   information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK09326
   
   
 * REPORTED COMPONENT NAME
   WEBSPH APP SERV
   
   
 * REPORTED COMPONENT ID
   5724J0800
   
   
 * REPORTED RELEASE
   60I
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2005-07-22
   
   
 * CLOSED DATE
   2005-09-21
   
   
 * LAST MODIFIED DATE
   2005-11-29
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  ADMIN
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPH APP SERV
   
   
 * FIXED COMPONENT ID
   5724J0800
   
   

APPLICABLE COMPONENT LEVELS
 * R60A PSY
   UP
   
   
 * R60H PSY
   UP
   
   
 * R60I PSY
   UP
   
   
 * R60P PSY
   UP
   
   
 * R60S PSY
   UP
   
   
 * R60W PSY
   UP
   
   
 * R60Z PSY
   UP