Title: IBM 0C4 in DFHAPLI1 at offset x'2990' when using OMEGAMON - United States

Text:
DFHAPLI1 2990 00002990 KOCOME00; ABEND 0C4; ABEND0C4; ABEND S0C4; ABENDS0C4; DFHDSDS3 DFHFCVR DFHEITS DFHSUWT FFFF FFFFFFFF thread change_mode QR opentcb open_tcb 5697E9300 R620 620 R200 200 R630 630 R300 300 HCI6300 HCI6200 5697-E93 5697E93 KIXINFO kixote retention23 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
You receive unpredictable results including message DFHPG0002 A severe error (code X'0E09') has occurred in module DFHPGAI. Analysis of your dump shows you that an abend0C4 occurred in DFHAPLI1 at offset x'2990'. This can occur after making changes to your program definitions to make them threadsafe.

SYMPTOM
AbendS0C4 abend 0C4

CAUSE
The OMEGAMON task-related user exit (TRUE), KOCOME00, is defined as threadsafe but the version being used is not threadsafe.

DIAGNOSING THE PROBLEM
The abends are unpredictable. You might see any of the following: 
Abend (code 0C4/AKEA) has occurred at offset X'FFFF' in module DFHDSDS3.
Abend (code 0C2/AKEA) has occurred at offset X'FFFF' in module DFHFCVR.
Abend (code 0C4/AKEA) has occurred at offset X'2990' in module DFHAPLI1
Abend (code 0C6/AKEA) has occurred at offset X'FFFF' in module DFHEITS
Abend (code 0C1/AKEA) has occurred at offset X'FFFF' in module DFHSUWT
Abend (code 0C1/AKEA) has occurred at offset X'FFFF' in module KOCOME00

The dump shows that there is a task that is using the previous running tasks registers to perform instructions. You can use IPCS command verbx dfhpd620 'ke=1' to display the Kernel Domain. In this case, the last entry in the KE Domain Error Table is an abend in DFHAPLI1:

[/support/docview.wss?uid=swg21169107&amp;aid=1]

You can also use the IPCS command verbx dfhpd620 'tr=1' to look at CICS trace. Go to the bottom of the trace and enter F *EXC prev until you find the abend for the running task: 

00070L8001 AP 2523 ERM EVENT
REGAINING-CONTROL-FROM-THREADSAFE-TRUE(KOCOME00) 

00070 L8001 SM 0901 SMCK ENTRY CHECK_STORAGE NO,CURRENT_TERMINAL
00070 L8001 SM 0902 SMCK EXIT CHECK_STORAGE/OK
00070 L8001 DS 0002 DSAT ENTRY CHANGE_MODE 00000001 DSTCB L8001 DS 0016 DSDS3 ENTRY PARTITION_EXIT 1E6038F0
DSTCB L8001 DS 0022 DSDS3 EVENT MVS_WAIT_ENTRY
00069 QR XM 1001 XMIQ ENTRY INQUIRE_TRANSACTION
00069 QR XM 1002 XMIQ EXIT INQUIRE_TRANSACTION/OK NONE,
00069QR PG 0E03 PGAI*EXC*Recovery

In the trace, you will see the previous task regaining control from threadsafe TRUE KOCOME00. The running task abends because it is using the registers from the previous task.


RESOLVING THE PROBLEM
Apply Omegamon fix QC26049. Afterwards, you can specify CONCURRENCY(THREADSAFE) in the program definition [http://publibfi.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/dfha4a00/2.17.3?DT=20031103145454] for KOCOME00.





PRODUCT ALIAS/SYNONYM
CICS/TS CICS TS CICS Transaction Server