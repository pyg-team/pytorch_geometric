Title: IBM Volume groups locked - United States

Text:
volume group groups lock locked lsvg lspv aix premium vios disks attribute group file systems file_systems aixdataprovider 0516-1201 TECHNOTE (FAQ)

QUESTION
 Why are some volume groups locked while the Unix OS agent is running? 

CAUSE
While the Unix OS agent is collecting data for the 'Disks' attribute groups, volume groups can be locked, and AIX commands (like lsvg, lspv, etc...) that address these volume groups, can fail.
For example, when querying a disk that is part of a locked volume group, such command can fail:
# lspv -l hdisk287 
0516-1201 lspv: Warning: volume group yourvg is locked. This command will continue retries until lock is free. If lock is inadvertent and needs to be removed, execute 'chvg -u yourvg'.

In the above example, hdisk287 belongs to volume group yourvg that is locked.
This can also occur for the VIOS Premium or AIX Premium agents when collecting data for the 'File Systems' attribute group.


ANSWER
The Unix OS agent runs this script to collect 'Disks' data:
$CANDLEHOME/aix526/ux/bin/aixDataProvider.pl File_Systems 

 

This will run the command 'lsvg -i -l' in the background, which is known to lock volume groups. 

The volume group should only be locked for some moments (around 1 second); in case of hardware problems the lock can remain longer. 

The lspv/lsvg/lslv commands can also have the "-L" option, but the command manual says: 
Specifies no waiting to obtain a lock on the Volume group. 
Note: If the volume group is being changed, using the -L flag gives unreliable data.

As the "-L" flag may give unreliable data, a choice has been made for the ITM data provider to use the '-i -l' options.

RELATED INFORMATION
 Bypass the volume group lock [https://www.ibm.com/developerworks/community/blogs/AIXDownUnder/entry/bypass_the_volume_group_lock35?lang=en]
Steps to unlock a volume group [http://www-01.ibm.com/support/docview.wss?uid=isg3T1019166]


 

PRODUCT ALIAS/SYNONYM
 itm unix os agent