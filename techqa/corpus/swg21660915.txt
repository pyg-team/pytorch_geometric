Title: IBM Collect troubleshooting data for undercover agent (UCA) problems in IBM Business Process Manager (BPM) - United States

Text:
MustGather TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are having a undercover agent (scheduled or event based), intermediate message event, or start message event problem with IBM Business Process Manager. You would like to know what documentation you must collect (MustGather) so that the IBM Business Process Manager Support team can diagnose your problem. If you gather this documentation before contacting support it will expedite the troubleshooting process, and save you time. 

RESOLVING THE PROBLEM
Review the common steps to resolving UCA issues [http://www.ibm.com/support/docview.wss?uid=swg27041883] before collecting diagnostic traces. 


The following items are required for troubleshooting UCA issues: 

 * Problem description 
 * Trace log files


IBM Business Process Manager V7.5 and later uses WebSphere Application Sever logging functionality. You can set it by selecting Troubleshooting > Logs and Trace in the Administrative Console. For information on where and how to change the log levels, see the following documents: 

 * WebSphere Application Server V7.0 [http://pic.dhe.ibm.com/infocenter/wasinfo/v7r0/topic/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/ttrb_entrrs.html]
   
   
 * WebSphere Application Server V8.0 [http://pic.dhe.ibm.com/infocenter/wasinfo/v8r0/topic/com.ibm.websphere.nd.multiplatform.doc/info/ae/ae/ttrb_entrrs.html]
   
   
 * WebSphere Application Server V8.5 [http://pic.dhe.ibm.com/infocenter/wasinfo/v8r5/topic/com.ibm.websphere.nd.multiplatform.doc/ae/ttrb_entrrs.html]
   


Problem Description

To help resolve the issue, provide as many details as possible. 

 * A description of the problem with a detailed history of the problem that you are observing and information on how to reproduce it 
 * The name of the UCA that is not working. 
 * A screen shot of the UCA implementation page. 
 * The type of UCA: scheduled (timer) or event-based.  * For scheduled, state when it is scheduled to run. 
    * For event-based, specify the answers to the following questions:  * Is the receiving message a start message event (SME) or intermediate message event? 
       * Is durable message checked? 
       * Is consume message checked? 
       * What variable is selected in the data mapping section?
         
      
      
   
   
 * Also answer the following questions:  * Has the UCA ever worked as intended? 
    * Is this problem part of a recent snapshot install?
      
   
   

Collect Trace Log Data Enable the following trace in the Runtime tab of the AppTarget (Process Server Javaâ„¢ virtual machine (JVM)). For non-production servers, enable traces on one (1) AppTarget JVM while turning off other JVMs in the cluster. This approach helps to isolate the problem to just one server. For production issues, traces must be enabled on all servers to capture data. Complete the following steps: 

 1. Set the trace log roll over to a minimum of 10 files and the file size to 50MB (500MB total). On a heavily used system, this may capture approximately 30 minutes of data.
    
    
 2. Use the following trace string in all AppTarget cluster members:
    *=info: WLE.*=all
    
    
 3. Apply and save settings
    
 4. Re-create the problem.
    
 5. Compress all of the logs from the profiles directory of every node in the system. 
    
    [bpm_install]/profiles/[profileName]/logs
    
    Send the files to support.
    
    
 6. Turn off the trace by setting it back to *=info, click apply and save the settings.
    
    
 7. See the Exchanging information with IBM Technical Support [http://www.ibm.com/support/docview.wss?uid=swg21153852] for problem determination document for information on how to send the log files to IBM Technical Support.
    
    


Scheduled UCAs that do not display in the Event Manager 

Diagnosing the scheduled UCA might require a coordinated effort between the IBM Business Process Manager, WebSphere Application Server, and database administrators. 
 1. Export the LSW_EM_TASK and LSW_EM_TASK_KEYWORDS tables into a 'before' version. Export the data into a file with a .csv or .xsl extension. 
 2. Set the trace log roll over to a minimum of 10 files and the file size to 50MB (500MB total). Activate traces with the *=info: WLE.*=all criteria on all AppTarget cluster members. 
 3. Install the new snapshot. 
 4. Make the new snapshot the default. 
 5. Turn off the trace by setting it back to *=info, click Apply, and save the settings 
 6. Check whether the UCA is active by looking in the Event Manager Monitor.  * If the UCA is active, everything worked as expected and you can delete the traces and the 'before' versions of the table exports. 
     * If the UCA is not active, complete the following steps:  1. Export the LSW_EM_TASK and LSW_EM_TASK_KEYWORDS tables into an 'after' version. Export the data into a .csv or .xsl file. 
        2. Upload the trace plus the 'before' and 'after' versions of table exports together with a description of the steps. Also, include the time when the snapshot was installed and when it was made the default.
       
       
    
    


Optional Data Collection 
In some cases, you might be directed by IBM Technical Support to enable event manager logging. This function logs every operation that passes through the core BPMN (Lombardi) engine to the LSW_EM_TASK_HISTORY table. Complete the following steps. 
 1.  Use a custom XML configuration file [http://www.ibm.com/support/docview.wss?uid=swg21439614] to enable this logging. The following code is the contents of the XML file. The file must be XML compliant and have no extra spaces or line breaks. Due to web page formatting, the <task-execution-listener> value might not be on one line when it is copied over.
     <properties>
     <event-manager>
     <scheduler>
     <task-execution-listener merge="mergeChildren">com.lombardisoftware.server.scheduler.DbTaskExecutionListener</task-execution-listener>
     </scheduler>
     </event-manager>
     </properties>
     
     
 2.  Place this file in the same directory as the 100custom.xml file and restart the IBM Business Process Manager Process Server (AppTarget JVM). For more information on the 100custom.xml file, see Configuration file overview and explanation for Lombardi Teamworks, WebSphere Lombardi Edition (WLE), and the IBM Business Process Manager (BPM) products [http://www.ibm.com/support/docview.wss?uid=swg21439614].
     
     
 3.  Restart the server.
     
     
 4.  Check the TeamworksConfiguration.running.xml the <task-execution-listener> is in the file. If not, repeat steps 1-3
     
     
 5.  Run one instance or task. Check the LSW_EM_TASK_HISTORY table for new entries.
     
     
 6.  Two (2) additional tables will be required as well. LSW_EM_TASK and LSW_EM_TASK_KEYWORDS. 
 7.  Export the tables into an easy to consume text format with CSV (comma separated values) or XSL (Excel spread sheet) or ODS (open document spread sheet)
     
     
 8.  After problem determination with IBM, remove the custom XML file, restart system to turn off logging, and truncate LSW_EM_TASK_HISTORY. This table can grow very quickly and use database disk space.
     
     
 9.   
 10. 


After completing the previous steps, send the following information to IBM Technical Support using the information in the Exchanging information with IBM Technical Support for problem determination [http://www.ibm.com/support/docview.wss?uid=swg21153852] document:  * Provide an exported version of the LSW_EM_TASK_HISTORY table in a .csv or .xsl format.
   Note: The removal of data from the LSW_EM_TASK_HISTORY table is a manual process. To stop Event Manager history logging, remove the custom XML file and restart the IBM Business Process Manager Process Server (AppTarget).
   
   
 * Provide the name of the failing or non-functioning UCA.
   
   
 * Provide an exported version of the LSW_EM_TASK table in the .csv format.
   
   
 * Provide an exported version of the application as a .twx file with details of how to find the UCA that is causing the error. If you cannot export the application, supply screen shots of the UCA settings and also provide a diagram that shows where the UCA is located.
   
   
 * Provide a copy of the Event Manager settings from the 80EventManager.xml file and a copy of the TeamworksConfiguration.running.xml file. Both of these files are located two directories up from the following file path: install_dir\profiles\profile_name\config\cells\cell_name\nodes\node_name\servers\server_name\server_type\config\system\

 

Cross reference information Segment Product Component Platform Version Edition Business Integration IBM Business Process Manager Advanced Undercover Agent (UCA) AIX, Linux, Windows 8.5, 8.0.1, 8.0, 7.5.1, 7.5 Business Integration IBM Business Process Manager Express Undercover Agent (UCA) Linux, Windows 8.5, 8.0.1, 8.0, 7.5.1, 7.5 
PRODUCT ALIAS/SYNONYM
 BPM