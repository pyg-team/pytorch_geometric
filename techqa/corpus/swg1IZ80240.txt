Title: IBM IZ80240: A WRONG ESCAPE CHARACTER ORDER IN A REGEXP EXPRESSION MAKE STS SERVICE DOWN - United States

Text:
  FIXES ARE AVAILABLE
Tivoli Federated Identity Manager 6.2.0 Fixpack 8 (6.2.0-TIV-TFIM-FP0008) [http://www-01.ibm.com/support/docview.wss?uid=swg24025908]
Tivoli Federated Identity Manager 6.2.0 Fixpack 9 (6.2.0-TIV-TFIM-FP0009) [http://www-01.ibm.com/support/docview.wss?uid=swg24029497]
Tivoli Federated Identity Manager 6.2.0 Fixpack 13 (6.2.0-TIV-TFIM-FP0013) [http://www-01.ibm.com/support/docview.wss?uid=swg24032915]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  ENV :  ITFIM 6.2.0.2 ( or 3 ) WAS 6.1.0.23 ( but also 26 )
   
   if you create or modify an STS chain and in the applies to
   section you create a REGEXP expression like :
   
   REGEXP:(.*\.default.\FV_tfimAuthorisation.*)
   
   rather then
   
   REGEXP:(.*\.default\.FV_tfimAuthorisation.*)
   
   that means a wrong escape sequence for "."
   
   
   after load the configuration the STS server stops with the
   following exception in the trace and SystemOut.log :
   
   
   [3/25/10 10:58:24:021 CET] 0000003e RuntimeConfig I
   com.tivoli.am.fim.rte.config.impl.RuntimeConfigurationImpl
   getNodePutHandle node config repository connector
   properties:{location=remote, port=8879, type=SOAP,
   host=ITFIM-62-dm, preferred=true, isInternal=true}
   [3/25/10 10:58:24:181 CET] 0000003e SecurityToken I
   com.tivoli.am.fim.trustserver.service.SecurityTokenService
   startSTS FBTSTM053I The trust service is being started.
   [3/25/10 10:58:24:415 CET] 0000003e RuntimeConfig I
   com.tivoli.am.fim.rte.config.impl.RuntimeConfigurationImpl
   getNodePutHandle node config repository connector
   properties:{location=remote, port=8879, type=SOAP,
   host=ITFIM-62-dm, preferred=true, isInternal=true}
   [3/25/10 10:58:24:606 CET] 0000003e RuntimeConfig I
   com.tivoli.am.fim.rte.config.impl.RuntimeConfigurationImpl
   getNodePutHandle node config repository connector
   properties:{location=remote, port=8879, type=SOAP,
   host=ITFIM-62-dm, preferred=true, isInternal=true}
   [3/25/10 10:58:27:191 CET] 0000003e RuntimeConfig I
   com.tivoli.am.fim.rte.config.impl.RuntimeConfigurationImpl
   getNodePutHandle node config repository connector
   properties:{location=remote, port=8879, type=SOAP,
   host=ITFIM-62-dm, preferred=true, isInternal=true}
   [3/25/10 10:58:27:668 CET] 0000003e STSManager    I
   com.tivoli.am.fim.trustserver.sts.STSManager init()
   java.util.regex.PatternSyntaxException: Illegal/unsupported
   escape squence near index 14
   (.*\.default.\FV_tfimAuthorisation.*)
                 ^
    at java.util.regex.Pattern.error(Pattern.java:1686)
    at java.util.regex.Pattern.escape(Pattern.java:2157)
    at java.util.regex.Pattern.atom(Pattern.java:1899
   
   ....
   ....
   [3/25/10 11:01:05:879 CET] 00000042 SecurityToken I
   com.tivoli.am.fim.trustserver.service.SecurityTokenProcessor
   process(STSRequest, STSResponse) FBTSTM024I The trust service is
   stopped and is currently not taking requests.
   [3/25/10 11:01:05:930 CET] 00000042 SecurityToken I
   com.tivoli.am.fim.trustserver.service.SecurityTokenProcessor
   process(STSRequest, STSResponse)
   com.tivoli.am.fim.trustserver.sts.STSException: FBTSTM024I The
   trust service is stopped and is currently not taking requests.
    at
   com.tivoli.am.fim.trustserver.service.SecurityTokenProcessor.pro
   cess(SecurityTokenProcessor.java:57)
    at
   com.tivoli.am.fim.trustserver.service.SecurityTokenService.proce
   ssRequest(SecurityTokenService.java:542)
   
   
   
   
   
   so an user error typo stops the entire service,  you can easily
   imagine the impact of such a stupid typo in a production
   environment,
   as consequence customer is asking whether it make sense to have
   ITFIM ISC console to check the validity of the expression or
   have STS server be able
   to simply "flag" that chain as invalid but keep providing
   service.
   
   
    
   
   

LOCAL FIX
 *  remove the character on the configuration and
   restart service
   
   
    
   
   

PROBLEM SUMMARY
 *  When an illegal regular expression is provided for
   the "applies to", "issuer" or "token type" field of the STS
   chain mapping,
   a "java.util.regex.PatternSyntaxException" exception is thrown
   when
   STS chain mappings are being configured during the starting up
   of STS service.
   As runtime exceptions are not handled during the configuration
   of STS chain
   mappings,the starting up of STS service fails.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The fix for this APAR is contained in the following maintenance
   packages:
   | fixpack | 6.2.0-TIV-FIM-FP0008 |
   
   
    
   
   

TEMPORARY FIX
 *  Correct the illegal regular expression
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ80240
   
   
 * REPORTED COMPONENT NAME
   TIV FED ID MGR
   
   
 * REPORTED COMPONENT ID
   5724L7300
   
   
 * REPORTED RELEASE
   620
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-07-16
   
   
 * CLOSED DATE
   2011-01-30
   
   
 * LAST MODIFIED DATE
   2011-01-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TIV FED ID MGR
   
   
 * FIXED COMPONENT ID
   5724L7300
   
   

APPLICABLE COMPONENT LEVELS
 * R620 PSY
   UP