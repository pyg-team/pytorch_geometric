Title: IBM LI80019: HEALTH CHECK API DOES NOT REFLECT CLOUD DISSOCIATION - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



 DIRECT LINKS TO FIXES
microgateway-1.6.7 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=microgateway-1.6.7&source=SAR]
apiconnect-collective-member-1.5.7 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=apiconnect-collective-member-1.5.7&source=SAR]
apiconnect-collective-controller-linux-x86_64-2.9.2 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=apiconnect-collective-controller-linux-x86_64-2.9.2&source=SAR]
apiconnect-collective-controller-linux-s390x-2.9.2 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=apiconnect-collective-controller-linux-s390x-2.9.2&source=SAR]
apiconnect-collective-controller-linux-ppc64le-2.9.2 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=apiconnect-collective-controller-linux-ppc64le-2.9.2&source=SAR]
apiconnect-collective-controller-darwin-2.9.2 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=apiconnect-collective-controller-darwin-2.9.2&source=SAR]
apiconnect-2.7.209 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=apiconnect-2.7.209&source=SAR]
APIConnect_Management_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.vcrypt2 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=APIConnect_Management_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.vcrypt2&source=SAR]
APIConnect_Management_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.ova [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=APIConnect_Management_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.ova&source=SAR]
5.0.8.3-APIConnect-Portal-Ubuntu16-20180426-2319.ova [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=5.0.8.3-APIConnect-Portal-Ubuntu16-20180426-2319.ova&source=SAR]
5.0.8.3-APIConnect-Portal-Ubuntu16-20180426-2319 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=5.0.8.3-APIConnect-Portal-Ubuntu16-20180426-2319&source=SAR]
5.0.8.3-APIConnect-Portal-Debian7-20180426-2319 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=5.0.8.3-APIConnect-Portal-Debian7-20180426-2319&source=SAR]
APIConnect_Management_Essentials_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.vcrypt2 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=APIConnect_Management_Essentials_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.vcrypt2&source=SAR]
APIConnect_Management_Essentials_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.ova [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=APIConnect_Management_Essentials_5.0.8.3_20180424-2045_a46370d60d8f_81f476a.ova&source=SAR]
5.0.8.3-APIConnect-Portal-Essentials-Ubuntu16-20180426-2319.ova [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=5.0.8.3-APIConnect-Portal-Essentials-Ubuntu16-20180426-2319.ova&source=SAR]
5.0.8.3-APIConnect-Portal-Essentials-Ubuntu16-20180426-2319 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=5.0.8.3-APIConnect-Portal-Essentials-Ubuntu16-20180426-2319&source=SAR]
5.0.8.3-APIConnect-Portal-Essentials-Debian7-20180426-2319 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+API+Connect&fixids=5.0.8.3-APIConnect-Portal-Essentials-Debian7-20180426-2319&source=SAR]


APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  During cloud dissociation, health check API calls made against
   individual management servers in this cloud still report success
   and detailed health check reports "isDissociated" as "false".
   Need a way to reflect cloud dissocation in the results of the
   health check.
   
   
    
   
   

LOCAL FIX
 *  Several other options are available for determining cloud
   dissociation:
   1) Email notifications are sent when cloud dissociation occurs.
   2) The Cloud Manager user interface displays on the Services tab
   which management servers are dissociated.
   3) "ha list" CLI command displaying Role for more than one
   management server in the cloud as Primary indicates that there
   is cloud dissociation
   
   
    
   
   

PROBLEM SUMMARY
 *  During cloud dissociation, health check API calls made against
   individual management servers in this cloud still report success
   and detailed health check reports "isDissociated" as "false".
   As a result, a load balancer that uses the health check
   continues directing traffic to all management servers, thus
   potentially resulting in differences in configuration data (e.g.
   catalogs, products, APIs). This makes resolving cloud
   dissociation more time-consuming and challenging.
   
   The solution is as follows:
   1) Leave the default health check behavior as is. Do not fail
   the health check if some servers in the cloud are dissociated.
   This is to retain backward compatibility for existing customers
   and to avoid causing full downtime for the cloud in the default
   case. During cloud dissociation, every management server will
   have at least one other management server that it considers as
   dissociated. If one of the servers is dissociated, we don't want
   all of the servers in the cloud to fail the health check. Unless
   that is what the administrator explicitly wants.
   2) We cannot pick winners and losers among the management
   servers automatically since we don't know which management
   servers the administrator may prefer to direct traffic to in the
   case of dissociation (e.g. they may have a certain management
   server or site they would prefer).
   3) Provide tools to the administrator to fail the health check
   if explicitly desired in case of cloud dissociation.
   Additionally, provide the list of dissociated servers to allow
   for custom load-balancer logic to direct the load balancer
   traffic or for a monitoring script to alert the administrator
   with details.
   4) Add new query option "failIfCloudIsDissociated" (default:
   false) for both simple and detailed health check. If this query
   option is set to true, then the health check for any management
   server would return failure if it detects that any of the
   management servers are dissociated.
   5) Add new values to the response of the detailed health check:
     a) "isCloudDissociated" (type: boolean)
     b) "dissociatedServers" (type: list of strings, containing
   addresses (hostnames or IP addresses) of management servers that
   this management server considers as dissociated; empty list, if
   no management servers are dissociated)
     c) these new values would be always calculated and provided
   regardless of the "failIfCloudIsDissociated" query option.
   - Deprecate the "testIsDissociated" query option and the
   "isDissociated" value returned in the response since this value
   is always false from this server's perspective, so having this
   value is confusing. Do not remove these since some existing
   customers may currently depend on them.
   
   
    
   
   

PROBLEM CONCLUSION
 *  This issue is targeted to be addressed in API Connect 5.0.8.3.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   LI80019
   
   
 * REPORTED COMPONENT NAME
   API CONNECT ENT
   
   
 * REPORTED COMPONENT ID
   5725Z2201
   
   
 * REPORTED RELEASE
   50X
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2018-02-27
   
   
 * CLOSED DATE
   2018-03-27
   
   
 * LAST MODIFIED DATE
   2018-03-27
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   API CONNECT ENT
   
   
 * FIXED COMPONENT ID
   5725Z2201
   
   

APPLICABLE COMPONENT LEVELS