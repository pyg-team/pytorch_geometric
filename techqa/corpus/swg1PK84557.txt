Title: IBM PK84557: EDM POOL FULL RC00C90089 ON DB2 9 WHEN RUNNING STORED PROCEDURE THAT CONTAINS STATIC SQL REFERENCING REMOTE OBJECTS - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When running stored procedure that contains SQL referencing
   remote objects, an EDM POOL FULL condition can occur when
   the stored procedure is repeatedly invoked under the same
   thread / DB2 connection --
   DSNT500I   DSNGEPLC RESOURCE UNAVAILABLE
   REASON 00C90089
   TYPE 00000600
   NAME EDM POOL SPACE
   .
   The remote SQL can be either explicit DRDA (using
   an explicit CONNECT) or implicit DRDA (using 3-part name
   SQL with bind option DBPROTOCOL(DRDA) in effect).
   This EDM POOL FULL condition occurs at both
   the DB2 z/OS Requester (where the stored procedure runs)
   and at the target Server site named by the remote SQL or
   the explicit CONNECT statement.
   .
   PK84557 is a DB2 9 ffit of DB2 V8 apar PK31885 / UK21573
   
   
    
   
   

LOCAL FIX
 *  For EDM POOL FULL, issue a COMMIT in calling application
   (if calling application is not a stored procedure) between
   the calls to the stored procedure.
   PK84557 only addresses EDM POOL FULL at the requester
   site when a COMMIT is not used.
   For EDM POOL FULL at the target remote server,
   the calling application must issue a COMMIT between
   CALLs to the same stored procedure.  COMMIT interval can
   be determined by user as what is best and more effective
   for the application and the EDM POOL.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: DB2 9 for z/OS users of stored procedures    *
   *                 that contain remote SQL and return result    *
   *                 sets                                         *
   ****************************************************************
   * PROBLEM DESCRIPTION: After repeatedly invoking the same      *
   *                      stored procedure that contains remote   *
   *                      SQL and returns result sets, an EDM     *
   *                      POOL FULL condition occurred at DB2     *
   *                      Application Requester ( AR ) and/or     *
   *                      target DB2 Application Server (AS) --   *
   *                                                            . *
   *                      DSNT500I DSNGEPLC RESOURCE UNAVAILABLE  *
   *                       REASON 00C90089                        *
   *                       TYPE 00000600                          *
   *                       NAME EDM POOL SPACE                    *
   *                                                            . *
   *                      PK84557 is a DB2 9 forward-fit of       *
   *                      DB2 8 apar PK31885 / UK21573 .          *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   A user ran an application that repeatedly called the same stored
   that contained remote SQL and returned result sets.  Remote SQL
   references objects at a remote DB2 site using either explicit
   DRDA (an explicit CONNECT statement) or implicit DRDA ( 3 part
   named objects with bind option DBPROTOCOL(DRDA) in effect).
   This application was part of a long running thread, and
   after some time  an EDM POOL FULL condition eventually
   occurred at the DB2 Application Requester (AR) and/or target
   DB2 Application Server (AS).  The calling application did not
   issue COMMITs between the calls to the stored procedure.
                                                                  .
   When an application repeatedly calls a stored procedure that
   returns result sets, each call can create a new instance of
   the SQL statements that are issued by that stored procedure if
   the calling application does not close the result sets between
   the calls.  For stored procedures that contain remote SQL, these
   instances of the SQL statements occur in the EDM POOL at both
   the DB2 AR and target DB2 AS.  As each new stored instance
   terminates, the DB2 AR does some storage optimization clean-up
   to free the EDM POOL storage at the AR for those remote SQL
   statements that are not result sets.
                                                                  .
   However, further investigation of this storage optimization
   showed that the storage for the remote SQL was not freed from
   the AR EDM POOL because DB2 did not correctly detect the remote
   SQL instances in the EDM POOL. Hence, the repeated calls to
   the stored procedure eventually resulted in the EDM POOL FULL
   condition at the AR.
                                                                  .
   As for the AS EDM POOL FULL condition, the remote SQL instances
   in the AS EDM POOL are designed to be freed only by a COMMIT ,
   ROLLBACK , thread re-signon, or thread termination, because
   the target AS does not know when the stored procedure instance
   terminates at the AR.  Further confirmation showed that this
   is working as designed and the AS EDM POOL storage for these
   SQL instances is freed at COMMIT, ROLLBACK, etc.  as expected.
                                                                  .
   
   
    
   
   

PROBLEM CONCLUSION
 *  DB2 AR code was changed to correctly identify instance cases of
   remote SQL statements in the Application Requester (AR) EDM POOL
   during clean-up of a stored procedure instance in NFM.
                                                                  .
   DB2 AS code for freeing SQL instances in the Application Server
   (AS) EDM POOL is working as designed.  The calling application
   must issue COMMITs at frequent intervals between the CALLs to
   the stored procedure in order to free storage for SQL instances
   in the AS EDM POOL.
                                                                  .
   Additional keywords: SQLSTOREDPROC SQLSP EDMPOOL SQLREMOTE
                        DISTRIBUTED RC00C90089 SQLCODE904
                                                                  .
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK84557
   
   
 * REPORTED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * REPORTED COMPONENT ID
   5740XYR00
   
   
 * REPORTED RELEASE
   910
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-04-12
   
   
 * CLOSED DATE
   2009-05-28
   
   
 * LAST MODIFIED DATE
   2009-07-01
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK47107
   
   

MODULES/MACROS
 *  DSNXECLC DSNXECLF DSNXECW  DSNXECWA DSNXECWC
   DSNXECWU DSNXELX  DSNXSLT
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * FIXED COMPONENT ID
   5740XYR00
   
   

APPLICABLE COMPONENT LEVELS
 * R910 PSY UK47107 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK47107]
   UP09/06/19 P F906
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.