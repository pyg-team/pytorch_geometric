Title: IBM PI89493: MQ V8 ABN=18A-00000000 AND 5C6-00C510AD when restored smds dataset is smaller than the original - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  MQ v8
   ABN=18A-00000000 and 5C6-00C510AD after RESET SMDS when restored
   SMDS dataset is smaller then the original. Abend is occuring
   even if the dataset is big enough to hold the messages on
   the queue.
   
   Abend 0c4 can be seen in logrec just prior to the abend 18A.
   
   
    
   
   

LOCAL FIX
 *  na
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of IBM MQ for z/OS Version 8       *
   *                 Release 0 Modification 0.                    *
   ****************************************************************
   * PROBLEM DESCRIPTION: Abends occur during or after recovery   *
   *                      for a structure if the SMDS used by     *
   *                      recovery is smaller than previously.    *
   *                      Abends can include:                     *
   *                       S0C4 in CSQEDSS2                       *
   *                       S5C6-00C5105A in CSQEDSR2              *
   *                       S18A-00000000 in CSQEDSI2 followed by  *
   *                      abnormal queue manager termination with *
   *                       REASON=00D95001                        *
   *                                                              *
   *                      In addition, following structure        *
   *                      recovery empty blocks at the start of   *
   *                      the SMDS can be skipped, causing the    *
   *                      SMDS to fill prematurely.               *
   ****************************************************************
   After filling and expanding, an SMDS was recreated or restored
   at the original, pre-expansion size.
   The queue manager detected that SMDS contents were no longer
   valid and set the SMDS status to failed.
   
   When RECOVER CFSTRUCT was issued to rebuild the structure and
   SMDS contents, if there were any persistent messages to be
   written to blocks in the extents beyond the current allocation,
   an attempt was made to extend the SMDS. However if the queue
   manager had previously connected to the structure, an error
   prevented the expansion from completing, leading to abend
   S5C6-00C5105A in CSQEDSR2, and RECOVER CFSTRUCT failing.
   
   If RECOVER CFSTRUCT completed successfully (for example, if the
   messages were non-persistent), a residual value in an SMDS
   control block caused attempts to locate the next free block
   to start after the block used by the last message put before
   the structure failure.
   This leads to earlier free blocks in the SMDS being skipped,
   causing the SMDS to fill/expand prematurely.
   If the last message put used blocks beyond the current SMDS
   size, this also causes an abend 0C4 to occur in CSQEDSS2, which
   is followed by abend S18A and abnormal queue manager
   termination S6C6 when the structure is next disconnected.
   
   
    
   
   

PROBLEM CONCLUSION
 *  RECOVER CFSTRUCT is changed to correctly expand the SMDS as
   required to restore persistent messages, and to reset the
   field used to locate the next free block.
   MQSMDS/K
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI89493
   
   
 * REPORTED COMPONENT NAME
   IBM MQ Z/OS V8
   
   
 * REPORTED COMPONENT ID
   5655W9700
   
   
 * REPORTED RELEASE
   000
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-10-30
   
   
 * CLOSED DATE
   2017-11-24
   
   
 * LAST MODIFIED DATE
   2018-01-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PI90000 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI90000] 010PC2Ÿ UI52101 010PC2Ÿ 
   
   

MODULES/MACROS
 *  CSQEDSC3 CSQEDSS1
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IBM MQ Z/OS V8
   
   
 * FIXED COMPONENT ID
   5655W9700
   
   

APPLICABLE COMPONENT LEVELS
 * R000 PSY UI52101 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI52101]
   UP17/12/16 P F712 ¢
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.