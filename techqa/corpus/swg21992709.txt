Title: IBM Why are XML inserts taking a long time to complete? - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 Why are XML inserts taking a long time to complete? 

CAUSE
Inserting into a table containing one or more XML columns requires DB2 to search for the required free space within the XML object (called XDA object) to fit the new XML data. The search algorithm requires reading potentially many meta-data pages describing the free space available to the XDA object. The default is to read up to 10% of all meta-data pages for the table. Since the default value is percentage based, the number of page reads will grow proportionally with the growth of the XML data. There are a few possible strategies to reduce the performance impact of searching for free space in
large XDA objects:

1) Inline XML data when possible
For small XML documents it is possible to store the XML within a normal DATA row and not in the
XDA object. This algorithm to find free space is the same as inserting relational data. The inline length
must be smaller than the page size of the tablespace minus the length of any other column in the table.
An example of in-lining XML data that is smaller than 30000 bytes is below:

CREATE TABLE mytable(id INTEGER, â€¦, doc XML INLINE LENGTH 30000);
https://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000927.html [https://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000927.html]
https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.5.0/com.ibm.db2.luw.xml.doc/doc/c0052670.html [https://www.ibm.com/support/knowledgecenter/en/SSEPGG_10.5.0/com.ibm.db2.luw.xml.doc/doc/c0052670.html]

2) Enable append mode for the table
Enabling append mode for tables containing XML columns causes new XML data to be appended to
the end of the XDA object instead of searching for existing free space. Append mode is beneficial for
bulk inserts and imports, but for heavy IUD workloads does not reuse space. Append mode can be
turned on with the following command:
ALTER TABLE <tablename> APPEND ON;
https://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000888.html [https://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0000888.html]

3) Decrease the percentage of free space meta-data pages read
The percentage of meta-data pages searched to find free space can be tuned to favor performance or favor free space re-use. The default value is 10% of meta-data pages for the XDA object. Lowering this value with decrease the number of pages read therefore increasing insert performance, while increasing
will cause more pages to be read reducing performance but increasing the change of finding free space to reuse. A value of 0 is equivalent to turning on append mode for the table, while a value of 100 causes every meta-data page to be searched. This value can be adjusted with the following command:
db2set DB2_CSL_SEARCH_PERCENT=<value>;
<instance restart is needed>


ANSWER