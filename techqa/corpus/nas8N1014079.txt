Title: IBM Copy File (CPYF) Using DDM Failed with Message CPI9160 - United States

Text:
i5OS Blade; MSGCPI9160 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document describes how to determine if DNS round robin is the cause of DDM-related CPI9160 failure. 

RESOLVING THE PROBLEM
User job ended with the following message in the joblog: 

 
CPF9160 From QCNSMCTL to QCPEXCON 
Message . . . . : Value not allowed for PATHID, macro CNSSEND.
Cause . . . . . : The value for keyword PATHID is not allowed for the distributed data management (DDM) internal macro CNSSEND, resulting in an internal DDM error.

Looking backwards in the joblog showed that two connections to different IP address had been made. The message that showed this information is CPI9160. They appeared directly after the CPYF command. Here is an extract of the joblog showing the important information (the IP address is not a real address). 

Time 1
CPYF FROMFILE(library/file) TOFILE(ddm_file) FROMMBR(member) TOMBR(*FROMMBR) MBROPT(*REPLACE)

Time 2
CPI9160 From QCNSINIT To QTSMGAFT
Message . . . . : Database connection started over TCP/IP or a local socket.
Cause . . . . . : The database server job 371216/QUSER/QRWTSRVR has been allocated on system SYSTEM for handling a new TCP/IP or local socket connection using DDM protocols. The connection uses IP address 230.40.882.34, port 446,

Time 3
CPI9160 From QCNSINIT To QTSMGAFT
Message . . . . : Database connection started over TCP/IP or a local socket.
Cause . . . . . : The database server job 371218/QUSER/QRWTSRVR has been allocated on system SYSTEM for handling a new TCP/IP or local socket connection using DDM protocols. The connection uses IP address 230.40.882.36, port 446, 

Time 4
CPF9160 From QCNSMCTL to QCPEXCON 
Message . . . . : Value not allowed for PATHID, macro CNSSEND.
Cause . . . . . : The value for keyword PATHID is not allowed for the distributed data management (DDM) internal macro CNSSEND, resulting in an internal DDM error.

Looking at the CPI9160 messages shows two different addresses for the DDM connections. What caused that? 

The DDM file pointed to a host name 'SYSTEM.' The first connection was set to IP ...34, when DDM went to resolve the host name again it got back an IP of ...36. Therefore, DDM could not use the one created at time 2. 

Q1: Why did DDM get a different IP?

A1: The user set up Domain Name Server (DNS) entries so that they would use the DNS Round Robin load balancing technique of assigning multiple IP addresses to a given host name. 

Q2: Why did DDM issue message CPF9160?

A2: DDM does not support DNS round-robin load balancing. 

Q3: How can I determine if the user set up DNS with two IP addresses?

A3: You can use the network command 'nslookup' hostname where hostname in this case was SYSTEM to see if there is a DNS entry with multiple IP addresses. This needs to be issued from a system on the network, a PC DOS prompt or System i QSH command line will work. 

Q4: Are there other factors that influence this problem? 

A4: The other thing at play here was the Time To Live had been changed from its default.


Resolving the Problem

To resolve the problem, do one of the following: 

o Run the CHGDDMF command to hardcode the IP address of the target rather than using the host name. o Change the DNS server to only have one IP address. o Leave the Time To Live at the default of 24 hours.  


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 6.1 Operating System IBM i 7.1 
HISTORICAL NUMBER
 465234241