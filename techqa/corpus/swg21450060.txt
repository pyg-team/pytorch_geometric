Title: IBM DFHAP0001 0C4 AKEA at offset 7AA in DFHZNAC due to multiple CSNE tasks - United States

Text:
dfhznep node error program DFHAP0001 0C4 AKEA 7AA DFHZNAC CSNE 5655M1500 R640 640 R400 400 HCI6400 R650 650 R500 500 HCI6500 5655-M15 5655M15 5655S9700 R660 660 R600 600 HCI6600 5655-S97 5655S97 R670 670 R700 700 HCI6700 5655-S97 5655S97 5655Y0400 R680 680 R800 800 HCI6800 5655-Y04 5655Y04; 5655Y0400 R680 680 R800 800 HCI6800 5655-Y04 5655Y04 KIXINFO TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are running CICS Transaction Server for z/OS (CICS TS) and receive message DFHAP0001 reporting an abend0C4 at offset X'7AA' in DFHZNAC. You receive the abend multiple times and you recycle the region to recover. 

SYMPTOM
DFHAP0001 An abend (code 0C4/AKEA) has occurred in at offset x'0007AA' in module DFHZNAC.


CAUSE
When a terminal error occurrs, CICS links to the node error program (NEP). In this case, this program was not defined locally in the terminal owning region (TOR) and program autoinstall was not active. This allowed the dynamic routing program to route the link request to a target application owning region (AOR). This now causes CSNE to work with a remote resource and own an MRO link which violates a restriction [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.ts.doc/dfha3/topics/dfha35m.html] against a NEP working with remote resources.

DIAGNOSING THE PROBLEM
Looking at the CICS message log, you might see the following message multiple times:
DFHAP0001 An abend (code 0C4/AKEA) has occurred in at offset x'0007AA' in module DFHZNAC.

The DFHAP0001 dump shows that transaction CSNE is in control, and the failing instruction is an OR Immediate: 9610 A1DD

RegA or Reg10 contains zeros causing the abend 0C4. It should contain a pointer to a Terminal Control block TCTTE. It was loaded from the Terminal Control Table Prefix or TCTFX, field TCTVSRQ located at offset x'130'. This field should either contain a TCTTE address or x'FFFFFFFF' which means there is nothing on the queue. So the problem is caused by this field containing 00000000.

There should only be one CSNE system task running in the system, but in this case, there were multiple CSNE tasks in this dump:

TRAN_# TRAN SUSPEND ATTACH DATE/TIME GMT 

------ ---- ----------- -------------------- 
35839 CSNE ZC DFHZNAC1 06/15/2010 18:17:16.
93619 CSNE ZC DFHZNAC1 06/16/2010 22:30:01.
94028 CSNE ZC DFHZNAC1 06/16/2010 22:30:05.

Looking at the message log, each of the CSNE tasks corresponded to the time when an abend ASP7 occurred as seen in message:

DFHAC2249 13:17:07 Transaction CSNE running program NEPPROG term ???? has failed with abend ASP7 following the failure of a remote system in the prepare phase of syncpoint. Updates will be backed out.

While the CSNE task is going away with the abendASP7, it is possible for more than one CSNE task to be attached to take its place, if there are lots of terminal errors happening at that same time. And having more than one CSNE task active is what sets the stage for possibly getting the repeating 0C4 abends.


RESOLVING THE PROBLEM
Add a local [http://publib.boulder.ibm.com/infocenter/cicsts/v4r1/index.jsp?topic=/com.ibm.cics.ts.resourcedefinition.doc/topics/dfha4fn.html] program definition in the TOR for your node error program.

Note: If your node error program contains any EXEC CICS STARTs for transactions, add local definitions in the TOR for the transactions. If a local definition is not found, the CNSE task would function ship the START to an AOR and that would require an MRO link and an AOR CSMI task. This would break the restriction [http://pic.dhe.ibm.com/infocenter/cicsts/v5r1/topic/com.ibm.cics.ts.doc/dfha3/topics/dfha35m.html] and set the stage for the same kind of repeating 0C4 abends.

 

PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server