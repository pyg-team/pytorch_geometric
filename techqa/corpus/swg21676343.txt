Title: IBM Virtual Portal deletion fails with SQLCODE=-964, SQLSTATE=57011 error - United States

Text:
virtual; portal; rollback; delete; delete-virtual-portal; manage; portlet; db2; SQLCODE; -964; SQLSTATE; 57011 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 IBM WebSphere Portal is successfully installed and configured. A virtual portal was created successfully and is now no longer needed. You attempt to deletion the virtual portal via the Manage Virtual Portal administration portlet or via the delete-virtual-portal configuration task. Both methods fail with a SQLCODE=-964, SQLSTATE=57011 error code. This document will describe how to diagnose and correct this error message so the virtual portal deletion is successful. 

SYMPTOM
The following stacktraces will appear in SystemOut.log: 

[datetime] 00000054DeleteVPComma E com.ibm.wps.command.vp.DeleteVPCommand AbstractCommand.throwCommandException EJPEB0804E: DeleteVPCommand: An exception in the data backend occurred.
com.ibm.portal.resolver.exceptions.LocalizedIOException: EJPFB0002E: Exception occurred.
at com.ibm.wps.wcm.vpmapping.JcrWorkspaceVirtualPortalHandler.onVirtualPortalDeleted(JcrWorkspaceVirtualPortalHandler.java:348)
Caused by: com.ibm.wps.command.CommandException: EJPFB0002E: Exception occurred.
Caused by: javax.jcr.RepositoryException: WSP0004E: Error deleting workspace(s) with id(s) - [7].
Caused by: com.ibm.icm.ci.workspace.CDMWorkspaceException: WSP0004E: Error deleting workspace(s) with id(s) - [7].
Caused by: com.ibm.icm.da.DBAccessException: DB2 SQL Error: SQLCODE=-964, SQLSTATE=57011, SQLERRMC=null, DRIVER=4.12.55Thread 1065875379 : qlException: DB2 SQL Error: SQLCODE=-964, SQLSTATE=57011, SQLERRMC=null, DRIVER=4.12.55


CAUSE
The DB2 database logs are full and cannot process the request to delete a virtual portal.


ENVIRONMENT
Portal 8000 or newer 

DB2 database


DIAGNOSING THE PROBLEM
Collecting a wpcollector [http://www-01.ibm.com/support/docview.wss?uid=swg21445430] collection is recommended for troubleshooting. The error will show in a WebSphere Portal SystemOut.log. The error itself will not indicate which Portal database domain is experiencing the condition. If you need to determine which Portal database domain is experiencing this condition, enable the following traces: 

*=info:Transaction=all:WAS.j2c=all:RRA=all:com.ibm.workplace.wcm.*=all

And attempt to delete the virtual portal once again. Review the traces for the DB2 error code. Thereafter, search just before the DB2 error code for the SQL statement being executed. As one example, the following statement was observed in a system which experienced this condition:
DELETE FROM JCR.ICMUTMWIDE0 WHERE WSID IN (? , ?) 

The exact SQL statement may vary, however, the key item in the trace statement indicating the Portal database domain is the "JCR" schema being shown in the SQL DELETE statement.


RESOLVING THE PROBLEM
 

On the DB2 server, for each Portal database domain experiencing the condition:

db2 connect to jcrdb user db2admin using password
db2 update db cfg using LOGFILSIZ 20000
db2 update db cfg using LOGPRIMARY 20
db2 update db cfg using LOGSECOND 40 

Thereafter, run a DB2STOP and DB2START command to recycle the database and allow the updated parameters to be enabled. Virtual portal deletion should be successful thereafter.

[/support/docview.wss?uid=swg21676343&aid=1] [/support/docview.wss?uid=swg21676343&aid=1]

RELATED INFORMATION
 Resolving "The transaction log for the database is full [http://www.ibm.com/support/docview.wss?uid=swg21472442 ]