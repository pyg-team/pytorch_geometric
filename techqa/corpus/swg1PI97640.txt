Title: IBM PI97640: OMPROUTE CAN POTENTIALLY MISS SENDING HEARTBEATS AND OSPF HELLOSFOR 30 SECS TO RESULT IN EZZ7968I, EZZ9672E, AND EZZ7921I MSGS - United States

Text:
z/os SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  There is a window of opportunity in OMPROUTE where it can miss
   processing the queued work elements on the main thread tasker
   after blocking the SIGUSR1 signals based on the expired timer
   elements for the 3-second heartbeats and the OSPF hellos based
   on Hello_Interval (default 10 secs) and Dead_Router_Interval
   (default 40 secs) on the timer thread tasker and sleeping for
   30 seconds. The missed processing of the work elements results
   in the problem detection messages EZZ7968I for the missed OSPF
   hellos and EZZ9672E for the missed heartbeats from OMPROUTE in
   TCPIP. In addition, OMPROUTE can issue EZZ7921I to indicate
   OSPF adjacency losses with neighbors.
   
   
    
   
   

LOCAL FIX
 *  If possible, increase Dead_Router_Interval to longer than 30
   secs for all OSPF interfaces in LPARs and neighbors in a OSPF
   area.
   KEYWORDS:
   OMPROUTE EZZ7968I EZZ9672E EZZ7921I SIGUSR1 SIGPROCMASK TSK
   EZAORTSK SLEEP SPM SIGNAL HELLO HEARTBEAT
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All users of the IBM Communications Server for z/OS Version  *
   * 2 Release 1, 2, and 3 IP: Omproute                           *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Omproute timer based activities queue work elements and send *
   * a SIGUSR1 signal to wake up the thread that is supposed to   *
   * process the elements.  A timing window exists where the      *
   * thread responsible for processing the work elements may be   *
   * in a state where the SIGUSR1 signal has no meaningful        *
   * effect.  When this occurs the processing thread may sleep up *
   * to 30 seconds, at which time it will resume processing any   *
   * queued work elements.  When this timing condition occurs the *
   * timer based activities like the hello interval work elements *
   * are not processed and may result in message EZZ7968I.  If    *
   * the dead router interval is less than the 30 second sleep    *
   * time neighbor adjacency may also be lost and result in       *
   * message EZZ7921I.  Omproute also sends a heartbeat on a hard *
   * coded timer interval to the TCPIP stack.  The TCPIP sysplex  *
   * autonomics monitors for this heartbeat and may issue message *
   * EZZ9672E if the heartbeat is delayed.  TCPIP may leave the   *
   * sysplex group for Omproute being unresponsive based on       *
   * missing heartbeats if GLOBALCONFIG SYSPLEXMONITOR RECOVERY   *
   * is configured in the profile.                                *
   *                                                              *
   * EZZ7968I Hello interval missed on interface <interface>      *
   * EZZ7921I OSPF Adjacency Failure, neighbor <neighbor>, old    *
   * state <state>, new state <state>, event <event>              *
   * EZZ9672E <tcpstackname> DETERMINED THAT OMPROUTE WAS NOT     *
   * RESPONSIVE FOR AT LEAST <timevalue> SECONDS                  *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Apply PTF                                                    *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  Omproute has been amended to use a sleep interval of 5 seconds.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI97640
   
   
 * REPORTED COMPONENT NAME
   TCP/IP MVS
   
   
 * REPORTED COMPONENT ID
   5655HAL00
   
   
 * REPORTED RELEASE
   220
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2018-05-04
   
   
 * CLOSED DATE
   2018-06-04
   
   
 * LAST MODIFIED DATE
   2018-06-04
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI56257 UI56258 UI56259
   
   

MODULES/MACROS
 *  EZAORTSK
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   TCP/IP MVS
   
   
 * FIXED COMPONENT ID
   5655HAL00
   
   

APPLICABLE COMPONENT LEVELS