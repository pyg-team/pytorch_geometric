Title: IBM Utility to collect AIX pstat information for a DB2 instance or specific process. - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 There is a method to determine the ulimit values for a running process, which can be prone to errors. The provided script will assist with the collection of the above information in one step. 

CAUSE
There are situations when the ulimit settings for the instance owner are set to certain values but the DB2® instance processes might be running with ulimit limits that do not match the current settings. This can happen when the ulimit limits are set for the instance when the instance is already running, or if the ulimit limits were specifically set in a shell session prior to start the instance. Therefore, we cannot rely on the output of the ulimit -a command as the values can be changed after starting the DB2 instance. So, what can be used to determine the real values?

ANSWER
Using the AIX® pstat command we can use the following procedure to determine the real ulimit values (along with a load of other useful information): 

select any db2 engine process ID, i.e. a db2agent:
1) convert the pid to hex 
2) as root, issue "pstat -a | grep <hex_of_db2agent_pid>"
The first column is the slot number in the process table 
3) as root, issue "pstat -u <slot_number>" The attached script will perform the above steps. It will need to be run as root (as per above steps).  getpstat.ksh [/support/docview.wss?uid=swg21251640&aid=2] [/support/docview.wss?uid=swg21251640&aid=1] 

Saving the above script as getpstat64 will make it use /usr/sbin/pstat64, while saving it as any other name will enable it to use /usr/sbin/pstat 

Alternatively, one can simply save the above script as is and set up symbolic links using commands similar to the following: 

ln -s getpstat.ksh getpstat64 

ln -s getpstat.ksh getpstat 

 

Usage is as follows:



getpstat64 -i db2instance | -p pid

where
-i db2instance is the instance name to get the pstat -u information from.
-p pid of process to get pstat -u output from.
-h print this help message Run the above script by specifying the instance or by specifying the ID of a particular process. 

Here is an example when specifying the instance name: 

/getpstat64 -i db2inst1
getpstat64: 509 for 1fd0c4 (2085060): output is in /tmp/getpstat_509.2085060.out

Here is an example when specifying the process id:
./getpstat64 -p 2085060
getpstat64: 509 for 1fd0c4 (2085060): output is in /tmp/getpstat_509.2085060.out 

This is what the output file looks like: 

getpstat_509.2085060.out [/support/docview.wss?uid=swg21251640&aid=4] [/support/docview.wss?uid=swg21251640&aid=3] 

One can then supply this file to DB2® Support for analysis if required.