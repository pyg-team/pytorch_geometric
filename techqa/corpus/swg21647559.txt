Title: IBM db2haicu fails with an internal error when creating DB2 Partition. - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 

When running DB2 High Availability Instance Configuration Utility (db2haicu) with an XML input file to perform configuration tasks multiple times, such as when you have multiple database partitions to be configured for high availability, it may fail with an internal error when creating DB2 Partition.

$ db2haicu -f ha_cfg.xml
Welcome to the DB2 High Availability Instance Configuration Utility (db2haicu).

You can find detailed diagnostic information in the DB2 server diagnostic log file called db2diag.log. Also, you can use the utility called db2pd to query the status of the cluster domains you create.

For more information about configuring your clustered environment using db2haicu, see the topic called 'DB2 High Availability Instance Configuration Utility (db2haicu)' in the DB2 Information Center.

db2haicu determined the current DB2 database manager instance is db2inst1. The cluster configuration that follows will apply to this instance.

db2haicu is collecting information on your current setup. This step may take some time as db2haicu will need to activate all databases for the instance to discover all paths ...
Creating domain db2HAdomain in the cluster ...
Creating domain db2HAdomain in the cluster was successful.
Configuring quorum device for domain db2HAdomain ...
Configuring quorum device for domain db2HAdomain was successful.
Adding network interface card en2 on cluster node ea_eapp to the network db2_public_network_0 ...
Adding network interface card en2 on cluster node ea_eapp to the network db2_public_network_0 was successful.
Adding network interface card en2 on cluster node oaea1 to the network db2_public_network_0 ...
Adding network interface card en2 on cluster node oaea1 to the network db2_public_network_0 was successful.
Adding DB2 database partition 0 to the cluster ...
There was an error with one of the issued cluster manager commands. Refer to db2diag.log and the DB2 Information Center for details.
There was an internal db2haicu error. Refer to db2diag.log and the DB2 Information Center for details. 


db2diag.log shows below error messages :

2013-08-20-17.14.30.688152+480 E134823A668 LEVEL: Error
PID : 958656 TID : 1 PROC : db2haicu
INSTANCE: db2inst1 NODE : 000
EDUID : 1
FUNCTION: DB2 Common, SQLHA APIs for DB2 HA Infrastructure, sqlhaUICreatePartition, probe:200
RETCODE : ECF=0x90000531=-1879046863=ECF_SQLHA_INVALID_PARAM
Invalid parameter to SQLHA call
MESSAGE : Failed to create Resource Group in creating partition in cluster.
DATA #1 : String, 8 bytes
db2inst1
DATA #2 : String, 0 bytes
Object not dumped: Address: 0x0000000000000000 Size: 0 Reason: Address is NULL 
DATA #3 : signed integer, 4 bytes
0 
DATA #4 : signed integer, 4 bytes
0

2013-08-20-17.14.30.688867+480 E136574A614 LEVEL: Severe
PID : 958656 TID : 1 PROC : db2haicu
INSTANCE: db2inst1 NODE : 000
EDUID : 1
FUNCTION: DB2 Common, SQLHA APIs for DB2 HA Infrastructure, handleEndElement, probe:1450
MESSAGE : Failed to create cluster resources for database partition in cluster
DATA #1 : unsigned integer, 4 bytes
0
DATA #2 : String, 8 bytes
db2inst1
DATA #3 : String, 0 bytes
Object not dumped: Address: 0x0000000000000000 Size: 0 Reason: Address is NULL
DATA #4 : unsigned integer, 4 bytes
0
DATA #5 : Pointer, 8 bytes
0x00000001101cdbd





CAUSE
Currently, the order to DB2PartitionSet and FailoverPolicy is as follows. While db2haicu parses and processes the resource creation in parallel which means, it reads one element and process this resource and then to the next one until the end of the file. However, while creating DB2 Partition, it first needs the FailoverPolicy to determine whether it's a DPF, HADR or shared disk HA solution, thus run into the error we observed.
The configuration file will have below info :

<DB2PartitionSet>
<DB2Partition dbpartitionnum="0" instanceName="db2inst1">
</DB2Partition>
</DB2PartitionSet>

<FailoverPolicy>
<HADRFailover></HADRFailover>
</FailoverPolicy

To fix this issue, change the above part to :

<FailoverPolicy>
<HADRFailover></HADRFailover>
</FailoverPolicy

<DB2PartitionSet>
<DB2Partition dbpartitionnum="0" instanceName="db2inst1">
</DB2Partition>
</DB2PartitionSet>





ANSWER