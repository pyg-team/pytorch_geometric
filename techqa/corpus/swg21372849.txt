Title: IBM WebSphere Portal SystemOut.log J2CA0056I com.ibm.websphere.ce.cm.StaleConnectionException Connection reset - United States

Text:
com.ibm.websphere.ce.cm.StaleConnectionException; connection reset; Purge Policy; purge; policy; EntirePool; entire pool; Minimum Connections; minimum; connections; Unused Timeout; unused; timeout; time out; firewall; data source; connection pool settings; connection pool; connection; pool; settings; staleconnection; stale connection; exception; reset TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This technote describes a solution for IBM WebSphere Portal SystemOut.log entry, "J2CA0056I com.ibm.websphere.ce.cm.StaleConnectionException Connection reset" error. 

SYMPTOM
The WebSphere Portal SystemOut.log shows: 

[datetime] 0000008b ConnectionEve A J2CA0056I: The Connection Manager received a fatal connection error from the Resource Adapter for resource jdbc/customdb. The exception which was received is com.ibm.websphere.ce.cm.StaleConnectionException: [ibm][db2][jcc][t4][2030][11211] A communication error has been detected. Communication protocol being used: TCP/IP.
Communication API being used: SOCKETS. Location where the error was detected: T4Agent.sendRequest().
Communication function detecting the error: OutputStream.flush(). Protocol specific error codes Connection reset, *, 0. Message: Connection reset:com.ibm.db2.jcc.c.DisconnectException: [ibm][db2][jcc][t4][2030][11211] A communication error has been detected. Communication protocol being used: TCP/IP.
Communication API being used: SOCKETS. Location where the error was detected: T4Agent.sendRequest().
Communication function detecting the error: OutputStream.flush(). Protocol specific error codes Connection reset, *, 0. Message: Connection reset:java.net.SocketException: Connection reset

[datetime] 0000008b DataStoreCont E com.ibm.wps.datastore.impl.DataStoreContext handleException EJPDB0001E: Error occurred during database access. Last SQL statement is [SELECT OID, CREATED, MODIFIED, RES_TYPE, EXTERNAL_OID, EXTERNAL_UID, PARENT_OID, OWNER_TYPE, OWNER_UID, INHERITANCE, PROPAGATION, EXTERNALIZED, IS_PRIVATE, NAME, IS_LEAF FROM custom.PROT_RES WHERE (OWNER_UID = ? AND RES_TYPE = ?)].

com.ibm.wps.datastore.domains.DomainUnavailableException: EJPDB0101E: Database domain [Domain: cust] is currently unavailable. 

 * 

... 
Caused by: com.ibm.websphere.ce.cm.StaleConnectionException: [ibm][db2][jcc][t4][2030][11211] A communication error has been detected. Communication protocol being used: TCP/IP. 
Communication API being used: SOCKETS. Location where the error was detected: T4Agent.sendRequest(). 
Communication function detecting the error: OutputStream.flush(). Protocol specific error codes Connection reset, *, 0. Message: Connection reset  * 

... 
Caused by: com.ibm.db2.jcc.c.DisconnectException: [ibm][db2][jcc][t4][2030][11211] A communication error has been detected. Communication protocol being used: TCP/IP. 
Communication API being used: SOCKETS. Location where the error was detected: T4Agent.sendRequest(). 
Communication function detecting the error: OutputStream.flush(). Protocol specific error codes Connection reset, *, 0. Message: Connection reset  * 

... 
---- Begin backtrace for Nested Throwables 
com.ibm.db2.jcc.c.DisconnectException: [ibm][db2][jcc][t4][2030][11211] A communication error has been detected. Communication protocol being used: TCP/IP. 
Communication API being used: SOCKETS. Location where the error was detected: T4Agent.sendRequest(). 
Communication function detecting the error: OutputStream.flush(). Protocol specific error codes Connection reset, *, 0. Message: Connection reset  * 

... 
Caused by: java.net.SocketException: Connection reset  * 

... 
RESOLVING THE PROBLEM
For the correct Data Source connection pool setting, refer to Document #1247168, "Troubleshooting: Connection Pooling (J2C) problems in WebSphere Application Server" [http://www.ibm.com/support/docview.wss?uid=swg21247168] --> "Troubleshooting stale connection problems" section --> Steps 6 - 8 (copied below): 

6. Purge Policy: EntirePool

7. Minimum Connections: 0

8. Set the Unused Timeout to half the value of the timeout setting on the firewall.

RELATED INFORMATION
 WebSphere Application Server Connection pool setting [http://www.ibm.com/support/knowledgecenter/SSAW57_6.1.0/com.ibm.websphere.nd.doc/info/ae/ae/udat_conpoolset.html]
TroubleShooting: Connection Pooling (J2C) problems [http://www.ibm.com/support/docview.wss?uid=swg21247168]