Title: IBM Connections: Filtering search results by person not working - United States

Text:
Search; Person; Filtering TECHNOTE (TROUBLESHOOTING)

PROBLEM
In IBM Connections a user performs a search and is presented with a list of results. It is then possible to filter these results by clicking on a person's name. The results are then reduced to just display the documents authored by a particular user. However, in some cases, this does not work. How to resolve this issue?

SYMPTOM
STEPS TO REPRODUCE:
1. In IBM Connections web UI, user performs a "All Content" search for a term. 
2. In Search results, user clicks on a person's name in order to filter the search results to only include documents by that person. 

In some cases, the results are as expected. 
However, for some files, clicking on the person's name results in no files being returned. 


CAUSE
Filtering by person does not work for ACTIVE users that are missing their email address in the PERSON table in the HOMEPAGE database. 
Below is an example row for a user for whom this issue would occur:

[/support/docview.wss?uid=swg21994019&aid=1] [/support/docview.wss?uid=swg21994019&aid=1]

Note that the STATE value is 0, which means that the user is active.
In IBM Connections membership tables (like HOMEPAGE.PERSON), if the STATE column value is 1, the user is inactive. For inactive users, it is normal for their rows to have empty values for the USER_MAIL and USER_MAIL_LOWER columns.
For active users however, they should always have their email values populated.



DIAGNOSING THE PROBLEM
For Search server, enable the following runtime trace and reproduce the issue: 

*=info: com.ibm.connections.search.*=all

In the trace.log for the Search application, the NULL email of the User in Homepage DB can be seen as the cause for the issue:
[11/4/16 14:38:26:080 CET] 000001c4 CacheHelper > com.ibm.connections.search.index.searching.session.CacheHelper updateLookupMap(person) ENTRY com.ibm.lconn.hpnews.data.model.PersonWithLoginNames@edaa899a[
loginNames=[com.ibm.lconn.hpnews.data.model.LoginName@eae570ed[
id=a9bf5e16-542a-4d4f-8b9b-2ee838ed525d
loginName=a8010918
rawLoginName=a8010918
TABLENAME=<null>
dbVendor=<null>
organizationId=<null>
]]
personId=a9bf5e16-542a-4d4f-8b9b-2ee838ed525d
displayName=Joe Bloggs
exId=8878D8C5-B3D3-4C37-8929-785F3542AF1A
userMail=<null>
userMailLower=<null>
displaynameLower=joe bloggs
state=ACTIVE
lastUpdate=Tue Jun 07 10:48:01 CEST 2016
profType=<null>
creationDate=Mon Jun 06 18:15:01 CEST 2016
themeId=<null>
memberType=PERSON
commVisibility=PRIVATE
communityInternalOnly=false
prefLang=<null>
isExternal=false
optedIntoSand=true
sandLastUpdate=Tue Jun 07 10:48:01 CEST 2016
homeOrgId=00000000-0000-0000-0000-000000000000
TABLENAME=<null>
dbVendor=<null>
organizationId=00000000-0000-0000-0000-000000000000
] null
[11/4/16 14:38:26:080 CET] 000001c4 CacheHelper 2 com.ibm.connections.search.index.searching.session.CacheHelper updateLookupMap(person) attributeToCacheBy: com.ibm.connections.search.index.searching.session.PersonInternalIdGetter
[11/4/16 14:38:26:080 CET] 000001c4 CacheHelper 2 com.ibm.connections.search.index.searching.session.CacheHelper updateLookupMap(person) attributeToCacheBy: com.ibm.connections.search.index.searching.session.PersonExternalIdGetter
[11/4/16 14:38:26:080 CET] 000001c4 CacheHelper 2 com.ibm.connections.search.index.searching.session.CacheHelper updateLookupMap(person) attributeToCacheBy: com.ibm.connections.search.index.searching.session.PersonEmailGetter
[11/4/16 14:38:26:080 CET] 000001c4 CacheHelper 2 com.ibm.connections.search.index.searching.session.CacheHelper updateLookupMap(person) key is null

NULL email causes the Search to not cache the User and run Search query with User External ID instead of the Internal ID that is stored in the index.

Search by User External ID will not get any results.


RESOLVING THE PROBLEM
Run NewsMemberService.syncAllMembersByExtId() to sync updated user profiles data to HOMEPAGE.PERSON table thereby resulting in the user's mail values being populated correctly. 


More information on running this wsadmin command can be found here:
http://www.ibm.com/support/knowledgecenter/SSYGQH_5.5.0/admin/admin/c_admin_common_sync_via_admin_commands1.html [http://www.ibm.com/support/knowledgecenter/SSYGQH_5.5.0/admin/admin/c_admin_common_sync_via_admin_commands1.html]

However, syncAllMembersByExtId synchs only the Users that have logged in (i.e Users have a login row populated in HOMEPAGE.LOGINNAME table also).

So the only alternative in that instance is to get emails of all Active Users from Profiles and then run
ProfilesService.publishUserData(String user_email_addr) 

More information on that command can be found here:
http://www.ibm.com/support/knowledgecenter/SSYGQH_5.5.0/admin/admin/t_admin_profiles_manage_users.html [http://www.ibm.com/support/knowledgecenter/SSYGQH_5.5.0/admin/admin/t_admin_profiles_manage_users.html]