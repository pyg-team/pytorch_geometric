Title: IBM PM11411: MDB LISTENERS FAIL WITH REASON '2500'( MQRC_HCONN_ASYNC_ACTIVE) AFTER MIGRATING TO MQ V701 - United States

Text:
z/os SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS DUPLICATE OF ANOTHER APAR.
    
   
   

ERROR DESCRIPTION
 *  MDB listeners fail with reason '2500'(MQRC_HCONN_ASYNC_ACTIVE)
   after migration to MQ V701.
   .
   The following information is found in the WAS Control
   Region joblog.
   .
   com.ibm.ejs.jms.listener.MDBCppUtilitiesInterfaceImpl.startListe
   ning(MDBCppUtilitiesInterfaceImpl.java:505)
   at
   com.ibm.ws390.mdb.MDBCppUtilities.startListening(MDBCppUtilities
   .java:190)
   Caused by: com.ibm.mq.MQException: JMSCMQ0001: WebSphere MQ call
   failed with compcode '2' ('MQCC_FAILED') reason '2500'
   ('MQRC_HCONN_ASYNC_ACTIVE').
   .
   .
   The problem is caused by the way the MQ code determines
   which enviornment it is running in.  For WAS V6, we do not
   correctly identify that the code is running in the WAS Control
   Region.  This causes us to use the wrong threading model for
   the MDB listeners.  The model is incompatible with the async
   consume processing used by the listeners, and results in thread
   reuse problems when MDB listeners are active.  The bad thread
   reuse causes the failure with the 2500 reason code.
   
   
    
   
   

LOCAL FIX
 *  ++APARs are available:
     ++APAR ANE4673, built on the Fix Pack 7.0.1.1 (UK53422) level
     ++APAR ANE5625, built on the Fix Pack 7.0.1.2 (UK56957) level
   -OR-
   In WebSphere Application Server V6, the system property can be
   set using the Admin console:
   Servers->Application Servers (from the left hand menu) then
   select:
   <server name>->Java and Process Management->Process
   Definition->Servant->Java Virtual Machine->CustomProperties->New
   Name=com.ibm.msg.client.wmq.overrideProviderVersion
   Value=6
   .
   
   The same property should be set in the control region using:
   <server name>->Java and Process Management->Process
   Definition->Control->Java Virtual Machine->CustomProperties->New
   Name=com.ibm.msg.client.wmq.overrideProviderVersion
   Value=6
   
   
    
   
   

PROBLEM SUMMARY

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS
 *  Problem summary:
   In WebSphere Application Server Version 6, an MDB listener is
   configured to monitor a queue, or a topic with a durable
   subscription.
   
   If the MDB listener is using a bindings mode connection to the
   queue manager, it incorrectly performs asynchronous message
   consumption on the WebSphere thread that started the listener.
   
   This causes subsequent JMS work on the same WebSphere thread to
   fail with compcode 2 and rsncode 2500 (MQRC_HCONN_ASYNC_ACTIVE).
   
   Exceptions similar to the following are seen in the control
   region:
   
   com.ibm.mq.MQException: JMSCMQ0001: WebSphere MQ call
      failed with compcode '2' ('MQCC_FAILED') reason '2500'
      ('MQRC_HCONN_ASYNC_ACTIVE').
   .at com.ibm.msg.client.wmq.common.internal.Reason.
                         createException(Reason.java:223)
   
   Problem resolution:
   The MQ JMS code has been updated so that MDB listeners running
   in the control region use a separate thread for asynchronous
   message consumption.
   
   This fix changes the Java component of MQ, and will be
   included in FixPack 7.0.1.3 (PM09662 [http://www-01.ibm.com/support/docview.wss?uid=swg1PM09662]).
   
   
    
   
   

APAR INFORMATION
 * APAR NUMBER
   PM11411
   
   
 * REPORTED COMPONENT NAME
   WMQ Z/OS V7
   
   
 * REPORTED COMPONENT ID
   5655R3600
   
   
 * REPORTED RELEASE
   018
   
   
 * STATUS
   CLOSED DUB
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-04-01
   
   
 * CLOSED DATE
   2010-05-27
   
   
 * LAST MODIFIED DATE
   2010-08-24
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS