Title: IBM PK50613: J2CA0081E WITH DSRA0080E INVALID TRANSACTION STATE WITH SQLSTATE:25000 WHEN STOPPING AN APPLICATION - United States

Text:
  FIXES ARE AVAILABLE
Java SDK 1.5 SR8 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24020073]
Java SDK 1.5 SR8 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24021203]
Java SDK 1.5 SR10 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24024201]
6.1.0.31: Java SDK 1.5 SR11 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24026453]
6.1.0.33: Java SDK 1.5 SR12 FP1 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24027786]
6.1.0.29: Java SDK 1.5 SR11 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24025191]
6.1.0.35: Java SDK 1.5 SR12 FP2 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24028574]
6.1.0.37: Java SDK 1.5 SR12 FP3 Cumulative Fix for WebSphere [http://www-01.ibm.com/support/docview.wss?uid=swg24029525]
6.1.0.39: Java SDK 1.5 SR12 FP4 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24030426]
6.1.0.41: Java SDK 1.5 SR12 FP5 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24031035]
6.1.0.43: Java SDK 1.5 SR13 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24031963]
6.1.0.45: Java SDK 1.5 SR14 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24033270]
6.1.0.47: WebSphere Application Server V6.1 Fix Pack 47 [http://www-01.ibm.com/support/docview.wss?uid=swg24035508]
6.1.0.47: Java SDK 1.5 SR16 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24035649]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Problem Description:
   
   This problem will occur when stoping an application  without
   stoping the entire Websphere application server instance. The
   application server will attempt to shutdown all connection
   pools.
   
   The expected behavior is just to shutdown connection pools
   associated with any embedded resource adapters with in the
   application. As a result of the application server attempting
   to shut down all connection pools the message below can be
   observed, because in use connection are being destoryed when
   they should not be.
   
   
   [8/2/07 14:49:01:242 IST] 0000002a PoolManager   3   Destroying
   sharable, in-use connections
   [8/2/07 14:49:01:242 IST] 0000002a MCWrapper     >  destroy
   Entry
   [8/2/07 14:49:01:242 IST] 0000002a MCWrapper     W   J2CA0088W:
   The ManagedConnection that is being destroyed from resource
   jdbc/oms-xa-data-source is in an invalid state STATE_INACTIVE.
   Processing will continue.
   [8/2/07 14:49:01:383 IST] 0000002a ServiceLogger I
   com.ibm.ws.ffdc.IncidentStreamImpl initialize FFDC0009I: FFDC
   opened incident stream file C:\Program
   Files\IBM29304\WebSphere\AppServer\profiles\pfs_29304\logs\ffdc\
   pfs_29304_server_51a051a0_07.08.02_14.49.01_0.txt
   [8/2/07 14:49:01:430 IST] 0000002a ServiceLogger I
   com.ibm.ws.ffdc.IncidentStreamImpl resetIncidentStream
   FFDC0010I: FFDC closed incident stream file C:\Program
   Files\IBM29304\WebSphere\AppServer\profiles\pfs_29304\logs\ffdc\
   pfs_29304_server_51a051a0_07.08.02_14.49.01_0.txt
   [8/2/07 14:49:01:430 IST] 0000002a MCWrapper     E   J2CA0081E:
   Method destroy failed while trying to execute method
   removeConnectionEventListener on ManagedConnection <null> from
   resource jdbc/oms-xa-data-source. Caught exception:
   java.lang.NullPointerException
    at com.ibm.ejs.j2c.MCWrapper.destroy(MCWrapper.java:1693)
    at
   com.ibm.ejs.j2c.PoolManager.serverShutDown(PoolManager.java:1371
   )
    at
   com.ibm.ejs.j2c.ConnectionServerShutDownFactoryImpl.shutdown(Con
   nectionServerShutDownFactoryImpl.java:89)
    at
   com.ibm.ejs.j2c.RALifeCycleManagerImpl.shutdown(RALifeCycleManag
   erImpl.java:1246)
    at
   com.ibm.ejs.j2c.RALifeCycleManagerImpl.stop(RALifeCycleManagerIm
   pl.java:741)
    at
   com.ibm.ws.runtime.component.ApplicationMgrImpl.stop(Application
   MgrImpl.java:1335)
    at
   com.ibm.ws.runtime.component.DeployedApplicationImpl.fireDeploye
   dObjectStop(DeployedApplicationImpl.java:1134)
    at
   com.ibm.ws.runtime.component.DeployedModuleImpl.stop(DeployedMod
   uleImpl.java:602)
    at
   com.ibm.ws.runtime.component.DeployedApplicationImpl.stop(Deploy
   edApplicationImpl.java:882)
    at
   com.ibm.ws.runtime.component.ApplicationMgrImpl.stopApplication(
   ApplicationMgrImpl.java:1117)
    at
   com.ibm.ws.runtime.component.ApplicationMgrImpl$2.run(Applicatio
   nMgrImpl.java:1593)
    at
   com.ibm.ws.security.auth.ContextManagerImpl.runAs(ContextManager
   Impl.java:3899)
    at
   com.ibm.ws.security.auth.ContextManagerImpl.runAsSystem(ContextM
   anagerImpl.java:3976)
    at
   com.ibm.ws.security.core.SecurityContext.runAsSystem(SecurityCon
   text.java:245)
    at
   com.ibm.ws.runtime.component.ApplicationMgrImpl.stopApplication(
   ApplicationMgrImpl.java:1599)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at
   sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessor
   Impl.java:64)
    at
   sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethod
   AccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:615)
    at sun.reflect.misc.Trampoline.invoke(MethodUtil.java:62)
   
   
   
    This problem is only present if 6.1 and forward version of
   Websphere Application Server
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: Users of IBM Websphere Application Server    *
   *                 version 6.1 or greater who use J2C           *
   ****************************************************************
   * PROBLEM DESCRIPTION: Stopping an applicaton destroys all     *
   *                      connection pools                        *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   This problem will occur when stoping an application without
   stoping the entire Websphere application server instance. The
   application server will attempt to shutdown all connection
   pools.
   
   The expected behavior is just to shutdown connection pools
   associated with any embedded resource adapters with in the
   application. As a result of the application server attempting
   to shut down all connection pools the message below can be
   observed, because in-use connections are being destoryed when
   they should not be.
   
   
   [8/2/07 14:49:01:242 IST] 0000002a PoolManager   3   Destroying
   sharable, in-use connections
   [8/2/07 14:49:01:242 IST] 0000002a MCWrapper     >  destroy
   Entry
   [8/2/07 14:49:01:242 IST] 0000002a MCWrapper     W   J2CA0088W:
   The ManagedConnection that is being destroyed from resource
   jdbc/oms-xa-data-source is in an invalid state STATE_INACTIVE.
   Processing will continue.
   
   iles\IBM29304\WebSphere\AppServer\profiles\pfs_29304\logs\ffdc\
   pfs_29304_server_51a051a0_07.08.02_14.49.01_0.txt
   [8/2/07 14:49:01:430 IST] 0000002a MCWrapper     E   J2CA0081E:
   Method destroy failed while trying to execute method
   removeConnectionEventListener on ManagedConnection <null> from
   resource jdbc/oms-xa-data-source. Caught exception:
   java.lang.NullPointerException
   at com.ibm.ejs.j2c.MCWrapper.destroy(MCWrapper.java:1693)
   at
   com.ibm.ejs.j2c.PoolManager.serverShutDown(PoolManager.java:1371
   
   )
   at
   com.ibm.ejs.j2c.ConnectionServerShutDownFactoryImpl.shutdown(Con
   
   nectionServerShutDownFactoryImpl.java:89)
   
   
    
   
   

PROBLEM CONCLUSION
 *  J2C code was changed so that when an applicaiton stops only
   the connection pools that belong to any embedded Resource
   Adapters will be destroyed.
   
   All other connection pools are destroyed on Applicaiton Server
   shut down.
   
   The fix for this APAR is currently targeted for inclusion
   in fixpack 6.1.0.13.
   Please refer to the recommended updates page for delivery
   information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK50613
   
   
 * REPORTED COMPONENT NAME
   WEBS APP SERV N
   
   
 * REPORTED COMPONENT ID
   5724H8800
   
   
 * REPORTED RELEASE
   61W
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-08-07
   
   
 * CLOSED DATE
   2007-09-28
   
   
 * LAST MODIFIED DATE
   2007-09-28
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  J2C
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBS APP SERV N
   
   
 * FIXED COMPONENT ID
   5724H8800
   
   

APPLICABLE COMPONENT LEVELS
 * R61A PSY
   UP
   
   
 * R61H PSY
   UP
   
   
 * R61I PSY
   UP
   
   
 * R61P PSY
   UP
   
   
 * R61S PSY
   UP
   
   
 * R61W PSY
   UP
   
   
 * R61Z PSY
   UP