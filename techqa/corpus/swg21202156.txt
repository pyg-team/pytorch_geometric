Title: IBM Debugging a 404 Error from the On-Demand Router (ODR) - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Your Web browser throws a 404 "File not found" error when trying to reach a Web page. When reviewing the local.log for the ODR server located in install_root/logs/<ODR> directory, you see the following error:

<ip address> - - [02/Nov/2004:21:42:40 -0500] "GET /FinancialAdvice/CpuAndSleepBound HTTP/1.1" 404 0

Note: The following is the Web page that you were trying to reach:
http://<hostname/ip address>:83/FinancialAdvice/CpuAndSleepBound 

CAUSE
The reason for the 404 error can be determined by recreating and tracing the ODR server and application server.
Tracing the application server using the following trace string:



Servlet_Engine=all=enabled 
Tracing the ODR server using the following trace string: 

com.ibm.ws.proxy.*=all=enabled 
The following outlines two scenarios causing the 404 error:  * Scenario 1 - User Error
   This scenario reviews a common problem where the user types an invalid URL for their application. Reviewing the ODR server trace.log we can see the request arrive and the error message returned from the application server:
   
   [11/2/04 20:46:47:297 EST] 67f1de90 HttpProxyServ < requestArrived - Received request; method=GET uri=/FinancialAdvice/CpuAndSleepBound service context=HttpProxyServiceContextImpl@4fb0de9d connection link=HttpProxyConnectionLink@3c415e9d
   ...
   [11/2/04 20:46:47:906 EST] 4f655e93 HttpProxyServ < responseArrived
   [11/2/04 20:46:47:906 EST] 4f655e93 HttpProxyConn d Status code=Status code: 404 response body allowed; service context=HttpProxyServiceContextImpl@4fb0de9d, connection link=HttpProxyConnectionLink@3c415e9d
   Reviewing the application server trace.log we can see the message arrive and the error message returned:
   [11/2/04 20:46:47:359 EST] 12d9f3a ServletReques > dispatchByURI
   /FinancialAdvice/CpuAndSleepBound
   ...
   [11/2/04 20:46:47:875 EST] 12d9f3a WebApp d Exception message=File not found: /CpuAndSleepBound 
   
 * Scenario 2 - ODR Configuration
   This scenario reviews an ODR server configuration problem where an ODR server proxy port is not mapped to the appropriate virtual host. Reviewing the ODR server trace.log we can see the request arrive and then a 404 error because the ODR cannot properly map the request to an enterprise application:
   
   [11/2/04 21:42:40:156 EST] 6982e513 HttpProxyServ < requestArrived - Received request; method=GET uri=/FinancialAdvice/CpuAndSleepBound service context=HttpProxyServiceContextImpl@5d426517 connection link=HttpProxyConnectionLink@5cd52517
   ...
   [11/2/04 21:42:40:156 EST] 6982e513 MapRequestFil d failed to map request to application: com.ibm.ws.http.channel.impl.HttpRequestMessageImpl@4a56515
   ...
   [11/2/04 21:42:40:172 EST] 6982e513 HttpFilterCha d Filter=HTTP Mapper generated error status code=Status code: 404 for service context=HttpProxyServiceContextImpl@5d426517. Generating error response and breaking request chaining. 


RESOLVING THE PROBLEM
The following are the two solutions to the preceding scenarios. 

 * Scenario 1 - User Error Solution
   Review the EAR file to determine the correct urls and if the url used above is valid. From the application.xml you can find the context root for the Web modules. Find the Web module, FinancialAdvice.war, that corresponds to the FinancialAdvice context root, shown below:
   
   <web-uri>FinancialAdvice.war</web-uri>
   <context-root>/FinancialAdvice</context-root> 
   From the web.xml file for the FinancialAdvice.war we can find all valid url patterns for the application. You should find the following if this was a valid URL: 
   <url-pattern>/CpuAndSleepBound</url-pattern> 
   But for this scenario, you would not find the preceeding xml entry in the web.xml because the Web page URL was invalid. 
   
 * Scenario 2 - ODR Configuration Solution
   The proxy port setting for the ODR is not mapped to the appropriate virtual host group. This can be done using the administrative console:  1. Find the ODR proxy http  1. Expand the Servers topology 
        2. Select the On Demand Routers entry. 
        3. Under Additional Properties select the End Points. 
        4. Select the PROXY_HTTP_ADDRESS entry to find the ODR host/port settings
           
           
       
       
    2. Add a new alias for the ODR proxy http port in the interested virtual host group:  1. Expand the Environment topology. 
        2. Choose the Virtual Hosts entry. 
        3. Choose appropriate virtual host group (for example: "default_host") 
        4. Under Additional Properties select the Host Aliases. 
        5. Click New to create a new alias 
        6. Fill out the correct host/port entry (for example: the ODR proxy http port information). 
        7. Click OK. 
        8. Save and synchronize the change.
           
           
       
       
    3. Recycle the ODR and application servers to pick up the new virtual host alias. The configuration information can be seen below. From the serverindex.xml file you can find the http proxy address used by the ODR. This port was used in the url by the user to hit the ODR so it can route the request to the running server.
       
       <specialEndpoints xmi:id="NamedEndPoint_#" endPointName="PROXY_HTTP_ADDRESS">
       <endPoint xmi:id="EndPoint_#" host="<hostname/ip address>" port="83"/>
       </specialEndpoints> 
       Review the web module information to determine the virtual host mapping located in the ibm-web-bnb.xmi file, search for "virtualHostName" entry. This mapping will show the actual virtual host requiring the http proxy port alias. For this example we will assume it is the "default_host" group.
       
       The virtualhost.xml file will show the list of port aliases for the interested virtual host group where we should find under the interested virtual host the ODR proxy http port, port 83 for this example. 
       <host:VirtualHost xmi:id="VirtualHost_#" name="default_host">
       ...
       <aliases xmi:id="HostAlias_#" hostname="*" port="83"/>
       </host:VirtualHost> 
       Note: If the port is 80, then the following entry in the virtualhost.xml file will show the following: 
       <aliases xmi:id="HostAlias_#" hostname="*"/>