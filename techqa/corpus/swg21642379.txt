Title: IBM WebSphere DataPower and ITCAM SOA - WSM agent pending records for one way services - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 If metrics for DataPower transactions are not reaching ITCAM for SOA, it may be because the DataPower transactions are creating Web Services Management (WSM) Pending records that are never updated to status "Complete". Only WSM records with "Complete" status are ready for ITCAM SOA data collection. 

SYMPTOM
For each transaction sent to a DataPower Web Service Proxy (WSP) or Multi-Protocol Gateway (MPGW) service, when WSM processing is enabled, the WSM agent status should show an increment in the Complete record count. If instead, the Pending record count increases, metrics for that WSP or MPGW service may not be reaching ITCAM for SOA. 

Please see information in the additional resources section below for more information on the DataPower WSM agent status.

CAUSE
As described in the additional resources provided at the bottom of this document, a WSM pending record is a transaction for which the request, but not the response, has completed WSM processing. A WSM complete record is a record where both the request and matching response have completed; a complete record is ready for data collection. 

If a service creates a pending record each time it processes a transaction successfully, the service may be processing only requests and not responses. The associated WSM processing is still configured to wait for a response, and so a pending record, that is never updated to status Complete, is created when the service processes a transaction.



ENVIRONMENT
A Web Service Proxy or Multi-Protocol Gateway processing policy may be configured to process only requests and not responses by including a Set Variable action to skip backside processing on the request rule. 

The service/mpgw/skip-backside variable specifies that there is no response processing; that is, the service is a fire-and-forget, one-way, datagram, or loop-back type service. The service sends a request to a backend and does not expect a response. 


DIAGNOSING THE PROBLEM
Review the processing policy's request rules and look for a Set Variable action [/support/docview.wss?uid=swg21642379&amp;aid=1]. 

[/support/docview.wss?uid=swg21642379&aid=2] [/support/docview.wss?uid=swg21642379&aid=2]


Double-click on the Set Variable action and look for variable name service/mpgw/skip-backside. 


Review the log for the transaction and confirm that pending records are being created for successful transactions. If the transactions are failing, the issue may be associated with lack of an error rule as described in the additional resources below.


RESOLVING THE PROBLEM
Each transaction's WSM record contains an element is-one-way that is true if the current transaction is not expecting a response. By default, the is-one-way flag is off, to indicate that the WSP or MPGW service is two-way, processing both a request and response. 

To indicate a transaction is one-way, a stylesheet must be added to the service's processing policy to modify the current transaction's WSM record. The dp:wsm-agent-append() extension function can be used in the stylesheet to override the WSM record automatically created for the service and update the is-one-way element with a value of true.

Sample stylesheet SubmitMonitoringData.xsl which is available on DeveloperWorks contains the is-one-way element and the dp:wsm-agent-append() extension function call. 

 * Download the sample stylesheets from the link in additional resources below. 
 * Modify SubmitMonitoringData.xsl. Change:
   
   <dpwsm:is-one-way default='yes'/>
   
   to:
   
   <dpwsm:is-one-way>1</dpwsm:is-one-way> 
 * Use the DataPower File Management page to upload SubmitMonitoringData.xsl to the local: folder on the appliance. 
 * Add a new Transform action to the Web Service Proxy or Multi-Protocol Gateway service's processing policy, just prior to the Result action at the end of the request rule. 
 * Double-click on the Transform action to update it. Choose SubmitMonitoringData.xsl as the stylesheet associated with the Transform action. 
 * Carefully review the input and output contexts of the actions prior to, and after, the new Transform action just added, to be sure that the Result action sends the intended output to to the backend system. 
 * Save the changes. 
 * Test another transaction and confirm that a complete record, rather than a pending record, is created for the transaction.

RELATED INFORMATION
#WSM agent pending records [http://www.ibm.com/support/docview.wss?uid=swg21568404]
Sample stylesheets [https://www.ibm.com/developerworks/community/wikis/home?lang=en#/wiki/Tivoli%20Composite%20Application%20Manager/page/ITCAM%20for%20SOA%20Sample%20Stylesheets%20for%20DataPower%20MPGW%20Services]
DataPower WSM agent status [http://www.ibm.com/support/docview.wss?uid=swg21474592]