Title: IBM IZ08457: AT RESYNCHRONISATION, THE GATEWAY SHOULD IGNORE EXISTING HEALTH CHECK EVENTS IN THE OBJECT SERVER . ONLY 'FRESH' HEALTH CHECK - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  At resynchronisation, the gateway should ignore existing Health
   Check events in the Object Server . Only 'fresh' Health Check
   events received over the IDUC channel.should have an effect.
   
   
    
   
   

LOCAL FIX
 *  -
   
   The periodic resynchronisation is really there for historical
   reasons, and can be disabled by setting the SyncCheckPeriod
   field of the config.defaults table in the NcoGateSchema conf
   
   -
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: ALL                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION: The gateway resyncing thread            *
   *                      periodically checks the set of events   *
   *                      in amos and the Object Server.          *
   *                                                              *
   *                      The relevant set of events is: all      *
   *                      events matching the filter in the       *
   *                      gateway nco2ncp table  for the domain   *
   *                      that is currently acting primary; only  *
   *                      health check events for the backup      *
   *                      domain. If amos has no events, the      *
   *                      gateway assumes that it has just        *
   *                      started, and triggers a resync.         *
   *                                                              *
   *                      But: (a) events are only passed to the  *
   *                      backup Amos when it becomes primary (in *
   *                      addition to the periodic resyncing,     *
   *                      there is a resync at startup and at     *
   *                      failover) so the assumption is invalid  *
   *                      for the backup domain while it is not   *
   *                      acting primary (b) the health check     *
   *                      events are incorrectly picked up during *
   *                      resync. (Because of the possibility of  *
   *                      mismatching system clocks on the        *
   *                      primary and backup domain servers, the  *
   *                      timestamp of the event  in the          *
   *                      state.domains table is always the local *
   *                      timestamp of when the event is          *
   *                      received, so we ignore the fact that    *
   *                      the health check events are old).       *
   *                                                              *
   *                      So the state.domains table is           *
   *                      incorrectly updated for the remote      *
   *                      domain by the old health check events   *
   *                      retrieved during resynchronisation.     *
   ****************************************************************
   * RECOMMENDATION: none                                         *
   ****************************************************************
   2 possible symptoms:
   
   (1) Failover takes longer than expected to occur.
   
   (2) The ncp_virtualdomain state.domains table is updated with
   'health check okay' status and incorrect timestamps for the
   remote domain. This can happen even when the remote domain is
   completely down.
   
   
    
   
   

PROBLEM CONCLUSION
 *  We now ensure that only 'fresh' health check events, received
   from the Object Server over the IDUC channel, are used.
   
   During any resync, existing health check events are ignored.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ08457
   
   
 * REPORTED COMPONENT NAME
   NC/PREC TPL SV
   
   
 * REPORTED COMPONENT ID
   5724O6000
   
   
 * REPORTED RELEASE
   350
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-11-09
   
   
 * CLOSED DATE
   2007-11-21
   
   
 * LAST MODIFIED DATE
   2007-11-21
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *     NETCOOL
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   NC/PREC TPL SV
   
   
 * FIXED COMPONENT ID
   5724O6000
   
   

APPLICABLE COMPONENT LEVELS
 * R350 PSY
   UP