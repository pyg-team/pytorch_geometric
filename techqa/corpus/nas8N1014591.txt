Title: IBM Varying on a Line Description and Starting a TCP/IP Interface - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 It is common to have difficulty varying on a line description or starting a TCP/IP interface. This document provides information about varying on a line description and starting a TCP/IP interface. 

RESOLVING THE PROBLEM
It is a common problem to have difficulty varying on a line description or starting a TCP/IP interface. This problem most often occurs on new system or configurations, but it also occurs after some type of power failure or network failure. The most important thing to understand regarding these issues is the hierarchy of communication devices and what relies on what. 

TCP/IP Interface
Line Description
Adapter
Network

This is a very simplified version of the OSI model used for this document. 

o Starting the TCP/IP interface is dependent upon an active line description. o Varying on the line description is dependent upon an operational resource. o Varying on the line description is also dependent upon the adapter's ability to detect the network at the speed you have specified in the line description. The above points are what should drive your problem determination on these types of issues. The resolution to the issue is almost always found by completely understanding these key points. 

Starting the TCP/IP Interface 

It is a common scenario to have difficulty starting the TCP/IP interface (the TCP/IP address of the IBM System i products). If users are unable to connect or cannot PING the System i's TCP/IP address, then the status of the interface is important to know. Type CFGTCP and select Option 1 from the menu. You will see a screen similar to the following: 

Work with TCP/IP Interfaces

Type options, press Enter.
1=Add 2=Change 4=Remove 5=Display 9=Start 10=End

Internet Subnet Line Line
Opt Address Mask Description Type


1.2.3.12 255.255.255.192 SITEETH *ELAN 
1.2.3.12 is the System i interface. Press F11 to show the status of the interface. 

Work with TCP/IP Interfaces

Type options, press Enter.
1=Add 2=Change 4=Remove 5=Display 9=Start 10=End

Internet Subnet Interface
Opt Address Mask Status 


1.2.3.12 255.255.255.192 Inactive 
This shows us that the interface or address of the System i is inactive. No one is going to make any TCP/IP connection to this interface while it is in this state. Other common states for the interface during times of trouble is RCY PND or FAILED. Anything other than ACTIVE is going to result in failed TCP/IP connections to or from the system. You can try to select Option 10 to end the interface followed by an Option 9 to start. The interface might go to ACTIVE and at that point the issue is probably resolved. In most cases, there is an underlying problem that caused the interface not to go ACTIVE. Before performing further problem determination it is best to end the TCP/IP interface so that it is in an INACTIVE status rather than FAILED. At this point we must to look at our hierarchy again. What is the TCP/IP interface dependent upon? The line description. 

Varying on the Line Description 

Type CFGTCP and select Option 1. It shows us the TCP/IP interfaces on the System i and the Line Description that they are associated with. In our example from above, the Line Description is SITEETH. If the TCP/IP interface will not start, determine the status of the Line Description that it is dependent upon. Type the following: 

WRKLIND SITEETH 

Work with Line Descriptions 
System: YOURSYSTEM
Position to . . . . . Starting characters

Type options, press Enter. 
2=Change 3=Copy 4=Delete 5=Display 6=Print 7=Rename 
8=Work with status 9=Retrieve source 

Opt Line Type Text
SITEETH *ELAN SITE ETHERNET SEGMENT 711 
Select Option 8 to work with the status. You will see a screen similar to the following: 

Work with Configuration Status
12/20/06
Position to . . . . . Starting characters 

Type options, press Enter.
1=Vary on 2=Vary off 5=Work with job 8=Work with description
9=Display mode status 13=Work with APPN status...

Opt Description Status -------------Job-------
SITEETH FAILED 
At this point, select Option 2 to vary off the line description. The line description will go to a VARIED OFF status. You can then select Option 1 to VARY ON the line, but most likely it will fail again if the reason or problem that caused it to fail the first time still exists. 

There is one and only one reason a line description will not vary on. The line can not detect the network. Once again, the line can not detect the network. 

Now, type WRKLIND SITEETH and select Option 5 to display. 

Display Line Description 

Line description . . . . . . . . . : SITEETH 
Option . . . . . . . . . . . . . . : *BASIC
Category of line . . . . . . . . . : *ELAN

Resource name . . . . . . . . . . : CMN07
Online at IPL . . . . . . . . . . : *YES
Vary on wait . . . . . . . . . . . : *NOWAIT
Network controller . . . . . . . . : SITEENET
Local adapter address . . . . . . : 00609439438A
Exchange identifier . . . . . . . : 056D7D0F
Ethernet standard . . . . . . . . : *ALL
Line speed . . . . . . . . . . . . : *AUTO
Current line speed . . . . . . . . : 100M
Duplex . . . . . . . . . . . . . . : *AUTO
Current duplex . . . . . . . . . . : *FULL
Maximum frame size . . . . . . . . : 1496 
When creating a line description there are very few parameters that you must to change or be concerned with: 

Resource name ........................CMN07 

If this is an existing configuration that has been up and working, then we can probably assume that this is correct. But we must verify that this resource truly is an Ethernet port and that it is operational. Refer back to the hierarchy. The line is dependent upon the adapter being operational. Type the following: 

WRKHDWRSC *CMN 

CMB05 2844 Operational Combined function IOP
LIN05 2849 Operational LAN Adapter
CMN07 2849 Operational Ethernet Port 
This shows me that CMN07 is a 2849 Ethernet port and it is Operational. At this point, the Product Activity Log (which is accessed through STRSST) can be examined for any errors against the communications resource that you are using. Typically, anything posted in the Product Activity Log is also posted in QHST or QSYSOPR. At this point, I am satisfied that the Ethernet port, card, and IOP on the System i are fine. This is most likely not a System i hardware issue. 

At this point, everything for this Ethernet IOA on the System i is good. 

Select Option 7 to display the resource detail on CMN07: 

Physical location:
Frame ID 4
Card position C08 
It shows that this card is in position C08. Verify that the Ethernet cable is actually plugged into this adapter on the back of the System i. This would be a likely reason why the System i can not detect the network. 

Let us look at our line description again. 

WRKLIND SITEETH 

Select Option 5 to display. 

Display Line Description

Line description . . . . . . . . . : SITEETH 
Option . . . . . . . . . . . . . . : *BASIC
Category of line . . . . . . . . . : *ELAN 

Resource name . . . . . . . . . . : CMN07 
Online at IPL . . . . . . . . . . : *YES
Vary on wait . . . . . . . . . . . : *NOWAIT 
Network controller . . . . . . . . : SITEENET
Local adapter address . . . . . . : 00609439438A
Exchange identifier . . . . . . . : 056D7D0F
Ethernet standard . . . . . . . . : *ALL
Line speed . . . . . . . . . . . . : *AUTO 
Current line speed . . . . . . . . : 100M
Duplex . . . . . . . . . . . . . . : *AUTO 
Current duplex . . . . . . . . . . : *FULL 
Maximum frame size . . . . . . . . : 1496
Maximum controllers . . . . . . . : 40 
There are only a few other things to be concerned with regarding the line description that would affect our ability to communicate with the switch/network. Line speed and Duplex are two of the parameters. There is one simple rule to setting the line speed and duplex. They must match the switch/network to which the System i is connected. IBM Support can not tell you what to set them to. You are plugging the System i into a network device (switch) and you must know how the port on that switch is configured. The vast majority of switches are auto negotiating, and we in support see the vast majority of customers set Line speed and Duplex to *AUTO. Numerous other customers hard code these values to match their switch. Either way, the one rule is that these values must match the port that we are plugged into on the switch. IBM Development's recommendation is to set the switch port's setting as well as the System i line description to Auto-Negotiate. 

Any of the previously mentioned line description parameters (line speed, duplex, or resource name) can be changed with an Option 2 from the WRKLIND screen. 

Refer again to our hierarchy. We have verified the line description parameters, that the cable is in the correct port on the System i, and that the Ethernet port on the System i is operational. That leaves one thing left ... the network. Cables and ports on switches do go bad. Replace the cable from the System i to the switch (verifying that you plug the cable into the correct port on the System i). Also, try a new port on the switch or a new switch all together. 

There is only one reason a line description will not vary on. It can not detect the network. If you have confirmed that the line description is set correctly, confirmed the correct placement of the Ethernet cable into the System i, and verified that the Ethernet port, card, and IOP are operational, then the issue typically lies outside of the System i. You can place a hardware service call and request that the Ethernet IOA be replaced or that a wrap test be done on that IOA, but at this point there is no evidence to support that decision. In the vast majority of cases, the above scenario is resolved by swapping the cable or switch and not by replacing the card.  

HISTORICAL NUMBER
 437169802