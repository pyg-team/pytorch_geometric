Title: IBM Portal upgrades fail during ejbdeploy with 'Error is Platform not running' message - United States

Text:
7001eGA TECHNOTE (TROUBLESHOOTING)

PROBLEM
Portal upgrades fails during ejbdeploy with 'Error is Platform not running' message. This could happen for any v6.1.0.x , v7.0.0.x, or v8.0.0.x upgrade

SYMPTOM
In the ConfigTrace.log, the following exception can be seen:
==========================
[wsadmin] ADMA5016I: Installation of wps started.
[wsadmin] ADMA5058I: Application and module versions are validated with versions of deployment targets.
[wsadmin] ADMA5018I: The EJBDeploy program is running on file /var/tmp/app5791171104868981175.ear.
[wsadmin] Starting workbench.
[wsadmin] EJB Deploy configuration directory: /opt/IBM/WebSphere/AppServer/profiles/dmgrProfile/ejbdeploy/configuration/
[wsadmin] framework search path: /opt/IBM/WebSphere/AppServer/deploytool/itp/plugins
[wsadmin] build: RAD753-I20090617_1116
[wsadmin] An unexpected exception was thrown. Halting execution.
[wsadmin] Shutting down workbench.
[wsadmin] Error executing deployment: java.lang.IllegalStateException. Error is Platform not running.
[wsadmin] java.lang.IllegalStateException: Platform not running
[wsadmin] at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:374)
[wsadmin] at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[wsadmin] at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
[wsadmin] at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
[wsadmin] at java.lang.reflect.Method.invoke(Method.java:597)
[wsadmin] at com.ibm.etools.ejbdeploy.batch.impl.BootLoaderLoader.run(BootLoaderLoader.java:487)
[wsadmin] at com.ibm.etools.ejbdeploy.batch.impl.BatchDeploy.execute(BatchDeploy.java:106)
[wsadmin] at com.ibm.etools.ejbdeploy.EJBDeploy.execute(EJBDeploy.java:106)
[wsadmin] at com.ibm.etools.ejbdeploy.EJBDeploy.deploy(EJBDeploy.java:349)
[wsadmin] at com.ibm.etools.ejbdeploy.EJBDeploy.main(EJBDeploy.java:311)
[wsadmin] EJBDeploy level: @build@
[wsadmin] ADMA5008E: The EJBDeploy program failed on file /var/tmp/app5791171104868981175.ear. Exception: com.ibm.etools.ejbdeploy.EJBDeploymentException: Error executing EJBDeploy
[wsadmin] ADMA0063E: An error occurred during Enterprise JavaBeans (EJB) deployment. Exception: com.ibm.etools.ejbdeploy.EJBDeploymentException: Error executing EJBDeploy
[wsadmin] ADMA5011I: The cleanup of the temp directory for application wps is complete.
[wsadmin] ADMA5069E: The installation of application wps failed. This application was in the middle of a full update and therefore is uninstalled from the configuration session. Discard your current configuration session immediately to recover the application. Do not save changes to the WebSphere Application Server configuration repository. The application is not uninstalled from this repository. Until the current configuration session is discarded you do not see this application in the current session.
[wsadmin] WASX7017E: Exception received while running file "/opt/IBM/WebSphere/AppServer/profiles/wp_profile/ConfigEngine/config/work/was/curJaclScript.jacl"; exception information: com.ibm.ws.scripting.ScriptingException: WASX7418E: Application update for wps failed: see previous messages for details.

[wsadmin] WASX7341W: No "save" was performed before the interactive scripting session exited; configuration changes will not be saved.
/opt/IBM/WebSphere/AppServer/profiles/wp_profile/ConfigEngine/config/includes/apply_PTF.xml:59: Java returned: 105
==========================

CAUSE
This exception can happen during ejbdeploy after the WebSphere Application Server has been upgraded, and old OSGI cache remains for the ejbdeploy tool. The OSGI class of the ejbdeploy tool contains class information within the deploytool folder and can become stale if the content inside deploytool has changed. 



RESOLVING THE PROBLEM
To resolve the problem, complete the following steps: 


1. Delete/Remove the contents of the following directory EXCEPT for the 'config.ini' file, if it exists (the paths are different depending on your backend WAS version):

WebSphere Application Server v6.1.x: 
<profile root>/deploytools/configuration

WebSphere Application Server v7.0.x: 
<profile root>/ejbdeploy/configuration
<AppServer root>/deploytool/itp/configuration


WebSphere Application Server v8.0.x:
<profile root>/ejbdeploy/configuration
<AppServer root>/deploytool/itp/configuration


Cluster Environments: Do this for both the DMGR profile and the node profile.

Note: The deploytools and ejbdeploy directories may not exist on all nodes. They are created when ejbdeploy is executed successfully for the first time. If it has never been executed successfully in your environment, then the directories will not be there.

2. Re-attempt the WebSphere Portal upgrade.




 * 
 *