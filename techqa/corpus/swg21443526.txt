Title: IBM How to set up the Portal Search Bar with Virtual Portal in WebSphere Portal Version 6 - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 I'm trying to set up the Portal Search Bar with Virtual Portal in WebSphere Portal Version 6, it did not work as same as we see in non-Virtual Portal environment as mentioned in the Documentation updates for OmniFind Enterprise Edition Version 8.5(TN#1308220).

How do I set up the portal search bar with Virtual Portal in WebSphere Portal Version 6? 

CAUSE
In OEE 8.5, banner_searchControl.jspf redirects the request to /wps/omnifind/portalSearchBar.jsp. And portalSearchBar.jsp generates the URL of OmniFind search page (where ESSearchPortlet is deployed) and redirect the request to the OmniFind page, then finally the user can reach to the OmniFind page. 


portalSearchBar.jsp uses unique name ibm.portal.OmniFindSearch to look for the OmniFind page on Portal such as follows:

String url = ESURLGenerator.generateUrlString("ibm.portal.OmniFindSearch","ibm.portal.OmniFindSearch.called", "/myportal", request, response);

Basically it works well, but it will search the unique name. In Virtual Portal Environment, you need to use Object ID instead of unique name. So if the user deploys ESSearchPortlet on virtual portal, portalSearchBar.jsp cannot find it.


ANSWER
To use the search bar in the Virutal Portal environment, portalSearchBar.jsp needs to use Object ID, not unique name. 


However, Object ID depends on the environement thus you have to check the Object ID using xmlaccess command provided in WebSphere Portal with following sample script(omni.xml):

Here is the sample script (named omni.xml):
-----
<?xml version="1.0" encoding="UTF-8"?>
<request
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance [http://www.w3.org/2001/XMLSchema-instance]"
xsi:noNamespaceSchemaLocation="PortalConfig_1.4.xsd"
type="export">
<portal action="locate">
<content-node action="export" uniquename="ibm.portal.OmniFindSearch" />
</portal>
</request>
-----

You can get ObjectID using xmlaccess command as follows:

xmlaccess.bat -user <username> -password <password> -in omni.xml -url http://<portal server>:<portalport>/wps/config/<virtual portal context>

The result looks like as follows, for example:
-----
<content-node action="update" active="true" allportletsallowed="false" content-parentref="6_AFKO8B1A0817002RPM3PDV3001 create-type="explicit" domain="rel" objectid="6_AFKO8B1A0OG1802RPFPBRF10G0" ordinal="3600" type="page" uniquename="ibm.portal.OmniFindSearch">
...
...
...
<component action="update" active="true" deletable="undefined" domain="rel" modifiable="undefined" objectid="7_AFKO8B1A0OG1802RPFPBRF10G6" ordinal="100" orientation="H" type="container" width="undefined">
<component action="update" active="true" deletable="undefined" domain="rel" modifiable="undefined" objectid="7_AFKO8B1A0OG1802RPFPBRF10G1" ordinal="100" type="control" uniquename="ibm.portal.OmniFindSearch.called" width="undefined">
<portletinstance action="update" domain="rel" objectid="5_AFKO8B1A0OG1802RPFPBRF10G5" portletref="3_AFKO8B1A0OG1802RPFPBRF1006"/>
</component>
</component>
-----

After you execute the xmlaccess command with script, you can get the following Object ID: 

 * "6_AFKO8B1A0OG1802RPFPBRF10G0" for "ibm.portal.OmniFindSearch" page 
 * "7_AFKO8B1A0OG1802RPFPBRF10G1" for "ibm.portal.OmniFindSearch.called" portlet
   
   

Using these Object IDs, you have to update portalSearchBar.jsp to generate URL. 
Note: the detail is written in " Creating a link from a servlet to a page in a virtual Portal [http://www-01.ibm.com/support/docview.wss?rs=688&ca=portall2&uid=swg21271209]" technote(TN# 1271209 [http://www-01.ibm.com/support/docview.wss?rs=688&ca=portall2&uid=swg21271209]), 

The following code is the sample portalSearchBar.jsp. 
Note: This is a sample code. You should be responsible for the customization itself. 
----- 
<%@ page import="com.ibm.es.searchui.portal.utils.ESURLGenerator" %> 
<% 
request.setCharacterEncoding("UTF-8"); 
if (request.getParameter("q") == null && request.getParameter("query") != null) { 
String query = request.getQueryString(); 
String newQuery = query.replaceFirst("query=", "q="); 
response.sendRedirect(request.getRequestURL().append("?" + newQuery).toString()); 
} else { 
try { 
// String url = ESURLGenerator.generateUrlString("ibm.portal.OmniFindSearch", "ibm.portal.OmniFindSearch.called", "/myportal", request, response); 
String url = ESURLGenerator.generateUrlStringByObjectId(" ObjectId of ibm.portal.OmniFindSearch ", " ObjectId of ibm.portal.OmniFindSearch.called ", "/myportal/ <Your Virtual Portal > ", request, response); 
response.sendRedirect(url); 
} catch (Exception e) { 
e.printStackTrace(); 
} 
} 
%> 
----- 

The above portalSearchBar.jsp can generate URL on the Virtual Portal when you use ESURLGenerator.generateUrlStringByObjectId method with generated Object ID. 

After you implement the change, you should be able to use the Portal Search Bar on the Virtual Portal environment. 

RELATED INFORMATION
#Creating a link from a servlet to a page in a virtual P [http://www.ibm.com/support/docview.wss?rs=688&ca=portall2&uid=swg21271209]
Documentation updates for OmniFind Enterprise Edition V [http://www.ibm.com/support/docview.wss?rs=0&uid=swg21308220]