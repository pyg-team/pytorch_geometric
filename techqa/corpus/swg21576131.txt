Title: IBM nco_p_ncpmonitor or ncp_g_event process will not start - United States

Text:
ITNM; AEL; ObjectServer; nco_p_ncpmonitor; ncp_g_event TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Attempts to start the nco_p_ncpmonitor and ncp_g_event processes result in log messages like "Requested server name not found." or "Not connect to Objectserver" when using IBM Tivoli Network Manager IP Edition. 

SYMPTOM
The two process fail to connect to the Object Server. 

The nco_p_ncpmonitor.<domain>.log/trace debugs messages were: 
------------------------------------------------------------------- 
Information: I-MOM-001-001: [1t] nco_p_ncpmonitor[15138876] Version 3.9 (Build 32) on aix5 becoming Primary
Debug: D-MOM-001-011: [1t] Removed timer: 317e40c0
Error: E-UNK-000-000: Server 'NCOMS': No error
Error: E-UNK-000-000: ct_connect(): protocol specific layer: external error: The attempt to connect to the server failed.
Debug: D-UNK-000-000: Failed to connect to 'NCOMS'. 
Debug: D-UNK-000-000: Primary server connection has failed, trying backup ''. 
Debug: D-UNK-000-000: Attempting a connection to server ''.
Error: E-UNK-000-000: ct_connect(): directory service layer: internal directory control layer error: Requested server name not found. 
Debug: D-UNK-000-000: Failed to connect to ''. 
Debug: D-UNK-000-000: Automatic SAF disabled. Connection to server 'NCOMS' has failed. 
Error: E-UNK-000-000: Failed to make a connection to server 'NCOMS'. 
Error: E-UNK-000-000: Failed to connect to all required ObjectServers. 
Information: I-UNK-000-000: Falling back to previous rules file.
Warning: W-RIV-002-128: [2057t] CMonitorProbe.cc(524) general failure Not connected to ObjectServer NCOMS 
Error reading probe configuration. Please check:
- the nco_p_ncpmonitor.* config files are valid and accessible 
- the interfaces.<platform> file is accessible, and contains an entry for your chosen Object Server 
- write permissions for the probe log file (determined by the MessageLog property or -messagelog cmd line arg)

The ncp_g_event.<domain>.log messages were:
-------------------------------------------------------------------
Information: I-NCO-001-010: [2057t] Setting IDUC flush interval to 5 seconds 
Error: E-UNK-053-003: OpenClient (Layer = 4, Origin = 1, Severity = 4, Number = 44) - ct_connect(): protocol specific layer: external error: The attempt to connect to the server failed. 
Fatal: F-RIV-002-208: [2057t] CGwEventMgr.cc(236) Exit function called Failed to connect to the Object Server 
Fatal: F-RIV-002-208: [3856t] CNcoConnection.cc(757) Exit function called Unable to connect reader to Object Server: NCOMS 
Information: I-MOM-001-047: [1t] Terminating message broker session... 
Information: I-MOM-001-018: [1t] Message broker session terminated 
Information: I-VER-001-003: [1t] ncp_g_event shutting down 


CAUSE
The configuration was changed to use an Object Server username(s) and password other than the "root" Object Server username and password defined at the time of install. 

The username being used needs to be defined within the configuration for ITNM and enabled in the Object Server


DIAGNOSING THE PROBLEM
Review the logs for nco_p_ncpmonitor and ncp_g_event for messages and errors. 

If necessary set the debug to 4 in CtrlService.<domain>.cfg for both and restart ITNM (itnm_start ncp) 

Also review the Object Server NCOMS.log for message like these: 

 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 

that indicate that the username is disable in the Object Server. 

RESOLVING THE PROBLEM
Ensure that the new Object Server username(s) and password are "Enabled" in the Object Server NCOMS. 


nco_p_ncpmonitor.props
Ensure that the nco_p_ncpmonitor.props is configured to use correct username and password.

The nco_p_ncpmonitor process definition in the CtrlServices.<domain>.cfg file will need to be modified to use the updated nco_p_ncpmonitor.props file.
...................................................................... 
[ "-domain" , "$PRECISION_DOMAIN", "-propsfile", "/opt/IBM/tivoli/netcool/probes/[platform]/nco_p_ncpmonitor.props", "-debug", "0", "-messagelevel", "warn"],
...................................................................... 

Add the following to nco_p_ncpmonitor.props as they are not defined in the default properties file provided:
# For property value encryption, username, and password 

 * ConfigKeyFile : '$NCHOME/etc/security/keys/encryption.key'
 * 
 * ConfigCryptoAlg : 'AES_FIPS' 
 * 
 * AuthUserName : 'probe' 
 * 
 * AuthPassword
 * : '@44:wZxMe45rRdSgMZJP0s4rk+j0foQmhOgV9qRkqr661k=@'
 * 

...................................................................... 

Uncomment the following from the nco_p_ncpmonitor.props file: 
 * PropsFile : "$NCHOME/probes/[platform]/nco_p_ncpmonitor.props"
 * 
 * RulesFile : "$NCHOME/probes/[platform]/nco_p_ncpmonitor.rules"
 * 
 * MessageLog : "
 * $NCHOME/log/precision/nco_p_ncpmonitor.<domain>.log
 * "
 * 
 * MessageLevel : "info"
 * 
 * Server : 'NCOMS'


NcoLogin.cfg 
The ncp_g_event process uses the $NCHOME/etc/precision/NcoLogin.cfg file to determine what username and password to use with Object Server. 
 * //
 * 
 * // This file contains the login information (credentials) for the OMNIbus
 * 
 * // object server to be used by Precision IP. The information is store in a
 * 
 * // transient database named connection.credentials
 * 
 * //
 * 
 * insert into connection.credentials
 * 
 * (
 * 
 * m_Username,
 * 
 *  
 * m_Password,
 * 
 * m_EncryptedPwd
 * 
 * )
 * 
 * values
 * 
 * (
 * 
 * "itnmgate",
 * 
 * "@44:wZxMe45rRdSgMZJP0s4rk+j0foQmhOgV9qRkqr661k=@",
 * 
 * 1
 * 
 * );


If the password is encrypted in nco_p_ncpmonitor.props and/or NcoLogin.cfg files, you may use ncp_crypt command to decrypt the string;  * 
 * 


(replacing <encrypted_string> with the value for m_Password or AuthPassword. 

Also you can verify the correct username and password by using the nco_sql command on Object Server to see if you can connect there.. 

Once the username are enabled in Object Server and ITNM configured to use correct username and password, stop and restart both the Object Server and ITNM. 

The nco_p_ncpmonitor and ncp_g_events will start. 

Please reference the Netcool OMNIbus documentation for securing probe and gateway connectivity. RELATED INFORMATION
 Netcool OMNIbus [http://www.ibm.com/support/knowledgecenter/en/SSSHTQ/landingpage/NetcoolOMNIbus.html]