Title: IBM InfoSphere Guardium STAP CPU usage high and spawn defunct processes when running as 'guardium' user - United States

Text:
STAP performance; DB2 user; AIX TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 InfoSphere Guardium STAP has performance issue such as CPU usage high and many defunct processes spawned by STAP when running as 'guardium' user. 

SYMPTOM
When you run batch job, you find that STAP CPU usage is high. In the mean time, a lot of defunct processes are spawned by STAP. The batch job will hang. If you stop STAP, the batch job will run normally.


CAUSE
The issue specifically happens when you are running STAP as 'guardium' user, and you are monitoring shared memory. As we monitor shmat() calls, STAP may start to spawn defunct processes and consuming excessive CPU. The problem is that when STAP is not running as root, it must check the shared memory area using ipcs -ma, for which we may not have permission as 'guardium' user.

ENVIRONMENT
OS: AIX 7.1, DBMS: DB2

DIAGNOSING THE PROBLEM
Check the guard_tap.ini file, if you are running STAP with 'guardium' user (tap_run_as_root=0)

RESOLVING THE PROBLEM
Add the DB2 user to the Guardium group. In that way, the Guardium monitoring process will be able to see the shared memory contents, while still running as a user process.




To do this:
— stop DB2
— add the DB2 user (usually db2inst1) to the guardium group
— restart DB2

Adding the user can be done with the 'chgrpmem' command (as root):

$ chgrpmem -m + db2inst1 guardium

RELATED INFORMATION
#