Title: IBM IV98662: RELATED EVENTS & SEASONAL EVENT ANALYTICS REPORTER DATABASE TIMESTAMP ISSUE. - United States

Text:
  DIRECT LINKS TO FIXES
7.1.0-TIV-NCI-ZLINUX-FP0012 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FTivoli%2FTivoli+Netcool+Impact&fixids=7.1.0-TIV-NCI-ZLINUX-FP0012&source=SAR]
7.1.0-TIV-NCI-WINDOWS-FP0012 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FTivoli%2FTivoli+Netcool+Impact&fixids=7.1.0-TIV-NCI-WINDOWS-FP0012&source=SAR]
7.1.0-TIV-NCI-SOLARIS-FP0012 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FTivoli%2FTivoli+Netcool+Impact&fixids=7.1.0-TIV-NCI-SOLARIS-FP0012&source=SAR]
7.1.0-TIV-NCI-LINUX-FP0012 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FTivoli%2FTivoli+Netcool+Impact&fixids=7.1.0-TIV-NCI-LINUX-FP0012&source=SAR]
7.1.0-TIV-NCI-AIX-FP0012 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FTivoli%2FTivoli+Netcool+Impact&fixids=7.1.0-TIV-NCI-AIX-FP0012&source=SAR]
IBM Tivoli Netcool/Impact V7.1.0 Fix Pack 12 (7.1.0-TIV-NCI-FP0012) [http://www-01.ibm.com/support/docview.wss?uid=swg24044312]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Product: IBM Tivoli Netcool Impact 7.1.0
   Release: 7.1.0 FP9
   Severity: 3
   
   Problem Description: IBM Tivoli Netcool Impact 7.1.0
   
   Related Events & Seasonal Event Analytics reporter Database
   timestamp issue.
   
   Installed Related Events and Seasonal Event Analytics.
   The environment includes used Impact 7.1.0.9, WebGui 8.1.0.8,
   OMNIbus 8.1.0.11.
   The MSSQL database is configured to use 'dd.MM.yyyy hh:mm:ss'
   
   configured history_db_timestampformat=dd.MM.yyyy hh:mm:ss
   using the ./nci_trigger NCI impactadmin/impactpass
   NOI_DefaultValues_Export FILENAME /tmp/NOI_DefaultValues.props
   and
   ./nci_trigger NCI impactadmin/impactpass
   NOI_DefaultValues_Configure
   FILENAME /tmp/NOI_DefaultValues.props
   
   Which leads to several parsing issues "Could not convert varchar
   to datetime ... out of range".
   Errors found in the standard Impact policylogger - log file
   each time they activate one of the RE/SE services.
   
   Policy RE_CONFIGURE, line #160 reads:
   
   var analyseStartTime  = LocalTime(startTime,
   dateFormatToInsert);
   var analyseEndTime = LocalTime(endTime, dateFormatToInsert);
   
   further down in line #172 reads:
   
   filterForResults = noiHistory.getResultsFilter("1=0",
   ALERT_DATE_COLUMN, analyseStartTime, analyseEndTime);
   
   analyseStartTime and analyseEndTime are used for the analysis of
   the history database (MSSQL) and the start and end time of
   the analysis is being formatted using the format
   dateFormatToInsert.
   
   dateFormatToInsert is defined in the policy NOI_CONSTANTS
   in line #151 which reads:
   
   var dateFormatToInsert  = 'yyyy-MM-dd HH:mm:ss.SSS';
   
   Analysis and findings by L3
   ------------------------------
   01 Aug 2017 17:09:29,449:
   [RE_CONFIGURE][pool-2-thread-141]Parser log:
   RE_CONFIGURE: Filter for Results: ((Severity=3) AND (
   FIRSTOCCURRENCE >
   '2013-07-28 00:00:00.000' )) AND ( FIRSTOCCURRENCE < '2013-07-31
   23:59:59.000')
   
   
   for
   
   
   configuration_db_timestampformat  yyyy-MM-dd HH:mm:ss.SSS
   history_db_timestampformat        yyyy-MM-dd HH:mm:ss.SSS
   
   
   aka defaults.
   
   
   // Default values
   var dateFormatToInsert  = 'yyyy-MM-dd HH:mm:ss.SSS';
   
   
   Conversionn uses LocalTime. Policy Function. Where MM is month,
   d is day
   and yyyy is year.
   
   i.e. set format to  dd/M/yyyy and make appropriate changes to
   NOI_CONSTANTS and RE_CONFIGURE policies.
   
   
   This eliminates errors in NCI_policylogger_RE_CONFIGURE.log but
   changes
   also needed in NCI_ConfigureResults.
   
   
   The above 3 policies need changes for the Configuration to be
   created.
   Other changes needed for running configuration.
   
   
   SE_PROCESSCONFIG -
   
   01 Aug 2017 12:05:00,564:
   [SE_PROCESSCONFIG][pool-2-thread-96]Parser
   log: Executing processing for job: RESULTID = 8 AND STATUS = 4
   AND
   ERRORSTEP = 0 AND ISFILTERINCLUDE is null AND ROWSPROCESSED =
   0.0 AND
   TOTALROWSTOBEPROCESSED = 5582.0 AND CREATIONTIME = 1501603469
   AND
   RESULT_START_TIME = '2009-03-17 05:29:22.0' AND RESULT_END_TIME
   =
   '2017-07-17 05:29:22.0' AND IMPACT_DATASOURCE_NAME is null AND
   IMPACT_DATATYPE_NAME is null AND TIMESTAMP_COLUMN_NAME is null
   AND
   ROW_IDENTIFER_COLUMN_NAME is null AND RESULTNAME = 'mssql' AND
   CUSTOMERID = 'geraldine' AND ALGORITHM_COLUMNNAMES is null AND
   DESCRIPTION =  AND RESULT_FILTER = 'Severity>1' AND
   FILTER_RUN_VALUE =
   100 AND FILTER_RUN_TYPE = 'MONTHS' AND REPORTDATETYPE =
   'RELATIVE' AND
   EVENTIDENTITIES = 'USINGGLOBALSETTINGS' AND PROCESSSTEP = 7 AND
   REPORTTYPE = 'Seasonality' AND AUTO_DEPLOY = 'false' AND
   SCHEDULED =
   'false' AND SCHEDULED_VALUE = 0 AND SCHEDULED_TYPE = 'MONTHS'
   AND
   PROFILEID = 2 AND IS_RELATED_EVENT = 'true' AND SELECTEDFIELDS
   is null
   AND START_TIME = '2017-08-01 12:04:29.0' AND PREV_START_TIME is
   null AND
    PROGRESS = 0 AND LAST_RUN_DURATION = '00:40:02' AND
   OVERRIDEGLOBALEVENTIDENTITY = 'false' AND PROCESSING_ORDER = 1
   
   01 Aug 2017 12:05:19,245:
   [SE_PROCESSCONFIG][pool-2-thread-96]Caused by:
   com.micromuse.response.common.PolicyProcessingException:
   JavaException:
   com.microsoft.sqlserver.jdbc.SQLServerException: The conversion
   of a
   varchar data type to a datetime data type resulted in an
   out-of-range
   value. (pool-2-thread-97#88) in seasonalityProcess
   
   This looks like a Derby select - though that format is
   unchanged.
   SE_PROCESSCONFIG calls seasonalityProcess policy. This is where
   the real
   error is
   
   01 Aug 2017 18:24:55,056:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: TIME 04a: Loading data from DB
   01 Aug 2017 18:24:55,056:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: Inside getData
   01 Aug 2017 18:24:55,056:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: Query : SELECT
   SUMMARY,SEVERITY,NODE,ALERTGROUP,FIRSTOCCURRENCE,IDENTIFIER,SERV
   ERNAME,S
   ERVERSERIAL,OWNERUID,ACKNOWLEDGED,TALLY FROM
   dbo.REPORTER_STATUS WHERE
   ((Severity=3) AND ( FIRSTOCCURRENCE > '2013-07-28 00:00:00.000'
   )) AND (
   FIRSTOCCURRENCE < '2013-07-29 00:00:00.000')  AND (SEVERITY >=0)
   01 Aug 2017 18:24:55,250:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: WARNING!!! Unable to retrieve event history, retrying...
   
   01 Aug 2017 18:24:55,251:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: Inside getData
   01 Aug 2017 18:24:55,251:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: Query : SELECT
   SUMMARY,SEVERITY,NODE,ALERTGROUP,FIRSTOCCURRENCE,IDENTIFIER,SERV
   ERNAME,S
   ERVERSERIAL,OWNERUID,ACKNOWLEDGED,TALLY FROM
   dbo.REPORTER_STATUS WHERE
   ((Severity=3) AND ( FIRSTOCCURRENCE > '2013-07-28 00:00:00.000'
   )) AND (
   FIRSTOCCURRENCE < '2013-07-29 00:00:00.000')  AND (SEVERITY >=0)
   
   01 Aug 2017 18:24:55,434:
   [seasonalityProcess][pool-2-thread-161]Parser
   log: Error in retrieving data from the history table:
   JavaException:
   com.microsoft.sqlserver.jdbc.SQLServerException: The conversion
   of a
   varchar data type to a datetime data type resulted in an
   out-of-range
   value.
   
   seasonalityProcess.js also need to be changed.
   
   
    
   
   

LOCAL FIX
 *  N/A
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * All Impact Users                                             *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * Using MSSQL as the reporting database, the RE and SE NOI     *
   * reports have issues when the timestamp is different from     *
   *                                                              *
   * standard US timestamps. In the customer's case, the MSSQL    *
   * database is configured to use 'dd.MM.yyyy hh:mm:ss'.         *
   *                                                              *
   * Note: By default MSSQL using American date time format.      *
   *                                                              *
   * Errors in the NOI policy logs are                            *
   * com.microsoft.sqlserver.jdbc.SQLServerException: The         *
   * conversion of a  varchar data type to a datetime data type   *
   * resulted in an out-of-range value.                           *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IV98662
   
   
 * REPORTED COMPONENT NAME
   NC/IMPACT RTID
   
   
 * REPORTED COMPONENT ID
   5724O5900
   
   
 * REPORTED RELEASE
   710
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-08-02
   
   
 * CLOSED DATE
   2017-10-13
   
   
 * LAST MODIFIED DATE
   2017-10-13
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  UNKNOWN
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   NC/IMPACT RTID
   
   
 * FIXED COMPONENT ID
   5724O5900
   
   

APPLICABLE COMPONENT LEVELS
 * R710 PSY
   UP