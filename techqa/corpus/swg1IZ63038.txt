Title: IBM IZ63038: ENDMQM HANGS ON WMQ 7.0 FOR HP-UX IF USING PUBSUB BROKER        AND CCSID IS CHANGED TO INCOMPATIBLE CHARACTER SET - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0 Fix Pack 7.0.1.2 [http://www-01.ibm.com/support/docview.wss?uid=swg24026518]
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.2 [http://www-01.ibm.com/support/docview.wss?uid=swg24026566]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The default CCSID on a WebSphere MQ 7.0 for HP-UX queue manager
   is changed to an incompatible CCSID. The pubsub broker
   attempts to put a message to a queue and fails with:
   AMQ5855: WebSphere MQ Publish/Subscribe broker ended.
   EXPLANATION: An attempt has been made to run the broker (AAA)
   but the broker has ended for reason
   '6047:xecX_E_CONV_NOT_SUP'.
   An attempt is then made to end the queue manager normally
   using endmqm and it hangs.
   NOTE:
   This only occurs on WMQ 7.0 for HP-UX.
   ADDITIONAL KEYWORDS:
   Publish Subscribe hung quiesce immediate shut down shutdown
   SYSTEM.BROKER.INTER.BROKER.COMMUNICATIONS
   conversion not supported code page 6047 xecX_E_CONV_NOT_SUP
   
   
    
   
   

LOCAL FIX
 *  - do not set qmgr to use invalid CCSID
   or
   - use endmqm -i
   or
   - disable PSMODE:  ALTER QMGR PSMODE(DISABLED)
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   Users who create a V7 queue manager with one queue manager
   CCSID, and then change the queue manager to a CCSID where
   conversion between the two CCSID's is not supported.
   
   Platforms affected:
   HP-UX (Itanium),HP-UX (PA-RISC)
   
   ****************************************************************
   PROBLEM SUMMARY:
   The queue manager stores configuration information for the
   broker on queues. The multi-broker sub-component of the broker
   expects to receive messages both from the local queue manager,
   and from remote queue managers, and gets messages with
   MQGMO_CONVERT. This sub-component was incorrectly putting
   messages on system queues in queue manager CCSID, and then
   subsequently getting those messages in queue manager CCSID
   (with MQGMO_CONVERT). If the queue manager CCSID is changed
   such that conversion between the old CCSID and the new CCSID is
   not supported then the MQGET fails and the amqfqpub process
   fails to initialize.
   
   A secondary problem also exists where the abnormal termination
   of the amqfqpub process hangs. This occurs because not all
   threads of the process are being signalled to terminate.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The broker no longer stores state messages that might need to
   be converted in queue manager CCSID. Rather the broker chooses
   a 'native' CCSID for the platform upon which it is running and
   all messages are created and consumed in that explicit CCSID.
   
   The routine that handles abnormal termination of the amqfqpub
   process has been connected such that all threads in the process
   are signalled that the process is ending abnormally.
   
   Note: although the problem could theoretically occur on all
   distributed platforms, in practice the problem is only ever
   likely to be seen on HP-UX.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v7.0
   Platform           Fix Pack 7.0.1.2
   --------           --------------------
   HP-UX (PA-RISC)    U829678
   HP-UX (Itanium)    U829681
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ63038
   
   
 * REPORTED COMPONENT NAME
   WMQ HP V7
   
   
 * REPORTED COMPONENT ID
   5724H7222
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-10-14
   
   
 * CLOSED DATE
   2010-01-19
   
   
 * LAST MODIFIED DATE
   2010-01-20
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ HP V7
   
   
 * FIXED COMPONENT ID
   5724H7222
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP