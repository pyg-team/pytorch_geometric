Title: IBM Proper shutdown sequence for SCA applications using WebSphere SAP Adapter in inbound mode in case of planned outages - United States

Text:
SAP; Adapter; SCA; inbound; shutdown; listener; JR50439; endpoint; j2c TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The WebSphere SAP Adapter in inbound mode may still receive inbound requests (IDOCs) from SAP Server and send them to the endpoint while the SCA application is shutting down. This may cause errors while messages are processed in the SCA runtime as the SCA application's resources are being cleared. 

CAUSE
When a stop command is issued for the SAP Adapter inbound SCA application that used the inbound SAP Adapter, one of the steps is deactivating the SAP Adapter endpoint and thus terminating the SAP Adapter listeners. This prevents IDOCs reaching the SAP Adapter. 
Because the application shutdown is asynchronous, there may be a time gap between the time when the IDOCs stop flowing in and the point when the SCA module stops, especially during high IDOC load. In this case some IDOCs may still reach the SCA layer while at the same time the SCA application's resources are being cleared. This causes incorrect message processing, and faulty messages are put on the internal SCA queues. When the SCA application is started again, the messages present in the internal SCA queues will not process correctly and Failed Events are created that are not resubmittable. 


RESOLVING THE PROBLEM
The proper SAP Adapter quiesce method for a planned outage is to: 

1) Pause the SAP Adapter endpoints which terminates the listeners, preventing IDOCs reaching the BPM runtime. 

2) Shut down the SCA application manually without any loss of data. 


If the SCA application is stopped without first pausing the adapter, BPM APAR JR50439 addresses errors that can occur. This APAR resolves the problems by throwing an exception when the SCA runtime detects that it is processing a request while the application is stopping. By throwing an exception the SAP Adapter transaction will roll back. 
It is strongly recommended to apply JR50439 to BPM runtime. 

Even with this Interim Fix in place, it is still safer to pause the SAP Adapter before shutting down the SCA application because this will reduce the likelihood of errors and transaction rollback. 

Pausing the SAP Adapter endpoint is achieved through wsadmin scripting interface. It is currently not possible to do that step through the WAS Administration Console. 

Reference the following article that provides instructions on how to find the correct endpoint and how to pause/resume it:

"Monitoring the WebSphere J2C adapter polling thread in a WebSphere Process Server environment", section "Monitoring the J2C message endpoint" - 
http://www.ibm.com/developerworks/websphere/tutorials/1206_nasser/ [http://www.ibm.com/developerworks/websphere/tutorials/1206_nasser/]

RELATED INFORMATION
 Monitoring the WebSphere J2C adapter polling thread... [http://www.ibm.com/developerworks/websphere/tutorials/1206_nasser/]