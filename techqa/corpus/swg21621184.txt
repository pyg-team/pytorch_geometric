Title: IBM Scheduled requests not executing due to ORA-01591 - United States

Text:
scheduled lock doubt transaction running executing blocked workflow requests TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Access to the SCHEDULED_MESSAGE table can become blocked when an in-doubt transaction holds a lock on the table. 

SYMPTOM
Scheduled requests do not execute, and the following exception is seen in the ISIM trace.log file: 

 <Exception><![CDATA[java.sql.BatchUpdateException: ORA-01591: lock
held by in-doubt distributed transaction 11.26.132096


CAUSE
There are three possible causes for ORA-01591: lock held by in-doubt distributed transaction #.##.####...

1. The in-doubt transaction locks data that is required by other transactions. This could be caused by undue delay in a transaction, so that others cannot proceed.

2. An in-doubt transaction prevents others from using the extents of a rollback segment. (The first portion of an in-doubt distributed transaction's local transaction ID corresponds to the ID of the rollback segment. This bit of data is useful for more analysis.) Obtain the rollback segment ID in the data dictionary views DBA_2PC_PENDING and DBA_ROLLBACK_SEGS.

3. There is a failure in a two-phase commit transaction that cannot be corrected. A timeout occurs. This is probably related to a network connectivity problem.

When ISIM cannot access the SCHEDULED_MESSAGE table, it cannot submit requests scheduled to begin in the future, nor can it process requests that are currently due to be executed. However, this problem will not impact requests scheduled to run "Immediately", since those bypass this table and are sent directly to the workflow engine.


ENVIRONMENT
ISIM using an Oracle database



RESOLVING THE PROBLEM
The solution is to connect to the Oracle database and rollback the in-doubt transaction: 


SQL> select local_tran_id from dba_2pc_pending;

LOCAL_TRAN_ID
----------------------
11.26.132096

SQL> rollback force '11.26.132096';

SQL> execute dbms_transaction.purge_lost_db_entry('11.26.132096');

SQL> commit;

 

PRODUCT ALIAS/SYNONYM
 enRole itim tim isim sim