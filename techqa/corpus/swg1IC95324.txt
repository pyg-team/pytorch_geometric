Title: IBM IC95324: SQL0480N WITH ASSOCIATE RESULT SET LOCATORS INSIDE EXCEPTION HANDLER WHEN SQLCODE > 0 - United States

Text:
z/os  FIXES ARE AVAILABLE
DB2 Version 10.5 Fix Pack 3 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24036705]
DB2 Version 10.5 Fix Pack 3a for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24037555]
DB2 Cancun Release 10.5.0.4 (also known as Fix Pack 4) for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24038261]
DB2 Version 10.5 Fix Pack 9 for Linux, UNIX, and Windows [http://www-01.ibm.com/support/docview.wss?uid=swg24044110]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A SQL procedure that sets an ASSOCIATE RESULT SET LOCATOR inside
   an exception handler could fail with an SQL0480N error ("The
   procedure "<procedure-name>" has not yet been called.") if the
   SQLCODE of the corresponding stored procedure is greater than
   zero.
   
   For example, inside the exception handler the following code
   could cause the stored procedure to fail when executed:
   
   DECLARE EXIT HANDLER FOR SQLEXCEPTION, SQLWARNING
     BEGIN
       -- MUST get all of the values in a single call here since
   the values will be reset after each line that is executed
       SET v_SQLCODE = SQLCODE, v_SQLSTATE=SQLSTATE;
   
       -- get the result set that is returned by the ADMIN_CMD
   stored procedure
       ASSOCIATE RESULT SET LOCATORS(result1) WITH PROCEDURE
   SYSPROC.ADMIN_CMD;
   
       ALLOCATE rsCur CURSOR FOR RESULT SET result1;
   
       -- read the data from the result set that is returned by the
   LOAD utility
       FETCH rsCur INTO v_ROWS_READ, v_ROWS_SKIPPED, v_ROWS_LOADED,
   v_ROWS_REJECTED, v_ROWS_DELETED, v_ROWS_COMMITTED,
             v_ROWS_PARTITIONED, v_NUM_AGENTINFO_ENTRIES,
   v_MSG_RETRIEVAL, v_MSG_REMOVAL;
   
       SET msg = 'Error while loading data. SQLCODE: ' || v_SQLCODE
   || ' SQL State: ' || v_SQLSTATE || '. Execute the following SQL
   to view the LOAD utility messages: ' || v_MSG_RETRIEVAL;
     END;  -- end of error handler
   
   
    
   
   

LOCAL FIX
 *  n/a
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:                                              *
   * ALL                                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION:                                         *
   * See Error Description                                        *
   ****************************************************************
   * RECOMMENDATION:                                              *
   * Update to DB2 Version 10.5 Fix Pack 3.                       *
   ****************************************************************
   
   
    
   
   

PROBLEM CONCLUSION
 *  This problem is fixed in DB2 Version 10.5 Fix Pack 3.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC95324
   
   
 * REPORTED COMPONENT NAME
   DB2 FOR LUW
   
   
 * REPORTED COMPONENT ID
   DB2FORLUW
   
   
 * REPORTED RELEASE
   A50
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2013-08-27
   
   
 * CLOSED DATE
   2014-02-27
   
   
 * LAST MODIFIED DATE
   2014-02-27
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    IC89879 [http://www-01.ibm.com/support/docview.wss?uid=swg1IC89879]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 FOR LUW
   
   
 * FIXED COMPONENT ID
   DB2FORLUW
   
   

APPLICABLE COMPONENT LEVELS
 * RA50 PSN
   UP