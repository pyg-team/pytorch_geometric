Title: IBM How to control the timeouts/sleep interval for how long filegateway waits for the inline invoked sub BP to complete - United States

Text:
STERLINGNFX TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 How to control the timeouts/sleep interval for how long filegateway waits for the inline invoked sub BP to complete 

SYMPTOM


Filegateway invokes inline custom Business Process to send data in FTP protocol to the receiving trading partner via WAN.

Inline BP completed successfully where no error messages were shown in Sterling Integrator Dashboard BP workflow.

Data was also delivered successfully to the trading partner's end.

However, in filegateway, FG User Interface Arrived File events Tab and the filegateway.log both showed the error messages indicated below.

Even though the inline BP has processed successfully, filegateway still produced error messages which can be confusing.

The error message shown per design is expected at this time and future adjustment may be applied to better illustrate the root cause of issue.

Error Message Error Message 1:

filgeateway user interface Arrived File tab for the routed events showed the following:

FG_0455 Arrived File is now failed while Routing with error message: 1 out of 1 route(s) failed and there were no delivery plans. See the individual routes for information on why each one failed.

Error Message 2:

filegateway.log shows the following:

Workflow [Custom_BusinessProcess] did not complete before timeout. wfid[xxxxxxx]

FileGatewayBusinessProcessException: Execution of bp [Custom_BusinessProcess] failed


RESOLVING THE PROBLEM


The current workaround is to update the parameters that will control the timeouts /sleep interval values for how long for filegateway to wait for the inline invoked sub Business Process to complete.

Filegateway property file has a few parameters that will control the timeouts /sleep interval values for how long for filegateway to wait for the inline invoked sub Business Process to complete. In the <install_directory>/properties/filegateway.properties and <install_directory>/properties/filegateway.properties.in file, find the following parameters: ################# Properties: bpCompletionProbes.1, bpCompletionProbes.2, bpCompletionSleepMsec.1, bpCompletionSleepMsec.2 #################

# Timeouts and sleep intervals that control how long File Gateway waits for every sub Business Process it invokes.

# First probe 120 times with 100 Milliseconds between, for a total of 12 seconds.

bpCompletionProbes.1=120

bpCompletionSleepMsec.1=100

# Then probe 600 times with 2000 Milliseconds between, for a total of 1200 seconds (20 minutes).

bpCompletionProbes.2=600

bpCompletionSleepMsec.2=2000

We can adjust either the number of times searching is needed or the number of milliseconds needed.

In the following example, the parameter bpCompletionProbes.2 is used update the timeout and sleep intervals for illustration.

For example: 

1200 seconds (probe 600 times x 2000 Milliseconds) = 20 minutes

If We need about 4.5 or 5 hours of sleep intervalThen,if we needed 5 hours of sleep interval, 

5 hours = 300 min = 18000 seconds = 18000000 milliseconds

18000000/2000 = 9000 (number of times to probe) 

Below are some more explanation about the above parameter:

Timeouts and sleep intervals that control how long Sterling File Gateway waits for every sub-business process it invokes. These control the timeouts when a business process is executed synchronously during routing. Used for consumer identification business processes and for PGP processing. Enables one set of relatively quick probes followed by a second set of slower probes. The first set will be very reactive, but consume more processor. The second set will activate for longer-running processes and will consume less processor. First probe 120 times with 100 Milliseconds between, for a total of 12 seconds. Default is bpCompletionProbes.1=120 and bpCompletionSleepMsec.1=100.Then probe 600 times with 2000 Milliseconds between, for a total of 1200 seconds (20 minutes). Default is bpCompletionProbes.2=600 and bpCompletionSleepMsec.2=2000.***Note: please update this value in the customer_overrides.properties file instead of just changing it in the filegateway.properties and filegateway.properties.in files to prevent the changes getting lost in the next build patching/upgrade process. To update the parameter,1. Update the customer_overrides.properties file with the parameter of filegateway.bpCompletionProbes.2=9000 (if you don't have this file, a blank file needs to be created with the above parameter and save it in <install_directory>/properties folder)2. stop Sterling Integrator

3. restart Sterling Integrator

Please test out the setting before roll out to production.

 

HISTORICAL NUMBER
 NFX10808 

PRODUCT ALIAS/SYNONYM
 

Severity


Normal


Type


NormalFix