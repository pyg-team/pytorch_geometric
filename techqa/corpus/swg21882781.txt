Title: IBM Running dbverify.cmd/sh using an Oracle 12g or 11g database can cause table modification SQL to be unnecessarily created even though the tables are already defined correctly. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When running dbverify.cmd/sh in IBM Sterling B2B Integrator (B2Bi), it was found that the script would try to change certain tables which had NUMBER or INT data type columns. 

SYMPTOM
The EFrame scripts created by the dbverify.cmd/sh <si_install>/bin) will have unnecessary SQL in the EFrame_TableChanges.sql, EFrame_IndexDrops.sql and the EFrame_IndexAdds.sql files.


CAUSE
The problem was found to be with certain Oracle 11g Drivers (Oracle Bug 12775220) where the drivers were sending an incorrect decimalDigits value for data_type NUMBER and INT back to SBI and then dbverify.cmd/sh would interpret this as a difference from the expected database design and try to correct these columns back to the correct format. For example: 

column name=WFD_ID size=0 decimalDigits=-127 type name=NUMBER
column name=WFD_VERSION size=0 decimalDigits=-127 type name=NUMBER
column name=WORKFLOW_ID size=0 decimalDigits=-127 type name=NUMBER

Instead of 

column name=WFD_ID size=22 decimalDigits=0 type name=NUMBER 
column name=WFD_VERSION size=22 decimalDigits=0 type name=NUMBER 
column name=WORKFLOW_ID size=22 decimalDigits=0 type name=NUMBER


DIAGNOSING THE PROBLEM
In the reverse.xml file created when dbverify.cmd/sh is run you will find entries for each table containing number/int columns showing DecimalDigits with value -127. For example: 


<Entity Cacheable="true" Name="WORKFLOW_CONTEXT" TableName="WORKFLOW_CONTEXT">
<Attributes>
<Attribute ColumnName="WFD_ID" DecimalDigits="-127"
Name="Wfd_Id" Nullable="false" Size="0" Type="NUMBER"/>
<Attribute ColumnName="WFD_VERSION" DecimalDigits="-127"
Name="Wfd_Version" Nullable="false" Size="0" Type="NUMBER"/>


RESOLVING THE PROBLEM
There is an Oracle Bug 12775220 [https://community.oracle.com/thread/3677876] related to this behavior. Oracle reports this bug is fixed in 12.1.0.1 (Base Release) or higher and or 11.2.0.4 for 11g

In order to correct this behavior with the dbverify.sh/cmd you will need to do the following: 

1) Update the Oracle ojdbc6.jar [http://www-01.ibm.com/support/docview.wss?uid=swg21882871] driver inside of SBI to a minimum of 11.2.0.4 for 11g. No need to update the ojdbc7.jar driver for Oracle 12c installs
2) Modify the dbverify.cmd/sh script and add the following JVM argument,
"-Doracle.jdbc.J2EE13Compliant=true"

Windows dbverify.cmd Example:
%JAVA% -Doracle.jdbc.J2EE13Compliant=true -DTEXT_SEARCH_ENABLED= etc:

Unix/Linux dbverify.sh Example:
${JAVA} -Xms256m -Xmx512m -Doracle.jdbc.J2EE13Compliant=true -classpath /si/SI_INSTALLS/SI524_ORA11_4000_Node2/jar/bootstrapper.jar etc:

Note:
As of SBI 5020500_5 [http://www-01.ibm.com/support/docview.wss?uid=swg1IT09072] the dbverify.sh/cmd script has been updated to include the "-Doracle.jdbc.J2EE13Compliant=true" reference.

Additional Note:
If patching/upgrading a 5.2.x install of B2Bi using an Oracle DB you may experience the following linked issues:
1) Upgrading, Patching a Fix Pack or Interim Fix of Sterling B2B Integrator is Taking an Exceedingly Long Time Applying the Schema Changes [http://g01zciwas018.ahe.pok.ibm.com/support/dcf/preview.wss?host=g01zcidbs003.ahe.pok.ibm.com&db=support/swg/istech.nsf&unid=E23C0D8BCBF0660B8525823D0076762C&taxOC=SSCWNZJ&MD=2018/02/26%2015:02:35&sid=]
2) ORA-00054 Resource Busy and Acquire with NOWAIT Specified or Timeout Expired Error when Upgrading, Applying Fix Pack or Interim Fix [http://g01zciwas018.ahe.pok.ibm.com/support/dcf/preview.wss?host=g01zcidbs003.ahe.pok.ibm.com&db=support/swg/istech.nsf&unid=538F998B39A400CC852582390079850A&taxOC=SS3JSW&MD=2018/02/26%2015:02:44&sid=]