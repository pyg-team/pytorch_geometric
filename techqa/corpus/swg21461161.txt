Title: IBM WebSphere Commerce outbound service fails when reading response from service provider - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The following error message occurs upon reading the response from an outbound service request:


[1/11/11 18:14:31:775 EST] 0000004e ConnectionEve A J2CA0056I: The Connection Manager received a fatal connection error from the Resource Adaptor for resource eis/JCAHTTP-WS. The exception which was received is java.io.IOException: javax.xml.soap.SOAPException: org.xml.sax.SAXParseException: The root element is required in a well-formed document. Message being parsed: 
at com.ibm.ws.webservices.engine.SOAPPart.getEnvelope(SOAPPart.java:639)
at javax.xml.soap.SOAPMessage.getSOAPBody(SOAPMessage.java:269)
at com.ibm.commerce.messaging.outboundservice.SOAPWrapperRecordImpl.read
(SOAPWrapperRecordImpl.java:144) 

SYMPTOM
A service request is sent from WebSphere Commerce to an external service provider. 

From the trace, the response is received:
[1/11/11 18:14:31:181 EST] 0000004e WC_MESSAGING > com.ibm.commerce.messaging.outboundservice.SOAPWrapperRecordImpl read(InputStream)
Entry
<< input stream >>
However, the following error message is thrown, in parsing the response:

[1/11/11 18:14:31:775 EST] 0000004e ConnectionEve A J2CA0056I: The Connection Manager received a fatal connection error from the Resource Adaptor for resource eis/JCAHTTP-WS. The exception which was received is java.io.IOException: javax.xml.soap.SOAPException: org.xml.sax.SAXParseException: The root element is required in a well-formed document. Message being parsed: 
at com.ibm.ws.webservices.engine.SOAPPart.getEnvelope
(SOAPPart.java:639)
at javax.xml.soap.SOAPMessage.getSOAPBody
(SOAPMessage.java:269)
at com.ibm.commerce.messaging.outboundservice.SOAPWrapperRecordImpl.read
(SOAPWrapperRecordImpl.java:144)



CAUSE
There are several known issues that can cause this error: 


This error can be caused by setting an incorrect content-type for the service request. 

If the external system receives a message with the incorrect content type, the external system responds with an error message of the correct content type. However, WebSphere Commerce expects back a message of the original content type. This causes the parsing error. 

For example:

1. WebSphere Commerce sends out request of content type 'text/xml-SOAP'
2. The external service provider expects a message of content type 'text/xml'
3. The external service provider sends back an error message of content-type 'text/xml'
4. WebSphere Commerce expects a response of content type 'text/xml-SOAP'
5. A parsing exception is thrown.


In addition, this error can also be caused when attempting to parse an incomplete response. If the response being parsed is incomplete, a parser error is thrown.


RESOLVING THE PROBLEM
1. Confirm with the service provider to verify that the expected content-type matches the content-type set in the wc-server.xml file. 

 

2. Install APARs JR34670 and JR34672. These APARs allow the response to be buffered before sending the response to the parser. This ensures an incomplete response will not be parsed. After applying both JR34670 and JR34672, the default behavior is still maintained. To enable the APAR fix, the 'isBufferResponse' parameter must be set on each message type. See the installation instructions to configure this setting.