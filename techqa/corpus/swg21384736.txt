Title: IBM File recovery attributes in CICS can not be changed - United States

Text:
forward recovery attributes ; DFHFC0991 ; FILECOUNT > 0 ; file ; dataset ; data set ; modified ; modify ; changed ; unable to change ; reset ; 5655M1500 R640 640 R400 400 HCI6400 R650 650 R500 500 HCI6500 5655-M15 5655M15 ; 5655S9700 R660 660 R600 600 HCI6600 R670 670 R700 700 HCI6700 5655-S97 5655S97 KIXINFO TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You want to turn on forward recovery logging for some of your data sets. You change your CICS file definitions, disable the files, and then install the new definitions. However, the forward recovery attributes do not change. 

SYMPTOM
When installing the new definitions you might receive message DFHFC0991. Then when you try to use the REMOVE command you receive the message FILECOUNT > 0.


CAUSE
In this case, LOG(NONE) was specified in the Integrated Catalog Facility (ICF) catalog. If there are recovery attributes on the ICF catalogue for the associated dataset CICS will use them. If the recovery attributes are UNDEFINED within the ICF catalog, CICS will use the recovery attributes in the CICS file definition. This is true for RLS and non-RLS files, with CICS TS V1.1 and higher.

DIAGNOSING THE PROBLEM
Run an IDCAMS LISTCAT for the datasets and look at the LOG value. If there is anything coded in the recovery attributes in the ICF Catalog, CICS will get ALL the recovery parameters from VSAM. All recovery parameters in the CICS file definition will be ignored. So if LOG(NONE) is found in the ICF Catalog, then the file will not have any recovery capabilities.

If the LOG value from the LISTCAT is NULL, CICS will use the file definitions in the CICS CSD or the FCT. There will never be a mixture of VSAM definitions and CICS file definitions. If there is anything in the VSAM IDCAMS definition of the file other than NULL, VSAM definitions will be used. Otherwise, for NULL, CICS file definitions will be used.

RESOLVING THE PROBLEM
Ensure that LOG(NULL) is specified in the ICF catalog if you want to use the recovery attributes from the CICS file definitions. 


 
If your file is already in use and its resource definition has been installed in your active CICS region, you might see the following error message when you try to install the new recovery attributes:

DFHFC0991 [https://publib.boulder.ibm.com/infocenter/cicsts/v4r2/topic/com.ibm.cics.ts.messages.doc/cics_mc/dfhfc/FC0991.html] OPEN OF FILE XXXXXXXX FAILED RECOVERY ATTRIBUTES CONFLICT WITH THOSE ON VSAM DATASET 

For this error the CICS Messages and Codes manual says to enter the following command for the files to remove the base cluster with the unwanted recovery attributes. 

 CEMT SET DSNAME( ) REMOVE [https://publib.boulder.ibm.com/infocenter/cicsts/v4r2/topic/com.ibm.cics.ts.systemprogramming.doc/transactions/cemt/dfha7n8.html] 


When you enter the REMOVE command a common error is an error saying FILECOUNT > 0. This is because a file must have a FILECOUNT of zero in order for a file to be removed. Do the following to set the FILECOUNT to zero: 

 1. Enter CEMT INQ File(*) DSN(xx.yy.zz) to list all FCT entries associated with data set name xx.yy.zz, for which CICS has a data set name block. 
    
    
 2. Enter CEMT SET FILE(filename) Closed Disabled for each file listed by the previous command.
    
    
 3. Enter CEMT SET FILE(filename) DSN(xx.yy.zz) to set a null value for each data set name for each file. 
    
    Alternatively, you could enter CEMT INQuire FILE(filename) DSN(xx.yy.zz) and blank out the DSN or use the EOF key. The blanking out of the field is just to ensure its cleared out. This step of blanking out the DSN in the CEMT INQ FILE entry is not totally necessary because the DISCARDing and REMOVEing will cause the DSN part of the CEMT I FILE entry to 'go away' anyway.


If the use count (FILECOUNT) is still not zero, then there is probably a path defined to the base. There are three alternatives to find out the path name: 

 * Refer to the IDCAMS define cluster JCL. 
 * Do a LISTCAT of the base and look for associated paths. 
 * Look at your File definitions in the CSD or FCT.
   


Once the use count is set to zero, the REMOVE command should work. 

After you successfully install the new file definitions, you should make sure that the correct File and DSN relationship is re-established by using command CEMT SET FILE( filename ) DSN( xx.yy.zz ). 


PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server