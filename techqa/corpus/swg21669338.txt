Title: IBM Tivoli Integrated Portal 2.2.0.X install failed due to retrieveSigners failure. - United States

Text:
TIPL2INST; retrieveSigners; policy; SDK; TIP 2.2.0.x; installation; failure SOAP; connector; SSLHandshake TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 During a TIP install, the retrieveSigners script will get all the signers from the remote keystore and put them in the local keystore. This failed because of SOAP connection issue: ADMC0016E: The system cannot create a SOAP connector 

SYMPTOM
TIP installation failure: retreiveSigners failed.


CAUSE
retrieveSigners.bat failed because of problems with the Certificates: 

SoapConnectorThreadPool : 1, handling exception: 
javax.net.ssl.SSLHandshakeException: Remote host closed connection 
during handshake 


ENVIRONMENT
Windows



DIAGNOSING THE PROBLEM
Initially check the following logs for these messages: 

TIP Install log:
CWPKI0314E: The following error is returned from an exception: 
ADMC0016E: The system cannot create a SOAP connector to connect to host 
localhost at port 31118. 
MachinePlan_localhost.log
Caused by: The following error occurred while executing this line: 
C:\Program Files\IBM\TWA\eWAS\_uninst\TIPInstall22013\plan\install\Machi 
nePlan_localhost\00007_TIPCorePostConfig\TIPCorePostConfig.xml:500: 
condition satisfied 

Line 500 in the TIPCorePostConfig.xml file shows that the failure was from this command, and the failure message is in retrieveSigners.out: 
executable="${IAGLOBAL_TIP_HOME}/profiles/${IAGLOBAL_WASProfileName}/bin 
/retrieveSigners${platform.script.ext}" failonerror="false" 
resultproperty="returnCode"> 
<redirectory output="${IAGLOBAL_TIP_HOME}/logs/retrieveSigners.out" 
error="${IAGLOBAL_TIP_HOME}/logs/retrieveSigners.err"/> 

$TIPHOME/logs/retrieveSigners.out
CWPKI0314E: The following error is returned from an exception: 
ADMC0016E: The system cannot create a SOAP connector to connect to host 
localhost at port 31118.

SystemOut.log
[3/28/14 13:12:09:047 EDT] 0000005a SystemOut O 
SoapConnectorThreadPool : 0, handling exception: 
javax.net.ssl.SSLHandshakeException: Received fatal alert: 
handshake_failure 
[3/28/14 13:12:09:062 EDT] 0000005b SystemOut O 
SoapConnectorThreadPool : 1, handling exception: 
javax.net.ssl.SSLHandshakeException: Remote host closed connection 
during handshake 
[3/28/14 13:12:09:062 EDT] 0000005b SystemOut O SoapConnectorThreadP 
-----------------------------------------------------------------

To get additional debug information, you can run the retrieveSigners.sh command with the internal call to java in debug mode:


First edit the retrieveSigners.(sh or .bat) ( located in <TIP_HOME>/profiles/TIPProfile/bin and add the following debug parameter to this code in the retrieveSigners script:

if [ -f ${JAVA_HOME}/bin/java ]; then
JAVA_EXE="${JAVA_HOME}/bin/java -Djavax.net.debug=true"
else
JAVA_EXE="${JAVA_HOME}/jre/bin/java -Djavax.net.debug=true"
fi

execute the retrieveSigners from the command line:

<TIP_HOME>/profiles/TIPProfile/bin/retrieveSigners NodeDefaultTrustStore ClientDefaultTrustStore -autoAcceptBootstrapSigner -user tipadmin -password
<tipadmin password>

The output of the script should show an error simular to this:

JsseJCE: Using KeyGenerator IbmTlsRsaPremasterSecret from provider TBD 
via init 
JsseJCE: Using cipher RSA/SSL/PKCS1Padding from provider TBD via init 
%% Invalidated: [Session-2, SSL_RSA_WITH_RC4_128_MD5] 
main, SEND SSLv3 ALERT: fatal, description = handshake_failure 
main, WRITE: SSLv3 Alert, length = 2


RESOLVING THE PROBLEM
You will have to download and install the Unrestricted SDK JCE policy files. This is what you will see when you access the IBM site to download the files. 


[/support/docview.wss?uid=swg21669338&aid=1] [/support/docview.wss?uid=swg21669338&aid=1]
Please follow these directions to download and install the Unrestricted policy files needed to fix the retrieveSigners failure.

Hide details for Downloading and installing the unrestricted JCE policy files [/support/docview.wss?uid=swg21669338&amp;aid=2]Downloading and installing the unrestricted JCE policy files
Downloading and installing the unrestricted JCE policy files
In accordance with the United States of America export restrictions, Java™ that is 
bundled with the server has limited encryption key sizes that can be used in the 
server operation. In order to successfully convert signed client certificates or 
sign server Certificate Signing Request for use in the server, you have to replace 
the bundled encryption policy files with the unrestricted files published by IBM®.

Procedure
1. Go to https://www14.software.ibm.com/webapp/iwm/web/preLogin.do?source=jcesdk [https://www14.software.ibm.com/webapp/iwm/web/preLogin.do?source=jcesdk]. 
2. Provide your IBM ID and password and click Sign in. You might need to register with IBM to download the files. 
3. Select Unrestricted SDK JCE Policy files for Java 5.0 SR16, Java 6 SR13, Java 7 SR4 and later versions and then click Continue. 
4. View the license agreement and then select I Agree. 
5. Click Download Now. 
6. Install the files: 
IMPORTANT NOTE: Please save a backup copy of the US_export_policy.jar and local_policy.jar
a. Extract the file: unrestricted.zip into a directory of your choice. 
b. Copy the .jar files from the extraction directory to following directories: 
On the server installed on embedded WebSphere® Application Server:
- PRODUCT_INSTALLATION_DIR/jre/jre/lib/security 
- TIP_INSTALLATION_DIR/java/jre/lib/security 
On the server installed on base WebSphere Application Server:
- WEBSPHERE_INSTALLATION_DIR/AppServer/java/jre/lib/security 
- TIP_INSTALLATION_DIR/java/jre/lib/security 
7. Restart the server. 

After you have installed the new policy files, you can retry the Tivoli Integrated Portal upgrade.