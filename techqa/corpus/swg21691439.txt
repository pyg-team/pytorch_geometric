Title: IBM Adding a Virtual IP to PureData System for Analytics Cluster using the cib_tools script - United States

Text:
cib_tools; VIP; Virtual IP; adding a VIP; cluster IP TECHNOTE (FAQ)

QUESTION
 How do you add or remove an additional Virtual IP (or back-up VIP) to PureData System for Analytics Cluster? 

ANSWER
The cib_tool.pl script is used to modify Cluster Information Base (CIB) files. Its use is the preferred method for adding an additional Virtual IP to your PureData System. The cib_tools.pl script is located in the Netezza HWSUPPORT tools bundle available from the Fix Central website http://www-933.ibm.com/support/fixcentral/ [http://www-933.ibm.com/support/fixcentral/]
Once installed, the script will be located in the /opt/nz-hwsupport/pts/ directory.

NOTE: Although it is possible to added an additional VIP to the cluster without causing an outage, this activity should be performed during a scheduled maintenance window. 

Contact IBM Support via a PMR if issues or questions.

To add a VIP 

1) As root run the cib_tools.pl script

/opt/nz-hwsupport/pts/cib_tools.pl

2) Select option 2 to "Add virtual IP"

3) Provide the desired IP address when prompted

4) Provide the interface associated with the VIP when prompted eth# (or bond# if applicable)

5) Provide the subnet mask when prompted

6) Provide a descriptive name for the Virtual IP address when prompted.
**The value provided here will be used in the crm_mon output for the cluster resource added here.
**The value here should not contain special characters, and use _ as a separator "

Valid examples include:
backup_vip
myvip2

7) Verify the resource name associated with the new IP is listed as "started" and is ping-able 

Select option 7 to Display Resources (or exit the tool and run crm_mon -1). Ping the new IP to confirm that it is reachable on the active host.

Full EXAMPLE:

# cd /opt/nz-hwsupport/pts 
# ./cib_tools.pl 

Please select a number

1: Add addtional mount
2: Add virtual ip
3: Disable stonith
4: Enable stonith
5: Clear Failed resource
6: Delete a Resource
7: Display Resources

e: Exit
2 

Adding a VIP

Enter ip:
11.22.33.4

Enter ifcfg device
eth10

Enter subnet
20 <<<< / notation for 255.255.240.0

Enter name
backup_vip

# crm_mon -1
Last updated: Wed Jun 12 15:30:44 2014
Current DC: N1001a (111a11aa-1aaa-11a1-a1aa-11aa111111a)
2 Nodes configured.
3 Resources configured.
============

Node: N1001a (111a11aa-1aaa-11a1-a1aa-11aa111111a): online
Node: N1001b (111b11bb-1bbb-11b1-b1bb-11bb111111b): online

Resource Group: nps
drbd_exphome_device (heartbeat:drbddisk): Started N1001a
drbd_nz_device (heartbeat:drbddisk): Started N1001a
exphome_filesystem (heartbeat::ocf:Filesystem): Started N1001a
nz_filesystem (heartbeat::ocf:Filesystem): Started N1001a
fabric_ip (heartbeat::ocf:IPaddr): Started N1001a
wall_ip (heartbeat::ocf:IPaddr): Started N1001a
nz_dnsmasq (lsb:nz_dnsmasq): Started N1001a
mantravm (lsb:mantravm): Started N2001a
nzinit (lsb:nzinit): Started N1001a
backup_vip (heartbeat::ocf:IPaddr): Started N1001a
xdpapl0021-BVIP (heartbeat::ocf:IPaddr): Started N1001a
fencing_route_to_ha1 (stonith:apcmastersnmp): Started N1001b
fencing_route_to_ha2 (stonith:apcmastersnmp): Started N1001a


To delete this backup VIP, use the same tool, selecting option 6 "Delete a Resource"

Options to choose from:

1: Add addtional mount
2: Add virtual ip
3: Disable stonith
4: Enable stonith
5: Clear Failed resource
6: Delete a Resource
7: Display Resources

Select 6

It will display the resources that can be Deleted:

0. drbd_nz_device
1. exphome_filesystem
2. nz_filesystem
3. fabric_ip
4. wall_ip
5. nz_dnsmasq
6. nzinit
7. backup_vip
8. fencing_route_to_ha1
9. fencing_route_to_ha2
**Be cautious to select the correct number**

In our case, extra VIP, we enter '7'

WARNING:You are about to Delete resource "backup_vip".
Are you sure you want to delete?[y/n]
y


As with adding, it is safest to perform these steps during maintenance window.