Title: IBM IY90997: DB CRASHES WHEN A TABLE IS ACCESSED THAT WAS DROPPED FROM A     STORED PROCEDURE INVOKED FROM ANOTHER STORED PROCEDURE - United States

Text:
AIX 
APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 * DB CRASHES WHEN ACCESS ATTEMPTED ON A TABLE THAT WAS DROPPED
   FROM A STORED PROCEDURE INVOKED FROM ANOTHER STORED PROCEDURE
   OR WHILE A WITH HOLD CURSOR IS OPEN.
   
   THE PROBLEM OCCURS IN A EEE ENVIRONMENT IN WHICH A TABLE THAT
   DOES NOT HAVE A PARTITION ON THE COORDINATING NODE IS DROPPED.
   THE FOLLOWING ARE 2 SCENARIOS IN WHICH THE ATTEMPTED ACCESS TO
   SUCH A DROPPED TABLE CAN CAUSE A CRASH:
   1) A DROP TABLE AND A COMMIT IS ISSUED IN A STORED PROCEDURE
   THAT IS INVOKED BY ANOTHER PROCEDURE. IF THAT TABLE IS
   ACCESSED IN STATIC SQL FROM THE CALLING PROCEDURE AFTER
   RETURNING FROM THE PROCEDURE THAT DROPPED THE TABLE, A CRASH
   MAY OCCUR
   2) A WITH HOLD CURSOR IS OPEN ON BEHALF OF A PARTICULAR PACKAGE;
   IF A TABLE IS DROPPED AND A COMMIT IS ISSUED AND A STATIC SQL
   STATEMENT FROM THE SAME PACKAGE WITH THE WITH HOLD CURSOR
   ACCESS THAT TABLE, A CRASH MAY OCCUR.
   
   NOTE THAT EVEN IF A TABLE OF THE SAME NAME IS RECREATED
   IMMEDIATELY AFTER THE DROP, THE ACCESS TO THE TABLE IN ONE OF
   THE MANNERS DISCUSSED ABOVE WILL STILL CAUSE A CRASH.
   
   FOLLWING TRAP IS GENERATED.
   <STACKTRACE>
   -------FRAME------ ------FUNCTION + OFFSET------
   0X0900000001F9B4EC SQLODUMPEDU + 0X14
   0X0900000001FB23B0
   SQLBLOGERR__FIN41PCP16SQLB_OBJECT_DESCUIT8P13SQLB_MAP_INFO +
   0X350
   0X0900000001E34A44 SQLBRDPG + 0X134
   0X0900000001E1B9C8 SQLBREADPAGE + 0X1D0
   0X0900000001E1BE04 @18@SQLBGETPAGEFROMDISK__FP11SQLB_FIX_CBI +
   0X150
   0X0900000001E1B3E4 SQLBFIX__FP11SQLB_FIX_CB + 0X660
   0X0900000001E65348 @21@1@SQLBFIXPAGE__FP11SQLB_FIX_CBIUIT2 +
   0XD50
   0X0900000001C6EE2C
   @20@LOADSMSDESC__FP20SQLE_AGENT_PRIVATECBP8SQLD_TCBP16SQLB_OB
   JECT_DESCI + 0X298
   0X0900000001C6EB1C
   @20@LOADOBJDESC__FP20SQLE_AGENT_PRIVATECBP8SQLD_TCBP16SQLB_OB
   JECT_DESCI + 0XD0
   0X090000000214AFF4
   SQLDLOADTCB__FP20SQLE_AGENT_PRIVATECBP8SQLD_TCBI + 0X254
   0X0900000001E174A4
   SQLDLOCKTABLEFIXTCB__FP20SQLE_AGENT_PRIVATECBUST2UCIN65PCT5T1
   2_T5P14SQLP_LOCK_INFOPP8SQLD_TCB + 0X584
   STACK TRACEBACK UNAVAILABLE.
   </STACKTRACE>
   
   IN THE SAME TRAP FILE, THE FOLLOWING STACK IS ALSO RECORDED:
   <STACKTRACE>
   -------FRAME------ ------FUNCTION + OFFSET------
   0X0900000001F9B4EC SQLODUMPEDU + 0X14
   0X0900000001E64540
   SQLDDUMPCONTEXT__FP20SQLE_AGENT_PRIVATECBIN42PCPVT2 + 0XBC8
   0X0900000001CEE8A8
   SQLDROWINSERT__FP20SQLE_AGENT_PRIVATECBUST2UCIT5PP10SQLD_VALU
   EP13SQLD_TDATARECPUI + 0X218
   0X0900000001D36EE0
   SQLRINSR__FP8SQLRR_CBUST2IT2PP10SQLD_VALUEUIPUI + 0X9C
   0X0900000001D3705C SQLRIISR__FP8SQLRR_CB + 0XD0
   0X0900000001CA7C28 SQLRISECTINVOKE__FP8SQLRR_CBP12SQLRI_OPPARM +
   0X2C8
   0X0900000002907A3C SQLRR_DSS_ROUTER__FP8SQLRR_CB + 0X9D0
   0X09000000031663AC
   SQLRR_SUBAGENT_ROUTER__FP20SQLE_AGENT_PRIVATECBP10SQLE_DB2RA
   + 0XAA0
   0X0900000003165164 SQLESUBREQUESTROUTER__FP13SQLE_AGENT_CBPUIT2
   + 0X2EC
   0X09000000025AC250 SQLEPROCESSSUBREQUEST__FP13SQLE_AGENT_CB +
   0X200
   0X0900000001F71928 SQLERUNAGENT__FPCUI - 0X768
   0X0900000001F2C4C8
   SQLOCREATEEDU__FPFPCUI_VPCULP13SQLO_EDU_INFOPI + 0X330
   0X0900000001F2BB68 @38@SQLORUNGDS__FV + 0X14
   0X0900000001F2BA64 SQLOINITEDUSERVICES + 0X138
   0X0900000001F2D1B8 SQLORUNINSTANCE + 0X424
   0X0000000100002A48 DB2MAIN + 0X8A4
   0X0000000100003880 MAIN + 0X10
   </STACKTRACE>
   
   
   DIAGLOG:
   THE FOLLOWING ERRORS ARE RECORDED IN DB2DIAG.LOG AND DB IS
   MARKED BAD EVENTUALLY.
   
   FUNCTION: DB2 UDB, BUFFER POOL SERVICES, SQLBRDPG, PROBE:1110
   RETCODE : ZRC=0X870F0009=-2029060087=SQLO_EOF "THE DATA DOES NOT
   EXIST"
   DIA8506C UNEXPECTED END OF FILE WAS REACHED.
   FUNCTION: DB2 UDB, BUFFER POOL SERVICES, SQLBRDPG, PROBE:1110
   DATA #1 : STRING, 85 BYTES
   OBJ={POOL:2;OBJ:10;TYPE:0} STATE=X0 PAGE=0 CONT=0 OFFSET=0
   BLKSIZE=13
   UNEXPECTED EOF
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 * DB CRASHES WHEN A TABLE IS ACCESSED THAT WAS DROPPED FROM A
   STORED PROCEDURE INVOKED FROM ANOTHER STORED PROCEDURE
   
    
   
   

PROBLEM CONCLUSION
 * FIRST FIXED IN DB2 UDB VERSION V9.1, FIXPAK 1
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IY90997
   
   
 * REPORTED COMPONENT NAME
   DB2 UDB ESE AIX
   
   
 * REPORTED COMPONENT ID
   5765F4100
   
   
 * REPORTED RELEASE
   910
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-10-24
   
   
 * CLOSED DATE
   2009-06-30
   
   
 * LAST MODIFIED DATE
   2009-06-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    IY86749 [http://www-01.ibm.com/support/docview.wss?uid=swg1IY86749]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 UDB ESE AIX
   
   
 * FIXED COMPONENT ID
   5765F4100
   
   

APPLICABLE COMPONENT LEVELS
 * R910 PSY
   UP