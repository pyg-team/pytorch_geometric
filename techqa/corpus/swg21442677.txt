Title: IBM Session Manager menu sessions intermittently display as UNAVAIL status for TSO - United States

Text:
vtam inquire appstat; 5655U9800 5655U98 5655-U98 HSMX100 HSMX200 JSMX101 JSMX201 R200 5655K0100 R300 5655-K01 5655K01 FMID HISZ300 5697N6100 R100 R10E R10K R200 R20E R20K 5697-N61 5697N61 FMID HIQW100 JIQW101 HIQW200 JIQW201 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are using IBM Session Manager for z/OS (ISM) and your menu of sessions intermittently displays a status of UNAVAIL for some TSO sessions. 

CAUSE
VTAM (z/OS Communications Server) only searches for a maximum limit of 999 model definition statements for TSO. If your APPL for TSO specifies ACBNAME=TSO*, this can result in up to 9999 suffixes.

ENVIRONMENT
ISM V3

DIAGNOSING THE PROBLEM
1) Issue modify command:

F net,TRACE,TYPE=VTAM,MODE=INT,DSPSIZE=5
in all LPARs where ISM runs and issues the INQUIRE APPSTAT and in the LPAR where the TSO application is defined as a local APPL.

You should see the following when setting this trace:

IST097I MODIFY ACCEPTED
IST315I VTAM INTERNAL TRACE ACTIVE - MODE = INT, SIZE = 999 PAGES
IST1659I DATA SPACE ISTITDS1 DSPSIZE = 5 (50M)
IST199I OPTIONS = NONE
IST314I END


2) Issue modify command:

F net,CSDUMP
in all LPARs as soon as ISM displays the status as UNAVAIL when you know it should be AVAIL.

You should see the following when capturing the CSDUMP:

IEA045I AN SVC DUMP HAS STARTED AT TIME=hh.mm.ss DATE=mm/dd/yyyy
FOR ASID (nnnn)
IST1881I VTAM DUMPING FOR CSDUMP - IMMEDIATE DUMP
IST223I MODIFY CSDUMP COMMAND COMPLETED
IEA794I SVC DUMP HAS CAPTURED:
DUMPID=nnn REQUESTED BY JOB (NET )
DUMP TITLE=ISTRACSW - DEFAULT CSDUMP WITH ISTITDS1 - ID=zzzz

The IPCS VTAM dump analysis for General data will display the VTAM VIT. Do a FIND on the TSO appl name. A preceding AI1 entry for the INQUIRE will begin with x'C1C9F11A' where the x'1A' is for the INQUIRE APPSTAT. There should be a subsequent RE RPL exit entry with x'D9C51A' for the completion. The RE entry in bytes 5, 6, and 7 contain the RPLRTNCD, RPLFDB2, and RPLFDB3 respectively.

If RPLFDB3 is anything other than x'00' the INQUIRE APPSTAT did not find the TSO APPLID available for logons. RPLFDB3 is explained in the SNA Programming manual [http://publib.boulder.ibm.com/infocenter/zos/v1r13/topic/com.ibm.zos.r13.istprg0/inqlu.htm?path=8_31_15_11#inqlu].

In this example, the first CSDUMP is from where ISM runs and issues the INQUIRE APPSTAT that results in RPLFDB3 value of x'04' indicating the TSOXXX applid is inactive. The VTAM VIT has 2 instances of the RPLFDB3 x'04' for TSOXXX. Here are the relevant AI1, AI2, and RE VIT entries. 


[/support/docview.wss?uid=swg21442677&aid=1] [/support/docview.wss?uid=swg21442677&aid=1]

Here is the next occurrence in the VIT. 

[/support/docview.wss?uid=swg21442677&aid=2] [/support/docview.wss?uid=swg21442677&aid=2]
Byte 7 of the RE entries for the x'1A' INQUIRE is the RPLFDB3 value of x'04'. 

Here is the TSO VTAM definition from the TSOXXX LPAR: 

[/support/docview.wss?uid=swg21442677&aid=3] [/support/docview.wss?uid=swg21442677&aid=3]
And here is the TSO VTAM definition from ISM LPAR: 

[/support/docview.wss?uid=swg21442677&aid=4] [/support/docview.wss?uid=swg21442677&aid=4]


RESOLVING THE PROBLEM
Modify VTAM VBUILD statement for TSIP. Change 'ACBNAME=TSO*' to 'ACBNAME=TSO0*' <--this change will limit the number of TSO users to 999. This change will allow the ISM Inquire Applstat code to not find the model definition for TSO locally and to continue with Direct Search logic, looking for the TSO application outside the local domain.



RELATED INFORMATION
#IBM Session Manager for z/OS Support Page [http://www.ibm.com/support/entry/portal/Overview/Software/Other_Software/IBM_Session_Manager]
Request Routing for VTAM Inquire Appstat [http://publib.boulder.ibm.com/infocenter/zos/v1r13/topic/com.ibm.zos.r13.istimp0/f1a1b5b0306.htm?path=8_27_22_8_3#wq927]
VTAM Model search for TSO APPL [http://publib.boulder.ibm.com/infocenter/zos/v1r13/topic/com.ibm.zos.r13.istrdr0/od99.htm?path=8_32_4_1_5_34#modsrch]
Using model application program definitions for TSO/VTA [http://publib.boulder.ibm.com/infocenter/zos/v1r13/topic/com.ibm.zos.r13.istimp0/f1a1b5b0416.htm?path=8_27_26_0_0_2#wq1185]
Using BASENAME to define TSO/VTAM applications programs [http://publib.boulder.ibm.com/infocenter/zos/v1r13/topic/com.ibm.zos.r13.istimp0/f1a1b5b0417.htm?path=8_27_26_0_0_3#wq1188]






Cross reference information Segment Product Component Platform Version Edition Networking z/OS Communications Server 
PRODUCT ALIAS/SYNONYM
 ISM