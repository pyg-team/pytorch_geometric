Title: IBM TRIRIGA Anywhere "Packet for query is too large" error when uploading WorkTaskManagement-10.4.1.apk file - United States

Text:
TRIMOBILE; WorkTaskManagement; MySQL; WebSphere; max_allowed_packet; Worklight; TRICONFIG TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Getting the following error message when uploading WorkTaskManagement-10.4.1.apk into IBM Worklight Application Center: "File WorkTaskManagement-10.4.1.apk not uploaded.". On WebSphere logs we will see as well the message: “Packet for query is too large”. 

SYMPTOM
In the IBM Worklight Application Center, we are getting a message that says, "File WorkTaskManagement-10.4.1.apk not uploaded.".

In the WebSphere SystemOut.log and SystemErr.log files we will see the following messages as well:

000000fa UploadService E Exception during resource upload. The transaction has been rolled back. See the nested exceptions for details on the errors that occurred. 
000000fa UploadService E { 
"id": "3f3a083f-e32b-401c-a87b-b3158a6521a7",
"message": "FWLAC0000E: A server error was detected.",
"params": [
],
"productVersion": "6.1.0"
}

com.ibm.puremeap.resources.exceptions.SystemException: The transaction has been rolled back. See the nested exceptions for details on the errors that occurred.
at com.ibm.puremeap.resources.data.impl.ApplicationResourceHelper.createContent(ApplicationResourceHelper.java:502)
at com.ibm.puremeap.services.UploadService.fileUploaded(UploadService.java:255)
(...)
Caused by: org.apache.openjpa.lib.jdbc.ReportingSQLException: Packet for query is too large (36027622 > 33554432). You can change this value on the server by setting the max_allowed_packet' variable. {prepstmnt 1518851989 INSERT INTO APPLICATION_STORAGE (CONTENT, AP_FK) VALUES (?,?) [params=(InputStream) java.io.ByteArrayInputStream@f7314132, (null) null]} [code=0, state=S1000]
at org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator.wrap(LoggingConnectionDecorator.java:192)
at org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator.access$700(LoggingConnectionDecorator.java:57)
at org.apache.openjpa.lib.jdbc.LoggingConnectionDecorator$LoggingConnection$LoggingPreparedStatement.executeUpdate(LoggingConnectionDecorator.java:866)
at org.apache.openjpa.lib.jdbc.DelegatingPreparedStatement.executeUpdate(DelegatingPreparedStatement.java:269)
(...)
com.ibm.websphere.ce.cm.StaleConnectionException: Packet for query is too large (36027622 > 33554432). You can change this value on the server by setting the max_allowed_packet' variable.



CAUSE
The MySQL database max_allowed_packet parameter value is not enough for accommodating the package upload transaction.

ENVIRONMENT
IBM TRIRIGA Platform 3.4.1.1
IBM TRIRIGA Application 10.4.1.1
IBM WebSphere Application Server 8.5.5.1
Database MySQL Community Server 5.6.23

DIAGNOSING THE PROBLEM
D1) Go to IBM Worklight Application Center and upload file WorkTaskManagement-10.4.1.apk ;

D2) The following messages will be received: "File WorkTaskManagement-10.4.1.apk not uploaded.".

D3) WebSphere SystemOut.log and SystemErr.log files will show the following on a Java stack trace error message: “com.ibm.websphere.ce.cm.StaleConnectionException: Packet for query is too large”.

RESOLVING THE PROBLEM
The resolution is to make the MySQL database max_allowed_packet parameter value higher to accommodate the package upload transaction (required is 36027622, current setting is 33554432). After that you needed to restart your MySQL service (database). For more information on how to change MySQL 3rd party max_allowed_packet parameter, consult your DBA or MySQL forums.

RELATED INFORMATION
 IBM TRIRIGA Anywhere [https://www.ibm.com/developerworks/community/wikis/home?lang=us#!/wiki/IBM%20TRIRIGA1/page/IBM%20TRIRIGA%20Anywhere]