Title: IBM JR50439: IDOC messages might get lost if you stop the application during load test if using standa-lone SAP Adapter - United States

Text:
  DIRECT LINKS TO FIXES
8.5.5.0-WS-BPM-IFJR50439 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Advanced&fixids=8.5.5.0-WS-BPM-IFJR50439-ADV&source=SAR]
7.5.1.1-WS-BPMADVWESB-IFJR50439 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FWebSphere%2FIBM+Business+Process+Manager+Advanced&fixids=7.5.1.1-WS-BPMADVWESB-IFJR50439-ADV&source=SAR]
Download Version 8.0.1 Fix Pack 3 for the IBM Business Process Manager products [http://www-01.ibm.com/support/docview.wss?uid=swg24037734]
Version 8.5 Refresh Pack 6 for the IBM Business Process Manager products [http://www-01.ibm.com/support/docview.wss?uid=swg24039185]
Version 8.5.0 Fix Pack 2 for the IBM Business Process Manager products [http://www-01.ibm.com/support/docview.wss?uid=swg24040683]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  If you use a standalone SAP Adapter to send IDOC messages to
   an SCA module, and you stop the application when the SAP
   Adapter is still sending the messages during load test, some
   of the IDOC messages might be lost. The problem will not occur
   if you stop the SAP Adapter first or use embedded SAP Adapter.
   
   
    
   
   

LOCAL FIX
 *  The problem will not occur if you pause the SAP Adapter
   endpoint first using wsadmin which will terminate the SAPJCo
   listeners and effectively prevent IDOCs from reaching the SCA
   application. Then the SCA module can be stopped safely.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  IBM Business Process Manager (BPM)          *
   *                  Advanced                                    *
   ****************************************************************
   * PROBLEM DESCRIPTION: If you use a standalone SAP Adapter     *
   *                      to send IDOC messages to an SCA         *
   *                      module, and you stop the application    *
   *                      when the SAP Adapter is still sending   *
   *                      the messages during load test, some     *
   *                      of the IDOC messages might be lost.     *
   *                      The problem will not occur if you       *
   *                      stop the SAP Adapter first or use       *
   *                      embedded SAP Adapter.                   *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   When the SCA module is stopping, it is still receiving the
   IDOC messages from the SAP Adapter, but the SCA runtime has
   concurrently started cleaning up application re-sources. This
   results in errors while trying to  serialize some of the
   business objects in the  messages. No failure message is sent
   back to the SAP Adapter, resulting in IDOC mes-sages being
   lost.
   ===== The following was added on 3/13/2015:
   The root cause of this issue is a lot of QName instances being
   put into an ArrayList which is contained in a HashMap, causing
   the heap memory consumption to increase, likely eventually
   causing an OutOfMemory problem.
   
   When analyzing a java dump (a .phd file), the Memory Analyzer
   would show something similar to the following as a leak
   suspect:
   
   11,862,465 instances of "javax.xml.namespace.QName", loaded by
   "<system class loader>" occupy 888,253,040 (58.83%) bytes
   
   The heap analyzer would show something like this:
   
   942,701,832 (60%) [24] 1 java/util/ArrayList 0x759e20b40
     942,701,808 (60%) [54,593,368] 11,859,054 array of
   java/lang/Object 0x78b400610
       192 (0%) [32] 3 javax/xml/namespace/QName 0x759e20db0
       184 (0%) [32] 3 javax/xml/namespace/QName 0x790a5a040
       184 (0%) [32] 3 javax/xml/namespace/QName 0x75f7e82e8
       184 (0%) [32] 3 javax/xml/namespace/QName 0x78954a808
       184 (0%) [32] 3 javax/xml/namespace/QName 0x75ec91fc8
       There are 11,859,049 more children
   =====
   
   
    
   
   

PROBLEM CONCLUSION
 *  A fix is available for IBM BPM V8.0.1.1 that forces the SCA
   runtime to return an exception message to the SAP Adapter so
   that the Adapter will roll back the transaction, preventing
   the loss of IDOC messages.
   On Fix Central (http://www.ibm.com/support/fixcentral), search
   for JR50439:
   1. Select IBM Business Process Manager with your edition from
   the product selec-tor, the installed version to the fix pack
   level, and your platform, and then click Continue.
   2. Select APAR or SPR, enter JR50439, and click Continue.
   When you download fix packages, ensure that you also download
   the readme file for each fix. Review each readme file for
   additional installation instructions and information about the
   fix.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   JR50439
   
   
 * REPORTED COMPONENT NAME
   BPM ADVANCED
   
   
 * REPORTED COMPONENT ID
   5725C9400
   
   
 * REPORTED RELEASE
   801
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2014-06-06
   
   
 * CLOSED DATE
   2014-07-11
   
   
 * LAST MODIFIED DATE
   2015-03-13
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   BPM ADVANCED
   
   
 * FIXED COMPONENT ID
   5725C9400
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY
   UP