Title: IBM Missing summarized data in the "Error Log" data warehouse tables after the upgrade to ITCAM Agent for WebSphere Messaging Version 730 - United States

Text:
Error Log 5724K3500 5724K3500TR TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The Summarization and Pruning agent fails to write data into the DB2 data warehouse hourly, daily, weekly, monthly, quarterly and yearly summarized tables of the Error Log attribute group. 

CAUSE
New attributes added to Error Log tables caused the size of the summarized warehouse tables for this group to cross the 4K DB2 tablespace boundary. As a consequence, the Summarization and Pruning agent fails in adding the new columns to the table definitions. Look for this error in the Summarization and Pruning RAS1 logs:

statement name : Error_Log_H.Alt1
SQL : ALTER TABLE "DBTDWD"."Error_Log_H" ADD
"LAT_Program_Name" VARCHAR (48)
template SQL :
== 1397704 t=work5 SQLException occured. SQL State = 54010 , SQL Error
Code = -670
== 1397705 t=work5 com.ibm.db2.jcc.am.SqlException: The statement
failed because the row size of the resulting table would have exceeded
the row size limit. Row size limit: "4005". Table space name:
"USERSPACE1". Resulting row size: "4036".. SQLCODE=-670,
SQLSTATE=54010, DRIVER=3.67.26

If this occurs, no new rows are written into the hourly, daily, weekly, monthly, quarterly and yearly summary "Error Log" tables. The detail Error log historical table is not affected.


RESOLVING THE PROBLEM
This problem is tracked via APAR IV77658 and product documentation will be updated and SQL scripts will be provided in TEPS directories in next maintenance deliverable. However, until that is done, the SQL scripts are attached. 


Complete these steps only if the following conditions apply:


 * Upgrading to V730 from earlier versions 
 * Summarization tables for Error Log attribute group have been created prior to V730 
 * Using DB2 for Linux, UNIX, or Windows as your warehouse database 


The Error Log attribute group has had new columns added. As a result, the row size for some summarization tables will exceed the 4K table space. Scripts have been provided to move the tables from 4K to 8K tablespace. If the Summarization and Pruning Agent is started and collects data against V730 agent before these scripts are run, SQL errors will occur when attempting to alter tables to add new columns. 
The following scripts have been provided for each of the tables that require move from 4K to 8K tablespace: 

kmq_730migr_Error_Log_H.sql for hourly table Error_Log_H
kmq_730migr_Error_Log_D.sql for daily table Error_Log_D
kmq_730migr_Error_Log_W.sql for weekly table Error_Log_W
kmq_730migr_Error_Log_M.sql for monthly table Error_Log_M
kmq_730migr_Error_Log_Q.sql for quarterly table Error_Log_Q
kmq_730migr_Error_Log_Y.sql for yearly table Error_Log_Y

Upgrade procedure for any of the above tables that exist:
1. Stop all running Warehouse Proxy agent instances and the Summarization and Pruning agent.
2. Back up your warehouse database.
3. Copy the scripts attached to a temporary directory on the system where the warehouse database is located: 
4. On the system where the warehouse database is located, change to the directory where you placed the script files in Step 3 [http://www-01.ibm.com/support/knowledgecenter/SSTFXA_6.3.0/com.ibm.itm.doc_6.3/osunix/newattsdb2.htm?lang=en-us#newattsdb2__copyscriptsdb2]. Then, connect to the warehouse database through the DB2Â® command line with a user ID that has the authorization to alter and load tables and drop views. Run commands based on the following example to connect, set the schema, and save the script to an output file: 
db2 connect to WAREHOUS user ITMUSER using ITMPASS
db2 set current schema="ITMUSER"
db2 -tv -z log/script.sql.log -f script.sql
These parameters are used in the example: 

 * WAREHOUS is the database name. 
 * ITMUSER is the user name used by the Warehouse Proxy agent. 
 * ITMPASS is the password used by the Warehouse Proxy agent. 
 * script.sql is the name of the script file. See Table 1 [http://www-01.ibm.com/support/knowledgecenter/SSTFXA_6.3.0/com.ibm.itm.doc_6.3/osunix/affectedattrgroups.htm?lang=en-us#affectedattrgroups__attgroupsandscripts] for the script file names. 
 * script.sql.log is the name of the output file.

Notes: You might receive error messages such the following from DB2:  * SQL0204N "schema name.table name" is an undefined name. SQLSTATE=42704 

This message indicates that the table named table name does not exist and cannot be altered or dropped. This happens if you do not have warehousing or summarization enabled for the given table. For example if you only have hourly and daily summarization enabled, you see this message for the weekly, monthly, quarterly, and yearly summarization tables because these tables do not exist.  * SQL3304N The table does not exist. 

This message indicates that the table does not exist and cannot be loaded. This happens if you do not have warehousing or summarization enabled for the given table. For example if you only have hourly and daily summarization enabled, you see this message for the weekly, monthly, quarterly, and yearly summarization tables because these tables do not exist. 

kmq_730migr_Error_Log_H.sql [/support/docview.wss?uid=swg21968531&aid=2]kmq_730migr_Error_Log_H.sql [/support/docview.wss?uid=swg21968531&aid=1] 
kmq_730migr_Error_Log_D.sql [/support/docview.wss?uid=swg21968531&aid=4]kmq_730migr_Error_Log_D.sql [/support/docview.wss?uid=swg21968531&aid=3] 
kmq_730migr_Error_Log_W.sql [/support/docview.wss?uid=swg21968531&aid=6]kmq_730migr_Error_Log_W.sql [/support/docview.wss?uid=swg21968531&aid=5] 
kmq_730migr_Error_Log_M.sql [/support/docview.wss?uid=swg21968531&aid=8]kmq_730migr_Error_Log_M.sql [/support/docview.wss?uid=swg21968531&aid=7] 
kmq_730migr_Error_Log_Q.sql [/support/docview.wss?uid=swg21968531&aid=10]kmq_730migr_Error_Log_Q.sql [/support/docview.wss?uid=swg21968531&aid=9] 
kmq_730migr_Error_Log_Y.sql [/support/docview.wss?uid=swg21968531&aid=12]kmq_730migr_Error_Log_Y.sql [/support/docview.wss?uid=swg21968531&aid=11]