Title: IBM Procedure to install a DB2 special build or fix pack on an IBM Smart Analytics System - United States

Text:
BCU; Balanced Warehouse; software level; firmware level; version; Smart Analytics System; balanced configuration unit; ISAS TECHNOTE (FAQ)

QUESTION
 How do I manually install a DB2 special build or DB2 fix pack on an IBM Smart Analytics System? 

ANSWER
If your system is installed with the IBM Smart Analytics System Control Console software, use an IBM Smart Analytics System fix pack available on Fix Central to update your software stack. If the DB2 fix you need is not available in an IBM Smart Analytics System fix pack or your system does not have the control console software installed, use the instructions in this document to manually install a DB2 special build or DB2 fix pack on your IBM Smart Analytics System. 
Before you begin
This document uses the following variables. Substitute the appropriate values for your environment. 



Variable name Example name to use Notes MGMT, ADMIN, ADMIN_ALL, DATA, STANDBY [/support/docview.wss?uid=swg21502587&amp;aid=1] These variables refer to the role of the different servers. Replace each variable with the appropriate host names from your environment.  * MGMT = management node used to manage all nodes in the cluster. 
 * ADMIN = administration node or NODE0000 or primary coordinator node. 
 * ADMIN_ALL = all coordinator nodes 
 * DATA = all data nodes in the core warehouse 
 * STANDBY = all standby nodes the core warehouse

BCU_share  * All AIX systems: /BCU_share 
 * 5600 systems: /BCU_share 
 * D5000 and D5100: /csminstall

[/support/docview.wss?uid=swg21502587&amp;aid=1] install_path  * AIX systems: /usr 
 * Linux systems: /opt

The installation path is operating-system dependent. You can use the db2level command to validate the current installation path. hostname bcudata001 Use the appropriate server host name. date 20110801 Use the format YYYYMMDD, where YYYY represents a 4-digit year, MM represents a 2-digit month, and DD represents a 2-digit month. new_path_to_fixpack DB2_97fp1 Use a name that clearly labels the directory with the product, version, and build number (if you are applying a special build). If you need to install the product in the future, this naming convention will allow you to easily identify the product and correct version to install. nlpack_path NLPack_97fp1 Use a name that clearly identifies the national language pack content and the version contained in the directory. instance_user db2inst1 The name of the DB2 instance owner. fenced_user db2fenc1 The name of the DB2 fenced user. You can find the fenced user name and group by looking at the owner and group of the following file:
ls -l ~<instance_user>/sqllib/adm/.fenced 
Note: You can use any utility you prefer to issue remote commands to the servers in the cluster. If you choose not to use a remote command utility, you can log on to each server and run the commands locally. 

Procedure 
1. Mount the installation media directory from the management node  * 
 *  For IBM Smart Analytics System 7600 or 7700, Balanced Warehouse E7100, or IBM Smart Analytics System 5600 environments, issue the following command as root on ADMIN_ALL, DATA, and STANDBY nodes:  * 
    * 
    * 
   
   For Balanced Warehouse D5000 or D5100 environments, issue the following command as root on ADMIN_ALL, DATA, and STANDBY nodes:  * 
   
   
 * Note: In newer configurations, the /BCU_share directory has replaced the /csminstall directory. If you mounted the /csminstall directory, substitute /csminstall for /BCU_share as you follow the instructions in this document. Alternatively, you can create a symbolic link. 
 * 
 * 
 * ln -s /csminstall /BCU_share 
   
   
 * 
 * new_path_to_fixpack
 * 
 * nlpack_path
 * 
 * 
 * 

2. Download the necessary files  * 
 *  If you are applying a special build, your technical support engineer will provide you with the correct download instructions. If you are applying a generally available DB2 fix pack, download the universal build (called the DB2 Universal Fix Pack or DB2 Universal Build) from the following Fix Central page:
   http://www.ibm.com/support/docview.wss?uid=swg27007053 [http://www.ibm.com/support/docview.wss?uid=swg27007053] 
 * 
 * 
 * Verify that the version of the NLPack you download matches the version of the special build or the fix pack you downloaded in step 2a. 
 * 
 * 
 * new_path_to_fixpack
 * 
 * nlpack_path
 * 
 * 
 * 
 * 
 *   * uncompress <filename> or gunzip <filename> 
    * tar xvf <filename>.tar
   
   


3. Copy the contents of the SApolicy directory  * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * 
 * cd /usr/sbin/rsct/sapolicies/db2/ 
   
 * 
 * tar cvf /BCU_share/sapolicies.save.tar * 
   
   

4. Disable high availability (HA) if it is enabled  * 
 * 
 * 
 * samctrl -M T 
   
   
 * 
 * chrsrc -c IBM.PeerNode CritRsrcProtMethod=5 



5. Stop the instance  * 
 * db2stop force 
 * 
 * 
 * ps -ef | grep db2 
   
   
 * 
 * db2_kill 
   
   
 * 
 * /< install_path>/IBM/dwe/db2/V9.7/bin/db2fmcu -d 
   
   
 * 
 * /< install_path>/IBM/dwe/db2/V9.7/bin/db2fm -i < instance_name> -D 
   
   

 * 
 * 
 * 
 * 
 * 
 * 
 * Note
 * 
 * Running the installfixpack command may fail with errors from db2chglibpath (#1598819)
 * 
 * 

6. Install the fix pack or special build and update the instance 

Note: The "-f NOTSAMP" option specifies that Tivoli SAMP or RSCT are not updated as part of the DB2 installation process. For fix packs 3a and higher, Tivoli SAMP and RSCT are updated by default, and will cause the scripts in /usr/sbin/rsct/sapolicies/db2/ to be overwritten. Use the following steps to install maintain the same Tivoli SAMP and RSCT version and to keep the SApolicy scripts from being overwritten.  * 
 * 
 * /BCU_share/< new_path_to_fixpack>/installFixPack -b /< install_path>/IBM/dwe/db2/V9.7 -c /BCU_share/< nlpack_path> -f NOTSAMP -f install > /tmp/update_< hostname>_< date>.log 
   
   
 * 
 * grep execution /tmp/update_< hostname>_< date>.log 
 * For each node you should see the following text: 
   < hostname>: The execution completed successfully. 
   
   
 * 
 * As the root user on the ADMIN node, issue the following commands: 
   cd /< install_path>/IBM/dwe/db2/V9.7/instance 
   ./db2iupdt -u <fenced_user> <instance_user> 
   
   
 * 
 * /< install_path>/IBM/dwe/db2/V9.7/bin/db2fmcu -d 
   
 * 
 * i) To remove the instance record which refers to the old DB2 path, issue  * 
    * install_path
    * 
    * <instance_user>
    * 
   
   ii) Add the instance record which refers to the new DB2 path, issue  * 
    * install_path
    * 
    * <instance_user>
    * 
    * 
   
   
 * 
 * rah db2level 
 * 
 * 
 * db2start 
 * 
 * 
 *   *  Verify that users can connect to all nodes 
    *  Activate the database or follow your normal procedures to release the system to the user community 
    *  Run the SELECT command against a partitioned table
   
   
 * 
 * 
 * Binding bind files after installing fix packs
 * 
 * 
 * 
 * 
 * 
 * 
 * db2updv97 - Update database to Version 9.7 fix pack command
 * 



7. Restore the SApolicy scripts  * 
 * 
 * 
 * 
 * 
 * 
 * 
 * cd /usr/sbin/rsct/sapolicies/db2/ 
 * 
 * 
 * tar xvf /BCU_share/sapolicies.save.tar 
 * 

8. Enable high availability (HA) if required  * 
 * chrsrc -c IBM.PeerNode CritRsrcProtMethod=1 
 * 
 * 
 * samctrl -M F 



Backout procedure (optional) 
If you need to revert the fix pack update, you will use a procedure similar to the steps described previously, except you will use a different command in step 6a. Use the following steps to back out from a fix pack update. 

a. Complete steps 1 and 2 previously discussed in this document to download the appropriate universal build and national language pack files. Alternatively you can use files in the /BCU_share directory if you maintained them from a previous installation. 

b. Complete steps 3 to 5 previously discussed in this document. 

c. Run the following command instead of the command specified in step 6a. Issue the following command as the root user on the ADMIN_ALL, DATA, and STANDBY nodes:  * 
 * new_path_to_fixpack
 * 
 * install_path
 * 
 * nlpack_path
 * 
 * hostname
 * 
 * date
 * 


d. Complete steps 6b to 8. RELATED INFORMATION
 How to configure dsh [http://www.ibm.com/support/docview.wss?uid=swg21515254]