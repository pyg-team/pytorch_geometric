Title: IBM IZ82779: INVALID DATE FORMAT ERROR IF LOCALE EN_AU WHEN INITIATING A WORKFLOW PROCESS OR USING SLA ACTION - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Invalid date format error if locale en_AU when initiating a
   workflow process or using SLA action
   
   URGENCY DUE TO GO-LIVE in August client requesting fix.
   
   I was asked to create a APAR and submit a hotfix ?
   
   ____________
   
   Development response:
   
   Hi, Gurmeet.
   
   I searched for MXFormat.dateTimeToString in my environment with
   latest SP code + Core 7116 and found 27 hits. But only 1 in
   Service Provider.
   Most of the 26 hits on Core uses a signature of this method
   passing Date, Locale and TimeZone. In our case we pass only the
   Date.
   
   If we change our code to use the Locale and TimeZone (TimeZone
   might not have relation to this issue, but it's ok to pass it
   too), like we have on Core, I think that the issue will be
   solved since according to the email thread this error happens
   when using locale en_AU.
   
   I agree that an APAR is required.
   
   Regards,
   
   Hilton Bertelli Ferreira Filho
   Staff Software Engineer,
   IBM Maximo for Service Providers Team Lead
   ___________
   
   Looks like our issue...
   
   Code...
   
      java.util.Date reportdate = null;
      try
      {
       reportdate = mbo.getDate("reportdate");
      }
      catch (Exception e)
      {
      }
      if ( reportdate == null  )
       reportdate = MXServer.getMXServer().getDate();
   
      sqf.setObject(
        3,
        "SLA",
        "startdate",
         MXFormat.dateTimeToString(reportdate));
     String where = sqf.format();
     if(useHeaderAttr)
     {
      where = moreSLAWhere(mbo, where);
     }
   
     return(where);
   
   Not sure why we are doing...
   MXFormat.dateTimeToString(reportdate)), shouldnt  we use
   setDate()...
   
   Search for sqf.setDate in core and we will see alot of
   examples...
   
   If you agree, we should just ask to open an APAR.
   
   Thanks,
   Gur.
   
   ________________________________________________________________
   
   ***Steps to replicate
   
   I tested on windows product and it worked fine, setup workflow
   process and user (maxadmin) with en_AU locale. But client
   already
   mentioned the problem only happens on AIX environments.
   
   In the steps to reproduce, the workflow TEST_ACT calls the
   APPLYSLA action. Please check details of the PMR regarding how
   to create
   this workflow.
   
   **Steps to replicate
   
   Alter the default locale
   
   _______
   
   1. Log into MAXIMO as maxadmin user.
   2. Navigate to the user application and bring up user "maxadmin"
   record
   in
   the main tab.
   3. Update the following fields:
         Language = EN
         Locale = en_AU
         TimeZone = Australia/Victoria
   4. Save the record.
   5. Log out of MAXIMO
   6. Log into MAXIMO again
   
   Setup of workflow/creating SR record routed into workflow to
   produce error.
   
   ________
   
   Create test workflow "TEST_ACT" in workflow designer with a just
   the start and end nodes.
   
   Choose the Object as SR.
   
   Join the start node and end node with a positive line.
   In the positive line add the action SRAPPLYSLA.
   
   SRAPPLYSLA is an action that calls the default maximo action
   APPLYSLA.Save, enable and activate the workflow.
   
   Raise a test Service Request and from the SR, do select action /
   workflow / Route Worlkflow. Choose TEST_ACT workflow.
   
   Error message is displayed:
   BMXAA0044E - Application action APPLYSLA could not run.
   BMXAA4143E - The date format is not valid.
   
   With regard to your reply that the workflow does not have any
   nodes - this is incorrect and not acceptable,
   There is a Start Node, an Action Line containing the APPLYSLA
   action and a Stop Node. The workflow is also activated and
   enabled via's
   MAXIMO's validation processes.
   
   Reproduce links:
   
   https://ecurep.mainz.de.ibm.com/aexfiles/pmr/0/3/03318%2C999%2C6 [https://ecurep.mainz.de.ibm.com/aexfiles/pmr/0/3/03318%2C999%2C6]
   16/mail20100729-034544-Sanjay_Shirke/SR13303.1.doc
   
   https://ecurep.mainz.de.ibm.com/aexfiles/pmr/0/3/03318%2C999%2C6 [https://ecurep.mainz.de.ibm.com/aexfiles/pmr/0/3/03318%2C999%2C6]
   16/mail20100729-034544-Sanjay_Shirke/SR13303.doc
   ________________________________________________________________
   
   
   PMR Information:
   
   Prob: Invalid date format error if locale en_AU when initiating
   a workflow process or using SLA action.
   
   Envir: TSRM 72 over CCMDB 72, BS 7115, DB2, Websphere
   
   Error:
   
   14 Jul 2010 02:03:54:573 [ERROR] Workflow ITDSRSAVE started in
   background threw an exception, unable to initiate.
   psdi.util.MXApplicationException: BMXAA0044E - Application
   action APPLYSLA could not run.
    BMXAA4143E - The date format is not valid.
    at psdi.common.action.Action.executeAppAction(Action.java:516)
    at
   psdi.plusp.common.action.PlusPAction.executeAppAction(Unknown
   Source)
    at psdi.common.action.Action.executeAction(Action.java:269)
    at
   psdi.workflow.WFAction.applyWorkflowAction(WFAction.java:174)
    at psdi.workflow.WFNode.applyWorkflowAction(WFNode.java:180)
    at
   psdi.workflow.WFCallStackSet.applyWorkflowAction(WFCallStackSet.
   java:207)
    at
   psdi.workflow.WFCallStackSet.initiateWorkflow(WFCallStackSet.jav
   a:136)
    at
   psdi.workflow.WFInstance.initiateWorkflow(WFInstance.java:126)
    at psdi.workflow.WFProcess.initiateWorkflow(WFProcess.java:692)
    at
   psdi.workflow.virtual.InitiateWorkflowMboSet.execute(InitiateWor
   kflowMboSet.java:89)
    at
   psdi.workflow.WorkFlowService.initiateWorkflow(WorkFlowService.j
   ava:262)
    at psdi.common.action.Action.executeWFInitiate(Action.java:569)
    at psdi.common.action.Action.executeAppAction(Action.java:484)
    at
   psdi.plusp.common.action.PlusPAction.executeAppAction(Unknown
   Source)
    at psdi.common.action.Action.executeAction(Action.java:269)
    at
   psdi.workflow.WFAction.applyWorkflowAction(WFAction.java:174)
    at psdi.workflow.WFNode.applyWorkflowAction(WFNode.java:180)
    at
   psdi.workflow.WFCallStackSet.applyWorkflowAction(WFCallStackSet.
   java:207)
    at
   psdi.workflow.WFCallStackSet.initiateWorkflow(WFCallStackSet.jav
   a:136)
    at
   psdi.workflow.WFInstance.initiateWorkflow(WFInstance.java:126)
    at psdi.workflow.WFProcess.initiateWorkflow(WFProcess.java:692)
    at
   psdi.workflow.virtual.InitiateWorkflowMboSet.execute(InitiateWor
   kflowMboSet.java:89)
   
    at com.ibm.ws.util.ThreadPool$Worker.run(ThreadPool.java:1497)
   Caused by:
   psdi.util.MXApplicationException: BMXAA4143E - The date format
   is not valid.
    at psdi.util.MXFormat.stringToDate(MXFormat.java:672)
    at psdi.util.MXFormat.stringToDate(MXFormat.java:625)
    at psdi.mbo.SqlFormat.setObject(SqlFormat.java:490)
    at psdi.plusp.app.sla.PlusPSLAFinder.getSLAWhere(Unknown
   
   
    
   
   

LOCAL FIX
 *  None, or use US locale, not a valid workaround as client is in
   Australia.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: Users on non-Windows system server           *
   ****************************************************************
   * PROBLEM DESCRIPTION: Invalid date format error if locale     *
   *                      en_au when initiating a  workflow       *
   *                      process or using sla action             *
   *                                                              *
   *                      This only happens on non-Windows system *
   *                      server.                                 *
   *                                                              *
   ****************************************************************
   * RECOMMENDATION:                                              *
   *                                                              *
   *                                                              *
   *                                                              *
   ****************************************************************
   Invalid date format error if locale en_au when initiating a
   workflow process or using sla action
   
   
    
   
   

PROBLEM CONCLUSION
 *  Problem solved. Now the locale information is being used inside
   the method.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ82779
   
   
 * REPORTED COMPONENT NAME
   MAXIMO ADMIN
   
   
 * REPORTED COMPONENT ID
   5724R46A1
   
   
 * REPORTED RELEASE
   711
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-08-11
   
   
 * CLOSED DATE
   2010-08-13
   
   
 * LAST MODIFIED DATE
   2010-08-13
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

MODULES/MACROS
 *  MAXIMO
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   MAXIMO ADMIN
   
   
 * FIXED COMPONENT ID
   5724R46A1
   
   

APPLICABLE COMPONENT LEVELS
 * R711 PSY
   UP