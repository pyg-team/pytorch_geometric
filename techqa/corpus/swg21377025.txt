Title: IBM How to fix Portal Access Control settings after LDAP data have changed - United States

Text:
LDAP; extid; migrate-users; PK59896; cleanup-users; permissions; external identifier; DN; multiple ldap; hp; horizontal partitioning TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The access controls on resources in IBM WebSphere Portal are linked to external identifiers associated with each user/group stored in LDAP. The requirements for such an external identifier includes that it be static and unique. 

However, in certain scenarios in which an LDAP server is changed, the data in the Portal database may no longer be current with the data in the LDAP. Such scenarios cause duplicate users/groups to be created in the Portal database. These duplicates are then used for access control calculations on the Portal server when users log in, while the original user and access control information is considered orphaned. 

SYMPTOM
When checking access control settings using the Resource Permission portlet, you may see blank entries or users will no longer be able to view resources to which they previously had access.


CAUSE
Either the attribute value (or attribute itself) in the LDAP that is mapped as the external identifier has changed or the full distinguished name of the user has changed.

RESOLVING THE PROBLEM
 

Before Beginning:
Before following this procedure, IBM Support strongly recommends backing up your Portal databases.

Step 1: Run XMLaccess with CleanupUsers.xml as input file:

Windows: 

 * 
 * 
 * 

Non-Windows:  * 



where CleanupUsers.xml can be found in the PortalServer/doc/xml-samples directory. This step generates a set of invalid users and groups in file invalidusersgroups.xml. 

[/support/docview.wss?uid=swg21377025&aid=1] [/support/docview.wss?uid=swg21377025&aid=1] 


Step 2. The decision must be made whether to delete the invalid users and groups using this step or a later step. We recommend you leave them in the Portal database temporarily. 
 * 
 * invalidusersgroups.xml
 * 
 * 
 * (a) Set "cleanup-users" to false. Add "migrate-users" and set it to true. 
   
 * 
 * NOTE: 
 * 


Step 3. Run XMLaccess with invalidusersgroups.xml as the input file:  * 
 * 
 * 
 * 
 * 


Step 4. (Optional but recommended) Run XMLaccess with <wp_root>/doc/xml-samples/ CleanupUsers.xml as input a second time: 
 * 

 * 
 * removeusersgroups.xml
 * 
 * invalidusersgroups.xml
 * 


Step 5. (Optional but recommended) Run XMLaccess with removeusersgroups.xml as input to delete the orphaned users and groups:  * 
 * 
 * 
 * 
 * 
 * NOTE
 * 
 * invalid
 * 
 * removeusersgroups.xml 
 * 
 * 
 * 
 * 
 * cleanedDB_out.xml
 * 


Step 6. Verify the Portal access control settings by logging into the Portal server and confirming that users can view the resources to which they have permission. 



Technical Notes:  1. If you have WCM content, you should run the WCM MemberFixer tool. Before running MemberFixer, complete Steps 4 and 5. Reference the appropriate Portal version Information Center links below depending on the version of your Portal for further details on the MemberFixer tool. 
 2. If the system has been configured for a VMM federated database, application groups may exist in the database which that contain LDAP users. The procedure described above will not clean up the VMM database tables which contain outdated LDAP users. A separate procedure is needed - documented in the WebSphere Application Server Knowledge Center [https://www.ibm.com/support/knowledgecenter/SSEQTP_8.5.5/com.ibm.websphere.wim.doc/unabletogetcurrentmembersofagroupindatabaserepository.html] - to cleanup the groups in the VMM database of the stale LDAP users. 
 3. If the LDAP user or group DNs are different after the LDAP change, the above procedure will not work. Contact IBM Support for further details if your user and/or group distinguished names are different before and after the LDAP change.

RELATED INFORMATION
 Virtual Member Manager Identifiers [http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/topic/com.ibm.websphere.wim.doc.en/wimidentifiers.html]
WCM 6.1 MemberFixer [http://www-01.ibm.com/support/knowledgecenter/SSHRKX_6.1.0/com.ibm.wp.ent.doc_v6101/wcm/wcm_admin_memberfixer_tool.html]
WCM 7.0 MemberFixer [http://www-10.lotus.com/ldd/portalwiki.nsf/dx/Using_the_web_content_member_fixer_task_wp7]
WCM 8.0 MemberFixer [http://www-01.ibm.com/support/knowledgecenter/SS3JLV_8.0.0/wcm/wcm_admin_member-fixer.html]
WCM 8.5 MemberFixer [http://www-01.ibm.com/support/knowledgecenter/SSHRKX_8.5.0/mp/wcm/wcm_admin_member-fixer.dita?lang=en]
Understanding the CleanupUsers Process [https://www.ibm.com/developerworks/community/blogs/PortalL2Thoughts/entry/understanding_the_cleanupusers_process?lang=en]


 



Cross reference information Segment Product Component Platform Version Edition Organizational Productivity- Portals & Collaboration WebSphere Portal End of Support Products AIX, HP-UX, IBM i, Linux, Solaris, Windows, z/OS 7.0, 6.1