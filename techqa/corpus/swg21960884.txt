Title: IBM How to disable the latency based scheduler in Netezza Platform Software (NPS)  release 7.2 - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 For certain environments and workloads, the latency based scheduler (LBS) could impose scheduling preferences and an unexpected change in query throughput. 

SYMPTOM
After upgrading to NPS release 7.2, some queries might experience longer workload times (lower throughput) and/or increased latency before the queries start to run on the system. 


CAUSE
The latency based scheduler (LBS) is a feature introduced in NPS release 7.2. The LBS applies preferences for how it schedules queries to run, and how many queries can run concurrently on the system, to maximize the query throughput of the system. 

With LBS, there is a new query runtime classification called medium queries which have runtime estimates from two seconds to one minute (by default). The NPS system previously use two classifications: short queries with runtime estimates under two seconds (by default), and long queries which were all other queries. The short query classification remains the same, but long queries now include all of the queries with runtime estimates above the medium query limit of one minute. (The short and medium query ranges are configurable.) LBS can be beneficial for environments that have queries that fall into the medium range, especially those that are closer to the short query range. In previous releases, those shorter medium queries would be scheduled as long queries. LBS helps to prioritize those medium queries and to process them more quickly, before the queries with longer runtime estimates. 

LBS also balances the number of concurrent snippets/queries to avoid host or SPU resource saturation effects such as paging or disk thrashing that can impact query throughput performance. In most environments, LBS can help the system to maximize query throughput and guaranteed resource allocation (GRA) limits for users and groups. 

However, certain environments might encounter cases where LBS may be less applicable, such as cases where a higher concurrency is needed for regular tasks such as multi-stream backup and restore, or queries do not have scheduler estimates that reflect their system resource requirements, or cases where some longer queries (like GROOM or GENERATE STATISTICS) might be delayed in favor of some medium queries. In these environments, the LBS controls can be disabled to test whether the default workload management scheduling preferences are better suited to those system workloads.


ENVIRONMENT
IBM Netezza Platform Software releases 7.2 and later



DIAGNOSING THE PROBLEM
After upgrading to an NPS 7.2.x release, factors include situations where some tasks like multi-stream backup and restore cannot run fully in parallel due to concurrency limits, or where some queries are waiting longer to start running due to an applied latency. 

It is important to work with IBM Support to identify whether your environment could benefit from disabling one or both LBS controls -- the snippet/query concurrency or the medium query/latency queuing. It could be that one or both LBS features might not be well suited to your environment. 

For example, in cases where a higher snippet concurrency can be supported without causing system resource shortages to impact overall query throughput and performance, you could disable the concurrency option. It is important to watch for system resource impacts that impact overall query throughput despite a higher concurrency. 

In environments where the default GRA queueing of short and long queries worked best for the types of queries running on system, you could disable the medium query classification and the latency preferences to return to the previous short and long queuing and behavior. 


RESOLVING THE PROBLEM
To disable the LBS features in NPS release 7.2.x, you can change the settings while the system is paused, which will remain in effect until the NPS system restarts, or you can change the setting for LBS in the system.cfg file to have the changes remain in place after NPS restarts. 


To disable the LBS: 

nzsystem pause -force
nzsystem set -arg host.schedFlags=2 -force (disables the concurrency limit controls)
nzsystem set -arg host.schedMediumQueryLimitSecs=0 (disables the medium query preference controls)
nzsystem resume 

These settings remain in effect until the database is restarted. You can add the definitions to the system.cfg file to keep the settings in effect after the Netezza software restarts:


 1. Log in to the Netezza system as the nz user account.
    
 2. With any text editor, open the /nz/data/config/system.cfg file. 
    
 3. Look for a host.schedFlags definition in the file to make sure that one is not already present and/or commented out. If you find an entry, make sure that host.schedFlags=2 is set and not commented out with a # character. If you cannot find an entry, add host.schedFlags=2 to the file. 
 4.  
 5. Look for a host.schedMediumQueryLimitSecs definition in the file to make sure that one is not already present and/or commented out. If you find an entry, make sure that host.schedMediumQueryLimitSecs=0 is set and not commented out with a # character. If you cannot find an entry, add host.schedMediumQueryLimitSecs=0 to the file. 
    
 6. Save and close the system.cfg file.
    
 7. Stop and restart the NPS software using the nzstop and then the nzstart commands.