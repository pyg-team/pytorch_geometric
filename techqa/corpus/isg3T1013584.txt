Title: IBM How do I configure shared resources and how do I use them? - United States

Text:
shared resources TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 How do I configure shared resources and how do I use them? 

RESOLVING THE PROBLEM
How do I configure shared resources and how do I use them?



SHARED RESOURCES

============================  Normal resources in LSF are host-based (host resource). That is, it is assumed that a job on a particular host. However there are many situations where resources are shared between hosts either on cluster-wide basis or by certain group of hosts within the cluster. One common example of this is network licenses which are not tied to any particular host. Another example is a shared file system. It is necessary to be able to monitor and schedule jobs based on the availability of shared resources.

 Shared resources can be defined in LSF. These resources do not tied to a single host. They are resources of the cluster or a group of hosts.

Configuring shared resource
-------------------------------------

 Shared resource is numeric, i.e. it has an associated value. The initial value is defined in configuration file (lsf.cluster). Elim may be used to refresh the values of the shared resources. It is very like an external load index. However, since it is shared by a group, but it is associated to a group of hosts instead of a particular host.

 There is no built-in shared resource. All shared resources have to be defined by editing files after installation.

Step 1: 

 Edit the file lsf.shared, which is in the directory LSF_CONFDIR. Locate the section "Begin Resource".

Step 2:

 Add columns "TYPE", "INTERVAL", and "INCREASING" to the Resource section. For example: the original Resource section in lsf.shared is:

 Begin Resource
RESOURCENAME DESCRIPTION
mips (MIPS architecture)
dec (DECStation system)
sparc (SUN SPARC)
hppa (HPPA architecture)
hp68k (HP68k architecture)
bsd (BSD unix)
sysv (System V UNIX)
hpux (HP-UX UNIX)
aix (AIX UNIX)
irix (IRIX UNIX)
End Resource

 It should be modified to:

 Begin Resource
RESOURCENAME TYPE INTERVAL INCREASING DESCRIPTION
mips Boolean () () (MIPS architecture)
dec Boolean () () (DECStation system)
sparc Boolean () () (SUN SPARC)
hppa Boolean () () (HPPA architecture)
hp68k Boolean () () (HP68k architecture)
bsd Boolean () () (BSD unix)
sysv Boolean () () (System V UNIX)
hpux Boolean () () (HP-UX UNIX)
aix Boolean () () (AIX UNIX)
irix Boolean () () (IRIX UNIX)
End Resource

 The host resources are defined as TYPE of Boolean and with no INTERVAL nor INCREASING value.

Step 3:

 Define shared resources in the "Resource section". The TYPE of shared resource should be "Numeric". The INTERVAL specify how long the value of it should be refreshed. LIM will read updated shared resource value from elim. As external index, INCREASING field should be specified. For example:

 Begin Resource
RESOURCENAME TYPE INTERVAL INCREASING DESCRIPTION
mips Boolean () () (MIPS architecture)
dec Boolean () () (DECStation system)
sparc Boolean () () (SUN SPARC)
hppa Boolean () () (HPPA architecture)
hp68k Boolean () () (HP68k architecture)
bsd Boolean () () (BSD unix)
sysv Boolean () () (System V UNIX)
hpux Boolean () () (HP-UX UNIX)
aix Boolean () () (AIX UNIX)
irix Boolean () () (IRIX UNIX)
syno Numeric 30 N (license syno)
veri Numeric 30 N (license veri)
End Resource

 In the example, two shared resources "syno" and "veri" have been defined. LIM will update the value from elim every 30 seconds. 

Step 4: 

 Define the initial value and scope for shared resource in lsf.cluster. Add a section in file lsf.cluster. at LSF_CONFDIR. 
For example: 

 Begin ResourceMap
RESOURCE_NAME LOCATION
syno (2@[apple] 2@[others])
veri 5@[all]
End ResourceMap

 The field RESOURCE_NAME is the name of the shared resource. The field LOCATION defines initial value and the scope of the resource. The syntax is: 

 (value1@[host1 host2 ...] value2@[host3 host4 ...])

 The syntax means: initially, the corresponding shared resouce has value "value1" shared by host1, host2,...; and value "value2" shared by host3, host4,...

 There are three reserved words:
all: 
the server host list in the cluster. value@[all] means the resource is shared by all server hosts in the cluster host1 host2 ... hostn are all server hosts in the LSF cluster

 others: 
the rest of the server hosts list in the cluster. For example, (2@[apple] 2[others]) means there 2 units of "syno" on apple, and 2 shared by all other hosts.

 default: 
each host. value@[default] is equivalent to: (value@[host1] value@[host2] value@[host3] ... value@[hostn]) while host1,... hostn are all server hosts in the cluster.

Step 5: 

 (optional) Write elim for each host. Elim is required only if the shared resources will be consumed by jobs outside lsbatch.

The shared resource value reported by elim is exactly same as external load index. Shared load resource value is output by elim together wirh external load indices, because there is only one elim executed by LIM.

 In the example of Step 4, assuming there are 3 machines apple, orange, banana, elim output on each machine could be:

 On apple:
2 syno 1 veri 4

 On orage:
2 syno 2 veri 4

 On banana:
2 syno 2 veri 4


Using shared resources
-------------------------------------

 Shared resource may be used for batch job scheduling. It is the best thing to control the usage of software license. Shared resource is the same as host resource from user point of view. User can use resource requirement string to choose host to run the job. For example:

 lsrun -R "select[syno>1]" myjob
bsub -R "select[veri>0]" myjob

 For batch jobs, shared resource can be reserved using "rusage" in resource requirement string. For example, we have defined a shared resource called "veri" with the initial value of 4. This shared resource may be total license for some application. When submitting the application that requires that license, rusage has to be used:

 bsub -R "rusage[veri=1]" application

 If there are 4 jobs running the fifth job can not reserve "veri". It will be pending until any of the previous 4 jobs is finished.

 Shared resources can be displayed by command "lsresources" and "bresources". "lsresources -l" lists values of the shared resources configured in lsf.shared and lsf.cluster. file and values updated by elim. "bresources -l" list values in the batch system. Its output is the result of "lsresources" minus researved resource value by jobs. Please see man pages for more information about the command lsresources and bresources. 

 There are two API functions added. ls_resourceinfo(3) is equivalent as lsresources. lsb_resourceinfo(3), which is in the batch library (libbat.a) has the same functionality as bresources.




 

Cross reference information Segment Product Component Platform Version Edition IBM Spectrum Computing IBM Spectrum LSF