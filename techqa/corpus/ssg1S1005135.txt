Title: IBM Spectrum Accelerate: Upgrade LSI firmware 24.2.1-0021 on Supermicro SAS Controllers before deploying - United States

Text:
SAS; Supermicro; LSI; firmware TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 LSI Megaraid Fury 9341-8i firmware version needs to be upgraded before deploying IBM Spectrum Accelerate

Product Name : LSI MegaRAID SAS 9341-8i
Serial No : SV**********
FW Package Build: 24.2.1-0021 

SYMPTOM
Deployment may fail and the system will fail with the following events: 

2015-02-26 15:25:47 152 LONG_LATENCY_TO_CACHE Interface #1001 had long latencies to the caches for 5980 msecs. Longest latency is 2487 msecs to node 1
2015-02-26 15:25:55 153 NODE_FAILED Node #2 of type cache on 1:Module:2 failed because of STATUS_MCL_NETWORK_ERROR.
2015-02-26 15:25:55 154 SERVICE_MODE_OF_SYSTEM_HAS_CHANGED Service mode of system has changed. The urgency of service actions has changed from NONE to IMMEDIATE
2015-02-26 15:25:55 155 SERVICE_HAS_FAILED 1:Data:2 [Data:2] has failed.


RESOLVING THE PROBLEM
Disclaimer: Always verify the most updated firmware code versions is installed on your system before deploying IBM Spectrum Accelerate. 

Upgrade the LSI firmware on Supermicro SAS Controller: 


Server type: SUPERMICRO SERVER - SYS-2027R-N3RFT
SAS controller model : LSI Megaraid Fury 9341-8i 

Current code version: LSI code: 24.2.1-0021 
Upgraded code version: 24.7.0-0026

Upgrading the firmware:

# Download the zip with firmware version 24.7.0-0026 from: http://www.lsi.com/support/pages/download-results.aspx?keyword=SAS%209341-8i [http://www.lsi.com/support/pages/download-results.aspx?keyword=SAS%209341-8i]
# Download storcli tools: http://www.lsi.com/downloads/Public/RAID%20Controllers/RAID%20Controllers%20Common%20Files/1.04.07_StorCLI_11-20-13.zip [http://www.lsi.com/downloads/Public/RAID%20Controllers/RAID%20Controllers%20Common%20Files/1.04.07_StorCLI_11-20-13.zip]

# Upload these to the ESXi server:
scp ~/tmp/24.7.0-0026_SAS_MR_FW_IMAGE_APP_4.270.00-3972_update1.zip <server name>:/tmp/
scp ~/tmp/StorCLI_1.12.13.zip <server name>:/tmp/

ssh <server name>
cd /tmp
unzip 24.7.0-0026_SAS_MR_FW_IMAGE_APP_4.270.00-3972_update1.zip
unzip StorCLI_1.12.13.zip

# Install storcli tools
esxcli software vib install -v=/tmp/storcli_all_os/Vmware-MN/vmware-esx-storcli-1.12.13.vib --force --maintenance-mode --no-sig-check

# Check the HW models of *both* adapters, it should be SAS 9341-8i !!
cd /opt/lsi/storcli/
./storcli /c0 show all
./storcli /c1 show all

# Flash the FW
cd /opt/lsi/storcli/
./storcli /c0 download file=/tmp/mr3008fw.rom
./storcli /c1 download file=/tmp/mr3008fw.rom

Remember: There are two controllers installed in this type of server, hence the need to repeat the command for both ./storcli /c0 and ./storcli /c1 

# Reboot the ESXi server
reboot

# ssh to ESXi and check that the FW versions were updated
ssh <server name>
./storcli /c0 show all
./storcli /c1 show all