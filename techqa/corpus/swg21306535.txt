Title: IBM Importing a virtual portal configuration into a base portal causes multiple problems - United States

Text:
xmlaccess; virtual portal; base portal; import; export; configuration; crash; core; abend; corrupt; corrupted; corruption TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Importing a virtual portal configuration into a base portal is undocumented and is not a supported use of XMLAccess. Doing so will likely corrupt the database and render the base portal unusable. 

SYMPTOM
After importing a virtual portal configuration into a base portal, the Java virtual machine (JVM) may abnormally end, resulting in errors in SystemOut.log like: 

... DataStoreCont E com.ibm.wps.datastore.impl.DataStoreContext handleException EJPDB0002E: Error occurred during database access. 
com.ibm.wps.util.DataBackendException: EJPDB0013E: Internal Error. at com.ibm.ws.tcp.channel.impl.WorkQueueManager$Worker.run(WorkQueueManager.java(Compiled Code))
...
Caused by: java.lang.NullPointerException 
at com.ibm.wps.services.datastore.DomainDataStoreImpl.getConnectionInternal(DomainDataStoreImpl.java(Compiled Code))
...

If the import completes without the JVM crashing and you run the activate-portlets task, the portlets from the virtual portal configuration will be redeployed, resulting in a potentially extremely long run-time for this task. It may take thirty to forty times as long, compared to the normal time it would take to run, depending on the number of portlets involved (e.g., if activate-portlets usually took 10 minutes, it may take 5 hours or more to complete).

In either case, the database may be corrupted to the point of unusability.


CAUSE
Importing a virtual portal configuration into a base portal is undocumented and is not a supported use of XMLAccess.

This problem may occur if an administrator mistakenly labels an export taken from the virtual portal configuration URL as a base portal configuration. Refer to the Information Center link on virtual portals for documentation on using XMLAccess with virtual portals.


RESOLVING THE PROBLEM
First, delete all existing virtual portals and attempt to run the action-empty-portal task (6.0) or empty-portal task (6.1/7.0). Then use XMLAccess to import a valid base portal configuration to the base portal configuration URL and test it. If the portal is still unusable, restore the database from backup. If the portal is still unusable, restore the database and filesystem from backups. 

If a database backup is not available, drop the database tables and run the database transfer tasks again. Then run the tasks to empty portal prior to importing the configuration(s). 

Refer to the Information Center links below for documentation on these configuration tasks and XMLAccess.

If you regularly use XMLAccess to transfer base portal and virtual portal configurations from staging to production, you may choose to script these commands to avoid this problem.

RELATED INFORMATION
 v7 InfoCenter [http://www-10.lotus.com/ldd/portalwiki.nsf/xpViewCategories.xsp?lookupName=IBM%20WebSphere%20Portal%207%20Product%20Documentation]


 

PRODUCT ALIAS/SYNONYM
 wps