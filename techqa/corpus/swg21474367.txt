Title: IBM How many OnDemand database subservers should I configure? - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 How many IBM速 Content Manager OnDemand database subserver processes or threads should I configure on my library server? 

SYMPTOM
I am experiencing hang or slow performance behavior when interfacing with my OnDemand server. When I perform a process listing or list the threads the OnDemand server has spawned, there is an abnormally high number.


DIAGNOSING THE PROBLEM
The ARS_NUM_DBSRVR parameter specifies the size of the connection pool, which all database requests in OnDemand must use. On Unix速, this configuration is specified in the ars.cfg file under the ARS_NUM_DBSRVR parameter. On Windows速, this is specified in the Configurator. 

On initialization, OnDemand creates and maintains a number of persistent connections to the database based on this parameter. If the connections in the pool are all currently busy, subsequent requests will be queued and seem hung, waiting for a free connection. This means setting a value too low will cause database requests to queue up and bottleneck (an accumulation of arssockd processes or threads will then occur), while setting a value too high will consume unnecessary memory, CPU, and database resources. The default value is 4, but for most production environments this number is insufficient. Generally, one database subserver can service 25 users, but this sizing is dependent on the length of the database request, hardware, and system performance. 

The following is a list of common operations that will require a database subserver connection:


 * User operations. For example, logon, open folder, folder search, and server based text search. 
 * Historical logging, such as the System Log and application group logging. For example, if document retrieval logging is enabled, each document retrieval request will require a database subserver connection to log the retrieval in the System Log. 
 * OnDemand commands and daemons, such as ARSDOC, ARSLOAD, and ARSMAINT. 
 * OnDemand Administrator Client and ARSXML operations. 


Note: For an OnDemand system that is using DB2速, ensure that the database configuration parameter MAXAPPLS is configured to at least the ARS_NUM_DBSRVR value or AUTO. 

Important: It is not recommended to set ARS_NUM_DBSRVR to 0 for a production environment. Setting 0 bypasses the connection pool scheme. OnDemand must therefore create and clean up a database connection for each database operation, which is not optimal for performance and allows a limitless number of concurrent connections to be made against your database. 
RESOLVING THE PROBLEM
The optimal value will depend on each environment and will vary greatly based on the volume of concurrent users, their activities, OnDemand commands and daemons running, and the overall performance of your system (network, database, object server, hardware, and so on).

One method to tune this configuration is to set it to a starting value. A general starting point is to specify one database subserver for every 25 possible users. Then, simulate your expected user volume and monitor the count of arssockd processes/threads at regular intervals over a period of time. A continual increase in the number of arssockd processes/threads will indicate that requests are being queued and there is a bottleneck, while a steady number will mean either the pool is adequate in size or too large. 


If the number continually increases no matter the ARS_NUM_DBSRVR value that is set, this indicates that your system may not be sized properly or requires performance tuning and optimization. The Related information section contains further information on troubleshooting such an issue.

An example korn script to monitor the number of arssockd threads every 10 seconds:


 * #!/usr/bin/ksh
 * 
 * 
 * while(true)
 * 
 * do
 * 
 * echo `date` arssockd count: `arssockd -I ARCHIVE -p | wc -l`
 * 
 * sleep 10
 * 
 * done

RELATED INFORMATION
 ARS_NUM_DBSRVR Parameter Description [http://publib.boulder.ibm.com/infocenter/cmod/v8r5m0/topic/com.ibm.ondemand.installingmp.doc/ars1i071104.htm#wq130]
What causes an accumulation of arssockd processes [http://www.ibm.com/support/docview.wss?rs=0&uid=swg21318327]