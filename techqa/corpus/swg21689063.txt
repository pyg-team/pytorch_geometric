Title: IBM Deployment Engine : Netcool/OMNIbus : recovering the DE DB - United States

Text:
de_restoredb; de_backupdb; DEPLOYMENT ENGINE; COI; recovery; nco_install_integration; fail; failure; fails; error; errors TECHNOTE (FAQ)

QUESTION
 de_restoredb : How do you recover a broken Netcool/OMNIbus installation? 

CAUSE
Deployment Engine or COI has become corrupted preventing new product installations

ANSWER
 

It is best practice to install Netcool/OMNIbus in its own directory tree [e.g. /opt/nrv740] using a dedicated user [e.g. netcool] with the users home directory being the root directory for the installation [e.g. /opt/nrv740]. 

With this type of non-root product specific installation it is possible to recover the deployment engine with relative ease. 

 

Before attempting to recover DE you should check for root DE installations, and for common causes of installation failures, before considering a full product recovery. 

e.g. 

Root DE Locations /opt/ibm, /usr/ibm, /var/ibm 

Disk space issues : /tmp, /var/tmp, etc. 

 

Root DE installations prevent non-root DE installations from working correctly, as does a lack of disk space or memory. You can retry a product install after rectifying any problems and performing an uninstall of the failed product. 

 

It is best practice to perform a back up of the DE database before performing any installations: 

e.g. as the install user 

 * Make sure you have a DE backup directory in the Netcool/OMNIbus tree

mkdir $NCHOME/de-backups 
 * To create a backup for today:

csh 
cd ~ 
cd <.asci> 
source setenv.csh 
cd bin 
./de_backupdb -bfile $NCHOME/de-backups/ `date +%Y%m%d`_de_backup 
 * Store the current product details and check your DE version:

./listIU.sh > ~/listIU.`date +%Y%m%d` 
./de_version 
Oct 28, 2014 
Deployment Engine, version 1.4.0.12 (build 20101224D7) (single-user mode) 
If for some reason the installation fails you can recover the DE database, after first removing the product that failed to install using the un-install process. 

 

Un-installing a product [e.g. mttrapd probe]:
e.g. as the install user
cd $NCHOME
ls _uninst
_uninst/nco-p-mttrapd/uninstall
<completes successfully>
rm -rf _uninst/nco-p-mttrapd


Recovery of DE and the backup DE database 

 * Install Netcool/OMNIbus in the newly created /opt/nrv740 directory as the install user [netcool] whose home directory is the target install directory [/opt/nrv740]

./install.bin -i console 
(DEFAULT: /opt/IBM/tivoli/netcool): /opt/nrv740/tivoli/netcool 

The Netcool/OMNIbus product is installed in the netcool directory [/opt/nrv740/tivoli/ netcool] with the DE/COI being installed in the users home directory [[/opt/nrv740] 

After installing the base product you can backup the DE database 
mkdir $NCHOME/de-backups 
csh 
cd ~ 
cd <.asci> 
source setenv.csh 
cd bin 
./de_backupdb -bfile $NCHOME/de-backups/ omnibus-base_de_backup 
 * Replace the Netcool/OMNIbus with the backed up Netcool/OMNIbus from which the DE backup was taken from [this allows donor systems to be used]

e.g. 
cd /opt/nrv740/tivoli 
mv netcool netcool-base 
tar xvf /opt/backups/netcool.tar  * If necessary change the owner and group of the netcool directory and its files [user=netcool/group=ncoadmin]

chown -R netcool netcool 
chown -R ncoadmin netcool 
 * Update the back-ups install properties for the installation [in this example the platform is solaris2]:

vi $NCHOME/omnibus/platform/ solaris2/install/install.properties 
#Thu Jul 05 11:30:49 BST 2012 
version=2 
USER= nrv740 
DEHOME=/opt/nrv740/.acsi_ FQDN 
NCHOME=/opt/nrv740/tivoli/netcool 

where FQDN is the hostname's fully qualified domain name [e.g. host.ibm.com] 
 * Restore the DE database

csh 
cd ~ 
cd <.asci> 
source setenv.csh 
cd bin 
de_restoredb -bfile $NCHOME/de-backups/ `date +%Y%m%d`_de_backup  

Where `date +%Y%m%d` is the same values used in the DE backup file name. 

 

 * Check and compare the version details:

./listIU.sh 
./de_version 
It should now be possible to install the product.