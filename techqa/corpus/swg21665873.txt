Title: IBM Troubleshooting Agent Communication Or Registration Issues - United States

Text:
troubleshoot; communication; registration; GDE; DSM; Agent TECHNOTE (FAQ)

QUESTION
 How to troubleshoot communication and registration issues in GDE 

ANSWER
If you cannot register an agent : 

 * Verify that port 8080 is open between the DSM and the agent. This is the port that is used for the certificate handshake when registering an agent to a DSM
   
 * Also check that the Host can reach port 8443 on the DSM, as Registration attempts to Pull a fresh config. 
 * If this Port is not reachable, check networking. 
 * If the Port is reachable but you see other COMM /Cert errors, and all other Hosts are OK, then please contact Support with details. 
 * If all other hosts also have the same error, then you might need to generate a new cert on the DSM. Contact Support. 
 * Verify that the hostname entered during Registration exactly matches the host name used in the pre-listing on the DSM and matches the actual hostname of the host you are trying to register. the name must be resolvable to an IP address. An FQDN is prefered.
   
   You can run the following script on the host to check this : 
 * *NIX: /opt/vormetric/DataSecurityExpert/agent/vmd/bin/check_host 
 * WIN: START -> Computer right-click -> Properties 
 * If this is a re-registration attempt then you need to clear the certificate fingerprint for that host before re-registering. 
 * Check the DSM and Host (vmd) Logs for communication errors.


If the agent is registered but has communication issues after registration:
SYMPTOMS
- Updates on the DSM do not show up on the Host
- Host Status is NA or PENDING on DSM
- Guardpoint Status is always RED on the DSM even if up on the Host
- Cannot Browse PATHs when creating a new Guardpoint 

 * Check that vmd is running on the host ( WIN check services, *nix : ps -ef | grep vmd) 
 * The most common cause for this is that port 7024 (vmsvc) is blocked between the DSM and the Agent. 
 * You can check this by going to the DSM web console and going to System>Network Diagnostics>checkport. 
   The 'checkport' tool uses netcat to verify the port is Open. 
 * A Successful connection means that Port 7024 on the Host is Listening and accepting the connection 
 * An 'Rejected' message means one of two things: 
 * The Host is rejecting the connection, because 7024 is not Listening or in use with another DSM 
 * The Packets are being Rejected by a Firewall 
 * A Timeout means the Host was unreachable or took too long to reply. 
 * See if port 7024 on the Host itself is UP and LISTENING
   This can be checked via various commands like netstat.
   You can also test this via telnet to localhost on 7024 to see if the port is listening.
   For this telnet to an Active Listening Port, the Host Logs look like this:
   

2013-11-26 10:53:47.598 [VMD] [WARN ] [3008] [COM4635W] A machine identifying itself as 127.0.0.1 tried to contact the VMD, but there was an error: SOAP 1.1; "SOAP-ENV:Server"; Subcode: "[no subcode]"; Reason: "SSL_ERROR_SSL 
error:140760FC:SSL routines:SSL23_GET_CLIENT_HELLO:unknown protocol"; Detail: "SSL_accept() failed in soap_ssl_accept()".  * Check the vmd related logs for COMM and Certificate related errors.
   It may be that a cert has expired or become otherwise invalid.

SYMPTOMS 
The Host fails to PULL updates from the DSM
Fresh logs do not show up on the DSM  * The issue may also occur if our vmd service is not running on the host. If vmd is not running, then no communication is happening.
   You can check this by looking in the windows services or on unix platforms by running
   ps -ef | grep vmd 
 * If vmd is not running you can try starting it via the windows services or on unix platform by running : 
   /opt/vormetric/DataSecurityExpert/agent/vmd/bin/vmd 
 * vmd can stop running if logs are heavily backed up or the log directory is full (full as determined by the agent, or full as in no room left), so check for that as a possible cause. Look for large or old files that you might move or delete. 
 * *NIX: /var/log/vormetric . 
 * WIN:C:\ProgramData\vormetric 
 * If vmd is running, then restarting that service will sometimes clear up communication issues. In some scenarios, if an Agent is not able to Pull (port 8443) updates form the DSM and experiences hard errors, that can cause port 7024 to not listen as well. 
 * Re-registering may also clean up the issue. 
   
 * If your DSM software is on V4 then you may also try a software restart. V4 had several issues in which a software restart can clean up communication problems. You can do this by logging into the CLI and running services restart
   
 * If none of this helps, gather the output from our 'agentinfo' script and send it to GDE Support.