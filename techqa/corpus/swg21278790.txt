Title: IBM P8AE 4.0 - Some users can not login to Workplace - United States

Text:
p8 4.0 can not login workplace javax.security.auth.login.LoginException E_NOT_AUTHENTICATED TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 P8AE 4.0 - Some users can not login to Workplace 

RESOLVING THE PROBLEM
Only users that were created during install can login. Other users receive error when trying to login to Workplace.

Directory Service User: CN=DENLDAP_P8,OU=P8,OU=Weblogic,OU=PROD,OU=Groups - Application,DC=CITY_A,DC=ORGNAME,DC=com
User Base DN: DC=CITY_A,DC=ORGNAME,DC=com
Group Base DN : OU=Weblogic,OU=dev,OU=Groups - Application,DC=CITY_A,DC=ORGNAME,DC=com

Users who can login to Workplace
CN=P8Admin,OU=P8,OU=Weblogic,OU=PROD,OU=Groups - Application,DC=CITY_A,DC=ORGNAME,DC=com
CN=P8Expert,OU=P8,OU=Weblogic,OU=PROD,OU=Groups - Application,DC=CITY_A,DC=ORGNAME,DC=com
CN=P8User,OU=P8,OU=Weblogic,OU=PROD,OU=Groups - Application,DC=CITY_A,DC=ORGNAME,DC=com

Users who can not login
CN=P8Testuser p8t. usertest,OU=P8,OU=Weblogic,OU=PROD,OU=Groups - Application,DC=CITY_A,DC=ORGNAME,DC=com
CN=SPDJK,OU=UserAccounts,DC=CITY_A,DC=ORGNAME,DC=com
CN=TSJRK,OU=UserAccounts,DC=CITY_A,DC=ORGNAME,DC=com

Ldifde command using the account above works fine.
ldifde -f c:\spdjk .txt -r samAccountName=spdjk -b denldap_p8 city_a.orgname.com * 
ldifde -f c:\p8testuser .txt -r samAccountName=p8testuser -b denldap_p8 city_a.orgname.com * 

This issue is preventing them to go to production.

Two different error message received depending whether user tries to login using the account shortname or principal name.

com.filenet.api.exception.EngineRuntimeException: E_OBJECT_NOT_FOUND: Requested item not found. Principal spdjk not found. 

com.filenet.api.exception.EngineRuntimeException: E_NOT_AUTHENTICATED: The user is not authenticated.

Problem can only be reproduced on site.

For example, trying to login to workplace as spdjk produced the following error.

com.filenet.api.exception.EngineRuntimeException: E_OBJECT_NOT_FOUND: Requested item not found. Principal spdjk not found. errorStack={
at com.filenet.engine.security.SecurityProvider.getSecurityIdList(SecurityProvider.java:428)
at com.filenet.engine.context.SecurityContext.getSecurityIds(SecurityContext.java:129)
at com.filenet.engine.context.SecurityContext.getCurrentUserSid(SecurityContext.java:144)
...
...
Caused by: com.filenet.api.exception.EngineRuntimeException: E_OBJECT_NOT_FOUND: Requested item not found. Realm dc=city_b,dc=orgname,dc=com not found.
at com.filenet.engine.security.ActiveDirectoryProvider.getRealmInfoFromRealmDN(ActiveDirectoryProvider.java:4434)
at com.filenet.engine.security.ActiveDirectoryProvider.getRealmInfoFromPrincipalName(ActiveDirectoryProvider.java:4421)

Trying to login as spdjk@city_a.orgname.com produced the following stack

com.filenet.api.exception.EngineRuntimeException: E_NOT_AUTHENTICATED: The user is not authenticated.
at com.filenet.apiimpl.core.UserPasswordToken.getSubject(UserPasswordToken.java:101)
at com.filenet.api.util.UserContext.createSubject(UserContext.java:168)
...
...
Caused by: javax.security.auth.login.LoginException: javax.security.auth.login.LoginException: java.lang.SecurityException: User: city_a\spdjk, failed to be authenticated.
at weblogic.security.auth.login.UsernamePasswordLoginModule.login(UsernamePasswordLoginModule.java:199)
at sun.reflect.GeneratedMethodAccessor76.invoke(Unknown Source)


Root Cause:
ORGNAME.COM has four child domains, namely 
CITY_A.ORGNAME.COM
CITY_B.ORGNAME.COM
CITY_c.ORGNAME.COM
CITY_D.ORGNAME.COM

The problem users are in city_a.orgname.com, but they also have membership in some groups residing in city_b.orgname.com

Solution:
In FEM, only CITY_A.ORGNAME.COM was configured. To resolve this, add the following 
- CITY_B.ORGNAME.COM
- Root GC located in CITY_A
- Root GC located in CITY_B.



HISTORICAL NUMBER
 20006880 

PRODUCT ALIAS/SYNONYM
 P8 APPLICATION ENGINE