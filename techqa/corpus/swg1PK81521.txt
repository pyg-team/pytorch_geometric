Title: IBM PK81521: MAP DOESN'T FAIL AND ROLLBACK WHEN FTP A LARGE FILE USING FTP ADAPTER ON A REMOTE SERVER DISK SPACE BECOMES FULL - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  During FTP of a large file with the WTx FTP adapter, the remote
   server disk space became full and the entire file did not get
   transferred.  The WTx process did not fail and rollback.  Thus
   we were unaware that the ftp did not complete until the trading
   partners called and said they did not receive their file as
   expected.  This appers to be a bug, ftp trace is attaced.  We
   are on WTx 8.1.0.2 build 38.
   
   We are using the FTP adapter and not the PUT function in a rule.
   We are using the FTP adapter in an override rule (shown below).
   
   =VALID(RUN("MAR509_PROC.mmc"," -OAFTP1 '-T
   %LOGGING%MAR509_USER.mtr
   %FTP_LOGIN_GOSS%%FTP_DIR_GOSS_USER%%DCH01S_ASSIST%" +
   ";type=ASCII'"),
   FAIL ("Failure on RUN (" + TEXT (LASTERRORCODE ( ) ) + "):" +
   LASTERRORMSG ( ) )  )
   
   The card is set to the following:
   ...
    TargetRule, PUT, Target FTP, Command SomeFile.txt, Transaction,
   OnSuccess Create, OnFailure Rollback, Scope Map, Warnings
   Ignore...
   
   If the FTP aborts with a 550 or 552, the map still completes
   successfully and leaves a partially ftp'd file on the server -
   this is not good.  The best situation would be to force the map
   to fail and delete the partially ftp'd file from the server, or
   force the map to fail and leave the partially ftp'd file on the
   server.  In the latter case, our support would need to deal with
   the problem incurred by the partially ftp'd file.  Does IBM have
   any suggestions to implement this functionality?
   
   As I added to a previous email - the FTP adapter pdf states the
   following (ftp adapter failure will occur)- but it does not seem
   to apply here.  Why doesn't our map fail?  I am assuming if the
   FTP adapter fails (as stated below) - that the map would fail!
   Is this an incorrect assumption?
   
   The FTP adapter pdf states the following:
   ...
   The default behavior of the FTP adapter is to pass 100 and 200
   level error codes and to fail only on 300, 400, and 500 level
   error codes as defined in RFC 959. Any other error codes
   returned are ignored. By using the Fail adapter command, you can
   specify the error codes, such as from third-party data, for
   which the adapter fails.
   ...
   
   I tried -FAIL 550:552 in the rule, but it did not fail the map.
   
   
    
   
   

LOCAL FIX
 *  WTXCQ - WTX00029568
   BD / BD
   Changes in the code which requires a patch
   
   
    
   
   

PROBLEM SUMMARY
 *  If the scope of the adapter transaction is equal to 'card', the
   map should fail if the FTP adapter fails to put data due to
   'disk full' error.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Fixed a problem with the transaction handling when the
   scope=card is set and the map output card fails running the
   utility adapters ftp/http/email. If the utility adapter fails
   during the transfer phase, the error code will not be handled
   correctly, the map will not fail.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK81521
   
   
 * REPORTED COMPONENT NAME
   WSTX
   
   
 * REPORTED COMPONENT ID
   5724M4000
   
   
 * REPORTED RELEASE
   801
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2009-02-27
   
   
 * CLOSED DATE
   2009-04-07
   
   
 * LAST MODIFIED DATE
   2009-04-07
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WSTX
   
   
 * FIXED COMPONENT ID
   5724M4000
   
   

APPLICABLE COMPONENT LEVELS
 * R801 PSY
   UP
   
   
 * R810 PSY
   UP
   
   
 * R820 PSY
   UP