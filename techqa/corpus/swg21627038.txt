Title: IBM Connection requests to backend server rejected under load on Portal. - United States

Text:
Portal; AIX; TCPTR; tcptr_enable; AIXpert TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Under load, Portal connections to backend database server are rejected and Portal pages do not render correctly. 

SYMPTOM
Under heavy load, Portal connections to the database are rejected by the backend system, with messages similar to: 

[timestamp] 000000d1 ConnectionSer E com.ibm.icm.ci.ConnectionService ConnectionService.getConnection com.ibm.websphere.ce.cm.StaleConnectionException: Io exception: Connection resetDSRA0010E: SQL State = null, Error Code = 17,002
com.ibm.websphere.ce.cm.StaleConnectionException: Io exception: Connection resetDSRA0010E: SQL State = null, Error Code = 17,002 

 

However, the backend database server shows no indication that it is receiving the session requests. 

Running iptrace on the backend system does show that the requests are rejected at the TCP level and not sent to the backend database server.


CAUSE
In this case, the problem was caused by an AIX feature for TCP Traffic Regulation (TCPTR), which is a tool to guard against Denial of Service (DoS) attacks. This feature allows limits (e.g., number of connections per unit time) to be placed on connections to specific TCP ports. 

More information about this feature is available in the AIX Knowledge Center:
https://www.ibm.com/support/knowledgecenter/ssw_aix_71/com.ibm.aix.cmds5/tcptr.htm [https://www.ibm.com/support/knowledgecenter/ssw_aix_71/com.ibm.aix.cmds5/tcptr.htm]


ENVIRONMENT
WebSphere Portal on any platform connecting to a backend database server running on AIX with TCPTR enabled



DIAGNOSING THE PROBLEM
If connections to the backend server are mysteriously disappearing, check the settings for TCPTR first. If this feature is enabled, consider reconfiguring to support more sessions or disable it totally. If AIXpert is implemented on the problem system, changes will need to be made there as well (since it will periodically redo any settings that have been changed outside of AIXpert)



RESOLVING THE PROBLEM
Disable TCPTR (issue the AIX no command ... "no -p -o tcptr_enable=0") if it is not needed for the backend database server. 

In most cases, TCPTR is not needed since the database is not in a "DMZ"). 

If TCPTR is needed, increase the TCPTR configuration settings to values sufficient to prevent the issue. Ensure that AIXpert (if it is implemented) is not set to reset these values back to AIXpert recommended values (via a crontab entry).