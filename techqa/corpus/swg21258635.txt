Title: IBM How do I cleanup the WPC tables to remove old versions of data and thus reduce the database size? - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 I need to cleanup irrelevant old version data from Websphere Product Center tables since the database tablespace is running out of space and running very slow. Are there cleanup scripts or best practices document for this cleanup which I can follow and cleanup the database? 

ANSWER
There is a delete_versions_before_date.sh script for Oracle, which you can get from product support engineer for the Websphere Product Center version that you have installed. Running this script will cleanup most of the WPC tables for which version information is stored. The following 6 tables are not cleaned up by the delete_versions_before_date.sh script, but they should be cleaned up separately.
TAUD_ALO_AUDIT_LOG, TSEC_LOG_USERACTIVITY, TSEC_LOT_LOGIN_TIMES, TWFL_CEH_COLL_ENTRY_HISTORY, TWFL_WEE_WORKFLOW_EVENT_ENTRY, TWFL_WFE_WORKFLOW_EVENT.

You should run the following steps to clean up these tables to ensure all of the older versions for these tables were also cleaned up to improve product performance. The first 4 tables are exported in step 3 and imported in step 4. The last 2 tables are cleaned up in step 5.

1. Backup the database

2. Run the "delete_versions_before_date.sh" script to cleanup most of the WPC tables.

3. Export only the rows from the first 4 tables listed above, after a particular date in the past. In this example, all the data before 10-dec-2006 will be cleaned up from the tables.

The export commands are shown below. Basically in the following statements, only the data after 10-dec-2006 is exported from 4 tables, and it will be imported back in step 4. All old data is deleted implicitly.

exp db_user/db_pwd@db_name tables=TAUD_ALO_AUDIT_LOG file=alo statistics=none query=\"where alo_timestamp\>\'10-dec-06\'\" >> file.txt

exp db_user/db_pwd@db_name tables=TSEC_LOG_USERACTIVITY file=log statistics=none query=\"where log_date\>\'10-dec-06\'\" >> file.txt

exp db_user/db_pwd@db_name tables=TSEC_LOT_LOGIN_TIMES file=lot statistics=none query=\"where lot_logout_time\>\'10-dec-06\'\" >> file.txt

exp db_user/db_pwd@db_name tables=TWFL_CEH_COLL_ENTRY_HISTORY file=ceh statistics=none query=\"where ceh_date\>\'10-dec-06\'\" >> file.txt

4. Import the tables with the exported file: file.txt.
imp db_user/db_pwd@db_name file=file.txt

5. For the TWFL_WEE_WORKFLOW_EVENT_ENTRY and TWFL_WFE_WORKFLOW_EVENT tables, the cleanup is done as follows -

Run the TWFL_WEE_WORKFLOW_EVENT_ENTRY delete before the TWFL_WFE_WORKFLOW_EVENT delete, otherwise the TWFL_WFE_WORKFLOW_EVENT rows you need for the join with TWFL_WEE_WORKFLOW_EVENT_ENTRY will not exist.

delete from wee where wee_event_id = (select wfe_id from wfe where
wfe_finish_time < to_date('01-JAN-07','dd-mmm-yy') and wfe_event_status
= 'DONE')

delete from wfe where wfe_finish_time < to_date('01-JAN-07','dd-mmm-yy')
and wfe_event_status = 'DONE';

 

PRODUCT ALIAS/SYNONYM
 MDMPIM
InfoSphere MDM for PIM Server 
WPC 
WebSphere Product Center