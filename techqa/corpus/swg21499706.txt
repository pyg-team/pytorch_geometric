Title: IBM "Model not found in context ... ERR.ANY.CONNECTIONEXCEPTION... Connection reset by peer: socket write error" when launching Allocations - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 User clicks 'Maintain - configuration - Automatic Journals - Control Tables - Allocations'. User receives error message. 

SYMPTOM
Screen message: 

Error
Model not found in context: journalType
Unable to find instance of model of type: journalType, type interface com.ibm.cognos.ccr.journaltype.JournalTypeModel (load=DEFAULT)
exceptionID=ERR.ANY.WEBSERVICECONNECTIONEXCEPTION.CANNOT_EXECUTE_SERVICE, argument(s)=[http://SERVERNAME/cognos8/controllerserver/CCRWS.asmx [http://SERVERNAME/cognos8/controllerserver/CCRWS.asmx], 101:5xxxxxxx]
FAIL:!com.ibm.cognos.ccr.common.SQLConnectionException: exceptionId=ERR.ANY.CONNECTIONEXCEPTION.CANNOT_OPEN_CONNECTION, argument(s)=[MappingModel, type interface com.ibm.cognos.ccr.classic.MappingImportDAO (load=DEFAULT), jdbc:JSQLConnect://sqlsvrname/database-databasename,[Ljava.lang.Object.@710b710b]!
[OK]

CCR.LOG (default = C:\Program Files\cognos\c8\log\ccr.log) entry:
<.....>
Caused by: 
com.jnetdirect.jsql.JSQLException: DBComms.transmit exception:[java.net.SocketException: Connection reset by peer: socket write error] context:[(2) [Thread[ControllerBLANK,5,main], IO:83f08, Dbc:44634]]
at com.jnetdirect.jsql.JSQLException.makeFromDriverError(JSQLException.java:70)
at com.jnetdirect.jsql.DBComms.transmit(DBComms.java:451)
at com.jnetdirect.jsql.IOBuffer.sendCommand(IOBuffer.java:243)
at com.jnetdirect.jsql.JSQLStatement.sendExecute(JSQLStatement.java:2439)
at com.jnetdirect.jsql.JSQLStatement.doExecuteQuery(JSQLStatement.java:1726)
at com.jnetdirect.jsql.JSQLPreparedStatement.executeQuery(JSQLPreparedStatement.java:369)
at org.apache.commons.dbcp.DelegatingPreparedStatement.executeQuery(DelegatingPreparedStatement.java:93)
at com.ibm.cognos.ccr.common.util.DatabaseUtility.executeSelect(DatabaseUtility.java:110)
at com.ibm.cognos.ccr.classic.MappingImportSQLDAO.load(MappingImportSQLDAO.java:131)
... 9 more

CAUSE
The screen message is generic. There are many different potential causes for this message. 

 * For more example, see separate IBM Technote #1448796. 


This IBM Technote specifically relates to the case where the 'FAIL' explanation message states entries similar to 'ERR.ANY.CONNECTIONEXCEPTION.CANNOT_OPEN_CONNECTION' *and* the ccr.log contains an entry similar to " Connection reset by peer: socket write error".  

In this case there are several possible root causes: 

 * Scenario #1 - Functionality has never worked in the past  * The SQL server has been configured to use a non-default TCP port number (in other words, not 1433) 
    * By default, Java-related Controller functionality will connect to the database server/database name that is specified inside "Database Connections" inside "Controller Configuration". However, there is no mechanism inside "Database Connections" to store the TCP port number of the SQL instance. Therefore, by default, the Java-related functionality will not be able to reach the SQL server. 
   
   
 * Scenario #2 - Functionality used to work OK (for example for many weeks/months) but has suddenly stopped working.  * A change has occurred (for example a SQL server reconfiguration, reboot or Microsoft patch has been installed) which has caused the Java component to fail to connect to the SQL server
   
   

ENVIRONMENT
Scenario #1 - Microsoft SQL server configured to use a non-default (not 1433) TCP port number. For example, customer using a 'named instance' of SQL server.



RESOLVING THE PROBLEM
Scenario #1 

The best solution depends on what version of Controller you are using: 

Controller 10.1.1697 or earlier: 

 * 
 * 
 * ccr-dbTypes.properties
 * 
 *  NOTE: This will restrict the application slightly, because it means that (in practice) you will now only be able to use Controller databases that are hosted on a single SQL server instance, because ALL Java-related functionality will use the same TCP port. 

 * 
 * Steps:
 *  Logon to the Controller application server as an administrator Stop the Windows service "IBM Cognos Controller Java Proxy" to ensure that no Java-related files are "in use" Launch Windows Explorer, and browse to the ...\server\integration folder. TIP: By default this is located here: C:\Program Files\cognos\c8\server\integration Ensure that the relevant .JAR file is inside this folder (see later for examples) As a precaution, create a backup copy of the file "ccr-dbTypes.properties" Open the file inside Notepad Modify the values (which will vary depending on the .JAR file chosen) to point to your Controller database/server (see later for examples) Save Test. 
 * 
 * TIP: If the problem remains, it may be necessary to reboot the Controller application server (and perhaps the client device too) to ensure that the changes are committed/registered.
 *  
 * Example #1 - Microsoft SQL Server JDBC driver version 3.0 
 *  
 * SQL_SERVER.name = MS SQLServer 
   SQL_SERVER.driver = com.microsoft.sqlserver.jdbc.SQLServerDriver 
   SQL_SERVER.url = jdbc:sqlserver://%s%s: 5000/DatabaseName=%s 
 * 
 * TIP:
 *  For more information see separate IBM Technote #1458364. Naturally the values highlighted in bold need to be changed for your TCP port. 
 * 
 * Example #2 - JSQLConnect.jar 
 *  
   SQL_SERVER.name = MS SQLServer (JSQLConnect)
   SQL_SERVER.driver = com.jnetdirect.jsql.JSQLDriver
   SQL_SERVER.url = jdbc:JSQLConnect://%s%s:5000/DatabaseName=%s
   
   TIP: 
 *  Naturally the values highlighted in bold need to be changed for your TCP port. 

Controller 10.1.1670 or later:
Logon to the Controller application server, and launch Controller Configuration. Inside "Database Connections" modify the data source. Inside the "servername" section, add the TCP port number after a comma (,). 

 * For example, if you want to use the the SQL server with name SQLSERVER on port 1234, then the Data Source should be: SQLSERVER,1234


Scenario #2 

Restart the Windows service "IBM Cognos Controller Java Proxy" on the Controller application server.


RELATED INFORMATION
#1448796 - ** Troubleshooting ** Error 'Model not found [http://www.ibm.com/support/docview.wss?rs=0&uid=swg21448796]
1458364 - How to use and configure Microsoft SQL Server [http://www.ibm.com/support/docview.wss?rs=0&uid=swg21458364]
Microsoft download website - Microsoft SQL Server JDBC [http://www.microsoft.com/downloads/en/details.aspx?FamilyID=a737000d-68d0-4531-b65d-da0f2a735707]