Title: IBM Data Collection Required For Solving PowerVC , HMC and VIOs Problems. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

THIS DOCUMENT APPLIES ONLY TO THE FOLLOWING LANGUAGE VERSION(S):
 English 

PROBLEM(ABSTRACT)
 ///////////////////////////////////////////////////////////////////////////////////////////////////
/// Minimum Requirement Link ( PowerVC 1.2.2 ) - As of Feb 02, 2015
///////////////////////////////////////////////////////////////////////////////////////////////////
Please check with PowerVC team for changes related to PowerVC level or HMC levels.

Version SSXK2N_1.2.1: 
http://www-01.ibm.com/support/knowledgecenter/SSXK2N_1.2.1/com.ibm.powervc.standard.help.doc/powervc_hwandsw_reqs_hmc.html [http://www-01.ibm.com/support/knowledgecenter/SSXK2N_1.2.1/com.ibm.powervc.standard.help.doc/powervc_hwandsw_reqs_hmc.html]

Version SSXK2N_1.2.2: 
http://www-01.ibm.com/support/knowledgecenter/SSXK2N_1.2.2/com.ibm.powervc.standard.help.doc/powervc_hwandsw_reqs_hmc.html [http://www-01.ibm.com/support/knowledgecenter/SSXK2N_1.2.2/com.ibm.powervc.standard.help.doc/powervc_hwandsw_reqs_hmc.html]

/////////////////////////////////////////////////////////////////////////////////////
/// Minimum Requirement Link ( VIOS) - As of Feb 02, 2015
/////////////////////////////////////////////////////////////////////////////////////
Please check with VIO team. As of Feb 02, 2015 below are the requirements
2.2.3.3 + (any) fixes listed on fix central.
2.2.3.4 + (any) fixes listed on fix central.


////////////////////////////////////////////////////////////////////
/// Initial Problem Description ///
///////////////////////////////////////////////////////////////////

1) Please provide:

a) Gather time difference between the PowerVC Linux server,
HMC, and VIOS server(s) (use "date" command)."

- Are these synchronized using NTP ? 

b) Error message on:
1) PowerVC ( From GUI )

c) Current levels and fixes on:
1) PowerVC levels and fixes.
2) HMC levels and fixes.
3) VIOs levels and fixes.


///////////////////////////////////////////////////////////////////////////////////////////
/// Initial data collection from PowerVC - Powervc-diag etc ///
//////////////////////////////////////////////////////////////////////////////////////////

1) Run "/usr/bin/powervc-diag" to get powervc logs.
- run as root user
- cd /usr/bin
- powervc-diag
- zip file is created in /tmp ( default ).
- Rename to PMR#.lwi.date.zip

////////////////////////////////////////////////////////////////////
/// Initial data collection from HMC - pedbg ///
////////////////////////////////////////////////////////////////////

1) login into HMC as hscpe

2) run "pedbg -c -q 4"

3) data created.
"HsClogsXXzz2007zzzzzz.zip", created in /dump directory.
- Copy file to the common directory for FTP to IBM.
# scp /dump/HSClogsXXzz2007zzzzzz.zip
@:.
(NOTE: the ":." means keep the same name on remote,
do not forget the :. At the end of the line )

- Rename the file to include the PMR number
# mv HSClogsXXzz2007zzzzzz.zip 17343.b057.c649.pedbg.date.zip

////////////////////////////////////////////////////////////////////
/// Initial data collection from ALL VIOS ///
////////////////////////////////////////////////////////////////////

1. snap from padmin of each node.
Incase of SSP,snap from the primary DBN node and failing node.
$ snap ( creates /home/padmin/snap.pax.Z)


2. Basic CM Database checks on VIOs:
If query fails see if there is any change in status:

$ oem_setup_env
# ps -ef|grep CM/DB
# /usr/sbin/rsct/bin/rmcdomainstatus -s ctrmc
# lssrc -ls ctrmc|grep running
# lssrc -g rsct_rm


////////////////////////////////////////////////////////////////////
/// Upload Data ///
////////////////////////////////////////////////////////////////////
1) Upload testcase:
FTP the file to ibm:
ftp testcase.software.ibm.com,
login: anonymous,
passwd: your email address,
ftp> cd /toibm/aix
ftp> bin
ftp> put pmr#.powervc.pax.gz), pmr#.hmc.pax.gz and pmr#.vios.pax.gz
ftp> quit

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// END INITIAL DATA COLLECTION. NEXT SECTION FOR RE-CREATE and INCREASING LOGS /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

===================================================================
===================================================================

////////////////////////////////////////////////////////////////////
/// DATA COLLECTION FOR RECREATE ///
////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////
/// VIOS ///
////////////////////////////////////////////////////////////////////

1) Remove or rename /home/ios/viod_CM.log.FATAL 
- mv /home/ios/viod_CM.log.FATAL to /home/ios/viod_CM.log.FATAL.old

////////////////////////////////////////////////////////////////////
/// PowerVC - Powervc-diag /// 
////////////////////////////////////////////////////////////////////

A) Please provide:
1) Gather time difference between the PowerVC linux server,
HMC, and VIOS server(s) (use "date" command)."

- Are these synchronized using NTP ? 

2) Error message on:
a) PowerVC ( GUI )

3) Current / New levels or fixes.
a) PowerVC levels and fixes.
b) HMC levels and fixes.
c) VIOs levels and fixes.

4) VIOs lpar ID, lpar name, and host name the failure occurred on.

5) Run "/usr/bin/powervc-diag" to get powervc logs.
- run as root user
- cd /usr/bin
- powervc-diag
- zip file is created in /tmp ( default ).
- Rename to PMR#.lwi.date.zip

////////////////////////////////////////////////////////////////////
/// Data collection from HMC - pedbg ///
////////////////////////////////////////////////////////////////////

1) login into HMC as hscpe

2) run "pedbg -c -q 4"

3) data created.
"HsClogsXXzz2007zzzzzz.zip", created in /dump directory.
- Copy file to the common directory for FTP to IBM.
# scp /dump/HSClogsXXzz2007zzzzzz.zip
@:.
(NOTE: the ":." means keep the same name on remote,
do not forget the :. At the end of the line )

- Rename the file to include the PMR number
# mv HSClogsXXzz2007zzzzzz.zip 17343.b057.c649.pedbg.date.zip

////////////////////////////////////////////////////////////////////
/// Data collection from ALL VIOS ///
////////////////////////////////////////////////////////////////////

1. snap from padmin of each node.
Incase of SSP,snap from the primary DBN node and failing node.
$ snap ( creates /home/padmin/snap.pax.Z)

2. Basic CM Database checks on VIOs:
If query fails see if there is any change in status:

$ oem_setup_env
# ps -ef|grep CM/DB
# /usr/sbin/rsct/bin/rmcdomainstatus -s ctrmc
# lssrc -ls ctrmc|grep running
# lssrc -g rsct_rm

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
Data collection from ALL VIOS incase of RSCT problems. snap collect rsct data, however, for escalation RSCT team prefers below which collects data and formats report. 
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

$ oem_setup_env
# ctsnap -x runrpttr

This will create => /tmp/ctsupt/ctsnap*.tar.gz

rename pmr#.vio.ctsnap.pax.Z

////////////////////////////////////////////////////////////////////
/// Upload Data ///
////////////////////////////////////////////////////////////////////
1) Upload testcase:
FTP the file to ibm:
ftp testcase.software.ibm.com,
login: anonymous,
passwd: your email address,
ftp> cd /toibm/aix
ftp> bin
ftp> put pmr#.powervc.pax.gz), pmr#.hmc.pax.gz and pmr#.vios.pax.gz
ftp> quit


//////////////////////////////////////////////////////////////
// Debugging Tips For Support Teams //
//////////////////////////////////////////////////////////////

PowerVC: 
1) Provide VIOs lpar ID, lpar name, and host name the failure occurred on.
2) Initial log files to start debugging.
- Inside powervc_diag
- /var/log/nova/* first
- compute logs, 
- scheduler log, etc 

HMC:
1) Provide VIOs lpar ID, lpar name, and host name the failure occurred on.
2) Initial log files to start debugging.
FFDC.log

VIOS: Log Files used for debugging.
1) viosvc.log
2) viosp.log
3) viod_CM.log
4) vioCmd.log
5) viod_CM.log.FATAL

///////////////////////////////////////////////////////
Refer to below link for latest changes 
///////////////////////////////////////////////////////
ftp://ftp.software.ibm.com/systems/virtualization/vio/ztools/PowerVC-Data-Collection/powervc_data_collection_and_requirements.html [ftp://ftp.software.ibm.com/systems/virtualization/vio/ztools/PowerVC-Data-Collection/powervc_data_collection_and_requirements.html]



RELATED INFORMATION
#PowerVC HMC and VIOS Data Collection [ftp://ftp.software.ibm.com/systems/virtualization/vio/ztools/PowerVC-Data-Collection/powervc_data_collection_and_requirements.html]