Title: IBM IC51160: MISSING KEY IN AN INPUT MESSAGE IN A DATABASE LOOKUP PRIMITIVE RESULTS IN AN RUNTIME EXCEPTION - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Missing key in an input message in a database lookup primitive
   results in a runtime exception being thrown which causes the
   flow to fail, rather than handling the exception by propogating
   the message through to the failed terminal.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: Users of WebSphere Enterprise Service Bus    *
   *                 and WebSphere Process Server v6.0.1 who      *
   *                 are using a Mediation Flow Component which   *
   *                 contains a Database Lookup primitive, where  *
   *                 the inbound message does not contain the     *
   *                 Database message key at the defined XPath    *
   *                 position.                                    *
   ****************************************************************
   * PROBLEM DESCRIPTION: When a message is processed by a        *
   *                      Database Lookup primitive, the          *
   *                      database key location is supplied       *
   *                      within the body of the customer's       *
   *                      message.  If for some reason this key   *
   *                      is not present, a                       *
   *                      MediationRuntimeException is thrown     *
   *                      and flow processing stops for this      *
   *                      message.                                *
   *                                                              *
   *                      By design, a MediationException         *
   *                      should be thrown, which would           *
   *                      subsequently be propogated out of       *
   *                      the Databae Lookup primitive via the    *
   *                      fail terminal.                          *
   ****************************************************************
   * RECOMMENDATION: If you are using WebSphere Enterprise        *
   *                 Service Bus or WebSphere Process Server      *
   *                 v6.0.1 and you are using a                   *
   *                 Database Lookup primitive where your         *
   *                 input message has a possibility that the     *
   *                 key may not be in the specified location,    *
   *                 then you are recommended to install the      *
   *                 fix pack which contains this code fix.       *
   ****************************************************************
   When the Database Lookup primitive within a Mediation Flow
   Component searches for a key in the incoming message, and the
   message does not contain a key at the location specified by
   the Key Path, then a MediationRuntimeException is thrown
   by the Mediation Flow Component.
   
   An example of such an exception is:
   
   com.ibm.ws.sca.uow.UOWRolledBackException: caused by:
     com.ibm.wsspi.sibx.mediation.flow.MediationRuntimeException:
     CWSXM1025E: An unexpected exception occurred during flow
     invocation: No value for xpath:
     /headers/SOAPHeader[1]/value/branch
   ...
   
   Caused by:
     com.ibm.wsspi.sibx.mediation.flow.MediationRuntimeException:
     CWSXM1025E: An unexpected exception occurred during flow
     invocation: No value for xpath:
     /headers/SOAPHeader[1]/value/branch
       at
     com.ibm.wsspi.sibx.mediation.flow.ejb.MediationFlowBean.invoke
   RequestFlow(MediationFlowBean.java:200)
   ...
   
       at com.ibm.wsspi.sca.ejb.module.impl.ModuleSessionBean.proce
   ssUOWMessage(ModuleSessionBean.java:335)
       ... 38 more
   Caused by: org.apache.commons.jxpath.JXPathException: No value
     for xpath: /headers/SOAPHeader[1]/value/branch
   at org.apache.commons.jxpath.ri.JXPathContextReferenceImpl.getVa
   lue(JXPathContextReferenceImpl.java:308)
     at org.apache.commons.jxpath.ri.JXPathCompiledExpression.getVa
   lue(JXPathCompiledExpression.java:101)
     at com.ibm.ws.sibx.mediation.primitives.dblookup.DatabaseLooku
   pMediation.mediate(DatabaseLookupMediation.java:578)
     at com.ibm.ws.sibx.scax.mediation.engine.JavaMediationPrimitiv
   e.invoke(JavaMediationPrimitive.java:174)
     at com.ibm.ws.sibx.scax.mediation.engine.MediationPrimitive.in
   vokeConnections(MediationPrimitive.java:242)
     at com.ibm.ws.sibx.scax.mediation.engine.Input.invoke(Input.ja
   va:125)
     at com.ibm.ws.sibx.scax.mediation.engine.RequestFlow.invokeFlo
   w(RequestFlow.java:123)
     at com.ibm.ws.sibx.scax.mediation.engine.MediationFlow.invokeR
   equestFlow(MediationFlow.java:112)
     at com.ibm.wsspi.sibx.mediation.flow.ejb.MediationFlowBean.inv
   okeRequestFlow(MediationFlowBean.java:189)
   
   The problem is caused by the Database Lookup primitive code
   throwing the wrong type of exception when the Key Path does not
   exist.  It should throw a MediationException which would
   result in the fault terminal being triggered as designed.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Installing the code fix associated with this APAR completely
   resolves the problem, with no known side effects.
   
   The fix was targetted for inclusion in the maintenance delivery
   vehicle, "v6.0.1 Fix Pack 4".
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IC51160
   
   
 * REPORTED COMPONENT NAME
   WEB ESB FOR WIN
   
   
 * REPORTED COMPONENT ID
   5724I8200
   
   
 * REPORTED RELEASE
   100
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-11-20
   
   
 * CLOSED DATE
   2007-01-05
   
   
 * LAST MODIFIED DATE
   2007-01-05
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEB ESB FOR WIN
   
   
 * FIXED COMPONENT ID
   5724I8200
   
   

APPLICABLE COMPONENT LEVELS
 * R100 PSY
   UP