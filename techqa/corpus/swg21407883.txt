Title: IBM How to convert a DB2 LUW database that was not enabled for AUTOMATIC STORAGE tablespaces, so that existing tablespaces can use AUTOMATIC STORAGE - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 Is it possible to convert a database that was not enabled for the "AUTOMATIC STORAGE" feature to use it for existing tablespaces?


ANSWER
It is not possible to convert an existing database to use automatic storage if you are using DB2 V8.2, V9.1 or V9.5. This is documented in the DB2 Version 9.1 Information center entry for Automatic storage restrictions [http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.admin.doc/doc/r0024251.htm]. This restriction is also documented in the DB2 Version 9.5 Information Center entry for Automatic storage restrictions [http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/index.jsp?topic=/com.ibm.db2.luw.admin.dbobj.doc/doc/r0024251.html]. 


However, it IS possible to do this in DB2 V9.7 AND it is also possible upgrade a database from a previous version of DB2 V9.7, and then enable existing containers to use AUTOMATIC STORAGE. The following is an example of how this can be done. 

 

Example:
This example is based off a DB2 V9.1 backup image, where the database was NOT enabled for AUTOMATIC STORAGE, and has a normal DMS tablespace, called 'TBSDMS'.

$ db2 list tablespaces (Output Truncated)
Tablespaces for Current Database
Tablespace ID = 3
Name = TBSDMS
Type = Database managed space
Contents = All permanent data Large tablespace
State = 0x0000
Detailed explanation:
Normal 

After taking an offline backup of the DB2 V9.1 database, you can restore it under DB2 V9.7. It may be necessary to use the redirect option to redefine the location for the DMS tablespace containers, as was the case in this example. 


$ db2 -tvf restore.ddl (Output Truncated)

RESTORE DATABASE TEST FROM '/home/db2v91' TAKEN AT 20091014104542 INTO TEST REDIRECT WITHOUT ROLLING FORWARD
...
RESTORE DATABASE TEST CONTINUE
SQL2555I The database was restored and then successfully upgraded to the current DB2 release where you issued the RESTORE DATABASE command.

After connecting to the database, you can see from a db2pd -tablespaces output, that the 'TBSDMS' tablespace is NOT enabled for automatic storage.

$ db2 connect to test

$ db2pd -db test -tablespaces (Output Truncated)
Tablespace Autoresize Statistics:
Address Id AS AR InitSize IncSize IIP MaxSize LastResize
0xA6D494F0 3 No No 0 0 No 0 None 

After the database has been successfully upgraded to DB2 V9.7, you can alter the database to enable it to make use of AUTOMATIC STORAGE.

$ db2 "alter database add storage on '/home/db2v97'"
DB20000I The SQL command completed successfully.

Once you have defined an AUTOMATIC STORAGE path and the database has been enabled to use AUTOMATIC STORAGE, you can alter an existing (DMS) tablespace to use AUTOMATIC STORAGE.

$ db2 "alter tablespace tbsdms MANAGED BY AUTOMATIC STORAGE"
DB20000I The SQL command completed successfully.

You can then verify the change with a new db2pd -tablespaces output:

$ db2pd -db test -tablespaces (Output Truncated)

Tablespace Autoresize Statistics:
Address Id AS AR InitSize IncSize IIP MaxSize LastResize
0xA70A94F0 3 Yes Yes 786432 -1 No None None 

The indictor shows that tablespace 3 is now using automatic storage for the DB2 V9.7 database. 

***NOTE: While the tablespaces are now able to use AUTOMATIC storage, this does not enable them for RECLAIMABLE storage. If you wish to use RECLAIMABLE storage, the tablespaces will need to be recreated in V9.7 or later.