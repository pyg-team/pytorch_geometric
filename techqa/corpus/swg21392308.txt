Title: IBM TWS WebSphere fails to start after Oracle 10 upgrade - United States

Text:
T2CStatement; t2cParseExecuteDescribe; oracle; jdbc; driver; OracleStatement; TWS TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 As with many applications, there are periodic updates that are required. In some cases updating the Oracle application causes an issue with JDBC type 2 for Tivoli Workload Scheduler's (TWS) WebSphere Datasource. 

SYMPTOM
WebSphere core dumps while starting with the following javacore file entry:


# Problematic frame:# C [libclntsh.so.10.1+0xb3e7d1] kpinclntrevert+0x1d1
#

--------------- T H R E A D ---------------

Current thread (600000000056e260): JavaThread "server.startup : 0"
daemon [_thread_in_native, id=45, lwp_id=1933344]
....
Stack: [9fffffffb9881000,9fffffffb9901000), sp=9fffffffb98ff4c0, free
space=505k
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code,
C=native code)
C [libclntsh.so.10.1+0xb3e7d1] kpinclntrevert+0x1d1

Java frames: (J=compiled Java code, j=interpreted, Vv=VM code)j 
oracle.jdbc.driver.T2CStatement.t2cParseExecuteDescribe(Loracle/jdbc/driver/OracleStatement;JIIIZZZZ[BIBII[SI[B[CII[SII[B[CII[I[S[BIIIIZZ[Loracle/jdbc/driver/Accessor;[[[B[J[BI[CI[SIZ)I+0
j oracle.jdbc.driver.T2CPreparedStatement.executeForDescribe()V+260
j oracle.jdbc.driver.OracleStatement.executeMaybeDescribe()V+102
j oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout()V+132
j oracle.jdbc.driver.OraclePreparedStatement.executeInternal()I+94
j oracle.jdbc.driver.OraclePreparedStatement.executeQuery()Ljava/sql/ResultSet;+17
j com.ibm.ws.rsadapter.jdbc.WSJdbcPreparedStatement.executeQuery()Ljava/sql/ResultSet;+88
j com.ibm.tws.dao.rdbms.util.DatabaseStatement.executeSelect()Lcom/ibm/tws/dao/rdbms/util/DatabaseResult;+26.....

*Note: WebSphere javacore files can be found in <TWSHome>/appserver/profiles/twsprofile or <TWAHome>/eWAS/profiles/twaprofile


CAUSE
The issue is likely caused by the Oracle client code (aka "OCI") which is internally used by the JDBC type2 driver to connect to the Oracle server. It is a native piece of code which is shared by Oracle utilities and the JDBC type2 driver to access the Oracle server.


RESOLVING THE PROBLEM
To resolve this issue you need to move from JDBC type 2 (native) to JDBC type 4 (pure java). In fact, JDBC type 4 implementation does not make use of native calls to the OCI client, but directly opens a socket to the Oracle server. 


In TWS, this is the method to change the WebSphere datasource configuration from JDBC type 2 to type 4:

For reference see the Change Datasource properties section of the online documentation:

TWS v9.3
http://www.ibm.com/support/knowledgecenter/en/SSGSPN_9.3.0/com.ibm.tivoli.itws.doc_9.3/distr/src_ad/awsadchgdatasource.htm [http://www.ibm.com/support/knowledgecenter/en/SSGSPN_9.3.0/com.ibm.tivoli.itws.doc_9.3/distr/src_ad/awsadchgdatasource.htm]

1. change
OracleType2JndiName=jdbc/twsdb 
to 
OracleType2JndiName=jdbc/twsdb_old 

2. change 
OracleType4JndiName= 
to 
OracleType4JndiName=jdbc/twsdb 

3. set
OracleType4URL=jdbc:oracle:thin:@//localhost:1521/ORCL 

where 
localhost 
must be replaced with the hostname or ip address of the ORACLE server 

1521 
must be replaced with the real port number of the ORACLE listener on the ORACLE server 

ORCL 
must be replaced with the database instace name (SID) where is connected TWS 


If you do not know how to set the parameters specified above, you can find this information in the file <ORACLE_HOME>\NETWORK\ADMIN\tnsnames.ora on the machine where the TWS master is installed. 

You should find a section like this: 

<hostname> = 
(DESCRIPTION = 
(ADDRESS_LIST = 
(ADDRESS = (PROTOCOL = TCP)(HOST = xxxxxxxxxx)(PORT = yyyy)) 
) 
(CONNECT_DATA = 
(SERVICE_NAME = zzzz) 
) 
) 

where
xxxxxxxxxx is the hostname 
yyyy is the port number (1521 above) 
zzzz is the DB instance name (ORCL above)

 

PRODUCT ALIAS/SYNONYM
 Maestro
TWS
TWA