Title: IBM Preparing a TSAMP managed DB2 server for maintenance - United States

Text:
TSA; TSAMP; CritRsrcProtMethod; maintenance; reboot; manual mode TECHNOTE (FAQ)

QUESTION
 Need to reboot a node within a TSAMP cluster and this node hosts the standby database. Can we just reboot the node or do we need to perform any additional steps within RSCT/TSAMP or the database server itself before rebooting? 

ANSWER
There is a very important step to perform before ANY maintenance. I always recommend disabling Critical Resource protection (CritRsrcProtMethod) to prevent the cluster software (RSCT) from trying to counter any user reboot/shutdown actions on the node where you will be performing maintenance and more importantly to prevent any reboot actions on the primary (surviving) node. You could probably get away with just doing this single step, however I'll listed a more compete set below :
1) Ensure your Tiebreaker is available since the primary node WILL need it one you reboot the standby node.
=> if it won't be, there are other steps we can take while the domain still has both nodes online

2) Disable CritRsrcProtMethod (run as root on any node) :
chrsrc -c IBM.PeerNode CritRsrcProtMethod=5

3) Stop the DB2 instance on the standby server (as the DB2 instance owner) :
db2stop -force

4) Offline the node from the cluster's perspective (run as root on any node) :
stoprpnode <standby_node>


In reverse, after the server has been booted:

1) Bring the node back online (run as root) by choosing either of the following options:
On primary node: startrpnode <standby_node>
OR
On standby node: startrpdomain <domain_name>

2) Start the DB2 instance on the standby node (run as DB2 instance owner) :
db2start

3) Re-enable CritRsrcProtMethod:
chrsrc -c IBM.PeerNode CritRsrcProtMethod=3



You will not need to stop automation using 'samctrl -M T' (Manual mode) ... in fact, DB2 v9.5 HADR doesn't play nicely with TSAMP's Manual mode (yet) ... there was a DB2 APAR opened for this small integration problem.

In the above steps, stoprpnode is being used. Whenever stoprpnode/stoprpdomain are used, the node/domain will never automatically restart after a reboot. If you skip steps 3 & 4, then the node will automatically come online after the reboot and the local DB2 instance will be onlined by TSAMP without your invention. However this was as reliable as it should have been in older versions of TSAMP, like version 2.2.

If you were to talk to RSCT Support about rebooting a server, they will always tell you to offline the node before rebooting it, regardless of which automation software is being used.