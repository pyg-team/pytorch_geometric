Title: IBM 'Insufficient Access Rights' error occurs after configuring Lotus Domino as the user registry - United States

Text:
SECJ0270E; CWWIM4520E; secondary address book; directory assistance; insufficient access rights; error code 50 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 After enabling security on WebSphere® Portal to use Lotus® Domino® LDAP as the user registry, the following exceptions may occur during startup of the Portal server or during login of a user:

[9/4/08 13:25:59:751 EDT] 0000000a ContextManage E SECJ0270E: Failed to get actual credentials. The exception is javax.naming.NoPermissionException: [LDAP: error code 50 - Insufficient Access Rights]; remaining name ''
at com.sun.jndi.ldap.LdapCtx.mapErrorCode(LdapCtx.java:3008)
. . . .
at com.ibm.ws.security.registry.ldap.LdapRegistryImpl.search(LdapRegistryImpl.java:2002)
at com.ibm.ws.security.registry.ldap.LdapRegistryImpl.
getAllGroupMembersByGroupObject(LdapRegistryImpl.java:859). . .

or

[9/5/08 8:09:18:961 EDT] 000001c3 exception E com.ibm.ws.wim.adapter.ldap.LdapConnection search(String, String, Object[], SearchControls) 
com.ibm.websphere.wim.exception.WIMSystemException: CWWIM4520E The 'javax.naming.NoPermissionException: [LDAP: error code 50 - Insufficient Access Rights]; remaining name '/'; resolved object com.sun.jndi.ldap.LdapCtx@fb30fb3' naming exception occurred during processing.
at com.ibm.ws.wim.adapter.ldap.LdapConnection.search(LdapConnection.java:2447)
. . . .
at com.ibm.ws.wim.adapter.ldap.LdapAdapter.getGroupsByMember(LdapAdapter.java:1713) 

SYMPTOM
No pages can be displayed or even if the user can get to the login page, the login fails. 


CAUSE
No access to secondary address book which is exposed in Domino LDAP via Directory Assistance.

ENVIRONMENT
WebSphere Portal 6.1 configured successfully with Lotus Domino 8.0.1 using the wp-modify-ldap-security task (BUILD SUCCESSFUL). However, this issue could also occur after using the federated tasks to initially configure WebSphere Portal against Lotus Domino as the user registry. 

DIAGNOSING THE PROBLEM



1) Confirmed that the Lotus Domino LDAP server was prepared according to the "Prepare a Domino Directory server" page in the WebSphere Portal 6.1 Information Center [http://publib.boulder.ibm.com/infocenter/wpdoc/v6r1m0/index.jsp?topic=/com.ibm.wp.ent.doc/install/stdaln_win_prep_dom.html]. This includes confirmation that the group entry "wpsadmins" contains the Lotus domain of the user (wpsadmin/ibm) as opposed to just the shortname (wpsadmin). 

2) Collected tracing and configuration files referenced in the Login MustGather [http://www-01.ibm.com/support/docview.wss?rs=688&uid=swg21312738]. In this case, we could not access the Integrated Solutions Console to set the trace strings, because server1 failed to start as well. Instead, we did the following: 

-Added the trace string manually to to the startupTraceSpecification property in: <wp_profile_root>/config/cells/<cellname>/nodes/<nodename>/<servers>/WebSphere_Portal/server.xml 

-Restarted WebSphere Portal. Based on the trace.log that was produced, we could see the following as sample queries run against the LDAP when the insufficient access rights error occurred: 

0000000a LdapRegistryI 3 Filter: (|(&(objectclass=dominogroup)(member=cn=wpsadmin,o=ibm))) 

and 

000001c8 LdapConnectio > com.ibm.ws.wim.adapter.ldap.LdapConnection JNDI_CALL search(String, String, Object[], SearchControls) ENTRY "" (&(objectClass=dominogroup)(member=cn=wpsadmins)) null [searchScope: 2, timeLimit: 120000, countLimit: 500, returningObjFlag: true, returningAttributes: [dominounid, objectClass, cn]]

3) Based on the above queries, we ran the following queries using ldapsearch against the Domino server and received the same error message outside of WebSphere Portal: 

ldapsearch -h <ldap_hostname> -D "cn=wpsadmin,o=ibm" -w <wpsadmin's password> 
"(|(&(objectclass=dominogroup)(member=cn=wpsadmin,o=ibm)))"

ldapsearch -h <ldap_hostname> -D "cn=wpsadmin,o=ibm" -w <wpsadmin's password>
"(&(objectClass=dominogroup)(member=cn=wpsadmins))"

4) Given the above results, we enabled debug on the Domino LDAP server via the following console commands: 

start consolelog 
set config ldapdebug=7 

The console output from the LDAP debug confirmed the following: 

09/05/2008 02:52:31.43 PM [0BA4:0005-04AC] LDAP> Search in database 
D:\Lotus\Domino\data\secondary_names.nsf skipped - NSFDbOpenExtended2 returned '582:You are not authorized to perform that operation' because:
09/05/2008 02:52:31.43 PM [0BA4:0005-04AC] LDAP> 1) Its File/Database/Access Control assigns No Access to the user, or

09/05/2008 02:52:31.43 PM [0BA4:0005-04AC] LDAP> 2) Its File/Database/Access Control/User Type does not include this server as 'Server' or 'Server Group', or

09/05/2008 02:52:31.43 PM [0BA4:0005-04AC] LDAP> 3) Its File/Database/Properties/Type is not 'Domino Directory' or 'Directory Catalog'

09/05/2008 02:52:31.43 PM [0BA4:0005-04AC] LDAP> ***** Count of search entries returned (total): 0 ***** 
. . . .
09/05/2008 02:52:31.43 PM [0BA4:0005-04AC] LDAP> StateReturnResult returning resultCode 50 (Insufficient access)

The Domino LDAP administrator confirmed that the secondary_names.nsf was a secondary address book that was created from the pubnames.ntf template and was indeed referenced via the directory assistance database in Lotus Domino.


RESOLVING THE PROBLEM
 

Based on the above information, the Domino LDAP administrator added the "wpsadmins" group to the ACL of the secondary_names.nsf with Reader access. After restarting the LDAP task and the portal server, the WebSphere Portal startup and login succeeded.

RELATED INFORMATION
 Configuring WebSphere Portal to use a user registry [http://publib.boulder.ibm.com/infocenter/wpdoc/v6r1m0/index.jsp?topic=/com.ibm.wp.ent.doc/install/standalone_cfg_wp_ureg.html]