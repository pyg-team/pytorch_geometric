Title: IBM VMM exception thrown when fetching LDAP attributes manager or secretary - United States

Text:
manager; ldap; DN; attribute; CWWIM1013E; EJPSG0015E; DataBackendException; property type; property; identifier; CWWIM4520E; InvalidNameException TECHNOTE (TROUBLESHOOTING)

PROBLEM
When looking up the LDAP attributes manager or secretary, VMM throws an exception which can prevent one or more portlets from displaying on a page and may result in a client-side message 
"This portlet is currently unavailable". 

This technote will discuss a couple of cases in which this behavior may occur.

SYMPTOM

Case 1 

SystemOut.log contains: 

com.ibm.wps.um.exceptions.impl.PumaSystemExceptionImpl: com.ibm.wps.util.DataBackendException: EJPSG0015E: Data Backend Problem com.ibm.websphere.wim.exception.WIMSystemException: CWWIM1013E The value of the property manager is not valid for entity CN=Test User,O=IBM.

Case 2 

SystemOut.log contains: 

[10/23/09 20:54:36:787 EDT] 000002c4 exception E com.ibm.ws.wim.adapter.ldap.LdapConnection getAttributes CWWIM4520E The 'javax.naming.InvalidNameException: Invalid name: XXXXXX' naming exception occurred during processing.
[10/23/09 20:54:36:788 EDT] 000002c4 exception E com.ibm.ws.wim.adapter.ldap.LdapConnection getAttributes 
com.ibm.websphere.wim.exception.WIMSystemException: CWWIM4520E The 'javax.naming.InvalidNameException: Invalid name: XXXXXX' naming exception occurred during processing.
at com.ibm.ws.wim.adapter.ldap.LdapConnection.getAttributes(LdapConnection.java:900)
at com.ibm.ws.wim.adapter.ldap.LdapConnection.checkAttributesCache(LdapConnection.java:1239)
at com.ibm.ws.wim.adapter.ldap.LdapConnection.getEntityByIdentifier(LdapConnection.java:2359)


CAUSE

In Virtual Member Manager (VMM), each user or group property (attribute) is of a certain property type. The values of these properties typically have no inherent meaning to VMM. However, the exception is the property type Identifier. Properties of this type refer to (or identify) another entity, typically a user or a group, within VMM. By default, there are two properties that are of Identifier type: manager and secretary. VMM expects that the value (if present) refers to another existing entity within VMM. In other words, VMM expects that the repositories managed by VMM are consistent (no references to deleted entities) and self-contained (no references to entities that are outside of VMM's scope). Furthermore, VMM expects the value to be returned in a distinguished name (DN) format. If VMM is asked to return a value for a property of Identifier type, and the value does not refer to another existing entity or does not use the distinguished name format, then VMM will answer the request with the exception(s) mentioned in this technote.


DIAGNOSING THE PROBLEM
 

PUMA MustGather [http://www.ibm.com/support/docview.wss?rs=688&uid=swg21312815] tracing shows the following details:

Case1 

Prior to the WIMSystemException occurring: 

3/09/09 09:45:10:660 EST] 00000055 LdapConnectio > com.ibm.ws.wim.adapter.ldap.LdapConnection JNDI_CALL getAttributes ENTRY
CN=Invalid Manager,O=IBM [dominounid, objectClass]
[3/09/09 09:45:10:675 EST] 00000055 LdapConnectio 1 com.ibm.ws.wim.adapter.ldap.LdapConnection getAttributes Exception caught: javax.naming.NameNotFoundException: 
[LDAP: error code 32 - No Such Object]; remaining name 'CN=Invalid Manager,O=IBM' 

In this particular scenario, an LDIF of the user CN=Test User,O=IBM shows its manager attribute to have a value of CN=Invalid Manager,O=IBM. However, as the NameNotFoundException indicates, CN=Invalid Manager,O=IBM cannot be found in the LDAP.


Case2 

[10/23/09 20:54:36:781 EDT] 000002c4 LdapConnectio > com.ibm.ws.wim.adapter.ldap.LdapConnection JNDI_CALL getAttributes ENTRY XXXXXX [objectClass, distinguishedname]
[10/23/09 20:54:36:781 EDT] 000002c4 LdapConnectio 1 com.ibm.ws.wim.adapter.ldap.LdapConnection getAttributes Exception caught:
javax.naming.InvalidNameException: Invalid name: XXXXXX
at com.sun.jndi.ldap.LdapName$DnParser.parseRdn(LdapName.java:450)
at com.sun.jndi.ldap.LdapName$DnParser.getDn(LdapName.java:415)
at com.sun.jndi.ldap.LdapName.parse(LdapName.java:318)
at com.sun.jndi.ldap.LdapName.<init>(LdapName.java:91)
at com.ibm.ws.wim.adapter.ldap.LdapConnection.getAttributes(LdapConnection.java:879)
at com.ibm.ws.wim.adapter.ldap.LdapConnection.checkAttributesCache(LdapConnection.java:1239)
at com.ibm.ws.wim.adapter.ldap.LdapConnection.getEntityByIdentifier(LdapConnection.java:2359)

InvalidNameException is thrown because the value for the manager attribute in the LDAP is not a distinguished name but an environment-specific code. 


RESOLVING THE PROBLEM
 

As the VMM behavior is working as designed in both cases by returning the respective exceptions, the issue can be corrected via one of the following methods: 

A) Remove or correct the value of the manager and/or secretary attribute in the LDAP so that it can be queried successfully.

B) Flag the manager and/or secretary attribute as unsupported, as shown on the Mapping Attributes [http://publib.boulder.ibm.com/infocenter/wpdoc/v6r1/index.jsp?topic=/com.ibm.wp.ent.doc_v6101/install/win_map_attributes.html] page of the WebSphere Portal 6.1 Information Center. This will have the effect that VMM will not use the property anymore, as it is virtually removed from VMM's configuration, and its values (even correct ones) cannot be read or written in LDAP.

C) Extend the VMM schema by creating a new property of type String. Then map the new property to the manager or secretary attribute in LDAP. VMM will retrieve the attribute value without performing validation on it. 

Note: Option C will only resolve the issue if you can control the name of the property which is being requested by an application (i.e. change it from manager/secretary to your new property name). 

Example steps for option (C): 

1. Edit wkplc.properties: 

la.propertyName=managerName
la.entityTypes=PersonAccount 
la.dataType=String 
la.multiValued=false 

2. Run ConfigEngine wp-add-property 

3. Restart Portal. 

4. Run ConfigEngine wp-validate-federated-ldap-attribute-config 

5. Edit wkplc.properties: 

federated.ldap.attributes.mapping.ldapName=manager 
federated.ldap.attributes.mapping.portalName=managerName 
federated.ldap.attributes.mapping.entityTypes=PersonAccount,Group 

6. Run ConfigEngine wp-update-federated-ldap-attribute-config 

7. Restart Portal.