Title: IBM bash-3.2$ nzstart [sudo] password for nz: nzstart: Error: SSH configuration unsuccessful - United States

Text:
sudoers jcaz TECHNOTE (FAQ)

QUESTION
 whyt does SSH configuration unscuccessful occur when I run a nzstart 

CAUSE
Additional error associated with this.
bash-3.2$ nzstart [sudo] password for nz: Sorry, user nz is not allowed to execute '/nz/kit.7.2.0.5-P2/bin/adm/nz_update_ssh_config -D /nz/data.1.0' as root on nzstart: Error: SSH configuration unsuccessful

The sudoers file was modified with incorrect NPS version.




ANSWER
In this case customer is running 7.2.0.5. A sudoers file was copied onto the appliance from a 7.2.0.7-P1 version of NPS. When nzstart was issued it could not start since the sudoers file was pointing to the wrong version of NPS. 

 
NPS will not start. 

This section of the sudoers file located in /etc/sudoers is what was affected. 

nz ALL = NOPASSWD: /usr/local/sbin/nzinitarp 
nz ALL = NOPASSWD: /nzlocal/scripts/rpc/spapwr.sh 
nz ALL = NOPASSWD: /nz/kit.7.2.0.7-P1/bin/adm/nzauth 
nz ALL = NOPASSWD: /nz/kit.7.2.0.7-P1/bin/adm/nz_update_ssh_config 
nz ALL = NOPASSWD: /sbin/clustat 
nz ALL = NOPASSWD: /nz/kit.7.2.0.7-P1/bin/adm/ibm_host.pl 
nz ALL = NOPASSWD: /nz/kit.7.2.0.7-P1/bin/adm/disk_firmware.pl 
nz ALL = NOPASSWD: /nz/kit.7.2.0.7-P1/bin/adm/nzNpsSysRevs.pl 
nz ALL = NOPASSWD: /nz/kit.7.2.0.7-P1/bin/adm/tools/hostaekresume 
nz ALL = NOPASSWD: 
/nz/kit.7.2.0.7-P1/share/nzhealthcheck/devmgrs/bin/adm/ibm_host.pl 
nz ALL = NOPASSWD: /usr/sbin/dmidecode 
nz ALL = NOPASSWD: /sbin/ethtool 
nz ALL = NOPASSWD: 
/nz/kit.7.2.0.7-P1/share/tools/storage/common/fdt_wrapper 

In this case I had them put back the original Sudoers file and we brought up the NPS without incident..

This can also happen when NPS upgrades are not completed correctly or on a roll back of the NPS.

You can change the incorrect NPS versions in the Sudoers file quickly by issuing the following

cp /etc/sudoers /etc/sudoers.save
vi /etc/sudoers
:%s/7.2.0.7-P1/7.2.0.5-P2/g
:wq!
nzstart

This will do a find and replace for the correct version of NPS you want to add to the sudoers file.