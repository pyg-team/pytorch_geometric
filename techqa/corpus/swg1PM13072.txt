Title: IBM PM13072: DFHAP0001 ABEND (CODE 0C4/AKEA) HAS OCCURRED AT OFFSET X'7AE0' IN DFHMQTRU - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  During shutdown of the CICS-MQ Adapter, an abend0C4 occurs in
   load module DFHMQTRU offset x'7AE0'. The last messages seen are:
   .
   DFHMQ0341 I STOP requested by alert monitor CKAM.
   DFHMQ0107 I A request to end CKTI has been received. CKTI ended.
   ...
   DFHMQ0713 I CKBR 28341 CICS-MQ Bridge terminated normally.
   DFHAP0707 An abend (code 0C4/AKEA) has occurred in task related
             user exit program DFHMQTRU.
   DFHAP0001 An abend (code 0C4/AKEA) has occurred at offset
             X'00007AE0' in module DFHMQTRU.
   .
   The abend0C4 actually occurs in program DFHMQTRQ offset x'3F4'
   on a LOAD instruction (5820 2058) in the CLEANUP_QINI proc.
   Reg2 contains 40's, and was supposed to be pointing to mail
   associated with the CKTI task. At the time of the 0C4, DFHMQTRQ
   is trying to free all of the mail chained from CKTI's MQLOT
   +x'1C'. The next mail address for CKTI is chained from the mail
   storage +x'58' -- field PNEXTMAIL. This mail storage lives in
   shared storage, length x'60'.
   .
   The problem is that DFHMQTRQ first issues the FREEMAIN for each
   piece of mail storage, then attempts to reference the freed
   storage to get the next mail address. The CKTI task is running
   on an L8 TCB. Meanwhile, a CKAM task running on the QR TCB
   acquires the same storage address and builds a PEB in it. After
   the FREEMAIN, DFHTRQ gets control back and now references the
   freed storage to get the next mail pointer. Since the storage
   is now a PEB, the next mail address now contains something other
   than zeroes. DFHMQTRQ attempts to free this address, gets an
   invalid freemain response and then takes the abend0C4.
   .
   Additional Symptom(s) Search Keyword(s):
   KIXREVEAA  Address_is_outside_DSA S0C4 abendS0C4 7AE0
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All                                          *
   ****************************************************************
   * PROBLEM DESCRIPTION: During shutdown of the CICS-MQ Adapter  *
   *                      an abend0C4 occurs in load module       *
   *                      DFHMQTRU at offset x'B73C'.             *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   During shutdown of the CICS-MQ Adapter, an abend0C4 occurred in
   load module DFHMQTRU offset x'B73C'.
   
   DFHMQ0107 I A request to end CKTI has been received. CKTI ended
   ...
   DFHAP0707 An abend (code 0C4/AKEA) has occurred in task related
             user exit program DFHMQTRU.
   DFHAP0001 An abend (code 0C4/AKEA) has occurred at offset
             X'0000B73C' in module DFHMQTRU.
   The abend0C4 actually occurred in program DFHMQTRQ offset x'3F4'
   on a LOAD instruction (5820 2058) in the CLEANUP_QINI proc.
   Reg2 which contained x'40404040' was supposed to be pointing to
   mail associated with the CKTI task. At the time of the 0C4,
   DFHMQTRQ was trying to free all of the mail chained from CKTI's
   MQLOT +x'1C'. The next mail address for CKTI is chained from the
   mail storage +x'58' -- field PNEXTMAIL. This mail storage lives
   in shared storage, length x'60'.
   The problem is that DFHMQTRQ first issues the FREEMAIN for each
   piece of mail storage, and then attempts to reference the freed
   storage to get the next mail address. The CKTI task was running
   on an L8 TCB.  Meanwhile, a CKAM task running on the QR TCB
   acquired the same storage address and overwrote it.
   After the FREEMAIN, DFHMQTRQ got control back and referenced
   the freed storage to get the next mail pointer.
   However the next mail address now contained blanks, x'40404040'
   and DFHMQTRQ attempted to free this address, which resulted in
   an invalid freemain response and an abend0C4.
   Additional keywords:
   SM0D07 SM 0D07 ABENDS0C4 S0C4 0C4 msgMQ0107 msgAP0707 msgAP0001
   
   
    
   
   

PROBLEM CONCLUSION
 *  The cleanup_qini proc in module DFHMQTRU has been changed so
   that field pNextMail is saved prior to the FREEMAIN, and the
   saved field is used as the next mail address upon return from
   the FREEMAIN.
   
   
    
   
   

TEMPORARY FIX
 *  FIX AVAILABLE BY PTF ONLY
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM13072
   
   
 * REPORTED COMPONENT NAME
   CICSTS V3 Z/OS
   
   
 * REPORTED COMPONENT ID
   5655M1500
   
   
 * REPORTED RELEASE
   500
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-04-27
   
   
 * CLOSED DATE
   2010-04-30
   
   
 * LAST MODIFIED DATE
   2010-06-03
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PK95407 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK95407]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK56578
   
   

MODULES/MACROS
 *     DFHMQTRQ
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   CICSTS V3 Z/OS
   
   
 * FIXED COMPONENT ID
   5655M1500
   
   

APPLICABLE COMPONENT LEVELS
 * R500 PSY UK56578 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK56578]
   UP10/05/05 P F005
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.