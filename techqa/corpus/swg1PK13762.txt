Title: IBM PK13762: SQL-924 RSN00E50063 WHEN IMS DEPENDENT REGIONS ATTEMPT SQL CALLS WHILE IMS<->DB2 INDOUBT RESOLUTION STILL INFLIGHT - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Customer's IMS / DB2 environment experienced an issue which
   caused several very old INDOUBT UORs to be resolved - aborted -
   when IMS was restarted and resynched with DB2.
   The net effect was the DB2 RID Exit was active for a long
   period of time. During this time the Global ( Coordinator )
   identify had completed and local identifies by dependent
   regions were allowed. When such regions attempted SQL calls,
   IMS did Identify, Sigonon, and Create Thread. The SQL call
   path ended up going through DFSESS10 which found bit
   GESEGF2,GESEG2EX set because the RID exit was still active.
   This code paths cuts a GBL ERR trace record (if SUBS trace
   active) and then will take a path where EZSEFL1 bits
   EZSEF1SR and EZSEF1CR will be turned on again. This will cause
   the next SQL call attempt to do another Sigonon and another
   Create Thread. The Sigon is successful but the second Create
   Thread is not allowed by DB2 as there is already a thread
   active which has not committed or aborted. The DB2 reason code
   for the Create Thread failure is x'00E50063'. The application
   sees a -924 SQL status code. In customer's case, the application
   handled this error "gracefully" by inserting an error logging
   transaction and ending normally - without involving DB2 in
   the syncpoint since Create Thread failed. As far as DB2 is
   concerned a commit or abort is still pending and further
   Create Threads will not be allowed.
   The workaround in this case is to recycle the MPP region.
   It would appear that the check for ESI exit active in DFSESS10
   should probably ignore at least the case of the RID exit.
   In customer case the RID process went on for some 30 minutes.
   
   
    
   
   

LOCAL FIX
 *  Wait until RID processing is complete before starting IMS
   dependent regions. If the region had abended on the -924
   instead of handling it gracefully then the problem would also
   not have effected subsequent work in the region since DB2
   would see the TCB termination and clean up the thread.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All IMS R810 users that use the External     *
   *                 Subsystems Attach Facility (ESAF).           *
   ****************************************************************
   * PROBLEM DESCRIPTION: DB2 code 00E50063 and SQL ERROR -924 on *
   *                      consecutive ESS DB2 create thread calls *
   *                      for IMS dependent region while DB2      *
   *                      INDOUBT resolution in progress for IMS. *
   ****************************************************************
   * RECOMMENDATION: INSTALL CORRECTIVE SERVICE FOR APAR/PTF      *
   ****************************************************************
   IMS attempts to build a global connection to an External
   Subsystem (ESS), DB2 in this case, which drives Global Identify
   and Resolve in Doubt processing with DB2.  The DB2 Resolve In
   Doubt exit was active for a long period of time.  During this
   time, as part of the MPP region ESS initialization done by
   DFSESS10, the Local Identify call to DB2 completed and was
   allowed since Global Identification to DB2 had completed
   even though the Global Connection was not done.  Everytime such
   regions attempt SQL calls, the ESS SNO EXIT is driven since ESS
   Global Connection is not complete (GESEG1CC off).  This ends up
   driving DFSESS10 each time it is called even though ESS Local
   Identify might have been issued successfully.  As a result, the
   EZSEFL1 bits, EZSEF1SR (Signon required) and EZSEF1CR (Create
   Thread required), will be turned on every time the path to check
   for Local Identify in DFSESS10 is taken.  This causes IMS to
   attempt ESS Local Identify, Signon, and Create Thread for each
   SQL call made while RID is in progress.  This will result in the
   second SQL call attempting to do another Signon and Create
   Thread.  The second Create Thread is not allowed by DB2 as there
   is already a thread active which has not committed or aborted.
   The DB2 code for the Create Thread failure is x'00E50063'.  The
   application sees a -924 SQL status code.
   
   
    
   
   

PROBLEM CONCLUSION
 *   AIDS: RIDS/SYS RIDS/ESS SYS ESS
     DEP: NONE
     GEN:
   
   *** END IMS KEYWORDS ***
   ADDITIONAL KEYWORDS:
   SQLCODE924
   SQLCODE 924
   SQL CODE 924
   00E50063
   
   DFSESPR0 -
   Modified the check for GESEG1CC (ESS Global Connection complete)
   to GESEG1ID.  This will allow the check for EZSLDC (ESS Local
   Identify complete) to be made and will prevent the ESS SNO Exit
   from being driven multiple times requiring that Signon (EZSEF1SR
   - Signon required) and Create Thread (EZSEF1CR - Create Thread
   required) be performed.
   
   
    
   
   

TEMPORARY FIX
 *  *********
   * HIPER *
   *********
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK13762
   
   
 * REPORTED COMPONENT NAME
   IMS V8
   
   
 * REPORTED COMPONENT ID
   5655C5600
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2005-10-19
   
   
 * CLOSED DATE
   2005-11-28
   
   
 * LAST MODIFIED DATE
   2006-10-04
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PK14834 UK09508
   
   

MODULES/MACROS
 *     DFSESPR0
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IMS V8
   
   
 * FIXED COMPONENT ID
   5655C5600
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY UK09508
   UP05/12/02 P F512