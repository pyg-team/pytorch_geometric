Title: IBM IT21247: SIGSEGV in zfuLdapGetUserDN reported by FDC with probe ID XC130004 - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Queue manager becomes unavailable to client connections
   sometimes when using LDAP for authentication.
   
   Three FDCs are seen:
   1.
   
   Probe Id          :- XC130004
   Component         :- xehExceptionHandler
   Comment1          :- SIGSEGV: address not mapped(0x20)
   
   MQM Function Stack ends with:
     gpiAuthenticateUser
     zfu_as_AuthenticateUser
     zfuVerifyLdapPw
     zfuVerifyLdapPwMain
     zfuLdapGetUserDn
     xcsFFST
   
   2.
   
   Probe Id          :- XC130003
   Application Name  :- MQM
   Component         :- xehExceptionHandler
   Comment1          :- SIGSEGV: address not mapped((nil))
   
   O/S Call Stack for current thread contains:
     libmqmcs_r.so(xehExceptionHandler+0x965)
     libpthread.so.0(+0xf710)
     libmqmcs_r.so(xcsRequestMutexSemFn+0x90)
     libmqmr_r.so(rriDeleteStatusEntry+0x2d1)
     libmqmr_r.so(rriWriteCompMsg+0x33e)
   
   MQM Function Stack ends with:
     rriAsyncConvControl
     rriFreeSess
     rriWriteCompMsg
     rriDeleteStatusEntry
     xcsFFST
   
   3.
   
   Probe Id          :- XC514090
   Component         :- xlsRWMutexRequest
   Major Errorcode   :- xecL_W_LONG_LOCK_WAIT
   
   MQM Function Stack ends with
     gpiAuthenticateUser
     zfu_as_AuthenticateUser
     xlsRWMutexRequest
     xcsFFST
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   Queue managers that use an LDAP repository (via an AUTHINFO
   object) to contain their users and groups.
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   The MQ Object authority manager (OAM) was not robust in the case
   of memory exception failures within its lower layers or its
   dependency libraries.  The OAM was capable of handling the
   memory exception but failed to release the mutexes it held.  As
   a result, subsequent unrelated operations requiring those
   mutexes would hang.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The code in the MQ OAM has been corrected to ensure that, when
   handling a memory exception, it will release its mutexes to
   prevent future hangs of unrelated operations.
   
   An additional fix is included, to ensure that, for secure LDAP
   connections on Windows, the correct GSKit libraries are first in
   the PATH at the time the LDAP libraries are called to connect to
   the LDAP server.  This removes a reason for connect failures, in
   the case where there is a global installation of GSKit available
   on the PATH, of an incompatible version to the one required by
   the MQ installation.  When this problem is visible, it causes a
   different reason code (usually 2063) to be returned from MQ API
   calls where the reason code ought to be 2035.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v8.0       8.0.0.8
   v9.0 CD    9.0.4
   v9.0 LTS   9.0.0.3
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT21247
   
   
 * REPORTED COMPONENT NAME
   IBM MQ APPL M20
   
   
 * REPORTED COMPONENT ID
   5725S1400
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-06-29
   
   
 * CLOSED DATE
   2017-08-22
   
   
 * LAST MODIFIED DATE
   2017-08-22
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IBM MQ APPL M20
   
   
 * FIXED COMPONENT ID
   5725S1400
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY
   UP