Title: IBM PI75879: WMQ: ABEND5C6-EBEBEBED IN CSQMBALC AND ABEND0D3-00000013 - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  IBM Integration Bus ( IIB ) V10 on z/OS received multiple
   abends.  The joblog had errors:
   
   +BIP2628W (Msg 1/2) CSP9BRK EG1TC 5167 EXCEPTION
   CONDITION DETECTED ON INPUT NODE '<node>'.
   
   +BIP2680E (Msg 2/2) CSP9BRK EG1TC 5167 FAILED TO
   SETUP A MQ CONTROL CALLBACK FOR COMPONENT '<node>' TO QUEUE
   '<queue>' ON QUEUE MANAGER 'CSP9': MQCC=2; MQRC=2195.
   
   IEA794I SVC DUMP HAS CAPTURED: DUMPID=nnn REQUESTED
   BY JOB (CSP9BRKE) DUMP TITLE=CSP9,ABN=5C6-EBEBEBED,U=CSP9BRK
   ,C=W9700.800.MMC
   -CSQMALCH,M=CSQGFRCV,LOC=CSQMGPLM.CSQMBALC+000002F0
   
   
   +BIP2628W (Msg 1/2) CSP9BRK EG1TC 5167 EXCEPTION
   CONDITION DETECTED ON INPUT NODE '<node>'.
   
   +BIP2680E (Msg 2/2) CSP9BRK EG1TC 5167 FAILED TO
   SETUP A MQ CONTROL CALLBACK FOR COMPONENT '<node>' TO QUEUE
   '<queue>' ON QUEUE MANAGER 'CSP9': MQCC=2; MQRC=2195.
   
   IEA794I SVC DUMP HAS CAPTURED: DUMPID=nnn REQUESTED
   BY JOB (CSP9BRKE) DUMP TITLE=CSP9,ABN=0D3-00000013,U=CSP9BRK
   ,C=W9700.800.MMC -CSQMALCH,M=CSQGFRCV,
   PSW=077C1001D629F9CC,ASID=asid
   
   
   
   There is an issue with the management of stack storage when
   using message callbacks.
   
   When a message is too large for the buffer allocated in the
   application address space, the queue manager processing calls
   back to the application address space to allocate larger
   storage.
   
   If the task's stack in the queue manager address space has a
   virtual address that falls in the stack segment in the
   application address space, MQ incorrectly calculates the
   amount of storage to be allocated. This causes a reduction in
   the available stack storage in the application address space
   for that task. If the same task makes several calls of this
   type, we can exhaust the stack segment which causes the
   tasks to abend 5C6-EBEBEBED.
   
   It appears that this leaves an invalid state which causes
   follow-on 0D3 abends.
   
   
   Update Aug 9, 2018:
   While reports of this problem have so far only been received in
   an IIB (IBM Integration Bus starting with V10), it is possible
   for this issue to occur with any connected application that
   makes use of async consume or message property handles.
   
   The main factor that makes this problem rare is that the two
   stack storage allocations for the allied address space and the
   MQ MSTR have to have overlapping address ranges to experience
   the problem.
   
   Additional Symptom(s) Search Keyword(s):
   ABEND5C6 ABENDS5C6 5C6 S5C6 S05C6 reason EBEBEBED CSQMBALC
   ABEND0D3 ABENDS0D3 0D3 S0D3 S00D3 00000013 RC13   CSQMALCH
   2195 MQRC_UNEXPECTED_ERROR
   asynchronous consume    MQCB MQCTL
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All users of WebSphere MQ for z/OS Version 8 *
   *                 Release 0 Modification 0.                    *
   ****************************************************************
   * PROBLEM DESCRIPTION: MQ application using async consume may  *
   *                      abend with 5C6-EBEBEBED or              *
   *                      0D3-00000013.                           *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   The stack storage management code incorrectly determines whether
   an additional stack segment is present in the stack chain and
   modifies the stack pointer to compensate. As the additional
   stack segment is not present this calculation is not rolled back
   when releasing the stack storage and eventually the hard limit
   on stack sizes is breached, causing an abend to occur.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Stack storage management for the affected modules is amended to
   ensure that the stack pointer calculation is now correct.
   000Y
   CSQMAFRM
   CSQMAGTM
   CSQMBALC
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI75879
   
   
 * REPORTED COMPONENT NAME
   WMQ Z/OS 8
   
   
 * REPORTED COMPONENT ID
   5655W9700
   
   
 * REPORTED RELEASE
   000
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-02-01
   
   
 * CLOSED DATE
   2017-03-16
   
   
 * LAST MODIFIED DATE
   2018-08-17
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PI76913 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI76913] UI45601
   
   

MODULES/MACROS
 *  CSQMAFRM CSQMAGTM CSQMBALC
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ Z/OS 8
   
   
 * FIXED COMPONENT ID
   5655W9700
   
   

APPLICABLE COMPONENT LEVELS
 * R000 PSY UI45601 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI45601]
   UP17/04/08 P F704
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.