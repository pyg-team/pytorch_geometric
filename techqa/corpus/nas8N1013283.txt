Title: IBM How To Gather Traces For OLE DB Problems - United States

Text:
OLEDB TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This document describes how to gather traces for problems occurring when using the IBM OLE DB providers 

RESOLVING THE PROBLEM
 

Important Note: This document discusses Client Access for Microsoft Windows 95 and Windows NT, Client Access Express, IBM iSeries Access, and IBM System i Access products. These names essentially refer to the same product; however, the functionality and name changed over the last several releases. For the purposes of this document, the terms Client Access, Client Access Express, iSeries Access, and System i Access can be used interchangeably. Where a difference is important, the version of the product is used to identify the differences. 
This document explains how to gather traces for problems that occur when using the System i Access for Windows client OLE DB provider. This document applies to all of the OLE DB providers that are part of the System i Access product. The System i Access product includes three OLE DB providers, IBMDA400, IBMDASQL and IBMDARLA . It is important to note that most applications that use this OLE DB provider are running as Windows services, not desktop applications. In order to make sure that the traces work correctly, the service(s) must first be stopped. This is not so critical with the OLE DB provider trace; however, it is for the cwbcotrc tool. There are two client-side traces that should be collected at the same time that a connection trace is gathered from the IBM i. 

Starting The Traces 
The connection trace should be started so that it only gathers data for the IP address of the client PC where the problem is occurring. To find that IP address, start a DOS command prompt on the PC and run the command IPCONFIG which displays the IP address and other information for the client. After finding the IP address, it is important to stop the application or program that is using the OLE DB provider; not doing so is the main reason that the PC side traces are empty or missing. If this is a service such as Microsoft SQL Server or WebSphere, you may have to use the Windows Management Console or a tool provided with the application to stop the service. The task manager or an equivalent tool can be used to determine that the program is not running. You can start the task manager by pressing Ctrl+Shift+Esc in Windows. The Processes tab of the task manager is where you will find service programs; however, do not end service programs from the task manager, use the management console instead. To open the management console, right click on your My Computer icon and select Manage from the pop-up menu. Services are listed under Services and Applications. 

With the application or service stopped, go to a Windows (DOS) command prompt and enter the following to view the status of the OLE DB provider trace: cwbzztrc -v. It should be off; however, if you find that it is on, turn it off using the command cwbzztrc -a and delete the trace and log file; their locations are displayed in the output of the cwbzztrc -v command. Start the OLE DB provider trace and log using the command: 
cwbzztrc +a 
The command will echo the trace status to the screen so that you can confirm that it is running. 

Next, we do the same things for the cwbcotrc tool. From a PC command prompt, determine the current status of the trace by running the command cwbcotrc. This trace will list two status messages. The first is for the global trace. This is the trace used if the application is running as a Windows service or is an application running as another Windows user. The second trace status is the current-user-only trace. The status of both traces should be stopped. If it is not, run the following commands to stop them: 

cwbcotrc off 
cwbcotrc off /allusers . 

To be certain that we do not append to old traces, run the following commands to delete any existing traces: 

cwbcotrc del 
cwbcotrc del /allusers 

The last step is to start the trace: 
cwbcotrc on /allusers 

Next, start the connection trace. On the operating system command line, run the following command: 

TRCCNN SET(*ON) TRCTYPE(*IP) TRCTBL(OLEDBTRC) SIZE(500000) TCPDTA(*TCP () () *N '1.2.3.4') 

and replace '1.2.3.4' with the IP address of the client PC. 

All three traces are started. Now start the application or service program and re-create the failure. 

Stopping The Traces 
Once the error has occurred, the traces can be stopped, starting with the connection trace. 

1. On the operating system command line, run the command TRCCNN SET(*OFF) TRCTBL(OLEDBTRC). This will create two spooled files, QSYSPRT and QPCSMPRT. 

2. Gather those spool files in .txt format. 

3. From PC command prompt, stop the OLE DB trace: 
cwbzztrc -a 

Note: The default path where the trace files are written is, 

C:\Users\Public\Documents\IBM\Client Access\IBMDA400.log 
C:\Users\Public\Documents\IBM\Client Access\IBMDA400.trc 

4. stop the cwbcotrc: 
cwbcotrc off /allusers 

Note: The default path where the trace files are written is 

C:\Users\Public\Documents\IBM\Client Access\Service\Trace Files <-- All Users 
C:\Users\current_user\Documents\IBM\Client Access\Service\Trace Files <-- Current user only 

5, Gather installation details and the traces. 
cwbsvget 

The cwbsvget will collect files in the C:\Users\current_user\Documents\IBM\Client Access\Service\Trace Files path. As noted above this will not be default capture the CWBZZTRC files in the zip created. 
You either need to copy the CWBZZTRC files to the "\Users\Public\Documents\IBM\Client Access\Service\Trace Files" path prior to running the cwbsvget, add the files to the zip after running the cwbsvget, or send them separately but be sure to include them, they are a critical part of the data collection. 

You can also add the two TRCCNN spooled files to the cwbsvget zip file or package them separately in another zip file. 

Upload using : 
http://www.ecurep.ibm.com/app/upload [http://www.ecurep.ibm.com/app/upload] 
You will need to specify the PMR number. 


What To Check If There are Problems 
If the trace files are not found, double-check the status of the traces and the paths that they are reporting that they are logging to. The Windows user that the program is running under must be an administrator if the trace path is not in a path that the user is not authorized to (typical users are only authorized to write to files under their profiles 'Documents And Settings' path). A common point of confusion can be that the path displayed in the trace tool may not match the path displayed in Windows Explorer. The path "C:\Documents and Settings\All Users\Documents" will show up as "C:\Documents and Settings\All Users\Shared Documents" in Explorer; they are the same path. If the user is authorized to the trace file path, the path is found but no trace file is there. Then the problem always seems to be that the Windows service program that was using the OLE DB provider was not stopped when the trace was started. 


Cross reference information Segment Product Component Platform Version Edition Operating System IBM i 6.1 Operating System IBM i 7.1 
HISTORICAL NUMBER
 511433608