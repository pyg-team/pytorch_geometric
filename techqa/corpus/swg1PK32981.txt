Title: IBM PK32981: ABENDU0757 SC036 IN DFSQDQ00 PROCESSING A DELETE REQUEST FOR A MESSAGE ON THE BACKUP QUEUE. - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  AbendU0757 subcode036 while processing a delete call to free
   the message on the backup queue. This is during the processing
   of a the first message of a new conversation. CNTQCBEQ is
   expected to contain the DRRN of a message on the backup queue
   but instead contains 00000000. CNTF1BKR is set to indicate
   that there is a message present.
    The events leading to the abend indicate that there was a
   prior conversation. The TRAN inserted a non conversational TRAN
   in the SPA and the conversation started termination processing
   at the next input. DFSCONT0 was called and cleaned up evidence
   of the conversation from the CTB including CTB1CONV. The
   bit, CNTF1BKR was not reset and at this point there was still
   a value in CNTQCBEQ.
    The Lterm did a GU to retrieve the next message on the queue
   and before this message could be dequeued, and these bits in
   the CNT cleared, a LTX (Losterm) was driven for the node.
    This is a Shared queues system and during the node termination
   a CANCEL call was processed that freed and cleared the DRRN on
   CNTQCBEQ but CNTF1BKR remained set.
    When the Lterm connected and began a new conversation, with
   CTB1CONV set the code checked CNTF1BKR and this triggered the
   failing Delete call.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All R810 IMS users using deferred            *
   *                 program switches in a shared queues          *
   *                 environment.                                 *
   ****************************************************************
   * PROBLEM DESCRIPTION: ABENDU0757 SC036 in DFSQDQ00            *
   *                      processing a Delete request for a       *
   *                      message on the backup queue.            *
   ****************************************************************
   * RECOMMENDATION: INSTALL CORRECTIVE SERVICE FOR APAR/PTF      *
   ****************************************************************
   An ABENDU0757 SUBCODE036 occurs while processing a delete call
   to free a message on the backup queue.  CNTQCBEQ should contain
   the DRRN of a message on the backup queue, but instead contains
   zeros.  CNTF1BKR is set which indicates that there is a message.
   
   The events leading to the abend are as follows:
   1.  Output is queued to a dynamic terminal.
   
   2.  A 3270 dynamic terminal enters a conversational transaction.
   
   3.  After several iterations, the application does a deferred
       program switch to a non-conversational transaction.
   
       In a shared queues environment,for a 3270 terminal, the
       SPA is included in the output message.  In a non-shared
       queues system, the SPA is not included for a deferred
       program switch to a non-conversational transaction.
   
   4.  The output message is sent to the terminal and during
       A06 time, DFSICIO0 calls routine EOMDEQ to dequeue the
       output message.  At this point, a check is made to
       determine if the SPA is in the message.  If it is, the
       CNTF2BKR is set to have queue manager put the message
       on the backup queue.  Queue manager will setup CNTQCBEQ
       and set CNTF1BKR to indicate that a message is on the
       backup queue (Queue 5).
   
   5.  When the next input is received from the terminal, the
       conversation is terminated in DFSCONT0 by resetting
       CTB1CONV. After the message has been enqueued, A01
       processing at label CONVPREP will determine if the message
       on the backup queue should be deleted.  Since the
       conversation has been terminated already (CTB1CONV off),
       queue manager is not called to dequeue the backup message.
   
   6.  After processing the input, the queued message is sent to
       the terminal.  Because the output message is formatted with
       a MFS format defined with logical paging, the message is not
       dequeued until the next input is received.
   
   7.  The LOSTERM exit is driven and the session is terminated.
       During the signoff process, queue manager is called to Wash
       the output message back and resets CNTQCBEQ without
       resetting CNTF1BKR.
   
   8.  When the session is re-established and a conversational
       transaction is entered, an ABENDU0757 SC36 occurs trying
       to dequeue the backup message because CNTF1BKR is on and
       CNTQCBEQ is zeros.
   
   
    
   
   

PROBLEM CONCLUSION
 *  AIDS: RIDS/DCS RIDS/CNTRL DCS CNTRL
     DEP: NONE
     GEN:
   SYSPLEXSQ
   
   *** END IMS KEYWORDS ***
   To prevent the ABENDU0757, the backup message needs to be
   dequeued.
   
   DFSICIO0 has been modified to check for a backup message
   (CNTF1BKR) even when the conversation no longer exists
   (CTB1CONV off).  If CNTF1BKR is on, the queue manager will be
   called to dequeue the backup message.
   
   DFSQMGR0 has been modified to reset QDF1BKR when QDQCBEQ is
   cleared during Wash (Cancel Input) processing.
   
   
    
   
   

TEMPORARY FIX
 *  *********
   * HIPER *
   *********
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK32981
   
   
 * REPORTED COMPONENT NAME
   IMS V8
   
   
 * REPORTED COMPONENT ID
   5655C5600
   
   
 * REPORTED RELEASE
   800
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2006-10-13
   
   
 * CLOSED DATE
   2006-11-09
   
   
 * LAST MODIFIED DATE
   2008-04-30
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PK33656 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK33656] UK19582 UK19583
   
   

MODULES/MACROS
 *  DFSICIO0 DFSQMGR0
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IMS V8
   
   
 * FIXED COMPONENT ID
   5655C5600
   
   

APPLICABLE COMPONENT LEVELS
 * R800 PSY UK19582
   UP06/11/17 P F611
   
   
 * R802 PSY UK19583
   UP06/11/17 P F611