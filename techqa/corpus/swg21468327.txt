Title: IBM FileNet Content Engine (CE) login error : com.filenet.wcm.toolkit.util.WcmException : "Credentials Exception" - United States

Text:
Credentials Exception TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 The addition of a second Active Directory Service (ADS) to Content Engine (CE) requires modifying the WebSphere Application Server (WAS) hosting the CE from "standalone LDAP" to "Federated Repository" configuration. Following those changes and the addition of the second directory, some but not all users were unable to log in. 

SYMPTOM
Attempted logins by the affected users returned a stack trace with the error :

com.filenet.wcm.toolkit.util.WcmException : "Credentials Exception"
...
com.filenet.api.exception.EngineRuntimeException;The user is not authenticated. [Code=null]; OMFC/TheNetwork/NoOp//E_NOT_AUTHENTICATED 
...
Caused by: com.filenet.api.exception.EngineRuntimeException: E_NOT_AUTHENTICATED: The user is not authenticated. 
...
Caused by: com.ibm.websphere.security.auth.WSLoginFailedException 
...
Caused by: com.ibm.websphere.security.PasswordCheckFailedException 


CAUSE
The name used to login is the "cn=" value of the distinguished name, but the search filters use "samAccountName" to locate a user identity. The users who could not log in were those whose "cn=<name>" value name differed from their "samAccountName".

ENVIRONMENT
Content Engine : CE 4.5.1.4
Database Server : Microsoft SQL Server 2008 
Application Engine : AE 4.0.2
Process Engine : PE 4.5.1 
WebSphere Application Server 6.1.0.33, 64bit 

DIAGNOSING THE PROBLEM
A content engine server trace returned the following call for users whose logins were successful :

DEBUG Calling ActiveDirectoryProvider.getUserByShortName(<username>); 

For users whose logins failed the following messages were traced :

2011-01-16T20:30:52.651Z 76A976A9 SEC FNRCE0000D - DEBUG Entry attributes: \n primaryGroupID: {513}\n displayName: {<username>}\n objectSid: {[B@69d169d1}\n objectClass: {top, person, organizationalPerson, user}\n sAMAccountName: {<extended-username>}\ndistinguishedName: {CN=<username>,OU=<mmm>,OU=<nnn>,OU=<ppp>,DC=<www>, DC=<xxx>,DC=<yyy>,DC=com}\n
2011-01-16T20:30:52.651Z 76A976A9 SEC FNRCE0000D - DEBUG URL: ldap://CZ06DC0001:389; BaseDN: DC=<www>,DC=<xxx>,DC=<yyy>,DC=com}\n; Filter: (&(objectSid=\\01\\05\\00\\00\\00\\00\\00\\05\\15\\00\\00\\00\\78\\5B\\E3\\D5\\6A\\56\\16\\00\\81\\99\\D4\\33\\01\\02\\00\\00)(objectClass=group)); SearchAttributes: {distinguishedName}

2011-01-16T20:30:52.651Z 76A976A9 SEC FNRCE0000D - DEBUG Called ActiveDirectoryProvider.getUserBySid(S 1-5-21-3588447096-1463914-869570945-175778); Returned: \n ShortName=cz06-odvadeci\nDisplayName=<username>\nDistinguishedName=CN=<username>,OU=<mmm>,OU=<nnn>,OU=<ppp>,DC=<www>, DC=<xxx>,DC=<yyy>,DC=com\nName=<extended-username>@xxx.yyy.zzz.com\n


... 


RESOLVING THE PROBLEM
Map the Active Directory attribute "sAMAccountName" to virtual member manager property "cn". Add the following to the WebSphere wimconfig.xml file:


<config:attributeConfiguration>
...
<config:attributes name="sAMAccountName" 
propertyName="cn"> 

<config:entityTypes>PersonAccount</config:entityTypes>
</config:attributes> 
...
</config:attributeConfiguration> 

The above change will map the attribute "cn" to "samAccountName", so that "samAccountName" is used to perform the searches and authentications.