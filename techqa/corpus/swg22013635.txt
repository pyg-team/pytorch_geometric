Title: IBM Database backup operation fails with the ANS0361I message and the operating system error: errno = 24 - United States

Text:
tsm nfiles limit TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 In an IBM Spectrum Protect environment, an operation to back up the IBM DB2 database and log archive fails with the ANS0361I message: DIAG: Unable to open pipe. In addition, the operating system issues the following error message: errno = 24. After the database instance is restarted, the backup operation succeeds, but fails again later. 

SYMPTOM
In addition to the previously mentioned messages, the following message might appear in the application programming interface (API) error log:


ANS1035S Options file path_to_dsm.opt could not be found, or it cannot be read. 



where path_to_dsm.opt specifies the path to the dsm.opt file. 

The ANS1035S message is logged although the dsm.opt file exists and can be read by the database instance user ID. 


CAUSE
The cause of the issue is that the user process resource limit (ulimit) for the number of open files is too low. The ulimit value is set on the operating system. 

The errno = 24 message indicates that too many files are open. 


DIAGNOSING THE PROBLEM
To determine how many files were opened by the DB2 instance (specifically by the db2vend process, which is used for database backup to an IBM Spectrum Protect server), run the lsof command.



RESOLVING THE PROBLEM
To resolve the issue, complete the following steps: 

1. Increase the ulimit for open files at the operating system level. For instructions, see the documentation for your operating system. 

2. To ensure that the changes take effect, restart the DB2 instance.