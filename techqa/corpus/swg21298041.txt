Title: IBM Utilization and Reclaimable space on volume may not add up to 100 percent. - United States

Text:
reclaim util pct hundred TECHNOTE (FAQ)

QUESTION
 The Percent Reclaimable Space and Percent Utilization of sequential storage pool volume, as reported by the QUERY VOLUME F=D command may not add to 100 % under certain conditions. 

CAUSE
Working as designed

ANSWER
The Percent Reclaimable Space and Percent Utilization of a sequential storage pool volume are defined as follow : 

 * Percent Reclaimable Space : The amount of space on a volume that can be reclaimed because data has expired or been deleted. Reclaimable space includes empty space within aggregates. 

 * Percent Utilization : An estimate of the utilization of the volume. The utilization includes all space occupied by both files and aggregates, including empty space within aggregates.


Because the Percent Utilization includes empty space within aggregates, the Percent Utilization value will include expired/deleted data within aggregates. This same expired/deleted data within aggregates is also reported by the Percent Reclaimable Space value. 

To illustrate this concept, the below example will consist of 2 files of the same size, stored in the same physical aggregate, on a full volume. The volume will show 100 % util even when one file is deleted. 

For example the QUERY CONTENT of volume VOL001 shows :

tsm: TSM _SERVER1>q con VOL001
Node Name Type Filespace FSID Client's Name for File
--------------- ---- ---------- ---- -------------------------
TESTNODE Bkup \\abc\c$ 27 \TEST\ TEST1.TXT
TESTNODE Bkup \\abc\c$ 27 \TEST\ TEST2.TXT


The QUERY VOLUME F=D for this same volume shows :

tsm: TSM _SERVER1>q vol VOL001 F=D
Volume Name: VOL001
Storage Pool Name: TESTPOOL
Pct Util: 100.0
Pct. Reclaimable Space: 0.0


The TEST1.TXT file is later deleted. The QUERY CONTENT of volume VOL001 does not show the deleted file anymore, i.e, 

tsm: TSM _SERVER1>q con VOL001
Node Name Type Filespace FSID Client's Name for File
--------------- ---- ---------- ---- -------------------------
TESTNODE Bkup \\abc\c$ 27 \TEST\ TEST2.TXT


This time, the QUERY VOLUME F=D for this same volume shows :

tsm: TSM _SERVER1>q vol VOL001 F=D
Volume Name: VOL001
Storage Pool Name: TESTPOOL
Pct Util: 100.0
Pct. Reclaimable Space: 50.0



Using the same example, but this time assuming the 2 files are stored each in their own separate aggregate, the volume will show 50 % util when one file is deleted. 

For example the QUERY CONTENT of volume VOL001 shows :

tsm: TSM _SERVER1>q con VOL001
Node Name Type Filespace FSID Client's Name for File
--------------- ---- ---------- ---- -------------------------
TESTNODE Bkup \\abc\c$ 27 \TEST\ TEST1.TXT
TESTNODE Bkup \\abc\c$ 27 \TEST\ TEST2.TXT


The QUERY VOLUME F=D for this same volume shows :

tsm: TSM _SERVER1>q vol VOL001 F=D
Volume Name: VOL001
Storage Pool Name: TESTPOOL
Pct Util: 100.0
Pct. Reclaimable Space: 0.0


The TEST1.TXT file is later deleted. The QUERY CONTENT of volume VOL001 does not show the deleted file anymore, i.e, 

tsm: TSM _SERVER1>q con VOL001
Node Name Type Filespace FSID Client's Name for File
--------------- ---- ---------- ---- -------------------------
TESTNODE Bkup \\abc\c$ 27 \TEST\ TEST2.TXT


This time, the QUERY VOLUME F=D for this same volume shows :

tsm: TSM _SERVER1>q vol VOL001 F=D
Volume Name: VOL001
Storage Pool Name: TESTPOOL
Pct Util: 50.0
Pct. Reclaimable Space: 50.0


In conclusion, the Percent Utilization and Reclaimable Space on a sequential storage pool will only add up to 100 when there is no empty space within aggregates.

Notes :
- Deduplication may also increase the probability to see this symptom due to possible empty space in dedup aggregates.
-The difference in Percent Utilization and Reclaimable Space especially holds true when virtual volumes are involved. Data stored on a virtual volume is stored as one or more aggregates whose size is determined by the Maximum Capacity value of the server device class used for the virtual volume. The default value for the Maximum Capacity is 500 MB. In essence, the Percent Utilization of a virtual volume will remain at 100% until at least one of the aggregates stored on the virtual volume is completely deleted or reconstructed during reclamation.