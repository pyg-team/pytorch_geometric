Title: IBM Use of Java shared class caches with WebSphere Application Server on IBM i - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Non-persistent configured class caches may fail on JDK626 & JDK70 JVMs. 


SYMPTOM
Review the failed application server joblog. 

JVAB56D Diagnostic 00 07/02/13 16:03:03.986138 
QXJ9UTLJVM QJVM6032 *STMT QXJ9VM QJVM6032 *STMT 
From user . . . . . . . . . : BASWEBUSER 
From module . . . . . . . . : QXJ9UTLJVM 
From procedure . . . . . . : JvaSendMsg 
Statement . . . . . . . . . : 16 
To module . . . . . . . . . : QXJ9VM 
To procedure . . . . . . . : xj9SendDiagMsgToJobLog 
Statement . . . . . . . . . : 22 
Thread . . . . : 000000BB 
Message . . . . : JVMSHRC364E SH_OSCachesysv:80:acquireWriteLock() call 
to j9shsem_wait on semid 61 has failed with error -3282. 




CAUSE
JDK626 and JDK70 on IBM i had a defect in the implementation of shared class cache mechanism. They were using a non-persistent shared class cache instead of a persistent cache.



ENVIRONMENT
- IBM i 6.1 and 7.1 

- Toolbox Jt400.jar connection calls
- Other jars or native method calls could experience a similar problem if non-persistent cache is used.


RESOLVING THE PROBLEM
Ensure the following ptfs are installed. (Included in the current java group ptfs) 


SI51043 for v6r1, 5761SS1 
SI51042 for v7r1 5770SS1

This will align IBM i with Windows, Linux, AIX platforms as having a default persistent class cache. 

If the above PTFs are installed to IBM i, then the default class cache for the Websphere 8.x JVM's will be Persistent.

Additional tips for monitoring class caches.
Be sure to export the JDK runtime path prior to queries.

Sample listing; (note below output points out the difference of jdk60 vs jdk626. Websphere 7.0 can optionally use a non-persistent cache)

qshell
export JAVA_HOME=/QOpenSys/QIBM/ProdData/JavaVM/jdk626/32bit 
java -Xshareclasses:listAllCaches
Listing all caches in cacheDir /tmp/javasharedresources/ 
Cache name level persistent OS shmid OS semid last detach time 
Compatible shared caches 
tjh85exp Java6 32-bit yes Mon Dec 30 10:19:22 2013 
webspherev85_1.6_32 Java6 32-bit yes In use 
Incompatible shared caches 
webspherev70 Java6 32-bit no 13021 33 Mon Dec 30 08:46:47 2013 


Sample print cache summary statistics;

java -Xshareclasses:name=tjh85exp,printStats 


Sample to remove a class cache from the default /tmp/javasharedresources path.

java -Xshareclasses:name=tjh85exp,destroy 
JVMSHRC256I Persistent shared cache "tjh85exp" has been destroyed 





RELATED INFORMATION
#Previous Best Practice example [http://pic.dhe.ibm.com/infocenter/wasinfo/v8r5/index.jsp?topic=%2Fcom.ibm.websphere.installation.base.iseries.doc%2Fae%2Fwelcome_installing.html]