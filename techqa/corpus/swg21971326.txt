Title: IBM How to use "Alter tablespace" command with "Rebalance" clause to change storage path and move data - United States

Text:
Rebalance Tablespace Storage Path TECHNOTE (FAQ)

QUESTION
 How to use Rebalance to Change Storage Path and Move Data? 

ANSWER
If you want to move data from the current storage path to another storage path, or, simply want to add/remove storage path, we can do it by rebalance clause in Alter tablespace command.
Below is an example:

1. Create a database with a storage path:
db2 "CREATE DATABASE SAMPLE ON /home/<path>/storpath1 DBPATH ON /home/<path>/datapath"

After the database is created, the database files are created under the DBPATH (/home/<path>/datapath) and the container files are under storpath1 (/home/<path>/storpath1).

2. Add a new storage path and drop the old storage path:
db2 "ALTER DATABASE ADD STORAGE ON '/home/<path>/storpath2' DROP STORAGE ON '/home/<path>/storpath1'"
Now we can see that old container is still under /home/<path>/storpath1 and new container is under /home/<path>/storpath2. Storage path /home/<path>/storpath1 is now in the drop pending state.

3. Use the following query to determine the affected tablespaces:
db2 "SELECT DISTINCT TBSP_ID, VARCHAR(TBSP_NAME, 30) as TBSP_NAME
FROM SYSIBMADM.SNAPTBSP
WHERE TBSP_USING_AUTO_STORAGE = 1
AND TBSP_CONTENT_TYPE IN ('ANY','LARGE')
ORDER BY TBSP_ID"

In this example there are 3 outputs:
TBSP_ID TBSP_NAME 
-------------------- ------------------------------
0 SYSCATSPACE 
2 USERSPACE1 
3 SYSTOOLSPACE 

3 record(s) selected.

4. Now we need to rebalance the affected tablespaces:
db2 "ALTER TABLESPACE <tablespace_name> REBALANCE"
In this case:
a. db2 "ALTER TABLESPACE SYSCATSPACEREBALANCE"
b. db2 "ALTER TABLESPACE USERSPACE1REBALANCE"
c. db2 "ALTER TABLESPACE SYSTOOLSPACEREBALANCE"

5. After rebalance the affected tablespaces, we can see that the container files are now moved from /home/<path>/storpath1 to /home/<path>/storpath2.

This is a way to add/delete storage path, also it can be used to remove container files from one path to another.