Title: IBM Domino agent fails to start with invalid magic number error - United States

Text:
5724B98D0TR TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 ITCAM monitoring agent for Lotus Domino fails to start due to invalid magic number for libnotes library. 

SYMPTOM
Domino monitoring agent log shows following error: 
Could not load program /usr/domino/lotus/notes/latest/ibmpow/kgbclient: 
Dependent module 
/usr/domino/lotus/notes/latest/ibmpow/libnotes_r.a could not be loaded. 
The module has an invalid magic number. 


CAUSE
The bit level of installed Domino monitoring agent binary is not the same as that of the Lotus Domino server. The installer, by default, installs 64 bit agent on a 64 bit architecture host. Domino monitoring agent needs to load Domino library when it starts. If the Lotus Domino server itself is running in 32 bit mode, then the 64 bit monitoring agent cannot load the 32 bit library libnotes, and the agent fails to start.

ENVIRONMENT
ITCAM for Applications - Monitoring agent for Lotus Domino, V6.2.1
This technote applies to 64 bit Unix based platforms where Lotus Domino server binaries are installed at 32 bit level.


DIAGNOSING THE PROBLEM
1. Check architecture of agent host using a command appropriate for the platform, to confirm that it is a 64 bit host:

For example, on AIX:
getconf -a | grep KERNEL
KERNEL_BITMODE: 64

2. Check the bit level of Lotus Domino:

Open the Domino Sever console and run following command:
SHOW STATISTIC Server.Version.Architecture 

For example:
[1708216:00025-05398] SHOW STATISTIC Server.Version.Architecture 
[1708216:00025-05398] Server.Version.Architecture = 32 Bit

This confirms that the Domino server is running in 32 bit mode.

3. Check the bit level of installed agent binaries:

From ITM install directory run following command:
bin/cinfo -i

Check if the architecture directory of the agent indicates a 64 bit installation. 




For example, on AIX 6.1, 64 bit agent is installed in aix526 directory:

bin/cinfo -i
gb IBM Tivoli Monitoring for Domino aix526 06.21.00.00

Architecture ending in the number 6, like aix526 correspond to 64 bit architecture.



RESOLVING THE PROBLEM
To resolve the problem, follow these steps:

1. Uninstall the 64 bit Domino agent.
Use ITMHOME/bin/uninstall.sh to uninstall the agent. 


2. Install 32 bit agent.

Run install.sh from Domino agent install CD. The important decision steps during 32 bit agent installation on 64 bit AIX platform are listed below:
# ./install.sh
INSTALL

ITM home directory "/opt/IBM/ITM" already exists.
OK to use it [ 1-yes, 2-no; "1" is default ]?1
...
Select one of the following:

1) Install products to the local host.
2) Install products to depot for remote deployment (requires TEMS).
3) Install TEMS support for remote seeding
4) Exit install.

Please enter a valid number: 1

Accept license agreement.

Select "Other operating systems" option when prompted.

Product packages are available for this operating system and component support categories:

1) IBM Tivoli Monitoring components for this operating system
2) Tivoli Enterprise Portal Browser Client support
3) Tivoli Enterprise Portal Server support
4) Tivoli Enterprise Monitoring Server support
5) Other operating systems

Type the number or type "q" to quit selection
[ number "1" or "IBM Tivoli Monitoring components for this operating system" is default ]: 5

Product packages are available for the following operating systems and component support categories:

1) AIX R5.2 (32 bit)
2) AIX R5.2 (64 bit)
3) AIX R5.3 (32 bit) AIX R6.1 (32 bit)
4) AIX R5.3 (64 bit) AIX R6.1 (64 bit)
5) Linux Intel R2.4 (32 bit)
6) Linux Intel R2.6 (32 bit)
7) Linux Intel R2.6 GCC 2.9.5 (64 bit)
8) Linux S390 R2.4 (32 bit)
9) Linux S390 R2.4 (64 bit)
10) Linux S390 R2.6 (32 bit)
11) Linux S390 R2.6 (64 bit)
12) Linux x86_64 R2.6 (32 bit)
13) Linux x86_64 R2.6 (64 bit)
14) Solaris R10 (32 bit)
15) Solaris R10 (64 bit)
16) Solaris R8 (32 bit)
17) Solaris R8 (64 bit)
18) Solaris R9 (32 bit)
19) Solaris R9 (64 bit)
20) Tivoli Enterprise Portal Browser Client support
21) Tivoli Enterprise Portal Server support
22) Tivoli Enterprise Monitoring Server support

Type the number for the OS or component support category you want, or type "q" to quit selection
[ number "4" or "AIX R5.3 (64 bit) AIX R6.1 (64 bit)" is default ]: 3
...

The following products are available for installation:

1) IBM Tivoli Monitoring for Domino V06.21.00.00
2) all of the above

Type your selections here: 1
IBM Tivoli Monitoring for Domino V06.21.00.00
...
=> installed "IBM Tivoli Monitoring for Domino V06.21.00.00 for AIX R5.3 (32 bit) AIX R6.1 (32 bit)".
...
3) Edit the registry file in agent install directory, to include 64 bit platform in the 32 bit agent registry.

Edit ITMHOME/registry/gb<32bit arch>.ver to include 64 bit architecture. 

For example, on AIX platform, edit registry/gbaix523.ver, and find following lines in it:
# Supported architectures
runarch = aix523
runarch = aix533

Insert 64 bit architecture to the supported architecture list, so that the list looks as follows:

# Supported architectures
runarch = aix526
runarch = aix536
runarch = aix523
runarch = aix533

Save changes and configure the agent.

Note: If the gb<arch>.ver is not modified to include the 64 bit architecture, then configuration of Domino agent will result in error. 

For example:
./itmcmd config -A -o instance gb
CandleConfig failure: KCI0769E product "gb" not installed for this architecture.