Title: IBM Updated security certificate for Push Notifications (iOS) - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
On April 15, 2018, the security certificate for iOS traffic will be updated. If Push Notifications have stopped working for the native iOS clients, it could be because the SSL certificate for connecting to the APNS server expired.

RESOLVING THE PROBLEM
The Sametime Proxy server ships with an SSL certificate to allow for push notifications to occur securely for the Sametime Mobile Chat client for Apple iOS via the Apple Push Notification Service (APNS). The previous certificate expires on April 15, 2018 and Sametime administrators should download and apply the updated certificate by that date to prevent interruptions in functionality for users. 

Problems that could occur if the certificate expired

If the certificate in use by the Sametime Proxy server has expired, users of the native iOS chat client will no longer receive push notifications. Users might describe the symptom as receiving messages only when the app is in the foreground, or that notifications are not sent to the device when the IBM Sametime app is in the background. 

The issue can be identified in the server logs by the following error. 

"APNSService W com.ibm.collaboration.realtime.stproxy.services.APNS.APNSService startAPNS CLFRX0079W: Unable to establish an SSL connection to the APNS service Connection refused: connect"

Correct this problem by downloading and installing the updated certificate.

Installation Instructions 

Download the updated certificate 9011-ST-Proxy-IF-GSAI-AWP3B8 [http://www.ibm.com/support/fixcentral/quickorder?product=ibm%2FLotus%2FLotus+Sametime&fixids=9011-ST-Proxy-IF-GSAI-AWP3B8&source=SAR] [https://www-945.ibm.com/support/fixcentral/swg/selectFixes?product=ibm%2FLotus%2FLotus+Sametime&fixids=901-ST-Proxy-FP-WLIN-AL3KHR&source=SAR&function=fixId&parent=Collaboration%20Solutions] from IBM Fix Central. 

Use the installation instructions for your type of deployment: 

 * Stand-alone/Cell installation


If you chose this type of installation, then you have a deployment manager (dmgr), as well as a nodeagent and application server, all are installed on the same machine. Install the updated certificate by completing the following steps: 

1. Copy the provided apns-prod.pkcs12 file to the following directory: 

../IBM/WebSphere/AppServer/profiles/[dmgrProfileName]/config/cells/[cellName]/nodes/[stProxyNodename]/ 

*Note that this is the dmgr profile, NOT the Application profile 

2. Perform a Full Resynchronize of the node 

3. Stop the STProxyServer 

4. Stop the nodeagent 

5. Start the nodeagent 

6. Start the STProxyServer 

 

 * Network (Primary Node) installation


This type of installation typically means that you are using the Sametime System Console (SSC) as the dmgr. Install the updated certificate by completing the following steps: 1. Copy the provided apns-prod.pkcs12 file to the following directory on the SSC operating system file system: 

../IBM/WebSphere/AppServer/profiles/[SSCdmgrProfileName]/config/cells/[SSCcellName]/nodes/[stProxyPNNodename]/ 

*Note that this is the SSC dmgr profile, NOT the SSC Application profile 

2. Perform a Full Resynchronize of the node 

3. Stop the STProxyServer 

4. Stop the nodeagent 

5. Start the nodeagent 

6. Start the STProxyServer 

 

Network (Secondary Nodes) 

If you have any secondary nodes, you need to copy the apns-prod.pkcs12 file to ALL secondary node directories on the SSC dmgr. The secondary node directories are found in the same place as the primary node directory was found: 

../IBM/WebSphere/AppServer/profiles/[SSCdmgrProfileName]/config/cells/[SSCcellName]/nodes 

Once copied to the secondary nodes, make sure to restart the nodeagent and STProxyServer as you did for the primary node.


Certificate verification

Any Sametime proxy server hotfix provided after April 15, 2018 would contain the latest certificate to allow APNS. 
It can be verified either in the Sametime Proxy Server log file named "CurrentStatus.log" or by completing the following steps:

1. Download the Cert Tool from here:

[/support/docview.wss?uid=swg22014461&aid=2]cert.jar [/support/docview.wss?uid=swg22014461&aid=1]

2. Run the following command to verify the APNS status: java -jar cert.jar apns -h

Output Sample:

java -jar cert.jar apns -t -f c:\temp\apns-prod.pkcs12

IssuerDN: CN=Apple Worldwide Developer Relations Certification Authority, OU=Apple Worldwide Developer Relations, O=Apple Inc., C=US
SubjectDN: C=US, O=IBM, OU=RBVH72H5WP, CN=Apple Push Services: com.ibm.lotus.sametime, UID=com.ibm.lotus.sametime
From (yyyy-mm-dd): 2018-03-06
To (yyyy-mm-dd): 2019-04-05
MD5: 57:37:F5:7A:03:EC:D7:A7:2F:C1:95:0F:78:1B:53:24:35:F9:60:F4



testing connection to gateway.push.apple.com:2195
passed

testing connection to feedback.push.apple.com:2196
passed