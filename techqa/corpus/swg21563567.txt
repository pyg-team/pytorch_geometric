Title: IBM How to return a result set from an Oracle stored procedure - United States

Text:
STERLINGHTG TECHNOTE (FAQ)

QUESTION
 How to return a result set from an Oracle stored procedure 

ANSWER


To return a cursor from an Oracle stored procedure, the output parameter of the procedure must be declared as a cursor type. You must also declare that parameter as a cursor in the LWJDBC adapter. Below is a complete working example utilizing existing pools and a Sterling Integrator table. This is for example purposes only, as best practice is to declare an external database pool and utilize an external schema for custom database processes.

First, create your stored procedure in the database:

CREATE OR REPLACE PACKAGE TYPES AS 
type ref_cursor is ref cursor; 
END; 
/ 

create or replace procedure testproc(p_cursor out types.ref_cursor) as 
begin 
open p_cursor for 
select PRODUCT_LABEL, BUILD_NUMBER, LIC_PROD_VER, SI_INSTALL_DATE, SI_COMMENTS from SI_VERSION; 
end; 
/

Test the procedure from Oracle with an anonymous PL/SQL block:

VARIABLE resultSet REFCURSOR; 
EXEC testproc(:resultSet); 
PRINT :resultSet; 

Finally, write a BP to call the stored procedure (some parameters of the LWJDBC adapter are located in the adapter configuration, such as root and row tag):

<process name="1_CallOracleStoredProc"> 
<sequence> 
<operation name="Lightweight JDBC Adapter"> 
<participant name="LightweightJDBCAdapterQuery"/>
<output message="LightweightJDBCAdapterTypeInputMessage"> 
<assign to="." from="*"></assign> 
<assign to="query_type">PROCEDURE</assign>
<assign to="param1">null</assign> 
<assign to="paramtype1">Cursor</assign>
<assign to="sql">{call testproc(?)}</assign> 
</output> 
<input message="inmsg"> 
<assign to="." from="*"></assign> 
</input> 
</operation>
</sequence> 
</process>


To learn more about Oracle stored procedures and result sets, please consult your Oracle database documentation or contact your database vendor.  

If you need assistance configuring the Lightweight JDBC adapter, please contact IBM support and open a new PMR.

 

HISTORICAL NUMBER
 HTG2990