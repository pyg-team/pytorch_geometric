Title: IBM Performance problems for XPLINK applications on CICS TS V3.1 - United States

Text:
XPLINK performance high cpu utilization perfm stac stack 5655M1500 R100 100 R310 310 5655-M15 5655M15 FMID HCP3100 KIXINFO ; kixdcfcic640 retention31 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 You are running an XPLINK application on CICS Transaction Server for z/OS (CICS TS) V3.1 with Language Environment (LE). You are experiencing poor performance with no obvious explanation. The application used 60 times more CPU time than a non-XPLINK application. 

CAUSE
This degradation of XPLINK performance when running XPLINK applications under CICS is caused by overriding the 5th and 6th parameters of the STACK option in CEECOPT, CEEROPT, or DFHAPXPO with values that are too low.

The 5th and 6th parameters on the STACK option specify downstack. XPLINK uses a lot of downstack. If these parameters are set too low then performance problems are likely to result. There will be numerous program checks that are caught by LE and transformed into stack extension calls. This is very inefficient and can account for extremely poor XPLINK performance observations. 

DIAGNOSING THE PROBLEM
If you get situations such as this, setting RPTOPT(ON) in DFHAPXPO can provide useful diagnostic information. When RPTOPT(ON) has been set, a report is produced that details what LE runtime options are being used by the application and where they were set (Installation default, Programmer default, Assembler user exit etc).

Use the report storage option (RPTOPT) during application development because storage usage is very application specific. You should determine what your own storage usage is and alter the default settings accordingly. Only use RPTOPT(ON) during development or problem diagnosis because the output is sent to sysout after each transaction.

RESOLVING THE PROBLEM
Apply PTF UK02429 for APAR PK03640 [http://www.ibm.com/support/docview.wss?&uid=swg1PK03640]. The PTF changes the defaults in the CICS sample program DFHAPXPO to:

STACK(128K,128K,ANY,KEEP, 128K, 128K)

If you are unable to apply the PTF, you should override the default values for the fifth and sixth parameters with '128K, 128K'.

Once you have changed the values for these two parameters, a huge improvement in performance should be seen. The XPLINK application used only half of the CPU time of the non-XPLINK application, hence XPLINK provided a significant improvement in performance.

There are 6 parameters associated with the LE runtime option STACK. See the LE Programming Reference [http://publibfi.boulder.ibm.com/cgi-bin/bookmgr/BOOKS/CEEA3180/1.2.55?SHELF=ez2zbk0d&DT=20070428023816] for details. There are numerous places where LE runtime options can be specified, and there is a hierarchy of precedence. When installing LE, the runtime options in source module CEEDOPT are used. Then, when installing CICS, the LE runtime options in CEECOPT are used and these override anything specified in CEEDOPT. CEEDOPT and CEECOPT are members of SCEESAMP. If you look in the original copy of CEECOPT supplied with z/OS you will see that the default for the STACK runtime option under CICS is:

STACK=((4K,4080,ANYWHERE,KEEP,4K,4080),OVR)

CEEROPT can be used, if required, to provide region specific LE runtime options. The information in CEECOPT will be merged with that in CEEROPT to determine the LE runtime options to be used in your CICS region. Runtime options in CEEROPT override the default options in CEEDOPT and CEECOPT unless NONOVR was specified for a particular option when CEEDOPT or CEECOPT was created. Any runtime options omitted from CEEROPT will be picked up from the installation defaults.

DFHAPXPO is used to provide application specific LE runtime options for XPLINK applications. Any options specified in DFHAPXPO will override what was specified in any of the CEE*OPT modules mentioned above. The default for the STACK in DFHAPXPO is:

STACK(128K,128K,ANY,KEEP)

Therefore, if an unaltered DFHAPXPO is used with an unaltered version of CEECOPT, the STACK runtime option when running a XPLINK application under CICS will be as follows:

STACK(128K,128K,ANY,KEEP, 4K, 4080)

The first 4 parameters are specified in DFHAPXPO so they override anything set elsewhere. DFHAPXPO does not set the final two parameters, therefore the default values for these parameters are picked up from CEECOPT (or CEEROPT).

The 5th and 6th parameters on the STACK option specify downstack. XPLINK uses a lot of downstack. If these parameters are set too low then performance problems are likely to result. There will be numerous program checks that are caught by LE and transformed into stack extension calls. This is very inefficient and can account for extremely poor XPLINK performance observations.

Note: This problem only exists with CICS TS V3.1 as this is the first release of CICS TS where XPLINK has been supported.

RELATED INFORMATION
#How to change the LE/370 runtime options for CICS [http://www.ibm.com/support/docview.wss?uid=swg21153415]




PRODUCT ALIAS/SYNONYM
 CICS/TS CICS TS CICS Transaction Server