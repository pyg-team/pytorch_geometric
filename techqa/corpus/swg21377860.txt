Title: IBM InfoSphere Federation Server ODBC wrapper issue: SQL1822N returned with error code 'HY000' when selecting nickname for Classic Federation Server source - United States

Text:
sql1822; sql551; HY000 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
When selecting nickname defined for remote Classic Federation Server table on MVS, SQL1822N returned.
Exact error message:
SQL1822N Unexpected error code "HY000" received from data source "CF_SERVER".
Associated text and tokens are " SQLTables - Please look up SQLCODE: SQLCODE. 
SQL-Error". 
SQLSTATE=560BD 

DIAGNOSING THE PROBLEM
 

The SQL1822N is a generic error message and there should be a more detail message in DB2 trace that shows the underlined error message. 

The following trace record shows the underlined cause is SQL0551. This error means the remote user doesn't have privilege to access DB2 system catalog which is required for 'CREATE NICKNAME' operation:

12345 error DB2 UDB ODBC wrapper FencedOdbc_Nickname::report_error fnc (4.3.122.84.0.1620)
pid 1003532 tid 1 cpid -1 node 0 sec 19 nsec 86779322 probe 1620
Error ZRC = 0x00000000 = 0 = PSM_OK
bytes 200

Data1 (PD_TYPE_STRING,5) String:
HY000
Data2 (PD_TYPE_STRING,167) String:
[WS Classic][ODBC/CLI Driver][Data Server] SQLStatistics - Please look up SQLCODE: SQLCODE. SQL-Error-Message. -551. Privileges are necessary to run the SQL statement.
Data3 (PD_TYPE_SINT,4) signed integer:
5636144


In addition, a simple test using 'clisamp' test program provided with Classic Federation ODBC driver should confirm whether or not the remote user has SELECT privilege on DB2 catalog. 

The test should show an output similar to the following: 

$ ./clisamp

==== ============================================= ====
==== Database Integrator for z/OS ====
==== ====
==== Please enter SQL commands terminated with ====
==== a semi-colon. ====
==== ====
==== Session Commands: ====
==== SHOW - Display current session control ====
==== option settings ====
==== SET - Set session control options ====
==== HELP - Display command and application ====
==== help usage information ====
==== ============================================= ====

Please enter User ID: MYCLASSICUSER

Please enter User Password: *****
CAC00105I LOG V9.5 00002009: STARTED

Connecting to DataSource 'CACSAMP' as User 'MYCLASSICUSER'

SQLDemo> select * from sysibm.systables;
select * from sysibm.systables;
SQLGetDiagState(HY000) Native(x00560030)
Msg([WS Classic][ODBC/CLI Driver][Data Server] SQLPrepare - Please look
up SQLCODE: SQLCODE. SQL-Error-Message. -551. Privileges are necessary
to run the SQL statement.)

RESOLVING THE PROBLEM
 

1. Grant SELECT privilege on DB2 system catalog to remote Classic Federation Server ID which federated user is mapped to. 

At the minimal, SELECT privilege to these DB2 catalog tables are required: 

- SYSIBM.SYSTABLES, 

- SYSIBM.SYSCOLUMNS, 

- SYSIBM.SYSPLAN 

2. Resubmit 'CREATE NICKNAME' statement.