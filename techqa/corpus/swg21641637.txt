Title: IBM ConfigEngine deploy-paa fails - United States

Text:
deploy-paa; archive; application archive; portal archive TECHNOTE (TROUBLESHOOTING)

PROBLEM
This Technote describes resolutions to common issues using the ConfigEngine task deploy-paa. The examples shown below came specifically from the process to move a Portal environment from staging to production. However, similar problems could occur from any paa downloaded from Lotus Greenhouse or any custom paa. 

RESOLVING THE PROBLEM
Case 1 - Virtual Portals and WCM libraries

You created a Portal Application Archive (PAA) of a source Portal's virtual portal (VP) that contains the source Portal's WCM library data. You installed the archive on a target Portal but the ConfigEngine task deploy-paa fails.
SystemOut.log contains entries similar to:

[4/16/13 13:36:26:133 EDT] 0000009d AbstractImpor E SER3008E: An error occurred importing from file: ...\wcm\allLibraries\554ee7f5\423dc4e4\bfbd28b3\6f9488a5\5be222c2.node.
com.ibm.icm.jcr.command.CommandException: /contentRoot/icm:libraries[5]/z6_000000000000000000000000a0
at com.ibm.icm.jcr.command.AbstractImportNodeCommand.importNode
at com.ibm.icm.jcr.command.ImportStatusCommand.importNode
...
javax.jcr.PathNotFoundException: /contentRoot/icm:libraries[5]/z6_000000000000000000000000a0
at com.ibm.icm.jcr.serialization.handler.ext.AbstractBatchNodeContentHandler.endDocument
at org.apache.xerces.parsers.AbstractSAXParser.endDocument
...
---- Begin backtrace for Nested Throwables
javax.jcr.PathNotFoundException: /contentRoot/icm:libraries[5]/z6_000000000000000000000000a0
at com.ibm.icm.jcr.NodeImpl.getNode
...
[4/16/13 13:36:26:180 EDT] 0000009d PlutoUtilityM E Failed to complete: com.aptrix.pluto.util.RepositoryException: Message: Failed to import the directory ".../content/wcm/allLibraries". Error message: Message: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed., Cause: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed., Cause: java.lang.Exception: Failed to import the directory ".../content/wcm/allLibraries". Error message: Message: com.ibm.icm.jcr.command.CommandException: SER3009E: Import of one or more files failed., Cause: com.ibm.icm.jcr.command.CommandException: SER3009E: at com.ibm.workplace.wcm.data.module.DataModule.processUtility(DataModule.java:108)
at com.aptrix.pluto.util.PlutoUtilityModule.processCurrentContext

Solution: This issue is resolved by APAR PM89104 [http://www-01.ibm.com/support/docview.wss?uid=swg24034497] available in Portal Version 8 Combined Cumulative Fix (CF) 6 [www-01.ibm.com/support/docview.wss?uid=swg24031246].

Alternate Solution: If you cannot apply the CF, use one of two workarounds:

1. Delete the "Portal Site" library from the target Portal's VP and redeploy the archive:

a. Start a scripted Administration session:

cd <path_to_profile>/wp_profile/PortalServer/bin

./wpscript.sh -username <admin-id> -password <admin-password>

b. Set the virtual portal as the active context:

$Portal setvp <virtual_portal_context_root>

c. Login to the Virtual Portal

$Portal login <admin-id> <admin-password> 

d. List the current libraries to make sure you are in the vp:

$DocumentLibrary listall

The output should look like this:

"portal site"

e. Make the "portal site" library deletable:

$DocumentLibrary set "portal site" deletionprohibited false

f. Delete the "portal site" library:

$DocumentLibrary delete "portal site"

g. Exit the scripting client

h. Redeploy the archive to the VP.

2. Or, recreate the archive on the source Portal but do not add WCM data to it. Redeploy the archive on the target Portal and then set up syndication between the source and target Portal's virtual portals.

Case 2 - Clustered environment synchronization

You have created a Portal Application Archive (PAA) of a source Portal's "base" or initial Portal instance. You successfully installed the archive on a target Portal cluster but the ConfigEngine task deploy-paa never completes.

Both the console window and ConfigTrace.log contain entries, similar to the ones below, that indicate application "distribution" is running in a loop until the default application-related timeout values for deploy-paa are exceeded and the task ends.

[wplc-wait-for-sync-to-complete] Distribution of wci completed.
[wplc-wait-for-sync-to-complete] Distribution of EphoxEditLive completed.
[wplc-wait-for-sync-to-complete] Distribution of Quickr_Document_Picker completed.
[wplc-wait-for-sync-to-complete] Distribution of wcm completed.
[wplc-wait-for-sync-to-complete] *********************************************
[wplc-wait-for-sync-to-complete] Distribution of PA_Banner_Ad not complete.
[wplc-wait-for-sync-to-complete] *********************************************
[wplc-wait-for-sync-to-complete] *********************************************
[wplc-wait-for-sync-to-complete] Distribution of PA_BksFinalJSRProject not complete.
[wplc-wait-for-sync-to-complete] *********************************************
[wplc-wait-for-sync-to-complete] *********************************************
[wplc-wait-for-sync-to-complete] Distribution of PA_Blurb not complete.

Solution: In horizontal or vertical cluster ensure that Automatic Synchronization is selected (enabled) in the Deployment Manager Integrated Solutions console (ISC).

Path: System administration > Node agents > nodeagent > File synchronization service.

Case 3 - Large applications in archive

deploy-paa abruptly ends but not all of the portlet applications in the archive have been deployed.

Solution: Rerun ConfigEngine deploy-paa and specify larger values for the command line parameters maxAppTimeToWait and maxTimeToWait. 

ConfigEngine deploy-paa -DmaxAppTimeToWait=<value in minutes> -DmaxTimeToWait=<value in minutes> ...

Notes:

1. If not specified, the defaults for maxAppTimeToWait and maxTimeToWait are 5 and 30 minutes respectively. This means that if deploying a single application may take more than 5 minutes or deploying all applications may take more than 30 minutes in total deploy-paa can timeout before all of the applications have been deployed.

2. IBM Support cannot provide correct values for your environment. You may need to rerun the task more than once to determine the required values for the parameters.

RELATED INFORMATION
 Portal v8 - Staging to Production [http://www-10.lotus.com/ldd/portalwiki.nsf/xpDocViewer.xsp?lookupName=IBM+WebSphere+Portal+8+Product+Documentation#action=openDocument&res_title=Staging_to_production_wp8&content=pdcontent]
Lotus Greenhouse [https://greenhouse.lotus.com/wpsgh/wcm/connect/ghcontent/lotus+greenhouse+next+site/home/lgh+next+homepage]