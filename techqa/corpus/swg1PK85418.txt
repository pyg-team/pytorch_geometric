Title: IBM PK85418: AUDIT LOGGING CAUSES JCR STORE OPERATIONS TO FAIL - United States

Text:
  FIXES ARE AVAILABLE
6.1.0.3 Download: WebSphere Portal and WCM V6.1 fix pack 3, 6.1.5 feature pack [http://www-01.ibm.com/support/docview.wss?uid=swg24025054]
6.1.0.4 Download: WebSphere Portal and WCM V6.1.0 fix pack 4 & 6.1.5 fix pack 1 [http://www-01.ibm.com/support/docview.wss?uid=swg24026394]
6.1.0.5 Download: WebSphere Portal and WCM V6.1.0 fix pack 5 [http://www-01.ibm.com/support/docview.wss?uid=swg24027475]
6.1.0.6 Download: WebSphere Portal and WCM V6.1.0 fix pack 6 [http://www-01.ibm.com/support/docview.wss?uid=swg24030970]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Numerous login exceptions are seen in the logs when content is
   saved with enabled audit logging.
   
   Observed entries in logs:
   [4/23/09 21:07:18:796 WAT] 000000e3 CmapiProvider E
   com.ibm.wps.services.queryservice.impl.providers.CmapiProvider
   getLoginContext EJPFB0002E: Exception occurred.
   
   com.ibm.content.exception.LoginException:
   javax.jcr.LoginException: Login failed for UserId: [...].
   Retrieved authenticated subject with unmatching UserId: [...]
   from WebSphere Application Server.
   at
   com.ibm.content.mediator.util.LoginUtil.initializeLoginContext(L
   
   ginUtil.java:160)
   at
   com.ibm.content.mediator.ContextMediator.initLoginContext(Contex
   
   Mediator.java:107)
   at
   com.ibm.content.mediator.ContextMediator.initContainer(ContextMe
   
   iator.java:79)
   at
   com.ibm.content.mediator.OperationsMediator.getDataGraph(Operati
   
   nsMediator.java:71)
   at
   com.ibm.content.service.transport.LocalPasswordTransport.getData
   
   raph(LocalPasswordTransport.java:99)
   at
   com.ibm.content.service.impl.LoginServiceImpl.loginLocal(LoginSe
   
   viceImpl.java:176)
   at
   com.ibm.content.wps.service.impl.LoginServiceImpl.loginPortal(Lo
   
   inServiceImpl.java:92)
   at
   com.ibm.wps.services.queryservice.impl.providers.CmapiProvider.g
   
   tLoginContext(CmapiProvider.java:202)
   at
   com.ibm.wps.services.queryservice.impl.providers.ICMContentDefau
   
   tProvider.getLocalizedObject(ICMContentDefaultProvider.java:73)
   at
   com.ibm.wps.services.queryservice.impl.LocalizedObjectProviderWr
   
   pper.getLocalizedObject(LocalizedObjectProviderWrapper.java:49)
   at
   com.ibm.wps.services.queryservice.QueryHelper.getDisplayableObje
   
   t(QueryHelper.java:460)
   at
   com.ibm.wps.services.queryservice.QueryHelper.getDisplayableObje
   
   t(QueryHelper.java:437)
   at
   com.ibm.wps.services.queryservice.ResourceTitleManager.getTitle(
   
   esourceTitleManager.java:75)
   at
   com.ibm.wps.services.audit.impl.AuditServiceImpl.addResourceName
   
   AuditServiceImpl.java:1029)
   at
   com.ibm.wps.services.audit.impl.AuditServiceImpl.getResourceEven
   
   Parameters(AuditServiceImpl.java:983)
   at
   com.ibm.wps.services.audit.impl.AuditServiceImpl$ResourceAuditEv
   
   ntListener.resourceRegistered(AuditServiceImpl.java:2072)
   
   
    
   
   

LOCAL FIX
 *  disable portal audit logging.
   
   
    
   
   

PROBLEM SUMMARY
 *  Numerous login exceptions are seen in the logs when content is
   saved with enabled audit logging.
   
   Observed entries in logs:
   [4/23/09 21:07:18:796 WAT] 000000e3 CmapiProvider E
   com.ibm.wps.services.queryservice.impl.providers.CmapiProvider
   getLoginContext EJPFB0002E: Exception occurred.
   
   com.ibm.content.exception.LoginException:
   javax.jcr.LoginException: Login failed for UserId: [...].
   Retrieved authenticated subject with unmatching UserId: [...]
   from WebSphere Application Server.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Resource name resolution for JCR resources has been disabled
   to prevent the concurrent login from the audit service in the
   same session.
   
   Manual Steps:
      None
   
   Failing Module(s):
      Portal Access Control
   
   Affected Users:
      All users
   
   Version Information:
       Portal Version(s): 6.0.1.4
        Pre-Requisite(s): PK80615 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK80615] PK72621 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK72621]
         Co-Requisite(s): ---
   
       Portal Version(s): 6.0.1.5
        Pre-Requisite(s): PK80615 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK80615]
         Co-Requisite(s): ---
   
       Portal Version(s): 6.1.0.1
        Pre-Requisite(s):
         Co-Requisite(s): ---
   
       Portal Version(s): 6.1.0.2
        Pre-Requisite(s):
         Co-Requisite(s): ---
   
   Platform Specific:
      This fix applies to all platforms.
   
   A fix is available from Fix Central:
   
   http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorde
   r?apar=PK85418&productid=WebSphere%20Portal&brandid=5 [http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorder?apar=PK85418&productid=WebSphere%20Portal&brandid=5]
   
   You may need to type or paste the complete address into your Web
   browser.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK85418
   
   
 * REPORTED COMPONENT NAME
   WEBSPHERE PORTA
   
   
 * REPORTED COMPONENT ID
   5724E7600
   
   
 * REPORTED RELEASE
   600
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2009-04-27
   
   
 * CLOSED DATE
   2009-06-08
   
   
 * LAST MODIFIED DATE
   2009-06-08
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPHERE PORTA
   
   
 * FIXED COMPONENT ID
   5724E7600
   
   

APPLICABLE COMPONENT LEVELS
 * R60H PSY
   UP
   
   
 * R60J PSY
   UP
   
   
 * R61A PSY
   UP
   
   
 * R61B PSY
   UP