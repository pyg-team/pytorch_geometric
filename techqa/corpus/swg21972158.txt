Title: IBM "LDAP Server is unavailable" error when connecting to an LDAP server over SSL through Directory Assistance - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM
Unable to connect to LDAP server over SSL. 

SYMPTOM
Customers who access a remote LDAP server through Directory Assistance may run into a case where Domino cannot establish a connection for LDAP over SSL. This may occur after an update to the software on the remote LDAP server. Despite having a correct configuration for an LDAP SSL connection, the connection to the LDAP server consistently fails with the error "LDAP server is unavailable ReturnCode=0x0059 (Bad parameter to an LDAP routine)."


CAUSE
This can occur because of a specific type of packet sent by the remote server during the bind operation which, after being decoded by the SSL layer, is a zero-length message. Domino sees this as an invalid packet and treats it as if a response did not arrive. Because the OS from the Domino server provides an ACK response to the remote server, the conversation reaches a standstill. The Domino LDAP client code then hangs up the connection after a set amount of time (typically 20 seconds) and reports an error.

ENVIRONMENT
This error has been seen when connecting to some LDAP servers after they have been updated with security fixes. Specifically, this has been seen with Novell eDirectory v8.8.7 Patch 4 and later.

DIAGNOSING THE PROBLEM
Enable SSL debug on Domino (debug_ssl_all=2) and review the logs.




The server's console log will show the SSL handshake with the LDAP server completes successfully, but then an error is reported and the connection fails. 


SSL_Handshake> TLS/SSL Handshake completed successfully
.
.
.
LDAP Server is NOT available.
<LDAP GW> LDAP server is unavailable ReturnCode=0x0059 (Bad parameter to an LDAP routine)


RESOLVING THE PROBLEM
The unexpected combining of the bind responses into a single frame is caused by the remote LDAP server's implementation of SSL. There is currently no workaround that can be implemented in Domino for this. 

It may be possible to implement a proxy server to handle LDAP SSL requests, which can send Domino a non-zero length response to the bind request. 

This issue has been reported to Quality Engineering as SPR# RMASA2UK83 and is under investigation.