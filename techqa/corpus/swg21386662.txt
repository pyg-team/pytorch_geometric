Title: IBM Calculating loads using mathematical functions - United States

Text:
load; getload; performance; rulesfile; probe; IZ51431; eps; events per second; loading; loads; statistic; statistics; EPS; Events Per Second; node load; node loading TECHNOTE (FAQ)

QUESTION
 Load function : How can probe performance be measured? 

CAUSE
The load function available within rules file processing is a statistical function.

ANSWER
 

You can use the rules file Mathematical Functions to calculate and log events per second. 

With the rules file maths functions it is possible to provide an intuitive and controlled approach to measuring event events per second. 

 

Add this rules file code to allow logging of events per second: 

<start>
if ( match(%event_counter,"") )
{
%start_time=getdate
%event_counter = 1
}
else
{
%end_time=getdate
$time_elapsed = int(%end_time) - int(%start_time)

# Choose a suitable period for the type of probe and event rate
# e.g. 9,19,29,59 etc. seconds

if (int($time_elapsed) > 9 )
{
$calculated_load = real(%event_counter) / real(int(%end_time) - int(%start_time))
log(WARN,"EPS: " + $calculated_load)
%event_counter = 1
%start_time=getdate
}
else
{
%event_counter = int(%event_counter) + 1
}
}
<end>


For the per node load monitoring the following rules file code can be used;

<start>
array a_node_start_time;
array a_node_counter;


@Node = $Node


if ( match(a_node_counter[@Node],"") )
{
a_node_start_time[@Node] = getdate
a_node_counter[@Node] = 1
}
else
{
a_node_counter[@Node] = int(a_node_counter[@Node]) + 1

# Choose a suitable counter value; e.g. 9,19,49,99 etc.

if (int(a_node_counter[@Node]) > 9 )
{
%end_time=getdate
$time_elapsed = int(%end_time) - int(a_node_start_time[@Node])
$calculated_load = real(a_node_counter[@Node]) / real(int(%end_time) - int(a_node_start_time[@Node]))
log(INFO,$time_elapsed)
log(WARN,"Node: " + @Node + " EPS: " + $calculated_load)
# Reset Node Counter and start time
a_node_counter[@Node] = 1
a_node_start_time[@Node] = getdate
}
}
<end>


For the load functions;


Please refer to the manual on how to use the load functions. 

Apply the latest fix pack with the named APAR below, should the load function appear to slow processing down under heavy loads. 

The related APAR is IZ51431
LIBOPL: LOAD FUNCTIONS IMPACT PERFORMANCE : GETLOAD FUNCTION RETURNS NEGATIVE VALUES ON INTEGER OVERFLOW 

Setting the sample periods to low values will reduce the impact; of the bug 

e.g.
%load = "60.60"



RELATED INFORMATION
 IZ51431: LIBOPL: LOAD FUNCTIONS IMPACT PERFORMANCE [http://www-01.ibm.com/support/docview.wss?uid=swg1IZ51431]