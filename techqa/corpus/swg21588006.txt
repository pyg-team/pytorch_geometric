Title: IBM Health Check event - United States

Text:
mustgather; itnmhealthcheck TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Information to retrieve when investigating Health Check Event problems. 

SYMPTOM
Constant Health Check Failure events are being generated.


DIAGNOSING THE PROBLEM
The virtual domain process monitors the health of the processes running under ncp_ctrl. It generates HC events every 60 seconds. 

The Event Gateway retrieves events for both its own and its companion domain.

So if a process under ncp_ctrl fails or if a HC FAIL event from a companion domain is received, failover can occur.

1. Increase debug in your Primary and Backup Event Gateways so you can see the reception of HC events.

2. During the cycle of HC events, periodically check the alerts.status in both Primary and Backup domains for the Summary, Last and FirstOccurrence and Tally of the ItnmHealthChk events. 

In ITNM 3.8, you can use nco_sql to do perform this query:
select Summary, to_char(FirstOccurrence), to_char(LastOccurrence),Tally from alerts.status where EventId='ItnmHealthChk';

In ITNM 3.9, you can use ncp_oql against the ObjectServer service as an alternative to nco_sql:

ncp_oql -domain <your_domain> -service ObjectServer -server <ObjectServer_name> -user <isql_access_user> -password <isql_access_user_password> -query "select Summary, to_char(FirstOccurrence), to_char(LastOccurrence),Tally from alerts.status where EventId='ItnmHealthChk';"

In the above, replace; 

 * <your_domain> with the Primary or Backup domain, 
 * <ObjectServer_name> with the name of the Primary or Backup ObjectServer (which ever is acting primary) 
 * <isql_access_user> with the username of an ObjectServer user with ISQL access 
 * <isql_access_user_password> the ISQL access user's password'



3. Periodically check the state.domains and state.services table under both of the ncp_virtualdomain processes (Primary and Backup). 
ncp_oql -domain <your_domain> -service virtualdomain -query "select * from state.services;" 
ncp_oql -domain <your_domain> -service virtualdomain -query "select * from state.domains;" 

Correlate the above with the generation of the HC fail event to understand why it is being raised. 

Please review the links in the Related Information section for advice and descriptions of the Health Check Event mechanism. 
RESOLVING THE PROBLEM
If the above does not help resolve the problem, please forward the data you have collected to IBM Tivoli Support along with a full description of the problem.

RELATED INFORMATION
 Trouble shooting failover [http://publib.boulder.ibm.com/infocenter/tivihelp/v8r1/topic/com.ibm.networkmanagerip.doc_3.9/itnm/ip/wip/install/reference/nmip_ins_troubleshootingfailover.html]
Failover concept itnm 3.9 [http://publib.boulder.ibm.com/infocenter/tivihelp/v8r1/topic/com.ibm.networkmanagerip.doc_3.9/itnm/ip/wip/install/concept/nmip_ins_failoverop.html]
State.domains table (ITNM 3.8) [http://publib.boulder.ibm.com/infocenter/tivihelp/v8r1/topic/com.ibm.networkmanagerip.doc_3.8/itnm/ip/wip/ref/reference/nmip_ins_statedbschema.html]


 

PRODUCT ALIAS/SYNONYM
 ITNM