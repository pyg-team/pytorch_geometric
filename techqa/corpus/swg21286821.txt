Title: IBM Five Steps to Get Your Domino for iSeries Server Started - United States

Text:
iseries; as400; i5/os; ibm i; system i; recover; recovery; restart; crash; tips TECHNOTE (TROUBLESHOOTING)

PROBLEM
Your Domino for iSeries server has crashed and you cannot restart it.

CAUSE
 

There may be several Domino and operating system based issues preventing your 

Domino for iSeries server from starting.


RESOLVING THE PROBLEM
 

1) From option 9 of the WRKDOMSVR screen, ensure all jobs for the Domino subsystem are ended. 

- If some of the jobs are not ending in a timely manner, you can try ending the server 

 using the *IMMED parameter 

 A) To do this, use option 6 from the WRKDOMSVR. This evokes the ENDDOMSVR command. 

 [/support/docview.wss?uid=swg21286821&aid=1] [/support/docview.wss?uid=swg21286821&aid=1] 

 

B) You will want to press F4 here to prompt out the ENDDOMSVR command: 


[/support/docview.wss?uid=swg21286821&aid=2] [/support/docview.wss?uid=swg21286821&aid=2]

C) Change the field "How to end" from *CNTRLD to *IMMED

D) When the command completes, both the server and the subsystem should be ended

[/support/docview.wss?uid=swg21286821&aid=3] [/support/docview.wss?uid=swg21286821&aid=3]


- If there are still jobs that will not end, use the ENDJOBABN against them (you will need the Job Number, Job Owner, and Job Name to run the ENDJOBABN command). 

A) You can find the Job Number, Job Owner, and Job Name by following these steps: 

- From the WRKDOMSVR screen, take option 9 

- Take option 5 against the hanging task 

- At the top of the screen, you will see the Job Name, Job Owner, and Job Number. Make a note of these values 

B) Using these values, enter the ENDJOBABN command. After pressing ENTER, you will be prompted for the values: 


[/support/docview.wss?uid=swg21286821&aid=4] [/support/docview.wss?uid=swg21286821&aid=4] 

 

Pressing enter will execute the command. 

NOTE: The command will not run if the ENDDOMSVR *IMMED command was just ran. The system requires 10 minutes for a *IMMED command to complete before the ENDJOBABN command can run. 

 

===================================================================================================================================================== 

 

2) After all jobs for the Domino subsystem have been ended, go to option 12 on the WRKDOMSVR screen. 


[/support/docview.wss?uid=swg21286821&aid=5] [/support/docview.wss?uid=swg21286821&aid=5] 

 

- Delete any files that begin with tilde ( ~ ). These may have the names of: ~notes.lck, ~notetp2.reg, and others. Any filename that begins with a tilde is safe to delete.
[/support/docview.wss?uid=swg21286821&aid=6] [/support/docview.wss?uid=swg21286821&aid=6] 

 

3) Rename the log.nsf as the server will run a consistency check on this database and that could prolong the startup time for the server. 

-Still in the WRKLNK screen (option 12 on WRKDOMSVR) page down to the log.nsf 

- Take option 7 (Rename) for the log.nsf
[/support/docview.wss?uid=swg21286821&aid=7] [/support/docview.wss?uid=swg21286821&aid=7]

-Enter the new name of the log.nsf on the Rename Object screen. It is not necessary to enter the full path

[/support/docview.wss?uid=swg21286821&aid=8] [/support/docview.wss?uid=swg21286821&aid=8]

-The log.nsf will be rebuilt when the server starts.


4) Release IFS locks against the names.nsf, and admin4.nsf databases. 

- From the WRKDOMSVR screen, press F11 twice to determine the Domino Data Directory file path. 

 The format of the RLSIFSLCK command is: 

 RLSIFSLCK OBJ('/Domino/Data/names.nsf') 

 Example: RLSIFSLCK OBJ('/notes/data/names.nsf') 

 After the IFS lock is released, the following message will appear: 

 "Locks released on /DOM652b/Data/names.nsf." 

 Repeat this command for the admin4.nsf database. 

 

4) Clean up any semaphores and shared memory segments that are owned by QNOTES. 

- Verify there are no active QNOTES jobs with green screen command: 
WRKUSRJOB USER(QNOTES) STATUS(*ACTIVE) 

- When on an iSeries box that hosts only one Domino server, you may do this via iSeries Navigator: 

 a) Open an iSeries Navigator session to your iSeries box. 

 b) Open the "Application Development" section 

 c) Open the "Interprocess Communication" section 

 d) Open the "Semaphore Sets" section and delete any semaphores owned by QNOTES 

 e) Open the "Shared Memory" section and delete any shared memory segments owned by QNOTES

NOTE: ONLY USE THE ABOVE PROCEDURE IF YOU ARE RUNNING ONE DOMINO
SERVER ON YOUR ISERIES BOX! 

 

- Should you be running multiple Domino Servers on your iSeries box, then you need to contact 

Domino for iSeries Support and request the DLTDOMSMEM tool (see technote link below for details) 

 

You should now be able to start your Domino for iSeries server. In some cases, Support has found 

it was necessary to rename the log.nsf (you will see errors that complain about Semaphore type of locks and may display a "ti" message. 

 

In some other cases, it may be necessary (while the Domino Server is in an ENDED status) to clean 

up any TCPIP connections owned by QNOTES (when the Domino Server is in an ENDED status, there should be no Semaphores, Shared Memory segments, or TCPIP connections owned by QNOTES). 

- Issue the CL command, "NETSTAT *CNN". 

- Press F11 and scroll through the existing connections ensuring none are owned by QNOTES. 

 

Miscellaneous Notes:
In some cases, you may need to delete pid.nbf.

You should also review notes.ini for corrupted data. You might see lines containing garbage characters at the end of the notes.ini or interspersed with the notes.ini parameters. Or you might see garbage characters next to the notes.ini parameters. Clean up or update the notes.ini with valid parameters.

For example, if the Domino 'splash info' never display in the console, this may be due to incorrect or corrupted information in the notes.ini parameter Directory=/xxxxx/xxxx.

RELATED INFORMATION
 DLTDOMSMEM / DLTDOMSEM / DLTSTSHMEM utility [http://www.ibm.com/support/docview.wss?uid=swg21396496]