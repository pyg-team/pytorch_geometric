Title: IBM PK46062: ABEND0C4 RC4 DSNXECW +865C WHEN USING STORED PROCEDURES         SMCOVERLAY - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  ABEND0C4 RC4 DSNXECW +865C
   .
   The problems occur in general for stored procedures that are
   repeatedly invoked during the life of one DB2 connection /thread
   and the stored procedure invokes different language application
   programs (via  language calls) with each stored procedure
   invocation and there are COMMITs / ROLLBACKs executed between or
   during the stored procedure execution.  The problem is most
   likely to occur on DB2 systems with very heavy workloads.
   .
   Additional symptoms:
   ABEND04E RC00E20029 DSNSVBK +09FA caller is DSNXECW
   ABEND0C4 RC10 DSNSVBK +0FB2  caller is DSNXECW
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: All DB2 users of stored procedures that      *
   *                 invoke different external application        *
   *                 programs during each run of the stored proc  *
   ****************************************************************
   * PROBLEM DESCRIPTION: While repeatedly running a stored proc  *
   *                      procedure that invoked different        *
   *                      application programs on each run,       *
   *                      one of the following abends occurred:   *
   *                                                              *
   *                       AB0C4 RC00000004 DSNXECW +865C         *
   *                       AB04E RC00E20029 DSNXECW.DSNSVBK +09FA *
   *                       AB0C4 RC00000010 DSNXECW.DSNSVBK +0FB2 *
   *                                                              *
   *                      Other abends are possible.              *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   User repeatedly called same stored procedure during one DB2
   connection.  The stored procedure invoked different external
   application programs via language calls during each stored
   procedure run, sometimes returning result sets and sometimes
   not, and the calling application sometimes issues COMMIT and
   sometimes not as in the following example:
      Calling Application:
        CALL Stored ProcedureA
           Stored ProcedureA: (NO AUTO COMMIT ON RETURN)
             Issue language call to external ApplicationA
               (ApplicationA issues 1st SQL of stored proc run, and
                does NOT return result sets)
             Return to Calling Application
        (No COMMIT between these CALLs)
        CALL Stored ProcedureA (2nd time)
           Stored ProcedureA:
             ApplicationA is not called this time, instead
             Issue language call to ApplicationB
               (ApplicationB issues 1st SQL of stored proc run, and
                ApplicationB RETURNS WITH HOLD result set for
                Stored ProcedureA)
             Return to Calling Application
      Calling Application:
        Fetch the WITH HOLD returned result set from ProcedureA,
        COMMIT issued from Calling Application
        Issue CLOSE for the WITH HOLD result set returned
        CALL Stored ProcedureA (3rd time)
           Stored ProcedureA:
             ApplicationA is not called, instead
              Issue language call to ApplicationB
               (ApplicationB issues 1st SQL of stored proc run, and
                does NOT return result sets this time)
             Return to Calling Application
      Calling Application:
        COMMIT later issued from Calling Application
        >>> any one of the following abends occurred during COMMIT:
            ABEND0C4 RC 00000004 DSNXECW +865C
            ABEND04E RC 00E20029 DSNXECW.DSNSVBK +09FA
              ( DSNXECW.DSNSVBK = DSNSVBK called by DSNXECW )
            ABEND0C4 RC 00000010 DSNXECW.DSNSVBK +0FB2
                                                                  .
   Using information in the dump and examination of DB2 code,
   DB2 Development determined that the abend occurred on the 2nd
   COMMIT because during the 3rd run of Stored ProcedureA (where
   ApplicationA is NOT called), DB2 used a residual pointer that
   referred to ApplicationA storage that had been freed on previous
   COMMIT and DB2 overlaid that re-used storage with one byte of
   hex FF during the 3rd run of Stored ProcedureA.
                                                                  .
   ****************************************************************
   The overlay can only occur with the complicated mix of repeated
   stored procedure calls with and without a HOLD result set from
   different invocations of external language applications and
   COMMIT issued from the calling application after 2nd CALL to
   stored proc as previously described.  If any one of the elements
   or order of events described above in the scenario diagram is
   not present or does not occur, then the overlay will not occur.
                                                                  .
   Moreover, even when overlay 'FF'x happens, the abends only occur
   if that storage had been previously reassigned or reused for
   other purposes by DB2. This typically only happens in DB2
   systems with a very high transaction load.
   ****************************************************************
                                                                  .
   The overlay can occur in either V8 CM or V8 NFM .
   Other abends or unexpected results are possible following
   the overlay of FFx.
                                                                  .
   
   
    
   
   

PROBLEM CONCLUSION
 *  DB2 code was changed to properly reset the residual pointer to
   prevent incorrect reuse of the ptr and overlay with 'FF'x.
                                                                  .
   Additional search keywords: SQLSP SQLSTOREDPROC
                                                                  .
   
   
    
   
   

TEMPORARY FIX
 *  AK46062
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK46062
   
   
 * REPORTED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * REPORTED COMPONENT ID
   5740XYR00
   
   
 * REPORTED RELEASE
   810
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2007-05-29
   
   
 * CLOSED DATE
   2007-06-25
   
   
 * LAST MODIFIED DATE
   2008-01-02
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UK26532
   
   

MODULES/MACROS
 *  DSNXERT2
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   DB2 OS/390 & Z/
   
   
 * FIXED COMPONENT ID
   5740XYR00
   
   

APPLICABLE COMPONENT LEVELS
 * R810 PSY UK26532 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UK26532]
   UP07/07/11 P F707
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.