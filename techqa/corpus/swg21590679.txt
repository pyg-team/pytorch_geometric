Title: IBM EJPAK0003W occurs because login portlet did not receive user's credentials - United States

Text:
SSL; login; redirect; EJPAK0003W; POST; rewrite TECHNOTE (TROUBLESHOOTING)

PROBLEM
When HTTPS is configured for login, a redirect rule on the web server may prevent the POST over HTTPS from reaching the web server plug-in.

SYMPTOM
Users' logins fail with: 

EJPAK0003W: Please enter a valid user ID and password.


CAUSE
The login portlet is configured to submit user credentials over HTTPS. The web server may redirect such requests. For example, if IBM HTTP Server's httpd.conf contained a rewrite rule like: 

RewriteEngine on 

RewriteCond %{SERVER_PORT} ^443$ 

RewriteRule ^(.*)$ http://xxxxxxxxxxx$1 [L] 

When the browser sends the POST over HTTPS, the web server responds with a 302 redirect to location http://..., which the browser follows by issuing a GET over HTTP without including the user name and password form data.


ENVIRONMENT
HTTPS configured for login-only going through an external web server running the WebSphere Application Server plug-in.



DIAGNOSING THE PROBLEM
Any of several approaches, or a combination of these approaches, can be taken to diagnose this problem: 

1. Enable com.ibm.wps.engine.*=all tracing and recreate the problem. In trace.log, look for: 

WPActionPhase 3 com.ibm.wps.engine.phases.WPActionPhase cleanUpTarget State after 

target removal: <... 

<portlet id="(objectid of login portlet instance)"> 

<param name="wps.portlets.login.status_message_key"> 

<value>NO_USER_ID_OR_PASSWORD_0</value> ... 

<param name="wps.portlets.login.status_message_code"> 

<value>EJPAK0003W</value> 

which indicates that WebSphere Portal did not receive the form data with the user's credentials. 

2. From the client perspective, inspect HTTP headers (e.g. in a Fiddler trace) and see how the web server responds to the POST/HTTPS. If it responds with a 302 redirect to a location of the same URL but over HTTP, then check the web server configuration. 

3. Collect a plug-in trace and web server access log. If the login POSTs are not served by the plug-in, inspect the web server configuration. For example: 

access.log: 

<IP address> - - [timestamp] "POST /wps/portal/... 

<IP address> - - [timestamp] "GET /wps/portal/... 

plug-in trace: 

(No corresponding POST.) 

[timestamp] 00001004 00000960 - DETAIL: GET /wps/portal/...


RESOLVING THE PROBLEM
Remove the rewrite rule from web server's configuration. Alternatively, alter the rewrite rule to avoid the redirect on the login POSTs.

RELATED INFORMATION
#Fiddler [http://www.fiddlertool.com]
Plug-in MustGather [http://www-01.ibm.com/support/docview.wss?uid=swg21174894]
WebSphere Portal tracing [http://www-10.lotus.com/ldd/portalwiki.nsf/dx/WebSphere_Portal_runtime_logs_wp7]
IHS Rewrite rules (mod_rewrite Apache module) [http://publib.boulder.ibm.com/infocenter/wasinfo/fep/index.jsp?topic=%2Fcom.ibm.websphere.ihs.doc%2Finfo%2Fihs%2Fihs%2Frihs_apachemods.html]