Title: IBM HMC Certificates Signed with a Weak Signature Algorithm are No Longer Supported - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 HMC Certificates signed with a weak signature algorithm are no longer supported. Attempting to install the latest HMC PTFs on a HMC using the weak signature algorithm will fail. At certain older PTF levels, the PTF will install successfully; however, after the installation completes, the HMC will ignore the down-level certificate causing remote access over SSL to fail. Firefox reports "ssl_error_no_cypher_overlap". 

To resolve the issue, you should create a new certificate. 

SYMPTOM
If the failing HMC is upgraded to 8.8.6 or later prior to correcting the issue, the symptom includes browser reporting "Proxy Error: The proxy server received an invalid response from an upstream server. The proxy server could not handle the request GET/" prior to the logon.


CAUSE
Recent security updates to the HMC no longer support HMC certificates signed with a weak signature algorithm. Self-signed HMC certificates created at earlier Version 7 releases or code levels may be impacted. At certain PTF levels, the PTF will install successfully; however, after the installation completes, the HMC will ignore the down-level certificate causing remote access over SSL to fail. At later PTF levels, the PTF installation validates the currently installed certificate and will block the installation with an error until the down-level certificate has been updated. HMC Version 8 can be impacted if the HMC was upgraded from Version 7. 

ENVIRONMENT
HMC PTFs potentially impacted the following:


o 7.7.8: MH01504 and later
o 7.7.9: MH01505 and later
o 8.8.1: MH01506 and later
o 8.8.2: MH01507 and later

Installation time validation of the certificate was added in the following:

o 7.7.8: MH01536 and later
o 7.7.9: MH01537 and later
o 8.8.1: MH01532 and later
o 8.8.2: MH01538 and later
o 8.8.3: MH01539 and later

Note: Loss of remote connectivity only occurs when:
- An impacted PTF without the installation validation is installed.
- The HMC has a certificate created with an older Version 7 HMC Certificate Signature Algorithm of md5WithRSAEncryption.


DIAGNOSING THE PROBLEM
PTF installation fails 

Attempting to install the HMC PTF levels that include installation time validation (see list above) on a HMC using the weak signature algorithm will fail. If the installation fails, you should view the /tmp/HmcInstall.log file and check for the following error:

"The existing certificate in HMC has 'md5WithRSAEncryption' as Signature Algorithm, which is no longer supported."
"Generate a new certificate with strong signature algorithm (eg. sha256WithRSAEncryption ), import the certificate to 
HMC and try the installation again."

Loss of remote connectivity after a PTF installation

Verify the PTF installation is one of the PTFs listed above which does not include installation time validation.
Ensure that the browser has TLS1.0 enabled (TLS1.2 if nist mode is enabled). 
If the problem occurs after applying the HMC security PTF and TLS1.0 is enabled, this is likely the issue.

Note:The HMC certificate details cannot be viewed locally. The certificate cannot be accessed remotely if remote access is lost. The certificate may, however, still be available in the browser's certificate manager list if the user added it as a trusted server prior to encountering the error. If the certificate exists in a browser certificate manager list, the signature algorithm can still be checked using the instructions below.


RESOLVING THE PROBLEM
 

Preventing the issue

The HMC certificate Signature Algorithm can be verified prior to installing the updates. If the Signature Algorithm is md5WithRSAEncryption, do not install the updates until the certificate has been updated. To check the current Certificate Signature Algorithm, you should do the following: 

1. Open a remote browser session to the HMC. 2. Use the browser to view the certificate details. Browser specific information on how to view certificate details can be found at the following locations:

Firefox: https://support.mozilla.org/en-US/kb/secure-website-certificate [https://support.mozilla.org/en-US/kb/secure-website-certificate]
Internet Explorer: http://windows.microsoft.com/en-us/windows-vista/get-information-about-secure-sockets-layer-ssl-certificates [http://windows.microsoft.com/en-us/windows-vista/get-information-about-secure-sockets-layer-ssl-certificates]
Chrome: https://support.google.com/chrome/answer/95617?hl=en [https://support.google.com/chrome/answer/95617?hl=en] 3. View the Certificate Signature Algorithm. In the certificate details, select Certificate Signature Algorithm. 

Example:
certificate details [/support/docview.wss?uid=nas8N1020801&aid=1] [/support/docview.wss?uid=nas8N1020801&aid=1]

If the Signature Algorithm is md5WithRSAEncryption, do not install the updates until the certificate has been updated. Continue with the "Recovery" section below. 
If the Signature Algorithm is another value such as "SHA-256 with RSA Encryption", no further action is required. Apply the PTFs. 

Note: The format or wording of the Signature Algorithm value may vary depending on the browser/tool used to view the certificate. For example, Firefox shows "PKCS #1 SHA-256 With RSA Encryption"; however, Chrome displays it as "sha256RSA". Both are the same. 

Recovery 1. Create and install a new self-signed certificate:

a) Run the task HMC Management > Manage Certificates. 
b) Click Create > New Certificate, select Self-signed and then click OK. 
c) Fill in the requested information and click OK. 
d) Reply Yes to the prompt to replace the certificate and restart the HMC. 
e) Click Ok to restart. 

Note: The new certificate can be created from a remote browser connection, if available. If remote connectivity loss occurs after the PTF has been applied, the recovery (install new self-signed certificate) must be performed from the local HMC console. Once the restart is complete, remote browser connectivity should be available again. 2. Install the PTFs. Once the certificate install and console restart are complete, install the PTFs.