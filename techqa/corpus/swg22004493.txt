Title: IBM DB2 V11.1 Java stored procedures may receive NoClassDefFoundError for PowerClassLoader - United States

Text:
 TECHNOTE (FAQ)

QUESTION
 Why DB2 V11.1 java stored procedures receive NoClassDefFoundError for PowerClassLoader? 

CAUSE
It is an known expected behavior.

ANSWER
Here is a sample message on V11.1 db2diag.log. 

-----
2017-05-17-13.15.12.609355+540 I48192085A779 LEVEL: Error
PID : 18350522 TID : 1 PROC :
INSTANCE: db2inst1 NODE : 000
HOSTNAME: DB2INST1
EDUID : 1
FUNCTION: DB2 UDB, BSU Java support, sqlejLogEarlyException, probe:11029
DATA #1 : String, 476 bytes
java.lang.NoClassDefFoundError: COM.ibm.db2.app.classloader.PowerClassLoader
Caused by: java.lang.ClassNotFoundException: 
COM.ibm.db2.app.classloader.PowerClassLoader
at java.net.URLClassLoader.findClass(URLClassLoader.java:607)
at java.lang.ClassLoader.loadClassHelper(ClassLoader.java:844)
at java.lang.ClassLoader.loadClass(ClassLoader.java:823)
at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:325)
at java.lang.ClassLoader.loadClass(ClassLoader.java:803)
-----

It may be logged when db2java.zip does not exist in CLASSPATH on DB2 V11.1 since it 
contains "COM.ibm.db2.app.classloader.PowerClassLoader" class. This issue can not be 
happened on V9.7/V10.1/V10.5 even if it does not exist at CLASSPATH.

The different behavior between V11.1 and V9.7/V10.1/V10.5 is caused by a feature 
enhancement for DB2 stored procedure handling in V11.1.

It may be suggested to check to see if db2java.zip exist as it was installed under 
$INSTHOME/sqllib/java directory.

It is documented that db2java.zip file was deprecated in Version 8.2 as below:
* V10.1, DB2 JDBC Type 2 Driver is discontinued
https://www.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.db2.luw.wn.doc/doc/i0058719.html [https://www.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.db2.luw.wn.doc/doc/i0058719.html]
-----
Details

The DB2 JDBC Type 2 Driver for Linux, UNIX, and Windows which was packaged in the 
db2java.zip file was deprecated in Version 8.2. 
-----

But db2java.zip file itself is required for Java stored procedures on DB2 V11.1.


Note:
This behavior might be changed without notice in the future. We can confirm whether 
this technote is valid or not by renaming db2java.zip.
Please contact your Sales Rep to submit a potential design change towards a future 
release. Or please open a ticket, Request For Enhancement at 
https://www.ibm.com/developerworks/rfe/ [https://www.ibm.com/developerworks/rfe/]

RELATED INFORMATION
 DB2 JDBC Type 2 Driver is discontinued [https://www.ibm.com/support/knowledgecenter/SSEPGG_10.1.0/com.ibm.db2.luw.wn.doc/doc/i0058719.html]