Title: IBM How to modify theme so that all URL links open in a new window - United States

Text:
theme; window; new; link; Portal; default TECHNOTE (FAQ)

QUESTION
You create a new URL link using the Manage Pages portlet in IBM® WebSphere® Portal version 7.0.0.2. When a user clicks on this new URL link, it displays the target page in the same window as opposed to opening a new Web browser window. How can you force it to open a new browser window when clicking the URL link?

ANSWER
In this scenario, the customer was working on a page copied from the default IBM theme which implements top navigation ("Portal" theme). In order to have URL links open in a new window, it is necessary to perform the following steps: 

1. Edit the topNav.jspf located in <WSAS_profile_root>/installedApps/<cellname>/wps.ear/wps.war/themes/html/<themeName> as follows: 

 <portal-navigation:navigation startLevel="${i}" stopLevel="${i}">
<ul class="wpsPageBar<c:if test="${i eq themePolicy.topNavigationStartLevel}">FirstRow</c:if>">
<portal-navigation:navigationLoop>
<% boolean openInNewWindow = com.ibm.portal.content.ContentNodeType.EXTERNALURL.equals(wpsNavNode.getContentNode().getContentNodeType()); %>
<portal-logic:if nodeInSelectionPath="yes">
<% boolean isNodeSelected = wpsSelectionModel.isNodeSelected(wpsNavNode); %>
<li class="wpsSelectedPage" <%if (isNodeSelected) { %> id="portalSelectedNode" onmouseover="showPageAffordance(); return false;" onmouseout="hidePageAffordance(); return false;" <% } %> >
<a href="<portal-navigation:navigationUrl type='launch' />" <% if (openInNewWindow) {%>target="_blank"<% } %><% if (isNodeSelected) { %>onfocus="showPageAffordance()" <% } %> >
<portal-fmt:title/>
</a>
. . . . . . .
<portal-logic:if nodeInSelectionPath="no">
<li class="wpsUnSelectedPage">
<a href="<portal-navigation:navigationUrl type='link' />" <% if (openInNewWindow) {%>target="_blank"<% } %>><portal-fmt:title/></a>
</li>
</portal-logic:if>
</portal-navigation:navigationLoop>
</portal-navigation:navigation>

2. "Touch" the Default.jsp for the theme (located in the same directory) by editing the file (nature of edit does not matter) and then saving the file. 
3. Remove any temp files for the theme in <WSAS_profile_root>/temp/<cellname>/WebSphere_Portal/wps/wps.war/themes/html/<themeName>. 
4. Start WebSphere Portal.
5. Click on the URL link and it should now open a new window. 

For the PageBuilder2 theme, you could add the following JavaScript function to the theme after the config DCS (Need to be on 7.0.0.2 CF09+ for this sample to work).

com.ibm.widgets.NavigationWidget.extend({
createItemRep: function(navNode) {

var widget = this.inherited(arguments);

//Since external URLs will be of type NavigationPage you need to use xPath
//var contentLink = com.ibm.mashups.enabler.xml.XPath.evaluateEntry("atom:link[@ext:rel='externalurl']", navNode.getXml(), navNode.ns_nav);

//CF09 now returns URLs as NavigationURLs
var nodeType = navNode.getNavigationElementType();
if(nodeType == com.ibm.mashups.enabler.navigation.Constants.NAVIGATION_URL){
var url = navNode.getURL();
}

if(url){
console.log(navNode.getTitle("en") + " External page URL " + url);
widget._onClick = function(evt){
dojo.stopEvent(evt);
this.focusNode.blur();
window.open(url);
}
}

return widget;
}
});


Please note that modifying com.ibm.widgets.NavigationWidget.createItemRep(navNode) will not be sufficient. Navigation links displayed by the navigation bar in a drop-down menu require changes in com.ibm.widgets.NavigationMenu.createItemRep(navNode) as well.

For the 7002 Portal theme, you could make the following changes in the navigation.jsp

First create a map to store the constants:
<% java.util.Map<String, String> constantsMap = new java.util.HashMap<String, String>();
constantsMap.put("EXTERNALURL",com.ibm.portal.content.ContentNodeType.EXTERNALURL.toString());
pageContext.setAttribute("constantsMap", constantsMap);
%>

Then change the URL from:

<a href="?uri=nm:oid:${nodeID}">

to:

<a href="?uri=nm:oid:${nodeID}" <c:if test="${node.contentNode.contentNodeType == constantsMap.EXTERNALURL}">target="_blank"</c:if>>

Note: These samples are provide as-is and cannot be customized by Portal Support to work in your environment. The steps above regarding modification of the default "out of the box" themes are provided as an example. Changes to the default themes and skins may be overwritten when applying a service pack.

RELATED INFORMATION
 Modifying side navigation for URL links [http://www.ibm.com/support/docview.wss?uid=swg21256652]