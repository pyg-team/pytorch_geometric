Title: IBM Respository Data Collection Job causes performance degradation when running RTC on DB2 z/OS - United States

Text:
DB2z; z/os; data collection job; RTC; ETL; CCM TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Attempts to run the Repository Data Collection job results in long running query with IBM Rational Team Concert (RTC) 

SYMPTOM
The Repository data collection job will run the following statement:
SELECT s.ITEM_TYPE_DBID , SUM ( COALESCE ( CAST ( LENGTH ( s.ITEM_VALUE ) AS BIGINT ) , CAST ( 0 AS BIGINT ) ) ) , COUNT ( * ) , COUNT ( DISTINCT ( s.ITEM_UUID ) ) FROM CCM002_REPOSITORY.ITEM_STATES s GROUP BY s.ITEM_TYPE_DBID

When running IBM DB2 z/OS, this query will cause a performance degradation on the server and continue running for some time (upwards of 20 hours).


CAUSE
This has been identified as a product defect under APAR PM95449

ENVIRONMENT
Rational Team Concert using back end DB2 a/OS database

DIAGNOSING THE PROBLEM
The following is an excerpt from a server dump during the long running query:
at java/net/SocketInputStream.socketRead0(Native Method)
at java/net/SocketInputStream.read(SocketInputStream.java:129(Compiled Code))
at java/net/ManagedSocketInputStreamHighPerformanceNew.read(ManagedSocketInputStreamHighPerformanceNew.java:289(Compiled Code))
at com/ibm/db2/jcc/t4/z.b(z.java:199(Compiled Code))
at com/ibm/db2/jcc/t4/z.c(z.java:268(Compiled Code))
......
at com/ibm/db2/jcc/am/jn.a(jn.java:679)
at com/ibm/db2/jcc/am/jn.executeQuery(jn.java:663)
at com/ibm/team/repository/service/internal/db/jdbcwrappers/stat/StatementStatWrapper.executeQuery(StatementStatWrapper.java:199)
at com/ibm/team/repository/service/internal/db/jdbcwrappers/errlog/StatementErrLogWrapper.executeQuery(StatementErrLogWrapper.java:191)
at com/ibm/team/repository/service/internal/db/jdbcwrappers/leak/StatementLeakWrapper.executeQuery(StatementLeakWrapper.java:78)
at com/ibm/team/scm/admin/server/SCMAdminServiceInternal.updateStatesInfo(SCMAdminServiceInternal.java:709)
at com/ibm/team/scm/admin/server/SCMAdminServiceInternal.getRepoFootprintReport(SCMAdminServiceInternal.java:281)
....

RESOLVING THE PROBLEM
This defect is being tracked in Defect 275846 [https://jazz.net/jazz/web/projects/Rational%20Team%20Concert#action=com.ibm.team.workitem.viewWorkItem&id=275846] on jazz.net. At the time of publishing this technote, the defect is not planned for any release.


WORKAROUND:
To mitigate the long running query, disable the data collection jobs named: 'Repository' in the Jazz Team Server (JTS) and Change and Configuration Management (CCM) applications.






None of the reports that are deployed by default will be affected. However, some of the reports that are shipped but not deployed by default will be affected. These reports are used mainly for diagnostic and debug purposes, and are: 

 * Repository Integral Range Counters: displays internal repository counters
   
   
 * Repository Metrics by Namespace: displays internal repository sizing data
   
   
 * Repository Metrics: displays internal repository sizing data
   
   
 * Repository Range Counters: displays internal repository counters
   
   
 * Repository Scalar Counters: displays internal repository counters
   
   
 * Service Call Counters: displays internal repository counters
   
   
 * Latest Repository Metrics by Namespace: displays internal repository sizing data
   
   
 * Latest Repository Metrics: displays internal repository sizing data
   
   


Leverage the Jazz Community The Jazz based products have an active community that can provide you with additional resources. Browse and contribute to the User forums, contribute to the Team Blog and review the Team wiki.
Refer to technote 1319600 [http://ibm.com/support/docview.wss?uid=swg21319600] for details and links.