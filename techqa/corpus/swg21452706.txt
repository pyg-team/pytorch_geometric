Title: IBM Intermittent "Finished with Error ... Cannot insert duplicate key in object 'dbo.zlog'" when running Import via Staging Table, caused by running jobs with exactly the same date/time - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Customer is importing external data from staging tables. Customer is trying to process a series of five batches each time with the companies always in the same order. Sporadically the status for the first batch is returned as "Finished with Error". The same series may be run again, or a separate file reprocessed and it comes back "Finished" (i.e. successful).



SYMPTOM
Intermittently, Controller gives the error message: 'Finished with error'. 

 * (Customer can re-run the *exact* same import, using the *exact* same parameters immediately afterwards, and this time it works OK).


Event Viewer (Application Log) on the Controller application server: 

 
Application FrSrvFunc: Thread ID: 1576 ,Logged: Error occured at 11/5/2010 12:16:28 AM in FrSrvFunc, Error No=-2147217873, Source=Server function:Dbp_ExecuteImmediate(..) , Description=Violation of PRIMARY KEY constraint 'PKC_ZLOG'. Cannot insert duplicate key in object 'dbo.zlog'., HelpFile= HelpContext=0

Application FrSrvFunc: Thread ID: 1576 ,Logged: Error occured at 11/5/2010 12:16:28 AM in FrSrvFunc, Error No=-2147217873, Source=Server function:Dbp_InsertSqlRemote(..) , Description=Violation of PRIMARY KEY constraint 'PKC_ZLOG'. Cannot insert duplicate key in object 'dbo.zlog'., HelpFile= HelpContext=0



CAUSE
There are many different possible causes for 'Finished with Error' messages when importing from staging tables. 

 * For more examples, see separate IBM Technote #1497825.


This IBM Technote specifically relates to the scenario where the Application log mentions the error " Cannot insert duplicate key in object 'dbo.zlog'". 

In this scenario, the problem is triggered because the customer is trying to processes a series of five batches in a very short period of time. This is violating the uniqueness of the date/time variable used for the import. 

More Information: 
The error states that the problem is on the primary key on the zlog table. This key is made up from a composite of the:  * import definition 
 * structure being used 
 * batchid 
 * username 
 * and date+time (to the second).


The date and time is making the error intermittent, because only in the occasions when multiple batches are being processed at the same time (or within differences of a split second) will the error occur. 
DIAGNOSING THE PROBLEM
'Finished with errors' is a generic error message, therefore look inside Event Viewer to check the exact nature of the problem.



RESOLVING THE PROBLEM
Schedule the imports so they do not run simultaneously.

RELATED INFORMATION
#1418511 â€‹- Import via Staging Table Finishes With Error [http://www.ibm.com/support/docview.wss?uid=swg21418511]
1497825 - ** Troubleshooting ** "Finished with Error" w [http://www.ibm.com/support/docview.wss?uid=swg21497825]