Title: IBM XFF header configuration on QRadar Network Security sensors - United States

Text:
XGS; XFF TECHNOTE (FAQ)

QUESTION
 How do you configure inspection that uses X-Forwarded-For (XFF) headers on the QRadar Network Security (XGS) sensor? 

CAUSE
The XFF header matching feature was added to the XGS sensor in firmware 5.3.1. This article covers the basic configuration that is required to enable this feature along with some common questions that IBM Support has received on the subject.

ANSWER
Firmware 5.3.1 for the XGS introduced the ability to configure rule matching in the Network Access Policy based on XFF header information. To enable this feature, you must add both of the following tuning parameters to the Advanced Tuning Parameters policy on the sensor: 

Name: alpsd.xff.enabled
Value: true
Description: Enables XFF processing on the XGS sensor. 

Name: alpsd.xff.proxy
Value: Enter a comma-separated list of IPv4/IPv6 addresses, ranges, or subnets. To match all proxy servers, enter any.
Description: Defines the list of trusted internal enterprise proxy servers that are enabled for XFF processing.

Note: Modifying or adding these tuning parameters restarts the analysis engine, but does not cause a change in link state for the sensor.


Frequently Asked Questions

Question: How many proxy IP addresses can be added to alpsd.xff.proxy parameter?

Answer: There is no limit that is defined for the number of proxy addresses that can be added.


Question: Are there any restrictions for the type of Address Objects that you can create that use the proxy addresses defined for XFF? 

Answer: Any Address Object type that requires the user to provide the address information (Host, Range, Subnet, List, Group) will work. Geolocation does not work because that Address Object type relies on the geographic location of the IP address.


Question: Does the source IP address in the IPS events and Network events display the proxy IP address or the XFF IP address?

Answer: The source or destination IP addresses continue to display the proxy IP address. The content of the XFF header is reported in the event details under the :X-Forwarded-For column and the event-info column. 


Question: Can you perform a search on either the proxy IP address or the XFF IP address in SiteProtector?

Answer: Yes, it is possible to search for both types of address information in SiteProtector. 

Searching for the proxy IP address is a standard search that uses the Source IP or Target IP fields.

Searching for the XFF IP address requires that you filter by using AVP data. You can do this using the following instructions:


 1. In the Analysis view, click Filters.
    
 2. In the Edit Filters window, click Add to add a detail filter.
    
 3. In the Add an Event Detail Filter window, enter :X-Forwarded-For and then click OK. The Edit Filter window reappears, with the new event detail filter you added to the Column Filters pane.
    
 4. Select the newly created :X-Forwarded-For filter and enter the desired IP address or addresses. Click OK when finished.
    
    Notes:  * If there is more than one IP listed in the field for the event and you enter only one IP in your filter, it will not match. However, a filter like X.X.X.X* will match in that situation when X.X.X.X matches one IP in the event. 
     * Insert a space between multiple entries. 
     * Do not use the operator Not to exclude events.
    
    



Question: Can an XFF IP address be configured as the Intruder in the IPS event filter policy? 

Answer: You cannot match IPS Event Filters by using the content of the XFF header. The only matching done is at the Network Access Policy level. 


Question: Does reporting show the XFF IP address or the proxy IP address when alpsd.xff.proxy is enabled? 

Answer: Reporting content mirrors Analysis view content. As in the Analysis view, if the report type contains Event Detail data, it can contain the :X-Forwarded-For column data if you configure it to do so. You can also apply filtering to reporting results, much like you can in the Analysis view. 


Question: If alpsd.xff.proxy is enabled, will events still fire if the proxy IP is the victim or intruder? 

Answer: Yes, all events that trigger involving this proxy traffic have the proxy as either the Source or Destination of the event detection. We do not report the content of the XFF header as event Source or Destination. Also, the XFF content and rules that you create to match them would affect only traffic that actually has that content. Traffic to or from the proxy that triggers an event would still fire and any rules you created for the XFF content wouldn't match anyway. 


Question: Can the XFF IP address be used in the Inbound and Outbound SSL Inspection policy? 

Answer: No. The SSL policy determines what traffic you want to decrypt based on the available traffic tuple. Since the XFF header would be in the encrypted data, rules based on the content of the XFF header would not match. 


Question: Can you quarantine traffic based on XFF header content? 

Answer: No. Quarantines are applied in response to an event, which would be reporting the proxy address information. If you attempted to apply a quarantine response in this situation, the result would be that the proxy itself is quarantined. 




[/support/docview.wss?uid=swg21983893&aid=1] [https://ibm.biz/BdHdZx] [/support/docview.wss?uid=swg21983893&aid=2] [http://ibm.biz/InfraSecForumTechnote] [/support/docview.wss?uid=swg21983893&aid=3] [http://ibm.biz/SecSuptUTube] [/support/docview.wss?uid=swg21983893&aid=4] [http://ibm.biz/InfraSecFixes] [/support/docview.wss?uid=swg21983893&aid=5] [http://ibm.biz/FlexLicLogin] [/support/docview.wss?uid=swg21983893&aid=6] [http://ibm.biz/MyNotification] [/support/docview.wss?uid=swg21983893&aid=7] [http://ibm.biz/ContactSecSupport] 



Cross reference information Segment Product Component Platform Version Edition Security IBM Security Network Protection General Information Firmware 5.3.3