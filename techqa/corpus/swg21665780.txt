Title: IBM Error while applying patch to an OS agent installed by a non-root user. - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 An error is returned by the itmpatch command when an IFIX is applied to a UNIX OS agent by a user without root privileges. 

SYMPTOM
 

Different symptoms show up depending on the following scenarios:

Scenario A:
Agent installed by root user and started by non-root user.

Scenario B:
Agent installed and started by non-root user.

Then apply the IFIX using the itmpatch command by non-root user.



For scenario A the following error message is returned:

bash-3.2$ ./itmpatch -h /opt/IBM/ITM -i /tmp/6.2.3.2-TIV-ITM_UNIX-IF0004/kux_aix526_tema_if0004.tar

Unable to start agent for product Monitoring Agent for UNIX OS.
Command completed with errors. For more information, see the itmpatch.log file under:
/opt/IBM/ITM/patchlogs/

In this case, the IFIX is applied on the Unix OS agent, i.e. the agent version is getting updated, but there is a problem while restarting the agent.



For scenario B the first time you get an error message as follows:

bash-3.2$ ./itmpatch -h /opt/IBM/ITM -i /tmp/6.2.3.2-TIV-ITM_UNIX-IF0004/kux_aix526_tema_if0004.tar

Could not move file /opt/IBM/ITM/tmp/kux/updated_files/./aix526/ux/bin/kuxagent to /opt/IBM/ITM/./aix526/ux/bin/kuxagent. Either the product being updated is still running or the file permissions are restricting access to the file. Verify the product has been stopped and the file permissions are not restricting access and then re-apply the patch.
Command completed with errors. For more information, see the itmpatch.log file under:
/opt/IBM/ITM/patchlogs/

but second time the command completes successfully:

bash-3.2$ ./itmpatch -h /opt/IBM/ITM -i /tmp/6.2.3.2-TIV-ITM_UNIX-IF0004/kux_aix526_tema_if0004.tar

Command completed successfully.


CAUSE
When ./SetPerm is run after installation then kuxagent files in ux/bin will be owned by root and have the SUID bit set, so when patch is applied it fails for the first time.


DIAGNOSING THE PROBLEM
Verify the file permissions in ux/bin directory for the Unix OS agent.



RESOLVING THE PROBLEM
To resolve the problem you need to follow below steps: 


1. Install the OS agent under any of the above scenarios .
2. Before applying the patch run ./UnSetRoot command as follows with root user:
./UnSetRoot –h <Candlehome> <nonroot user>
3. Apply the patch on the agent. It will get applied successfully.
4. Then again run the command “./SetParm” with root user.