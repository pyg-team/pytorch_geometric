Title: IBM IT24135: File InputStream acquired by the MQ resource adapter is never closed - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  A number of Java InputStream objects for files are acquired by
   the MQ JCA resource adapter (MQ-RA) when it is first initialised
   that are not explicitly closed programmatically.  As a result,
   when the MQ-RA is running within GlassFish application server
   and the server is shutdown, the following warning message is
   logged:
   
   [WARNING]
   [javax.enterprise.resource.resourceadapter.com.sun.enterprise.co
   nnectors.service]
   [tld: _ThreadID21_ThreadName=RunLevelControllerThread-xxxx]
   
   Java call stack:
   -----------------
   java.lang.Throwable
   com.sun.enterprise.loader.ASURLClassLoader$sentinelInputStream.<
   init>
   com.sun.enterprise.loader.ASURLClassLoader$InternalJarUrlConnect
   ion.getInputStream
   java.net.URL.openStream
   com.ibm.msg.client.commonservices.componentmanager.ComponentMana
   ger.locateComponents
   .....
   com.ibm.mq.connector.ResourceAdapteronfiguration.<clinit>
   .....
   java.lang.Class.newInstance
   com.sun.enterprise.connectors.ActiveRAFactory.createActiveResour
   ceAdapter
   .....
   org.Jvnet.hk2.internal.ServiceHandleImpl.getService
   org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunne
   r.oneJob
   org.glassfish.hk2.runlevel.internal.CurrentTaskFuture$QueueRunne
   r.run
   ....
   java.util.concurrent.ThreadPoolExecutor$Worker.run
   java.lang.Thread.run
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects users of the:
   
     - MQ classes for JMS
     - MQ classes for Java
     - MQ JCA resource adapter
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   A component known as "CommonServices" is initialised when the MQ
   classes for JMS or classes for Java are first used by an
   application, or the MQ JCA resource adapter is initialised by an
   application server.  The CommonServices component attempts to
   discover all of the individual client components that are
   available within the environment.  For example, the classes for
   Java API, classes for JMS API and Java MQI are all components
   within the MQ Java client.
   
   In order to discover the components, one mechanism used by the
   CommonServices component is to search for files named
   "compinfo.properties" within the META-INF directory of the MQ
   Java client component jar files.
   
   The CommonServices component opened an InputStream to the found
   compinfo.properties files to read the data. The InputStream was
   not explicitly closed.  This resulted in a warning log message
   when the MQ resource adapter was running within a Glassfish
   application server environment and the server was shutdown.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The CommonServices component has been updated to explicitly call
   the close() method on InputStreams that are opened when reading
   compinfo.properties files included within the MQ Java client jar
   files.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v9.0 LTS   9.0.0.4
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT24135
   
   
 * REPORTED COMPONENT NAME
   IBM MQ BASE M/P
   
   
 * REPORTED COMPONENT ID
   5724H7261
   
   
 * REPORTED RELEASE
   900
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2018-02-20
   
   
 * CLOSED DATE
   2018-03-06
   
   
 * LAST MODIFIED DATE
   2018-03-06
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IBM MQ BASE M/P
   
   
 * FIXED COMPONENT ID
   5724H7261
   
   

APPLICABLE COMPONENT LEVELS