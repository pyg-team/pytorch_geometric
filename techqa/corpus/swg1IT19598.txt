Title: IBM IT19598: AMQ9510 reason code 2150 issued for SYSTEM.CLUSTER.COMMAND.QUEUE - United States

Text:
 SUBSCRIBE TO THIS APAR
By subscribing, you receive periodic emails alerting you to the status of the APAR, along with a link to the fix after it becomes available. You can track this item individually or track all items by product.

Notify me when this APAR changes.

Notify me when an APAR for this component changes.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  After altering the queue manager's CCSID, the following messages
   might be issued from the clustering component of the queue
   manager.  The queue manager will eventually terminate, unless it
   is ended manually.  However, restarting the queue manager
   resolves the issue permanently.
   
   The errors relate to character data within internal MQ command
   messages used by the clustering component of the queue manager.
   
   AMQ9510: Messages cannot be retrieved from a queue.
   EXPLANATION:
   The attempt to get messages from queue
   'SYSTEM.CLUSTER.COMMAND.QUEUE' on queue manager 'QMNAME' failed
   with reason code 2150.
   
   AMQ6174: The dynamically loadable shared library
   '/var/mqm/exits64/MQADMIN_r' was not found.
   
   AMQ9448: Repository manager failed.  Retry in 10 minutes, queue
   manager will terminate in 7050 minutes.
   
   After the fix for IT15735, the sequence of errors is different,
   and updates to local cluster cache state are dropped,
   incorrectly.  If the queue manager has a dead letter queue, one
   or more messages will be put there, but there is no action the
   user can then take to handle those messages.
   
   Additionally it is possible this problem will be seen for
   certain types of internal MQ cluster state data arriving from
   remote cluster queue managers to this one.
   
   
    
   
   

LOCAL FIX
 *  Correct the CCSID, if it was wrongly typed.
   Restart the queue manager so that the same CCSID is used
   throughout the queue manager, including the repository manager
   program.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   Users who alter their QMGR CCSID, or (they cannot control this)
   receive internal cluster state messages with unconvertible
   characters from remote systems.
   
   
   Platforms affected:
   MultiPlatform
   
   ****************************************************************
   PROBLEM DESCRIPTION:
   The errors relate to character data within internal MQ command
   messages used by the clustering component of the queue manager.
   
   The cluster repository manager program (amqrrmfa) gets these
   messages from the SYSTEM.CLUSTER.COMMAND.QUEUE using MQGET with
   MQGMO_CONVERT.
   
   Messages will be put containing character fields encoded with
   the new CCSID.
   
   However, by design amqrrmfa (as with all application programs
   that connected before the change in the CCSID) will have cached
   the previous value of the CCSID at the time it connected.
   Therefore MQGET tries to convert the messages.
   
   If there is a defined conversion from the new CCSID to the
   previous (cached) CCSID, this will be likely to succeed.  But
   even so, there are some byte sequences that will not convert
   successfully.
   
   If the user has used unconvertible byte sequences in fields such
   as queue or channel descriptions, then these will cause the
   conversion to fail with reason codes such as 2150
   MQRC_DBCS_ERROR.
   
   At this point the behaviour is different at different fix packs:
   At levels not including the fix for IT15735: message at the top
   of the queue became a poison message, and caused the queue
   manager to end after a prolonged period where it is retried
   without success.
   At levels including the fix for IT15735: the message at the top
   of the queue is moved to the DLQ, if one is defined.  The
   benefit is that the message is no longer a poison message.  But
   the downside is that that update was not made to the local
   cluster cache.  In the worst case this resulted in queues
   becoming expired and so invisible to applications.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The MQ queue manager code has been updated with additional logic
   to handle the situation at the point when 2150 MQRC_DBCS_ERROR
   is returned from MQGET.
   
   The field(s) which might contain unconvertible characters will
   be blanked out and the conversion will be retried.  If the
   conversion succeeds, the code can proceed to store that update
   with a blank description.  Error messages AMQ6174 and AMQ9880
   will be written, to inform the administrator.
   
   If the message is still unconvertible then it will be moved to
   the Dead Letter Queue and an error message will be written.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
   Version    Maintenance Level
   v7.5       7.5.0.9
   v8.0       8.0.0.8
   v9.0 CD    9.0.4
   v9.0 LTS   9.0.0.2
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IT19598
   
   
 * REPORTED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * REPORTED COMPONENT ID
   5724H7241
   
   
 * REPORTED RELEASE
   750
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2017-03-08
   
   
 * CLOSED DATE
   2017-08-02
   
   
 * LAST MODIFIED DATE
   2017-12-04
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    PI82623
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ BASE MULTIP
   
   
 * FIXED COMPONENT ID
   5724H7241
   
   

APPLICABLE COMPONENT LEVELS
 * R750 PSY
   UP