Title: IBM PI57910: SHUTDOWN OF ICON ASSOCIATED WITH ACTIVE MSC TCP/IP LINK LEAVES LINK HUNG ON REMOTE IMS WITH STATUS OF IDLE-C10 ACTV SEC. - United States

Text:
z/os  A FIX IS AVAILABLE
Obtain the fix for this APAR.


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  The normal shutdown (CLOSEHWS) and restart of an ICON associated
   with an active MSC TCP/IP link leaves the link hung on the
   remote IMS with a status of IDLE-C10 ACTV SEC. The link cannot
   be restarted until both sides of the link have a status of
   PSTOPPED IDLE. A /PSTOP LINK FORCE command must be used to reset
   the IDLE-C10 status before the /RST LINK command is issued.
   
   
    
   
   

LOCAL FIX
 *  Enter /PSTOP LINK FORCE to reset the IDLE-C10 status before
   trying to restart the link with the /RST LINK command.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED: IMS 12 users of MSC TCP/IP links.            *
   ****************************************************************
   * PROBLEM DESCRIPTION: After a shutdown of IMS Connect,        *
   *                      the MSC TCP/IP link on the remote       *
   *                      IMS is hung with a status of either:    *
   *                      - IDLE-C10 ACTV                         *
   *                      - PSTOPPED IDLE-C16 ACTV                *
   *                                                              *
   *                      This is a retro-fit of PI49368 [http://www-01.ibm.com/support/docview.wss?uid=isg1PI49368]          *
   *                      into IMS 12.                            *
   ****************************************************************
   * RECOMMENDATION: INSTALL CORRECTIVE SERVICE FOR APAR/PTF      *
   ****************************************************************
   An MSC TCP/IP link was active between two IMS systems:
   
   IMS1 <--> ICON1 <--> ICON2 <--> IMS2
   
   IMS1 is the local IMS.
   ICON1 is the local IMS Connect.
   ICON2 is the remote IMS Connect.
   IMS2 is the remote IMS.
   
   The local IMS Connect, ICON1, was shutdown normally using
   a CLOSEHWS command.
   
   The local IMS, IMS1, was notified that ICON1 shutdown.
   The MSC TCP/IP link on IMS1 was terminated correctly,
   resulting in a status of 'PSTOPPED IDLE ERE'
   
   The remote IMS Connect, ICON2, was notified that ICON1
   shutdown because ICON2's receive socket closed.
   ICON2 terminated its receive client.
   However, ICON2 did not clean up any of the associated MSC
   resources, including the link resource and the send-client
   resource, and did not notify the remote IMS, IMS2, that the
   receive client had terminated.
   
   The remote IMS, IMS2, was not notified of any error, and thus
   the link still appeared to be active in IMS2.
   
   The remote IMS, IMS2, then attempted to send another message
   across the link to IMS1.  The remote ICON, ICON2, sent the
   message to TCP/IP using its send-client.  Because ICON1
   terminated, the state of the send-socket is 'CLOSWT' which
   means that TCP/IP is waiting for a connection termination
   request from ICON2.  When ICON2 sent the message to TCP/IP,
   the send-request was posted successful by TCP/IP.  TCP/IP then
   closed the socket.  Because MSC messages are sent using
   send-only protocol, the send-client did not attempt to read
   anything on the socket (which would have failed because the
   socket was closed, and would have resulted in an error
   return code to IMS2).  Instead, the send-client returned to
   CONN state waiting for another message from IMS2.
   
   The result was that the link was hung waiting for a response
   to the message it sent to ICON2.
   
   The resulting hung-link condition depends on the message
   that IMS2 attempts to send across the link:
   
   If a normal transaction message is sent by IMS2 to ICON2,
   then the link is hung with status 'IDLE-C10 ACTV'.
   
   If the IMS2 operator attempts to terminate the link using a
   /PSTOP LINK or equivalent command, then the link is hung with
   status 'PSTOPPED IDLE-C16 ACTV'.
   
   Once the link is hung in IDLE-C10 or IDLE-C16 status,
   the operator is required to issue /PSTOP LINK FORCE to free
   the link so that it can be restarted.
   
   
   This error (hung link in the remote IMS) can also occur if:
   - The local IMS Connect is shutdown abnormally
   - The local IMS is shutdown abnormally
   
   
    
   
   

PROBLEM CONCLUSION
 *  GEN:
   KEYWORDS:
   
   *** END IMS KEYWORDS ***
   IMS Connect is enhanced as follows:
   
   When a receive client that is associated with an MSC TCP/IP link
   is terminated abnormally, IMS Connect will:
   - clean up the link and send-client resources in IMS Connect.
   - notify IMS with a new reason code x'00006418' that tells IMS
     that the MSC TCP/IP link has terminated in IMS Connect,
     so that IMS can terminate the link.
   
   In the error scenario, the status of the link in the remote IMS
   will be 'PSTOPPED IDLE ERE'.
   
   The /PSTOP LINK FORCE command is no longer necessary in order
   to free the link in IMS.
   
   Parts modified:
   
   HWSDSRC0
   When sending an internal STOPCLNT command to the receive
   client, set 'HWSDSRC0' as the origin.
   
   HWSDSTP0
   Queue the 'STOPCLNM' request from the receive client to the
   MSC datastore.
   
   HWSFTRC0
   Format the new HWSSCVC0 trace codes.
   
   HWSHRR
   Add reason code x'00006418' to indicate to IMS that IMS Connect
   is terminating an MSC TCP/IP link because of a 'STOPCLNT'
   process (receive socket termination).
   
   HWSHSVT
   Add SVT_F4_NONTFY to indicate that client termination
   should not notify the MSC datastore.
   
   HWSIREC0
   Detect a /PSTOP command in progress so that link termination
   does not mistakenly interpret a client termination as an error.
   Set the correct IMSid into the link block so that IMS abnormal
   terminations are processed correctly and the links and
   associated resources are cleaned up.
   
   HWSISCH0
   Process the 'STOPCLNM' request from the receive client.
   
   HWSISC20
   Process the 'STOPCLNM' request from the receive client.
   Issue existing message HWSF3310I, send a STOPSCLN request
   to clean up the send-client, and notify IMS with new
   reason code x'00006418' to indicate that IMS Connect
   is terminating an MSC TCP/IP link because of a 'STOPCLNT'
   process (receive socket termination).
   Ignore the request if the link is terminating normally (/PSTOP
   is in progress).
   
   HWSMLINK
   Add a flag to indicate that a /PSTOP is in progress for the
   link.
   
   HWSSCVC0
   For a client associated with an MSC link, send a 'STOPCLNM'
   (stop client for MSC) notification to the MSC datastore.
   
   HWSSSTP0
   If the STOPCLNT command is an internal command from HWSDSRC0,
   then set SVT_F4_NONTFY, which will tell receive client
   termination not to notify the MSC datastore.
   
   HWSTRCD
   Add trace codes for HWSSCVC0 failures related to MSC
   notification.
   
   NOTE:
   
   IMS apar PI57912 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI57912] addresses similar MSC TCP/IP hang conditions
   that are not related to IMS Connect shutdown scenarios.
   It is recommended that both apars (PI57910 and PI57912 [http://www-01.ibm.com/support/docview.wss?uid=swg1PI57912]) be
   applied to completely address the MSC TCP/IP hang conditions.
   However, the apars are independent.  The apars can be applied
   to IMS and IMS Connect independently - they do not need to be
   applied to both at the same time.
   
   
    
   
   

TEMPORARY FIX
 *  *********
   * HIPER *
   *********
   
   
    
   
   

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PI57910
   
   
 * REPORTED COMPONENT NAME
   IMS V12
   
   
 * REPORTED COMPONENT ID
   5635A0300
   
   
 * REPORTED RELEASE
   200
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   YesHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt / Xsystem
   
   
 * SUBMITTED DATE
   2016-02-23
   
   
 * CLOSED DATE
   2016-03-25
   
   
 * LAST MODIFIED DATE
   2016-05-04
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
    PI49368 [http://www-01.ibm.com/support/docview.wss?uid=isg1PI49368]
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
    UI36687
   
   

MODULES/MACROS
 *  HWSDSRC0 HWSDSTP0 HWSFTRC0 HWSHRR   HWSIREC0
   HWSISCH0 HWSISC20 HWSSCVC0 HWSSSTP0
   
   
    
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   IMS V12
   
   
 * FIXED COMPONENT ID
   5635A0300
   
   

APPLICABLE COMPONENT LEVELS
 * R200 PSY UI36687 [HTTPS://WWW14.SOFTWARE.IBM.COM/WEBAPP/SET2/ORDERMEDIA/SHOPCART?PTFS=UI36687]
   UP16/04/02 P F604 Å½
   
   

FIX IS AVAILABLE
 * SELECT THE PTF APPROPRIATE FOR YOUR COMPONENT LEVEL. YOU WILL BE REQUIRED TO SIGN IN. DISTRIBUTION ON PHYSICAL MEDIA IS NOT AVAILABLE IN ALL COUNTRIES.