Title: IBM PureData for Analytics: Steps to pro-actively monitor HA Cluster and DRBD health - United States

Text:
HA Cluster; DRBD; HA; cluster health monitoring; crm_mon TECHNOTE (FAQ)

QUESTION
 How do I pro-actively monitor the HA Cluster and DRBD health on PureData System for Analytics hosts? 

ANSWER
Pro-actively monitoring HA Cluster and DRBD health is key to ensure both the primary (HA1) and secondary (HA2) hosts are in sync throughout on PureData for Analytics Systems. 

The following are the commands that you can choose to run over cron (possibly once or twice a week) to monitor the health of the HA cluster.

1. Look for healthy cluster state by using the following command. Ensure that none of the resources are in 'Failed' state by using the crm_mon command:

[root@HA1 ~]# crm_mon -1

============
Last updated: Thu Apr 21 17:31:51 2016
Current DC: HA1 (37ee3497-d487-486c-96c7-ff041017d3dd)
2 Nodes configured.
3 Resources configured.
============

Node: HA2 (7533a437-ba92-4b88-9be2-33ca04659621): online
Node: HA1 (37ee3497-d487-486c-96c7-ff041017d3dd): online

Resource Group: nps
drbd_exphome_device (heartbeat:drbddisk): Started HA1
drbd_nz_device (heartbeat:drbddisk): Started HA1
exphome_filesystem (heartbeat::ocf:Filesystem): Started HA1
nz_filesystem (heartbeat::ocf:Filesystem): Started HA1
fabric_ip (heartbeat::ocf:IPaddr): Started HA1
wall_ip (heartbeat::ocf:IPaddr): Started HA1
nz_dnsmasq (lsb:nz_dnsmasq): Started HA1
nzinit (lsb:nzinit): Started HA1
fencing_route_to_ha1 (stonith:ibmpdusnmp): Started HA1
fencing_route_to_ha2 (stonith:ibmpdusnmp): Started HA2


2. Look for DRBD to be in sync between HA1 and HA2. The Out Of Sync (oos) attribute must always be zero ('0'). 

Run the following command on both HA1 and HA2

[root@HA1 ~]# cat /proc/drbd | grep -i oos
ns:202544 nr:0 dw:202568 dr:7317 al:65 bm:4 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0
ns:3910164 nr:0 dw:3964784 dr:10375717 al:712 bm:102 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0

[root@HA2 ~]# cat /proc/drbd | grep -i oos
ns:0 nr:177504 dw:177504 dr:0 al:0 bm:4 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0
ns:0 nr:343712 dw:343712 dr:0 al:0 bm:102 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:0

3. Check that both heartbeat and DRBD services are set to auto-restart on reboot on both HA1 and HA2

[root@HA1 ~]# chkconfig --list drbd;
drbd 0:off 1:off 2:on 3:on 4:on 5:on 6:off

[root@HA1 ~]# chkconfig --list heartbeat;
heartbeat 0:off 1:off 2:on 3:on 4:on 5:on 6:off

[root@HA2 ~]# chkconfig --list drbd; 
drbd 0:off 1:off 2:on 3:on 4:on 5:on 6:off

[root@HA2 ~]# chkconfig --list heartbeat;
heartbeat 0:off 1:off 2:on 3:on 4:on 5:on 6:off

 

PRODUCT ALIAS/SYNONYM
 Netezza
PureData for Analytics (a.k.a PDA)