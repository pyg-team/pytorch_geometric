Title: IBM Domino SMTP mail fails to send with a cipher not supported or with client certificates NOT supported by server signature algorithms - United States

Text:
"Domino SMTP"; "Cipher spec"; "not supported with TLS1.0"; "Sending an alert of 0x2F (illegal_parameter) level 0x2 (fatal)" TECHNOTE (TROUBLESHOOTING)

PROBLEM
This technote describes two issues which maybe seen when a Domino 9.0.1 FP5 sever acting as a SMTP client attempts to connect to a remote gateway 

SPR # KLYHA57S37 -- Outbound Session resumption can cause a handshake attempt to a remote server that only supports TLSv1.0 to fail due to the use of a TLSv1.2 cipher

SPR # MKENA4SQ7R -- Domino TLS 1.2 Client Hello does not offer a Signature Algorithm extension causing some handshakes to fail.
This has mainly been seen with Microsoft hosted environments such as Outlook.com, and is due to some environments more rigidly enacting the signature_algorithms outlined in the RFC


CAUSE
.



DIAGNOSING THE PROBLEM
In relation to SPR # KLYHA57S37 the following error will be seen in the server console with DEBUG_SSL_ALL=2 enabled 


SSLEncodeClientHello> We offered SSL/TLS version TLS1.0 (0x0301
........
SSLProcessServerHello> Server chose SSL/TLS version TLS1.0 (0x0301) 
SSLProcessServerHello> Server chose cipher spec DHE_RSA_WITH_AES_256_CBC_SHA256 (0x006B) 
FindCipherSpec> Cipher spec DHE_RSA_WITH_AES_256_CBC_SHA256 (107) is not supported with TLS1.0 
SSLSendAlert> Sending an alert of 0x2F (illegal_parameter) level 0x2 (fatal)

In relation to SPR # MKENA4SQ7R the following will be seen in the server console

TLS/SSL connection 192.176.145.81(60723) -> 213.199.154.87(25) failed with client certificates NOT supported by server signature algorithms
[0380:002F-0A38] SMTPClient: SSL handshake error: 1C7Ah


RESOLVING THE PROBLEM
Fixes for both SPRs are scheduled to be included in Domino 9.0.1 FP5 IF1 


In relation to SPR # KLYHA57S37 there are two work arounds if an upgrade cannot be performed
Disable SSL session resumption by setting SSL_RESUMABLE_SESSIONS=1 in the notes.ini of the server and executing a restart of Domino. 
It should be noted that setting this parameter can have some performance impact on HTTPS connections.

As suggested earlier prior to the discovery of the SPR, configure Domino to use a cipher suite that is supported by both TLSv1.2 and TLSv1.0; by using the SSLCipherSpec parameter in the server's notes.ini with the following values and then restarting Domino.
This should not be considered unless completely necessary as it limits the ciphers available for both inbound and outbound connections

SSLCipherSpec=3933352F0A