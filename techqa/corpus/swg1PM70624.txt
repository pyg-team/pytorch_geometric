Title: IBM PM70624: WEBSPHERE APPLICATION SERVER ACTING AS TRANSACTION MANAGER GETS RM_FAIL XA RETURN CODE (-4) FOR XA_PREPARE CALL. - United States

Text:
  FIXES ARE AVAILABLE
6.1.0.47: WebSphere Application Server V6.1 Fix Pack 47 [http://www-01.ibm.com/support/docview.wss?uid=swg24035508]
6.1.0.47: Java SDK 1.5 SR16 Cumulative Fix for WebSphere Application Server [http://www-01.ibm.com/support/docview.wss?uid=swg24035649]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  WebSphere MQ  (WMQ) V7 jms client receives return code 2009
   MQRC_CONNECTION_BROKEN causing the client connection and its
   MQSession to be closed.  At the time the MQSession was involved
   in an XA transaction so when the WebSphere Application Server
   (WAS) acting as Transaction Manager attempted to call XA prepare
   on the MQSession the RM_FAIL XA return code (-4) was returned to
   the Transaction Manager by the client because the connection was
   already closed.
   
   The transaction became stranded after the Transaction Manager to
   Resource Manager connectivity failure, and WMQ waits until a
   log-nearly-full condition before it attempts to roll the
   transaction back.
   The message received under the transaction is locked until that
   transaction rolls back. This may occur many hours later when the
   MQ transaction logs become full and it rolls back any incomplete
   transactions.
   
   SystemOut log may show
   javax.transaction.xa.XAException: The method 'xa_prepare' has
   failed with errorCode '-4'.
   
   Queue Manager logs may show AMQ7469:Transactions rolled back to
   release log space.
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  All users of IBM WebSphere Application      *
   *                  Server                                      *
   ****************************************************************
   * PROBLEM DESCRIPTION: After the transaction manager receives  *
   *                      an XAER_RMFAIL from a xa_prepare()      *
   *                      request to a resource, attempts to      *
   *                      rollback the resource subsequently      *
   *                      also fail.                              *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   When an XAER_RMFAIL is returned in response to a prepare
   request, the transaction manager will attempt to issue all
   subsequent xa operations on the same failed connection to the
   XA resource. The XA specification dictates that all XA
   operations subsequent to a XA_RMFAIL should only be made
   following a reconnection (issuing a xa_open operation) to the
   failed XA resource.  However, in this particular scenario, no
   attempt was made to reconnect to the failed resource.
   
   
    
   
   

PROBLEM CONCLUSION
 *  Ensure that following a XAER_RMFAIL in response to a
   xa_prepare request, a reconnection is made to the resource
   before issuing any subsequent XA requests.
   
   Please refer to the Recommended Updates page for delivery
   information:
   http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980 [http://www.ibm.com/support/docview.wss?rs=180&uid=swg27004980]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM70624
   
   
 * REPORTED COMPONENT NAME
   WEBS APP SERV N
   
   
 * REPORTED COMPONENT ID
   5724H8800
   
   
 * REPORTED RELEASE
   610
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2012-08-09
   
   
 * CLOSED DATE
   2012-09-27
   
   
 * LAST MODIFIED DATE
   2013-06-24
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBS APP SERV N
   
   
 * FIXED COMPONENT ID
   5724H8800
   
   

APPLICABLE COMPONENT LEVELS
 * R61A PSY
   UP
   
   
 * R61H PSY
   UP
   
   
 * R61I PSY
   UP
   
   
 * R61P PSY
   UP
   
   
 * R61S PSY
   UP
   
   
 * R61W PSY
   UP
   
   
 * R61Z PSY
   UP