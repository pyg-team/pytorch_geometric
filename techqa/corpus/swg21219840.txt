Title: IBM BIP6118E when IDOC is put on INPUT Queue - United States

Text:
MQIINFO MQSAPH MQHSAP BIP6118E SAP IDOC PARSER sap BIP6118E INPUT Queue TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 IBM Integration Bus (IIB) or WebSphere Message Broker (WMB) is giving the following IDOC Parser error when a SAP IDOC message is put to the input queue.

ParserException BIP6118E: The remaining bitstream is too small to contain the indicated structure. The bitstream, as presented to the 'IDOC' parser, is too small to contain the 'IDOC' structure. The length of this structure as given in the structure header is '1695'. The message appears to have been truncated. 

CAUSE
The input message was sent in with the MQMD.Format of MQSAPH, which is not correct. The correct format name for a MQSAPH header is actually MQHSAP (MQFMT_SAP). 

RESOLVING THE PROBLEM
Specify the correct MQMD.Format of MQHSAP (MQFMT_SAP). 

Additional information
There is only one place in the code where the IDOC parser throws a BIP6118E. There is a calculation that works out how many EDI_DD structures there are. Then it takes the size of EDI_DC and the Count *EDI_DD buffers and sees if this exceeds the size of the buffer we have been passed. If it does, then that means there are not enough bytes in the buffer. At that point we throw a BIP6118E at the start of parsing if we can see that there is no way the buffer contains enough bytes. This means that this not a defect, but is a problem with how the messageset is defined. The bitstream has to match the IDOC sections and the MRM_CWF definitions that have been defined.

An IDOC DC structure is 524 bytes and an IDOC DD structure is 63 bytes. The IDOC segment, as defined here in the MRM messageSet, is 1000 bytes. Therefore one of the IDOC messages with one segment expects a total of 1587 bytes. For this problem, the input message is 1695 bytes ... but this contains an MQSAPH header. This header is 108 bytes. Therefore 1587 bytes is attempted to be parsed against an expected 1587 bytes. This means that the input message is the correct length.

In this case the BIP6118E exception is reporting that the IDOC buffer is 1695 bytes. This means that the whole of the WMQ input message bitstream has been passed to the IDOC parser. This should not have occurred because 108 bytes of this buffer is the MQSAPH header and this should have been passed to the MQSAPH parser. 

This is further confirmed by the fact that there is no BIP6061I message report in the trace, which reports that an MQSAPH parser has been created to handle 108 bytes of the incoming message.

Further examination of the trace shows that a format name of MQSAPH was extracted from the WMQ input message. This would suggest that the input message was sent in with the MQMD.Format of MQSAPH, which is not correct. The correct format name for a MQSAPH header is actually MQHSAP (MQFMT_SAP). If an input message is incorrectly sent into a flow with MQSAPH as the header name, then this means that the MQSAPH parser will not be invoked. This means 108 bytes of the bitstream will not be allocated to this parser, and this will be allocated to the IDOC parser. This will cause the BIP6118E error message.

RELATED INFORMATION
 MQSAPH parser [http://www.ibm.com/support/knowledgecenter/SSKM8N_8.0.0/com.ibm.etools.mft.doc/ad09750_.htm?lang=en]
IDoc parser [http://www.ibm.com/support/knowledgecenter/SSKM8N_8.0.0/com.ibm.etools.mft.doc/ad09750_.htm?lang=en]





Cross reference information Segment Product Component Platform Version Edition Business Integration IBM Integration Bus AIX, HP-UX, Linux, Solaris, Windows 10.0, 9.0 All Editions 
PRODUCT ALIAS/SYNONYM
 MQSI WMQI WBIMB