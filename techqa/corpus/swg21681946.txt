Title: IBM Upgrade of server fails to create instance - United States

Text:
upgrade db2 fail failure instance missing TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Upgrade of the Tivoli Storage Manager server does not create the instance and the DB2 sqllib directory is missing. 

SYMPTOM
The db2_install.log has the following warning message: 

 * 
 * DBI1004W /usr/lib/libdb2.a detected. This DB2 copy may encounter problems loading its libraries.


CAUSE
Another version of DB2 is installed on the system or a previous installation of DB2 was not cleaned up during uninstall. When installing Tivoli Storage Manager there cannot be a stand alone version of DB2 on the same system as the Tivoli Storage Manager server.

DIAGNOSING THE PROBLEM
When logged in as the Tivoli Storage Manage instance user (ie tsminst1) and trying to execute any db2 command, the command fails stating db2 cannot be found. If the sqllib/ directory is missing from the instance directory, the following indicators can also be used to diagnose that this issue is being encountered. 


Review the db2_install.log file, is the following message found in the log? 

 * 
 * DB2 Setup log file started at: Tue Aug 5 11:59:51 2014 EDT
   ============================================================
   
   Operating system information: AIX 7.1 
   WARNING: DBI1004W /usr/lib/libdb2.a detected. This DB2 copy may encounter problems
   loading its libraries.
   
   Explanation: 
   
   The db2ln command was run from another DB2 copy which creates symlinks
   in /usr/lib. These symlinks interfere with multiple DB2 copies running
   on the same system, whether those copies are the same version at
   different fixpacks, or different versions.
   
   User response: 
   
   From the installation path where the db2ln command was run, run the
   db2rmln command to remove these links.
 * 

Following the documented steps for a manual upgrade (link below) in the Tivoli Storage Manager publications states to run db2icrt. The results of db2icrt would suggest the command completed successfully:  * 
 * ->./db2icrt -u tsminst1 tsminst1
 * 
 * DBI1446I The db2icrt command is running.
 * 
 * DB2 installation is being initialized.
 * 
 * 
 * Total number of tasks to be performed: 3
 * 
 * Total estimated time for all tasks to be performed: 9 second(s)
 * 
 * 
 * Task #1 start
 * 
 * Description: Setting default global profile registry variables
 * 
 * Estimated time 1 second(s)
 * 
 * Task #1 end
 * 
 * 
 * Task #2 start
 * 
 * Description: Initializing instance list
 * 
 * Estimated time 5 second(s)
 * 
 * Task #2 end
 * 
 * 
 * Task #3 start
 * 
 * Description: Updating global profile registry
 * 
 * Estimated time 3 second(s)
 * 
 * Task #3 end
 * 
 * 
 * The execution completed successfully.
 * 
 * 
 * For more information see the DB2 installation log at "/tmp/db2icrt.log.5701976".
 * 
 * 
 * DBI1070I Program db2icrt completed successfully.


The above output is actually incorrect since there are four tasks that need to be completed, the missing task is Configuring DB2 Instances. 

If all the above exist in your environment, the last check is to run the following command and review the output:  * 
 * find /usr/lib -type l -ls |grep "db2"


RESOLVING THE PROBLEM
Reviewing the results from the find command in the previous section, you should see results similar to the following: 

 

 * ->find /usr/lib -type l -ls |grep "db2"
 * 
 * 802841 1 lrwxrwxrwx 1 root system 28 Apr 5 15:50 /usr/lib/db2.o -> /usr/opt/db2_08_01/lib/db2.o
 * 
 * 803044 1 lrwxrwxrwx 1 root system 33 Apr 5 15:50 /usr/lib/libdb2.a -> /usr/opt/db2_08_01/lib64/libdb2.a


What needs to be done is the symbolic links need to be removed. To do this, execute the command db2rmln to remove the links. Search your system for the command. If there is a db2rmln found in the symbolic link location use that particular version, otherwise, run the binary that is found. 

After the symbolic links are removed run your db2icrt command again. RELATED INFORMATION
 Server instances are not created during an upgrade [http://pic.dhe.ibm.com/infocenter/tsminfo/v7r1/index.jsp?topic=%2Fcom.ibm.itsm.tshoot.doc%2Ft_pdg_manupgrade.html]


 

PRODUCT ALIAS/SYNONYM
 TSM ADSM