Title: IBM SSL enabled ldap client stops functioning after AIX OS upgrade - United States

Text:
AIX; idsldap; ldap; gskit; gsksa; gskta; SSL initialization failed; Could not start the server; HPDCO0182E; HPDMG0164E; 0x76; ldap_ssl_client_init failed; failureReasonCode; 1600547192; Unknown SSL error TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 SSL enabed ldap client may stop functioning after the AIX OS upgrade 

SYMPTOM
1. AIX secldapclntd startup: 

Fails with "SSL initialization failed" error. 

2. Tivoli Access manager:
# /usr/bin/pd_start restart
Starting the: Access Manager policy server.
Could not start the server.

msg__pdmgrd_utf8.log log file shows:
2010-12-07-15:21:37.179+00:00I----- 0x14C521D3 pdmgrd NOTICE mis ivcore cfgmgr.cpp 217 0x00000001 HPDMS0467I Server startup
2010-12-07-15:21:37.180+00:00I----- 0x14C526F2 pdmgrd NOTICE mis ivmgrd cfgmgr.cpp 222 0x00000001 HPDMS1778I Loading configuration
2010-12-07-15:21:37.210+00:00I----- 0x16B480C9 pdmgrd ERROR rgy ira ira_handle.c 443 0x00000001 HPDRG0201E Error code 0xffffffff was received from the LDAP server. Error text: "Unknown error". 
2010-12-07-15:21:37.211+00:00I----- 0x1354A0B6 pdmgrd ERROR ivc general LDAPClient.cpp 254 0x00000001 HPDCO0182E LDAP initialization failed: ira_rgy_init("ldaphost", 636, "cn=ivmgrd/master,cn=SecurityDaemons,secAuthority=Default", ***)= -1, 0.
2010-12-07-15:21:37.211+00:00I----- 0x14C010A4 pdmgrd FATAL mgr general ivmgrd.cpp 256 0x00000001 HPDMG0164E The Policy Server could not be started (0x1354a0ba).
2010-12-07-15:21:37.218+00:00I----- 0x1354A0A4 pdmgrd WARNING ivc general IVServer.cpp 863 0x00000001 HPDCO0164W Could not start background process

After enabling the trace on pdmgrd, trace__pdmgrd_utf8.log file showed the following:
2010-12-10-15:03:29.635+00:00I----- pdmgrd DEBUG7 ivc ira /project/am610/build/am610/src/ivrgy/ira_handle.c 406 0x00000001

ldap_ssl_set_fips_mode_np() setting: 0

2010-12-10-15:03:29.636+00:00I----- pdmgrd DEBUG7 ivc ira /project/am610/build/am610/src/ivrgy/ira_handle.c 413 0x00000001

LDAP rc: x76

2010-12-10-15:03:29.637+00:00I----- pdmgrd DEBUG7 ivc ira /project/am610/build/am610/src/ivrgy/ira_handle.c 421 0x00000001

ldap_ssl_client_init() keyfile: /itim/TDI/V6.1.1/timsol/etc/tdikeys.kdb

2010-12-10-15:03:29.639+00:00I----- pdmgrd DEBUG7 ivc ira /project/am610/build/am610/src/ivrgy/ira_handle.c 428 0x00000001

LDAP rc: xffffffff

From above 0x76 means:
LDAP_SSL_NOT_AVAILABLE 0x76 - The SSL library cannot be loaded.

3. ldapsearch client:
# ldapsearch -h ldaphost -Z -K /usr/ldap/clientkey.kdb -P kdb_pw -D "cn=root" -w admin_pw -b " " -s base objectclass=*
ldap_ssl_client_init failed! rc == -1, failureReasonCode == 1600547192
Unknown SSL error


CAUSE
Changes to ssl libraries of GSKit and/or idsldap max_crypto* packages when the server / client applications are already running. Changes may include, OS or products installation / updates, change of permissions and change of ownership, which are typically outside the products normal usage.



ENVIRONMENT
AIX 7.2, 7.1 6.1 or 5.3



DIAGNOSING THE PROBLEM
Make sure the required filesets of idsldap clients and gsksa and gskta are available on the system: 

Required filesets of idsldap at V6.r.0.n level:
idsldap.cltbase6r
idsldap.clt32bit6r
idsldap.clt64bit6r
idsldap.clt_max_crypto32bit6r
idsldap.clt_max_crypto64bit6r

Note: r is the Release level of SDS or TDS provided idsldap filesets. 

Required GSKit v7 filesets for TDS 6.2 or 6.1
gskta
gsksa

Required GSKit v8 filesets for TDS 6.3, SDS 6.3.1 or 6.4 are:
GSKit8.gskcrypt32
GSKit8.gskcrypt64
GSKit8.gskssl32
GSKit8.gskssl64

If any of the above mentioned filesets are missing, please install the same using the procedure given below.


RESOLVING THE PROBLEM
This problem with failure to load the ssl enabled ldap client, is seen after the operating system upgrade of either OS (from one level of AIX such as 5.3 or 6.1 to AIX 6.1, 7.1 or 7.2 ) or with TL (from AIX 6.1 TL 01 to AIX 6.1 TL 06). 

Make sure to stop the ssl enabled ldap client applications such secldapclntd or TAM before performing AIX upgrade. 

Once the problem symptoms as described above are observed use the following method to reinstall the idsldap and gskit filesets at latest levels:

1. Download latest recommended fix level of Directory Server V6.r (Provides latest idsldap client filesets) - where r is the required and supported level of idsldap client filesets as per AIX os level, to know the exact level of idsldap provided by a specific AIX OS level, you must look into the AIX media (CDs / DVDs).

Goto: Directory Server Recommended Fixes [http://www.ibm.com/support/docview.wss?uid=swg27009778]
Scroll down to Version 6.r section and click on the latest Fix link provided in the table for 6.r .0.n

For example: It will take to the web page of 6.1.0-TIV-ITDS-FP0005 (6.1.0.37 level)
Scroll down to the bottom part of the page and download: 6.1.0-TIV-ITDS-AIX-FP0005.tar
Transfer the fix tar file (ftp/scp) to aix system in binary mode.
Untar into a folder with enough space.

2. Download latest GSKit files from [http://www-933.ibm.com/support/fixcentral/swg/selectFixes?product=ibm/Tivoli/IBM+Global+Security+Kit&release=All&platform=All&function=fixId&fixids=7.0.5.*] the same recommended fixes tables of SDS/TDS and install using respective instructions provided in the same row.

3. Install idsldap client filesets as root user:
<path> is where the 6.1.0-TIV-ITDS-AIX-FP0005.tar file is extracted using 
"tar xvf 6.1.0-TIV-ITDS-AIX-FP0005.tar" command.

# cd <path>/6.1.0-TIV-ITDS-AIX-FP0005/images/
# installp -acXgYd . idsldap.cltbase61 idsldap.clt32bit61 idsldap.clt64bit61 idsldap.clt_max_crypto32bit61 idsldap.clt_max_crypto64bit61

This step must result in a successful installation.
Verify for successful idsldap client filesets at 6.1.0.37 level.

4. Now try failing ldapsearch command again.

5. Start secldapclntd or TAM processes.

RELATED INFORMATION
 GSKit Upgrade instructions [http://www.ibm.com/support/docview.wss?uid=swg21443436]




PRODUCT ALIAS/SYNONYM
 ldap
idsldap
tds