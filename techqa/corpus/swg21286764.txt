Title: IBM How to configure redirects with DataPower for a simple XML Firewall (not a Web Application Firewall) - United States

Text:
datapower; xml firewall; firewall; redirect; web application firewall; web application; mpg; multi-protocol; web service proxy; wsp; ws-proxy; 7993; 7993; 7993; machine type 7993; 9003; 9004; 9235 TECHNOTE (FAQ)

QUESTION
 How can an XML Firewall be configured to respond to errors with a redirect (HTTP 302 or 307 response code)? 

CAUSE
HTTP redirect response from backend or remote server. A message similar to the following may be found in the system logs:
HTTP Redirect from 'http://remote_ip:port/uri' failed due to non idempotent request method - RFC 2616 sec 10.3. 


ANSWER
Within a Web Application Firewall, a special option is available to send redirects to a client. An XML Firewall service does not have this option available by default. Therefore, to have a service send redirects to a client, you can configure your WebSphere DataPower SOA Appliance as described below: 

 

 1.  Create an XML Firewall. 
 2.  Create a policy and configure your request rule. 
 3.  Create a new rule which is an error rule. 
 4.  This rule contains a match, a transformation, and a result action. 
     It should look like this: 
     [/support/docview.wss?uid=swg21286764&aid=1] [/support/docview.wss?uid=swg21286764&aid=1]
     
 5.   
 6.  The XSL transform is where you set the HTTP response code to 302 or 307 and the "Location" to where you want to redirect the request. 
 7.  The XSL file should look like this. Modify the Location, http://myDomain.de/test, if you want to use this example. 
     
     <?xml version="1.0" encoding="UTF-8"?>
     <xsl:stylesheet version="1.0" 
     xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:dp="http://www.datapower.com/extensions" 
     xmlns:dpconfig="http://www.datapower.com/param/config" 
     extension-element-prefixes="dp" 
     exclude-result-prefixes="dp dpconfig">
     <xsl:output method="xml" indent="yes"/>
     <xsl:param name="dpconfig:redirectBadInput" select="'http://myDomain.de/test'"/>
     <xsl:template match="/">
     <xsl:message>
     <xsl:text>*** Redirect to custom error page: </xsl:text>
     <xsl:value-of select="$dpconfig:redirectBadInput"/>
     <xsl:text>*** Done </xsl:text>
     </xsl:message>
     <dp:set-http-response-header name="'x-dp-response-code'" value="'302 redirected'"/> 
     <dp:set-http-response-header name="'Location'" value="$dpconfig:redirectBadInput"/>
     </xsl:template>
     </xsl:stylesheet></code>]
     
     
 8.  Save this rule and configuration. 
 9.  Now go back to the request rule configured in step 2. 
 10. In front of an action which may cause an error to occur, in this case a transformation, place an advanced action. 
 11. Configure this advanced action to be an on-error action and press Next.
     
     [/support/docview.wss?uid=swg21286764&aid=2] [/support/docview.wss?uid=swg21286764&aid=2]
     
 12. Define the Error Mode to be "continue" and select the created error rule as Processing Rule (in this case FW_rule_1). 
     
     
     [/support/docview.wss?uid=swg21286764&amp;aid=3] 
 13. Press Done and Apply and Save changes.