Title: IBM Scrubber failing after upgrade to ClearCase 7.x - United States

Text:
PK56187; RATLC01041716; ClearCase; Clearmake - Clearaudit - Omake; 1292983 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 This technote identifies an IBM Rational ClearCase defect relating to the scrubber which can cause the db_server process to fail after finding config records with negative reference counts and provides you with information on how to workaround the issue. 

SYMPTOM
 

After upgrading your VOB server from previous ClearCase releases to version 7.x (new installations are unaffected), where clearmake is used to create derived objects, the scrubber [http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m1/topic/com.ibm.rational.clearcase.cc_ref.doc/topics/scrubber.htm]may fail with the following error:

db_cr_delete_strands_V3: RPC: Unable to receive; errno = Connection reset by peer
db_abort_trans_V3: RPC: Unable to receive; errno = Connection reset by peer
scrubber: Error: Trouble communicating with VOB database: "/vobs/test".
Check database log on VOB host "host1".
scrubber: Error: Unable to delete stranded CRs: error detected by ClearCase subsystem



CAUSE
 

Defect APAR PK56187 has been opened to investigate this issue.


DIAGNOSING THE PROBLEM
 

The scrubber may report the following errors in db_server_log:

db_server(14658): Error: Internal error in "../db__cr.c" line 197
db_server(14658): Error: INTERNAL ERROR detected and logged in "/var/adm/rational/clearcase/log/error_log".
db_server(14658): Error: ***ABORT*** '../db__err.c':354


RESOLVING THE PROBLEM
 

 

The defect has been resolved in the following updates: 


2003.06.00 

ClearCase & MultiSite Windows clearcase_p2003.06.16.NT-2008B [http://ibm.com/support/docview.wss?rs=984&uid=swg24014392] ClearCase UNIX (User Space) clearcase_p2003.06.00-55 [http://ibm.com/support/docview.wss?rs=984&uid=swg24009635] 





WORKAROUNDS:  

Advisory: 

 * If you are running clearmake in your build environment and you have not yet upgraded to version 7.x, use any of the 3 options posted below.
   
   
 * If you are running clearmake in your build environment and you have already upgraded to version 7.x, stop running the scrubber until you can implement the steps in either option 2 or option 3.
   


Note: Any clients which perform the commands known to cause the problem (rmview, rmdo, clearmake) which are not also patched to 7.x can cause the problem to reappear. 




OPTION #1 

Run the scrubber on the VOB server immediately prior to the upgrade. This will remove the database entries for all the derived objects with a reference count of zero. 


Review the ClearCase Command Reference Guide on the topic of scrubber (cleartool man scrubber) for more information. 


IMPORTANT: Do not run the following commands until after the upgrade as this will trigger the defect after the upgrade when the scrubber is run. 

 * rmview 
 * rmdo 
 * clearmake
   


Note: As mentioned above, unpatched clients running these commands can still trigger the problem even if the VOB server has been patched. 




OPTION #2 

Run the reformatvob command on ALL VOBs that are used to store clearmake DOs (derived objects) either before the upgrade or immediately after the upgrade. This will remove the database entries for all the derived objects with a reference count of zero. 

Note: You can disregard any VOB that does not store derived objects as these VOBs will not trigger the defect. 

Review the ClearCase Command Reference Guide on the topic of reformatvob (cleartool man reformatvob) for more information.








OPTION #3 Contact Rational Client Support to request a utility to scan the VOBs and cleanup the 0 reference count configuration records either before the upgrade or immediately after the upgrade. 

Note: This utility is only available by contacting support. Have the following information ready to facilitate an efficient turn around: 

 * Operating System Version (uname -a for UNIX速 or Linux速 & winver for Microsoft速 Windows速) 
 * ClearCase and Database Schema Version (cleartool -ver)