Title: IBM CritRsrcProtMethod and Tivoli System Automation for Multiplatforms - United States

Text:
TSA; TSAMP; CritRsrcProtMethod; ProtectionMode; Manual Mode; RSCT TECHNOTE (FAQ)

QUESTION
 What role does CritRsrcProtMethod play within a TSAMP environment ? 

ANSWER
There are a lot of very specific issues with these settings and the purpose of this document is not to cover all of them, but instead to introduce the reader to the principles of this capability . 

CritRsrcProtMethod: 

CritRsrcProtMethod is a RSCT (Reliable, Scalable Cluster Technology) variable that is used to determine how RSCT will protect critical resources with changes in quorum . 

 

Critical Resources: 

Critical Resources are defined by the "ProtectionMode" attribute for a resource, to determine if a resource is listed as critical, list the persistent and dynamic attributes of a resource, example below:
# lsrsrc -s 'Name == "samadapter"' IBM.Application Name ProtectionMode
Resource Persistent and Dynamic Attributes for IBM.Application
resource 1:
Name = "samadapter"
ProtectionMode = 1


Valid values for ProtectionMode are as follows:
ProtectionMode=1 means that it is defined as a critical resource.
ProtectionMode=0 means that it is not defined as a critical resource.

To list all resources defined in your cluster in an effort to find out which ones are defined to be critical ::
# lsrsrc -s "ResourceType=1" IBM.Application Name ProtectionMode
Resource Persistent Attributes for IBM.Application
resource 1:
Name = "samadapter"
ProtectionMode = 1
resource 2:
Name = "db2hadr_event-rs"
ProtectionMode = 1
resource 3:
Name = "db2_db2insts_salx2_0-rs"
ProtectionMode = 1
resource 4:
Name = "db2_db2instp_salx1_0-rs"
ProtectionMode = 1

As you can see in the above example all the IBM.Application resources are listed as critical resources.

What RSCT does to protect critical resources:
The default action of the CritRsrcProtMethod is to reboot your node to ensure that any critical resources that are online on that node are taken down as quickly as possible and made available to another node to bring up without possible data corruption.
For example we have a 3 node cluster with Node1 having critical resources running on it while the other two do not have any. Node1 loses connectivity to the other two nodes. In this instance RSCT would invoke the CritRsrcProtMethod and reboot the node to ensure that those critical resources can be brought up on the other two nodes that are still online in the cluster. For more information on "Protecting your resources - quorum support" please read the "Administrators and Users Guide" which can be found at: http://pic.dhe.ibm.com/infocenter/tivihelp/v3r1/topic/com.ibm.samp.doc_3.2.2/HALBAU23.pdf [http://pic.dhe.ibm.com/infocenter/tivihelp/v3r1/topic/com.ibm.samp.doc_3.2.2/HALBAU23.pdf] starting on page 225 (chapter 11).

RSCT and TSAMP in Manual Mode:
While TSAMP will not issue a start or stop order against a resource while TSAMP is in manual mode RSCT will still invoke the CritRsrcProtMethod to protect resources if its conditions are met.
For example, in our 3 node cluster you decide to take two nodes down for maintenance leaving just one node online, you put TSAMP in manual mode so it will take no action. As soon as the two nodes go down for maintenance then the node that is left will be rebooted. The reason for this is that with a 3 node cluster and only one node remaining RSCT and TSAMP will lose quorum due to having fewer then half the nodes online required to establish quorum. Since there are three nodes there is no reason to have a tiebreaker and even if you did in this case the tiebreaker would not be invoked because there are an odd number of nodes in the cluster. In this situation you can configure the CritRsrcProtMethod to do nothing so that while the maintenance is being performed the CritRsrcProtMethod will be invoked but will be configured to take no action. For more information on configuring the CritRsrcProtMethod attribute please search on "How to stop RSCT & TSAMP from rebooting a node".