Title: IBM SSL communication between Datapower and MQ Queue Manager requires same exact cipher - United States

Text:
mq ssl mq-qm handshake failure cipher suite TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 SSL connections between Datapower and MQ Queue Manager may fail if the cipher on the MQ Queue Manager channel does not match with the cipher of the DataPower mq-qm object. As a result, the Datapower mq-qm object will have 'down' status and the Queue Manager 
may log error "AMQ9631: The CipherSpec negotiated during the SSL handshake does not match the required CipherSpec for channel 'xyz.xyz'.




CAUSE
It is required for the cipher defined in the MQ channel to explicitly match with the cipher used by the Datapower mq-qm object. 

RESOLVING THE PROBLEM
Datapower SSL communication with a MQ Queue Manager can be configured in one of three ways: 

 * SSL Client Profile 
 * SSL Proxy Profile (deprecated) 
 * SSL Key Repository 


*The SSL Client Profile (or SSL Proxy Profile) takes precedence, if the SSL Key Repository is also configured. When using either of the options above, you must explicitly configure the matching cipher used by the MQ channel. 

Note, when using the SSL Proxy Profile, the default cipher string (HIGH:MEDIUM:!aNULL:!eNULL:@STRENGTH) of the Crypto Profile must be removed and replaced with the specific SSL cipher used by the MQ channel.


Table 1.1 gives examples of mapping MQ SSL cipher when using Datapower SSL Proxy Profile / Crypto Profile (deprecated)

Table 1.1



MQ SSL Cipher Datapower Crypto Profile Cipher Datapower Protocol Versions AES_SHA_US AES128-SHA Disable-SSLv2+Disable-SSLv3+Disable-TLSv1d1+Disable-TLSv1d2 TLS_RSA_WITH_AES_128_CBC_SHA AES128-SHA Disable-SSLv2+Disable-SSLv3+Disable-TLSv1d1+Disable-TLSv1d2 TLS_RSA_WITH_AES_256_CBC_SHA AES256-SHA Disable-SSLv2+Disable-SSLv3+Disable-TLSv1d1+Disable-TLSv1d2 TLS_RSA_WITH_AES_128_CBC_SHA256 AES128-SHA256 Disable-SSLv2+Disable-SSLv3+Disable-TLSv1+Disable-TLSv1d1 TLS_RSA_WITH_AES_256_CBC_SHA256 AES256-SHA256 Disable-SSLv2+Disable-SSLv3+Disable-TLSv1+Disable-TLSv1d1 


Table 2.2 gives examples of mapping MQ SSL cipher when using Datapower SSL Client Profile

Table 2.2 

MQ SSL Cipher Datapower SSL Client Cipher Datapower SSL Client Protocol Versions AES_SHA_US RSA_WITH_AES_128_CBC_SHA Disable-SSLv3+Disable-TLSv1d1+Disable-TLSv1d2 TLS_RSA_WITH_AES_128_CBC_SHA RSA_WITH_AES_128_CBC_SHA Disable-SSLv3+Disable-TLSv1d1+Disable-TLSv1d2 TLS_RSA_WITH_AES_256_CBC_SHA RSA_WITH_AES_256_CBC_SHA Disable-SSLv3+Disable-TLSv1d1+Disable-TLSv1d2 TLS_RSA_WITH_AES_128_CBC_SHA256 RSA_WITH_AES_128_CBC_SHA256 Disable-SSLv3+Disable-TLSv1+Disable-TLSv1d1 TLS_RSA_WITH_AES_256_CBC_SHA256 RSA_WITH_AES_256_CBC_SHA256 Disable-SSLv3+Disable-TLSv1+Disable-TLSv1d1 TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 DHE_RSA_WITH_AES_128_CBC_SHA256 Disable-SSLv3+Disable-TLSv1+Disable-TLSv1d1