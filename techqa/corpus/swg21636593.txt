Title: IBM ORA-00933: SQL command not properly ended - United States

Text:
TPAEUPGRADE; java.sql.SQLException; ORA-00933; SQL command not properly ended TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Error upgrading 6.2.x database to 7.1 java.sql.SQLException: ORA-00933 

SYMPTOM
Error in updatedb.log as below

java.sql.SQLException: ORA-00933: SQL command not properly ended 

at oracle.jdbc.driver.SQLStateMapping.newSQLException(SQLStateMapping. 
java:74) 
at oracle.jdbc.driver.DatabaseError.newSQLException(DatabaseError.java: 
131) 
at oracle.jdbc.driver.DatabaseError.throwSqlException(DatabaseError. 
java:204) 
at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:455) 
at oracle.jdbc.driver.T4CTTIoer.processError(T4CTTIoer.java:413) 
at oracle.jdbc.driver.T4C8Oall.receive(T4C8Oall.java:1034) 
at oracle.jdbc.driver.T4CStatement.doOall8(T4CStatement.java:183) 
at oracle.jdbc.driver.T4CStatement.executeForDescribe(T4CStatement. 
java:780) 
at oracle.jdbc.driver.T4CStatement.executeMaybeDescribe(T4CStatement. 
java:855) 
at oracle.jdbc.driver.OracleStatement.doExecuteWithTimeout 
(OracleStatement.java:1186) 
at oracle.jdbc.driver.OracleStatement.executeQuery(OracleStatement. 
java:1377) 
at oracle.jdbc.driver.OracleStatementWrapper.executeQuery 
(OracleStatementWrapper.java:387) 
at psdi.configure.Util.selectString(Util.java:13911) 
at psdi.upgrade.V600.UpgradeItemOrgInfo.getGLAccount(Unknown Source) 
at psdi.upgrade.V600.UpgradeItemOrgInfo.insertItemOrgInfo(Unknown 
Source) 
at psdi.upgrade.V600.UpgradeItemOrgInfo.process(Unknown Source) 
at psdi.upgrade.Upgrade.upgradeCallout(Unknown Source) 
at psdi.upgrade.Upgrade.runAppCallOuts(Unknown Source) 
at psdi.upgrade.Upgrade.loadMetaData(Unknown Source) 
at psdi.upgrade.Upgrade.process(Unknown Source) 
at psdi.configure.UpgradeUI.runUpgrade(UpgradeUI.java:631) 
at psdi.configure.UpgradeUI.actionPerformed(UpgradeUI.java:344) 
at javax.swing.AbstractButton.fireActionPerformed(AbstractButton.java: 
1879) 
at javax.swing.AbstractButton$Handler.actionPerformed(AbstractButton. 
java:2199) 
at javax.swing.DefaultButtonModel.fireActionPerformed 
(DefaultButtonModel.java:450) 
at javax.swing.DefaultButtonModel.setPressed(DefaultButtonModel.java: 
288) 
at javax.swing.plaf.basic.BasicButtonListener.mouseReleased 
(BasicButtonListener.java:264) 
at java.awt.Component.processMouseEvent(Component.java:5571) 
at javax.swing.JComponent.processMouseEvent(JComponent.java:3143) 
at java.awt.Component.processEvent(Component.java:5336) 
at java.awt.Container.processEvent(Container.java:2001) 
at java.awt.Component.dispatchEventImpl(Component.java:4038) 
at java.awt.Container.dispatchEventImpl(Container.java:2059) 
at java.awt.Component.dispatchEvent(Component.java:3871) 
at java.awt.LightweightDispatcher.retargetMouseEvent(Container.java: 
4249) 
at java.awt.LightweightDispatcher.processMouseEvent(Container.java: 
3929) 
at java.awt.LightweightDispatcher.dispatchEvent(Container.java:3859) 
at java.awt.Container.dispatchEventImpl(Container.java:2045) 
at java.awt.Window.dispatchEventImpl(Window.java:1812) 
at java.awt.Component.dispatchEvent(Component.java:3871) 
at java.awt.EventQueue.dispatchEventImpl(EventQueue.java:588) 
at java.awt.EventQueue.access$000(EventQueue.java:119) 
at java.awt.EventQueue$1.run(EventQueue.java:549) 
at java.awt.EventQueue$1.run(EventQueue.java:548) 
at java.security.AccessController.doPrivileged(AccessController.java: 
214) 
at com.ibm.oti.security.CheckedAccessControlContext.securityCheck 
(CheckedAccessControlContext.java:29) 
at com.ibm.oti.security.CheckedAccessControlContext.securityCheck 
(CheckedAccessControlContext.java:33) 
at sun.misc.JavaSecurityAccessWrapper.doIntersectionPrivilege 
(JavaSecurityAccessWrapper.java:44) 
at java.awt.EventQueue$2.run(EventQueue.java:563) 
at java.awt.EventQueue$2.run(EventQueue.java:562) 
at java.security.AccessController.doPrivileged(AccessController.java: 
214) 
at com.ibm.oti.security.CheckedAccessControlContext.securityCheck 
(CheckedAccessControlContext.java:29) 
at sun.misc.JavaSecurityAccessWrapper.doIntersectionPrivilege 
(JavaSecurityAccessWrapper.java:39) 
at java.awt.EventQueue.dispatchEvent(EventQueue.java:560) 
at java.awt.EventDispatchThread.pumpOneEventForHierarchy 
(EventDispatchThread.java:268) 
at java.awt.EventDispatchThread.pumpEventsForHierarchy 
(EventDispatchThread.java:197) 
at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java: 
191) 
at java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java: 
183) 
at java.awt.EventDispatchThread.run(EventDispatchThread.java:144) 


CAUSE
For this particular upgrade the database had an apostrophe for commoditygroup in Item 

DIAGNOSING THE PROBLEM
Run the below query

select i.itemnum, i.itemsetid, o.orgid, i.commoditygroup, i.outside from 
organization o, item i 
where i.itemsetid = o.itemsetid and not exists ( select 1 from 
itemorginfo c where i.itemnum = c.itemnum and o.itemsetid = c.itemsetid 
and o.orgid = c.orgid) 

From the query results for an example commoditygroup had MAT'L which caused the ORA-00933: SQL command not properly ended

RESOLVING THE PROBLEM
You can change MAT'L to MATL for the upgrade then you can change it back again.




Update item Set commoditygroup='MATL' Where commoditygroup='MAT''L'

Note: You need to restore the database to pre-upgrade, then start the upgrade over again.