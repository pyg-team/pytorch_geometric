Title: IBM Clarity Server - error received when saving a template: "Failed to execute the job - 
Timeout expired" - United States

Text:
ServerJob; aftersave; timeout TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 Clarity Server templates can trigger the execution of SQL Server stored procedures by using Events that use ServerJobs. However, it is possbile that even if the stored procedure is successfully executed in SQL Server Management Server, an error message is displayed in the Clarity Server web interface. 

SYMPTOM
Assuming the template uses an "After Save" Event, which calls a "ServerJob", the following error message is received when saving the template: 

======================================================================================
Clarity.10026 Template [template_name] failed to save.
Clarity.10031 Failed to execute the event [AfterSave].
Clarity.10032 Failed to execute the job [ServerJob1].
System.Data.SqlClient.SqlException Timeout expired. The timeout period elapsed prior to completion of the operation or the server is not responding.
======================================================================================

CAUSE
The stored procedure takes longer than 30 seconds to complete and there is no timeout specified in the template, which means the default 30 seconds timeout is used.



ENVIRONMENT
Clarity Server 7.x 

Clarity Studio 7.x


DIAGNOSING THE PROBLEM
Create a simple template that uses an "AfterSave" Event and a ServerJob 

 1. Call a SQL Server stored procedure inside the ServerJob 
 2. Notice that if the stored procedure takes longer than 30 seconds to execute, the error from "Symptom" is received. 

RESOLVING THE PROBLEM
In order to solve this problem, an adequate timeout value must be set for the ServerJob; depending on the Clarity Studio version, this can be done in two ways: 

 * For Clarity Studio 7.20 and higher: the timeout can be set in the Clarity Studio Design pane: Advanced -> Jobs -> Server Jobs -> select the job and then enable the check box "Enable Timeout after ..." and set an appropriate value. (If you set the timeout to 0) 
 * For Clarity Studio 7.0.1: the timeout needs to be specified directly in the code template, in the <Database> tag:

<Jobs> 
<ServerJobName="..."> 
<Database Asynchronous="true" TimeOut="0"> 
<Source Name="..."/> 
<Script Type="Sql"> 
<Text><....> 
</Script> 
</Database> 
</ServerJob>