Title: IBM How can I shrink the MySQL Database? - United States

Text:
Data management; Database Performance; Operating Environment; STERLINGFAQ TECHNOTE (FAQ)

QUESTION
 How can I shrink the MySQL Database? 

ANSWER


1. Stop GIS 2. Start the MySQL database, usually using the 'control_mysql.cmd start' from the '<GIS>\SI\bin' directory 3. Dump the data from the database named 'woodstock' using the 'mysqldump' command (found in '<GIS>\SI\mysql\bin'): mysqldump --host=localhost --port=<BASE+3> --user=si --password=woodstock --databases woodstock --opt --quick --extended-insert > <PATH><FILE> For example, my base port is 40000 and I'll use C:\Temp\Dump1.sql as my output file: mysqldump --host=localhost --port=40003 --user=si --password=woodstock --databases woodstock --opt --quick --extended-insert > C:\Temp\Dump1.sql 4. Stop the database, again using 'control_mysql.cmd stop' 5. Move the contents of the '<GIS>\SI\mysql\var' to a safe location (these are the actual files that make up the database). DO NOT DELETE THESE FILES UNTIL WE HAVE CONFIRMED THAT GIS IS RUNNING WITHOUT ISSUE! 6. Move the contents of the '<GIS>\SI\mysql\data\woodstock' directory (a large number of .frm files) to a safe location. Again, DO NOT DELETE THESE FILES UNTIL WE HAVE CONFIRMED THAT GIS IS RUNNING WITHOUT ISSUE! 7. Start the database by running 'control_mysql.cmd start'. Doing so will create a new set of files in the '<GIS>\SI\mysql\var' directory. 8. Reload the dumped data into the database, using the 'mysql' command: mysql --host=localhost --port=<BASE+3> --user=si --password=woodstock woodstock < <PATH><FILE></span></div> Using the settings from the above example, here is my command line: mysql --host=localhost --port=40003 --user=si --password=woodstock woodstock < C:\Temp\Dump1.sql</span></div> PLEASE NOTE: This step can take a LONG time to complete ******************************************************************************* WARNING: If this is GIS version 2.2 or older, please see the Note 1 below WARNING: If this is on UNIX, please see Note 2 below ******************************************************************************* 9. When the import is complete, stop the database using 'control_mysql.cmd stop' 10. Restart GIS and check the system 11. If the system comes up with no issue, and there appears to be no errors, the old ibdata files (Step 5) and the .frm files (Step 6) can be deleted. I would NOT delete the Dump file created in Step 3 for several weeks, just in case!! ******************************************************************************* NOTE 1: In very old versions of GIS (2.2 and before), there could be foreign keys set in the database, which are not used in any later versions. In Step 8, if the re-import fails with a ErrNo 150, this is the root cause. In this case, follow the below procedure instead: 8a. Start the MySQL command line program by changing to the <GIS>\SI\mysql\bin directory in a command prompt and doing: mysql --host=localhost --port=<GIS PORT+3> --user=si --password=woodstock --database=woodstock Replace the <GIS PORT+3> with the value from your server. For example, if my GIS is running at port 5080, then I would use 5083 as my port number. 8b. Do the following from the 'mysql>' prompt: mysql> SET FOREIGN_KEY_CHECKS = 0; mysql> SOURCE <PATH><DUMPFILE> mysql> SET FOREIGN_KEY_CHECKS = 1; From this point, continue to Step 9 in the above instructions. Note 2: If the dump file returned by Step 8 is far too small (less than 10k, and consists of no SQL statements) and you are on a UNIX machine, you may need to use the --socket option with the appropriate filename. (/tmp/mysql.<Baseport+3>.sock) So the above sqldump statement would then look like: mysqldump --host=localhost --port=40003 --user=si --password=woodstock --databases woodstock --opt --quick --extended-insert --socket=/tmp/mysql.40003.sock > dbdumpfile.sql  

HISTORICAL NUMBER
 FAQ2078