Title: IBM Out of memory exception received when running staging copy - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When running staging copy you receive an out of memory exception and are not able to copy data from your production database into your staging database. 

SYMPTOM
You will see a stacktrace similar to the following but it may differ depending on what process was running when the out of memory occurred: 

The Stage Copy utility is copying the merchant table data. 

The Stage Copy utility copied table "member" successfully. 

The Stage Copy utility copied table "orgentity" successfully. 

The Stage Copy utility copied table "addrbook" successfully. 

The Stage Copy utility copied table "address" successfully. 

The Stage Copy utility copied table "mbrgrp" successfully. 

The Stage Copy utility copied table "mbrgrpdesc" successfully. 

The Stage Copy utility copied table "mbrgrpcond" successfully. 

The Stage Copy utility copied table "mbrgrpmbr" successfully. 

The Stage Copy utility copied table "trading" successfully. 

The Stage Copy utility copied table "trddesc" successfully. 

The Stage Copy utility copied table "mbrgrpusg" successfully. 

JVMDUMP006I Processing dump event "systhrow", detail "java/lang/OutOfMemoryError" - please wait. 

JVMDUMP032I JVM requested Snap dump using '/opt/IBM/WebSphere/CommerceServer70/bin/Snap.20110817.1xx409.20024.0xx.trc' in response to an event 

JVMDUMP010I Snap dump written to /opt/IBM/WebSphere/CommerceServer70/bin/Snap.20110817.xx4409.20xx4.0001.trc 

JVMDUMP032I JVM requested Heap dump using '/opt/IBM/WebSphere/CommerceServer70/bin/heapdump.20110xx7.14xx09.20024.0002.phd' in response to an event 

JVMDUMP010I Heap dump written to /opt/IBM/WebSphere/CommerceServer70/bin/heapdump.20xx0817.xx4409.20024.0xx2.phd 

JVMDUMP032I JVM requested Java dump using '/opt/IBM/WebSphere/CommerceServer70/bin/javacore.20110817.144409.20xx4.0003.txt' in response to an event 

JVMDUMP010I Java dump written to /opt/IBM/WebSphere/CommerceServer70/bin/javacore.20110817.144xx9.20024.0003.txt 

JVMDUMP013I Processed dump event "systhrow", detail "java/lang/OutOfMemoryError". 

Exception in thread "main" java.lang.OutOfMemoryError 

at sun.util.calendar.Gregorian.newCalendarDate(Gregorian.java:79) 

at sun.util.calendar.Gregorian.newCalendarDate(Gregorian.java:31) 

at sun.util.calendar.ZoneInfo.getOffset(ZoneInfo.java:377) 

at oracle.jdbc.driver.DateCommonBinder.zoneOffset(OraclePreparedStatement.java:17561) 

at oracle.jdbc.driver.DateCommonBinder.setOracleCYMD(OraclePreparedStatement.java:17603) 

at oracle.jdbc.driver.TimestampBinder.bind(OraclePreparedStatement.java:18008) 

at oracle.jdbc.driver.OraclePreparedStatement.setupBindBuffers(OraclePreparedStatement.java:2948) 

at oracle.jdbc.driver.OraclePreparedStatement.executeBatch(OraclePreparedStatement.java:9314) 

at oracle.jdbc.driver.OracleStatementWrapper.executeBatch(OracleStatementWrapper.java:211) 

at com.ibm.commerce.staging.Copy.runBatch(Copy.java:577) 

at com.ibm.commerce.staging.Copy.copyOneTable(Copy.java:502) 

at com.ibm.commerce.staging.MerchantCopy.copyMerchantTables(MerchantCopy.java:770) 

at com.ibm.commerce.staging.StagingCopy.stageCopy(StagingCopy.java:1457) 

at com.ibm.commerce.staging.StagingCopy.main(StagingCopy.java:784) 

./stagingcopy.sh: line 91: 20024 Segmentation fault ${JAVA_EXE?} -Duser.install.root="$WAS_HOME" -classpath $CLASSPATH $JVMPROPERTIES -Xmnx2048m -Dos=unix -Dwcshome=$WCS_HOME -Dwclogdir=$WCLOGDIR com.ibm.commerce.staging.StagingCopy $* $DEFAULTLOG $DBTYPE


CAUSE
The tables being copied contain too much data for the staging copy script to be able to process. There are too many rows involved or the table data itself is large.


RESOLVING THE PROBLEM
To resolve this issue you can run the staging copy again with the -script flag. This will use an export and import insert which should minimize the memory needed to complete. 

You can see the following document for usage of -script: Stagingcopy utility [http://publib.boulder.ibm.com/infocenter/wchelp/v7r0m0/index.jsp?topic=%2Fcom.ibm.commerce.admin.doc%2Frefs%2Frsscopy.htm&resultof=%22%73%74%61%67%69%6e%67%22%20%22%73%74%61%67%65%22%20%22%63%6f%70%79%22%20%22%63%6f%70%69%22%20].