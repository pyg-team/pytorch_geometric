Title: IBM Directions for using the MQSTACK tool on i5/OS - United States

Text:
MustGather MQSTACK script on OS/400 trouble shooting problem solving diagnosing diagnosis debugging problem determination mqseries Documentation required by WMQ support teams mqminfo mq390l2 mq400l2; MustGatherDocument TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When the WebSphere MQ support team needs to see what activity is happening during a hang or loop, they may ask you to run the MQSTACK tool. This document explains how to use the MQSTACK tool utility.

***NEW*** A DBCS version of the MQSTACK tool has been added. The requirements, tool operation, and outputs are the same as the original tool. The mqstac5v2j.zip file can be found below. It contains the
mqstackj.savf. 


RESOLVING THE PROBLEM
Requirements:
i5/OS V5.1 or higher, and WebSphere MQ V5.2 or higher.


 1. Detach MQSTACKTL5 .zip to your PC and extract the save file. 
 2. Create a save file on your AS400 named MQSTACKTL5 in library QGPL. 
 3. FTP the save file as binary from your PC to the AS400 save file created in step 2. 
 4. Sign on with a profile that has *ALLOBJ and *JOBCTL. 
 5. RSTOBJ OBJ(*ALL) SAVLIB(QGPL) DEV(*SAVF) SAVF(QGPL/MQSTACKTL5). 
 6. Change ownership of all objects: IBMDOCCLV5, IBMDOCCL2, RTVJOBTHR, and RTVMQSTK both *PGM and *MODULE to profile used in step.  * Example: CHGOBJOWN OBJ(QGPL/IBMDOCCLV5) OBJTYPE(*PGM) NEWOWN(USERPROF) 
    
    
 7. Give user QMQM *ALL authority to the RTVMQSTK *PGM and the IBMMQDOCST *FILE(if it exists). 
 8. Call IBMDOCCLV5 to run the tool.


Note: The work files must reside in library QGPL and the user who invokes the utility must have *ALLOBJ and *JOBCTL authority. 

Verify that the utility is working 
CALL IBMDOCCLV5; the utility is working if: 
 * Files QMJOB/ IBMDOC/IBMMQDOC/IBMMQDOCST are created in QGPL and contain data. 
 * IBMDOC contains the equivalent of option 20 from DSPJOB for all QMQM jobs with status ACTIVE. 
 * IBMMQDOCST contains stacks at thread level for each of the active MQ jobs.


If you have a very busy system, such as many jobs running under the user QMQM, then you may want to increase the size of file QGPL/IBMDOC as follows: 

CHGPF FILE(QGPL/IBMMQDOCST) SIZE(*NOMAX) 

The utility does not automatically detect any errors. It simply extracts MQ job information when it is called. mqstacktl5.zip [/support/docview.wss?uid=swg21179930&aid=2] [/support/docview.wss?uid=swg21179930&aid=1]

DBCS only
mqstac5v2j.zip [/support/docview.wss?uid=swg21179930&aid=4]mqstac5v2j.zip [/support/docview.wss?uid=swg21179930&aid=3] 

PRODUCT ALIAS/SYNONYM
 WMQ WebSphere MQ MQSeries