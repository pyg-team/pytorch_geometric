Title: IBM UpdateDB fails - SQLCODE=-614, SQLSTATE=54008 - United States

Text:
UpdateDB; 614; 54008; create index; TPAEUpgrade TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When running UpdateDB, it can fail with this error:


ERROR: BMXAA7025E -- Script failed while running.;

The index or index extension "REPORTBROSDPU_NDX1" cannot be created or altered because the combined length of the specified columns is too long.. SQLCODE=-614, SQLSTATE=54008, DRIVER=4.11.69


SYMPTOM
An index cannot be created because it would exceed the maximum allowable size of an index.


CAUSE
An UpdateDB patch attempts to create an index that is larger than the maximum size limit imposed by the database platform.

ENVIRONMENT
DB2

DIAGNOSING THE PROBLEM
Review the UpdateDB log for the SQL "create index" statement that immediately precedes the failure. In this case:

create unique index reportbrosdpu_ndx1 on reportbrosdpurl (reportbrosid, url) 
;

// Failed.

ERROR: BMXAA7025E -- Script failed while running.;
The index or index extension "REPORTBROSDPU_NDX1" cannot be created or altered because the combined length of the specified columns is too long.. SQLCODE=-614, SQLSTATE=54008, DRIVER=4.11.69

The combined lengths of columns REPORTBROSDPURL.REPORTBROSID and REPORTBROSDPURL.URL is too long for the maximum index size permitted by DB2. DB2 restricts the maximum size of an index to 1024 bytes. The combined length of columns REPORTBROSID and URL is greater than 1024. We can confirm this with this command:

db2 describe table maximo.reportbrosdpurl show detail;

In this case, results are:
URL VARGRAPHIC 3000
REPORTBROSID BIGINT 8

Note that column REPORTBROSDPURL.URL is length 3000, which means that by itself the column is larger than the maximum size of a DB2 index.


RESOLVING THE PROBLEM
Reduce the size of one or more columns that make up the index. In this case, we want to reduce the size of column REPORTBROSDPURL.URL:

Alter Table reportbrosdpurl Alter Column url Set Data Type vargraphic(900) ;

After reducing the size of column URL, now the combined size of the index to be created will be less than the maximum 1024 bytes. Run/restart UpdateDB, and UpdateDB will pick up where it left off, create the index as intended, and continue from there.




Cross reference information Segment Product Component Platform Version Edition Systems and Asset Management Control Desk 7.6.0