Title: IBM IZ76833: MQRC_TRUNCATED_MSG_FAILED WHEN WEBSPHERE MQ V7 JMS APPLICATION  TRIES TO MOVE A MESSAGE TO THE BACKOUT QUEUE - United States

Text:
  FIXES ARE AVAILABLE
WebSphere MQ V7.0 Fix Pack 7.0.1.5 [http://www-01.ibm.com/support/docview.wss?uid=swg24029055]
WebSphere MQ V7.0.1 for i5/OS Fix Pack 7.0.1.5 [http://www-01.ibm.com/support/docview.wss?uid=swg24029788]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  When using the WebSphere MQ v7.0.1.X classes for Java Message
   Service (JMS) within WebSphere Application Server v6.1, the
   following error occurs when the application server tries to
   requeue a poison message to the backout queue:
   
   J2CA0056I: The Connection Manager received a fatal connection
   error from the Resource Adapter for resource <connection
   factory>.The exception which was received is
   com.ibm.msg.client.jms.DetailedMessageEOFException:
   JMSWMQ2002: Failed to get a message from destination
   '<destination>'.WebSphere MQ classes for JMS attempted to
   perform an MQGET; however WebSphere MQ reported an error.Use
   the linked exception to determine the cause of this error.
   :com.ibm.mq.MQException: JMSCMQ0001: WebSphere MQ call failed
   with compcode '1' ('MQCC_WARNING') reason '2080'
   ('MQRC_TRUNCATED_MSG_FAILED').
   at com.ibm.msg.client.wmq.common.internal.Reason.
   reasonToException(Reason.java:548)
   at com.ibm.msg.client.wmq.common.internal.Reason.
   createException(Reason.java:236)
   at com.ibm.msg.client.wmq.internal.WMQMessageConsumer.
   checkJmqiCallSuccess(WMQMessageConsumer.java:123)
   at com.ibm.msg.client.wmq.internal.WMQConnectionBrowser
   $WMQConnectionBrowserShadow.handlePoisonMessage
   (WMQConnectionBrowser.java:510)
   at com.ibm.msg.client.wmq.internal.WMQConnectionBrowser
   $WMQConnectionBrowserShadow.poisonous
   (WMQConnectionBrowser.java:444)
   at com.ibm.msg.client.wmq.internal.WMQConnectionBrowser
   $WMQConnectionBrowserShadow.consumer
   (WMQConnectionBrowser.java:759)
   at com.ibm.mq.jmqi.remote.internal.RemoteAsyncConsume.drive
   Consumer(RemoteAsyncConsume.java:1478)
   at com.ibm.mq.jmqi.remote.internal.RemoteDispatchThread.run
   (RemoteDispatchThread.java:385)
   at com.ibm.msg.client.commonservices.workqueue.WorkQueueItem.
   runTask(WorkQueueItem.java:209)
   at com.ibm.msg.client.commonservices.workqueue.
   SimpleWorkQueueItem.runItem(SimpleWorkQueueItem.java:100)
   at com.ibm.msg.client.commonservices.workqueue.WorkQueueItem.
   run(WorkQueueItem.java:224)
   at com.ibm.msg.client.commonservices.workqueue.
   WorkQueueManager.runWorkQueueItem(WorkQueueManager.java:298)
   at com.ibm.msg.client.commonservices.j2se.workqueue.
   WorkQueueManagerImplementation$ThreadPoolWorker.run
   (WorkQueueManagerImplementation.java:1220)
   Caused by: com.ibm.mq.MQException: JMSCMQ0001: WebSphere MQ
   call failed with compcode '1' ('MQCC_WARNING') reason '2080'
   ('MQRC_TRUNCATED_MSG_FAILED').
   at com.ibm.msg.client.wmq.common.internal.Reason.
   createException(Reason.java:223)
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  ****************************************************************
   USERS AFFECTED:
   This issue affects users of the WebSphere Application Server
   V6.x WebSphere MQ messaging provider who have reconfigured the
   application server to use the WebSphere MQ V7 classes for Java
   Message Service (JMS), or users of the WebSphere Application
   Server V7 WebSphere MQ messaging provider, that have
   applications which process messages from non-Java clients (such
   as WebSphere MQ C applications) which have set additional
   properties on the message (for example, MQMF_LAST_MSG_IN_GROUP).
   
   Platforms affected:
   All Distributed (iSeries, all Unix and Windows) +Java
   ****************************************************************
   PROBLEM SUMMARY:
   In order to move a poison message to the backout queue, the
   WebSphere MQ classes for JMS have to get the message from the
   original queue and then put it onto the backout queue.
   
   When performing the MQGET, the classes for JMS requested the
   message data plus any properties that had been set on the
   message. However, the buffer that it passed in to the MQGET was
   only big enough for the message data.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The WebSphere MQ V7 classes for JMS have been updated to
   perform a second MQGET with a larger buffer if the initial
   attempt at getting the poison message fails with
   MQRC_TRUNCATED_MESSAGE_FAILED.
   
   ---------------------------------------------------------------
   The fix is targeted for delivery in the following PTFs:
   
                      v7.0
   Platform           Fix Pack 7.0.1.5
   --------           --------------------
   Windows            U200324
   AIX                U839183
   HP-UX (PA-RISC)    U839621
   HP-UX (Itanium)    U839626
   Solaris (SPARC)    U839622
   Solaris (x86-64)   U839628
   iSeries            tbc_p700_0_1_5
   Linux (x86)        U839623
   Linux (x86-64)     U839627
   Linux (zSeries)    U839624
   Linux (Power)      U839625
   
   The latest available maintenance can be obtained from
   'WebSphere MQ Recommended Fixes'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006037]
   
   If the maintenance level is not yet available, information on
   its planned availability can be found in 'WebSphere MQ
   Planned Maintenance Release Dates'
   http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309 [http://www-1.ibm.com/support/docview.wss?rs=171&uid=swg27006309]
   ---------------------------------------------------------------
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   IZ76833
   
   
 * REPORTED COMPONENT NAME
   WMQ AIX V7
   
   
 * REPORTED COMPONENT ID
   5724H7221
   
   
 * REPORTED RELEASE
   700
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-06-03
   
   
 * CLOSED DATE
   2010-06-25
   
   
 * LAST MODIFIED DATE
   2010-11-29
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WMQ AIX V7
   
   
 * FIXED COMPONENT ID
   5724H7221
   
   

APPLICABLE COMPONENT LEVELS
 * R700 PSY
   UP