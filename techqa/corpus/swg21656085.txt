Title: IBM AMQ6150: Semaphore busy (xecL_W_LONG_LOCK_WAIT). It could be slow performance or a hang - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 An FDC file is generated for your WebSphere MQ queue manager along with error message
AMQ6150: WebSphere MQ semaphore is busy 

SYMPTOM
The following is an example of FDC files that show a pair of "AMQ6150: WebSphere MQ semaphore is busy".

| Probe Id :- XC307040 
| Component :- xlsRequestMutex
| Major Errorcode :- xecL_W_LONG_LOCK_WAIT 
| Probe Description :- AMQ6150: WebSphere MQ semaphore is busy.



| Probe Id :- XC308010
| Component :- xlsReleaseMutex
| Major Errorcode :- xecL_W_LONG_LOCK_WAIT 
| Probe Description :- AMQ6150: WebSphere MQ semaphore is busy.



CAUSE
The AMQ6150 indicates that a required semaphore resource is in use. These FDC's point to a process waiting for a semaphore longer than the length of time we have internally coded that it should wait.

This problem could be caused by:
- An application died and the semaphore lock was not released
- An application hung while holding a lock
- The system is heavily loaded and the process holding the lock did not get enough processor time before the lock request routine timed out
- These FDC's can be issued in a simply informational manner to indicate a process waited for a semaphore longer than the length of time we have internally coded that it should wait
- If you have large queues where you store thousands/millions of persistent messages, during checkpointing, the queue gets reloaded and it will take a long time
- A Semaphore operations issue on the operating system


RESOLVING THE PROBLEM
Long lock wait FDC's typically indicate one of two situations:


1. A performance problem


In this case the long lock wait FDC's will occur in matching pairs, one from the thread that waits for a prolonged time for access to a resource, and the other from the thread that held that resource for a long time at the time the resource is released. The first thread flags the resource at the time the first FDC is raised, such as: 


| Probe Id :- XC307040
| Probe Id :- XC307050
| Probe Id :- XC307070
| Probe Id :- XC307100
| Probe Id :- XC514090 
| Probe Id :- XY551007

| Component :- xlsRequestMutex
| Component :- xlsRWMutexRequest 
| Component :- xlsSpinLockRequest

| Major Errorcode :- xecL_W_LONG_LOCK_WAIT
| Probe Description :- AMQ6150: WebSphere MQ semaphore is busy 

Then when that resource is released the matching FDC is generated showing why the resource was held for a long time.
An example for illustration purposes (for the 2nd FDC) is the following signature, notice the Component "xlsReleaseMutex" 


| Probe Id :- XC308010
| Probe Id :- XY552020

| Component :- xlsReleaseMutex
| Component :- xlsSpinLockRelease

| Major Errorcode :- xecL_W_LONG_LOCK_WAIT
| Probe Description :- AMQ6150: WebSphere MQ semaphore is busy. 

 

In the case when the request and release FDC's match up then there is little point in collecting the information for a "hang" (see item 2, below). Performance apart, matched pairs of long lock wait FDC's are largely informational.


 
2. A hang 


In the event of a hang, then threads waiting for resources raise the initial long lock wait FDC's, but as the resources are never released (due to the hang) then the corresponding release FDC's are never generated (that is, from the above example, the ProbeID XC308010 is NOT generated). 

To ensure that it is a hang situation, do:


a) Check if there are additional FDC files that were generated AFTER the initial FDC that was generated.


b) If (a) is affirmative, check that the "Component" shown in the other FDC contains the string "Release", such as "xlsReleaseMutex"?
=> If this is the case, then this matches situation 1, in which the pair of FDCs are indicating a problem with performance of the machine (most likely due to workload). 


c) If (a) is negative, then the next time that the situation happens, please follow the steps from the following technote:

Collect and analyze WebSphere MQ data to solve problems with hangs and high CPU usage [http://www.ibm.com/support/docview.wss?rs=171&uid=swg21293105]

 


Cross reference information Segment Product Component Platform Version Edition Business Integration IBM MQ 
PRODUCT ALIAS/SYNONYM
 WebSphere MQ WMQ