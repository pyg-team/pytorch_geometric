Title: IBM Application of a security-related Tivoli System Automation for Multi-platform (TSAMP) efix for DB2 in a single node, multi-node, and HADR environment - United States

Text:
 PRODUCT DOCUMENTATION

ABSTRACT
 While the best practice for upgrading TSAMP software level is through the DB2 fixpack, update leveraging existing online or offline software update procedures, applying a TSAMP security efix, which may be released in between DB2 fixpacks, requires a manual installation procedure. The instructions outlined in this topic provides the steps to update an TSAMP/RSCT cluster with TSAMP security fixes on Linux and Solaris. 

CONTENT
Before you begin:


 * Your instance must not be a DB2 pureScale instance 
 * You must have root authority


Restrictions:  * The procedure applies only to the TSAMP and RSCT package that is shipped with DB2. If TSAMP or RSCT has been upgraded outside of the package that is integrated with the db2 image, then regular TSAMP/RSCT support should be contacted for a fix. 
 * The base level of target TSAMP security efix must be the same as the current committed TSAMP level in the DB2 build. For example, if the current TSAMP level in the RSCT cluster is at 4.1.0.3 efix 1, and TSAMP releases a new security efix 2 a month later, the efix to be applied must be from the same TSAMP base level 4.1.0.3. The procedures documented in this topic cannot be used to move up the TSAMP base level. 
 * For efixes specific to RSCT, the base level of RSCT must be the same as the current committed RSCT level in the DB2 build. For example, if the current RSCT level in the cluster is at 3.2.1.2 efix 1, and the TSAMP security fix includes an RSCT efix; efix 2 a month later, the RSCT efix to be applied must be from the same RSCT base level 3.2.1.2. The procedures in this topic cannot be used to move up the RSCT base level. 
 * The procedure described below is restricted to be used for security fixes not included in any DB2 fixpacks but has been validated and supported by DB2 as documented in http://www-01.ibm.com/support/docview.wss?uid=swg21986595 [http://www-01.ibm.com/support/docview.wss?uid=swg21986595].


Procedure:  1. Download the target efix files locally on each host in the cluster. 
 2. Determine which hosts are involved in the update via the lsrpdomain and lsrpnode command  1. Determine whether or not there is an RSCT domain:
        $ lsrpdomain
        Name OpState RSCTActiveVersion MixedVersions TSPort GSPort
        mydomain Online 3.2.1.2 No 12347 12348
        
        If the lsrpdomain command returns no information, there is no cluster. Only the current host will be affected. Proceed to stop workloads in the next step.
        If the lsrpdomain command returns an entry, use the lsrpnode command to determine which hosts will be affected. 
     2. Determine which hosts will be affected using the lsrpnode command:
        $ lsrpnode
        Name OpState RSCTVersion
        hostA Online 3.2.1.2
        hostB Online 3.2.1.2
        
        These are the hosts in which the efix will need to be installed on.
    
    
 3. Stop all workloads and terminate all clients on all databases involved in all instances in the cluster on the affected hosts.  1. Run the following command on all DB2 nodes in the cluster:
        db2 force applications all 
     2. Check if any applications are still connected by running the following command on each DB2 node:
        db2 list applications global
        
        The output should be:
        db2 list applications global
        SQL1611W No data was returned by Database System Monitor. 
        If applications are still connected, repeat this step and wait till connections are terminated.
    
    
 4. Disable HA using the "db2haicu -disable" command (if there was previously a domain) for each instance involved in the cluster. Answer 'Yes' to disabling the high availability for the instance, and 'TSA' for the high availability configuration parameter. 
 5. Deactivate each database:
    db2 deactivate db <database_name> 
 6. Stop db2 by running the following command on any host in the DB2 cluster:
    db2stop
    If there was previously a domain, run the command on all instances that exist on hosts previously show in the lsrpnode output. 
 7. Switch to the root user on any host and proceed to do the following:  1. Stop the RSCT domain to perform the required maintenance (if one previously existed):
        chrsrc -c IBM.PeerNode CritRsrcProtMethod=5
        stoprpdomain -f <domain name>
        where <domain name> is the domain name found by the lsrpdomain command in a previous step.
        
        Run lsrpdomain and wait until the domain is in a stopped state:
        $ lsrpdomain
        Name OpState RSCTActiveVersion MixedVersions TSPort GSPort
        mydomain Offline 3.2.1.2 No 12347 12348 
     2. Untar the file on every host:
        tar â€“xvf <package>
        
        For example, if the package name is 4.1.0.3-TIV-ITSAMP-Linux-IFS001.tar, the command to untar is:
        tar -xvf 4.1.0.3-TIV-ITSAMP-Linux-IFS001.tar 
        
        The untarred directory in this example will be called:
        4.1.0.3-TIV-ITSAMP-Linux-IFS001 
     3. On every host in the cluster, go to the untarred directory in the previous step and run the install script as follows:
        cd 4.1.0.3-TIV-ITSAMP-Linux-IFS001
        ./install.sh 
     4. Reboot all hosts in the cluster 
     5. Once all of the hosts are up again, start the RSCT domain again (if there was previously a domain):
        startrpdomain <domain name>
        chrsrc -c IBM.PeerNode CritRsrcProtMethod=3
        where <domain name> is the domain name found by the lsrpdomain command in a previous step.
    
    
 8. Switch back to the DB2 instance owner and start DB2 on all hosts, on all instances that were previously stopped:
    Start DB2:
    db2start 
 9. Enable HA using the db2haicu command (if there was previously a domain) for each instance involved in the cluster. Answer 'Yes' to enabling the high availability for the instance, and 'TSA' for the high availability configuration parameter.