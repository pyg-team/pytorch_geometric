Title: IBM How to determine which replica is associated with a VOB on the local host - United States

Text:
replica; vob; hostname; 1236992 TECHNOTE (FAQ)

QUESTION
 How do you figure out which replica is associated with an IBM Rational ClearCase VOB on the local host? 

CAUSE
This technote explains how to determine the IBM Rational ClearCase MultiSite replica that is included in the VOB family on the local host when a replica listing indicates that more than one replica is located on the local host.

ANSWER
A VOB replica is a copy of the VOB; hence, each replica in itself is a VOB. Collectively, the entire set of replicas of a VOB is called a VOB family. 

The multitool lsreplica command shows all the replicas of a specific VOB, and the hostname of the MultiSite server that each replica is stored on.

If there are two or more replicas listed in the multitool lsreplica output for the same VOB on a single host, then this must be corrected immediately, as only one replica of a VOB family can be located on a MultiSite server. You must change or remove all the replicas except the one that you want to keep on the host.

The examples below provide steps to help you identify which replica is associated with a specific VOB on your local MultiSite server, and if necessary, correct the above detailed condition.






This issue is detailed in the IBM Rational ClearCase MultiSite Administrator's Guide > Planning a MultiSite Implementation > ClearCase Use Model > Use of Multiple Replicas of the Same VOB at a Site [http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m0/topic/com.ibm.rational.clearcase.cc_ms_admin.doc/c_using_multiple_replicas.htm] . 




Example 1: 
 * You can determine the replica associated with a VOB by describing the VOB object:
   

M:\dmm-view\comp-sc>cleartool describe -l vob:\comp-sc 
versioned object base "\comp-sc" 
created 2005-10-24T14:25:47-04 by Joe User(user1.Domain Users@myhost) 
master replica: comp-dmm-rep@\comp-sc 
replica name: comp-sc-rep <===== Identifies the replica of this VOB \comp-sc 
VOB family feature level: 4 
VOB storage host:pathname myhost:C:\cc_storage\vobs\comp-sc.vbs" 
VOB storage global pathname "\\myhost\cc_stg\vobs\comp-sc.vbs" 
database schema version: 54 
modification by remote privileged user: allowed 
VOB ownership: 
owner DOMAIN1\user1 
group DOMAIN1\user 
Attributes: 
FeatureLevel = 4 
Hyperlinks: 
AdminVOB@2@\comp-sc -> vob:\pvob-sc
 * Also by examining the output of an lsreplica you can identify which replica a VOB is associated with:

 * Listing all the sibling replicas in the current VOB family will help identify exclude the current VOB replica from the list, thus, identifying the local VOB replica from the above list:


M:\dmm-view\comp-sc>multitool lsreplica -siblings 
For VOB replica "\comp-sc": 
2005-10-24 user1 replica "comp-dmm-rep" 
2005-11-29 user1 replica "comp-steve-rep" 

 * Listing all the replicas in the current VOB family including the current VOB replica (there are a total of 3 in the listing below):


M:\dmm-view\comp-sc>multitool lsreplica 
For VOB replica "\comp-sc": 
2005-10-24 user1 replica "comp-dmm-rep" 
2005-11-29 user1 replica "comp-sc-rep" <=== current VOB replica 
2005-11-29 user1 replica "comp-steve-rep" 

In the above output we can see that the presence of the "comp-sc-rep" replica in this listing indicates that it is the current VOBs replica as the others listed in the previous step are all of it's siblings. 

Review the ClearCase MultiSite Administrator's Guide on the topic of VOB objects and VOB replica objects [VOB%20objects%20and%20VOB%20replica%20objects] for more information. 


Example 2: 

There are two replicas of the VOB, \test-50-vob, and each is reporting that it is located on the server, myhost. 
 1. List all the replicas of a given VOB:
    
    M:\def\test-50-vob>multitool lsreplica -long -invob \test-50-vob
    For VOB replica "\test-50-vob":
    replica "original"
    07-Dec-04.14:58:04 by user1@myhost
    replica type: unfiltered
    master replica: original@\test-50-vob
    request for mastership: enabled
    owner: DOMAIN1\user1
    group: DOMAIN1\group1
    host: "myhost"
    identities: not preserved
    permissions: not preserved
    feature level: 3
    connectivity: connected
    replica "test-sc-rep"
    15-Sep-05.21:24:47 by User1 (user1@myhost)
    replica type: unfiltered
    master replica: original@\test-50-vob
    owner: DOMAIN1\user1
    group: DOMAIN1\group1
    host: "myhost"
    identities: not preserved
    permissions: not preserved
    feature level: unknown
    connectivity: connected
    ...
    
    
 2. Use the undocumented dump command to find which replica belongs to \test-50-vob. Look for the predefined flag in the flags section to identify the replica related to the local host.
    
    Example:
    
    M:\def\test-50-vob>cleartool dump -long replica:original
    original
    oid=75418e36.e34d4df8.beb4.59:ef:ae:a8:55:9b dbid=3 (0x3)
    mtype=replica name="original" type=2
    usid=NT:S-1-5-21-141845252-1443263951-584457872-1606 gsid=NT:S-1-5-21-141845252-1443263951-584457872-1023
    master replica dbid=3
    flags: predefined, reqmaster_enable
    host name="HOST1"
    incarnation=09-Feb-06.00:08:26UTC
    epoch row:
    replica= 484 oplog id= 435
    replica= 503 oplog id= 0
    replica= 547 oplog id= 0
    replica= 6699 oplog id= 0
    replica= 6734 oplog id= 0
    replica= 3 oplog id= 6378
    attributes:
    FeatureLevel = 3
    
    
    M:\def\test-50-vob>cleartool dump -long replica:test-sc-rep
    test-sc-rep
    oid=94ca1a9d.8ee54de0.8ce9.a8:91:e0:e1:26:25 dbid=484 (0x1e4)
    mtype=replica name="test-sc-rep" type=2
    usid=NT:S-1-5-21-141845252-1443263951-584457872-1606 gsid=NT:S-1-5-21-141845252-1443263951-584457872-1023
    master replica dbid=3
    host name="HOST2"
    incarnation=0
    epoch row:
    replica= 3 oplog id= 6378
    replica= 484 oplog id= 435
    replica= 503 oplog id= 0
    replica= 547 oplog id= 0
    replica= 6699 oplog id= 0
    replica= 6734 oplog id= 0
    
    

Once identified, any additional replicas that exist for the same host must be removed or changed: 

 * If you choose to delete the replica, review the ClearCase MultiSite Command Reference section on the topic of rmreplica (multitool man rmreplica) for more information.

 * If you choose to keep the replica, you must find out which host the VOB is physically stored and make the appropriate change to the replica properties. Review the ClearCase MultiSite Command Reference section on the topic of chreplica (multitool man chreplica) for more information.
   
   
   Note: After changing the hostname of test-sc-rep, the multitool output will now display as follows:
   
   M:\def\test-50-vob>multitool lsreplica -long -invob \test-50-vob
   For VOB replica "\test-50-vob":
   replica "original"

07-Dec-04.14:58:04 by user1@myhost 
replica type: unfiltered 
master replica: original@\test-50-vob 
request for mastership: enabled 
owner: DOMAIN1\user1 
group: DOMAIN1\group1 
host: "HOST1" 
identities: not preserved 
permissions: not preserved 
feature level: 3 
connectivity: connected 
replica "test-sc-rep" 
15-Sep-05.21:24:47 by User1 (user1@myhost) 
replica type: unfiltered 
master replica: original@\test-50-vob 
owner: DOMAIN1\user1 
group: DOMAIN1\group1 
host: "HOST2" 
identities: not preserved 
permissions: not preserved 
feature level: unknown 
connectivity: connected 


To learn more about VOB replicas, refer to IBM Rational ClearCase MultiSite Administrator's Guide > Introduction to MultiSite > VOBs and VOB Replicas [http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m0/topic/com.ibm.rational.clearcase.cc_ms_admin.doc/c_vob_replicas.htm]. RELATED INFORMATION
#What VOB did a replica creation packet originate [http://www.ibm.com/support/docview.wss?uid=swg21233136]