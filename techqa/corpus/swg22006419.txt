Title: IBM Connection from TDI to MSSQL using JDBC connector fails when TLSv1.2 only is enabled on MSSQL Server - United States

Text:
TDI; SDI; ITDI; ISDI; Tivoli Directory Integrator; Security Directory Integrator; IBM Tivoli Directory Integrator; IBM Security Directory Integrator; MSSQL Server; JDBC Connector; Protocols; SSL; TLS; TLSv1; TLSv1.2; CTGDIJ109E TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 If TLSSv1 is disabled on MSSQL server and it is running on TLSv1.2 only, connection from TDI to MSSQL server using JDBC connector may fail. 

SYMPTOM
This is issue is seen when TDI is using java 7 or java 8. Error seen in ibmdi.log is: 

-----------------------------------------------------
CTGDIS077I Failed with error: CTGDIJ109E Unable to connect to the database (The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption. Error: "No appropriate protocol, may be no appropriate cipher suite specified or protocols are deactivated". ClientConnectionId:c4997ebd-f51a-45a7-8958-8997c14c4d50). Verify that all the database connection parameters are correctly specified..
ERROR [JDBCtest1] - CTGDIS078I AssemblyLine AssemblyLines/jdsbc2db2 failed with error: CTGDIJ109E Unable to connect to the database (The driver could not establish a secure connection to SQL Server by using Secure Sockets Layer (SSL) encryption. Error: "No appropriate protocol, may be no appropriate cipher suite specified or protocols are deactivated". ClientConnectionId:c4997ebd-f51a-45a7-8958-8997c14c4d50). Verify that all the database connection parameters are correctly specified..
-----------------------------------------------------
Error seen in console output when using java 7:
-----------------------------------------------------
AssemblyLines/jdsbc2db2, handling exception: javax.net.ssl.SSLHandshakeException: No negotiable cipher suite
AssemblyLines/jdsbc2db2, SEND TLSv1 ALERT: fatal, description = handshake_failure
AssemblyLines/jdsbc2db2, WRITE: TLSv1 Alert, length = 2
AssemblyLines/jdsbc2db2, called closeSocket()
-----------------------------------------------------
Errors seen in console output when using java 8:
-----------------------------------------------------
AssemblyLines/jdsbc2db2, handling exception: javax.net.ssl.SSLHandshakeException: No appropriate protocol, may be no appropriate cipher suite specified or protocols are deactivated
AssemblyLines/jdsbc2db2, SEND TLSv1.2 ALERT: fatal, description = handshake_failure
AssemblyLines/jdsbc2db2, WRITE: TLSv1.2 Alert, length = 2
AssemblyLines/jdsbc2db2, called closeSocket()
-----------------------------------------------------
If you run a Java program using Oracle java to connect to MSSQL server, connection will be successful. 


CAUSE
TLSv1 is used as default protocol by IBM jvm libraries present in TDI


ENVIRONMENT
TDI 7.1.1
MSSQL Server




DIAGNOSING THE PROBLEM
Enable SSL debugging using following parameter in solution.properties file: 

javax.net.debug=ssl:handshake
Once done, run the Assembly Line from command prompt by:
ibmdisrv -c "name of configiuration file" -r "name of AssemblyLine" -w -R
The handshake between TDI (client) and MSSQL (server) will fail


RESOLVING THE PROBLEM
This is a known issue in IBM Java and fixed in APAR IV84450. To resolve it upgrade to latest java refresh level and set following parameter in solution.properties file: 

com.ibm.jsse2.overrideDefaultTLS = true

RELATED INFORMATION
 IV84450: SSLCONTEXT.GETINSTANCE(TLS) BEHAVE LIKE ORACLE [http://www-01.ibm.com/support/docview.wss?uid=swg1IV84450]
IBM developer kits [https://www.ibm.com/developerworks/java/jdk/]