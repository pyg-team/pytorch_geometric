Title: IBM FAQ: How do you perform VBQ maintenance? - United States

Text:
STERLINGPRI TECHNOTE (FAQ)

QUESTION
 FAQ: How do you perform VBQ maintenance? 

ANSWER


Scenarios 1 and 2 are performed with Communication Task up:

Scenario 1 - Scheduled VBQ maintenance on any VBQ using CRONLY in erase

Note: Using CRONLY in erase will only erase the batch entries in the VCF. It will be necessary to move the active batches to another VBQ after the erase. VBQnn represents any VBQ that you want to perform maintenance on. VBQxx represents the VBQ to which you want to move batches. 

1. Execute STOUTL erase with CRONLY and VBQ=nn to remove all unneeded batches 
from VBQnn. Include other erase parameters like TODATE and STATOR to control what 
batches are to be erased. The VBQ is left allocated to allow for any remaining batches 
to be transmitted. Flush the remaining steps for return codes greater than eight.

2. Execute STOUTL move to move all remaining batches from VBQnn to VBQxx. These batches 
will be moved to the another online VBQ. VBQnn is left allocated to allow for any remaining 
batches to be transmitted. Flush the remaining steps for return codes greater than eight.

3. De-allocate VBQnn from the online system. Insure that off-line utility processing cannot access 
the data set. Flush the remaining steps if de-allocation is not possible.

4. Execute STOUTL list for VBQ=nn (while the VBQ is de-allocated) to make sure the 
data set is truly empty.

5. Confirm there are no batches on VBQnn. Flush the remaining steps if any batches remain.

6. Execute IDCAMS to delete, define, and repro the dummy record from the Connect:Enterprise (Mailbox) example library 
into VBQnn. Flush the remaining steps if IDCAMS fails.

7. Allocate VBQnn but don‚·t make it the current collection VBQ. 

Note: Steps 8 through 14 are optional. You can leave the batches in VBQxx.

8. Allocate VBQnn as current collection VBQ

9. Execute STOUTL move to move all remaining batches from VBQxx back to VBQnn. 
VBQxx is left allocated to allow for any remaining batches to be transmitted. 
Flush the remaining steps for return codes greater than eight.

10. De-allocate VBQxx from the online system. Insure that off-line utility processing cannot
access the data set. Flush the remaining steps if de-allocation is not possible.

11. Execute STOUTL list with VBQ=xx (while the VBQ is de-allocated) to make sure the data set 
is truly empty.

12. Confirm there are no batches on VBQxx. Flush the remaining steps if any batches remain.

13. Execute IDCAMS to delete, define, repro the dummy record from the Communication Task (Mailbox) example library 
into VBQxx. Flush the remaining steps if IDCAMS fails.

14. Allocate VBQxx but don‚·t make it the current collection VBQ.


Scenario 2 - Scheduled VBQ Maintenance on any VBQ not using CRONLY in erase

Note: VBQnn represents any VBQ you want to perform maintenance on. During steps 3 and 4 batches on VBQnn will not be available.

1. Execute STOUTL erase with VBQ=nn to remove all unneeded batches from VBQnn. Include 
other erase parameters like TODATE and STATOR to control what batches are to be erased. 
The VBQ is left allocated to allow for any remaining batches to be transmitted. Flush the 
remaining steps for return codes greater than eight. 

2. Execute IDCAMS to repro VBQnn to a backup tape or disk. Flush the remaining steps if 
IDCAMS fails.

3. De-allocate VBQnn from the online system. Insure that off-line utility processing cannot access 
the data set. Flush the remaining steps if de-allocation is not possible.

4. Execute IDCAMS to delete, define, and repro the backup from step 2 back into VBQnn. Flush the 
remaining steps if IDCAMS fails.

5. Allocate VBQnn but don‚·t make it the current collection VBQ.


Scenario 3 is performed with Communication Task down

Scenario 3 - Scheduled VBQ Maintenance on all VBQs not using CRONLY in erase

Note:. During steps 3 and 4 batches on all VBQs will not be available.

1. Execute STOUTL erase to remove all unneeded batches from all VBQs. Include erase parameters 
like TODATE and STATOR to control what batches are to be erased. The VBQs are left allocated 
to allow for any remaining batches to be transmitted. Flush the remaining steps for return codes 
greater than eight. 

2. Execute IDCAMS to repro all VBQs to backup tapes or disk. Flush the remaining steps if IDCAMS fails.

3. Shutdown Communication Task (Mailbox). You can leave the server up. Flush the remaining steps if shutdown did not occur.

4. Execute IDCAMS to delete, define, and repro the backups from step 2 back into all the VBQs. 
Flush the remaining steps if IDCAMS fails.

5. Restart Communication Task.



HISTORICAL NUMBER
 PRI1998