Title: IBM PK77738: USING MICROSOFT SQLSERVER DATABASE ON WINDOWS 2003 RESULTS IN A JAVAX.TRANSACTION.XA.XAEXCEPTION WITH ERROR: XP_SQLJDBC_XA_INIT - United States

Text:
 SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS DOCUMENTATION ERROR.
    
   
   

ERROR DESCRIPTION
 *  The sypmtom of the problem is this
   [12/16/08 14:43:38:636 PST] 00000013 WSRdbXaResour E
   DSRA0304E: XAException occurred. XAException contents and
   details are:
   The cause is: null.
   .
   [12/16/08 14:43:38:636 PST] 00000013 WSRdbXaResour E
   DSRA0302E: XAException occurred.
   Error code is: UNKNOWN XA EXCEPTION CODE (0).
   Exception is: java.sql.SQLException: Failed to create the XA
   control connection.
   Error: xp_sqljdbc_xa_init failure, status:0 msg:***
   SQLJDBC_XA DTC_ERROR Context: xa_init, state=1, StatusCode:0
   (0x00000000) ***.
   .
   [12/16/08 14:43:38:671 PST] 00000013 XATransaction E
   J2CA0027E: An exception occurred while invoking start on an XA
   Resource Adapter from dataSource jdbc/releasedbDS, within
   transaction ID {XidImpl:
   formatId(57415344), gtrid_length(36), bqual_length(54),
   data(0000011e41f7fdff00000001000000016b6577cc76ae4393c45745b4fef
   b31fe5827e0150000011e41f7fdff00000001000000016b6577cc76ae4393c45
   745b4fefb31fe5827e015000000010000000000000000000000000001)}:
   javax.transaction.xa.XAException: java.sql.SQLException: Failed
   to create the XA control connection. Error: xp_sqljdbc_xa_init
   failure, status:0 msg:*** SQLJDBC_XA DTC_ERROR
   Context: xa_init, state=1,StatusCode:0 (0x00000000) ***.
   at com.microsoft.sqlserver.jdbc.SQLServerXAResource.start
   (Unknown Source)
   at com.ibm.ws.rsadapter.spi.WSRdbXaResourceImpl.start
   (WSRdbXaResourceImpl.java:1354)
   
   This problem is caused by a known Windows 2003 problem. If
   a cluster of SQL servers is moved from one node to another
   node, or is shutdown, "Enable XA Transactions" checkbox in
   component services for Windows 2003 may be reset to unchecked
   which means that XA transactions are not enabled.  That is what
   the exception above indicates; that the driver is not enabled
   for XA transactions.
   
   There are other possible causes for this exception.  This
   APAR is to document this cause of the exception in the
   WebSphere Application Server Information Center topic "Data
   access problems - SQL server data source." The following
   information will be added to this topic:
   
   Enable XA Transactions in Windows Component Services
   From your Windows desktop, follow these steps:
   Click Start > Settings > Administrative Tools > Component
   Services.
   Expand the tree view to locate the computer where you want to
   turn on support for XA transactions (for example, My Computer).
   Display the context menu for the computer name and click
   Properties.
   Click Options and tune the Transaction Timeout that suits your
   environment. (The recommended minimum is 180 seconds).
   Click MSDTC and click Security Configuration.
   Under Security Settings, select XA Transactions to enable this
   support.
   Click OK to save your changes.
   
   Note: The installation documentation for JDBC XA connectivity
   refers to two known problems, see the Microsoft support site for
   more information:
   KB899756: Windows 2003 only. MSDTC does not detect process
   termination, and MSDTC cannot set time-out values for XA
   transactions in Windows Server 2003.
   KB318818: Performance slows down when you use XA Transactions
   with SQL Server.
   
   
    
   
   

LOCAL FIX
 *  Verify that the Windows Component Service has the Enable XA
   Transactions checkbox checked.
   
   
    
   
   

PROBLEM SUMMARY
 *  ****************************************************************
   * USERS AFFECTED:  All users of WebSphere Application Server   *
   *                  Version 6.1 or 7.0 who use a Microsoft      *
   *                  SQLSERVER database on a Microsoft Windows   *
   *                  Sever 2003 to perform XA transactions.      *
   ****************************************************************
   * PROBLEM DESCRIPTION: The Version 6.1 and 7.0 WebSphere       *
   *                      Application Server Information          *
   *                      Centers do not document a possible      *
   *                      cause of a                              *
   *                      JAVAX.TRANSACTION.XA.XAEXCEPTION        *
   *                      with Error: XP_SQLJDBC_XA_INIT when a   *
   *                      user is using a Microsoft SQLSERVER     *
   *                      database on a Microsoft Windows         *
   *                      Sever 2003 to perform XA transactions.  *
   ****************************************************************
   * RECOMMENDATION:                                              *
   ****************************************************************
   The topic "Data access problems - SQL server
   data source," that is contained int the WebSphere Application
   Server Version 6.1 and 7.0 Information Centers does not
   document that if you are using a Microsoft SQLSERVER database
   on Windows Server 2003, and you move a cluster of SQL servers
   from one node to another node, or shut down the cluster, the
   Enable XA Transactions setting in Windows Component Services
   might be reset to disabled. When this happens
   JAVAX.TRANSACTION.XA.XAEXCEPTION with Error:
   XP_SQLJDBC_XA_INIT might occur because the JDBC driver is no
   longer enabled for XA transactions.
   
   
    
   
   

PROBLEM CONCLUSION
 *  The following new section will be added to the WebSphere
   Application Server Version 6.1 and 7.0 Information Center
   topic "Data access problems - SQL server data source:"
   
   JAVAX.TRANSACTION.XA.XAEXCEPTION occurs with error:
   XP_SQLJDBC_XA_INIT
   
   If you are using a Microsoft SQLSERVER database on Windows
   Server 2003, and you move a cluster of SQL servers from one
   node to another node, or shut down the cluster, the Enable XA
   Transactions setting in Windows Component Services might be
   reset to disabled. When this happens, a
   JAVAX.TRANSACTION.XA.XAEXCEPTION with Error:
   XP_SQLJDBC_XA_INIT might occur because the JDBC driver is no
   longer enabled for XA transactions.
   
   To re-enable XA transactions in Windows Component Services,
   complete the following actions:
   
   1. From your Microsoft Windows desktop, click Start >
   Settings > Administrative Tools > Component Services.
   2. Expand the tree view to locate the computer where you
   want to turn on support for XA transactions; for example, My
   Computer.
   3. Display the context menu for the computer name, and then
   click Properties.
   4. Click Options, and then set Transaction Timeout to a
   length of time that suits your environment. The recommended
   minimum setting is 180 seconds.
   5. Click MSDTC , and then click Security Configuration.
   6. Under Security Settings, select XA Transactions to
   enable this support.
   7. Click OK to save your changes.
   
   Avoid Trouble: The installation documentation for JDBC XA
   connectivity refers to two known problems. See the Microsoft
   support site for more information:
   
   * KB899756: Windows 2003 only. MSDTC does not detect
   process termination, and MSDTC cannot set time-out values for
   XA transactions in Windows Server 2003.
   * KB318818: Performance slows down when you use XA
   Transactions with SQL Server.
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PK77738
   
   
 * REPORTED COMPONENT NAME
   WEBS APP SERV N
   
   
 * REPORTED COMPONENT ID
   5724H8800
   
   
 * REPORTED RELEASE
   61A
   
   
 * STATUS
   CLOSED DOC
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2008-12-18
   
   
 * CLOSED DATE
   2008-12-19
   
   
 * LAST MODIFIED DATE
   2008-12-19
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION

APPLICABLE COMPONENT LEVELS