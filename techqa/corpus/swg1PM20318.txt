Title: IBM PM20318: DURING UPDATE OF PAGE PARAMETERS, A DB TIMEOUT CAN CAUSE A DEAD LOCK IN PORTAL AND IN TURN A SERVER HANG - United States

Text:
  FIXES ARE AVAILABLE
6.1.0.5 Download: WebSphere Portal and WCM V6.1.0 fix pack 5 [http://www-01.ibm.com/support/docview.wss?uid=swg24027475]
Fixes integrated in WebSphere Portal V7.0 Combined Cumulative Fix [http://www-01.ibm.com/support/docview.wss?uid=swg24027254]
Recommended Updates for WebSphere Portal and IBM Web Content Manager V7.0 [http://www-01.ibm.com/support/docview.wss?uid=swg24027857]
6.1.0.6 Download: WebSphere Portal and WCM V6.1.0 fix pack 6 [http://www-01.ibm.com/support/docview.wss?uid=swg24030970]
7.0.0.2 Download: WebSphere Portal and WCM V7.0 fix pack 2 [http://www-01.ibm.com/support/docview.wss?uid=swg24031676]


SUBSCRIBE
You can track all active APARs for this component.



APAR STATUS
 * CLOSED AS PROGRAM ERROR.
    
   
   

ERROR DESCRIPTION
 *  Update of page parameters can cause a combined DB - java
   deadlock that can even lead to server hang.
   Stacktrace of hung thread in javacore:
   at java.lang.Object.wait(Native Method)
   at java.lang.Object.wait(Object.java(Compiled Code))
   at com.ibm.wps.state.utils.synchronization.Mutex
   .waitForCount(Mutex.java(Compiled Code))
   at com.ibm.wps.model.content.impl.ThreadsafeContentModelImpl
   .readBegin(ThreadsafeContentModelImpl.java(Compiled Code))
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .findByID(ContentModelImpl.java(Compiled Code))
   
   stacktrace of DB timeout:
   at com.ibm.wps.datastore.impl.ResourcePersister
   .findInternal(ResourcePersister.java(Compiled Code))
   at com.ibm.wps.datastore.impl.ResourcePersister
   .findInternal(ResourcePersister.java(Inlined Compiled Code))
   at com.ibm.wps.datastore.impl.ResourcePersister
   .findSingleObject(ResourcePersister.java(Compiled Code))
   at com.ibm.wps.datastore.impl.ResourcePersister
   .findInternal(ResourcePersister.java(Inlined Compiled Code))
   at com.ibm.wps.datastore.impl.ResourcePersister
   .find(ResourcePersister.java(Inlined Compiled Code))
   at com.ibm.wps.datastore.impl.ResourceHomeImpl
   .find(ResourceHomeImpl.java(Inlined Compiled Code))
   at com.ibm.wps.datastore.impl.PageInstanceHomeImpl
   .find(PageInstanceHomeImpl.java(Compiled Code))
   at com.ibm.wps.datastore.impl.federation.ResourceHomeImpl
   .find(ResourceHomeImpl.java(Compiled Code))
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .getDerivationParent(ContentModelImpl.java(Compiled Code))
   at com.ibm.wps.model.content.impl.SmartTopologyValidator
   .createDerivationPath(SmartTopologyValidator.java(Compiled
   Code))
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .obtainCacheKey(ContentModelImpl.java(Compiled Code))
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .invalidateResource(ContentModelImpl.java:916)
   at com.ibm.wps.model.content.impl.SmartResourceValidator
   .makeValid(SmartResourceValidator.java:170)
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .makeValid(ContentModelImpl.java(Compiled Code))
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .readBegin(ContentModelImpl.java(Inlined Compiled Code))
   at com.ibm.wps.model.content.impl.ThreadsafeContentModelImpl
   .readBegin(ThreadsafeContentModelImpl.java(Compiled Code))
   at com.ibm.wps.model.content.impl.ContentModelImpl
   .findByID(ContentModelImpl.java(Compiled Code))
   
   
    
   
   

LOCAL FIX

PROBLEM SUMMARY
 *  Update of page parameters can cause a combined DB - java
   deadlock that can even lead to server hang.
   
   Stacktrace of hung thread in javacore:
   
   at java.lang.Object.wait(Native Method)
   at java.lang.Object.wait(Object.java(Compiled Code))
   at
   com.ibm.wps.state.utils.synchronization.Mutex.waitForCount(Mutex
   .java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ThreadsafeContentModelImpl.readBe
   gin(ThreadsafeContentModelImpl.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.findByID(Content
   ModelImpl.java(Compiled Code))
   
   Stacktrace of DB timeout:
   
   at
   com.ibm.wps.datastore.impl.ResourcePersister.findInternal(Resour
   cePersister.java(Compiled Code))
   at
   com.ibm.wps.datastore.impl.ResourcePersister.findInternal(Resour
   cePersister.java(Inlined Compiled Code))
   at
   com.ibm.wps.datastore.impl.ResourcePersister.findSingleObject(Re
   sourcePersister.java(Compiled Code))
   at
   com.ibm.wps.datastore.impl.ResourcePersister.findInternal(Resour
   cePersister.java(Inlined Compiled Code))
   at
   com.ibm.wps.datastore.impl.ResourcePersister.find(ResourcePersis
   ter.java(Inlined Compiled Code))
   at
   com.ibm.wps.datastore.impl.ResourceHomeImpl.find(ResourceHomeImp
   l.java(Inlined Compiled Code))
   at
   com.ibm.wps.datastore.impl.PageInstanceHomeImpl.find(PageInstanc
   eHomeImpl.java(Compiled Code))
   at
   com.ibm.wps.datastore.impl.federation.ResourceHomeImpl.find(Reso
   urceHomeImpl.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.getDerivationPar
   ent(ContentModelImpl.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.SmartTopologyValidator.createDeri
   vationPath(SmartTopologyValidator.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.obtainCacheKey(C
   ontentModelImpl.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.invalidateResour
   ce(ContentModelImpl.java:916)
   at
   com.ibm.wps.model.content.impl.SmartResourceValidator.makeValid(
   SmartResourceValidator.java:170)
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.makeValid(Conten
   tModelImpl.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.readBegin(Conten
   tModelImpl.java(Inlined Compiled Code))
   at
   com.ibm.wps.model.content.impl.ThreadsafeContentModelImpl.readBe
   gin(ThreadsafeContentModelImpl.java(Compiled Code))
   at
   com.ibm.wps.model.content.impl.ContentModelImpl.findByID(Content
   ModelImpl.java(Compiled Code))
   
   
    
   
   

PROBLEM CONCLUSION
 *  Correctly manage java lock (mutex): release it in finally
   block.
   
   Failing Module(s):
      Engine: Page Assembly
   
   Affected Users:
      All
   
   
   Version Information:
       Portal Version(s): 6.0.1.1
        Pre-Requisite(s): PK71391 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK71391]
         Co-Requisite(s): ---
   
       Portal Version(s): 6.0.1.5
        Pre-Requisite(s): PK93166 [http://www-01.ibm.com/support/docview.wss?uid=swg1PK93166]
         Co-Requisite(s): ---
   
       Portal Version(s): 6.1.0.3, 6.1.0.4
        Pre-Requisite(s): ---
         Co-Requisite(s): ---
   
   Manuel Steps:
      None
   
   Platform Specific:
      This fix applies to all platforms.
   
   A fix is available from Fix Central:
   
   http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorde
   r?apar=PM20318&productid=WebSphere%20Portal&brandid=5 [http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorder?apar=PM20318&productid=WebSphere%20Portal&brandid=5]
   
   You may need to type or paste the complete address into your Web
   browser.
   
   PM20314 [http://www-01.ibm.com/support/docview.wss?uid=swg1PM20314] is also part of Cumulative Fix 07 for Portal 6.1.0.3 /
   6.1.5.0:
   http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorde
   r?apar=PM18585&productid=WebSphere%20Portal&brandid=5 [http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorder?apar=PM18585&productid=WebSphere%20Portal&brandid=5]
   
   and part of Cumulative Fix 07 for Portal 6.1.0.4 / 6.1.5.1:
   http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorde
   r?apar=PM18610&productid=WebSphere%20Portal&brandid=5 [http://www.ibm.com/eserver/support/fixes/fixcentral/swgquickorder?apar=PM18610&productid=WebSphere%20Portal&brandid=5]
   
   
    
   
   

TEMPORARY FIX

COMMENTS

APAR INFORMATION
 * APAR NUMBER
   PM20318
   
   
 * REPORTED COMPONENT NAME
   WEBSPHERE PORTA
   
   
 * REPORTED COMPONENT ID
   5724E7600
   
   
 * REPORTED RELEASE
   60E
   
   
 * STATUS
   CLOSED PER
   
   
 * PE
   NoPE
   
   
 * HIPER
   NoHIPER
   
   
 * SPECIAL ATTENTION
   NoSpecatt
   
   
 * SUBMITTED DATE
   2010-08-11
   
   
 * CLOSED DATE
   2010-08-31
   
   
 * LAST MODIFIED DATE
   2010-08-31
   
   

 * APAR IS SYSROUTED FROM ONE OR MORE OF THE FOLLOWING:
   
   
   
 * APAR IS SYSROUTED TO ONE OR MORE OF THE FOLLOWING:
   
   
   

FIX INFORMATION
 * FIXED COMPONENT NAME
   WEBSPHERE PORTA
   
   
 * FIXED COMPONENT ID
   5724E7600
   
   

APPLICABLE COMPONENT LEVELS
 * R60E PSY
   UP
   
   
 * R60J PSY
   UP
   
   
 * R615 PSY
   UP
   
   
 * R61C PSY
   UP