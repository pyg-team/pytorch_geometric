Title: IBM Migrate search failed at ConfigWCforSolrMigrationCatalogFiltersExpressionTask - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 When migrate WebSphere Commerce search, DB2 exception is observed during ConfigWCforSolrMigrationCatalogFiltersExpressionTask. 

SYMPTOM
 

Search migrate fails and the following exception is thrown.
FINER: RETURN An error occurred while attempting to run task. The exception error was: A SQL exception was caught. The error was: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=VALUES;E KEYS SET (COUNTER);=, DRIVER=4.14.88.
Jun 15, 2015 5:53:29 PM com.ibm.commerce.search.indexsetup.SearchIndexSetupMain main
WARNING: 
******************************************************************
******************************************************************
An error occurred while executing job. 

Cause:
An error occurred while attempting to run task. The exception error was: A SQL exception was caught. The error was: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=VALUES;E KEYS SET (COUNTER);=, DRIVER=4.14.88.

Right before the exception, we could see the corresponding SQL statement is 
FINER: RETURN A SQL exception was caught. The error was: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=VALUES;E KEYS SET (COUNTER);=, DRIVER=4.14.88.


CAUSE
This is a code defect. CatalogFilter is migrated even if there is no CatalogFilter defined. APAR JR53113 will resolve the problem.


RESOLVING THE PROBLEM
Apply APAR JR53113 [http://www.ibm.com/support/docview.wss?uid=swg1JR53113] as the permanent solution. Then run the migrate Catalog Filter, since the problem is related the ConfigWCforSolrMigrationCatalogFiltersExpressionTask. 

In cases where a Catalog Filter is never used, such as a B2C store or a Catalog Filter is not defined, such as a B2B store: 

 * Skip the above task and execute the following: 
 * Go to Commerce_inst_dir/components/foundation/subcomponents/search/config directory, back up wc-search-index-setup.xml file, then open the file find the following section. Then remove this task or comment it out.
   
   For example, like the highlighted text below. Then run migrateSolrSearch again.
   
   <_config:ActionConfiguration name="configWCforSolrMigration" remotable="false">
   <_config:Index name="CatalogEntry">
   <_config:Job
   buildClass="com.ibm.commerce.search.indexsetup.execution.builder.ConfigWCforSolrMigrationJobBuilder">
   <_config:Task
   impl="com.ibm.commerce.search.indexsetup.execution.task.ConfigWCforSolrMigrationPreProcessConfigSetupTask" />
   <_config:Task
   impl="com.ibm.commerce.search.indexsetup.execution.task.ConfigWCforSolrCatalogEntryMigrationDeltaCatalogEntryTableCreationTask" />
   <_config:Task
   impl="com.ibm.commerce.search.indexsetup.execution.task.ConfigWCforSolrMigrationWCSearchXMLSetupTask" />
   <!--_config:Task
   impl="com.ibm.commerce.search.indexsetup.execution.task.ConfigWCforSolrMigrationCatalogFiltersExpressionTask" /-->
   </_config:Job>
   </_config:Index>
   </_config:ActionConfiguration>