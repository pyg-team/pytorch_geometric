Title: IBM HTTP Client POST Service : General Engine Error - "INVALID_CHARACTER_ERR: An invalid or illegal XML character is specified" - United States

Text:
 TECHNOTE (TROUBLESHOOTING)

PROBLEM(ABSTRACT)
 HTTP Client POST Service : General Engine Error - "INVALID_CHARACTER_ERR: An invalid or illegal XML character is specified" 

SYMPTOM
Business process is going in "halted" status with error "General Engine Error" at step HTTP Client POST Service

In httpclient.log in debug modus, following error is raised : 

[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name
[Content-Length] with value [520]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name [Date] with
value [Mon, 15 Feb 2016 15:15:41 GMT]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name [Content-Type]
with value [text/xml; charset=utf-8]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name [Server] with
value [Microsoft-IIS/8.5]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name [Cache-Control]
with value [private]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name
[X-AspNet-Version] with value [4.0.30319]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name
[X-Content-Type-Options] with value [nosniff]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name
[X-XSS-Protection] with value [1; mode=block]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name [X-Served-By]
with value [4]
[2016-02-15 16:15:42.426] DEBUG <-227305982>
HttpClientAdapter.fillProcessData() - adding header name [*] with value
[*]
[2016-02-15 16:15:42.426] ERROR <HAR.100094313.Thread>
HTTPClientPostService.primitiveProcessData() - General Exception:
INVALID_CHARACTER_ERR: INVALID_CHARACTER_ERR: An invalid or illegal XML character is specified. 
[2016-02-15 16:15:42.426] ERROR <HAR.100094313.Thread> [1455549342426]
INVALID_CHARACTER_ERR: Un caractÃ¨re XML non valide ou incorrect est
indiquÃ©.
[2016-02-15 16:15:42.426] ERRORDTL <HAR.100094313.Thread>
[1455549342426]org.w3c.dom.DOMException: INVALID_CHARACTER_ERR: An invalid or illegal XML character is specified. 
at org.apache.xerces.dom.CoreDocumentImpl.createElement(Unknown
Source)
at
com.sterlingcommerce.woodstock.xpathutil.XPathHelper.createNode(XPathHel
per.java:1467)
at
com.sterlingcommerce.woodstock.xpathutil.XPathHelper.createTargetContext
(XPathHelper.java:1141)
at
com.sterlingcommerce.woodstock.xpathutil.XPathHelper.createTargetContext
(XPathHelper.java:1053)
at
com.sterlingcommerce.woodstock.workflow.WFCUtil.setDataInTree(WFCUtil.ja
va:1113)
at
com.sterlingcommerce.woodstock.workflow.WFCUtil.setDataInTree(WFCUtil.ja
va:784)


CAUSE
HTTP Client POST Service tries to process the answer from the HTTP server but an invalid character is sent back.

If the HTTP server answer is captured with an external tool(by example wireshark) during http exchange, you will see : 

HTTP/1.1 200 OK
Connection: Keep-Alive
Date: Tue, 16 Feb 2016 13:58:19 GMT
Content-Type: text/html; charset=utf-8
Cache-Control: private
X-AspNetMvc-Version: 5.2
x-content-type-options: nosniff
X-XSS-Protection: 1; mode=block
X-Served-By: 4
*: *

Problem is linked with the last parameter *: * 
This header is not valid therefore HTTP Client POST Service is not able to parse it.


DIAGNOSING THE PROBLEM
1)Review logfiles : 

HttpClientAdapter.fillProcessData() - adding header name [*] with value
[*]
[2016-02-15 16:15:42.426] ERROR <HAR.100094313.Thread>
HTTPClientPostService.primitiveProcessData() - General Exception:
INVALID_CHARACTER_ERR: INVALID_CHARACTER_ERR: An invalid or illegal XML character is specified. 

Error message indicates that HTTP Client POST Service tries to process the header *:* 

2)Take a network capture at the time of the issue and review the headers of the http communication 



RESOLVING THE PROBLEM
Ask the Trading Partner to remove the wrong header to allow HTTP Client POST to post the file.